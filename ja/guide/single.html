<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Grails&#12501;&#12524;&#12540;&#12512;&#12527;&#12540;&#12463; 2.3.0.BUILD-SNAPSHOT</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>&#12452;&#12531;&#12488;&#12525;&#12480;&#12463;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>2</strong><span>&#12473;&#12479;&#12540;&#12488;&#12460;&#12452;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#upgradingFromPreviousVersionsOfGrails"><strong>3</strong><span>Grails&#19979;&#20301;&#12496;&#12540;&#12472;&#12519;&#12531;&#12363;&#12425;&#12398;&#26356;&#26032;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#conf"><strong>4</strong><span>&#35373;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#commandLine"><strong>5</strong><span>&#12467;&#12510;&#12531;&#12489;&#12521;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#GORM"><strong>6</strong><span>O/R&#12510;&#12483;&#12500;&#12531;&#12464; (GORM)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#theWebLayer"><strong>7</strong><span>Web&#12524;&#12452;&#12516;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#webServices"><strong>8</strong><span>Web&#12469;&#12540;&#12499;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#async"><strong>9</strong><span>&#38750;&#21516;&#26399;&#12503;&#12525;&#12464;&#12521;&#12511;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#validation"><strong>10</strong><span>&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#services"><strong>11</strong><span>&#12469;&#12540;&#12499;&#12473;&#12524;&#12452;&#12516;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#testing"><strong>12</strong><span>&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#i18n"><strong>13</strong><span>&#22269;&#38555;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#security"><strong>14</strong><span>&#12475;&#12461;&#12517;&#12522;&#12486;&#12451;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#plugins"><strong>15</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#spring"><strong>16</strong><span>Grails&#12392;Spring</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#hibernate"><strong>17</strong><span>Grails&#12392;Hibernate</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#scaffolding"><strong>18</strong><span>&#12473;&#12459;&#12483;&#12501;&#12457;&#12523;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#deployment"><strong>19</strong><span>&#12487;&#12503;&#12525;&#12452;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#contributing"><strong>20</strong><span>Grails&#12395;&#36002;&#29486;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#traslateReport"><strong>21</strong><span>&#32763;&#35379;&#12524;&#12509;&#12540;&#12488;</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                <span id="logo"><a href="http://grails.org" target="_blank"><img alt="Grails Logo" title="The Grails Framework" src="../../img/grails.png" border="0"/></a></span>
                
                
                <span id="sponsor"><a href="http://springsource.com" target="_blank"><img alt="SpringSource Logo" title="SpringSource - Weapons for the War on Java Complexity" src="../../img/springsource-logo.png" border="0"/></a></span>
                
            </div>
            <p>See the light - agile, industrial strength, rapid web application development made easy</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Grails&#12501;&#12524;&#12540;&#12512;&#12527;&#12540;&#12463; - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Graeme Rocher, Peter Ledbrook, Marc Palmer, Jeff Brown, Luke Daley, Burt Beckwith</p>
                            <p><strong>Version:</strong> 2.3.0.BUILD-SNAPSHOT</p>
                            
                            <p><strong>Translated by:</strong> T.Yamamoto, Japanese Grails Doc Translating Team. <br/>【注意】このドキュメントの内容はスナップショットバージョンを元に*意訳*されているため、一部現行バージョンでは未対応の機能もあります。</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>&#12452;&#12531;&#12488;&#12525;&#12480;&#12463;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#whatsNew23"><strong>1.1</strong><span>Grails 2.3&#12398;&#26032;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#whatsNew22"><strong>1.2</strong><span>Grails 2.2&#12398;&#26032;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#whatsNew21"><strong>1.3</strong><span>Grails 2.1&#12398;&#26032;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#whatsNew"><strong>1.4</strong><span>Grails 2.0&#12398;&#26032;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#developmentEnvironmentFeatures"><strong>1.4.1</strong><span>&#38283;&#30330;&#29872;&#22659;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#coreFeatures"><strong>1.4.2</strong><span>&#12467;&#12450;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#webFeatures"><strong>1.4.3</strong><span>Web&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#persistenceFeatures"><strong>1.4.4</strong><span>&#27704;&#32154;&#21270;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#testingFeatures"><strong>1.4.5</strong><span>&#12486;&#12473;&#12488;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>&#12473;&#12479;&#12540;&#12488;&#12460;&#12452;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#24517;&#35201;&#26465;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#downloadingAndInstalling"><strong>2.2</strong><span>&#12480;&#12454;&#12531;&#12525;&#12540;&#12489;&#12392;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingAnApplication"><strong>2.3</strong><span>&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#20316;&#25104;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#aHelloWorldExample"><strong>2.4</strong><span>&#12495;&#12525;&#12540;&#12527;&#12540;&#12523;&#12489;&#20363;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#usingInteractiveMode"><strong>2.5</strong><span>&#12452;&#12531;&#12479;&#12521;&#12463;&#12486;&#12451;&#12502;&#12514;&#12540;&#12489;&#12398;&#21033;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#ide"><strong>2.6</strong><span>IDE&#12398;&#35373;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#conventionOverConfiguration"><strong>2.7</strong><span>Convention over Configuration &#35373;&#23450;&#12424;&#12426;&#35215;&#32004;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#runningAnApplication"><strong>2.8</strong><span>&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#12398;&#36215;&#21205;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#testingAnApplication"><strong>2.9</strong><span>&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#12398;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#deployingAnApplication"><strong>2.10</strong><span>&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#12398;&#12487;&#12503;&#12525;&#12452;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#supportedJavaEEContainers"><strong>2.11</strong><span>&#12469;&#12509;&#12540;&#12488;&#12373;&#12428;&#12390;&#12356;&#12427; Java EE &#12467;&#12531;&#12486;&#12490;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#generatingAnApplication"><strong>2.12</strong><span>&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#29983;&#25104;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingArtefacts"><strong>2.13</strong><span>&#12450;&#12540;&#12486;&#12501;&#12449;&#12463;&#12488;&#12398;&#20316;&#25104;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#upgradingFromPreviousVersionsOfGrails"><strong>3</strong><span>Grails&#19979;&#20301;&#12496;&#12540;&#12472;&#12519;&#12531;&#12363;&#12425;&#12398;&#26356;&#26032;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#conf"><strong>4</strong><span>&#35373;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#config"><strong>4.1</strong><span>&#22522;&#26412;&#35373;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#builtInOptions"><strong>4.1.1</strong><span>&#32068;&#36796;&#12458;&#12503;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#logging"><strong>4.1.2</strong><span>&#12525;&#12462;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#configGORM"><strong>4.1.3</strong><span>GORM</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#environments"><strong>4.2</strong><span>&#29872;&#22659;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dataSource"><strong>4.3</strong><span>&#12487;&#12540;&#12479;&#12477;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dataSourcesAndEnvironments"><strong>4.3.1</strong><span>&#12487;&#12540;&#12479;&#12477;&#12540;&#12473;&#12392;&#29872;&#22659;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#JNDIDataSources"><strong>4.3.2</strong><span>JNDI &#12487;&#12540;&#12479;&#12477;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#automaticDatabaseMigration"><strong>4.3.3</strong><span>&#33258;&#21205;&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12510;&#12452;&#12464;&#12524;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#transactionAwareDataSourceProxy"><strong>4.3.4</strong><span>Transaction-aware&#12487;&#12540;&#12479;&#12477;&#12540;&#12473;&#12503;&#12525;&#12461;&#12471;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#databaseConsole"><strong>4.3.5</strong><span>&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12467;&#12531;&#12477;&#12540;&#12523;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#multipleDatasources"><strong>4.3.6</strong><span>&#35079;&#25968;&#12487;&#12540;&#12479;&#12477;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#configExternalized"><strong>4.4</strong><span>&#35373;&#23450;&#12398;&#22806;&#37096;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#versioning"><strong>4.5</strong><span>&#12496;&#12540;&#12472;&#12519;&#12491;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#docengine"><strong>4.6</strong><span>&#12503;&#12525;&#12472;&#12455;&#12463;&#12488;&#12539;&#12489;&#12461;&#12517;&#12513;&#12531;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dependencyResolution"><strong>4.7</strong><span>&#20381;&#23384;&#24615;&#35299;&#27770;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#configurationsAndDependencies"><strong>4.7.1</strong><span>&#35373;&#23450;&#12392;&#20381;&#23384;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dependencyRepositories"><strong>4.7.2</strong><span>&#20381;&#23384;&#31649;&#29702;&#12522;&#12509;&#12472;&#12488;&#12522;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#debuggingResolution"><strong>4.7.3</strong><span>&#20381;&#23384;&#35299;&#27770;&#12487;&#12496;&#12483;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#inheritedDependencies"><strong>4.7.4</strong><span>&#20381;&#23384;&#12398;&#21463;&#12369;&#32153;&#12366;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#providingDefaultDependencies"><strong>4.7.5</strong><span>&#22522;&#26412;&#20381;&#23384;&#31649;&#29702;&#12398;&#25552;&#20379;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#changingDependencies"><strong>4.7.6</strong><span>&#12473;&#12490;&#12483;&#12503;&#12471;&#12519;&#12483;&#12488;&#12392;&#20182;&#12398;&#22793;&#21270;&#12377;&#12427;&#20381;&#23384;&#38306;&#20418;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dependencyReports"><strong>4.7.7</strong><span>&#20381;&#23384;&#31649;&#29702;&#12524;&#12509;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#pluginJARDependencies"><strong>4.7.8</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;JAR&#20381;&#23384;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mavenIntegration"><strong>4.7.9</strong><span>Maven&#32113;&#21512;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mavendeploy"><strong>4.7.10</strong><span>Maven&#12522;&#12509;&#12472;&#12488;&#12522;&#12408;&#12398;&#12487;&#12503;&#12525;&#12452;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#pluginDependencies"><strong>4.7.11</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;&#20381;&#23384;&#31649;&#29702;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dependencyResolutionCaching"><strong>4.7.12</strong><span>&#20381;&#23384;&#31649;&#29702;&#12398;&#12461;&#12515;&#12483;&#12471;&#12517;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#commandLine"><strong>5</strong><span>&#12467;&#12510;&#12531;&#12489;&#12521;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#interactiveMode"><strong>5.1</strong><span>&#12452;&#12531;&#12479;&#12521;&#12463;&#12486;&#12451;&#12502;&#12514;&#12540;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#forkedMode"><strong>5.2</strong><span>&#12501;&#12457;&#12540;&#12463;&#23455;&#34892;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingGantScripts"><strong>5.3</strong><span>Gant&#12473;&#12463;&#12522;&#12503;&#12488;&#12398;&#20316;&#25104;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#reusingGrailsScripts"><strong>5.4</strong><span>Grails&#12473;&#12463;&#12522;&#12503;&#12488;&#12398;&#20877;&#21033;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#events"><strong>5.5</strong><span>&#12452;&#12505;&#12531;&#12488;&#12434;&#21462;&#24471;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#buildCustomising"><strong>5.6</strong><span>&#12499;&#12523;&#12489;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#antAndMaven"><strong>5.7</strong><span>Ant&#12392;Maven</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#wrapper"><strong>5.8</strong><span>Grails&#12521;&#12483;&#12497;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#GORM"><strong>6</strong><span>O/R&#12510;&#12483;&#12500;&#12531;&#12464; (GORM)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#quickStartGuide"><strong>6.1</strong><span>&#12463;&#12452;&#12483;&#12463;&#12473;&#12479;&#12540;&#12488;&#12460;&#12452;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#basicCRUD"><strong>6.1.1</strong><span>&#22522;&#26412;CRUD</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#domainClasses"><strong>6.2</strong><span>GORM&#12391;&#12398;&#12489;&#12513;&#12452;&#12531;&#12514;&#12487;&#12522;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#gormAssociation"><strong>6.2.1</strong><span>GORM&#12391;&#12398;&#38306;&#36899;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#manyToOneAndOneToOne"><strong>6.2.1.1</strong><span>&#22810;&#23550;1&#12289;1&#23550;1 (Many-to-One, One-to-one)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#oneToMany"><strong>6.2.1.2</strong><span>1&#23550;&#22810; (One-to-many)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#manyToMany"><strong>6.2.1.3</strong><span>&#22810;&#23550;&#22810; (Many-to-many)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#basicCollectionTypes"><strong>6.2.1.4</strong><span>&#22522;&#26412;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#22411;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#gormComposition"><strong>6.2.2</strong><span>GORM&#12391;&#12398;&#12467;&#12531;&#12509;&#12472;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#inheritanceInGORM"><strong>6.2.3</strong><span>GORM&#12391;&#12398;&#32153;&#25215;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#sets,ListsAndMaps"><strong>6.2.4</strong><span>&#12475;&#12483;&#12488;&#12289;&#12522;&#12473;&#12488;&#12289;&#12510;&#12483;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#persistenceBasics"><strong>6.3</strong><span>&#27704;&#32154;&#21270;&#12398;&#22522;&#30990;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#savingAndUpdating"><strong>6.3.1</strong><span>&#20445;&#23384;&#12392;&#26356;&#26032;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#deletingObjects"><strong>6.3.2</strong><span>&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12398;&#21066;&#38500;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#cascades"><strong>6.3.3</strong><span>&#12459;&#12473;&#12465;&#12540;&#12489;&#26356;&#26032;&#21066;&#38500;&#12434;&#29702;&#35299;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#fetching"><strong>6.3.4</strong><span>Eager&#12501;&#12455;&#12483;&#12481;&#12392;Lazy&#12501;&#12455;&#12483;&#12481;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#locking"><strong>6.3.5</strong><span>&#24754;&#35251;&#30340;&#12525;&#12483;&#12463;&#12392;&#27005;&#35251;&#30340;&#12525;&#12483;&#12463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#modificationChecking"><strong>6.3.6</strong><span>&#22793;&#26356;&#30906;&#35469;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#querying"><strong>6.4</strong><span>GORM&#12391;&#12398;&#12463;&#12456;&#12522;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#finders"><strong>6.4.1</strong><span>&#12480;&#12452;&#12490;&#12511;&#12483;&#12463;&#12501;&#12449;&#12452;&#12531;&#12480;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#whereQueries"><strong>6.4.2</strong><span>Where&#12463;&#12456;&#12522;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#criteria"><strong>6.4.3</strong><span>&#12463;&#12521;&#12452;&#12486;&#12522;&#12450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#detachedCriteria"><strong>6.4.4</strong><span>Detached&#12463;&#12521;&#12452;&#12486;&#12522;&#12450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#hql"><strong>6.4.5</strong><span>Hibernate&#12463;&#12456;&#12522;&#12540;&#35328;&#35486; (HQL)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#advancedGORMFeatures"><strong>6.5</strong><span>&#39640;&#24230;&#12394;GORM&#12398;&#27231;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#eventsAutoTimestamping"><strong>6.5.1</strong><span>&#12452;&#12505;&#12531;&#12488;&#12392;&#33258;&#21205;&#12479;&#12452;&#12512;&#12473;&#12479;&#12531;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ormdsl"><strong>6.5.2</strong><span>O/R&#12510;&#12483;&#12500;&#12531;&#12464;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#tableAndColumnNames"><strong>6.5.2.1</strong><span>&#12486;&#12540;&#12502;&#12523;&#21517;&#12289;&#12459;&#12521;&#12512;&#21517;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#caching"><strong>6.5.2.2</strong><span>&#12461;&#12515;&#12483;&#12471;&#12531;&#12464;&#12473;&#12488;&#12521;&#12486;&#12472;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#inheritanceStrategies"><strong>6.5.2.3</strong><span>&#32153;&#25215;&#12473;&#12488;&#12521;&#12486;&#12472;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#identity"><strong>6.5.2.4</strong><span>&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#35672;&#21029;&#23376;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#compositePrimaryKeys"><strong>6.5.2.5</strong><span>&#35079;&#21512;&#20027;&#12461;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#databaseIndices"><strong>6.5.2.6</strong><span>&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#optimisticLockingAndVersioning"><strong>6.5.2.7</strong><span>&#27005;&#35251;&#30340;&#12525;&#12483;&#12463;&#12392;&#12496;&#12540;&#12472;&#12519;&#12491;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#fetchingDSL"><strong>6.5.2.8</strong><span>Eager&#12501;&#12455;&#12483;&#12481;&#12392;Lazy&#12501;&#12455;&#12483;&#12481;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#customCascadeBehaviour"><strong>6.5.2.9</strong><span>&#12459;&#12473;&#12465;&#12540;&#12489;&#12398;&#25391;&#12427;&#33310;&#12356;&#12434;&#22793;&#12360;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#customHibernateTypes"><strong>6.5.2.10</strong><span>Hibernate&#12398;&#12459;&#12473;&#12479;&#12512;&#22411;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#derivedProperties"><strong>6.5.2.11</strong><span>&#27966;&#29983;&#12503;&#12525;&#12497;&#12486;&#12451;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#customNamingStrategy"><strong>6.5.2.12</strong><span>&#21629;&#21517;&#35215;&#21063;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#defaultSortOrder"><strong>6.5.3</strong><span>&#12487;&#12501;&#12457;&#12523;&#12488;&#12477;&#12540;&#12488;&#38918;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#programmaticTransactions"><strong>6.6</strong><span>&#12503;&#12525;&#12464;&#12521;&#12510;&#12481;&#12483;&#12463;&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#gormConstraints"><strong>6.7</strong><span>GORM&#12392;&#21046;&#32004;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#theWebLayer"><strong>7</strong><span>Web&#12524;&#12452;&#12516;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#controllers"><strong>7.1</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#understandingControllersAndActions"><strong>7.1.1</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12392;&#12450;&#12463;&#12471;&#12519;&#12531;&#12398;&#29702;&#35299;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#controllersAndScopes"><strong>7.1.2</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12392;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#modelsAndViews"><strong>7.1.3</strong><span>&#12514;&#12487;&#12523;&#12392;&#12499;&#12517;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#redirectsAndChaining"><strong>7.1.4</strong><span>&#12522;&#12480;&#12452;&#12524;&#12463;&#12488;&#12392;&#12481;&#12455;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#interceptors"><strong>7.1.5</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12539;&#12452;&#12531;&#12479;&#12540;&#12475;&#12503;&#12479;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dataBinding"><strong>7.1.6</strong><span>&#12487;&#12540;&#12479;&#12496;&#12452;&#12531;&#12487;&#12451;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#xmlAndJSON"><strong>7.1.7</strong><span>XML&#12392;JSON&#12398;&#12524;&#12473;&#12509;&#12531;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#moreOnJSONBuilder"><strong>7.1.8</strong><span>JSONBuilder (JSON&#12499;&#12523;&#12480;&#12540;)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#uploadingFiles"><strong>7.1.9</strong><span>&#12501;&#12449;&#12452;&#12523;&#12450;&#12483;&#12503;&#12525;&#12540;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#commandObjects"><strong>7.1.10</strong><span>&#12467;&#12510;&#12531;&#12489;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#formtokens"><strong>7.1.11</strong><span>&#12501;&#12457;&#12540;&#12512;&#20108;&#37325;&#36865;&#20449;&#12398;&#12495;&#12531;&#12489;&#12522;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#typeConverters"><strong>7.1.12</strong><span>&#12471;&#12531;&#12503;&#12523;&#12479;&#12452;&#12503;&#12467;&#12531;&#12496;&#12540;&#12479;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#gsp"><strong>7.2</strong><span>Groovy&#12469;&#12540;&#12496;&#12540;&#12506;&#12540;&#12472;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#GSPBasics"><strong>7.2.1</strong><span>GSP&#12398;&#22522;&#26412;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#variablesAndScopes"><strong>7.2.1.1</strong><span>&#22793;&#25968;&#12392;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#logicAndIteration"><strong>7.2.1.2</strong><span>&#12525;&#12472;&#12483;&#12463;&#12392;&#12452;&#12486;&#12524;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#pageDirectives"><strong>7.2.1.3</strong><span>&#12506;&#12540;&#12472;&#12487;&#12451;&#12524;&#12463;&#12486;&#12451;&#12502;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#expressions"><strong>7.2.1.4</strong><span>&#12456;&#12463;&#12473;&#12503;&#12524;&#12483;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#tags"><strong>7.2.2</strong><span>GSP&#12479;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#tagVariablesAndScopes"><strong>7.2.2.1</strong><span>&#22793;&#25968;&#12392;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#tagLogicAndIteration"><strong>7.2.2.2</strong><span>&#12525;&#12472;&#12483;&#12463;&#12392;&#12452;&#12486;&#12524;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#searchAndFiltering"><strong>7.2.2.3</strong><span>&#26908;&#32034;&#12392;&#12501;&#12451;&#12523;&#12479;&#12522;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#linksAndResources"><strong>7.2.2.4</strong><span>&#12522;&#12531;&#12463;&#12392;&#12522;&#12477;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#formsAndFields"><strong>7.2.2.5</strong><span>&#12501;&#12457;&#12540;&#12512;&#12392;&#12501;&#12451;&#12540;&#12523;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#tagsAsMethodCalls"><strong>7.2.2.6</strong><span>&#12479;&#12464;&#12434;&#12513;&#12477;&#12483;&#12489;&#12392;&#12375;&#12390;&#20351;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#viewsAndTemplates"><strong>7.2.3</strong><span>&#12499;&#12517;&#12540;&#12392;&#12486;&#12531;&#12503;&#12524;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#layouts"><strong>7.2.4</strong><span>Sitemesh&#12391;&#12524;&#12452;&#12450;&#12454;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#resources"><strong>7.2.5</strong><span>&#38745;&#30340;&#12522;&#12477;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#includingResourcesUsingTheResourceTags"><strong>7.2.5.1</strong><span>&#12522;&#12477;&#12540;&#12473;&#12479;&#12464;&#12391;&#12398;&#12522;&#12477;&#12540;&#12473;&#12398;&#20351;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#otherResourceTags"><strong>7.2.5.2</strong><span>&#20182;&#12398;&#12522;&#12477;&#12540;&#12473;&#12479;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#declaringResources"><strong>7.2.5.3</strong><span>&#12522;&#12477;&#12540;&#12473;&#12398;&#23459;&#35328;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#overridingPluginResources"><strong>7.2.5.4</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;&#12522;&#12477;&#12540;&#12473;&#12398;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#optimizingYourResources"><strong>7.2.5.5</strong><span>&#12522;&#12477;&#12540;&#12473;&#12398;&#26368;&#36969;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#debugging"><strong>7.2.5.6</strong><span>&#12487;&#12496;&#12483;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#preventingProcessingOfResources"><strong>7.2.5.7</strong><span>&#12522;&#12477;&#12540;&#12473;&#29983;&#25104;&#12539;&#22793;&#25563;&#20966;&#29702;&#12434;&#38450;&#12368;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#otherResourcesPlugins"><strong>7.2.5.8</strong><span>&#12522;&#12477;&#12540;&#12473;&#38306;&#36899;&#12398;&#12503;&#12521;&#12464;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#sitemeshContentBlocks"><strong>7.2.6</strong><span>Sitemesh&#12467;&#12531;&#12486;&#12531;&#12488;&#12502;&#12525;&#12483;&#12463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#makingChangesToADeployedApplication"><strong>7.2.7</strong><span>&#12487;&#12503;&#12525;&#12452;&#12373;&#12428;&#12383;&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#12408;&#12398;&#22793;&#26356;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#GSPDebugging"><strong>7.2.8</strong><span>GSP&#12487;&#12496;&#12483;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#taglibs"><strong>7.3</strong><span>&#12479;&#12464;&#12521;&#12452;&#12502;&#12521;&#12522;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#taglibVariablesAndScopes"><strong>7.3.1</strong><span>&#22793;&#25968;&#12392;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#simpleTags"><strong>7.3.2</strong><span>&#31777;&#21336;&#12394;&#12479;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#logicalTags"><strong>7.3.3</strong><span>&#21046;&#24481;&#12479;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#iterativeTags"><strong>7.3.4</strong><span>&#12452;&#12486;&#12524;&#12540;&#12488;&#12479;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#namespaces"><strong>7.3.5</strong><span>&#12479;&#12464;&#12493;&#12540;&#12512;&#12473;&#12506;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#usingJSPTagLibraries"><strong>7.3.6</strong><span>JSP&#12479;&#12464;&#12521;&#12452;&#12502;&#12521;&#12522;&#12398;&#20351;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#tagReturnValue"><strong>7.3.7</strong><span>&#12479;&#12464;&#12398;&#25147;&#12426;&#20516;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#urlmappings"><strong>7.4</strong><span>URL&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingToControllersAndActions"><strong>7.4.1</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12392;&#12450;&#12463;&#12471;&#12519;&#12531;&#12395;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#restfulMappings"><strong>7.4.2</strong><span>REST&#12522;&#12477;&#12540;&#12473;&#12408;&#12398;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#embeddedVariables"><strong>7.4.3</strong><span>&#22475;&#36796;&#22793;&#25968;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingToViews"><strong>7.4.4</strong><span>&#12499;&#12517;&#12540;&#12408;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingToResponseCodes"><strong>7.4.5</strong><span>&#12524;&#12473;&#12509;&#12531;&#12473;&#12467;&#12540;&#12489;&#12408;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingHTTP"><strong>7.4.6</strong><span>HTTP&#12513;&#12477;&#12483;&#12489;&#12408;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingWildcards"><strong>7.4.7</strong><span>&#12510;&#12483;&#12500;&#12531;&#12464;&#12527;&#12452;&#12523;&#12489;&#12459;&#12540;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#automaticLinkRewriting"><strong>7.4.8</strong><span>&#33258;&#21205;&#12522;&#12531;&#12463;&#12522;&#12521;&#12452;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#applyingConstraints"><strong>7.4.9</strong><span>&#21046;&#32004;&#12398;&#36969;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#namedMappings"><strong>7.4.10</strong><span>&#21517;&#21069;&#20184;&#12365;URL&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#customizingUrlFormat"><strong>7.4.11</strong><span>URL&#12501;&#12457;&#12540;&#12510;&#12483;&#12488;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#namespacedControllers"><strong>7.4.12</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12493;&#12540;&#12512;&#12473;&#12506;&#12540;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#webflow"><strong>7.5</strong><span>Web&#12501;&#12525;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#startAndEndStates"><strong>7.5.1</strong><span>&#38283;&#22987;&#12392;&#32066;&#20102;&#12398;&#12473;&#12486;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#actionStatesAndViewStates"><strong>7.5.2</strong><span>&#12450;&#12463;&#12471;&#12519;&#12531;&#12473;&#12486;&#12540;&#12488;&#12392;&#12499;&#12517;&#12540;&#12473;&#12486;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#flowExecutionEvents"><strong>7.5.3</strong><span>&#12501;&#12525;&#12540;&#23455;&#34892;&#12452;&#12505;&#12531;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#flowScopes"><strong>7.5.4</strong><span>&#12501;&#12525;&#12540;&#12398;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dataBindingAndValidation"><strong>7.5.5</strong><span>&#12487;&#12540;&#12479;&#12496;&#12452;&#12531;&#12487;&#12451;&#12531;&#12464;&#12392;&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#subflowsAndConversations"><strong>7.5.6</strong><span>&#12469;&#12502;&#12501;&#12525;&#12540;&#12392;&#12398;&#23550;&#35441;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#filters"><strong>7.6</strong><span>&#12501;&#12451;&#12523;&#12479;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#applyingFilters"><strong>7.6.1</strong><span>&#12501;&#12451;&#12523;&#12479;&#12398;&#36969;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#filterTypes"><strong>7.6.2</strong><span>&#12501;&#12451;&#12523;&#12479;&#12398;&#31278;&#39006;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#filterVariablesAndScopes"><strong>7.6.3</strong><span>&#22793;&#25968;&#12392;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#filterDependencies"><strong>7.6.4</strong><span>&#12501;&#12451;&#12523;&#12479;&#20381;&#23384;&#38306;&#20418;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#ajax"><strong>7.7</strong><span>Ajax</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ajaxSupport"><strong>7.7.1</strong><span>Ajax&#23550;&#24540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#remotingLinking"><strong>7.7.1.1</strong><span>&#12522;&#12514;&#12540;&#12488;&#12522;&#12531;&#12463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#updatingContent"><strong>7.7.1.2</strong><span>&#12467;&#12531;&#12486;&#12531;&#12484;&#12398;&#26356;&#26032;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#remoteFormSubmission"><strong>7.7.1.3</strong><span>&#12522;&#12514;&#12540;&#12488;&#12501;&#12457;&#12540;&#12512;&#36865;&#20449;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#ajaxEvents"><strong>7.7.1.4</strong><span>Ajax&#12452;&#12505;&#12531;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ajaxWithPrototype"><strong>7.7.2</strong><span>Prototype&#12434;&#20351;&#29992;&#12375;&#12383;Ajax</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ajaxWithDojo"><strong>7.7.3</strong><span>Dojo&#12434;&#20351;&#29992;&#12375;&#12383;Ajax</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ajaxWithGWT"><strong>7.7.4</strong><span>GWT&#12434;&#20351;&#29992;&#12375;&#12383;Ajax</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ajaxOnTheServer"><strong>7.7.5</strong><span>Ajax&#20351;&#29992;&#26178;&#12398;&#12469;&#12540;&#12496;&#12469;&#12452;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#contentNegotiation"><strong>7.8</strong><span>&#12467;&#12531;&#12486;&#12531;&#12488;&#12493;&#12468;&#12471;&#12456;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#webServices"><strong>8</strong><span>Web&#12469;&#12540;&#12499;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#REST"><strong>8.1</strong><span>REST</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#domainResources"><strong>8.1.1</strong><span>REST&#12522;&#12477;&#12540;&#12473;&#12392;&#12375;&#12390;&#12489;&#12513;&#12452;&#12531;&#12463;&#12521;&#12473;&#12434;&#20351;&#29992;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#urlMappings"><strong>8.1.2</strong><span>REST&#12522;&#12477;&#12540;&#12473;&#12408;&#12398;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#linkingToResources"><strong>8.1.3</strong><span>REST&#12522;&#12477;&#12540;&#12473;&#12408;&#12398;&#12522;&#12531;&#12463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#versioningResources"><strong>8.1.4</strong><span>REST&#12522;&#12477;&#12540;&#12473;&#12398;&#12496;&#12540;&#12472;&#12519;&#12491;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#restfulControllers"><strong>8.1.5</strong><span>REST&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12398;&#23455;&#35013;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#extendingRestfulController"><strong>8.1.5.1</strong><span>RestfulController&#12473;&#12540;&#12497;&#12540;&#12463;&#12521;&#12473;&#12398;&#25313;&#24373;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#restControllersStepByStep"><strong>8.1.5.2</strong><span>REST&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12398;&#23455;&#35013;&#12473;&#12486;&#12483;&#12503;&#12496;&#12452;&#12473;&#12486;&#12483;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#generatingRestControllers"><strong>8.1.5.3</strong><span>&#12473;&#12459;&#12483;&#12501;&#12457;&#12523;&#12489;&#12434;&#20351;&#29992;&#12375;&#12390;REST&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12434;&#29983;&#25104;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#renderers"><strong>8.1.6</strong><span>&#12524;&#12473;&#12509;&#12531;&#12473;&#12524;&#12531;&#12480;&#12522;&#12531;&#12464;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#defaultRenderers"><strong>8.1.6.1</strong><span>&#12487;&#12501;&#12457;&#12523;&#12488;&#12524;&#12531;&#12480;&#12521;&#12540;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#objectMarshallers"><strong>8.1.6.2</strong><span>&#12459;&#12473;&#12479;&#12512;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12510;&#12540;&#12471;&#12515;&#12521;&#12398;&#30331;&#37682;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#namedObjectMarshallers"><strong>8.1.6.3</strong><span>&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12539;&#12510;&#12540;&#12471;&#12515;&#12521;&#12398;&#21517;&#21069;&#20184;&#12365;&#23450;&#32681;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#objectMarshallerInterface"><strong>8.1.6.4</strong><span>ObjectMarshaller&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12452;&#12473;&#12408;&#12398;&#23455;&#35013;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#customRenderers"><strong>8.1.6.5</strong><span>&#12459;&#12473;&#12479;&#12512;&#12524;&#12531;&#12480;&#12521;&#12540;&#12398;&#23455;&#35013;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#gspRenderers"><strong>8.1.6.6</strong><span>GSP&#12434;&#20351;&#29992;&#12375;&#12383;&#12459;&#12473;&#12479;&#12512;&#12524;&#12531;&#12480;&#12522;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#hypermedia"><strong>8.1.7</strong><span>&#12450;&#12503;&#12522;&#12465;&#12540;&#12471;&#12519;&#12531;&#29366;&#24907;&#12456;&#12531;&#12472;&#12531;&#12392;&#12375;&#12390;&#12398;&#12495;&#12452;&#12497;&#12540;&#12513;&#12487;&#12451;&#12450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#hal"><strong>8.1.7.1</strong><span>HAL&#12469;&#12509;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#atom"><strong>8.1.7.2</strong><span>Atom&#12469;&#12509;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#vndError"><strong>8.1.7.3</strong><span>Vnd.Error&#12469;&#12509;&#12540;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#binding"><strong>8.1.8</strong><span>&#12522;&#12477;&#12540;&#12473;&#12496;&#12452;&#12531;&#12487;&#12451;&#12531;&#12464;&#12398;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#SOAP"><strong>8.2</strong><span>SOAP</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#RSSAndAtom"><strong>8.3</strong><span>RSS&#12392;Atom</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#async"><strong>9</strong><span>&#38750;&#21516;&#26399;&#12503;&#12525;&#12464;&#12521;&#12511;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#promises"><strong>9.1</strong><span>Promises</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#asyncGorm"><strong>9.2</strong><span>&#38750;&#21516;&#26399;GORM</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#asyncRequests"><strong>9.3</strong><span>&#38750;&#21516;&#26399;&#12522;&#12463;&#12456;&#12473;&#12488;&#12495;&#12531;&#12489;&#12522;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#grailsEvents"><strong>9.4</strong><span>Grails&#12452;&#12505;&#12531;&#12488;API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#asyncServletApi"><strong>9.5</strong><span>Servlet 3.0 Async</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#validation"><strong>10</strong><span>&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#constraints"><strong>10.1</strong><span>&#21046;&#32004;&#12434;&#23459;&#35328;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validatingConstraints"><strong>10.2</strong><span>&#21046;&#32004;&#12434;&#12496;&#12522;&#12487;&#12540;&#12488;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#sharingConstraints"><strong>10.3</strong><span>&#21046;&#32004;&#12434;&#12463;&#12521;&#12473;&#38291;&#12391;&#20849;&#26377;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validationOnTheClient"><strong>10.4</strong><span>&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12469;&#12452;&#12489;&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validationAndInternationalization"><strong>10.5</strong><span>&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;&#12398;&#22269;&#38555;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validationNonDomainAndCommandObjectClasses"><strong>10.6</strong><span>&#12467;&#12510;&#12531;&#12489;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12289;&#12489;&#12513;&#12452;&#12531;&#12463;&#12521;&#12473;&#20197;&#22806;&#12398;&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#services"><strong>11</strong><span>&#12469;&#12540;&#12499;&#12473;&#12524;&#12452;&#12516;&#12540;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#declarativeTransactions"><strong>11.1</strong><span>&#26029;&#23450;&#30340;&#12394;&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#transactionsRollbackAndTheSession"><strong>11.1.1</strong><span>&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#12525;&#12540;&#12523;&#12496;&#12483;&#12463;&#12392;&#12475;&#12483;&#12471;&#12519;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#scopedServices"><strong>11.2</strong><span>&#12469;&#12540;&#12499;&#12473;&#12398;&#12473;&#12467;&#12540;&#12503;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dependencyInjectionServices"><strong>11.3</strong><span>&#20381;&#23384;&#27880;&#20837;&#12392;&#12469;&#12540;&#12499;&#12473;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#usingServicesFromJava"><strong>11.4</strong><span>Java&#12363;&#12425;&#12469;&#12540;&#12499;&#12473;&#12434;&#20351;&#12358;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#testing"><strong>12</strong><span>&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#unitTesting"><strong>12.1</strong><span>&#12518;&#12491;&#12483;&#12488;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#unitTestingControllers"><strong>12.1.1</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12398;&#12518;&#12491;&#12483;&#12488;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#unitTestingTagLibraries"><strong>12.1.2</strong><span>&#12479;&#12464;&#12521;&#12452;&#12502;&#12521;&#12522;&#12398;&#12518;&#12491;&#12483;&#12488;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#unitTestingDomains"><strong>12.1.3</strong><span>&#12489;&#12513;&#12452;&#12531;&#12398;&#12518;&#12491;&#12483;&#12488;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#unitTestingFilters"><strong>12.1.4</strong><span>&#12501;&#12451;&#12523;&#12479;&#12398;&#12518;&#12491;&#12483;&#12488;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#unitTestingURLMappings"><strong>12.1.5</strong><span>URL&#12510;&#12483;&#12500;&#12531;&#12464;&#12398;&#12518;&#12491;&#12483;&#12488;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mockingCollaborators"><strong>12.1.6</strong><span>&#12467;&#12521;&#12508;&#12524;&#12540;&#12479;&#12398;&#12514;&#12483;&#12463;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mockingCodecs"><strong>12.1.7</strong><span>&#12467;&#12540;&#12487;&#12483;&#12463;&#12398;&#12514;&#12483;&#12463;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#integrationTesting"><strong>12.2</strong><span>&#12452;&#12531;&#12486;&#12464;&#12524;&#12540;&#12471;&#12519;&#12531;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#functionalTesting"><strong>12.3</strong><span>&#12501;&#12449;&#12531;&#12463;&#12471;&#12519;&#12490;&#12523;&#12486;&#12473;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#i18n"><strong>13</strong><span>&#22269;&#38555;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#understandingMessageBundles"><strong>13.1</strong><span>&#12513;&#12483;&#12475;&#12540;&#12472;&#12496;&#12531;&#12489;&#12523;&#12434;&#29702;&#35299;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changingLocales"><strong>13.2</strong><span>&#12525;&#12465;&#12540;&#12523;&#12398;&#22793;&#26356;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#readingMessages"><strong>13.3</strong><span>&#12513;&#12483;&#12475;&#12540;&#12472;&#35501;&#36796;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#scaffoldingAndI18n"><strong>13.4</strong><span>&#12473;&#12459;&#12483;&#12501;&#12457;&#12523;&#12489;&#12392;i18n</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#security"><strong>14</strong><span>&#12475;&#12461;&#12517;&#12522;&#12486;&#12451;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#securingAgainstAttacks"><strong>14.1</strong><span>&#25915;&#25731;&#12363;&#12425;&#12398;&#38450;&#24481;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#xssPrevention"><strong>14.2</strong><span>&#12463;&#12525;&#12473;&#12469;&#12452;&#12488;&#12473;&#12463;&#12522;&#12503;&#12486;&#12451;&#12531;&#12464;(XSS)&#38450;&#24481;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#codecs"><strong>14.3</strong><span>&#12456;&#12531;&#12467;&#12540;&#12489;&#12539;&#12487;&#12467;&#12540;&#12489;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#authentication"><strong>14.4</strong><span>&#35469;&#35388;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#securityPlugins"><strong>14.5</strong><span>&#12475;&#12461;&#12517;&#12522;&#12486;&#12451;&#12503;&#12521;&#12464;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#springSecurity"><strong>14.5.1</strong><span>Spring Security</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#shiro"><strong>14.5.2</strong><span>Shiro</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#plugins"><strong>15</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingAndInstallingPlugins"><strong>15.1</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;&#12398;&#20316;&#25104;&#12392;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#repositories"><strong>15.2</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;&#12522;&#12509;&#12472;&#12488;&#12522;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#understandingPluginStructure"><strong>15.3</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;&#27083;&#36896;&#12434;&#29702;&#35299;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#providingBasicArtefacts"><strong>15.4</strong><span>&#22522;&#26412;&#12450;&#12540;&#12486;&#12451;&#12501;&#12449;&#12463;&#12488;&#12398;&#25552;&#20379;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#evaluatingConventions"><strong>15.5</strong><span>&#35215;&#32004;&#12398;&#35413;&#20385;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#hookingIntoBuildEvents"><strong>15.6</strong><span>&#12499;&#12523;&#12489;&#12452;&#12505;&#12531;&#12488;&#12398;&#12501;&#12483;&#12463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#hookingIntoRuntimeConfiguration"><strong>15.7</strong><span>&#12521;&#12531;&#12479;&#12452;&#12512;&#35373;&#23450;&#12408;&#12398;&#12501;&#12483;&#12463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#addingDynamicMethodsAtRuntime"><strong>15.8</strong><span>&#23455;&#34892;&#26178;&#12398;&#12480;&#12452;&#12490;&#12511;&#12483;&#12463;&#12513;&#12477;&#12483;&#12489;&#36861;&#21152;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#participatingInAutoReloadEvents"><strong>15.9</strong><span>&#33258;&#21205;&#12522;&#12525;&#12540;&#12489;&#12452;&#12505;&#12531;&#12488;&#12408;&#12398;&#21442;&#21152;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#understandingPluginLoadOrder"><strong>15.10</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;&#12398;&#12525;&#12540;&#12489;&#38918;&#12434;&#29702;&#35299;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#artefactApi"><strong>15.11</strong><span>&#12450;&#12540;&#12486;&#12501;&#12449;&#12463;&#12488;API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#queryingArtefacts"><strong>15.11.1</strong><span>&#20351;&#29992;&#21487;&#33021;&#12394;&#12450;&#12540;&#12486;&#12501;&#12449;&#12463;&#12488;&#12398;&#26908;&#32034;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#customArtefacts"><strong>15.11.2</strong><span>&#12450;&#12540;&#12486;&#12501;&#12449;&#12463;&#12488;&#22411;&#12398;&#36861;&#21152;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#binaryPlugins"><strong>15.12</strong><span>&#12496;&#12452;&#12490;&#12522;&#12540;&#12503;&#12521;&#12464;&#12452;&#12531;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#spring"><strong>16</strong><span>Grails&#12392;Spring</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#theUnderpinningsOfGrails"><strong>16.1</strong><span>Grails&#12398;&#22303;&#21488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#springdslAdditional"><strong>16.2</strong><span>&#36861;&#21152;&#12499;&#12540;&#12531;&#12434;&#23450;&#32681;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#springdsl"><strong>16.3</strong><span>&#12499;&#12540;&#12531;DSL&#12391;Spring&#12521;&#12531;&#12479;&#12452;&#12512;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#theBeanBuilderDSLExplained"><strong>16.4</strong><span>&#12499;&#12540;&#12531;&#12499;&#12523;&#12480;&#12540;DSL&#12398;&#35299;&#35500;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#propertyPlaceholderConfiguration"><strong>16.5</strong><span>&#12503;&#12525;&#12497;&#12486;&#12451;&#12503;&#12524;&#12540;&#12473;&#12507;&#12523;&#12480;&#35373;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#propertyOverrideConfiguration"><strong>16.6</strong><span>&#12503;&#12525;&#12497;&#12486;&#12451;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;&#35373;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#hibernate"><strong>17</strong><span>Grails&#12392;Hibernate</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#usingHibernateXMLMappingFiles"><strong>17.1</strong><span>Hibernate XML&#12510;&#12483;&#12500;&#12531;&#12464;&#12398;&#20351;&#29992;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#mappingWithHibernateAnnotations"><strong>17.2</strong><span>Hibernate&#12450;&#12494;&#12486;&#12540;&#12471;&#12519;&#12531;&#12391;&#12398;&#12510;&#12483;&#12500;&#12531;&#12464;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#addingConstraints"><strong>17.3</strong><span>&#21046;&#32004;&#12398;&#36861;&#21152;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#scaffolding"><strong>18</strong><span>&#12473;&#12459;&#12483;&#12501;&#12457;&#12523;&#12489;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#deployment"><strong>19</strong><span>&#12487;&#12503;&#12525;&#12452;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#contributing"><strong>20</strong><span>Grails&#12395;&#36002;&#29486;&#12377;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#issues"><strong>20.1</strong><span>JIRA&#12395;&#35506;&#38988;&#12434;&#12522;&#12509;&#12540;&#12488;(&#12496;&#12464;&#22577;&#21578;)</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#build"><strong>20.2</strong><span>&#12477;&#12540;&#12473;&#12363;&#12425;&#12499;&#12523;&#12489;&#12375;&#12390;&#12486;&#12473;&#12488;&#12434;&#36208;&#12425;&#12379;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#patchesCore"><strong>20.3</strong><span>Grails&#12467;&#12450;&#12395;&#12497;&#12483;&#12481;&#12434;&#36865;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#patchesDoc"><strong>20.4</strong><span>Grails&#12489;&#12461;&#12517;&#12513;&#12531;&#12488;&#12395;&#12497;&#12483;&#12481;&#12434;&#36865;&#12427;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#traslateReport"><strong>21</strong><span>&#32763;&#35379;&#12524;&#12509;&#12540;&#12488;</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        
<a name="1. Introduction"><!-- Legacy link --></a>
<h1 id="introduction">1 イントロダクション</h1>
<div class="hidden-block">Java web development as it stands today is dramatically more complicated than it needs to be. Most modern web frameworks in the Java space are over complicated and don't embrace the Don't Repeat Yourself (DRY) principles.</div>
現在のJavaでのWeb開発は必要以上に複雑です。JavaのほとんどのWebフレームワークは複雑でDon't Repeat Yourself (DRY)ではありません。<p class="paragraph"/><div class="hidden-block">Dynamic frameworks like Rails, Django and TurboGears helped pave the way to a more modern way of thinking about web applications. Grails builds on these concepts and dramatically reduces the complexity of building web applications on the Java platform. What makes it different, however, is that it does so by building on already established Java technologies like Spring and Hibernate.</div>
Rails,Django,TurboGearsといったダイナミックフレームワークはWebアプリケーションの考え方をよりモダンな方へ導いてくれました。Grailsは、Spring、Hibernateといった既に確立したJavaテクノロジーで、それらのダイナミックフレームワーク概念に基づいてJava環境でのWebアプリケーション開発の複雑さを軽減させます。<p class="paragraph"/><div class="hidden-block">Grails is a full stack framework and attempts to solve as many pieces of the web development puzzle through the core technology and its associated plugins. Included out the box are things like:</div>
Grailsは、多くのコア・テクノロジーによるWeb開発でのパズルような断片をプラグインで連携させることで解決を試みたフルスタックフレームワークです。以下の内容をすぐに利用できます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>An easy to use Object Relational Mapping (ORM) layer built on <a href="http://www.hibernate.org" target="blank">Hibernate</a></li>
<li>An expressive view technology called Groovy Server Pages (GSP)</li>
<li>A controller layer built on <a href="http://www.springframework.org" target="blank">Spring</a> MVC</li>
<li>A command line scripting environment built on the Groovy-powered <a href="http://groovy.codehaus.org/Gant" target="blank">Gant</a></li>
<li>An embedded <a href="http://tomcat.apache.org" target="blank">Tomcat</a> container which is configured for on the fly reloading</li>
<li>Dependency injection with the inbuilt Spring container</li>
<li>Support for internationalization (i18n) built on Spring's core MessageSource concept</li>
<li>A transactional service layer built on Spring's transaction abstraction</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="http://www.hibernate.org" target="blank">Hibernate</a>上に構築された、簡単に利用できるオブジェクト・リレーショナル・マッピング(ORM)レイヤ</li>
<li>表現豊かなビューテクノロジーGroovy Server Pages (GSP)</li>
<li>コントローラレイヤは <a href="http://www.springframework.org" target="blank">Spring</a> MVCを利用</li>
<li>コマンドラインスクリプト環境にはGroovy版のAnt <a href="http://groovy.codehaus.org/Gant" target="blank">Gant</a></li>
<li>リロード可能に設定された組込 <a href="http://tomcat.apache.org" target="blank">Tomcat</a></li>
<li>組込 <a href="http://www.springframework.org" target="blank">Spring</a> による依存注入</li>
<li>SpringのMessageSourceで実装された国際化(i18n)対応</li>
<li>Springフレームワークのトランザクション概念によるサービスレイヤのトランザクション</li>
</ul><p class="paragraph"/><div class="hidden-block">All of these are made easy to use through the power of the <a href="http://groovy.codehaus.org" target="blank">Groovy</a> language and the extensive use of Domain Specific Languages (DSLs)</div>
これら全ては、 <a href="http://groovy.codehaus.org" target="blank">Groovy</a> と多くのDomain Specific Languages (DSL ドメイン特化言語)を活用して簡単に使用できるように実装されています。<p class="paragraph"/><div class="hidden-block">This documentation will take you through getting started with Grails and building web applications with the Grails framework.</div>
このドキュメントは、Grailsのスタートガイドと、GrailsでのWebアプリケーション構築を紹介します。


<h2 id="whatsNew23">1.1 Grails 2.3の新機能</h2>
<div class="hidden-block">h4. Improved Dependency Management</div>
<h4>依存管理の向上</h4><p class="paragraph"/><div class="hidden-block">The default dependency resolution engine used by Grails has been changed to <a href="http://eclipse.org/aether" target="blank">Aether</a>, the dependency resolution engine used by Maven. Which engine you use can be configured in <code>BuildConfig</code>:</div>
Grailsでデフォルトで使用されている依存管理エンジンが、Mavenで使用されているエンジンの <a href="http://eclipse.org/aether" target="blank">Aether</a> に変更されました。 <code>BuildConfig</code> で設定をすることでどちらのエンジンを使用するか変更可能です。<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolver = <span class="java&#45;quote">"maven"</span> // or ivy</pre></div><p class="paragraph"/><div class="hidden-block">Using Aether dependency resolution in Grails results in the same behavior as when using the Maven build tool, meaning improved snapshot handling, understanding of custom packaging types and so on.</div>
Aether依存管理を使用するとGrailsではMavenビルドツールと同じ振る舞いをします。これは、前と比べてスナップショットハンドリングの向上やカスタムパッケージング等の機能向上を意味します。<p class="paragraph"/><div class="hidden-block">In addition, the <a href="../ref/Command Line/dependency-report.html" class="commandLine">dependency-report</a> command has been updated to print the dependency graph of the console, which helps in diagnosing dependency resolution failures. See the chapter on <a href="../guide/single.html#dependencyResolution" class="guide">Dependency Resolution</a> for more information.</div>
そしてさらに、 <a href="../ref/Command Line/dependency-report.html" class="commandLine">dependency-report</a> コマンドも改良され、依存問題の解決を手助けするために、依存関係のグラフがコンソールに表示されるようになりました。 詳しくは <a href="../guide/single.html#dependencyResolution" class="guide">依存性解決</a> のドキュメントを参照してください。<p class="paragraph"/><div class="hidden-block">h4. Data Binder</div>
<h4>データバインダー</h4><p class="paragraph"/><div class="hidden-block">Grails 2.3 includes a new data binding mechanism which is more flexible and easier to maintain than the data binder used in previous versions.  The new data binder includes numerous enhancements including:</div>
Grails 2.3では、依存のバージョンよりもフレキシブルで保守性の高く簡単な新データバインダーを実装しています。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Custom date formats on a per field basis using <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a></li>
<li>User defined data converters using <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/ValueConverter.html" class="api">ValueConverter</a></li>
<li>User defined formatted data converters using <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a> and <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/FormattedValueConverter.html" class="api">FormattedValueConverter</a></li>
<li>Custom binding on a per class basis using <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a></li>
<li>Custom binding on a per field basis using <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a></li>
<li>By default all blank and empty Strings will be converted to null during data binding (configurable)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>フィールドごとのカスタムデータフォーマット - <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a></li>
<li>ユーザ定義可能なデータコンバーター - <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/ValueConverter.html" class="api">ValueConverter</a></li>
<li>ユーザ定義フォーマットデータコンバーター - <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a>  <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/FormattedValueConverter.html" class="api">FormattedValueConverter</a></li>
<li>クラスごとのカスタムバインディング - <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a></li>
<li>フィールドごとのカスタムバインディング - <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a></li>
<li>デフォルトで全ての空文字列とブランクはデータバインディングでnullに変換されます。(設定可能)</li>
</ul><p class="paragraph"/><div class="hidden-block">See the <a href="../guide/single.html#dataBinding" class="guide">Data Binding</a> section for details.</div>
詳細は <a href="../guide/single.html#dataBinding" class="guide">データバインディング</a> のセクションを参照してください。<p class="paragraph"/><div class="hidden-block">The legacy data binder may be used by assigning <code>true</code> to the <code>grails.databinding.useSpringBinder</code> property in <code>grails-app/conf/Config.groovy</code>.  Note that the legacy binder does not support any of the new features provided by the new data binder.</div>
<code>grails-app/conf/Config.groovy</code> の <code>grails.databinding.useSpringBinder</code> プロパティを <code>true</code> にすることで以前のデータバインダーに変更することができます。 以前のバインダーは今回実装された新機能には対応していません。<p class="paragraph"/><h4>Domain Classes As Command Objects</h4><p class="paragraph"/>When a domain class is used as a command object and there is an <code>id</code> request parameter, the framework will retrieve the instance of the domain class from the database using the <code>id</code> request parameter.  See the <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> documentation for more details.<p class="paragraph"/><div class="hidden-block">h4. Forked Execution</div>
<h4>フォーク実行 </h4><p class="paragraph"/><div class="hidden-block">All major commands can now be forked into a separate JVM, thus isolating the build path from the runtime / test paths. Forked execution can be controlled via the <code>BuildConfig</code>:</div>
全てのメジャーなコマンドが別々のJVMへフォークされるようになり、ビルドパスをランタイム/テストから分離します。 フォーク実行のパラメータは <code>BuildConfig</code> に定義できます:<p class="paragraph"/><div class="hidden-block">
<div class="code"><pre>grails.project.fork = &#91;
   test: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256, daemon:<span class="java&#45;keyword">true</span>&#93;, // configure settings <span class="java&#45;keyword">for</span> the test&#45;app JVM
   run: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;, // configure settings <span class="java&#45;keyword">for</span> the run&#45;app JVM
   war: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;, // configure settings <span class="java&#45;keyword">for</span> the run&#45;war JVM
   console: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;// configure settings <span class="java&#45;keyword">for</span> the Console UI JVM
&#93;</pre></div>
</div>
<div class="code"><pre>grails.project.fork = &#91;
   test: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256, daemon:<span class="java&#45;keyword">true</span>&#93;, // test&#45;app用JVMへの設定
   run: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;, // run&#45;app用JVMへの設定
   war: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;, // run&#45;war用JVMへの設定
   console: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;// console用JVMへの設定
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">See the documentation on <a href="../guide/single.html#forkedMode" class="guide">Forked Mode</a> for more information.</div>
詳しくは <a href="../guide/single.html#forkedMode" class="guide">フォームモード</a> のドキュメントを参照してください。<p class="paragraph"/><h4>Test Runner Daemon</h4><p class="paragraph"/>To speed up testing when using forked execution a new daemon will start-up in the background to run tests when using interactive mode. You can restart the daemon with the <code>restart-daemon</code> command from interactive mode:<p class="paragraph"/><div class="code"><pre>$ grails&#62; restart&#45;daemon</pre></div><p class="paragraph"/><h4>Server-Side REST Improvements</h4><p class="paragraph"/>Grails' <a href="../guide/single.html#REST" class="guide">REST support</a> has been significantly improved with the addition of the following features:
<ul class="star">
<li>Rich <a href="../guide/single.html#restfulMappings" class="guide">REST URL Mapping support</a> with supports for resource mappings, singular resource mappings, nested resources, versioning and more</li>
<li>New extensible response rendering and binding APIs</li>
<li>Support for HAL, Atom and Hypermedia (HATEAOS)</li>
<li>Scaffolding for REST controllers</li>
</ul><p class="paragraph"/>See the <a href="../guide/single.html#REST" class="guide">user guide</a> for more information.<p class="paragraph"/><div class="hidden-block">h4. Async support </div>
<h4>非同期サポート</h4><p class="paragraph"/><div class="hidden-block">Grails 2.3 features new <a href="../guide/single.html#async" class="guide">Asynchronous Programming APIs</a> that allow for asynchronous processing of requests and integrate seamlessly with GORM. Example:</div>
Grails 2.3では、リクエストの非同期処理と、GORMとシームレスに統合した新たな<a href="../guide/single.html#async" class="guide">非同期プログラミングAPI</a>を提供しています。 例:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;
&#8230;
def index() &#123;
   tasks books: Book.async.list(),
         totalBooks: Book.async.count(),
         otherValue: &#123;
           // <span class="java&#45;keyword">do</span> hard work
         &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">See <a href="../guide/single.html#async" class="guide">the documentation</a> for further information.</div>
詳しくは、 <a href="../guide/single.html#async" class="guide">ドキュメント</a> を参照してください。<p class="paragraph"/><div class="hidden-block">h4. Encoding / Escaping Improvements </div>
<h4>エンコーディング / エスケーピングの向上</h4><p class="paragraph"/><div class="hidden-block">Grails 2.3 features dedicated support for <a href="../guide/single.html#xssPrevention" class="guide">Cross Site Scripting (XSS) prevention</a>, including :</div>
Grails 2.3では専用の <a href="../guide/single.html#xssPrevention" class="guide">クロスサイトスクリプティング(XSS)防御</a>を実装しています。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Defaulting to HTML escaping all GSP expressions and scriptlets</li>
<li>Context sensitive encoding switching for tags</li>
<li>Double encoding prevention</li>
<li>Optional automatic encoding of all data in a GSP page not considered safe</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>デフォルトでGSPエクスプレッションとスクリプトレットをHTMLエスケーピング</li>
<li>タグでの状況依存エンコーディング切替</li>
<li>多重エンコーディング防止</li>
<li>GSPページ内の全てのデータに対して安全と判断しない場合の自動エンコーディング</li>
</ul><p class="paragraph"/><div class="hidden-block">See the documentation on <a href="../guide/single.html#xssPrevention" class="guide">Cross Site Scripting (XSS) prevention</a> for more information.</div>
詳しくは、 <a href="../guide/single.html#xssPrevention" class="guide">クロスサイトスクリプティング(XSS)防御</a> のドキュメントを参照してください。<p class="paragraph"/><div class="hidden-block">h4. Hibernate 3 and 4 support </div>
<h4>Hibernate 3と4をサポート</h4><p class="paragraph"/><div class="hidden-block">The GORM for Hibernate 3 support for Grails has been extracted into a separate project, allowing new support for Hibernate 4 as a separate plugin.</div>
新たにHibernate 4をプラグインでサポートするために、Hibernate 3用のGORMは、本体から別のプラグインプロジェクトとなりました。<p class="paragraph"/><h4>Namespaced Controllers</h4><p class="paragraph"/>Controllers may now be defined in a namespace which allows for multiple controllers to be defined with the same name in different packages.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/com/app/reporting/AdminController.groovy
<span class="java&#45;keyword">package</span> com.app.reporting<p class="paragraph"/>class AdminController &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> namespace = 'reports'<p class="paragraph"/>    // &#8230;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/com/app/security/AdminController.groovy
<span class="java&#45;keyword">package</span> com.app.security<p class="paragraph"/>class AdminController &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> namespace = 'users'<p class="paragraph"/>    // &#8230;
&#125;</pre></div><p class="paragraph"/>
<div class="code"><pre>// grails&#45;app/conf/UrlMappings.groovy
class UrlMappings &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mappings = &#123;
        '/userAdmin' &#123;
            controller = 'admin'
            namespace = 'users'
        &#125;<p class="paragraph"/>        '/reportAdmin' &#123;
            controller = 'admin'
            namespace = 'reports'
        &#125;<p class="paragraph"/>        <span class="java&#45;quote">"/$namespace/$controller/$action?"</span>()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>&#60;g:link controller=<span class="java&#45;quote">"admin"</span> namespace=<span class="java&#45;quote">"reports"</span>&#62;Click For Report Admin&#60;/g:link&#62;
&#60;g:link controller=<span class="java&#45;quote">"admin"</span> namespace=<span class="java&#45;quote">"users"</span>&#62;Click For User Admin&#60;/g:link&#62;</pre></div><p class="paragraph"/>See the <a href="../guide/single.html#namespacedControllers" class="guide">namespaced controllers</a> docs for more information.<p class="paragraph"/><div class="hidden-block">h4. Command Line </div>
<h4>コマンドライン</h4><p class="paragraph"/><div class="hidden-block">The <code>create-app</code> command will now by default generate the command line grailsw wrapper for newly created applications.  The <code>&#45;&#45;skip-wrapper</code> switch may be used to prevent the wrapper from being generated.</div>
<code>create&#45;app</code> コマンドがデフォルトでgrailswラッパーを生成するようになりました。ラッパーを生成しない場合は <code>&#45;&#45;skip&#45;wrapper</code> オプションを指定してください。<p class="paragraph"/><div class="code"><pre>grails create&#45;app appname &#45;&#45;skip&#45;wrapper</pre></div>



<h2 id="whatsNew22">1.2 Grails 2.2の新機能</h2>
<h4>ネームスペース対応 <div class="hidden-block">Namespace Support </div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.2 includes improved support for managing naming conflicts between artifacts provided by an application and its plugins.</div>
Grails 2.2では、アプリケーションとプラグインで提供するアーテファクト間での名前衝突を回避するための管理機能向上が含まれています。<p class="paragraph"/><div class="hidden-block">
Bean names for Service artifacts provided by a plugin are now prefixed with the plugin name.  For example, if a Service named <code>com.publishing.AuthorService</code> is provided by
a plugin named <code>PublishingUtilities</code> and another Service named <code>com.bookutils.AuthorService</code> is provided by a plugin named <code>BookUtilities</code>, the bean names for those services
will be <code>publishingUtilitiesAuthorService</code> and <code>bookUtilitiesAuthorService</code> respectively.  If a plugin provides a Service that does not have a name which conflicts with any
other Service, then a bean alias will automatically be created that does not contain the prefix and the alias will refer to the bean referenced by the prefixed name.  Service
artifacts provided directly by the application will have no prefix added to the relevant bean name. See the <a href="../guide/single.html#dependencyInjectionServices" class="guide">dependency injection and services</a> docs. 
</div>
プラグインで提供されたサービスアーテファクトビーン名称は、プリフィックスとしてプラグイン名が使用されます。例えば、 <code>PublishingUtilities</code> という名称のプラグインで提供された <code>com.publishing.AuthorService</code> という名称のサービスと、 <code>BookUtilities</code> という名称のプラグインで提供された <code>com.bookutils.AuthorService</code> という名称のサービスが存在した場合、それぞれのビーン名称は、 <code>publishingUtilitiesAuthorService</code> と <code>bookUtilitiesAuthorService</code> になります。
もし他のサービス名称がプラグインが提供したサービスの名称に衝突しない場合は、自動的にプリフィックスの無いビーンエイリアスを生成して、プリフィックスの存在するビーンを参照します。
アプリケーションで直接提供するサービスアーティファクトには、プリフィックスは追加されません。
<a href="../guide/single.html#dependencyInjectionServices" class="guide">依存注入とサービス</a>も参照。<p class="paragraph"/><div class="hidden-block">
Domain classes provided by a plugin will have their default database table name prefixed with the plugin name if the <code>grails.gorm.table.prefix.enabled</code> config property is
set to <code>true</code>. For example, if the <code>PublishingUtilities</code> plugin provides a domain class named <code>Book</code>, the default table name for that domain class will be
<code>PUBLISHING_UTILITIES_BOOK</code> if the <code>grails.gorm.table.prefix.enabled</code> config property is set to <code>true</code>.
</div><p class="paragraph"/>プラグインで提供されたドメインクラスは、 <code>grails.gorm.table.prefix.enabled</code> が <code>true</code> に設定されている場合、テーブル名称にプラグイン名のプリフィックスが追加されます。例として、 <code>PublishingUtilities</code> プラグインが提供した <code>Book</code> とい名称のドメインクラスであれば、テーブル名称が <code>PUBLISHING_UTILITIES_BOOK</code> となります。<p class="paragraph"/><div class="hidden-block">URL Mappings may now include a <code>plugin</code> attribute to indicate that the controller referenced in the mapping is provided by a particular plugin.</div>
URLマッピングには、プラグインが提供したコントローラを参照させるために、 <code>plugin</code> 属性を使用します。
<div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;<p class="paragraph"/>    // requests to /bookAuthors will be handled by the
    // AuthorController provided by the BookUtilities plugin
    <span class="java&#45;quote">"/bookAuthors"</span> &#123;
        controller = 'author'
        plugin = 'bookUtilities'
    &#125;<p class="paragraph"/>    // requests to /publishingAuthors will be handled by the
    // AuthorController provided by the Publishing plugin
    <span class="java&#45;quote">"/publishingAuthors"</span> &#123;
        controller = 'author'
        plugin = 'publishing'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">See the <a href="../guide/single.html#namespacedControllers" class="guide">namespaced controllers</a> docs for more information.</div>
詳しくは <a href="../guide/single.html#namespacedControllers" class="guide">コントローラネームスペース</a> を参照してください。<p class="paragraph"/><div class="hidden-block">
Controller methods and GSP Tags which accept a controller name as a paramater now support an optional parameter indicating 
that the controller is provided by a specific plugin.
</div>
コントローラメソッドとGSPタグにおいても、プラグインが提供したコントローラを参照させるために、 <code>plugin</code> 属性を使用します。<p class="paragraph"/><div class="code"><pre>&#60;g:link controller=<span class="java&#45;quote">"user"</span> plugin=<span class="java&#45;quote">"springSecurity"</span>&#62;Manage Users&#60;/g:link&#62;</pre></div><p class="paragraph"/><div class="code"><pre>class DemoController &#123;
    def index() &#123;
        redirect controller: 'user', action: 'list', plugin: 'springSecurity'
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>フォークされたTomcat実行 <div class="hidden-block">Forked Tomcat Execution </div></h4><p class="paragraph"/><div class="hidden-block">
Grails 2.2 supports forked JVM execution of the Tomcat container in development mode. This has several benefits including:
</div>
Grails 2.2では、開発モードにおいて、Tomcatコンテナを実行するJVMのフォーク実行に対応しました。幾つかの利点は次のようになります:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Reduced memory consumption, since the Grails build system can exit</li>
<li>Isolation of the build classpath from the runtime classpath</li>
<li>The ability to deploy other Grails/Spring applications in parallel without conflicting dependencies</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>Grailsビルドシステムから抜けられるため、メモリーの消耗を減らします。</li>
<li>ランタイムクラスパスから、独立したビルドクラスパス。</li>
<li>依存衝突無く並行して、別のGrails/Springアプリケーションのデプロイを可能にします。</li>
</ul><p class="paragraph"/><div class="hidden-block">
See the <a href="../guide/single.html#forkedMode" class="guide">documentation</a> on using forked mode for more information.
</div>
フォークモードの使用と情報は、 <a href="../guide/single.html#forkedMode" class="guide">ドキュメント</a> を参照してください。<p class="paragraph"/><h4>クライテリアクエリーでのSQLプロジェクション <div class="hidden-block">SQL Projections In Criteria Queries </div></h4>
<div class="hidden-block">
Grails 2.2 adds new functionality to criteria queries to provide access to Hibernate's SQL projection API.
</div>
Grails 2.2から、クライテリアクエリーで、HibernateのSQLプロジェクションAPIにアクセスが可能になりました。<p class="paragraph"/><div class="code"><pre>// Use SQL projections to retrieve the perimeter and area of all of the Box instances&#8230;
def c = Box.createCriteria()<p class="paragraph"/>def results = c.list &#123;
    projections &#123;
      sqlProjection '(2 &#42; (width + height)) as perimiter, (width &#42; height) as area', &#91;'perimeter', 'area'&#93;, &#91;INTEGER, INTEGER&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">See the <a href="../guide/single.html#criteria" class="guide">Criteria</a> section for more information.</div>
詳しくは <a href="../guide/single.html#criteria" class="guide">Criteria</a> を参照<p class="paragraph"/><h4>Groovy 2</h4>
<div class="hidden-block">
Grails 2.2 ships with Groovy 2.0, which has a <a href="http://www.infoq.com/articles/new-groovy-20" target="blank">bunch of new features</a> itself.
</div>
Grails 2.2は、 <a href="http://www.infoq.com/articles/new-groovy-20" target="blank">多くの新機能</a> を提供している、Groovy 2.0を同梱しています。<p class="paragraph"/>


<h2 id="whatsNew21">1.3 Grails 2.1の新機能</h2>
<h4>Maven機能向上 / Maven マルチモジュールビルド対応 <div class="hidden-block">Maven Improvements / Multi Module Build Support</div></h4><p class="paragraph"/><div class="hidden-block">Grails' Maven support has been improved in a number of significant ways. Firstly it is now possible to specify plugins within your <code>pom.xml</code> file:</div>
Grails Maven対応の幾つかの重要な部分が改善されました。初めに、pom.xmlファイルにプラグインを定義できるようになりました:<p class="paragraph"/>
<div class="code"><pre>&#60;dependency&#62;
    &#60;groupId&#62;org.grails.plugins&#60;/groupId&#62;
    &#60;artifactId&#62;hibernate&#60;/artifactId&#62;
    &#60;version&#62;2.1.0&#60;/version&#62;
    &#60;type&#62;zip&#60;/type&#62;
    &#60;scope&#62;compile&#60;/scope&#62;
&#60;/dependency&#62;</pre></div><p class="paragraph"/>The Maven plugin now resolves plugins as well as jar dependencies (previously jar dependencies were resolved by Maven and plugins by Ivy). Ivy is completely disabled leaving all dependency resolution up to Maven ensuring that evictions work as expected.<p class="paragraph"/>There is also a new Grails <code>create-multi-project-build</code> script which features initial support for Maven (Gradle coming in a future release). This script can be run from a parent directory containing Grails applications and plugins and it will generate a Maven multi-module build.<p class="paragraph"/>Enabling Maven in a project has been made easier with the inclusion of the <code>create-pom</code> command:<p class="paragraph"/><div class="code"><pre>grails create&#45;app myapp
cd myapp
grails create&#45;pom com.mycompany
mvn <span class="java&#45;keyword">package</span></pre></div><p class="paragraph"/>To create a multi-module Maven build follow these steps:<p class="paragraph"/><div class="code"><pre>grails create&#45;app myapp
grails create&#45;plugin plugin&#45;a
grails create&#45;plugin plugin&#45;b
grails create&#45;multi&#45;project&#45;build com.mycompany:parent:1.0&#45;SNAPSHOT
mvn install</pre></div><p class="paragraph"/><h4>Grailsラッパー <div class="hidden-block">Grails Wrapper</div></h4><p class="paragraph"/>The Grails Wrapper allows a Grails application to build without having to install Grails and configure a GRAILS_HOME environment variable.  The wrapper includes a small shell script and a couple of small bootstrap jar files that typically would be checked in to source code control along with the rest of the project.  The first time the wrapper is executed it will download and configure a Grails installation.  This wrapper makes it more simple to setup a development environment, configure CI and manage upgrades to future versions of Grails.  When the application is upgraded to the next version of Grails, the wrapper is updated and checked in to the source code control system and the next time developers update their workspace and run the wrapper, they will automatically be using the correct version of Grails.<p class="paragraph"/>See the <a href="../guide/single.html#wrapper" class="guide">Wrapper Documentation</a> for more details.<p class="paragraph"/><h4>デバッグオプション<div class="hidden-block">Debug Option</div></h4><p class="paragraph"/>The <code>grails</code> command now supports a <code>-debug</code> option which will startup the remote debug agent.  This behavior used to be provided by the <code>grails-debug</code> command.  <code>grails-debug</code> is still available but is deprecated and may be removed from a future release.<p class="paragraph"/><div class="code"><pre>grails &#45;debug run&#45;app</pre></div><p class="paragraph"/><h4>Grailsコマンドエイリアス <div class="hidden-block">Grails Command Aliases </div></h4><p class="paragraph"/>The <code>alias</code> command may be used to define aliases for grails commands.<p class="paragraph"/>The following command creates an alias named <code>rit</code> (short for "run integration tests"):<p class="paragraph"/><div class="code"><pre>grails alias rit test&#45;app integration:</pre></div><p class="paragraph"/>See the <a href="../ref/Command Line/alias.html" class="commandLine">alias</a> docs for more info.<p class="paragraph"/><h4> キャッシュプラグイン <div class="hidden-block">Cache Plugin </div></h4><p class="paragraph"/>Grails 2.1 installs the <a href="http://grails.org/plugin/cache" target="blank">cache plugin</a> by default.  This plugin provides powerful and easy to use cache functionality to applications and plugins.  The main plugin provides basic map backed caching support.  For more robust caching options one of the implementation plugins should be installed and configured.  See the <a href="http://grails-plugins.github.com/grails-cache-redis/" target="blank">cache-redis docs</a> and the <a href="http://grails-plugins.github.com/grails-cache-ehcache/" target="blank">cache-ehcache docs</a> for details.<p class="paragraph"/>See <a href="http://grails-plugins.github.com/grails-cache/" target="blank">the main plugin documentation</a> for details on how to configure and use the plugin.<p class="paragraph"/><h4>新たなGORMメソッド <div class="hidden-block">New GORM Methods </div></h4><p class="paragraph"/>In Grails 2.1.1 domain classes now have static methods named <code>first</code> and <code>last</code> to retrieve the first and last instances from the datastore.  See the <a href="../ref/Domain Classes/first.html" class="domainClasses">first</a> and <a href="../ref/Domain Classes/last.html" class="domainClasses">last</a> documentation for details.<p class="paragraph"/>

<a name="1.1 What's new in Grails 2.0?"><!-- Legacy link --></a>
<h2 id="whatsNew">1.4 Grails 2.0の新機能</h2>
<div class="hidden-block">This section covers the new features that are present in 2.0 and is broken down into sections covering the build system, core APIs, the web tier, persistence enhancements and improvements in testing. Note there are many more small enhancements and improvements, these sections just cover some of the highlights.</div>
このセクションでは、現在2.0に存在する新機能、ビルドシステム、コアAPI、Web階層、永続化関連の強化等に分類し掘り下げて紹介します。他にも向上、強化した内容が多数ありますが、ここではハイライト的に紹介してます。


<a name="1.1.1 Development Environment Features"><!-- Legacy link --></a>
<h2 id="developmentEnvironmentFeatures">1.4.1 開発環境機能</h2>
<h4>インタラクティブモードとコンソールの強化 <div class="hidden-block">Interactive Mode and Console Enhancements </div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.0 features brand new console output that is more concise and user friendly to consume. An example of the new output when running tests can be seen below:</div>
Grails 2.0では、より簡潔でユーザフレンドリな、新コンソール出力を実装しました。以下の例はテストを実行した内容です。<p class="paragraph"/><img border="0" class="center" src="../../img/test-output.png"></img><p class="paragraph"/><div class="hidden-block">In general Grails makes its best effort to display update information on a single line and only present the information that is crucial. This means that while in previous versions of Grails the <a href="../ref/Command Line/war.html" class="commandLine">war</a> command produced many lines of output, in Grails 2.0 only 1 line of output is produced:</div>
コマンド実行の際に、重要な情報のみ１行を更新表示するようになりました。例えば、以前のバージョンまでは、warコマンドを実行すると大量のログが表示されていましたが、2.0からは1行だけで表示されます。<p class="paragraph"/><img border="0" class="center" src="../../img/war-output.png"></img><p class="paragraph"/><div class="hidden-block">In addition simply typing 'grails' at the command line activates the new interactive mode which features TAB completion, command history and keeps the JVM running to ensure commands execute much quicker than otherwise</div>
さらに、単にgrailsコマンドをコンソールで実行するだけで、新しいインタラクティブモードが開始され、JVMが起動したままとなりコマンドが迅速に実行でき、タブ補完、コマンド履歴も使用できます。<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-output.png"></img><p class="paragraph"/><div class="hidden-block">For more information on the new features of the console refer to the section of the user guide that covers the <a href="../guide/single.html#interactiveMode" class="guide">console and interactive mode</a>.</div>
詳しい情報は、ユーザガイドのコンソールとインタラクティブモードを参照してください。 <a href="../guide/single.html#interactiveMode" class="guide">インタラクティブモード</a>.<p class="paragraph"/><h4>リロードエージェント <div class="hidden-block">Reloading Agent</div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.0 reloading mechanism no longer uses class loaders, but instead uses a JVM agent to reload changes to class files. This results in greatly improved reliability when reloading changes and also ensures that the class files stored in disk remain consistent with the class files loaded in memory, which reduces the need to run the <a href="../ref/Command Line/clean.html" class="commandLine">clean</a> command.</div>
Grails 2.0からのリロード機能は、クラスローダを使用せずJVMエージェントを使用してクラスファイルのリロードを行います。その結果、変更保存されたクラスが確実にメモリにロードされようになり、変更時のリロードが大いに向上しました。今までより、cleanコマンドの実行回数を減らすことができます。<p class="paragraph"/><h4>新テストレポートとドキュメントテンプレート <div class="hidden-block">New Test Report and Documentation Templates</div></h4><p class="paragraph"/><div class="hidden-block">There are new templates for displaying test results that are clearer and more user friendly than the previous reports:</div>
以前のレポートよりクリーンでユーザフレンドリーなテストリポートテンプレートに変更されました:<p class="paragraph"/><img border="0" class="center" src="../../img/test-template.png"></img><p class="paragraph"/><div class="hidden-block">In addition, the Grails documentation engine has received a facelift with a new template for presenting Grails application and plugin documentation:</div>
さらに、アプリケーションやプラグインで使用する、Grailsドキュメントエンジンのテンプレートもリニューアルされました:<p class="paragraph"/><img border="0" class="center" src="../../img/doc-template.png"></img><p class="paragraph"/><div class="hidden-block">See the section on the <a href="../guide/single.html#docengine" class="guide">documentation engine</a> for more usage info.</div>
詳細はドキュメントエンジンのセクションを参照してください。 <a href="../guide/single.html#docengine" class="guide">プロジェクト・ドキュメント</a><p class="paragraph"/><h4>プロジェクトドキュメントでの目次 <div class="hidden-block">Use a TOC for Project Docs</div></h4><p class="paragraph"/>The old documentation engine relied on you putting section numbers into the gdoc filenames. Although convenient, this effectively made it difficult to restructure your user guide by inserting new chapters and sections. In addition, any such restructuring or renaming of section titles resulted in breaking changes to the URLs.<p class="paragraph"/>You can now use logical names for your gdoc files and define the structure and section titles in a YAML table-of-contents file, as described in the section on the <a href="../guide/single.html#docengine" class="guide">documentation engine</a>. The logical names appear in the URLs, so as long as you don't change those, your URLs will always remain the same no matter how much restructuring or changing of titles you do.<p class="paragraph"/>Grails 2.0 even provides a <a href="../ref/Command Line/migrate-docs.html" class="commandLine">migrate-docs</a> command to aid you in migrating existing gdoc user guides.<p class="paragraph"/><h4>エラーレポートと分析表示の強化 <div class="hidden-block">Enhanced Error Reporting and Diagnosis</div></h4><p class="paragraph"/><div class="hidden-block">Error reporting and problem diagnosis has been greatly improved with a new errors view that analyses stack traces and recursively displays problem areas in your code:</div>
スタックトレース分析、コード内の位置表示など、エラーレポートと分析表示が向上しました:<p class="paragraph"/><img border="0" class="center" src="../../img/errors-view.png"></img><p class="paragraph"/><div class="hidden-block">In addition stack trace filtering has been further enhanced to display only relevant trace information:</div>
そして、さらにスタックトレースフィルターが強化され、関係のあるトレースのみが表示されるようになりました:<p class="paragraph"/><div class="code"><pre>Line | Method
&#45;&#62;&#62;   9 | getValue     in Book.groovy
&#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45; &#45;
|     7 | getBookValue in BookService.groovy
|   886 | runTask . .  in ThreadPoolExecutor.java
|   908 | run          in     ''
^   662 | run . . . .  in <span class="java&#45;object">Thread</span>.java</pre></div><p class="paragraph"/><h4>H2データベースとDBコンソール <div class="hidden-block">H2 Database and Console</div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.0 now uses the H2 database instead of HSQLDB, and enables the H2 database console in development mode (at the URI /dbconsole) so that the in-memory database can be easily queried from the browser:</div>
Grails 2.0では、今までのHSQLDBに代わりH2データベースを使用します。H2データベース付属のコンソール機能を開発モードで有効にしています。(URI /dbconsoleで表示可能) メモリ動作のデータベースでも簡単にブラウザからクエリ実行することができます:<p class="paragraph"/><img border="0" class="center" src="../../img/h2-console.png"></img><p class="paragraph"/><h4>プラグイン使用数等のトラッキング機能 <div class="hidden-block">Plugin Usage Tracking</div></h4><p class="paragraph"/><div class="hidden-block">To enhance community awareness of the most popular plugins an opt-in plugin usage tracking system has been included where users can participate in providing feedback to the plugin community on which plugins are most popular.</div>
どのプラグインが人気があるのか等の情報を収集する。プラグイン使用レポートを収集する機能が実装されました。今後のプラグインサポートや、人気の無いプラグインの今後の努力などに役立てます。<p class="paragraph"/><div class="hidden-block">This will help drive the roadmap and increase support of key plugins while reducing the need to support older or less popular plugins thus helping plugin development teams focus their efforts.</div>
下位互換の対応を減らしている主なプラグインや、人気の無いプラグイン等の開発者が成果を確認して、今後のサポート向上とロードマップの進行を手助けになります。<p class="paragraph"/><h4>依存管理機能改善 <div class="hidden-block">Dependency Resolution Improvements</div></h4><p class="paragraph"/><div class="hidden-block">There are numerous improvements to dependency resolution handling via Ivy including:</div>
Ivyでハンドリングされている依存管理機能に多くの改善をしました:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Grails now makes a best effort to cache the previous resolve and avoid resolving again unless you change <code>BuildConfig.groovy</code>.</li>
<li>Plugins dependencies now appear in the dependency report generated by <code>grails dependency-report</code></li>
<li>Plugins published with the release plugin now publish their transitive plugin dependencies in the generated POM which are later resolved.</li>
<li>It is now possible to customize the ivy cache directory via <code>BuildConfig.groovy</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>Grailsは、 <code>BuildConfig.groovy</code> を変更しない限り前回の依存解決した内容を再解決させないように前回の内容をキャッシュするようになりました。</li>
<li>プラグイン依存関係も <code>grails dependency-report</code> のレポートに現れるようになりました。</li>
<li>release-plugin で発行されたプラグインは、推移的なプラグイン依存をPOMに発行するようになりました。</li>
<li>ivyキャッシュ用ディレクトリを <code>BuildConfig.groovy</code> で変更できます。</li>
</ul><p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    cacheDir <span class="java&#45;quote">"target/ivy&#45;cache"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">* You can change the ivy cache directory for all projects via <code>settings.groovy</code></div>
<ul class="star">
<li><code>settings.groovy</code>に設定することで、全てのプロジェクトのivyキャッシュディレクトリを変更できます。</li>
</ul><p class="paragraph"/><div class="code"><pre>grails.dependency.cache.dir = <span class="java&#45;quote">"$&#123;userHome&#125;/.ivy2/cache"</span></pre></div><p class="paragraph"/><div class="hidden-block">* It is now possible to completely disable resolution from inherited repositories (repositories defined by other plugins):</div>
<ul class="star">
<li>リポジトリの引継を完全に無効にできます(他のプラグインで定義されている場合等):</li>
</ul><p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;<p class="paragraph"/>    repositories &#123;
        inherits <span class="java&#45;keyword">false</span> // Whether to inherit repository definitions from plugins
        &#8230;
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">* It is now possible to easily disable checksum validation errors:</div>
<ul class="star">
<li>チェックサムを無効にできます:</li>
</ul><p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    checksums <span class="java&#45;keyword">false</span> // whether to verify checksums or not
&#125;</pre></div>


<a name="1.1.2 Core Features"><!-- Legacy link --></a>
<h2 id="coreFeatures">1.4.2 コア機能</h2>
<h4>バイナリプラグイン <div class="hidden-block">Binary Plugins </div></h4><p class="paragraph"/><div class="hidden-block">Grails plugins can now be packaged as JAR files and published to standard maven repositories. This even works for GSP and static resources (with resources plugin 1.0.1). See the section on <a href="../guide/single.html#binaryPlugins" class="guide">Binary plugins</a> for more information.</div>
Grailsプラグインは、JARファイルとしてパッケージして、Mavenリポジトリへ発行できるようになりました。GSPや静的リソースでも可能です。詳しくは、 <a href="../guide/single.html#binaryPlugins" class="guide">バイナリプラグイン</a>  のセクションを参考にしてください。<p class="paragraph"/><h4>Groovy 1.8 <div class="hidden-block">Groovy 1.8 </div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.0 comes with Groovy 1.8 which includes many new <a href="http://docs.codehaus.org/display/GROOVY/Groovy+1.8+release+notes" target="blank">features and enhancements</a></div>
Grails 2.0は、多くの新機能と向上をしたGroovy 1.8がバンドルされています。 <a href="http://docs.codehaus.org/display/GROOVY/Groovy+1.8+release+notes" target="blank">Groovy 1.8 リリースノート</a><p class="paragraph"/><h4>Spring 3.1 プロファイルサポート <div class="hidden-block">Spring 3.1 Profile Support </div></h4><p class="paragraph"/><div class="hidden-block">Grails' existing environment support has been bridged into the Spring 3.1 profile support. For example when running with a custom Grails environment called "production", a Spring profile of "production" is activated so that you can use Spring's bean configuration APIs to configure beans for a specific profile.</div>
Grailsの環境サポートがSpring 3.1プロフィールサポートとブリッジできます。例えば、Grailsの環境で"production"で動作している場合、Springプロフィール"production"がアクティベートされます。これによって、Springビーン定義APIでのビーン定義でプロフィールを指定できます。

<a name="1.1.3 Web Features"><!-- Legacy link --></a>
<h2 id="webFeatures">1.4.3 Web機能</h2>
<h4>コントローラのアクションにメソッドを利用 <div class="hidden-block">Controller Actions as Methods</div></h4><p class="paragraph"/><div class="hidden-block">It is now possible to define controller actions as methods instead of using closures as in previous versions of Grails. In fact this is now the preferred way of expressing an action. For example:</div>
以前のクロージャで記述していたコントローラアクションをメソッドで記述可能になりました。これからはメソッド記述を推奨します。:<p class="paragraph"/><div class="hidden-block">
// action as a method
// action as a closure
</div>
<div class="code"><pre>// メソッドのアクション (action as a method)
def index() &#123;<p class="paragraph"/>&#125;
// クロージャのアクション (action as a closure)
def index = &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><h4>アクションに引数を指定してバインド <div class="hidden-block">Binding Primitive Method Action Arguments</div></h4><p class="paragraph"/><div class="hidden-block">It is now possible to bind form parameters to action arguments where the name of the form element matches the argument name. For example given the following form:</div>
フォームエレメントのname属性を、アクションメソッドの引数に指定する方法でのバインドが可能になりました。 次のようなフォームを例に:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:form name=<span class="xml&#45;quote">"myForm"</span> action=<span class="xml&#45;quote">"save"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;input name=<span class="xml&#45;quote">"name"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;input name=<span class="xml&#45;quote">"age"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/g:form&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">You can define an action that declares arguments for each input and automatically converts the parameters to the appropriate type:</div>
以下のように、それぞれを引数として定義、パラメータの型も自動で適した型に変換します:<p class="paragraph"/><div class="code"><pre>def save(<span class="java&#45;object">String</span> name, <span class="java&#45;object">int</span> age) &#123;
    // remaining
&#125;</pre></div><p class="paragraph"/><h4>静的リソース抽象化 <div class="hidden-block">Static Resource Abstraction</div></h4><p class="paragraph"/><div class="hidden-block">A new <a href="../guide/single.html#resources" class="guide">static resource abstraction</a> is included that allows declarative handling of JavaScript, CSS and image resources including automatic ordering, compression, caching and gzip handling.</div>
JavaScript、CSS、画像などのリソースを管理、圧縮、キャッシュ、gzipを行う <a href="../guide/single.html#resources" class="guide">静的リソース抽象化機能</a> が追加されました。<p class="paragraph"/><h4>サーブレット3.0の非同期処理 <div class="hidden-block">Servlet 3.0 Async Features</div></h4><p class="paragraph"/><div class="hidden-block">Grails now supports Servlet 3.0 including the Asynchronous programming model defined by the specification:</div>
Grailsはサーブレット3.0をサポートしました。サーブレット3.0での機能、非同期処理が使用可能です:<p class="paragraph"/><div class="code"><pre>def index() &#123;
    def ctx = startAsync()
    ctx.start &#123;
        <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Stand"</span>).save()
        render template:<span class="java&#45;quote">"books"</span>, model:&#91;books:Book.list()&#93;
        ctx.complete()
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>リンク生成API <div class="hidden-block">Link Generation API</div></h4><p class="paragraph"/><div class="hidden-block">A general purpose <code>LinkGenerator</code> class is now available that is usable anywhere within a Grails application and not just within the context of a controller. For example if you need to generate links in a service or an asynchronous background job outside the scope of a request:</div>
全面的に使用可能なリンク生成API <code>LinkGenerator</code> クラスが追加されました。コントローラのコンテキスト以外のどこからでも使用できます。例としてサービス、バックグラウンド処理、非同期タスク、リクエスト以外の場所でリンクが生成できます。<p class="paragraph"/><div class="code"><pre>LinkGenerator grailsLinkGenerator<p class="paragraph"/>def generateLink() &#123;
    grailsLinkGenerator.link(controller:<span class="java&#45;quote">"book"</span>, action:<span class="java&#45;quote">"list"</span>)
&#125;</pre></div><p class="paragraph"/><h4>ページレンダリングAPI <div class="hidden-block">Page Rendering API</div></h4><p class="paragraph"/><div class="hidden-block">Like the <code>LinkGenerator</code> the new <code>PageRenderer</code> can be used to render GSP pages outside the scope of a web request, such as in a scheduled job or web service. The <code>PageRenderer</code> class features a very similar API to the <code>render</code> method found within controllers:</div>
<code>LinkGenerator</code> と同じく新規に追加されたAPI、 <code>PageRenderer</code> は、Webリクエスト以外の場所で、GSPページが描写可能です。例えば、Webサービス、スケジュールジョブなどで使用します。 <code>PageRenderer</code> サービスはコントローラの <code>render</code> メソッドと同じように使用します。<p class="paragraph"/><div class="code"><pre>grails.gsp.PageRenderer groovyPageRenderer<p class="paragraph"/>void welcomeUser(User user) &#123;
    def contents = groovyPageRenderer.render(view:<span class="java&#45;quote">"/emails/welcomeLetter"</span>, model:&#91;user: user&#93;)
    sendEmail &#123;
        to user.email
        body contents
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>PageRenderer</code> service also allows you to pre-process GSPs into HTML templates:</div>
<code>PageRenderer</code> sサービスはGSPからHTMLを生成するのも可能です。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/path/to/welcome.html"</span>).withWriter &#123; w &#45;&#62;
    groovyPageRenderer.renderTo(view:<span class="java&#45;quote">"/page/content"</span>, w)
&#125;</pre></div><p class="paragraph"/><h4>フィルター除外機能 <div class="hidden-block">Filter Exclusions</div></h4><p class="paragraph"/><div class="hidden-block">Filters may now express controller, action and uri exclusions to offer more options for expressing to which requests a particular filter should be applied.</div>
フィルターでのコントローラ・アクション・URIの除外指定が実装されました。<p class="paragraph"/><div class="code"><pre>filter1(actionExclude: 'log&#42;') &#123;
    before = &#123;
        // …
    &#125;
&#125;
filter2(controllerExclude: 'auth') &#123;
    before = &#123;
        // …
    &#125;
&#125;<p class="paragraph"/>filter3(uriExclude: '/secure&#42;') &#123;
    before = &#123;
        // …
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>パフォーマンスの向上 <div class="hidden-block">Performance Improvements</div></h4><p class="paragraph"/><div class="hidden-block">Performance of GSP page rendering has once again been improved by optimizing the GSP compiler to inline method calls where possible.</div>
再度最適化したGSPコンパイラでGSPのパフォーマンスはさらに向上しました。<p class="paragraph"/><h4>HTML5スカッフォルド <div class="hidden-block">HTML5 Scaffolding</div></h4><p class="paragraph"/><div class="hidden-block">There is a new HTML5-based scaffolding UI:</div>
HTML5ベースのスカッフォールドUIになりました:<p class="paragraph"/><img border="0" class="center" src="../../img/scaffolding-ui.png"></img><p class="paragraph"/><h4>jQueryがデフォルトになりました <div class="hidden-block">jQuery by Default</div></h4><p class="paragraph"/><div class="hidden-block">The jQuery plugin is now the default JavaScript library installed into a Grails application. For backwards compatibility a <a href="http://grails.org/plugin/prototype" target="blank">Prototype plugin</a> is available. Refer to the <a href="http://grails.org/plugin/prototype" target="blank">documentation</a> on the Prototype plugin for installation instructions.</div>
jQueryプラグインがデフォルトのJavaScriptライブラリとしてGrailsアプリケーションにインストールされます。 下位互換として、Prototypeはプラグインとして提供しています。 Prototypeついてはプラグインのドキュメントを参考にしてください。 <a href="http://grails.org/plugin/prototype" target="blank">Prototype plugin</a><p class="paragraph"/><h4>簡単な日付解析 <div class="hidden-block">Easy Date Parsing</div></h4><p class="paragraph"/><div class="hidden-block">A new <code>date</code> method has been added to the <code>params</code> object to allow easy, null-safe parsing of dates:</div>
<code>params</code>オブジェクトのnullセーフメソッドに日付用の<code>date</code>が追加されました。
<div class="code"><pre>def val = params.date('myDate', 'dd&#45;MM&#45;yyyy')<p class="paragraph"/>// or a list <span class="java&#45;keyword">for</span> formats
def val = params.date('myDate', &#91;'yyyy&#45;MM&#45;dd', 'yyyyMMdd', 'yyMMdd'&#93;)<p class="paragraph"/>// or the format read from messages.properties via the key 'date.myDate.format'
def val = params.date('myDate')</pre></div><p class="paragraph"/><h4>URLフォーマットのカスタマイズ</h4><p class="paragraph"/>The default URL Mapping mechanism supports camel case names in the URLs.  The default URL for accessing an action named <code>addNumbers</code> in a controller named <code>MathHelperController</code> would be something like <code>/mathHelper/addNumbers</code>.  Grails allows for the customization of this pattern and provides an implementation which replaces the camel case convention with a hyphenated convention that would support URLs like <code>/math-helper/add-numbers</code>.  To enable hyphenated URLs assign a value of "hyphenated" to the <code>grails.web.url.converter</code> property in <code>grails-app/conf/Config.groovy</code>.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/Config.groovy<p class="paragraph"/>grails.web.url.converter = 'hyphenated'</pre></div><p class="paragraph"/>Arbitrary strategies may be plugged in by providing a class which implements the <a href="http://grails.org/doc/latest/api/grails/web/UrlConverter.html" class="api">UrlConverter</a> interface and adding an instance of that class to the Spring application context with the bean name of <code>grails.web.UrlConverter.BEAN_NAME</code>.  If Grails finds a bean in the context with that name, it will be used as the default converter and there is no need to assign a value to the <code>grails.web.url.converter</code> config property.<p class="paragraph"/><div class="code"><pre>// src/groovy/com/myapplication/MyUrlConverterImpl.groovy<p class="paragraph"/><span class="java&#45;keyword">package</span> com.myapplication<p class="paragraph"/>class MyUrlConverterImpl <span class="java&#45;keyword">implements</span> grails.web.UrlConverter &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> toUrlElement(<span class="java&#45;object">String</span> propertyOrClassName) &#123;
        // <span class="java&#45;keyword">return</span> some representation of a property or class name that should be used in URLs&#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy<p class="paragraph"/>beans = &#123;
    <span class="java&#45;quote">"$&#123;grails.web.UrlConverter.BEAN_NAME&#125;"</span>(com.myapplication.MyUrlConverterImpl)
&#125;</pre></div><p class="paragraph"/><h4>Webフローのインプットとアウトプット <div class="hidden-block">Web Flow input and output</div></h4>
<div class="hidden-block">It is now possible to provide input arguments when calling a subflow. Flows can also return output values that can be used in a calling flow.</div>
subflowを呼ぶ際にinput引数の提供が可能になりました。またフローは、フローを呼び出す際に使用するoutput値を返す事ができます。<p class="paragraph"/>

<a name="1.1.4 Persistence Features"><!-- Legacy link --></a>
<h2 id="persistenceFeatures">1.4.4 永続化機能</h2>
<h4>GORM API <div class="hidden-block">The GORM API</div></h4><p class="paragraph"/><div class="hidden-block">The GORM API has been formalized into a set of classes (<code>GormStaticApi</code>, <code>GormInstanceApi</code> and <code>GormValidationApi</code>) that get statically wired into every domain class at the byte code level. The result is better code completion for IDEs, better integration with Java and the potential for more GORM implementations for other types of data stores.</div>
GORM APIは、 <code>GormStaticApi</code> 、 <code>GormInstanceApi</code> 、 <code>GormValidationApi</code> というクラスに置き換えられたことによって、全てのドメインのバイトコードレベルに注入されます。この実装でIDEでのコード補完、Javaとの統合、様々なデータストアへのGORM実装への可能性が向上しました。<p class="paragraph"/><h4>DetachedクライテリアとWhereクエリー <div class="hidden-block">Detached Criteria and Where Queries</div></h4><p class="paragraph"/>Grails 2.0 features support for <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> which are criteria queries that are not associated with any session or connection and thus can be more easily reused and composed:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
def results = criteria.list(max:4, sort:<span class="java&#45;quote">"firstName"</span>)</pre></div><p class="paragraph"/>To support the addition of <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> queries and encourage their use a new <code>where</code> method and DSL has been introduced to greatly reduce the complexity of criteria queries:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    (lastName != <span class="java&#45;quote">"Simpson"</span> &#38;&#38; firstName != <span class="java&#45;quote">"Fred"</span>) || (firstName == <span class="java&#45;quote">"Bart"</span> &#38;&#38; age &#62; 9)
&#125;
def results = query.list(sort:<span class="java&#45;quote">"firstName"</span>)</pre></div><p class="paragraph"/>See the documentation on <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> and <a href="../guide/single.html#whereQueries" class="guide">Where Queries</a> for more information.<p class="paragraph"/><h4>新findOrCreateとfindOrSaveメソッド <div class="hidden-block">New findOrCreate and findOrSave Methods</div></h4><p class="paragraph"/><div class="hidden-block">Domain classes have support for the findOrCreateWhere, findOrSaveWhere, findOrCreateBy and findOrSaveBy query methods which behave just like findWhere and findBy methods except that they should never return null. If a matching instance cannot be found in the database then a new instance is created, populated with values represented in the query parameters and returned. In the case of findOrSaveWhere and findOrSaveBy, the instance is saved before being returned.</div>
ドメインクラスに、findWhereやfindByメソッドに似た、nullを返さない、findOrCreateWhere, findOrSaveWhere, findOrCreateBy, findOrSaveByのクエリーをサポートしました。実行結果にインスタンスが見つからない場合は、指定された値で、新規にインスタンスを作成して返します。findOrSaveWhereとfindOrSaveByの場合はインスタンスを保存してからインスタンスを返します。<p class="paragraph"/><div class="code"><pre>def book = Book.findOrCreateWhere(author: 'Douglas Adams', title: <span class="java&#45;quote">"The Hitchiker's Guide To The Galaxy"</span>)
def book = Book.findOrSaveWhere(author: 'Daniel Suarez', title: 'Daemon')
def book = Book.findOrCreateByAuthorAndTitle('Daniel Suarez', 'Daemon')
def book = Book.findOrSaveByAuthorAndTitle('Daniel Suarez', 'Daemon')</pre></div><p class="paragraph"/><h4>抽象クラス継承のサポート <div class="hidden-block">Abstract Inheritance</div></h4><p class="paragraph"/><div class="hidden-block">GORM now supports abstract inheritance trees which means you can define queries and associations linking to abstract classes:</div>
GORMが抽象クラス継承階層をサポートしました。これによって、関連リンクやクエリ等を抽象クラスに定義することができます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">abstract</span> class Media &#123;
    <span class="java&#45;object">String</span> title
    …
&#125;
class Book <span class="java&#45;keyword">extends</span> Media &#123;
&#125;
class Album <span class="java&#45;keyword">extends</span> Media &#123;<p class="paragraph"/>&#125;
class Account &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;purchasedMedia:Media&#93;
&#125;<p class="paragraph"/>..<p class="paragraph"/>def allMedia = Media.list()</pre></div><p class="paragraph"/><h4>複数データソースサポート <div class="hidden-block">Multiple Data Sources Support</div></h4><p class="paragraph"/><div class="hidden-block">It is now possible to define multiple datasources in <code>DataSource.groovy</code> and declare one or more datasources a particular domain uses by default:</div>
DataSource.groovyに複数データソースの定義が可能になり、特定のドメインに複数のデータソースが設定できます:<p class="paragraph"/><div class="code"><pre>class ZipCode &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> code<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      datasource 'ZIP_CODES'
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If multiple datasources are specified for a domain then you can use the name of a particular datasource as a namespace in front of any regular GORM method:</div>
複数のデータソースを定義したドメインでは、GORMメソッドの前にネームスペースとしてデータソース名を定義することで特定した実行が可能です:<p class="paragraph"/><div class="code"><pre>def zipCode = ZipCode.auditing.get(42)</pre></div><p class="paragraph"/><div class="hidden-block">For more information see the section on <a href="../guide/single.html#multipleDatasources" class="guide">Multiple Data Sources</a> in the user guide.</div>
詳しくは <a href="../guide/single.html#multipleDatasources" class="guide">複数データソース</a> を参照してください。<p class="paragraph"/><h4>データベースマイグレーション <div class="hidden-block">Database Migrations</div></h4><p class="paragraph"/><div class="hidden-block">A new <a href="http://grails.org/plugin/database-migration" target="blank">database migration plugin</a> has been designed and built for Grails 2.0 allowing you to apply migrations to your database, rollback changes and diff your domain model with the current state of the database.</div>
データベースマイグレーションを行うプラグインが、Grails 2.0用にデザイン構築されました。現行の状況との違いや、変更のロールバックがデータベースマイグレーションで可能になります。 <a href="http://grails.org/plugin/database-migration" target="blank">database migration plugin</a><p class="paragraph"/><h4>データベースリバースエンジニアリング <div class="hidden-block">Database Reverse Engineering</div></h4><p class="paragraph"/><div class="hidden-block">A new <a href="http://www.grails.org/plugin/db-reverse-engineer" target="blank">database reverse engineering</a> plugin has been designed and built for Grails 2.0 that allows you to generate a domain model from an existing database schema.</div>
データベースリバースエンジニアリングを行うプラグインが、Grails 2.0用にデザイン構築されました。既存のデータベーススキーマからドメインクラスを生成可能とします。 <a href="http://www.grails.org/plugin/db-reverse-engineer" target="blank">database reverse engineering</a><p class="paragraph"/><h4>Hibernate 3.6 <div class="hidden-block">Hibernate 3.6</div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.0 is now built on Hibernate 3.6</div>
Grails 2.0では、Hibernate 3.6を使用しています。<p class="paragraph"/><h4>Bagコレクション <div class="hidden-block">Bag Collections</div></h4><p class="paragraph"/><div class="hidden-block">You can now use Hibernate <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/collections.html" target="blank">Bag</a>s for mapped collections to avoid the memory and performance issues of loading large collections to enforce <code>Set</code> uniqueness or <code>List</code> order.</div>
SetのユニークまたはListの順序必要としない場合でにおいて、大きなコレクションロードのメモリーとパフォーマンス問題を回避できるコレクションマッピング、Hibernate <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/collections.html" target="blank">Bag</a>が使用できるようになりました。<p class="paragraph"/><div class="hidden-block">For more information see the section on <a href="../guide/single.html#sets,ListsAndMaps" class="guide">Sets, Lists and Maps</a> in the user guide.</div>
詳しくは <a href="../guide/single.html#sets,ListsAndMaps" class="guide">セット、リスト、マップ</a> を参照してください。<p class="paragraph"/>

<a name="1.1.5 Testing Features"><!-- Legacy link --></a>
<h2 id="testingFeatures">1.4.5 テスト機能</h2>
<h4>新ユニットテストのコンソール出力 <div class="hidden-block">New Unit Testing Console Output</div></h4><p class="paragraph"/><div class="hidden-block">Test output from the test-app command has been improved:</div>
test-app実行時のテストコンソール出力が向上しました:<p class="paragraph"/><img border="0" class="center" src="../../img/test-output.png"></img><p class="paragraph"/><h4>新しいユニットテストAPI <div class="hidden-block">New Unit Testing API</div></h4><p class="paragraph"/><div class="hidden-block">There is a new unit testing API based on mixins that supports JUnit 3, 4 and Spock style tests (with Spock 0.6 and above). Example:</div>
JUnit3,4,Spock(Spock 0.6以上)のテストに対応した、Mixinsベースの新しユニットテストAPIが追加されました:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.TestFor<p class="paragraph"/>@TestFor(SimpleController)
class SimpleControllerTests  &#123;
    void testIndex() &#123;
        controller.home()<p class="paragraph"/>        assert view == <span class="java&#45;quote">"/simple/homePage"</span>
        assert model.title == <span class="java&#45;quote">"Hello World"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <a href="../guide/single.html#testing" class="guide">documentation on testing</a> has also been re-written around this new framework.</div>
テストのドキュメントが、この新しいフレームワークのために書き直されました。詳細は <a href="../guide/single.html#testing" class="guide">テストのドキュメント</a> を参照してください。<p class="paragraph"/><h4>GORMのユニットテスト <div class="hidden-block">Unit Testing GORM</div></h4><p class="paragraph"/><div class="hidden-block">A new in-memory GORM implementation is present that supports many more features of the GORM API making unit testing of criteria queries, named queries and other previously unsupported methods possible.</div>
メモリ上で動作するGORM実装により、今までにサポートされていなかった、クライテリアクエリ、名前付きクエリなど、様々なGORM APIのテストがユニットテストで可能になりました。<p class="paragraph"/><h4>インタラクティブモードで快速なユニットテストを <div class="hidden-block">Faster Unit Testing with Interactive Mode</div></h4><p class="paragraph"/><div class="hidden-block">The new interactive mode (activated by typing 'grails') greatly improves the execution time of running unit and integration tests.</div>
'grails'と入力するだけで実行できるインタラクティブモードでのユニットテスト・統合テストの実行速度が向上しました。<p class="paragraph"/><h4>Unit Test スカッフォルド <div class="hidden-block">Unit Test Scaffolding</div></h4><p class="paragraph"/><div class="hidden-block">A unit test is now generated for scaffolded controllers</div>
スカッフォルドされたコントローラのユニットテストが生成されるようになりました。

<a name="2. Getting Started"><!-- Legacy link --></a>
<h1 id="gettingStarted">2 スタートガイド</h1>



<h2 id="requirements">2.1 インストール必要条件</h2>
<div class="hidden-block">Before installing Grails you will need as a minimum a Java Development Kit (JDK) installed version 1.6 or above. Download the appropriate JDK for your operating system, run the installer, and then set up an environment variable called <code>JAVA_HOME</code> pointing to the location of this installation. If you're unsure how to do this, we recommend the video installation guides from <a href="http://www.grailsexample.net/" target="blank">grailsexample.net</a>:</div>
Grailsをインストールする前に、Java Development Kit (JDK) 1.6以上がインストール済みで、<code>JAVA_HOME</code>が指定されている必要があります。一部のプラットフォームでは(OS Xの例で言うと)、自動的にJavaのインストール先を認識します。手動で定義する場合等、必要に応じて次のようにJavaの設定を行ってください。方法がわからない場合は、コチラの動画も参考にしてください。<a href="http://www.grailsexample.net/" target="blank">grailsexample.net</a>
<ul class="star">
<li><a href="http://www.grailsexample.net/installing-a-grails-development-environment-on-windows/" target="blank">Windows</a></li>
<li><a href="http://www.grailsexample.net/installing-a-grails-development-environment-on-linux/" target="blank">Linux</a></li>
<li><a href="http://www.grailsexample.net/installing-a-grails-development-environment-on-os-x/" target="blank">Mac OS X</a></li>
</ul><p class="paragraph"/><div class="hidden-block">These will show you how to install Grails too, not just the JDK.</div>
これらの動画は、JDKのセットアップのみではなく、Grailsのインストールまで解説しています。<p class="paragraph"/><blockquote class="note">
A JDK is required in your Grails development environment. A JRE is not sufficient.
</blockquote><p class="paragraph"/><div class="hidden-block">On some platforms (for example OS X) the Java installation is automatically detected. However in many cases you will want to manually configure the location of Java. For example:</div>
一部のOS環境(OSX等)では、自動的にJavaが認識されます。別途設定したい場合は、次のように設定してください:<p class="paragraph"/><div class="code"><pre>export JAVA_HOME=/Library/Java/Home
export PATH=<span class="java&#45;quote">"$PATH:$JAVA_HOME/bin"</span></pre></div><p class="paragraph"/><div class="hidden-block">if you're using bash or another variant of the Bourne Shell.</div>
Bashやその他のBourne Shellでの例です。

<a name="2.1 Downloading and Installing"><!-- Legacy link --></a>
<h2 id="downloadingAndInstalling">2.2 ダウンロードとインストール</h2>
<div class="hidden-block">The first step to getting up and running with Grails is to install the distribution. To do so follow these steps:</div>
まず最初にGrailsをインストールすることから始めましょう。手順は次のようになります:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><a href="http://grails.org/Download" target="blank">Download</a> a binary distribution of Grails and extract the resulting zip file to a location of your choice</li>
<li>Set the GRAILS_HOME environment variable to the location where you extracted the zip</li>
<ul class="star">
<li>On Unix/Linux based systems this is typically a matter of adding something like the following <code>export GRAILS_HOME=/path/to/grails</code> to your profile</li>
<li>On Windows this is typically a matter of setting an environment variable under <code>My Computer/Advanced/Environment Variables</code></li>
</ul>
<li>Then add the <code>bin</code> directory to your <code>PATH</code> variable:</li>
<ul class="star">
<li>On Unix/Linux based systems this can be done by adding <code>export PATH="$PATH:$GRAILS_HOME/bin"</code> to your profile</li>
<li>On Windows this is done by modifying the <code>Path</code> environment variable under <code>My Computer/Advanced/Environment Variables</code></li>
</ul></ul><p class="paragraph"/></div>
<ul class="star">
<li>Grailsを<a href="http://grails.org/Download" target="blank">ダウンロード</a>し、任意の場所にzipファイルを解凍します。</li>
<li>zipファイルを解凍した場所にGRAILS_HOME環境変数を設定します。</li>
<ul class="star">
<li>Unix/Linuxベースのシステムでは、次のようなものをプロファイル（.profileなど）に追加します。<code>export GRAILS_HOME=/path/to/grails</code></li>
<li>Windowsでは、マイコンピュータ＞詳細＞環境変数に設定します。</li>
</ul>
<li>さらに、<code>PATH</code>変数に<code>bin</code>ディレクトリを追加する必要があります。</li>
<ul class="star">
<li>Unix/Linuxベースのシステムでは、このように設定します。<code>export PATH="$PATH:$GRAILS_HOME/bin"</code></li>
<li>Windowsでは、マイコンピュータ＞詳細＞環境変数の<code>Path</code>に%GRAILS_HOME%&#98;inを追加します。</li>
</ul></ul><p class="paragraph"/><div class="hidden-block">If Grails is working correctly you should now be able to type <code>grails -version</code> in the terminal window and see output similar to this:</div>
ターミナルで<code>grails</code>と入力し実行することで下記のような出力がされれば、Grailsが正常に動作しています:<p class="paragraph"/><pre class="bq"><code>
Grails version: 2.0.0</code></pre><p class="paragraph"/>

<a name="2.3 Creating an Application"><!-- Legacy link --></a>
<h2 id="creatingAnApplication">2.3 アプリケーション作成</h2>
<div class="hidden-block">To create a Grails application you first need to familiarize yourself with the usage of the <code>grails</code> command which is used in the following manner:</div>
Grailsアプリケーションを作成する前に、基本的な<code>grails</code>コマンドの使用法に慣れておきましょう。<p class="paragraph"/><div class="hidden-block">
grails command name
</div>
<div class="code"><pre>grails &#91;コマンド名&#93;</pre></div><p class="paragraph"/><div class="hidden-block">Run <a href="../ref/Command Line/create-app.html" class="commandLine">create-app</a> to create an application:</div>
アプリケーションを作成するコマンドは<a href="../ref/Command Line/create-app.html" class="commandLine">create-app</a>です。<p class="paragraph"/><pre class="bq"><code>
grails create-app helloworld</code></pre><p class="paragraph"/><div class="hidden-block">This will create a new directory inside the current one that contains the project. Navigate to this directory in your console:</div>
このコマンドを実行することにより、現在のディレクトリ内にプロジェクトが含まれる新しいディレクトリが作成されます。コンソールで、このディレクトリに移動してください。<p class="paragraph"/><pre class="bq"><code>
cd helloworld</code></pre><p class="paragraph"/>

<a name="2.4 A Hello World Example"><!-- Legacy link --></a>
<h2 id="aHelloWorldExample">2.4 ハローワールド例</h2>
Let's now take the new project and turn it into the classic "Hello world!" example. First, change into the "helloworld" directory you just created and start the Grails interactive console:<p class="paragraph"/><pre class="bq"><code>
$ cd helloworld
$ grails</code></pre><p class="paragraph"/>You should see a prompt that looks like this:<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-helloworld.png"></img><p class="paragraph"/>What we want is a simple page that just prints the message "Hello World!" to the browser. In Grails, whenever you want a new page you just create a new controller action for it. Since we don't yet have a controller, let's create one now with the <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a> command:<p class="paragraph"/><pre class="bq"><code>
grails&#62; create-controller hello</code></pre><p class="paragraph"/>Don't forget that in the interactive console, we have auto-completion on command names. So you can type "cre" and then press &#60;tab&#62; to get a list of all <code>create&#45;&#42;</code> commands. Type a few more letters of the command name and then &#60;tab&#62; again to finish.<p class="paragraph"/>The above command will create a new <a href="../guide/single.html#controllers" class="guide">controller</a> in the <code>grails-app/controllers/helloworld</code> directory called <code>HelloController.groovy</code>. Why the extra <code>helloworld</code> directory? Because in Java land, it's strongly recommended that all classes are placed into packages, so Grails defaults to the application name if you don't provide one. The reference page for <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a> provides more detail on this.<p class="paragraph"/>We now have a controller so let's add an action to generate the "Hello World!" page. The code looks like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> helloworld<p class="paragraph"/>class HelloController &#123;<p class="paragraph"/>    def index() &#123;
        render <span class="java&#45;quote">"Hello World!"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The action is simply a method. In this particular case, it calls a special method provided by Grails to <a href="../ref/Tags/render.html" class="tags">render</a> the page.<p class="paragraph"/>Job done. To see your application in action, you just need to start up a server with another command called <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>:<p class="paragraph"/><pre class="bq"><code>
grails&#62; run-app</code></pre><p class="paragraph"/>This will start an embedded server on port 8080 that hosts your application. You should now be able to access your application at the URL <a href="http://localhost:8080/helloworld/" target="blank">http://localhost:8080/helloworld/</a> - try it!<p class="paragraph"/><blockquote class="note">
If you see the error "Server failed to start for port 8080: Address already in use", then it means another server is running on that port. You can easily work around this by running your server on a different port using <code>-Dserver.port=9090 run-app</code>. '9090' is just an example: you can pretty much choose anything within the range 1024 to 49151.
</blockquote><p class="paragraph"/>The result will look something like this:<p class="paragraph"/><img border="0" class="center" src="../../img/intropage.png"></img><p class="paragraph"/>This is the Grails intro page which is rendered by the <code>grails-app/view/index.gsp</code> file. It detects the presence of your controllers and provides links to them. You can click on the "HelloController" link to see our custom page containing the text "Hello World!". Voila! You have your first working Grails application.<p class="paragraph"/>One final thing: a controller can contain many actions, each of which corresponds to a different page (ignoring AJAX at this point). Each page is accessible via a unique URL that is composed from the controller name and the action name: /&#60;appname&#62;/&#60;controller&#62;/&#60;action&#62;. This means you can access the Hello World page via <a href="http://localhost:8080/helloworld/hello/index" target="blank">/helloworld/hello/index</a>, where 'hello' is the controller name (remove the 'Controller' suffix from the class name and lower-case the first letter) and 'index' is the action name. But you can also access the page via the same URL without the action name: this is because 'index' is the  <em class="italic">default action</em> . See the end of the <a href="../guide/single.html#understandingControllersAndActions" class="guide">controllers and actions</a> section of the user guide to find out more on default actions.<p class="paragraph"/>


<h2 id="usingInteractiveMode">2.5 インタラクティブモードの利用</h2>
<div class="hidden-block">Grails 2.0 features an interactive mode which makes command execution faster since the JVM doesn't have to be restarted for each command. To use interactive mode simple type 'grails' from the root of any projects and use TAB completion to get a list of available commands. See the screenshot below for an example:</div>
Grails 2.0では、コマンドの起動を速くするために、コマンド毎にJVMに再起動が必要無いインタラクティブモードを提供しています。インタラクティブモードを使用するには、プロジェクトルートで単に'grails'と入力するだけです。使用可能なコマンドをタブ補完することもできます。例としてスクリーンショットを参照してください:<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-output.png"></img><p class="paragraph"/><div class="hidden-block">For more information on the capabilities of interactive mode refer to the section on <a href="../guide/single.html#interactiveMode" class="guide">Interactive Mode</a> in the user guide.</div>
さらなるインタラクティブモードの能力と情報に関しては、ユーザガイドの<a href="../guide/single.html#interactiveMode" class="guide">インタラクティブモード</a>セクションを参照してください。

<a name="2.5 Getting Set-up in an IDE"><!-- Legacy link --></a>
<h2 id="ide">2.6 IDEの設定</h2>
<h4>IntelliJ IDEA</h4><p class="paragraph"/><div class="hidden-block"><a href="http://www.jetbrains.com/idea" target="blank">IntelliJ IDEA</a> and the <a href="http://www.jetbrains.net/confluence/display/GRVY/Groovy+Home" target="blank">JetGroovy</a> plugin offer good support for Groovy and Grails developers. Refer to the section on <a href="http://www.jetbrains.com/idea/features/groovy_grails.html" target="blank">Groovy and Grails</a> support on the JetBrains website for a feature overview.</div>
<a href="http://www.jetbrains.com/idea" target="blank">IntelliJ IDEA</a>と<a href="http://www.jetbrains.net/confluence/display/GRVY/Groovy+Home" target="blank">JetGroovy</a>プラグインは、Groovy＆Grailsの開発者に十分な機能を提供します。機能概要については、JetBrainsのウェブサイトの<a href="http://www.jetbrains.com/idea/features/groovy_grails.html" target="blank">Groovy and Grails</a>を参照してください。<p class="paragraph"/><div class="hidden-block">IntelliJ IDEA comes in two flavours; the open source "Community Edition" and the commercial "Ultimate Edition".</div>
IntelliJ IDEAには、オープンソース版の"Community Edition"と商用版の"Ultimate Edition"という2種類のバージョンが存在します
<div class="hidden-block">Both offers support for Groovy, but only Ultimate Edition offers Grails support.</div>
両方Groovyをサポートしていますが、Grailsは、"Ultimate Edition"のみの対応となります。<p class="paragraph"/><div class="hidden-block">With Ultimate Edition, there is no need to use the <code>grails integrate-with --intellij</code> command, as Ultimate Edition understands Grails projects natively. Just open the project with <code>File -&#62; New Project -&#62; Create project from existing sources</code>.</div>
Ultimate Editionでは、 <code>grails integrate-with &#45;&#45;intellij</code> コマンドを実行する必要がありません。Ultimate Editionでは、Grailsにネイティブ対応しています。プロジェクトを <code>File -&#62; New Project -&#62; Create project</code> で開くだけで良いです。<p class="paragraph"/><div class="hidden-block">You can still use Community Edition for Grails development, but you will miss out on all the Grails specific features like automatic classpath management, GSP editor and quick access to Grails commands.</div>
Community EditionでもGrails開発に使用できますが、Grails向けの機能や自動クラスパス管理、GSPエディタ、Grailsコマンドへの対応が存在しません。<p class="paragraph"/><div class="hidden-block">To integrate Grails with Community Edition run the following command to generate appropriate project files:</div>
GrailsでCommunity Editionの設定をするには、次のコマンドを実行してプロジェクトファイルを生成します。<p class="paragraph"/><div class="code"><pre>grails integrate&#45;with &#45;&#45;intellij</pre></div><p class="paragraph"/><h4>Eclipse</h4><p class="paragraph"/><div class="hidden-block">We recommend that users of <a href="http://www.eclipse.org/" target="blank">Eclipse</a> looking to develop Grails application take a look at <a href="http://grails.org/products/ggts" target="blank">Groovy/Grails Tool Suite</a>, which offers built in support for Grails including automatic classpath management, a GSP editor and quick access to Grails commands. See the <a href="http://grails.org/STS+Integration" target="blank">STS Integration</a> page for an overview.</div>
<a href="http://www.eclipse.org/" target="blank">Eclipse</a> ユーザーがGrailsアプリケーションの開発をする際は、<a href="http://grails.org/products/ggts" target="blank">Groovy/Grails Tool Suite</a>を探して取得することをお勧めします。それは自動クラスパス管理機能、GSPエディタやGrailsコマンドへの迅速なアクセス機能を含んだGrailsのためのサポートが組み込まれて提供されています。概要については、<a href="http://www.grails.org/STS+Integration" target="blank">STS Integration</a>のページを参照してください。<p class="paragraph"/><h4>NetBeans </h4><p class="paragraph"/><div class="hidden-block">NetBeans provides a Groovy/Grails plugin that automatically recognizes Grails projects and provides the ability to run Grails applications in the IDE, code completion and integration with the Glassfish server. For an overview of features see the <a href="http://www.grails.org/NetBeans+Integration" target="blank">NetBeans Integration</a> guide on the Grails website which was written by the NetBeans team.</div>
他にも良好なオープンソースのIDEとしてSunのNetBeansがあります。NetBeansはGroovy/Grailsプラグインで自動的にGrailsプロジェクトを認識します。また、IDEでのGrailsアプリケーションの実行、コード補完、SunのGlassfishサーバとの連携などの機能も提供しています。機能概要については、NetBeansチームによって記述されたGrails公式サイト上の<a href="http://www.grails.org/NetBeans+Integration" target="blank">NetBeans Integration</a>ガイドを参照してください。<p class="paragraph"/><h4>TextMate</h4><p class="paragraph"/><div class="hidden-block">Since Grails' focus is on simplicity it is often possible to utilize more simple editors and <a href="http://macromates.com/" target="blank">TextMate</a> on the Mac has an excellent Groovy/Grails bundle available from the <a href="http://wiki.macromates.com/Main/SubversionCheckout" target="blank">Texmate bundles SVN</a>.</div>
単純さに焦点があたっているGrailsは、より単純なエディタを利用することが可能です。そしてMac上の <a href="http://macromates.com/" target="blank">TextMate</a> は<a href="http://wiki.macromates.com/Main/SubversionCheckout" target="blank">TextmateにバンドルされたSVN</a>から優秀なGroovy/Grailsバンドルを利用可能です。<p class="paragraph"/><div class="hidden-block">To integrate Grails with TextMate run the following command to generate appropriate project files:</div>
GrailsでTextMateの設定をするには、次のコマンドを実行してTextMate用のプロジェクトファイルを生成します。<p class="paragraph"/><div class="code"><pre>grails integrate&#45;with &#45;&#45;textmate</pre></div><p class="paragraph"/><div class="hidden-block">Alternatively TextMate can easily open any project with its command line integration by issuing the following command from the root of your project:</div>
またTextMateはプロジェクトのルートから次のコマンドを発行することによりコマンドラインと統合し、任意のプロジェクトを簡単に開くことができます:<p class="paragraph"/><div class="code"><pre>mate .</pre></div>

<a name="2.6 Convention over Configuration"><!-- Legacy link --></a>
<h2 id="conventionOverConfiguration">2.7 Convention over Configuration 設定より規約</h2>
<div class="hidden-block">Grails uses "convention over configuration" to configure itself. This typically means that the name and location of files is used instead of explicit configuration, hence you need to familiarize yourself with the directory structure provided by Grails.</div>
Grailsは、"convention over configuration"を使用して、自動的に設定をおこないます。一般的に、名前とファイルの位置が明確な構成の代わりに使われることを意味します。それゆえに、Grailsによって提供されるディレクトリ構造に慣れ親む必要があります。<p class="paragraph"/><div class="hidden-block">Here is a breakdown and links to the relevant sections:</div>
概要と関連するセクションへのリンクです。:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>grails-app</code> - top level directory for Groovy sources</li>
<ul class="star">
<li><code>conf</code> - <a href="../guide/single.html#conf" class="guide">Configuration sources</a>.</li>
<li><code>controllers</code> - <a href="../guide/single.html#controllers" class="guide">Web controllers</a> - The C in MVC.</li>
<li><code>domain</code> - The <a href="../guide/single.html#GORM" class="guide">application domain</a>.</li>
<li><code>i18n</code> - Support for <a href="../guide/single.html#i18n" class="guide">internationalization (i18n)</a>.</li>
<li><code>services</code> - The <a href="../guide/single.html#services" class="guide">service layer</a>.</li>
<li><code>taglib</code> - <a href="../guide/single.html#taglibs" class="guide">Tag libraries</a>.</li>
<li><code>utils</code> - Grails specific utilities.</li>
<li><code>views</code> - <a href="../guide/single.html#gsp" class="guide">Groovy Server Pages</a> - The V in MVC.</li>
</ul>
<li><code>scripts</code> - <a href="../guide/single.html#commandLine" class="guide">Gant scripts</a>.</li>
<li><code>src</code> - Supporting sources</li>
<ul class="star">
<li><code>groovy</code> - Other Groovy sources</li>
<li><code>java</code> - Other Java sources</li>
</ul>
<li><code>test</code>  - <a href="../guide/single.html#testing" class="guide">Unit and integration tests</a>.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>grails-app</code> - Groovyのソースディレクトリの最上位</li>
<ul class="star">
<li><code>conf</code> - <a href="../guide/single.html#conf" class="guide">設定ソース</a></li>
<li><code>controllers</code> - <a href="../guide/single.html#controllers" class="guide">Webコントローラ</a> - MVCのC</li>
<li><code>domain</code> - <a href="../guide/single.html#GORM" class="guide">アプリケーションドメイン</a></li>
<li><code>i18n</code> - <a href="../guide/single.html#i18n" class="guide">国際化（i18n）</a>のサポート</li>
<li><code>services</code> - <a href="../guide/single.html#services" class="guide">サービス層</a></li>
<li><code>taglib</code> - <a href="../guide/single.html#taglibs" class="guide">タグライブラリ</a></li>
<li><code>utils</code> - Grails特化なユーティリティ</li>
<li><code>views</code> - <a href="../guide/single.html#gsp" class="guide">Groovy Server Pages</a></li>
</ul>
<li><code>scripts</code> - <a href="../guide/single.html#commandLine" class="guide">Gantスクリプト</a></li>
<li><code>src</code> - サポートソース</li>
<ul class="star">
<li><code>groovy</code> - その他のGroovyのソース</li>
<li><code>java</code> - その他のJavaソース</li>
</ul>
<li><code>test</code>  - <a href="../guide/single.html#testing" class="guide">ユニットテストと統合テスト</a></li>
</ul><p class="paragraph"/>

<a name="2.7 Running an Application"><!-- Legacy link --></a>
<h2 id="runningAnApplication">2.8 アプリケーションの起動</h2>
<div class="hidden-block">Grails applications can be run with the built in Tomcat server using the <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a> command which will load a server on port 8080 by default:</div>
Grailsアプリケーションは、<a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>コマンドを使用することで組み込みTomcatで実行することができます。デフォルトポートは8080番です。<p class="paragraph"/><div class="code"><pre>grails run&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">You can specify a different port by using the <code>server.port</code> argument:</div>
起動オプションに<code>server.port</code>を指定して別のポートで起動することもできます。<p class="paragraph"/><div class="code"><pre>grails &#45;Dserver.port=8090 run&#45;app</pre></div><p class="paragraph"/>Note that it is better to start up the application in interactive mode since a container restart is much quicker:<p class="paragraph"/><div class="code"><pre>$ grails
grails&#62; run&#45;app
| Server running. Browse to http://localhost:8080/helloworld
| Application loaded in interactive mode. Type 'stop&#45;app' to shutdown.
| Downloading: plugins&#45;list.xml
grails&#62; stop&#45;app
| Stopping Grails server
grails&#62; run&#45;app
| Server running. Browse to http://localhost:8080/helloworld
| Application loaded in interactive mode. Type 'stop&#45;app' to shutdown.
| Downloading: plugins&#45;list.xml</pre></div><p class="paragraph"/><div class="hidden-block">More information on the <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a> command can be found in the reference guide.</div>
<a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>コマンドの詳細は、リファレンスガイドを参照してください。

<a name="2.8 Testing an Application"><!-- Legacy link --></a>
<h2 id="testingAnApplication">2.9 アプリケーションのテスト</h2>
<div class="hidden-block">The <code>create-*</code> commands in Grails automatically create unit or integration tests for you within the <code>test/unit</code> or <code>test/integration</code> directory. It is of course up to you to populate these tests with valid test logic, information on which can be found in the section on <a href="../guide/single.html#testing" class="guide">Testing</a>.</div>
Grailsの<code>create-*</code>コマンドは、自動的にユニットテストまたは統合テストをそれぞれ<code>test/unit</code>また<code>test/integration</code>ディレクトリに生成します。スケルトンのテストのロジックは各自で実装してください。テストの詳細については<a href="../guide/single.html#testing" class="guide">Testing</a>を参考にしてください。<p class="paragraph"/><div class="hidden-block">To execute tests you run the <a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a> command as follows:</div>
テストを実行する場合は、<a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a>コマンドを使用します:<p class="paragraph"/><div class="code"><pre>grails test&#45;app</pre></div>


<a name="2.9 Deploying an Application"><!-- Legacy link --></a>
<h2 id="deployingAnApplication">2.10 アプリケーションのデプロイ</h2>
<div class="hidden-block">Grails applications are deployed as Web Application Archives (WAR files), and Grails includes the <a href="../ref/Command Line/war.html" class="commandLine">war</a> command for performing this task:</div>
GrailsアプリケーションはWebアプリケーションアーカイブ（WARファイル）としてデプロイされます。Grailsにはアーカイブを作成するための<a href="../ref/Command Line/war.html" class="commandLine">war</a>コマンドがあります:<p class="paragraph"/><div class="code"><pre>grails war</pre></div><p class="paragraph"/><div class="hidden-block">This will produce a WAR file under the <code>target</code> directory which can then be deployed as per your container's instructions.</div>
コンテナにデプロイ可能なWarファイルが<code>target</code>ディレクトリ以下に生成されます。<p class="paragraph"/><div class="hidden-block">Unlike most scripts which default to the <code>development</code> environment unless overridden, the <code>war</code> command runs in the <code>production</code> environment by default. You can override this like any script by specifying the environment name, for example:</div>
他のほとんどのスクリプトと違い、<code>war</code>コマンドでは、環境が<code>development</code>にオーバーライドされて、<code>production</code>がデフォルトになります。他のスクリプトと同じく環境名を指定することで変更可能です。<p class="paragraph"/><div class="code"><pre>grails dev war</pre></div><p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">NEVER deploy Grails using the <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a> command as this command sets Grails up for auto-reloading at runtime which has a severe performance and scalability implications </div>
Grailsを本番運用する際はWARをデプロイしてください。<a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>コマンドでの運用は基本的に自動リロードなどが設定されているため、パフォーマンスやスケーラビリティに影響します。
</blockquote><p class="paragraph"/><div class="hidden-block">When deploying Grails you should always run your containers JVM with the <code>-server</code> option and with sufficient memory allocation. A good set of VM flags would be:</div>
Grailsをデプロイする場合は、<code>-server</code>オプションと十分なメモリを割り当てて、Webコンテナを動作させましょう。JVM起動オプションの良い設定は次のようになります:<p class="paragraph"/><div class="code"><pre>&#45;server &#45;Xmx512M &#45;XX:MaxPermSize=256m</pre></div>


<a name="2.10 Supported Java EE Containers"><!-- Legacy link --></a>
<h2 id="supportedJavaEEContainers">2.11 サポートされている Java EE コンテナ</h2>
<div class="hidden-block">Grails runs on any container that supports Servlet 2.5 and above and is known to work on the following specific container products:</div>
GrailsはServlet 2.5をサポートする任意のWebコンテナで動作します。次の製品で動作することが確認されています。
<ul class="star">
<li>Tomcat 7</li>
<li>Tomcat 6</li>
<li>SpringSource tc Server</li>
<li>Eclipse Virgo</li>
<li>GlassFish 3</li>
<li>GlassFish 2</li>
<li>Resin 4</li>
<li>Resin 3</li>
<li>JBoss 6</li>
<li>JBoss 5</li>
<li>Jetty 8</li>
<li>Jetty 7</li>
<li>Jetty 6</li>
<li>IBM Websphere 7.0</li>
<li>IBM Websphere 6.1</li>
<li>Oracle Weblogic 10.3</li>
<li>Oracle Weblogic 10</li>
<li>Oracle Weblogic 9</li>
<li>IBM WebSphere 8.5</li>
<li>IBM WebSphere 8.0</li>
<li>IBM WebSphere 7.0</li>
<li>IBM WebSphere 6.1</li>
</ul><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">It's required to set "-Xverify:none" in "Application servers &#62; server &#62; Process Definition &#62; Java Virtual Machine &#62; Generic JVM arguments" for WebSphere.</div>
WebSphereでは、"Application servers &#62; server &#62; Process Definition &#62; Java Virtual Machine &#62; Generic JVM arguments"に、"-Xverify:none"を設定する必要があります。
</blockquote>
<div class="hidden-block">Some containers have bugs however, which in most cases can be worked around. A <a href="http://grails.org/Deployment" target="blank">list of known deployment issues</a> can be found on the Grails wiki.</div>
一部のWebコンテナにはバグがありますが、ほとんどの場合では回避することができます。<a href="http://grails.org/Deployment" target="blank">既知の開発時における課題の一覧</a>は、GrailsのWikiにあります。

<a name="2.11 Generating an Application"><!-- Legacy link --></a>
<h2 id="generatingAnApplication">2.12 アプリケーション生成</h2>
<div class="hidden-block">To get started quickly with Grails it is often useful to use a feature called <a href="../guide/single.html#scaffolding" class="guide">Scaffolding</a> to generate the skeleton of an application. To do this use one of the <code>generate-*</code> commands such as <a href="../ref/Command Line/generate-all.html" class="commandLine">generate-all</a>, which will generate a <a href="../guide/single.html#controllers" class="guide">controller</a> (and its unit test) and the associated <a href="../guide/single.html#gsp" class="guide">views</a>:</div>
Grailsでは、アプリケーションのスケルトンを生成する<a href="../guide/single.html#scaffolding" class="guide">スカッフォールディング</a>の機能を使用することにより、素早く開発することができます。Grailsにはアプリケーションのスケルトンを生成する<a href="../guide/single.html#scaffolding" class="guide">スカッフォールディング</a>という機能があります。これをするには、<a href="../guide/single.html#controllers" class="guide">コントローラ</a>と関連する<a href="../guide/single.html#gsp" class="guide">ビュー</a>を生成する<a href="../ref/Command Line/generate-all.html" class="commandLine">generate-all</a>などを使用します。<p class="paragraph"/><div class="code"><pre>grails generate&#45;all Book</pre></div>

<a name="2.12 Creating Artefacts"><!-- Legacy link --></a>
<h2 id="creatingArtefacts">2.13 アーテファクトの作成</h2>
<div class="hidden-block">Grails ships with a few convenience targets such as <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a>, <a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a> and so on that will create <a href="../guide/single.html#controllers" class="guide">Controllers</a> and different artefact types for you.</div>
Grailsには<a href="../guide/single.html#controllers" class="guide">コントローラ</a>や様々なアーテファクトを生成する<a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a>や<a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a>などのコマンドが存在します。
<blockquote class="note">
<div class="hidden-block">These are just for your convenience and you can just as easily use an IDE or your favourite text editor.</div>
アーテファクト生成は便利機能です。IDEやテキストエディタを使用してもかまいません。
</blockquote>
<div class="hidden-block">For example to create the basis of an application you typically need a <a href="../guide/single.html#GORM" class="guide">domain model</a>:</div>
例として<a href="../guide/single.html#GORM" class="guide">ドメインモデル</a>を生成するには:<p class="paragraph"/><div class="code"><pre>grails create&#45;domain&#45;class book</pre></div><p class="paragraph"/><div class="hidden-block">This will result in the creation of a domain class at <code>grails-app/domain/Book.groovy</code> such as:</div>
このコマンドを実行すると、<code>grails-app/domain/Book.groovy</code>に以下のようなドメインクラスが作成されます:<p class="paragraph"/><div class="code"><pre>class Book &#123;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">There are many such <code>create-*</code> commands that can be explored in the command line reference guide.</div>
他にも<code>create-*</code>コマンドがあります。詳しくはコマンドライン・リファレンス・ガイドを参照しましょう。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">To decrease the amount of time it takes to run Grails scripts, use the <a href="../ref/Command Line/interactive.html" class="commandLine">interactive</a> mode.</div>
<a href="../ref/Command Line/interactive.html" class="commandLine">interactive</a>モードを使用することでGrailsスクリプトの起動時間を減らすことができます。
</blockquote>


<a name="2.2 Upgrading from previous versions of Grails"><!-- Legacy link --></a>
<h1 id="upgradingFromPreviousVersionsOfGrails">3 Grails下位バージョンからの更新</h1>
<div class="hidden-block">A number of changes need to considered when upgrading your application from Grails 2.2, including:</div>
Grails 2.2 から更新する際にいくつか考慮する点があります。<p class="paragraph"/><div class="hidden-block">h4. New Data Binder </div>
<h4>新データバインダー</h4><p class="paragraph"/>There is a new data binding mechanism written from the ground up to meet Grails' needs. If you wish to continue using Spring for data binding then you must set the <code>grails.databinding.useSpringBinder</code> property to <code>true</code> in <code>grails-app/conf/Config.groovy</code><p class="paragraph"/><div class="hidden-block">h4. Dependency Resolution changes </div>
<h4>依存性管理の変更</h4><p class="paragraph"/>Although dependency resolution using Ivy is still supported, the default for Grails 2.3 is to use Aether and the Ivy support will not be improved upon going forward. You may wish to consider using Aether instead for your existing applications by setting the following in <code>grails-app/conf/BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolver = <span class="java&#45;quote">"maven"</span> // or ivy</pre></div><p class="paragraph"/><h4>Dependency Metadata Changes</h4><p class="paragraph"/>In addition, the POM and dependency metadata for Grails 2.3 has been re-arranged and cleaned up so that only direct dependencies are specified for an application and all other dependencies are inherited transitvely. This has implications to the upgrade since, for example, Ehcache is now a transitive dependency of the Hibernate plugin, whilst before it was a direct dependency. If get a compilation error related to Ehcache, it is most likely that you don't have the Hibernate plugin installed and need to directly declare the Ehcache dependency:<p class="paragraph"/><div class="code"><pre>compile <span class="java&#45;quote">"net.sf.ehcache:ehcache&#45;core:2.4.6"</span></pre></div><p class="paragraph"/>
In addition, excludes may no longer work and may need adjusting when upgrading due to how the metadata has changed. Run the <a href="../ref/Command Line/dependency-report.html" class="commandLine">dependency-report</a> to see the new dependency metadata and make adjustments accordingly.<p class="paragraph"/>A common error that may occur when upgrading is:<p class="paragraph"/><div class="code"><pre>| Configuring classpath
:: problems summary ::
:::: WARNINGS
    ::::::::::::::::::::::::::::::::::::::::::::::
    ::          UNRESOLVED DEPENDENCIES         ::
    ::::::::::::::::::::::::::::::::::::::::::::::
    :: org.springframework&#35;spring&#45;test;3.2.2.RELEASE: configuration not found in org.springframework&#35;spring&#45;test;3.2.2.RELEASE: 'compile'. It was required from org.grails&#35;grails&#45;plugin&#45;testing;2.3.0.BUILD&#45;SNAPSHOT compile
    ::::::::::::::::::::::::::::::::::::::::::::::</pre></div><p class="paragraph"/>This is caused by a plugin that depends on an old version of <code>spring-test</code> (for example the <a href="http://grails.org/plugins/mail" target="blank">Mail plugin</a>). To correct this run <code>grails dependency-report</code> and search for plugins that have a transitive dependency on <code>spring-test</code> and exclude them. For example:<p class="paragraph"/><div class="code"><pre>plugins &#123;
  compile <span class="java&#45;quote<a href="mail:1.0"</span>,">></a> &#123;
    excludes <span class="java&#45;quote">"spring&#45;test"</span>
  &#125;  
&#125;</pre></div><p class="paragraph"/>However, longer term to solve problems like this we recommend that users move away from Ivy and use Aether instead for dependency resolution:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolver=<span class="java&#45;quote">"maven"</span></pre></div><p class="paragraph"/>
<div class="hidden-block">h4. No initial offline mode with Aether </div>
<h4>Aetherでは初期オフラインモードがありません</h4><p class="paragraph"/>Aether does not support resolving dependencies from a flat file system. This means that the jars we ship with Grails in GRAILS_HOME/lib are not used for the first resolve, but instead the jars are obtained from Maven central. After they have been obtained from Maven central then Aether operates fine offline.<p class="paragraph"/>If however you do not have the necessary jars in your local Maven repository, then the only way to get offline execution is to enable Ivy via BuildConfig (see above).<p class="paragraph"/><h4>Scaffolding moved to a plugin and rewritten</h4><p class="paragraph"/>If you have dynamically scaffolded controllers in your application then you will need to configure the 1.0 version of the <a href="http://grails.org/plugin/scaffolding" target="blank">Scaffolding plugin</a> in BuildConfig:<p class="paragraph"/><div class="code"><pre>plugins &#123;
  compile <span class="java&#45;quote<a href="scaffolding:1.0.0"</span>">></a>
&#125;</pre></div><p class="paragraph"/>By default for new applications the 2.0 version of the scaffolding plugin is used, which is not backwards compatible with 1.0.<p class="paragraph"/>
<div class="hidden-block">h4. Forked Execution for Testing </div>
<h4>テストでのフォーク実行</h4><p class="paragraph"/>Tests are now by default executed in a forked JVM (although this can be disabled). One implication of this is that tests will be slower to execute when using:<p class="paragraph"/><div class="code"><pre>grails test&#45;app</pre></div><p class="paragraph"/>The reason for this is the need to load a separate JVM to execute tests. To mitigate this Grails interactive mode has been updated to load a background JVM that can be resumed. If you do:<p class="paragraph"/><div class="code"><pre>$ grails // load interactive mode
$ grails &#45;&#62; test&#45;app
$ grails &#45;&#62; test&#45;app</pre></div><p class="paragraph"/>Test execution will be noticably faster and is the recommended way to run tests in Grails. On older hardware that does not include multiple cores (to run the separate JVMs) it is recommended you disable forked execution for tests to achieve faster test execution times:<p class="paragraph"/><div class="code"><pre>forkConfig = &#91;maxMemory: 1024, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;
grails.project.fork = &#91;
   test: <span class="java&#45;keyword">false</span>, // disable forked execution <span class="java&#45;keyword">for</span> test&#45;app
   run: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the run&#45;app JVM
   &#8230;
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Forked Execution and the Reloading Agent </div>
<h4>フォーク実行とリロードエージェント</h4><p class="paragraph"/>In Grails 2.3 the reloading agent is no longer on the build system path unless you pass the <code>-reloading</code> flag to the <code>grails</code> command:<p class="paragraph"/><div class="code"><pre>grails &#45;reloading run&#45;app</pre></div><p class="paragraph"/>The reason for this is that the default in Grails 2.3 and above is to load Grails application in a forked JVM and enable the agent for the forked JVM. If you do not wish to use forked JVMs then you must ensure that you run Grails with the <code>-reloading</code> flag. Alternatively, you can enable forking with the following configuration in <code>BuildConfig</code>:<p class="paragraph"/><div class="code"><pre>forkConfig = &#91;maxMemory: 1024, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;
grails.project.fork = &#91;
   test: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the test&#45;app JVM
   run: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the run&#45;app JVM
   war: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the run&#45;war JVM
   console: forkConfig // configure settings <span class="java&#45;keyword">for</span> the Swing console JVM
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Forked Execution and Remote Debugging </div>
<h4>フォーク実行とリモートデバッグ</h4><p class="paragraph"/>The <code>grails-debug</code> command will no longer work with Grails for remote debugging sessions. The reason is the command enabled debugging for the build system JVM, but not the JVM used in forked execution. The solution to this is to use the <code>debug-fork</code> command line argument:<p class="paragraph"/><div class="code"><pre>grails &#45;&#45;debug&#45;fork run&#45;app</pre></div><p class="paragraph"/>
Alternatively you can set the <code>debug</code> setting to <code>true</code> in <code>BuildConfig</code> and use the regular <code>grails</code> command to execute:<p class="paragraph"/><div class="code"><pre>forkConfig = &#91;maxMemory: 1024, minMemory: 64, debug: <span class="java&#45;keyword">true</span>, maxPerm: 256&#93;
grails.project.fork = &#91;
   run: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the run&#45;app JVM
   ...</pre></div><p class="paragraph"/><div class="hidden-block">h4. Changes to Core plugin versioning schemes and the Upgrade command </div>
<h4>コアプラグインのバージョン管理方法の変更とアップグレードコマンド</h4><p class="paragraph"/>Core plugins like <code>tomcat</code> and <code>hibernate</code> are no longer versioned the same as the Grails version, instead they are versioned according to the Tomcat and Hibernate version they target. If you are upgrading from Grails 2.2 you need to manually configure the correct Tomcat and Hibernate plugins in <code>BuildConfig</code>. The <code>upgrade</code> command will not do this for you!<p class="paragraph"/><div class="code"><pre>plugins &#123;
        // plugins <span class="java&#45;keyword">for</span> the build system only
        build ':tomcat:7.0.40.1'<p class="paragraph"/>        // plugins needed at runtime but not <span class="java&#45;keyword">for</span> compilation
        runtime ':hibernate:3.6.10.M3' 
    &#125;</pre></div>}<p class="paragraph"/>Note that the <code>upgrade</code> command will be deprecated in 2.3 and replaced with a command named <code>use-current-grails-version</code>, which will make no attempts to automatically upgrade Grails applications.<p class="paragraph"/><div class="hidden-block">h4. Encoding / Escaping (XSS) Changes </div>
<h4>エンコーディング・エスケーピング(XSS)の変更</h4><p class="paragraph"/>
Grails 2.3 includes new features to help prevent XSS attacks. These are enabled by default for new applications, but older applications will require manual intervention. See the section on <a href="../guide/single.html#xssPrevention" class="guide">Cross Site Scripting (XSS) prevention</a> for how to appropriately configure XSS prevention.<p class="paragraph"/><p class="paragraph"/><p class="paragraph"/><p class="paragraph"/><p class="paragraph"/><blockquote class="note">
公式版では以下のドキュメントはこのページに存在しません。公式版で過去の更新注意点を確認する際には該当するバージョンのドキュメントを参照してください。
</blockquote><p class="paragraph"/><h4>2.2以前(保存用)</h4>
<blockquote class="note">
公式版では以下のドキュメントはこのページに存在しません。公式版で過去の更新注意点を確認する際には該当するバージョンのドキュメントを参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">Although the Grails development team have tried to keep breakages to a minimum there are a number of items to consider when upgrading a Grails 1.0.x, 1.1.x, 1.2.x, or 1.3.x applications to Grails 2.0. The major changes are described in more detail below, but here's a brief summary of what you might encounter when upgrading from Grails 1.3.x:</div>
Grails開発チームではできる限りの下位互換を心がけていますが、Grails 2.0へ更新する際に、下位バージョンから考慮しなくてはならない内容が幾つか存在します。大きな変更点を以下にまとめます。
<ul class="star">
<li>Dependency resolution has been changed to <strong class="bold">only</strong> use data from the POMs to resolve, this can impact plugins and you may need to republish a plugin with corrected dependency data</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>environment</code> bean added by Spring 3.1, which will be auto-wired into properties of the same name.</div>
Spring 3.1によって、同じ名称の環境が <code>environment</code> ビーンが自動追加されます。<p class="paragraph"/><div class="hidden-block">* Logging by convention packages have changed, so you may not see the logging output you expect. Update your logging configuration as described below.</div>
<ul class="star">
<li>ロギングDSLのパッケージが変更されたので正常にログ出力がされない場合があります。ログの設定を変更する必要があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* HSQLDB has been replaced with H2 as default in-memory database. If you use the former, either change your data source to H2 or add HSQLDB as a runtime dependency.</div>
<ul class="star">
<li>デフォルトのインメモリーデータベースがHSQLDBからH2へ変更になりました。使用している場合はデータソースの設定を変更するか、HSQLDBを依存管理に追加する必要があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* The <code>release-plugin</code> command has been removed. You must now install the <a href="http://grails.org/plugin/release" target="blank">Release plugin</a> and use its <a href="../guide/single.html#repositories" class="guide"><code>publish-plugin</code> command</a> instead. </div>
<ul class="star">
<li><code>release-plugin</code>コマンドが無くなります。代わりに、 <a href="http://grails.org/plugin/release" target="blank">Releaseプラグイン</a> をインストールして、 <a href="../guide/single.html#repositories" class="guide"><code>publish-plugin</code> コマンド</a> を使用してください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* The <code>redirect()</code> method no longer commits the response, so <code>isCommitted()</code> will return <code>false</code>. If you use that method, then call <code>request.isRedirected()</code> instead.</div>
<ul class="star">
<li><code>redirect()</code>メソッドがレスポンスを返さなくなります。これにより、<code>isCommitted()</code>は<code>false</code>を返す事になります。<code>isCommitted()</code>を使用している場合は、代わりに<code>request.isRedirected()</code>を使用しましょう</li>
</ul><p class="paragraph"/><div class="hidden-block">* The <code>redirect()</code> method now uses the grails.serverURL config setting to generate the redirect URL. You may need to remove the setting, particularly from the development and test environments.</div>
<ul class="star">
<li><code>redirect()</code>メソッドは、設定のgrails.serverURLを使用してリダイレクトのURLを生成するようになります。developmentとtestの環境設定からgrails.serverURL設定を外す必要があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>withFormat()</code> no longer takes account of the request content type. If you want to do something based on the request content type, use <code>request.withFormat()</code>.</div>
<ul class="star">
<li><code>withFormat()</code>がリクエストコンテントタイプを取得しなくなりました。リクエストコンテントタイプでの動作を実装する場合は、<code>request.withFormat()</code>を使用してください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Adaptive AJAX tags using Prototype will break. In this situation you must install the new Prototype plugin.</div>
<ul class="star">
<li>Prototypeを使用したAJAXタグは動作しません。必要であれば、Prototypeプラグインをインストールしてください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* If you install Resources (or it is installed automatically), tags like <code>&#60;g:javascript&#62;</code> won't write anything to the page until you add the <code>&#60;r:layoutResources/&#62;</code> tags to your layout.</div>
<ul class="star">
<li>Resourcesプラグインをインストールした場合(または、自動的にインストールされた場合)、<code>&#60;r:layoutResources/&#62;</code>をレイアウトに記述するまで、<code>&#60;g:javascript&#62;</code>からは何も出力されません。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Resources adds a '/static' URL, so you may have to update your access control rules accordingly.</div>
<ul class="star">
<li>ResourcesプラグインはURL '/static'を追加します。それに応じたアクセスコントロールを更新する必要があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Some plugins may fail to install because one or more of their dependencies can not be found. If this happens, the plugin probably has a custom repository URL that you need to add to your project's <code>BuildConfig.groovy</code>.</div>
<ul class="star">
<li>幾つかのプラグインは依存が見つからなかった際にインストールに失敗する場合があります。その場合は、プラグインがカスタムリポジトリURLを使用している可能性があるので、プロジェクトの<code>BuildConfig.groovy</code>に追加する必要があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* The behaviour of abstract domain classes has changed, so if you use them you will either have to move the abstract classes to 'src/groovy' or migrate your database schema and data.</div>
<ul class="star">
<li>抽象ドメインクラスの振る舞いが変更されました。使用している場合は、抽象クラスを'src/groovy'に移動するか、データベースのスキーマとデータを変更する必要があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Criteria queries default to INNER_JOIN for associations rather than OUTER_JOIN. This may affect some of your result data.</div>
<ul class="star">
<li>クライテリアクエリーのデフォルトがOUTER_JOINからINNER_JOINに変更になりました。幾つかの実装結果に影響が出る可能性があります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Constraints declared for non-existent properties will now throw an exception.</div>
<ul class="star">
<li>存在しないプロパティがconstraintsに定義してある場合、例外を投げるようになりました。</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>beforeValidate()</code> may be called two or more times during a request, for example once on save() and once just before the view is rendered.</div>
リクエスト中に <code>beforeValidate()</code> が複数回コールされる可能性があります。例としてsave()で1回そしてビューがレンダリングされる直前など。<p class="paragraph"/><div class="hidden-block">* Public methods in controllers will now be treated as actions. If you don't want this, make them protected or private.</div>
<ul class="star">
<li>コントローラ内のパブリックメソッドはアクションとして扱われるようになります。アクションとして扱われたくないメソッドは、protectedまたは、privateに変更してください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* The new unit testing framework won't work with the old <code>GrailsUnitTestCase</code> class hierarchy. Your old tests will continue to work, but if you wish to use the new annotations, do not extend any of the <code>&#42;UnitTestCase</code> classes.</div>
<ul class="star">
<li>新ユニットテストフレームワークにより、古い<code>GrailsUnitTestCase</code>クラス階層は使用できません。新しい仕組みを使用しながら古いテスト仕様で動作させるには、<code>&#42;UnitTestCase</code>を継承しないようにしてください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Output from Ant tasks is now hidden by default. If your scripts are using <code>ant.echo()</code>, <code>ant.input()</code>, etc. you might want to use alternative mechanisms for output.</div>
<ul class="star">
<li>Antタスクからの出力はデフォルトで隠すようになりました。<code>ant.echo()</code>, <code>ant.input()</code>等をスクリプトで使用している場合は、出力用の代替機能を使用してください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* Domain properties of type java.net.URL may no longer work with your existing data. The serialisation mechanism for them appears to have changed. Consider migrating your data and domain models to String.</div>
<ul class="star">
<li>ドメインプロパティでjava.net.URL型を使用している場合は、既存のデータで動作しません。シリアライゼーションの仕組みが変更になったようです。ドメインモデルとデータをStringに変更することを検討してください。</li>
</ul><p class="paragraph"/><div class="hidden-block">* The Ivy cache location has changed. If you want to use the old location, configure the appropriate global setting (see below) but be aware that you may run into problems running Grails 1.3.x and 2.x projects side by side.</div>
<ul class="star">
<li>Ivyのキャッシュ場所が変更になりました。古い場所を使用したい場合は、グローバル設定で変更することができます。ただし、1.3.x系と2.x系を平行利用する場合は問題が発生します。</li>
</ul><p class="paragraph"/><div class="hidden-block">* With new versions of various dependencies, some APIs (such as the Servlet API) may have changed. If you have code that implements any of those APIs, you will need to update it. Problems will typically manifest as compilation errors.</div>
<ul class="star">
<li>多くのライブラリが新バージョンに変更されました。更新されたライブラリを使用している場合は変更が必要となります。</li>
</ul><p class="paragraph"/><div class="hidden-block">* The following deprecated classes have been removed: <code>grails.web.JsonBuilder</code> and <code>grails.web.OpenRicoBuilder</code>.</div>
<ul class="star">
<li>次の非推奨クラスが削除されました: <code>grails.web.JsonBuilder</code>、<code>grails.web.OpenRicoBuilder</code></li>
</ul><p class="paragraph"/><h3>Upgrading to 2.2 from 2.1 or 2.0</h3><p class="paragraph"/><h4>Groovy 2.0</h4><p class="paragraph"/>Grails 2.2 ships with Groovy 2.0 which has some language level changes that may require changes to your code or plugins that you use.<p class="paragraph"/><h4>Dependency resolution</h4><p class="paragraph"/>Grails 2.2 no longer uses the BuildConfig of the plugin for dependency resolution and <strong class="bold">only</strong> uses data provided by POMs, this may impact some plugins that had previously incorrectly 
specified dependency information.<p class="paragraph"/>If you don't want to immediately deal with the changes necessary to upgrade, then you can open <code>BuildConfig</code> and set the <code>legacyResolve</code> settings to true:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;    
    &#8230;
    legacyResolve <span class="java&#45;keyword">false</span> 
    &#8230;
&#125;</pre></div><p class="paragraph"/>This is not recommended however, as it will re-enable the previous behavior of using both POM data and BuildConfig to resolve dependencies. The most commmon problem you will face is with plugins that express their dependencies in a scope that is not valid inside a POM (example: "build" scope).<p class="paragraph"/>Plugins like this will need to be re-publish with a corrected scope of "compile". If you then specify the plugin as "build" scope in your application, transitive compile and runtime scoped dependencies will be converted to "build" scope as well.<p class="paragraph"/><h3>Grails 1.3.xからのアップグレード <div class="hidden-block">Upgrading from Grails 1.3.x</div></h3><p class="paragraph"/><h4>web.xmlテンプレートの内容変更 <div class="hidden-block">Changes to web.xml template</div></h4><p class="paragraph"/><div class="hidden-block">If you have customized the web.xml provided by <code>grails install-templates</code> then you will need to update this customized template with the latest version provided by Grails. Failing to do so will lead to a ClassNotFoundException for the <code>org.codehaus.groovy.grails.web.util.Log4jConfigListener</code> class.</div>
<code>grails install-templates</code>で提供されたweb.xmlをカスタマイズしている場合は、最新のGrailsで提供される無いように更新する必要が有ります。変更を行わなかった場合は、<code>org.codehaus.groovy.grails.web.util.Log4jConfigListener</code>クラスのClassNotFoundExceptionを引き起こします。<p class="paragraph"/><h4>Groovy 1.8での変更点<div class="hidden-block">Groovy 1.8 Changes</div></h4><p class="paragraph"/><div class="hidden-block">Groovy 1.8 is a little stricter in terms of compilation so you may be required to fix compilation errors in your application that didn't occur under Grails 1.3.x.</div>
Groovy 1.8ではｍコンパイルが少し厳しくなっています。そのため、Grails 1.3.xでは発生しなかったコンパイルエラーに対応する必要があります。<p class="paragraph"/><div class="hidden-block">Groovy 1.8 also requires that you update many of the libraries that you may be using in your application. Libraries known to require an upgrade include:</div>
さらに、Groovy 1.8では、アプリケーションで使用している幾つかのライブラリを更新する必要があります。解っている更新が必要なライブラリは以下になります。
<ul class="star">
<li>Spock</li>
<li>Geb</li>
<li>GMock (upgrade unavailable as of this writing)</li>
</ul><p class="paragraph"/><h4>新 'environment' ビーン <div class="hidden-block">New 'environment' bean</div></h4><p class="paragraph"/>Spring 3.1 adds a new bean with the name 'environment'. It's of type <code>Environment</code> (in package <code>org.springframework.core.env</code>) and it will automatically be autowired into properties with the same name. This seems to cause particular problems with domain classes that have an <code>environment</code> property. In this case, adding the method:
Spring 3.1から'environment'という名称の新規ビーンが追加されました。これは<code>Environment</code>型(パッケージ<code>org.springframework.core.env</code>)で、同じ名前のプロパティに自動ワイヤーされます。一部のドメインクラスプロパティで<code>environment</code>の名称をもつ物に問題が起きる可能性があります。その場合次のようにメソッドを追加して回避してください:
<div class="code"><pre>void setEnvironment(org.springframework.core.env.Environment env) &#123;&#125;</pre></div>
<div class="hidden-block">works around the problem.</div><p class="paragraph"/><h4>HSQLDBからH2へ変更 <div class="hidden-block">HSQLDB Has Been Replaced With H2 </div></h4><p class="paragraph"/><div class="hidden-block">HSQLDB is still bundled with Grails but is not configured as a default runtime dependency.  Upgrade options include replacing HSQLDB references in DataSource.groovy with H2 references or adding HSQLDB as a runtime dependency for the application.</div>
HSQLDBは現在もGrailsにバンドルされていますが、デフォルトでは依存定義されていません。アップグレードした場合はDataSource.groovyのHSQLDB定義をH2に変更するか、依存管理にHSQLDBを追加する必要があります。<p class="paragraph"/><div class="hidden-block">If you want to run an application with different versions of Grails, it's simplest to add HSQLDB as a runtime dependency, which you can do in BuildConfig.groovy:</div>
もしアプリケーションを他のバージョンのGrailsと平行して動作させたい場合は、単純にBuildConfig.groovyの依存定義にHSQLDBを追加しましょう:<p class="paragraph"/><div class="hidden-block">        // Add HSQLDB as a runtime dependency</div>
<div class="code"><pre>grails.project.dependency.resolution = &#123;
    inherits(<span class="java&#45;quote">"global"</span>) &#123;
    &#125;
    repositories &#123;
        grailsPlugins()
        grailsHome()
        grailsCentral()
    &#125;<p class="paragraph"/>    dependencies &#123;
        // HSQLDBの依存定義 (Add HSQLDB as a runtime dependency)
        runtime 'hsqldb:hsqldb:1.8.0.10'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">A default DataSource.groovy which is compatible with H2 looks like this:</div>
H2データベースへ変更する場合は、以下を参考にして、DataSource.groovyを変更してください:<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    driverClassName = <span class="java&#45;quote">"org.h2.Driver"</span>
    username = <span class="java&#45;quote">"sa"</span>
    password = <span class="java&#45;quote">""</span>
&#125;
// environment specific settings
environments &#123;
    development &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"create&#45;drop"</span> // one of 'create', 'create&#45;drop','update'
            url = <span class="java&#45;quote">"jdbc:h2:mem:devDb"</span>
        &#125;
    &#125;
    test &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:testDb"</span>
        &#125;
    &#125;
    production &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:prodDb"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Another significant difference between H2 and HSQLDB is in the handling of <code>byte&#91;]</code> domain class properties. HSQLDB's default BLOB size is large and so you typically don't need to specify a maximum size. But H2 defaults to a maximum size of 255 bytes! If you store images in the database, the saves are likely to fail because of this. The easy fix is to add a <code>maxSize</code> constraint to the <code>byte&#91;]</code> property:</div>
他にH2とHSQLDBの重大な違いは、ドメインクラスのプロパティで定義した 　<code>byte&#91;]</code> の扱いです。HSQLDBでのBLOBのデフォルトサイズは、大きいので大抵最大サイズを定義する必要が無かったかと思います。H2では最大サイズの初期値が255バイトになっているので、調整する必要があります。調整するには、 制約の <code>maxSize</code> を　<code>byte&#91;]</code> のプロパティに定義するだけです。<p class="paragraph"/><div class="code"><pre>class MyDomain &#123;
    <span class="java&#45;object">byte</span>&#91;&#93; data<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        data maxSize: 1024 &#42; 1024 &#42; 2 // 2MB
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This constraint influences schema generation, so in the above example H2 will have the <code>data</code> column set to <code>BINARY(2097152)</code> by Hibernate.</div>
上記の制約定義でスキーマ生成を変更します。この例では、dataカラムは、　<code>BINARY(2097152)</code> としてHibernateがセットします。<p class="paragraph"/><h4>抽象クラスの継承が変更になります <div class="hidden-block">Abstract Inheritance Changes</div></h4><p class="paragraph"/><div class="hidden-block">In previous versions of Grails abstract classes in <code>grails-app/domain</code> were not treated as persistent. This is no longer the case and has a significant impact on upgrading your application. For example consider the following domain model in a Grails 1.3.x application:</div>
以前のバージョンで、 <code>grails-app/domain</code> に存在する抽象クラスは、永続化対象として扱われませんでした。今後は違うため、アプリケーション更新には重大な影響を与えます。例として以下のようなドメインモデルをGrails-1.3.xで持っていたとします。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">abstract</span> class Sellable &#123;<p class="paragraph"/>&#125;
class Book <span class="java&#45;keyword">extends</span> Sellable &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In Grails 1.3.x you would get a BOOK table and the properties from the <code>Sellable</code> class would be stored within the <code>BOOK</code> table. However, in Grails 2.x you will get a <code>SELLABLE</code> table and the default table-per-hierarchy inheritance rules apply with all properties of the <code>Book</code> stored in the <code>SELLABLE</code> table.</div>
Grails 1.3.xの場合は、 <code>BOOK</code> テーブルが生成され、BOOKテーブルに <code>Sellable</code> クラスのプロパティも含まれました。Grails 2.0からは、デフォルトのtable-per-hierarchy (クラス階層ごとのテーブル)継承ルールで、 <code>BOOK</code> クラスの全てのプロパティが含まれた <code>SELLABLE</code> テーブルが生成されます。<p class="paragraph"/><div class="hidden-block">You have two options when upgrading in this scenario:</div>
これを更新するには２つの方法があります:<p class="paragraph"/><div class="hidden-block">
<ol>
<li>Move the abstract <code>Sellable</code> class into the src/groovy package. If the <code>Sellable</code> class is in the <code>src/groovy</code> directory it will no longer be regarded as persistent.</li>
<li>Use the <a href="http://grails.org/plugin/database-migration" target="blank">database migration</a> plugin to apply the appropriate changes to the database (typically renaming the table to the root abstract class of the inheritance tree).</li>
</ol><p class="paragraph"/></div>
<ol>
<li>抽象クラス <code>Sellable</code> をsrc/groovyに移動する。src/groovyに移動すれば永続化対象のクラスとしては認識しません。</li>
<li><a href="http://grails.org/plugin/database-migration" target="blank">データベースマイグレーションプラグイン</a> を使用して、データベースに適した変更を行う。(通常はルート抽象クラスのテーブル名称に変更すれば良いです。)</li>
</ol><p class="paragraph"/><h4>クライテリアクエリのデフォルトがINNER JOINになります <div class="hidden-block">Criteria Queries Default to INNER JOIN</div></h4><p class="paragraph"/><div class="hidden-block">The previous default of LEFT JOIN for criteria queries across associations is now INNER JOIN.</div>
今まではLEFT JOINがデフォルトでした。これからはINNER JOINになります。<p class="paragraph"/><h4>存在しないプロパティの制約で例外を投げます <div class="hidden-block">Invalid Constraints Now Thrown an Exception </div></h4><p class="paragraph"/><div class="hidden-block">Previously if you defined a constraint on a property that doesn't exist no error would be thrown:</div>
以前は存在しないプロパティをconstraintに定義してもエラーが出ませんでした:
<div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> constraints = &#123;
        bad nullable:<span class="java&#45;keyword">false</span> // invalid property, no error thrown
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Now the above code will result in an exception </div>
上記のコードは、例外を投げるようになります。<p class="paragraph"/><h4>ログでの慣習変更 <div class="hidden-block">Logging By Convention Changes</div></h4><p class="paragraph"/><div class="hidden-block">The packages that you should use for Grails artifacts have mostly changed. In particular:</div>
Grailsアーテファクトのパッケージのほぼ全てが変更になりました:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>service</code> -&#62; <code>services</code></li>
<li><code>controller</code> -&#62; <code>controllers</code></li>
<li><code>tagLib</code> -&#62; <code>taglib</code> (case change)</li>
<li><code>bootstrap</code> -&#62; <code>conf</code></li>
<li><code>dataSource</code> -&#62; <code>conf</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>service</code> -&#62; <code>services</code></li>
<li><code>controller</code> -&#62; <code>controllers</code></li>
<li><code>tagLib</code> -&#62; <code>taglib</code> (Lが小文字に)</li>
<li><code>bootstrap</code> -&#62; <code>conf</code></li>
<li><code>dataSource</code> -&#62; <code>conf</code></li>
</ul><p class="paragraph"/><div class="hidden-block">You can find out more about logging by convention in the <a href="../guide/single.html#logging" class="guide">main part</a> of the user guide, under "Configuring loggers". This change is a side-effect of injecting the <code>log</code> property into artefacts at compile time.</div>
ログの詳細については、 <a href="../guide/single.html#logging" class="guide">ユーザガイド</a> を参考にしてください。<p class="paragraph"/><h4>PrototypeからjQueryに変更 <div class="hidden-block">jQuery Replaces Prototype</div></h4><p class="paragraph"/><div class="hidden-block">The Protoype Javascript library has been removed from Grails core and now new Grails applications have the jQuery plugin configured by default. This will only impact you if you are using Prototype with the adaptive AJAX tags in your application, e.g. &#60;g:remoteLink/&#62; etc, because those tags will break as soon as you upgrade.</div>
JavascriptライブラリPrototypeはGrailsのコアから削除されました。今後はjQueryがデフォルトとして定義されます。この変更では、ProtoypeベースのAJAXライブラリを使用してる場合に影響を受けます。例えば&#60;g:remoteLink/&#62;などは、アップデートをしたら直ちに影響を受けます。<p class="paragraph"/><div class="hidden-block">To resolve this issue, simply install the <a href="http://grails.org/plugin/prototype" target="blank">Prototype plugin</a> in your application. You can also remove the prototype files from your <code>web-app/js/prototype</code> directory if you want.</div>
この問題は <a href="http://grails.org/plugin/prototype" target="blank">Prototypeプラグイン</a> をインストールすることで解決できます。Prototypeはプラグイン内から参照するようになるので、不用になるweb-app/js/prototypeディレクトリは削除できます。<p class="paragraph"/><h4>Resourcesプラグイン <div class="hidden-block">The Resources Plugin</div></h4><p class="paragraph"/>The Resources plugin is a great new feature of Grails that allows you to manage static web resources better than before, but you do need to be aware that it adds an extra URL at <code>/static</code>. If you have access control in your application, this may mean that the static resources require an authenticated user to load them! Make sure your access rules take account of the <code>/static</code> URL.<p class="paragraph"/><h4>コントローラのパブリックメソッド <div class="hidden-block">Controller Public Methods </div></h4><p class="paragraph"/><div class="hidden-block">As of Grails 2.0, public methods of controllers are now treated as actions in addition to actions defined as traditional Closures. If you were relying on the use of methods for privacy controls or as helper methods then this could result in unexpected behavior. To resolve this issue you should mark all methods of your application that are not to be exposed as actions as <code>private</code> methods.</div>
Grails 2.0からは、今までのクロージャに加えて、コントローラのパブリックメソッドもアクションとして扱われるようになりました。もし補助機能や内部機能としてメソッドを使用している場合は必ずメソッドを <code>private</code> にしてください。<p class="paragraph"/><h4>コマンドオブジェクト制約 <div class="hidden-block">Command Object Constraints</div></h4><p class="paragraph"/><div class="hidden-block">As of Grails 2.0, constrained properties in command object classes are no longer nullable by default.  Nullable command object properties must be explicitly configured as such in the same way that nullable persistent properties in domain classes are configured.</div>
Grails 2.0よりコマンドオブジェクトのプロパティ制約はnullableが既存値ではなくなりました。Nullable指定のコマンドオブジェクトプロパティは明示的に指定する必要があります。指定方法はドメインクラスと同じです。<p class="paragraph"/>
<h4>リダイレクトメソッド <div class="hidden-block">The redirect Method</div></h4><p class="paragraph"/><div class="hidden-block">The <a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> method no longer commits the response. The result of this is code that relies of this behavior will break in 2.0. For example:</div>
リダイレクト <a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> メソッドがレスポンスを返さなくなります。以下のコードは2.0では動作しなくなります:<p class="paragraph"/><div class="code"><pre>redirect action: <span class="java&#45;quote">"next"</span>
<span class="java&#45;keyword">if</span> (response.committed) &#123;
    // <span class="java&#45;keyword">do</span> something
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case in Grails 1.3.x and below the <code>response.committed</code> property would return true and the <code>if</code> block will execute. In Grails 2.0 this is no longer the case and you should instead use the new <code>isRedirected()</code> method of the <code>request</code> object:</div>
このケースが1.3.xの場合では、 <code>response.committed</code> プロパティがtrueを返すため <code>if</code> ブロックが実行されます。Grails 1.4では、同等の動きをしないため、代わりに <code>request</code> インスタンスの <code>isRedirected()</code> メソッドを使用します。<p class="paragraph"/><div class="code"><pre>redirect action: <span class="java&#45;quote">"next"</span>
<span class="java&#45;keyword">if</span> (request.redirected) &#123;
    // <span class="java&#45;keyword">do</span> something
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Another side-effect of the changes to the redirect method is that it now always uses the <code>grails.serverURL</code> configuration option if it's set. Previous versions of Grails included default values for all the environments, but when upgrading to Grails 2.0 those values more often than not break redirection. So, we recommend you remove the development and test settings for <code>grails.serverURL</code> or replace them with something appropriate for your application.</div>
他のリダイレクトメソッドへの変更による副作用は、 <code>grails.serverURL</code> が設定されていれば常に使用するという点です。以前のバージョンのGrailsではデフォルトの値を保持していました、Grails 2.0に更新するとそれらを参照するために問題が発生します。したがって、test、developmentの定義から <code>grails.serverURL</code> を外すか、妥当な値に設定することを推奨します。<p class="paragraph"/><h4>コンテントネゴシエーション <div class="hidden-block">Content Negotiation</div></h4><p class="paragraph"/><div class="hidden-block">As of Grails 2.0 the <a href="../ref/Controllers/withFormat.html" class="controllers">withFormat</a> method of controllers no longer takes into account the request content type (dictated by the <code>CONTENT_TYPE</code> header), but instead deals exclusively with the response content type (dictated by the <code>ACCEPT</code> header or file extension). This means that if your application has code that relies on reading XML from the request using <code>withFormat</code> this will no longer work:</div>
Grails 2.0からコントローラのwithFormatメソッドは、リクエストのコンテントタイプ(<code>CONTENT_TYPE</code>ヘッダ)を評価しなくなりました。これにかわって、レスポンスのコンテントタイプ(<code>ACCEPT</code>ヘッダまたはファイル拡張子)が排他的に処理を行います。これによって今までのアプリケーションの<code>withFormat</code>を使用してリクエストからXMLを読み込む等のコードは動作しなくなります。<p class="paragraph"/><div class="code"><pre>def processBook() &#123;
    withFormat &#123;
        xml &#123;
            // read request XML
        &#125;
        html &#123;
            // read request parameters
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Instead you use the <code>withFormat</code> method provided on the <code>request</code> object:</div>
<code>withFormat</code> の代わりに、 <code>request</code> オブジェクトで提供されているwithFormatメソッドを使用できます:<p class="paragraph"/><div class="code"><pre>def processBook() &#123;
    request.withFormat &#123;
        xml &#123;
            // read request XML
        &#125;
        html &#123;
            // read request parameters
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>ユニットテストフレームワーク <div class="hidden-block">Unit Test Framework </div></h4><p class="paragraph"/><div class="hidden-block">Grails 2 introduces a new unit testing framework that is simpler and behaves more consistently than the old one. The old framework based on the <code>GrailsUnitTestCase</code> class hierarchy is still available for backwards compatibility, but it does not work with the new annotations.</div>
Grails 2では、古い仕様より単純でかつ安定した、新しいユニットテストフレームワークを実装しています。下位互換として<code>GrailsUnitTestCase</code>クラス階層をベースとした古いフレームワークも使用可能です。但し、新しい仕組みのアノテーションとは平行利用できません。<p class="paragraph"/><div class="hidden-block">Migrating unit tests to the new approach is non-trivial, but recommended. Here are a set of mappings from the old style to the new:</div>
新しい仕組みのユニットテストへの移行は大変ですが推奨します。以下は古い仕組みから新しい仕組みへ更新する方法です:<p class="paragraph"/><div class="hidden-block">
<ol>
<li>Remove <code>extends *UnitTestCase</code> and add a <code>&#64;TestFor</code> annotation to the class if you're testing a core artifact (controller, tag lib, domain class, etc.) or <code>&#64;TestMixin(GrailsUnitTestMixin)</code> for non-core artifacts and non-artifact classes.</li>
<li>Add <code>&#64;Mock</code> annotation for domain classes that must be mocked and use <code>new MyDomain().save()</code> in place of <code>mockDomain()</code>.</li>
<li>Replace references to <code>mockRequest</code>, <code>mockResponse</code> and <code>mockParams</code> with <code>request</code>, <code>response</code> and <code>params</code>.</li>
<li>Remove references to <code>renderArgs</code> and use the <code>view</code> and <code>model</code> properties for view rendering, or <code>response.text</code> for all others.</li>
<li>Replace references to <code>redirectArgs</code> with <code>response.redirectedUrl</code>. The latter takes into account the URL mappings as is a string URL rather than a map of <code>redirect()</code> arguments.</li>
<li>The <code>mockCommandObject()</code> method is no longer needed as Grails automatically detects whether an action requires a command object or not.</li>
</ol><p class="paragraph"/></div>
<ol>
<li>コアアーテファクト(コントローラ、タグリブ、ドメインクラス等)のテストの場合は、 <code>extends *UnitTestCase</code>を削除して、<code>&#64;TestFor</code>アノテーションをクラスに追加します。コアアーティファクト以外やアーティファクト以外の場合は、<code>&#64;TestMixin(GrailsUnitTestMixin)</code>アノテーションを追加します。</li>
<li>モックするドメインクラスで、<code>mockDomain()</code>の代わりに、<code>new MyDomain().save()</code>を使用するために、<code>&#64;Mock</code>アノテーションでドメインクラスを指定します。</li>
<li><code>mockRequest</code>、<code>mockResponse</code>、<code>mockParams</code>への参照を<code>request</code>、<code>response</code>、<code>params</code>に変更します。</li>
<li><code>renderArgs</code>を参照している部分を削除して、<code>view</code>と<code>model</code>プロパティをビューレンダリング用に、また他は<code>response.text</code>を使用するようにします。</li>
<li><code>redirectArgs</code>は、<code>response.redirectedUrl</code>に変更します。後者はURLマッピングの内容を、<code>redirect()</code>のマップのでは無く、文字列のURLで返します。</li>
<li><code>mockCommandObject()</code>メソッドは、アクションが必要であれば自動的にコマンドオブジェクトを認識するため必要無くなりました。</li>
</ol><p class="paragraph"/><div class="hidden-block">There are other differences, but these are the main ones. We recommend that you read the <a href="../guide/single.html#testing" class="guide">chapter on testing</a> thoroughly to understand everything that has changed.</div>
他にも違いは多数有りますが、これらがメインとなります。<a href="../guide/single.html#testing" class="guide">chapter on testing</a>をしっかり読んで理解することを推奨します。<p class="paragraph"/><div class="hidden-block">Note that the Grails annotations don't need to be imported in your test cases to run them from the command line, but your IDE may need them. So, here are the relevant classes with packages:</div>
Grailsのアノテーションはコマンドラインで実行する場合はインポートする必要が有りませんが、IDEは必要とします。ここに関連するクラスとパッケージを列挙します。
<ul class="star">
<li><code>grails.test.mixin.TestFor</code></li>
<li><code>grails.test.mixin.TestMixin</code></li>
<li><code>grails.test.mixin.Mock</code></li>
<li><code>grails.test.mixin.support.GrailsUnitTestMixin</code></li>
<li><code>grails.test.mixin.domain.DomainClassUnitTestMixin</code></li>
<li><code>grails.test.mixin.services.ServiceUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.ControllerUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.FiltersUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.GroovyPageUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.UrlMappingsUnitTestMixin</code></li>
<li><code>grails.test.mixin.webflow/WebFlowUnitTestMixin</code></li>
</ul><p class="paragraph"/>Note that you're only ever likely to use the first two explicitly. The rest are there for reference.<p class="paragraph"/>
<h4>コマンドライン出力 <div class="hidden-block">Command Line Output</div></h4><p class="paragraph"/><div class="hidden-block">Ant output is now hidden by default to keep the noise in the terminal to a minimum. That means if you use <code>ant.echo</code> in your scripts to communicate messages to the user, we recommend switching to an alternative mechanism.</div>
ターミナルの表示を最小にするためにAnt出力は表示されなくなりました。これによりスクリプトでの出力としての <code>ant.echo</code> からのメッセージは表示されなくなります。それに変わる方法に変更することをお勧めします。<p class="paragraph"/><div class="hidden-block">For status related messages, you can use the event system:</div>
ステータス表示には、イベントの仕組みが使用できます:<p class="paragraph"/><div class="code"><pre>event <span class="java&#45;quote">"StatusUpdate"</span>, &#91;<span class="java&#45;quote">"Some message"</span>&#93;
event <span class="java&#45;quote">"StatusFinal"</span>,  &#91;<span class="java&#45;quote">"Some message"</span>&#93;
event <span class="java&#45;quote">"StatusError"</span>,  &#91;<span class="java&#45;quote">"Some message"</span>&#93;</pre></div><p class="paragraph"/><div class="hidden-block">For more control you can use the <code>grailsConsole</code> script variable, which gives you access to an instance of <a href="http://grails.org/doc/latest/api/grails/build/logging/GrailsConsole.html" class="api">GrailsConsole</a>. In particular, you can log information messages with <code>log()</code> or <code>info()</code>, errors and warnings with <code>error()</code> and <code>warning()</code>, and request user input with <code>userInput()</code>.</div>
さらなる制御として、api:grails.build.logging.GrailsConsoleインスタンスにアクセスするスクリプト変数  GrailsConsole|api:grails.build.logging.GrailsConsole] を使用することもできます。特に情報のログをとるための、 <code>log()</code> 、 <code>info()</code> 、エラーや警告用に <code>error()</code> 、 <code>warning()</code> を使用したり、ユーザからの入力を要求する場合は <code>userInput()</code> を使用できます。<p class="paragraph"/><h4>カスタムプラグインリポジトリー <div class="hidden-block">Custom Plugin Repositories </div></h4><p class="paragraph"/>Many plugins have dependencies, both other plugins and straight JAR libraries. These are often located in Maven Central, the Grails core repository or the Grails Central Plugin Repository in which case applications are largely unaffected if they upgrade to Grails 2. But sometimes such dependencies are located elsewhere and Grails must be told where they can be found.<p class="paragraph"/>Due to changes in the way Grails handles the resolution of dependencies, Grails 2.0 requires you to add any such <a href="../guide/single.html#dependencyRepositories" class="guide">custom repository locations</a> to your project if an affected plugin is to install properly.<p class="paragraph"/><h4>Ivyキャッシュ場所が変更 <div class="hidden-block">Ivy cache location has changed </div></h4><p class="paragraph"/>The default Ivy cache location for Grails has changed. If the thought of yet another cache of JARs on your disk horrifies you, then you can change this in your <code>settings.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.dependency.cache.dir = <span class="java&#45;quote">"$&#123;userHome&#125;/.ivy2/cache"</span></pre></div><p class="paragraph"/>If you do this, be aware that you may run into problems running Grails 2 and earlier versions of Grails side-by-side. These problems can be avoided by excluding "xml-apis" and "commons-digester" from the inherited global dependencies in Grails 1.3 and earlier projects.<p class="paragraph"/><h4>URL型のドメインプロパティ<div class="hidden-block">URL Domain Properties </div></h4><p class="paragraph"/>If your domain model has any properties of type <code>java.net.URL</code>, they may cease to work once you upgrade to Grails 2. It seems that the default mapping of <code>URL</code> to database column has changed with the new version of Hibernate. This is a tricky problem to solve, but in the long run it's best if you migrate your <code>URL</code> properties to strings. One technique is to use the <a href="http://grails.org/plugin/database-migration" target="blank">database migration plugin</a> to add a new text column and then execute some code in <code>BootStrap</code> (using Grails 1.3.x or earlier) to fetch each row of the table as a domain instance, convert the <code>URL</code> properties to string URLs, and then write those values to the new column.<p class="paragraph"/><h4>基盤となるAPIの更新 <div class="hidden-block">Updated Underlying APIs</div></h4><p class="paragraph"/><div class="hidden-block">Grails 2.0 contains updated dependencies including Servlet 3.0, Tomcat 7, Spring 3.1, Hibernate 3.6 and Groovy 1.8. This means that certain plugins and applications that depend on earlier versions of these APIs may no longer work. For example the Servlet 3.0 <code>HttpServletRequest</code> interface includes new methods, so if a plugin implements this interface for Servlet 2.5 but not for Servlet 3.0 then said plugin will break. The same can be said of any Spring interface.</div>
Grails 2.0では、Servlet 3.0、Tomcat 7、Spring 3.1、Hibernate 3.6、Groovy 1.8などのライブラリを更新しました。以前のバージョンのプラグインなどでこれらのライブラリに依存がある場合動作しなくなります。例としてServlet 3.0の <code>HttpServletRequest</code> インターフェイスは新しい物を多く含んでいます。この逆もあり得るので、Servlet 2.5のインターフェイスで実装され、Servlet 3.0に存在しない機能を持っているプラグインは動作しません。もちろんこの事はSpringなど他のライブラリにも同じ事が言えます。注意しましょう。<p class="paragraph"/><h4>release-pluginコマンド除去 <div class="hidden-block">Removal of release-plugin</div></h4><p class="paragraph"/><div class="hidden-block">
The built in <code>release-plugin</code> command for releases plugins to the central Grails plugin repository has been removed. The new <a href="http://grails.org/plugin/release" target="blank">release</a> plugin should be used instead which provides an equivalent <code>publish-plugin</code> command.
</div>
プラグインを公式リポジトリに発行するコマンド <code>release-plugin</code> が除去されました。新たに <a href="http://grails.org/plugin/release" target="blank">リリースプラグイン</a> を使用して同じ意味を持つ  <code>publish-plugin</code> コマンドを使用してください。<p class="paragraph"/><h4>非推奨クラスの除去 <div class="hidden-block">Removal of Deprecated Classes</div></h4><p class="paragraph"/><div class="hidden-block">The following deprecated classes have been removed: <code>grails.web.JsonBuilder</code>, <code>grails.web.OpenRicoBuilder</code></div>
次のクラスが除去されました。 <code>grails.web.JsonBuilder</code> , <code>grails.web.OpenRicoBuilder</code><p class="paragraph"/><h3>Grails 1.2.x からのアップグレード <div class="hidden-block">Upgrading from Grails 1.2.x</div></h3><p class="paragraph"/><h4>プラグイン・リポジトリ <div class="hidden-block">Plugin Repositories</div></h4><p class="paragraph"/><div class="hidden-block">As of Grails 1.3, Grails no longer natively supports resolving plugins against secured SVN repositories. The plugin resolution mechanism in Grails 1.2 and below has been replaced by one built on <a href="http://ant.apache.org/ivy/" target="blank">Ivy</a>, the upside of which is that you can now resolve Grails plugins against Maven repositories as well as regular Grails repositories.</div>
Grails 1.3では、認証付きSVNリポジトリ内のプラグイン解決に標準では対応しなくなりました。Grails 1.2以前のプラグイン解決の仕組みは、<a href="http://ant.apache.org/ivy/" target="blank">Ivy</a>をベースに構築された実装により、Grailsのライブラリと同等にMavenリポジトリを対象に、プラグイン解決の仕組みに変更されました。<p class="paragraph"/><div class="hidden-block">
Ivy supports a much richer set of repository resolvers for resolving plugins, including support for Webdav, HTTP, SSH and FTP. See the section on <a href="http://ant.apache.org/ivy/history/trunk/settings/resolvers.html" target="blank">resolvers</a> in the Ivy docs for all the available options and the section of <a href="../guide/single.html#repositories" class="guide">plugin repositories</a> in the user guide which explains how to configure additional resolvers.
</div>
Ivyでは、WebDAV, HTTP, SSHやFTPなど豊富なリポジトリ解決方法があります。利用可能なオプションについてはIvyのドキュメントの<a href="http://ant.apache.org/ivy/history/trunk/settings/resolvers.html" target="blank">リゾルバのセクション</a>を、追加のリゾルバの設定方法については、このユーザーガイドのプラグイン・リポジトリのセクションを参照してください。<p class="paragraph"/><div class="hidden-block">If you still need support for resolving plugins against secured SVN repositories then the <a href="http://code.google.com/p/ivysvn/" target="blank">IvySvn</a> project provides a set of resolvers for SVN repositories.</div>
認証付きSVNリポジトリ内に対してのプラグイン解決が必要な場合は、SVNリポジトリに対してのIvyリゾルバを提供している<a href="http://code.google.com/p/ivysvn/" target="blank">IvySvn</a>プロジェクトを参考にしてください。<p class="paragraph"/><h3>Grails 1.1.x からのアップグレード <div class="hidden-block">Upgrading from Grails 1.1.x</div></h3><p class="paragraph"/><blockquote class="warning">
翻訳チームの判断により、Grails 1.1.xからの更新は翻訳を行いません。ご了承ください。
</blockquote><p class="paragraph"/><h4>プラグインのパス <div class="hidden-block">Plugin paths</div></h4><p class="paragraph"/><div class="hidden-block">In Grails 1.1.x typically a <code>pluginContextPath</code> variable was used to establish paths to plugin resources. For example:</div>
Grails 1.1.xではプラグイン内のリソースを参照するために変数<code>pluginContextPath</code>が、以下のように使用されていました:<p class="paragraph"/><div class="code"><pre>&#60;g:resource dir=<span class="java&#45;quote">"$&#123;pluginContextPath&#125;/images"</span> file=<span class="java&#45;quote">"foo.jpg"</span> /&#62;</pre></div><p class="paragraph"/><div class="hidden-block">In Grails 1.2 views have been made plugin aware and this is no longer necessary:</div>
Grails 1.2からはプラグイン認識されるため、この変数は不要になりました:<p class="paragraph"/><div class="code"><pre>&#60;g:resource dir=<span class="java&#45;quote">"images"</span> file=<span class="java&#45;quote">"foo.jpg"</span> /&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Additionally the above example will no longer link to an application image from a plugin view. To do so change the above to:</div>
この変更により、上記の例ではプラグイン内のビューからアプリケーション本体の/imagesなどへのパスを生成しません。従って、アプリケーション本体へのパスを生成するためには、次のようにする必要があります:<p class="paragraph"/><div class="code"><pre>&#60;g:resource contextPath=<span class="java&#45;quote">""</span> dir=<span class="java&#45;quote">"images"</span> file=<span class="java&#45;quote">"foo.jpg"</span> /&#62;</pre></div><p class="paragraph"/><div class="hidden-block">The same rules apply to the <a href="../ref/Tags/javascript.html" class="tags">javascript</a> and <a href="../ref/Tags/render.html" class="tags">render</a> tags.</div>
<a href="../ref/Tags/javascript.html" class="tags">javascript</a>タグや<a href="../ref/Tags/render.html" class="tags">render</a>タグも同様の記述ができます。<p class="paragraph"/><h4>タグとボディの戻り値 <div class="hidden-block">Tag and Body return values</div></h4><p class="paragraph"/><div class="hidden-block">Tags no longer return <code>java.lang.String</code> instances but instead return a Grails <code>StreamCharBuffer</code> instance. The <code>StreamCharBuffer</code> class implements all the same methods as <code>String</code> but doesn't extend <code>String</code>, so code like this will break:</div>
タグは<code>java.lang.String</code>インスタンスを返さず、その代わりに<code>StreamCharBuffer</code>インスタンスを返します。<code>StreamCharBuffer</code>クラスは、<code>String</code>と同じメソッドを実装していますが、このようなコードの場合は破綻します:<p class="paragraph"/><div class="code"><pre>def foo = body()
<span class="java&#45;keyword">if</span> (foo <span class="java&#45;keyword">instanceof</span> <span class="java&#45;object">String</span>) &#123;
    // <span class="java&#45;keyword">do</span> something
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In these cases you should check for the <code>java.lang.CharSequence</code> interface, which both <code>String</code> and <code>StreamCharBuffer</code> implement:</div>
この場合、<code>String</code>と<code>StreamCharBuffer</code>の両方が実装している<code>java.lang.CharSequence</code>インタフェースを使用します:<p class="paragraph"/><div class="code"><pre>def foo = body()
<span class="java&#45;keyword">if</span> (foo <span class="java&#45;keyword">instanceof</span> CharSequence) &#123;
    // <span class="java&#45;keyword">do</span> something
&#125;</pre></div><p class="paragraph"/><h4>新しいJSONBuilder <div class="hidden-block">New JSONBuilder</div></h4><p class="paragraph"/>There is a new version of <code>JSONBuilder</code> which is semantically different from the one used in earlier versions of Grails. However, if your application depends on the older semantics you can still use the deprecated implementation by setting the following property to <code>true</code> in Config.groovy:<p class="paragraph"/><div class="code"><pre>grails.json.legacy.builder=<span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><h4>フラッシュでのバリデーション <div class="hidden-block">Validation on Flush</div></h4><p class="paragraph"/>Grails now executes validation routines when the underlying Hibernate session is flushed to ensure that no invalid objects are persisted. If one of your constraints (such as a custom validator) executes a query then this can cause an additional flush, resulting in a <code>StackOverflowError</code>. For example:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> constraints = &#123;
    author validator: &#123; a &#45;&#62;
        assert a != Book.findByTitle(<span class="java&#45;quote">"My Book"</span>).author
    &#125;
&#125;</pre></div><p class="paragraph"/>The above code can lead to a <code>StackOverflowError</code> in Grails 1.2. The solution is to run the query in a new Hibernate <code>session</code> (which is recommended in general as doing Hibernate work during flushing can cause other issues):<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> constraints = &#123;
    author validator: &#123; a &#45;&#62;
        Book.withNewSession &#123;
            assert a != Book.findByTitle(<span class="java&#45;quote">"My Book"</span>).author
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Grails 1.0.xからのアップグレード <div class="hidden-block">Upgrading from Grails 1.0.x</div></h3><p class="paragraph"/><blockquote class="warning">
翻訳チームの判断により、Grails 1.0.xからの更新は翻訳を行いません。ご了承ください。
</blockquote><p class="paragraph"/><h4>Groovy 1.6</h4><p class="paragraph"/>Grails 1.1 and above ship with Groovy 1.6 and no longer supports code compiled against Groovy 1.5. If you have a library that was compiled with Groovy 1.5 you must recompile it against Groovy 1.6 or higher before using it with Grails 1.1.<p class="paragraph"/><h4>Java 5.0</h4><p class="paragraph"/>Grails 1.1 now no longer supports JDK 1.4, if you wish to continue using Grails then it is recommended you stick to the Grails 1.0.x stream until you are able to upgrade your JDK.<p class="paragraph"/><h4>Configuration Changes</h4><p class="paragraph"/>1) The setting <code>grails.testing.reports.destDir</code> has been renamed to <code>grails.project.test.reports.dir</code> for consistency.<p class="paragraph"/>2) The following settings have been moved from <code>grails-app/conf/Config.groovy</code> to <code>grails-app/conf/BuildConfig.groovy</code>:
<ul class="star">
<ul class="star">
<li><code>grails.config.base.webXml</code></li>
<li><code>grails.project.war.file</code> (renamed from <code>grails.war.destFile</code>)</li>
<li><code>grails.war.dependencies</code></li>
<li><code>grails.war.copyToWebApp</code></li>
<li><code>grails.war.resources</code></li>
</ul></ul><p class="paragraph"/>3) The <code>grails.war.java5.dependencies</code> option is no longer supported, since Java 5.0 is now the baseline (see above).<p class="paragraph"/>4) The use of jsessionid (now considered harmful) is disabled by default. If your application requires jsessionid you can re-enable its usage by adding the following to <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.views.enable.jsessionid=<span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/>5) The syntax used to configure Log4j has changed. See the user guide section on <a href="../guide/single.html#logging" class="guide">Logging</a> for more information.<p class="paragraph"/><h4>Plugin Changes</h4><p class="paragraph"/>As of version 1.1, Grails no longer stores plugins inside your <code>PROJECT_HOME/plugins</code> directory by default. This may result in compilation errors in your application unless you either re-install all your plugins or set the following property in <code>grails-app/conf/BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.project.plugins.dir=<span class="java&#45;quote">"./plugins"</span></pre></div><p class="paragraph"/><h4>Script Changes</h4><p class="paragraph"/>1) If you were previously using Grails 1.0.3 or below the following syntax is no longer support for importing scripts from GRAILS_HOME:<p class="paragraph"/><div class="code"><pre>Ant.property(environment:<span class="java&#45;quote">"env"</span>)
grailsHome = Ant.antProject.properties.<span class="java&#45;quote">"env.GRAILS_HOME"</span><p class="paragraph"/>includeTargets &#60;&#60; <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"$&#123;grailsHome&#125;/scripts/Bootstrap.groovy"</span>)</pre></div><p class="paragraph"/>Instead you should use the new <code>grailsScript</code> method to import a named script:<p class="paragraph"/><div class="code"><pre>includeTargets &#60;&#60; grailsScript(<span class="java&#45;quote">"_GrailsBootstrap"</span>)</pre></div><p class="paragraph"/>2) Due to an upgrade of Gant all references to the variable <code>Ant</code> should be changed to <code>ant</code>.<p class="paragraph"/>3) The root directory of the project is no longer on the classpath, so loading a resource like this will no longer work:<p class="paragraph"/><div class="code"><pre>def stream = getClass().classLoader.getResourceAsStream(
                   <span class="java&#45;quote">"grails&#45;app/conf/my&#45;config.xml"</span>)</pre></div><p class="paragraph"/>Instead you should use the Java File APIs with the <code>basedir</code> property:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"$&#123;basedir&#125;/grails&#45;app/conf/my&#45;config.xml"</span>).withInputStream &#123; stream &#45;&#62;
    // read the file
&#125;</pre></div><p class="paragraph"/><h4>Command Line Changes</h4><p class="paragraph"/>The <code>run-app-https</code> and <code>run-war-https</code> commands no longer exist and have been replaced by an argument to <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>:<p class="paragraph"/><div class="code"><pre>grails run&#45;app &#45;https</pre></div><p class="paragraph"/><h4>Data Mapping Changes</h4><p class="paragraph"/>1) Enum types are now mapped using their String value rather than the ordinal value. You can revert to the old behavior by changing your mapping as follows:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mapping = &#123;
    someEnum enumType:<span class="java&#45;quote">"ordinal"</span>
&#125;</pre></div><p class="paragraph"/>2) Bidirectional one-to-one associations are now mapped with a single column on the owning side and a foreign key reference. You shouldn't need to change anything; however you should drop column on the inverse side as it contains duplicate data.<p class="paragraph"/><h4>REST Support</h4><p class="paragraph"/>Incoming XML requests are now no longer automatically parsed. To enable parsing of REST requests you can do so using the <code>parseRequest</code> argument inside a URL mapping:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/book"</span>(controller:<span class="java&#45;quote">"book"</span>,parseRequest:<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>Alternatively, you can use the new <code>resource</code> argument, which enables parsing by default:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/book"</span>(resource:<span class="java&#45;quote">"book"</span>)</pre></div>


<a name="3. Configuration"><!-- Legacy link --></a>
<h1 id="conf">4 設定</h1>
<div class="hidden-block">It may seem odd that in a framework that embraces "convention-over-configuration" that we tackle this topic now. With Grails' default settings you can actually develop an application without doing any configuration whatsoever, as the quick start demonstrates, but it's important to learn where and how to override the conventions when you need to. Later sections of the user guide will mention what configuration settings you can use, but not how to set them. The assumption is that you have at least read the first section of this chapter!</div>
設定より規約(convention-over-configuration)を採用したフレームワークにおいて設定の説明をするのは、なんだかおかしく思えるかもしれません。
クイックスタートにあるように、Grailsのデフォルト設定を使用すると、実際には一切設定をすることなくアプリケーション開発を始めることができますが、必要な時に規約をどこでどのようにオーバーライドするのか学んでおくことは重要です。
これ以降のセクションでは、どんな設定が利用できるかについては言及しますが、どのように設定するかは言及しません。
というのは、少なくともこの章の最初のセクションは読むだろうと仮定しているからです！


<a name="3.1 Basic Configuration"><!-- Legacy link --></a>
<h2 id="config">4.1 基本設定</h2>
<div class="hidden-block">
For general configuration Grails provides two files:
</div>
Grailsでは一般的な設定を行うために2つのファイルを提供しています:
<ul class="star">
<li><code>grails-app/conf/BuildConfig.groovy</code></li>
<li><code>grails-app/conf/Config.groovy</code></li>
</ul><p class="paragraph"/><div class="hidden-block">
Both of them use Groovy's <a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a> syntax. The first, <code>BuildConfig.groovy</code>, is for settings that are used when running Grails commands, such as <code>compile</code>, <code>doc</code>, etc. The second file, <code>Config.groovy</code>, is for settings that are used when your application is running. This means that <code>Config.groovy</code> is packaged with your application, but <code>BuildConfig.groovy</code> is not. Don't worry if you're not clear on the distinction: the guide will tell you which file to put a particular setting in.
</div>
両方ともGroovyの<a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a>の構文を使用しています。
1つめの<code>BuildConfig.groovy</code>は<code>compile</code>や<code>doc</code>等のようなGrailsコマンドを実行するときに使われる設定です。
2つめの<code>Config.groovy</code>はアプリケーションを実行するときに使われる設定です。
つまり、<code>Config.groovy</code>はアプリケーションにパッケージされますが、<code>BuildConfig.groovy</code>はされません。
違いがよく分からなくても心配する必要はありません。
どの設定をどのファイルに書くべきかはこのガイドで示していきます。<p class="paragraph"/><div class="hidden-block">
The most basic syntax is similar to that of Java properties files with dot notation on the left-hand side:
</div>
左辺にJavaのプロパティファイルのような、ドット区切りの文があるものが最も基本的な構文となります:<p class="paragraph"/><div class="code"><pre>foo.bar.hello = <span class="java&#45;quote">"world"</span></pre></div><p class="paragraph"/><div class="hidden-block">
Note that the value is a Groovy string literal! Those quotes around 'world' are important. In fact, this highlights one of the advantages of the ConfigSlurper syntax over properties files: the property values can be any valid Groovy type, such as strings, integers, or arbitrary objects!
</div>
この値がGroovyの文字列リテラルであることに注意してください！
'world'を囲んでいる引用符が重要です。
実際に、これがプロパティファイルに対するConfigSlurperのシンタックスの有利な点の1つを際立たせています。
プロパティの値は文字列や整数、任意のオブジェクトのような、Groovyとして有効な型を取ることができるのです！<p class="paragraph"/><div class="hidden-block">
Things become more interesting when you have multiple settings with the same base. For example, you could have the two settings
</div>
同じベースで複数の設定をすると、もっとおもしろいことになります。
例えば、2つの設定を持つことができます。<p class="paragraph"/><div class="code"><pre>foo.bar.hello = <span class="java&#45;quote">"world"</span>
foo.bar.good = <span class="java&#45;quote">"bye"</span></pre></div><p class="paragraph"/><div class="hidden-block">
both of which have the same base: <code>foo.bar</code>. The above syntax works but it's quite repetitive and verbose. You can remove some of that verbosity by nesting properties at the dots:
</div>
両方とも<code>foo.bar</code>という同じベースを持っています。
上記の構文は動作しますが、繰り返しがかなり冗長です。
プロパティのドットの箇所でネストして、冗長さを無くすことができます:<p class="paragraph"/><div class="code"><pre>foo &#123;
    bar &#123;
        hello = <span class="java&#45;quote">"world"</span>
        good = <span class="java&#45;quote">"bye"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
or by only partially nesting them:
</div>
または、それらを一部だけネストできます:<p class="paragraph"/><div class="code"><pre>foo &#123;
    bar.hello = <span class="java&#45;quote">"world"</span>
    bar.good = <span class="java&#45;quote">"bye"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
However, you can't nest after using the dot notation. In other words, this <strong class="bold">won't</strong> work:
</div>
しかしながら、ドット区切りの後にネストを使うことはできません。
つまり、これは動作<strong class="bold">しません</strong>:<p class="paragraph"/><div class="code"><pre>// Won't work!
foo.bar &#123;
    hello = <span class="java&#45;quote">"world"</span>
    good = <span class="java&#45;quote">"bye"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Within both <code>BuildConfig.groovy</code> and <code>Config.groovy</code> you can access several implicit variables from configuration values:
</div>
<code>BuildConfig.groovy</code>と<code>Config.groovy</code>内では、設定値からいくつかの暗黙の変数にアクセスできます:<p class="paragraph"/><div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Variable</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>userHome</td><td>Location of the home directory for the account that is running the Grails application.</td></tr><tr class="table-even"><td>grailsHome</td><td>Location of the home directory for the account that is running the Grails application.</td></tr><tr class="table-odd"><td>appName</td><td>The application name as it appears in application.properties.</td></tr><tr class="table-even"><td>appVersion</td><td>The application version as it appears in application.properties.</td></tr></table>
</div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">変数</strong></th><th><strong class="bold">説明</strong></th></tr><tr class="table-odd"><td>userHome</td><td>Grailsアプリケーションを実行しているアカウントのホームディレクトリの場所です。</td></tr><tr class="table-even"><td>grailsHome</td><td>Grailsがインストールされているディレクトリの場所です。環境変数<code>GRAILS_HOME</code>が設定されているときはその値が格納されます。</td></tr><tr class="table-odd"><td>appName</td><td>application.properties内に表記しているアプリケーション名です。</td></tr><tr class="table-even"><td>appVersion</td><td>application.properties内に表記しているアプリケーションバージョンです。</td></tr></table><p class="paragraph"/><div class="hidden-block">
For example:
</div>
例:<p class="paragraph"/><div class="code"><pre>my.tmp.dir = <span class="java&#45;quote">"&#36;&#123;userHome&#125;/.grails/tmp"</span></pre></div><p class="paragraph"/><div class="hidden-block">
In addition, <code>BuildConfig.groovy</code> has
</div>
加えて、<code>BuildConfig.groovy</code>は以下の変数を持っています。<p class="paragraph"/><div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Variable</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>grailsVersion</td><td>The version of Grails used to build the project.</td></tr><tr class="table-even"><td>grailsSettings</td><td>An object containing various build related settings, such as <code>baseDir</code>. It's of type <a href="http://grails.org/doc/latest/api/grails/util/BuildSettings.html" class="api"><code>BuildSettings</code></a>.</td></tr></table>
</div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">変数</strong></th><th><strong class="bold">説明</strong></th></tr><tr class="table-odd"><td>grailsVersion</td><td>プロジェクトをビルドするために使われたGrailsのバージョンです。</td></tr><tr class="table-even"><td>grailsSettings</td><td><code>baseDir</code>のような、ビルドに関連する様々な設定を格納したオブジェクトです。型は<a href="http://grails.org/doc/latest/api/grails/util/BuildSettings.html" class="api"><code>BuildSettings</code></a>です。</td></tr></table><p class="paragraph"/><div class="hidden-block">
and <code>Config.groovy</code> has
</div>
また、<code>Config.groovy</code>は以下の変数を持っています。<p class="paragraph"/><div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Variable</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>grailsApplication</td><td>The <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api"><code>GrailsApplication</code></a> instance.</td></tr></table>
</div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">変数</strong></th><th><strong class="bold">説明</strong></th></tr><tr class="table-odd"><td>grailsApplication</td><td><a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api"><code>GrailsApplication</code></a>のインスタンスです。</td></tr></table><p class="paragraph"/><div class="hidden-block">
Those are the basics of adding settings to the configuration file, but how do you access those settings from your own application? That depends on which config you want to read.
</div>
ここまでは設定ファイルに設定を追加するための基本についてでしたが、アプリケーション自身からどのようにそれらの設定にアクセスするのでしょうか？
それはどの設定を読みたいかによります。<p class="paragraph"/><div class="hidden-block">
The settings in <code>BuildConfig.groovy</code> are only available from <a href="../guide/single.html#creatingGantScripts" class="guide">command scripts</a> and can be accessed via the <code>grailsSettings.config</code> property like so:
</div>
<code>BuildConfig.groovy</code>内の設定は<a href="../guide/single.html#creatingGantScripts" class="guide">コマンドスクリプト</a>からしか取得できません。
以下のように<code>grailsSettings.config</code>プロパティを経由してアクセスできます:<p class="paragraph"/><div class="code"><pre>target(<span class="java&#45;keyword">default</span>: <span class="java&#45;quote">"Example command"</span>) &#123;
    def maxIterations = grailsSettings.config.myapp.iterations.max
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If you want to read runtime configuration settings, i.e. those defined in <code>Config.groovy</code>, use the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api"><code>grailsApplication</code></a> object, which is available as a variable in controllers and tag libraries:
</div>
実行時の設定、すなわち<code>Config.groovy</code>に定義されたものを読みたい場合は、<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api"><code>grailsApplication</code></a>オブジェクトを使って、コントローラやタグライブラリから変数として取得できます:<p class="paragraph"/><div class="code"><pre>class MyController &#123;
    def hello() &#123;
        def recipient = grailsApplication.config.foo.bar.hello<p class="paragraph"/>        render <span class="java&#45;quote">"Hello $&#123;recipient&#125;"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
and can be easily injected into services and other Grails artifacts:
</div>
また、サービスやその他のGrailsアーティファクトへ簡単に注入することができます:<p class="paragraph"/><div class="code"><pre>class MyService &#123;
    def grailsApplication<p class="paragraph"/>    <span class="java&#45;object">String</span> greeting() &#123;
        def recipient = grailsApplication.config.foo.bar.hello
        <span class="java&#45;keyword">return</span> <span class="java&#45;quote">"Hello $&#123;recipient&#125;"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
As you can see, when accessing configuration settings you use the same dot notation as when you define them.
</div>
ご覧の通り、設定を取得するときは、それらを定義したときと同じようにドット区切り表記を用います。


<a name="3.1.1 Built in options"><!-- Legacy link --></a>
<h2 id="builtInOptions">4.1.1 組込オプション</h2>
<div class="hidden-block">
Grails has a set of core settings that are worth knowing about. Their defaults are suitable for most projects, but it's important to understand what they do because you may need one or more of them later.
</div>
Grailsには知っておくべき基本設定の一式があります。
それらのデフォルトは多くのプロジェクトに適していますが、後で設定が必要になった時のために、それが何の設定であるか理解しておくことが重要です。<p class="paragraph"/><div class="hidden-block">
<h3>Build settings</h3>
</div>
<h3>ビルド設定</h3><p class="paragraph"/><div class="hidden-block">
Let's start with some important build settings. Although Grails requires JDK 6 when developing your applications, it is possible to deploy those applications to JDK 5 containers. Simply set the following in <code>BuildConfig.groovy</code>:
</div>
いくつかの重要なビルド設定から始めましょう。
アプリケーションを開発するとき、GrailsはJDK 6を必要としますが、それらのアプリケーションをJDK 5で動作しているコンテナへデプロイすることが可能です。
単純に<code>BuildConfig.groovy</code>内で次のように設定します:<p class="paragraph"/><div class="code"><pre>grails.project.source.level = <span class="java&#45;quote">"1.5"</span>
grails.project.target.level = <span class="java&#45;quote">"1.5"</span></pre></div><p class="paragraph"/><div class="hidden-block">
Note that source and target levels are different to the standard public version of JDKs, so JDK 5 -&#62; 1.5, JDK 6 -&#62; 1.6, and JDK 7 -&#62; 1.7.
</div>
ただし、ソースとターゲットレベルはJDKの標準公開バージョンと異なり、JDK 5は1.5、JDK 6は1.6、そしてJDK 7は1.7となるようにしてください。<p class="paragraph"/><div class="hidden-block">
In addition, Grails supports Servlet versions 2.5 and above but defaults to 2.5. If you wish to use newer features of the Servlet API (such as 3.0 async support) you should configure the <code>grails.servlet.version</code> setting appropriately:
</div>
加えて、Grailsはサーブレットバージョン2.5以上をサポートし、デフォルトは2.5です。
もし(3.0の非同期サポートのような)サーブレットAPIの新しい機能を使いたければ、<code>grails.servlet.version</code>を適切に設定します:<p class="paragraph"/><div class="code"><pre>grails.servlet.version = <span class="java&#45;quote">"3.0"</span></pre></div><p class="paragraph"/><div class="hidden-block">
<h3>Runtime settings</h3>
</div>
<h3>ランタイム設定</h3><p class="paragraph"/><div class="hidden-block">
On the runtime front, i.e. <code>Config.groovy</code>, there are quite a few more core settings:
</div>
ランタイムフロント、すなわち<code>Config.groovy</code>には非常に多くのコアな設定があります:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>grails.config.locations</code>  - The location of properties files or addition Grails Config files that should be merged with main configuration. See the <a href="../guide/single.html#configExternalized" class="guide">section on externalised config</a>.</li>
<li><code>grails.enable.native2ascii</code> - Set this to false if you do not require native2ascii conversion of Grails i18n properties files (default: true).</li>
<li><code>grails.views.default.codec</code> - Sets the default encoding regime for GSPs - can be one of 'none', 'html', or 'base64' (default: 'none'). To reduce risk of XSS attacks, set this to 'html'.</li>
<li><code>grails.views.gsp.encoding</code> - The file encoding used for GSP source files (default: 'utf-8').</li>
<li><code>grails.mime.file.extensions</code> - Whether to use the file extension to dictate the mime type in <a href="../guide/single.html#contentNegotiation" class="guide">Content Negotiation</a> (default: true).</li>
<li><code>grails.mime.types</code> - A map of supported mime types used for <a href="../guide/single.html#contentNegotiation" class="guide">Content Negotiation</a>.</li>
<li><code>grails.serverURL</code> - A string specifying the server URL portion of absolute links, including server name e.g. grails.serverURL="http://my.yourportal.com". See <a href="../ref/Tags/createLink.html" class="Tags">createLink</a>. Also used by redirects.</li>
<li><code>grails.views.gsp.sitemesh.preprocess</code> - Determines whether SiteMesh preprocessing happens. Disabling this slows down page rendering, but if you need SiteMesh to parse the generated HTML from a GSP view then disabling it is the right option. Don't worry if you don't understand this advanced property: leave it set to true.</li>
<li><code>grails.reload.excludes</code> and <code>grails.reload.includes</code> - Configuring these directives determines the reload behavior for project specific source files. Each directive takes a list of strings that are the class names for project source files that should be excluded from reloading behavior or included accordingly when running the application in development with the <code>run-app</code> command. If the <code>grails.reload.includes</code> directive is configured, then only the classes in that list will be reloaded.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>grails.config.locations</code>  - メイン設定にマージされるべきプロパティファイルや追加のGrails設定ファイルの場所です。<a href="../guide/single.html#configExternalized" class="guide">設定の外部化</a>セクションを参照してください。</li>
<li><code>grails.enable.native2ascii</code> - Grailsのi18nプロパティファイルのnative2ascii変換が必要ない場合はこれをfalseに設定します(デフォルト: true)。</li>
<li><code>grails.views.default.codec</code> - GSPのデフォルトエンコーディング形式を設定します。'none'、'html'、または'base64'のいずれかを設定できます(デフォルト: none)。XSS攻撃によるリスクを減らすためには、これを'html'に設定します。</li>
<li><code>grails.views.gsp.encoding</code> - GSPのソースファイルに使用するファイルエンコーディングです(デフォルト: 'utf-8')。</li>
<li><code>grails.mime.file.extensions</code> - <a href="../guide/single.html#contentNegotiation" class="guide">コンテントネゴシエーション</a>においてmime typeの判定にファイルの拡張子を使うかどうかです。(デフォルト: true)</li>
<li><code>grails.mime.types</code> - <a href="../guide/single.html#contentNegotiation" class="guide">コンテントネゴシエーション</a>で使う、サポートするMIMEタイプのマップです。</li>
<li><code>grails.serverURL</code> - 絶対リンクのサーバURLの部分を指定する文字列です。grails.serverURL="http://my.yourportal.com"のようにサーバ名を含みます。<a href="../ref/Tags/createLink.html" class="Tags">createLink</a>を参照してください。この設定はリダイレクトにも使われます。</li>
<li><code>grails.views.gsp.sitemesh.preprocess</code> - SiteMeshプリプロセッシングさせるかどうかを決めます。これを無効にするとページのレンダリングが遅くなりますが、GSPビューから生成されたHTMLをパースするためにSiteMeshが必要であれば、無効にすることは正しい選択です。この上級者向けのプロパティを理解していなくても気にする必要はありません。trueのままにしておきましょう。</li>
<li><code>grails.reload.excludes</code>と<code>grails.reload.includes</code> - このディレクティブの設定は、プロジェクト固有のソースファイルに対するリロードの挙動を決めます。それぞれのディレクティブは文字列のリストを取ります。この文字列は<code>run-app</code>コマンドを使って開発時にアプリケーションを動作させる際、リロード対象から除外または含めるべきプロジェクトのソースファイルのクラス名です。<code>grails.reload.includes</code>ディレクティブが設定されている場合、リストにあるクラスだけがリロードされます。</li>
</ul><p class="paragraph"/><div class="hidden-block">
<h3>War generation</h3>
</div>
<h3>Warの生成</h3><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>grails.project.war.file</code> - Sets the name and location of the WAR file generated by the <a href="../ref/Command Line/war.html" class="commandLine">war</a> command</li>
<li><code>grails.war.dependencies</code> - A closure containing Ant builder syntax or a list of JAR filenames. Lets you customise what libaries are included in the WAR file.</li>
<li><code>grails.war.copyToWebApp</code> - A closure containing Ant builder syntax that is legal inside an Ant copy, for example "fileset()". Lets you control what gets included in the WAR file from the "web-app" directory.</li>
<li><code>grails.war.resources</code> - A closure containing Ant builder syntax. Allows the application to do any other other work before building the final WAR file</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>grails.project.war.file</code> - <a href="../ref/Command Line/war.html" class="commandLine">war</a>コマンドによって生成されるWARファイルの名前と場所を設定します。</li>
<li><code>grails.war.dependencies</code> - Antビルダシンタックスを含むクロージャ、またはJARファイル名のリストです。WARファイルに含まれるライブラリをカスタマイズできます。</li>
<li><code>grails.war.copyToWebApp</code> - "fileset()"等のAntコピーで定義されているAntビルダシンタックスを含むクロージャです。WARファイルに含めるために、"web-app"ディレクトリから何を取得するかを制御できます。</li>
<li><code>grails.war.resources</code> - Antビルダシンタックスを含むクロージャです。最終的にWARファイルをビルドする前に、その他の作業を行うことをアプリケーションに許可します。</li>
</ul><p class="paragraph"/><div class="hidden-block">
For more information on using these options, see the section on <a href="../guide/single.html#deployment" class="guide">deployment</a>
</div>
これらのオプションの使用についての詳細は、<a href="../guide/single.html#deployment" class="guide">デプロイ</a>セクションを参照してください。


<a name="3.1.2 Logging"><!-- Legacy link --></a>
<h2 id="logging">4.1.2 ロギング</h2>
<h3>The Basics</h3><p class="paragraph"/>Grails uses its common configuration mechanism to provide the settings for the underlying <a href="http://logging.apache.org/log4j/1.2/index.html" target="blank">Log4j</a> log system, so all you have to do is add a <code>log4j</code> setting to the file <code>grails-app/conf/Config.groovy</code>.<p class="paragraph"/>So what does this <code>log4j</code> setting look like? Here's a basic example:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    error  'org.codehaus.groovy.grails.web.servlet',  //  controllers
           'org.codehaus.groovy.grails.web.pages' //  GSP<p class="paragraph"/>    warn   'org.apache.catalina'
&#125;</pre></div><p class="paragraph"/>This says that for loggers whose name starts with 'org.codehaus.groovy.grails.web.servlet' or 'org.codehaus.groovy.grails.web.pages', only messages logged at 'error' level and above will be shown. Loggers with names starting with 'org.apache.catalina' logger only show messages at the 'warn' level and above. What does that mean? First of all, you have to understand how levels work.<p class="paragraph"/><h4>Logging levels</h4><p class="paragraph"/>The are several standard logging levels, which are listed here in order of descending priority:
<ol>
<li>off</li>
<li>fatal</li>
<li>error</li>
<li>warn</li>
<li>info</li>
<li>debug</li>
<li>trace</li>
<li>all</li>
</ol><p class="paragraph"/>When you log a message, you implicitly give that message a level. For example, the method <code>log.error(msg)</code> will log a message at the 'error' level. Likewise, <code>log.debug(msg)</code> will log it at 'debug'. Each of the above levels apart from 'off' and 'all' have a corresponding log method of the same name.<p class="paragraph"/>The logging system uses that  <em class="italic">message</em>  level combined with the configuration for the logger (see next section) to determine whether the message gets written out. For example, if you have an 'org.example.domain' logger configured like so:<p class="paragraph"/><div class="code"><pre>warn 'org.example.domain'</pre></div><p class="paragraph"/>then messages with a level of 'warn', 'error', or 'fatal' will be written out. Messages at other levels will be ignored.<p class="paragraph"/>Before we go on to loggers, a quick note about those 'off' and 'all' levels. These are special in that they can only be used in the configuration; you can't log messages at these levels. So if you configure a logger with a level of 'off', then no messages will be written out. A level of 'all' means that you will see all messages. Simple.<p class="paragraph"/><h4>Loggers</h4><p class="paragraph"/>Loggers are fundamental to the logging system, but they are a source of some confusion. For a start, what are they? Are they shared? How do you configure them?<p class="paragraph"/>A logger is the object you log messages to, so in the call <code>log.debug(msg)</code>, <code>log</code> is a logger instance (of type <a href="http://commons.apache.org/logging/apidocs/org/apache/commons/logging/Log.html" target="blank">Log</a>). These loggers are cached and uniquely identified by name, so if two separate classes use loggers with the same name, those loggers are actually the same instance.<p class="paragraph"/>There are two main ways to get hold of a logger:
<ol>
<li>use the <code>log</code> instance injected into artifacts such as domain classes, controllers and services;</li>
<li>use the Commons Logging API directly.</li>
</ol><p class="paragraph"/>If you use the dynamic <code>log</code> property, then the name of the logger is 'grails.app.&#60;type&#62;.&#60;className&#62;', where <code>type</code> is the type of the artifact, for example 'controllers' or 'services', and <code>className</code> is the fully qualified name of the artifact. For example, if you have this service:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> org.example<p class="paragraph"/>class MyService &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/>then the name of the logger will be 'grails.app.services.org.example.MyService'.<p class="paragraph"/>For other classes, the typical approach is to store a logger based on the class name in a constant static field:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> org.other<p class="paragraph"/><span class="java&#45;keyword">import</span> org.apache.commons.logging.LogFactory<p class="paragraph"/>class MyClass &#123;
    <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> log = LogFactory.getLog(<span class="java&#45;keyword">this</span>)
    &#8230;
&#125;</pre></div><p class="paragraph"/>This will create a logger with the name 'org.other.MyClass' - note the lack of a 'grails.app.' prefix since the class isn't an artifact. You can also pass a name to the <code>getLog()</code> method, such as "myLogger", but this is less common because the logging system treats names with dots ('.') in a special way.<p class="paragraph"/><h4>Configuring loggers</h4><p class="paragraph"/>You have already seen how to configure loggers in Grails:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    error  'org.codehaus.groovy.grails.web.servlet'
&#125;</pre></div><p class="paragraph"/>This example configures loggers with names starting with 'org.codehaus.groovy.grails.web.servlet' to ignore any messages sent to them at a level of 'warn' or lower. But is there a logger with this name in the application? No. So why have a configuration for it? Because the above rule applies to any logger whose name  <em class="italic">begins with</em>  'org.codehaus.groovy.grails.servlet.' as well. For example, the rule applies to both the <code>org.codehaus.groovy.grails.web.servlet.GrailsDispatcherServlet</code> class and the <code>org.codehaus.groovy.grails.web.servlet.mvc.GrailsWebRequest</code> one.<p class="paragraph"/>In other words, loggers are hierarchical. This makes configuring them by package much simpler than it would otherwise be.<p class="paragraph"/>The most common things that you will want to capture log output from are your controllers, services, and other artifacts. Use the convention mentioned earlier to do that:  <em class="italic">grails.app.&#60;artifactType&#62;.&#60;className&#62;</em> . In particular the class name must be fully qualifed, i.e. with the package if there is one:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    // Set level <span class="java&#45;keyword">for</span> all application artifacts
    info <span class="java&#45;quote">"grails.app"</span><p class="paragraph"/>    // Set <span class="java&#45;keyword">for</span> a specific controller in the <span class="java&#45;keyword">default</span> <span class="java&#45;keyword">package</span>
    debug <span class="java&#45;quote">"grails.app.controllers.YourController"</span><p class="paragraph"/>    // Set <span class="java&#45;keyword">for</span> a specific domain class
    debug <span class="java&#45;quote">"grails.app.domain.org.example.Book"</span><p class="paragraph"/>    // Set <span class="java&#45;keyword">for</span> all taglibs
    info <span class="java&#45;quote">"grails.app.taglib"</span>
&#125;</pre></div><p class="paragraph"/>The standard artifact names used in the logging configuration are:
<ul class="star">
<li><code>conf</code> - For anything under <code>grails-app/conf</code> such as <code>BootStrap.groovy</code> (but excluding filters)</li>
<li><code>filters</code> - For filters</li>
<li><code>taglib</code> - For tag libraries</li>
<li><code>services</code> - For service classes</li>
<li><code>controllers</code> - For controllers</li>
<li><code>domain</code> - For domain entities</li>
</ul><p class="paragraph"/>Grails itself generates plenty of logging information and it can sometimes be helpful to see that. Here are some useful loggers from Grails internals that you can use, especially when tracking down problems with your application:
<ul class="star">
<li><code>org.codehaus.groovy.grails.commons</code> - Core artifact information such as class loading etc.</li>
<li><code>org.codehaus.groovy.grails.web</code> - Grails web request processing</li>
<li><code>org.codehaus.groovy.grails.web.mapping</code> - URL mapping debugging</li>
<li><code>org.codehaus.groovy.grails.plugins</code> - Log plugin activity</li>
<li><code>grails.spring</code> - See what Spring beans Grails and plugins are defining</li>
<li><code>org.springframework</code> - See what Spring is doing</li>
<li><code>org.hibernate</code> - See what Hibernate is doing</li>
</ul><p class="paragraph"/>So far, we've only looked at explicit configuration of loggers. But what about all those loggers that  <em class="italic">don't</em>  have an explicit configuration? Are they simply ignored? The answer lies with the root logger.<p class="paragraph"/><h4>The Root Logger</h4><p class="paragraph"/>All logger objects inherit their configuration from the root logger, so if no explicit configuration is provided for a given logger, then any messages that go to that logger are subject to the rules defined for the root logger. In other words, the root logger provides the default configuration for the logging system.<p class="paragraph"/>Grails automatically configures the root logger to only handle messages at 'error' level and above, and all the messages are directed to the console (stdout for those with a C background). You can customise this behaviour by specifying a 'root' section in your logging configuration like so:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    root &#123;
        info()
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/>The above example configures the root logger to log messages at 'info' level and above to the default console appender. You can also configure the root logger to log to one or more named appenders (which we'll talk more about shortly):<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        file name:'file', file:'/<span class="java&#45;keyword">var</span>/logs/mylog.log'
    &#125;
    root &#123;
        debug 'stdout', 'file'
    &#125;
&#125;</pre></div><p class="paragraph"/>In the above example, the root logger will log to two appenders - the default 'stdout' (console) appender and a custom 'file' appender.<p class="paragraph"/>For power users there is an alternative syntax for configuring the root logger: the root <code>org.apache.log4j.Logger</code> instance is passed as an argument to the log4j closure. This lets you work with the logger directly:<p class="paragraph"/><div class="code"><pre>log4j = &#123; root &#45;&#62;
    root.level = org.apache.log4j.Level.DEBUG
    &#8230;
&#125;</pre></div><p class="paragraph"/>For more information on what you can do with this <code>Logger</code> instance, refer to the Log4j API documentation.<p class="paragraph"/>Those are the basics of logging pretty well covered and they are sufficient if you're happy to only send log messages to the console. But what if you want to send them to a file? How do you make sure that messages from a particular logger go to a file but not the console? These questions and more will be answered as we look into appenders.<p class="paragraph"/><h3>Appenders</h3><p class="paragraph"/>Loggers are a useful mechanism for filtering messages, but they don't physically write the messages anywhere. That's the job of the appender, of which there are various types. For example, there is the default one that writes messages to the console, another that writes them to a file, and several others. You can even create your own appender implementations&#33;<p class="paragraph"/>This diagram shows how they fit into the logging pipeline:<p class="paragraph"/><img border="0" class="center" src="../../img/logging.png"></img><p class="paragraph"/>As you can see, a single logger may have several appenders attached to it. In a standard Grails configuration, the console appender named 'stdout' is attached to all loggers through the default root logger configuration. But that's the only one. Adding more appenders can be done within an 'appenders' block:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        rollingFile name: <span class="java&#45;quote">"myAppender"</span>,
                    maxFileSize: 1024,
                    file: <span class="java&#45;quote">"/tmp/logs/myApp.log"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The following appenders are available by default:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Name</strong></th><th><strong class="bold">Class</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>jdbc</td><td><a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/jdbc/JDBCAppender.html" target="blank">JDBCAppender</a></td><td>Logs to a JDBC connection.</td></tr><tr class="table-even"><td>console</td><td><a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/ConsoleAppender.html" target="blank">ConsoleAppender</a></td><td>Logs to the console.</td></tr><tr class="table-odd"><td>file</td><td><a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/FileAppender.html" target="blank">FileAppender</a></td><td>Logs to a single file.</td></tr><tr class="table-even"><td>rollingFile</td><td><a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/RollingFileAppender.html" target="blank">RollingFileAppender</a></td><td>Logs to rolling files, for example a new file each day.</td></tr></table><p class="paragraph"/>Each named argument passed to an appender maps to a property of the underlying <a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Appender.html" target="blank">Appender</a> implementation. So the previous example sets the <code>name</code>, <code>maxFileSize</code> and <code>file</code> properties of the <code>RollingFileAppender</code> instance.<p class="paragraph"/>You can have as many appenders as you like - just make sure that they all have unique names. You can even have multiple instances of the same appender type, for example several file appenders that log to different files.<p class="paragraph"/>If you prefer to create the appender programmatically or if you want to use an appender implementation that's not available in the above syntax, simply declare an <code>appender</code> entry with an instance of the appender you want:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.log4j.&#42;<p class="paragraph"/>log4j = &#123;
    appenders &#123;
        appender <span class="java&#45;keyword">new</span> RollingFileAppender(
                name: <span class="java&#45;quote">"myAppender"</span>,
                maxFileSize: 1024,
                file: <span class="java&#45;quote">"/tmp/logs/myApp.log"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>This approach can be used to configure <code>JMSAppender</code>, <code>SocketAppender</code>, <code>SMTPAppender</code>, and more.<p class="paragraph"/>Once you have declared your extra appenders, you can attach them to specific loggers by passing the name as a key to one of the log level methods from the previous section:<p class="paragraph"/><div class="code"><pre>error myAppender: <span class="java&#45;quote">"grails.app.controllers.BookController"</span></pre></div><p class="paragraph"/>This will ensure that the 'grails.app.controllers.BookController' logger sends log messages to 'myAppender' as well as any appenders configured for the root logger. To add more than one appender to the logger, then add them to the same level declaration:<p class="paragraph"/><div class="code"><pre>error myAppender:      <span class="java&#45;quote">"grails.app.controllers.BookController"</span>,
      myFileAppender:  &#91;<span class="java&#45;quote">"grails.app.controllers.BookController"</span>,
                        <span class="java&#45;quote">"grails.app.services.BookService"</span>&#93;,
      rollingFile:     <span class="java&#45;quote">"grails.app.controllers.BookController"</span></pre></div><p class="paragraph"/>The above example also shows how you can configure more than one logger at a time for a given appender (<code>myFileAppender</code>) by using a list.<p class="paragraph"/>Be aware that you can only configure a single level for a logger, so if you tried this code:<p class="paragraph"/><div class="code"><pre>error myAppender:      <span class="java&#45;quote">"grails.app.controllers.BookController"</span>
debug myFileAppender:  <span class="java&#45;quote">"grails.app.controllers.BookController"</span>
fatal rollingFile:     <span class="java&#45;quote">"grails.app.controllers.BookController"</span></pre></div><p class="paragraph"/>you'd find that only 'fatal' level messages get logged for 'grails.app.controllers.BookController'. That's because the last level declared for a given logger wins. What you probably want to do is limit what level of messages an appender writes.<p class="paragraph"/>An appender that is attached to a logger configured with the 'all' level will generate a lot of logging information. That may be fine in a file, but it makes working at the console difficult. So we configure the console appender to only write out messages at 'info' level or above:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        console name: <span class="java&#45;quote">"stdout"</span>, threshold: org.apache.log4j.Level.INFO
    &#125;
&#125;</pre></div><p class="paragraph"/>The key here is the <code>threshold</code> argument which determines the cut-off for log messages. This argument is available for all appenders, but do note that you currently have to specify a <code>Level</code> instance - a string such as "info" will not work.<p class="paragraph"/><h3>Custom Layouts</h3><p class="paragraph"/>By default the Log4j DSL assumes that you want to use a <a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html" target="blank">PatternLayout</a>. However, there are other layouts available including:
<ul class="star">
<li><code>xml</code> - Create an XML log file</li>
<li><code>html</code> - Creates an HTML log file</li>
<li><code>simple</code> - A simple textual log</li>
<li><code>pattern</code> - A Pattern layout</li>
</ul><p class="paragraph"/>You can specify custom patterns to an appender using the <code>layout</code> setting:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        console name: <span class="java&#45;quote">"customAppender"</span>,
                layout: pattern(conversionPattern: <span class="java&#45;quote">"%c&#123;2&#125; %m%n"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>This also works for the built-in appender "stdout", which logs to the console:
<div class="code"><pre>log4j = &#123;
    appenders &#123;
        console name: <span class="java&#45;quote">"stdout"</span>,
                layout: pattern(conversionPattern: <span class="java&#45;quote">"%c&#123;2&#125; %m%n"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Environment-specific configuration</h3><p class="paragraph"/>Since the logging configuration is inside <code>Config.groovy</code>, you can put it inside an environment-specific block. However, there is a problem with this approach: you have to provide the full logging configuration each time you define the <code>log4j</code> setting. In other words, you cannot selectively override parts of the configuration - it's all or nothing.<p class="paragraph"/>To get around this, the logging DSL provides its own environment blocks that you can put anywhere in the configuration:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        console name: <span class="java&#45;quote">"stdout"</span>,
                layout: pattern(conversionPattern: <span class="java&#45;quote">"%c&#123;2&#125; %m%n"</span>)<p class="paragraph"/>        environments &#123;
            production &#123;
                rollingFile name: <span class="java&#45;quote">"myAppender"</span>, maxFileSize: 1024,
                            file: <span class="java&#45;quote">"/tmp/logs/myApp.log"</span>
            &#125;
        &#125;
    &#125;<p class="paragraph"/>    root &#123;
        //&#8230;
    &#125;<p class="paragraph"/>    // other shared config
    info <span class="java&#45;quote">"grails.app.controller"</span><p class="paragraph"/>    environments &#123;
        production &#123;
            // Override previous setting <span class="java&#45;keyword">for</span> 'grails.app.controller'
            error <span class="java&#45;quote">"grails.app.controllers"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>The one place you can't put an environment block is  <em class="italic">inside</em>  the <code>root</code> definition, but you can put the <code>root</code> definition inside an environment block.<p class="paragraph"/><h3>Full stacktraces</h3><p class="paragraph"/>When exceptions occur, there can be an awful lot of noise in the stacktrace from Java and Groovy internals. Grails filters these typically irrelevant details and restricts traces to non-core Grails/Groovy class packages.<p class="paragraph"/>When this happens, the full trace is always logged to the <code>StackTrace</code> logger, which by default writes its output to a file called <code>stacktrace.log</code>. As with other loggers though, you can change its behaviour in the configuration. For example if you prefer full stack traces to go to the console, add this entry:<p class="paragraph"/><div class="code"><pre>error stdout: <span class="java&#45;quote">"StackTrace"</span></pre></div><p class="paragraph"/>This won't stop Grails from attempting to create the stacktrace.log file - it just redirects where stack traces are written to. An alternative approach is to change the location of the 'stacktrace' appender's file:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        rollingFile name: <span class="java&#45;quote">"stacktrace"</span>, maxFileSize: 1024,
                    file: <span class="java&#45;quote">"/<span class="java&#45;keyword">var</span>/tmp/logs/myApp&#45;stacktrace.log"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>or, if you don't want to the 'stacktrace' appender at all, configure it as a 'null' appender:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        '<span class="java&#45;keyword">null</span>' name: <span class="java&#45;quote">"stacktrace"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>You can of course combine this with attaching the 'stdout' appender to the 'StackTrace' logger if you want all the output in the console.<p class="paragraph"/>Finally, you can completely disable stacktrace filtering by setting the <code>grails.full.stacktrace</code> VM property to <code>true</code>:<p class="paragraph"/><div class="code"><pre>grails &#45;Dgrails.full.stacktrace=<span class="java&#45;keyword">true</span> run&#45;app</pre></div><p class="paragraph"/><h3>Masking Request Parameters From Stacktrace Logs</h3><p class="paragraph"/>When Grails logs a stacktrace, the log message may include the names and values of all of the request parameters for the current request.  To mask out the values of secure request parameters, specify the parameter names in the <code>grails.exceptionresolver.params.exclude</code> config property:<p class="paragraph"/><div class="code"><pre>grails.exceptionresolver.params.exclude = &#91;'password', 'creditCard'&#93;</pre></div><p class="paragraph"/>Request parameter logging may be turned off altogether by setting the <code>grails.exceptionresolver.logRequestParameters</code> config property to <code>false</code>.  The default value is <code>true</code> when the application is running in DEVELOPMENT mode and <code>false</code> for all other modes.<p class="paragraph"/><div class="code"><pre>grails.exceptionresolver.logRequestParameters=<span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><h3>Logger inheritance</h3><p class="paragraph"/>Earlier, we mentioned that all loggers inherit from the root logger and that loggers are hierarchical based on '.'-separated terms. What this means is that unless you override a parent setting, a logger retains the level and the appenders configured for that parent. So with this configuration:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        file name:'file', file:'/<span class="java&#45;keyword">var</span>/logs/mylog.log'
    &#125;
    root &#123;
        debug 'stdout', 'file'
    &#125;
&#125;</pre></div><p class="paragraph"/>all loggers in the application will have a level of 'debug' and will log to both the 'stdout' and 'file' appenders. What if you only want to log to 'stdout' for a particular logger? Change the 'additivity' for a logger in that case.<p class="paragraph"/>Additivity simply determines whether a logger inherits the configuration from its parent. If additivity is false, then its not inherited. The default for all loggers is true, i.e. they inherit the configuration. So how do you change this setting? Here's an example:<p class="paragraph"/><div class="code"><pre>log4j = &#123;
    appenders &#123;
        &#8230;
    &#125;
    root &#123;
        &#8230;
    &#125;<p class="paragraph"/>    info additivity: <span class="java&#45;keyword">false</span>
         stdout: &#91;<span class="java&#45;quote">"grails.app.controllers.BookController"</span>,
                  <span class="java&#45;quote">"grails.app.services.BookService"</span>&#93;
&#125;</pre></div><p class="paragraph"/>So when you specify a log level, add an 'additivity' named argument. Note that you when you specify the additivity, you must configure the loggers for a named appender. The following syntax will  <em class="italic">not</em>  work:<p class="paragraph"/><div class="code"><pre>info additivity: <span class="java&#45;keyword">false</span>, &#91;<span class="java&#45;quote">"grails.app.controllers.BookController"</span>,
                         <span class="java&#45;quote">"grails.app.services.BookService"</span>&#93;</pre></div><p class="paragraph"/><h3>Customizing stack trace printing and filtering</h3><p class="paragraph"/>Stacktraces in general and those generated when using Groovy in particular are quite verbose and contain many stack frames that aren't interesting when diagnosing problems. So Grails uses a implementation of the <code>org.codehaus.groovy.grails.exceptions.StackTraceFilterer</code> interface to filter out irrelevant stack frames. To customize the approach used for filtering, implement that interface in a class in src/groovy or src/java and register it in <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.logging.stackTraceFiltererClass =
         'com.yourcompany.yourapp.MyStackTraceFilterer'</pre></div><p class="paragraph"/>In addition, Grails customizes the display of the filtered stacktrace to make the information more readable. To customize this, implement the <code>org.codehaus.groovy.grails.exceptions.StackTracePrinter</code> interface in a class in src/groovy or src/java and register it in <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.logging.stackTracePrinterClass =
         'com.yourcompany.yourapp.MyStackTracePrinter'</pre></div><p class="paragraph"/>Finally, to render error information in the error GSP, an HTML-generating printer implementation is needed. The default implementation is <code>org.codehaus.groovy.grails.web.errors.ErrorsViewStackTracePrinter</code> and it's registered as a Spring bean. To use your own implementation, either implement the <code>org.codehaus.groovy.grails.exceptions.StackTraceFilterer</code> directly or subclass <code>ErrorsViewStackTracePrinter</code> and register it in <code>grails-app/conf/spring/resources.groovy</code> as:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.yourcompany.yourapp.MyErrorsViewStackTracePrinter<p class="paragraph"/>beans = &#123;<p class="paragraph"/>    errorsViewStackTracePrinter(MyErrorsViewStackTracePrinter,
                                ref('grailsResourceLocator'))
&#125;</pre></div><p class="paragraph"/><h3>Alternative logging libraries</h3><p class="paragraph"/>By default, Grails uses Log4J to do its logging. For most people this is absolutely fine, and many users don't even care what logging library is used. But if you're not one of those and want to use an alternative, such as the <a href="http://download.oracle.com/javase/6/docs/api/index.html?java/util/logging/package-summary.html" target="blank">JDK logging package</a> or <a href="http://logback.qos.ch/" target="blank">logback</a>, you can do so by simply excluding a couple of dependencies from the global set and adding your own:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    inherits(<span class="java&#45;quote">"global"</span>) &#123;
        excludes <span class="java&#45;quote">"grails&#45;plugin&#45;logging"</span>, <span class="java&#45;quote">"log4j"</span>
    &#125;
    &#8230;
    dependencies &#123;
        runtime <span class="java&#45;quote">"ch.qos.logback:logback&#45;core:0.9.29"</span>
        &#8230;
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/>If you do this, you will get unfiltered, standard Java stacktraces in your log files and you won't be able to use the logging configuration DSL that's just been described. Instead, you will have to use the standard configuration mechanism for the library you choose.


<a name="3.1.3 GORM"><!-- Legacy link --></a>
<h2 id="configGORM">4.1.3 GORM</h2>
<div class="hidden-block">Grails provides the following GORM configuration options:</div>
Grailsには、以下のようなGORMのオプション設定が用意されています。<p class="paragraph"/><div class="hidden-block">* <code>grails.gorm.failOnError</code>  - If set to <code>true</code>, causes the <code>save()</code> method on domain classes to throw a <code>grails.validation.ValidationException</code> if <a href="../guide/single.html#validation" class="guide">validation</a> fails during a save.  This option may also be assigned a list of Strings representing package names.  If the value is a list of Strings then the failOnError behavior will only be applied to domain classes in those packages (including sub-packages).  See the <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> method docs for more information.</div>
<ul class="star">
<li><code>grails.gorm.failOnError</code> = <code>true</code>に設定すると、保存中に<a href="../guide/single.html#validation" class="guide">バリデーション</a>が失敗した場合、ドメインクラスの<code>save()</code>メソッドは<code>grails.validation.ValidationException</code>をスローするようになります。</li>
</ul><p class="paragraph"/>このオプションには、パッケージ名のリストを指定することもできます。
値が文字列のリストである場合、failOnErrorの挙動は指定されたパッケージの(サブパッケージを含む)ドメインクラスのみに適用されます。
詳細については、<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドのドキュメントを参照してください。<p class="paragraph"/><div class="hidden-block">For example, to enable failOnError for all domain classes:</div>
たとえば、全てのドメインクラスでfailOnErrorを有効にするには:<p class="paragraph"/><div class="code"><pre>grails.gorm.failOnError=<span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">and to enable failOnError for domain classes by package:</div>
また、パッケージごとにドメインクラスに対してfailOnErrorを有効にするには:<p class="paragraph"/><div class="code"><pre>grails.gorm.failOnError = &#91;'com.companyname.somepackage',
                           'com.companyname.someotherpackage'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">* <code>grails.gorm.autoFlush</code> = If set to <code>true</code>, causes the <a href="../ref/Domain Classes/merge.html" class="domainClasses">merge</a>, <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> and <a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a> methods to flush the session, replacing the need to explicitly flush using <code>save(flush: true)</code>.</div>
<ul class="star">
<li><code>grails.gorm.autoFlush</code> = <code>true</code>にセットすると、<code>save(flush: true)</code>を使用して明示的にフラッシュする必要がなくなり、<a href="../ref/Domain Classes/merge.html" class="domainClasses">merge</a>、<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>、<a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a>メソッドはセッションをフラッシュするようになります。</li>
</ul><p class="paragraph"/>

<a name="3.2 Environments"><!-- Legacy link --></a>
<h2 id="environments">4.2 環境</h2>
<div class="hidden-block">h4. Per Environment Configuration</div>
<h4>環境ごとの設定</h4><p class="paragraph"/><div class="hidden-block">Grails supports the concept of per environment configuration. The <code>Config.groovy</code>, <code>DataSource.groovy</code>, and <code>BootStrap.groovy</code> files in the <code>grails-app/conf</code> directory can use per-environment configuration using the syntax provided by <a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a>. As an example consider the following default <code>DataSource</code> definition provided by Grails:</div>
Grailsは環境ごとで設定値を変更する概念をサポートしています。<code>grails-app/conf</code>ディレクトリ内の<code>Config.groovy</code>, <code>DataSource.groovy</code>,<code>BootStrap.groovy</code>ファイルは<a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a>によって提供される構文を使用して、環境ごとの設定を行うことができます。次の例では、Grailsによって与えられるデフォルトの<code>DataSource</code>定義について記述しています。<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    pooled = <span class="java&#45;keyword">false</span>
    driverClassName = <span class="java&#45;quote">"org.h2.Driver"</span>
    username = <span class="java&#45;quote">"sa"</span>
    password = <span class="java&#45;quote">""</span>
&#125;
environments &#123;
    development &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"create&#45;drop"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:devDb"</span>
        &#125;
    &#125;
    test &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:testDb"</span>
        &#125;
    &#125;
    production &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:prodDb"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Notice how the common configuration is provided at the top level and then an <code>environments</code> block specifies per environment settings for the <code>dbCreate</code> and <code>url</code> properties of the <code>DataSource</code>.</div>
一般的な構成として、共通的な設定はトップレベルで提供され、<code>environments</code>ブロックには<code>DataSource</code>の<code>dbCreate</code>や<code>url</code>プロパティを環境ごとに指定している様子がわかります。<p class="paragraph"/><div class="hidden-block">h4. Packaging and Running for Different Environments</div>
<h4>異なる環境のパッケージングと実行</h4><p class="paragraph"/><div class="hidden-block">Grails' <a href="../guide/single.html#commandLine" class="guide">command line</a> has built in capabilities to execute any command within the context of a specific environment. The format is:</div>
Grailsの<a href="../guide/single.html#commandLine" class="guide">コマンドライン</a>は、特定の環境下で、任意のコマンドを実行する機能が組み込まれています。そのフォーマットは以下となります。<p class="paragraph"/><div class="code"><pre>grails &#91;environment&#93; &#91;command name&#93;</pre></div><p class="paragraph"/><div class="hidden-block">In addition, there are 3 preset environments known to Grails: <code>dev</code>, <code>prod</code>, and <code>test</code> for <code>development</code>, <code>production</code> and <code>test</code>. For example to create a WAR for the <code>test</code> environment you wound run:</div>
加えて、Grailsでは<code>dev</code>,<code>prod</code>,<code>test</code>(<code>development</code>,<code>production</code>,<code>test</code>)といった、あらかじめ定義されている３つの環境が知られています。例えば、<code>test</code>環境でWARを作成するには、以下のように実行します。<p class="paragraph"/><div class="code"><pre>grails test war</pre></div><p class="paragraph"/><div class="hidden-block">To target other environments you can pass a <code>grails.env</code> variable to any command:</div>
上記の３つ以外の環境をターゲットにするには、任意のコマンドに<code>grails.env</code>変数を渡すことで実現できます。<p class="paragraph"/><div class="code"><pre>grails &#45;Dgrails.env=UAT run&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">h4. Programmatic Environment Detection</div>
<h4>プログラマチック環境検出</h4><p class="paragraph"/><div class="hidden-block">Within your code, such as in a Gant script or a bootstrap class you can detect the environment using the <a href="http://grails.org/doc/latest/api/grails/util/Environment.html" class="api">Environment</a> class:</div>
Gantスクリプトやbootstrapクラスのコード内では<a href="http://grails.org/doc/latest/api/grails/util/Environment.html" class="api">Environment</a>クラスを使って、環境を検出できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.util.Environment<p class="paragraph"/>...<p class="paragraph"/><span class="java&#45;keyword">switch</span> (Environment.current) &#123;
    <span class="java&#45;keyword">case</span> Environment.DEVELOPMENT:
        configureForDevelopment()
        <span class="java&#45;keyword">break</span>
    <span class="java&#45;keyword">case</span> Environment.PRODUCTION:
        configureForProduction()
        <span class="java&#45;keyword">break</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Per Environment Bootstrapping</div>
<h4>環境ごとのブートストラップ</h4><p class="paragraph"/><div class="hidden-block">It's often desirable to run code when your application starts up on a per-environment basis. To do so you can use the <code>grails-app/conf/BootStrap.groovy</code> file's support for per-environment execution:</div>
アプリケーションの起動時に、環境に基づいたコードを実行することが望ましい場合があります。そのためには、<code>grails-app/conf/BootStrap.groovy</code>ファイルの環境ごとの実行サポートを使います。<p class="paragraph"/><div class="code"><pre>def init = &#123; ServletContext ctx &#45;&#62;
    environments &#123;
        production &#123;
            ctx.setAttribute(<span class="java&#45;quote">"env"</span>, <span class="java&#45;quote">"prod"</span>)
        &#125;
        development &#123;
            ctx.setAttribute(<span class="java&#45;quote">"env"</span>, <span class="java&#45;quote">"dev"</span>)
        &#125;
    &#125;
    ctx.setAttribute(<span class="java&#45;quote">"foo"</span>, <span class="java&#45;quote">"bar"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Generic Per Environment Execution</div>
ジェネリックな環境の実行<p class="paragraph"/><div class="hidden-block">The previous <code>BootStrap</code> example uses the <code>grails.util.Environment</code> class internally to execute. You can also use this class yourself to execute your own environment specific logic:</div>
以前の<code>BootStrap</code>の例では、内部的に<code>grails.util.Environment</code>クラスを使用して実行しています。独自の環境ロジックを実行するために、このクラスを以下のように使うこともできます。<p class="paragraph"/><div class="code"><pre>Environment.executeForCurrentEnvironment &#123;
    production &#123;
        // <span class="java&#45;keyword">do</span> something in production
    &#125;
    development &#123;
        // <span class="java&#45;keyword">do</span> something only in development
    &#125;
&#125;</pre></div>


<a name="3.3 The DataSource"><!-- Legacy link --></a>
<h2 id="dataSource">4.3 データソース</h2>
<div class="hidden-block">Since Grails is built on Java technology setting up a data source requires some knowledge of JDBC (the technology that doesn't stand for Java Database Connectivity).</div>
Grailsはデータソースの設定がJava技術で構築されているため、ある程度JDBC（Java DataBase Connectivityの略ではない）の知識が必要になります。<p class="paragraph"/><div class="hidden-block">
If you use a database other than H2 you need a JDBC driver. For example for MySQL you would need <a href="http://www.mysql.com/downloads/connector/j/" target="blank">Connector/J</a>
</div>
もしH2以外のデータベースを使うなら、JDBCドライバが必要になります。例えばMySQLであれば<a href="http://www.mysql.com/downloads/connector/j/" target="blank">Connector/J</a> が必要になります。<p class="paragraph"/><div class="hidden-block">Drivers typically come in the form of a JAR archive. It's best to use Ivy to resolve the jar if it's available in a Maven repository, for example you could add a dependency for the MySQL driver like this:</div>
ドライバは、一般的にはJAR形式で提供されています。もしIvyが使える場合は、Mavenリポジトリからjarを取得するのがよいでしょう。例えば、このようにMySQLの依存関係を加えることができます。<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    inherits(<span class="java&#45;quote">"global"</span>)
    log <span class="java&#45;quote">"warn"</span>
    repositories &#123;
        grailsPlugins()
        grailsHome()
        grailsCentral()
        mavenCentral()
    &#125;
    dependencies &#123;
        runtime 'mysql:mysql&#45;connector&#45;java:5.1.16'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that the built-in <code>mavenCentral()</code> repository is included here since that's a reliable location for this library.</div>
<code>mavenCentral()</code>リポジトリが記述されているのは、このライブラリの取得元として信頼できる場所だからです。<p class="paragraph"/><div class="hidden-block">If you can't use Ivy then just put the JAR in your project's <code>lib</code> directory.</div>
Ivyが使えない場合は、プロジェクトの<code>lib</code>ディレクトリにJARを置いてください。<p class="paragraph"/><div class="hidden-block">Once you have the JAR resolved you need to get familiar Grails' DataSource descriptor file located at <code>grails-app/conf/DataSource.groovy</code>. This file contains the dataSource definition which includes the following settings:</div>
JARが解決できたら、<code>grails-app/conf/DataSource.groovy</code>ファイルで使用する、Grailsにおけるデータソースの定義方法を覚える必要があります。このファイルはデータソースの定義として、以下の項目を含んでいます。<p class="paragraph"/><div class="hidden-block">* <code>driverClassName</code> - The class name of the JDBC driver
<ul class="star">
<li><code>username</code> - The username used to establish a JDBC connection</li>
<li><code>password</code> - The password used to establish a JDBC connection</li>
<li><code>url</code> - The JDBC URL of the database</li>
<li><code>dbCreate</code> - Whether to auto-generate the database from the domain model - one of 'create-drop', 'create', 'update' or 'validate'</li>
<li><code>pooled</code> - Whether to use a pool of connections (defaults to true)</li>
<li><code>logSql</code> - Enable SQL logging to stdout</li>
<li><code>formatSql</code> - Format logged SQL</li>
<li><code>dialect</code> - A String or Class that represents the Hibernate dialect used to communicate with the database. See the <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/dialect/package-summary.html" target="blank">org.hibernate.dialect</a> package for available dialects.</li>
<li><code>readOnly</code> - If <code>true</code> makes the DataSource read-only, which results in the connection pool calling <code>setReadOnly(true)</code> on each <code>Connection</code></li>
<li><code>properties</code> - Extra properties to set on the DataSource bean. See the <a href="http://commons.apache.org/dbcp/api-1.2.2/org/apache/commons/dbcp/BasicDataSource.html" target="blank">Commons DBCP BasicDataSource</a> documentation.</div></li>
<li><code>driverClassName</code> - JDBCドライバのクラス名</li>
<li><code>username</code> - JDBCコネクションの接続に使用するユーザ名</li>
<li><code>password</code> - JDBCコネクションの接続に使用するパスワード</li>
<li><code>url</code> - データベースのJDBC URL</li>
<li><code>dbCreate</code> -  ドメインモデルからデータベースを自動で生成するか。'create-drop'、'create'、'update'、もしくは'validate'の中から1つ指定</li>
<li><code>pooled</code> - コネクションプールを使うか（デフォルトではtrue)</li>
<li><code>logSql</code> - 標準出力へのSQLロギングを有効にするか</li>
<li><code>formatSql</code> - SQLログをフォーマットするか</li>
<li><code>dialect</code> - データベースの通信に使用されるHibernateの方言を表す文字型かクラス。利用できる方言は<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/dialect/package-summary.html" target="blank">org.hibernate.dialect</a>パッケージを参照</li>
<li><code>readOnly</code> - <code>true</code>にした場合は読み取り専用のデータソースとなり、各<code>Connection</code>で<code>setReadOnly(true)</code>がコネクションプールより呼ばれる</li>
<li><code>properties</code> - DataSourceビーンを設定するための追加プロパティ。<a href="http://commons.apache.org/dbcp/api-1.2.2/org/apache/commons/dbcp/BasicDataSource.html" target="blank">Commons DBCP BasicDataSource</a>ドキュメント参照</li>
</ul><p class="paragraph"/><div class="hidden-block">A typical configuration for MySQL may be something like:</div>
MySQLの一般的な構成はおおむね以下のようになります。<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    pooled = <span class="java&#45;keyword">true</span>
    dbCreate = <span class="java&#45;quote">"update"</span>
    url = <span class="java&#45;quote">"jdbc:mysql://localhost/yourDB"</span>
    driverClassName = <span class="java&#45;quote">"com.mysql.jdbc.Driver"</span>
    dialect = org.hibernate.dialect.MySQL5InnoDBDialect
    username = <span class="java&#45;quote">"yourUser"</span>
    password = <span class="java&#45;quote">"yourPassword"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="warning">
When configuring the DataSource do not include the type or the def keyword before any of the configuration settings as Groovy will treat these as local variable definitions and they will not be processed. For example the following is invalid:
</blockquote></div>
データソースを設定する際、設定値の前には型やdefキーワードは含まれません。キーワードが含まれる場合はGroovyのローカル変数として処理されます。例えば、以下の記述では設定値としては無効になります。<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    <span class="java&#45;object">boolean</span> pooled = <span class="java&#45;keyword">true</span> // type declaration results in ignored local variable
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Example of advanced configuration using extra properties:</div>
追加プロパティを使い、高度な設定を行う例は以下になります。
<div class="code"><pre>dataSource &#123;
    pooled = <span class="java&#45;keyword">true</span>
    dbCreate = <span class="java&#45;quote">"update"</span>
    url = <span class="java&#45;quote">"jdbc:mysql://localhost/yourDB"</span>
    driverClassName = <span class="java&#45;quote">"com.mysql.jdbc.Driver"</span>
    dialect = org.hibernate.dialect.MySQL5InnoDBDialect
    username = <span class="java&#45;quote">"yourUser"</span>
    password = <span class="java&#45;quote">"yourPassword"</span>
    properties &#123;
        maxActive = 50
        maxIdle = 25
        minIdle = 5
        initialSize = 5
        minEvictableIdleTimeMillis = 60000
        timeBetweenEvictionRunsMillis = 60000
        maxWait = 10000
        validationQuery = <span class="java&#45;quote">"/&#42; ping &#42;/"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. More on dbCreate</div>
<h4>dbCreateの詳細</h4><p class="paragraph"/><div class="hidden-block">Hibernate can automatically create the database tables required for your domain model. You have some control over when and how it does this through the <code>dbCreate</code> property, which can take these values:</div>
Hibernateは自動的にドメインモデルに必要なデータベーステーブルを作成することができます。ユーザは<code>dbCreate</code>プロパティを使い、どのようにテーブルの作成を行うのかコントロールすることができ、以下のような値を取ることができます。<p class="paragraph"/><div class="hidden-block"><strong class="bold"> </strong>create* - Drops the existing schemaCreates the schema on startup, dropping existing tables, indexes, etc. first.
<ul class="star">
<li><strong class="bold">create-drop</strong> - Same as <strong class="bold">create</strong>, but also drops the tables when the application shuts down cleanly.</li>
<li><strong class="bold">update</strong> - Creates missing tables and indexes, and updates the current schema without dropping any tables or data. Note that this can't properly handle many schema changes like column renames (you're left with the old column containing the existing data).</li>
<li><strong class="bold">validate</strong> - Makes no changes to your database. Compares the configuration with the existing database schema and reports warnings.</li>
<li>any other value - does nothing</div></li>
<li><strong class="bold">create</strong> - 起動時に既存のテーブルやインデックスなどを削除することで、既存のスキーマを削除する</li>
<li><strong class="bold">create-drop</strong> - <strong class="bold">create</strong>と同じだが、アプリケーションを停止させた時にテーブルを削除する</li>
<li><strong class="bold">update</strong> - テーブルやデータなどを削除することなく、現在のスキーマを更新する形で存在しないテーブルやインデックスを作成する。これはカラムのリネームのような多くのスキーマ変更を正確に処理できないことに注意してください（既存のデータを含む、古い列が残ってしまう）</li>
<li><strong class="bold">validate</strong> - データベースは変更されません。既存のデータベースとスキーマを比較し、警告を出します</li>
<li>any other value - 何もしません</li>
</ul><p class="paragraph"/><div class="hidden-block">You can also remove the <code>dbCreate</code> setting completely, which is recommended once your schema is relatively stable and definitely when your application and database are deployed in production. Database changes are then managed through proper migrations, either with SQL scripts or a migration tool like <a href="http://www.liquibase.org/" target="blank">Liquibase</a> (the <a href="http://grails.org/plugin/database-migration" target="blank">Database Migration</a> plugin uses Liquibase and is tightly integrated with Grails and GORM).</div>
<code>dbCreate</code>設定を完全に削除することもできます。それは、アプリケーションとデータベースが本番環境にデプロイされている場合、スキーマが比較的安定してきた段階で推奨されています。データベースの変更は、SQLスクリプトや<a href="http://www.liquibase.org/" target="blank">Liquibase</a>のようなマイグレーションツールのどちらかで、適切にマイグレーションを管理してください。（<a href="http://grails.org/plugin/database-migration" target="blank">Database Migration</a> プラグインはLiquibaseを使用し、GrailsやGORMと統合されます。）


<a name="3.3.1 DataSources and Environments"><!-- Legacy link --></a>
<h2 id="dataSourcesAndEnvironments">4.3.1 データソースと環境</h2>
<div class="hidden-block">The previous example configuration assumes you want the same config for all environments: production, test, development etc.</div>
これまでの例ではすべての環境（production, test, developmentなど）で同じ設定を行うことを想定していました。<p class="paragraph"/><div class="hidden-block">Grails' DataSource definition is "environment aware", however, so you can do:</div>
Grailsのデータソース定義では環境ごとの設定が可能になっています。<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    pooled = <span class="java&#45;keyword">true</span>
    driverClassName = <span class="java&#45;quote">"com.mysql.jdbc.Driver"</span>
    dialect = org.hibernate.dialect.MySQL5InnoDBDialect
    // other common settings here
&#125;<p class="paragraph"/>environments &#123;
    production &#123;
        dataSource &#123;
            url = <span class="java&#45;quote">"jdbc:mysql://liveip.com/liveDb"</span>
            // other environment&#45;specific settings here
        &#125;
    &#125;
&#125;</pre></div>


<a name="3.3.2 JNDI DataSources"><!-- Legacy link --></a>
<h2 id="JNDIDataSources">4.3.2 JNDI データソース</h2>
<div class="hidden-block">h4. Referring to a JNDI DataSource</div>
<h4>JNDIデータソースの参照</h4><p class="paragraph"/><div class="hidden-block">Most Java EE containers supply <code>DataSource</code> instances via <a href="http://www.oracle.com/technetwork/java/jndi/index.html" target="blank">Java Naming and Directory Interface</a> (JNDI). Grails supports the definition of JNDI data sources as follows:</div>
ほとんどのJavaEEコンテナは<a href="http://www.oracle.com/technetwork/java/jndi/index.html" target="blank">Java Naming and Directory Interface</a> (JNDI)を通して、<code>DataSource</code>インスタンスを提供しています。Grailsでは次のようにJNDIデータソースの定義をサポートしています。<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    jndiName = <span class="java&#45;quote">"java:comp/env/myDataSource"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The format on the JNDI name may vary from container to container, but the way you define the <code>DataSource</code> in Grails remains the same.</div>
JNDI名のフォーマットはコンテナによって変化するかもしれませんが、Grailsで<code>DataSource</code>を定義する方法は変わらず同じです。<p class="paragraph"/><div class="hidden-block">h4. Configuring a Development time JNDI resource</div>
<h4>開発時におけるJNDIリソースの設定</h4><p class="paragraph"/><div class="hidden-block">The way in which you configure JNDI data sources at development time is plugin dependent. Using the <a href="http://grails.org/plugin/tomcat" target="blank">Tomcat</a> plugin you can define JNDI resources using the <code>grails.naming.entries</code> setting in <code>grails-app/conf/Config.groovy</code>:</div>
開発時におけるJNDIデータソースの設定方法はプラグインに依存しています。Tomcatプラグインを使う場合は、<code>grails-app/conf/Config.groovy</code>内の<code>grails.naming.entries</code>の設定を使用することで、JNDIリソースを定義します。<p class="paragraph"/><div class="code"><pre>grails.naming.entries = &#91;
    <span class="java&#45;quote">"bean/MyBeanFactory"</span>: &#91;
        auth: <span class="java&#45;quote">"Container"</span>,
        type: <span class="java&#45;quote">"com.mycompany.MyBean"</span>,
        factory: <span class="java&#45;quote">"org.apache.naming.factory.BeanFactory"</span>,
        bar: <span class="java&#45;quote">"23"</span>
    &#93;,
    <span class="java&#45;quote">"jdbc/EmployeeDB"</span>: &#91;
        type: <span class="java&#45;quote">"javax.sql.DataSource"</span>, //required
        auth: <span class="java&#45;quote">"Container"</span>, // optional
        description: <span class="java&#45;quote">"Data source <span class="java&#45;keyword">for</span> Foo"</span>, //optional
        driverClassName: <span class="java&#45;quote">"org.h2.Driver"</span>,
        url: <span class="java&#45;quote">"jdbc:h2:mem:database"</span>,
        username: <span class="java&#45;quote">"dbusername"</span>,
        password: <span class="java&#45;quote">"dbpassword"</span>,
        maxActive: <span class="java&#45;quote">"8"</span>,
        maxIdle: <span class="java&#45;quote">"4"</span>
    &#93;,
    <span class="java&#45;quote">"mail/session"</span>: &#91;
        type: <span class="java&#45;quote">"javax.mail.Session,
        auth: "</span>Container<span class="java&#45;quote">",
        "</span>mail.smtp.host<span class="java&#45;quote">": "</span>localhost"
    &#93;
&#93;</pre></div>


<a name="3.3.3 Automatic Database Migration"><!-- Legacy link --></a>
<h2 id="automaticDatabaseMigration">4.3.3 自動データベースマイグレーション</h2>
<div class="hidden-block">The <code>dbCreate</code> property of the <code>DataSource</code> definition is important as it dictates what Grails should do at runtime with regards to automatically generating the database tables from <a href="../guide/single.html#GORM" class="guide">GORM</a> classes. The options are described in the <a href="../guide/single.html#dataSource" class="guide">DataSource</a> section:</div>
<code>DataSource</code>定義の<code>dbCreate</code>プロパティは、Grailsが実行時に<a href="../guide/single.html#GORM" class="guide">GORM</a>のクラスから自動的にデータベーステーブルを生成すべきかを指示する重要なプロパティです。以下のオプションは<a href="../guide/single.html#dataSource" class="guide">DataSource</a>のセクションで説明しています。
<ul class="star">
<li><code>create</code></li>
<li><code>create-drop</code></li>
<li><code>update</code></li>
<li><code>validate</code></li>
<li>no value</li>
</ul><p class="paragraph"/><div class="hidden-block">In <a href="../guide/single.html#environments" class="guide">development</a> mode <code>dbCreate</code> is by default set to "create-drop", but at some point in development (and certainly once you go to production) you'll need to stop dropping and re-creating the database every time you start up your server.</div>
<a href="../guide/single.html#environments" class="guide">development</a>モードでは、<code>dbCreate</code>はデフォルト値が"create-drop"で設定されていますが、開発中（もしくは本番以前）では、サーバの起動ごとにデータベースが削除、再作成されることが不都合な場合があります。<p class="paragraph"/><div class="hidden-block">It's tempting to switch to <code>update</code> so you retain existing data and only update the schema when your code changes, but Hibernate's update support is very conservative. It won't make any changes that could result in data loss, and doesn't detect renamed columns or tables, so you'll be left with the old one and will also have the new one.</div>
コードを変更したときに、既存データを維持したままスキーマだけを更新するため<code>update</code>に切り替えたくなりますが、Hibernateの更新サポートはあまりパッとしません。データの損失につながる可能性のある変更をすることはありませんが、テーブルやカラム名の変更を見つけることができないので、古いテーブルやカラムは残されて新しいものも持つことになります。<p class="paragraph"/><div class="hidden-block">Grails supports migrations via the <a href="http://grails.org/plugin/database-migration" target="blank">Database Migration</a> plugin which can be installed by declaring the plugin in <code>grails-app/conf/BuildConfig.groovy</code>:</div>
Grailsは<a href="http://grails.org/plugin/database-migration" target="blank">Database Migration</a> を介してマイグレーションをサポートしています。それは<code>grails-app/conf/BuildConfig.groovy</code>に宣言することでプラグインとしてインストールすることができます。:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    &#8230;
    plugins &#123;
        runtime ':database&#45;migration:1.3.1'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The plugin uses <a href="http://www.liquibase.org/" target="blank">Liquibase</a> and and provides access to all of its functionality, and also has support for GORM (for example generating a change set by comparing your domain classes to a database).</div>
このプラグインは<a href="http://www.liquibase.org/" target="blank">Liquibase</a> を使用しており、Liquibaseすべての機能へのアクセスを提供しています。また、GORMのサポートも提供しています（例えばドメインクラスとデータベースを比較しチェンジセットを生成します）。


<a name="3.3.4 Transaction-aware DataSource Proxy"><!-- Legacy link --></a>
<h2 id="transactionAwareDataSourceProxy">4.3.4 Transaction-awareデータソースプロキシ</h2>
<div class="hidden-block">The actual <code>dataSource</code> bean is wrapped in a transaction-aware proxy so you will be given the connection that's being used by the current transaction or Hibernate <code>Session</code> if one is active.</div>
実際の<code>dataSource</code>ビーンはトランザクション対応のプロキシでラップされているため、それらが開始されているのであれば、現在のトランザクションやHibernateセッションで使われているコネクションが得られます。<p class="paragraph"/><div class="hidden-block">If this were not the case, then retrieving a connection from the <code>dataSource</code> would be a new connection, and you wouldn't be able to see changes that haven't been committed yet (assuming you have a sensible transaction isolation setting, e.g. <code>READ_COMMITTED</code> or better).</div>
もし<code>dataSource</code>としてトランザクション対応のプロキシを使っていなかったとしたら、その<code>dataSource</code>から取得したコネクションは新規コネクションであり、(<code>READ_COMMITTED</code>やより上位の適切なトランザクション分離が設定されていると仮定すれば)まだコミットされていない変更はみえないことでしょう。<p class="paragraph"/>　<div class="hidden-block">The "real" unproxied <code>dataSource</code> is still available to you if you need access to it; its bean name is <code>dataSourceUnproxied</code>.</div>
もしプロキシではない「素」の<code>dataSource</code>にアクセスする必要があるなら、<code>dataSourceUnproxied</code>というビーン名を使って利用できます。<p class="paragraph"/><div class="hidden-block">You can access this bean like any other Spring bean, i.e. using dependency injection:</div>
他のSpringビーンのように依存性注入を利用するなどして、ビーンにアクセスできます。<p class="paragraph"/><div class="code"><pre>class MyService &#123;<p class="paragraph"/>   def dataSourceUnproxied
   &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">or by pulling it from the <code>ApplicationContext</code>:</div>
または<code>ApplicationContext</code>から取得できます。<p class="paragraph"/><div class="code"><pre>def dataSourceUnproxied = ctx.dataSourceUnproxied</pre></div>


<a name="3.3.5 Database Console"><!-- Legacy link --></a>
<h2 id="databaseConsole">4.3.5 データベースコンソール</h2>
<div class="hidden-block">The <a href="http://h2database.com/html/quickstart.html#h2_console" target="blank">H2 database console</a> is a convenient feature of H2 that provides a web-based interface to any database that you have a JDBC driver for, and it's very useful to view the database you're developing against. It's especially useful when running against an in-memory database.</div>
<a href="http://h2database.com/html/quickstart.html#h2_console" target="blank">H2 database console</a>はJDBCドライバを持つデータベースにWebベースのインタフェースを与えるH2の便利な機能であり、開発中のデータベースの表示に非常に便利です。インメモリデータベースに対して実行している場合には特に便利です。<p class="paragraph"/><div class="hidden-block">You can access the console by navigating to <strong class="bold">http://localhost:8080/appname/dbconsole</strong> in a browser. The URI can be configured using the <code>grails.dbconsole.urlRoot</code> attribute in Config.groovy and defaults to <code>'/dbconsole'</code>.</div>
ブラウザで<strong class="bold">http://localhost:8080/appname/dbconsole</strong>にアクセスすることで、コンソールを表示することが出来ます。そのURIは、Config.groovy内の<code>grails.dbconsole.urlRoot</code>属性を使って設定することが可能で、デフォルト値は<code>'/dbconsole'</code>になっています。<p class="paragraph"/><div class="hidden-block">The console is enabled by default in development mode and can be disabled or enabled in other environments by using the <code>grails.dbconsole.enabled</code> attribute in Config.groovy. For example you could enable the console in production using</div>
コンソールは開発環境ではデフォルトで有効になっていて、Config.groovy内の<code>grails.dbconsole.enabled</code>属性を使って無効にしたり、他のモードで有効にすることができます。例えば、本番環境(production)でコンソールを有効にするには、次のように記述します。<p class="paragraph"/><div class="code"><pre>environments &#123;
    production &#123;
        grails.serverURL = <span class="java&#45;quote">"http://www.changeme.com"</span>
        grails.dbconsole.enabled = <span class="java&#45;keyword">true</span>
        grails.dbconsole.urlRoot = '/admin/dbconsole'
    &#125;
    development &#123;
        grails.serverURL = <span class="java&#45;quote">"http://localhost:8080/&#36;&#123;appName&#125;"</span>
    &#125;
    test &#123;
        grails.serverURL = <span class="java&#45;quote">"http://localhost:8080/&#36;&#123;appName&#125;"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="warning">
If you enable the console in production be sure to guard access to it using a trusted security framework.
</blockquote></div><p class="paragraph"/><blockquote class="warning">
本番環境でコンソールを有効にする場合は、信頼されるセキュリティフレームワークを使用して、コンソールへのアクセスを保護するようにしてください。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Configuration</div>
<h4>設定</h4><p class="paragraph"/><div class="hidden-block">By default the console is configured for an H2 database which will work with the default settings if you haven't configured an external database - you just need to change the JDBC URL to <code>jdbc:h2:mem:devDB</code>. If you've configured an external database (e.g. MySQL, Oracle, etc.) then you can use the Saved Settings dropdown to choose a settings template and fill in the url and username/password information from your DataSource.groovy.</div>
デフォルトのコンソールは、デフォルト設定のH2データベースに対して動作するよう設定されています。もし外部データベースの設定をしていた場合は、JDBCのURLを<code>jdbc:h2:mem:devDB</code>に変更してください。外部データベース（例えば、MySQL,Oracleなど）を設定する場合には、ドロップダウンのリストから設定テンプレートを選択し、DataSource.groovyからurlやユーザ名/パスワードを設定します。


<a name="3.3.6 Multiple Datasources"><!-- Legacy link --></a>
<h2 id="multipleDatasources">4.3.6 複数データソース</h2>
<div class="hidden-block">By default all domain classes share a single <code>DataSource</code> and a single database, but you have the option to partition your domain classes into two or more <code>DataSource</code>s.</div>
デフォルトではすべてのドメインクラスは単一のデータソースと単一のデータベースを共有していますが、ドメインクラスが共有するデータソースを複数に分割するオプションがあります。<p class="paragraph"/><div class="hidden-block">h4. Configuring Additional DataSources</div>
追加するデータソースの設定<p class="paragraph"/><div class="hidden-block">The default <code>DataSource</code> configuration in <code>grails-app/conf/DataSource.groovy</code> looks something like this:</div>
デフォルトの<code>DataSource</code>は<code>grails-app/conf/DataSource.groovy</code>で設定されており、次のようになっています。<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    pooled = <span class="java&#45;keyword">true</span>
    driverClassName = <span class="java&#45;quote">"org.h2.Driver"</span>
    username = <span class="java&#45;quote">"sa"</span>
    password = <span class="java&#45;quote">""</span>
&#125;
hibernate &#123;
    cache.use_second_level_cache = <span class="java&#45;keyword">true</span>
    cache.use_query_cache = <span class="java&#45;keyword">true</span>
    cache.provider_class = 'net.sf.ehcache.hibernate.EhCacheProvider'
&#125;<p class="paragraph"/>environments &#123;
    development &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"create&#45;drop"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:devDb"</span>
        &#125;
    &#125;
    test &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:testDb"</span>
        &#125;
    &#125;
    production &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:prodDb"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This configures a single <code>DataSource</code> with the Spring bean named <code>dataSource</code>. To configure extra <code>DataSource</code>s, add another <code>dataSource</code> block (at the top level, in an environment block, or both, just like the standard <code>DataSource</code> definition) with a custom name, separated by an underscore. For example, this configuration adds a second <code>DataSource</code>, using MySQL in the development environment and Oracle in production:</div>
<code>dataSource</code>と命名されたSpringビーンとして、単一の<code>DataSource</code>を設定しています。複数の<code>DataSource</code>を設定するには、アンダースコア(_)で区切られたカスタム名を持つ、別の<code>dataSource</code>ブロックを（トップレベルかenvironmentブロック、または両方へ標準の<code>DataSource</code>定義と同様に）追加します。例えば、以下の設定では開発環境にMySQLを、本番環境にOracleを2番目の<code>DataSource</code>として追加しています。<p class="paragraph"/><div class="code"><pre>environments &#123;
    development &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"create&#45;drop"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:devDb"</span>
        &#125;
        dataSource_lookup &#123;
            dialect = org.hibernate.dialect.MySQLInnoDBDialect
            driverClassName = 'com.mysql.jdbc.Driver'
            username = 'lookup'
            password = 'secret'
            url = 'jdbc:mysql://localhost/lookup'
            dbCreate = 'update'
        &#125;
    &#125;
    test &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:mem:testDb"</span>
        &#125;
    &#125;
    production &#123;
        dataSource &#123;
            dbCreate = <span class="java&#45;quote">"update"</span>
            url = <span class="java&#45;quote">"jdbc:h2:prodDb"</span>
        &#125;
        dataSource_lookup &#123;
            dialect = org.hibernate.dialect.Oracle10gDialect
            driverClassName = 'oracle.jdbc.driver.OracleDriver'
            username = 'lookup'
            password = 'secret'
            url = 'jdbc:oracle:thin:@localhost:1521:lookup'
            dbCreate = 'update'
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can use the same or different databases as long as they're supported by Hibernate.</div>
Hibernateによるサポートがある限り、同じデータベースでも異なるデータベースでも使用することができます。<p class="paragraph"/><div class="hidden-block">h4. Configuring Domain Classes</div>
<h4>ドメインクラスの設定</h4><p class="paragraph"/><div class="hidden-block">If a domain class has no <code>DataSource</code> configuration, it defaults to the standard <code>'dataSource'</code>. Set the <code>datasource</code> property in the <code>mapping</code> block to configure a non-default <code>DataSource</code>. For example, if you want to use the <code>ZipCode</code> domain to use the <code>'lookup'</code> <code>DataSource</code>, configure it like this;</div>
ドメインクラスで<code>DataSource</code>の設定をしていない場合、デフォルトで標準の<code>'dataSource'</code>が設定されます。デフォルトでない<code>DataSource</code>を設定をするには、<code>mapping</code>ブロック内で<code>datasource</code>プロパティを使用します。例えば、<code>ZipCode</code>ドメインで<code>'lookup'</code> <code>DataSource</code>を利用したい場合、以下のように設定します。<p class="paragraph"/><div class="code"><pre>class ZipCode &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> code<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      datasource 'lookup'
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">A domain class can also use two or more <code>DataSource</code>s. Use the <code>datasources</code> property with a list of names to configure more than one, for example:</div>
ドメインクラスは複数の<code>DataSource</code>を使用することもできます。複数の設定をするためには、<code>datasources</code>プロパティにデータソース名のリストを設定します。例えば：<p class="paragraph"/><div class="code"><pre>class ZipCode &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> code<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      datasources(&#91;'lookup', 'auditing'&#93;)
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If a domain class uses the default <code>DataSource</code> and one or more others, use the special name <code>'DEFAULT'</code> to indicate the default <code>DataSource</code>:</div>
複数の<code>DataSource</code>を持ち、デフォルトの<code>DataSource</code>を使う場合はデフォルトの<code>DataSource</code>を指す特別な名前として<code>'DEFAULT'</code>を使うことができます。<p class="paragraph"/><div class="code"><pre>class ZipCode &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> code<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      datasources(&#91;'lookup', 'DEFAULT'&#93;)
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If a domain class uses all configured <code>DataSource</code>s use the special value <code>'ALL'</code>:</div>
設定されたすべての<code>DataSource</code>を使う場合、特別な値として<code>'ALL'</code>を使います。<p class="paragraph"/><div class="code"><pre>class ZipCode &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> code<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      datasource 'ALL'
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Namespaces and GORM Methods</div>
<h4>名前空間とGORMメソッド</h4><p class="paragraph"/><div class="hidden-block">If a domain class uses more than one <code>DataSource</code> then you can use the namespace implied by each <code>DataSource</code> name to make GORM calls for a particular <code>DataSource</code>. For example, consider this class which uses two <code>DataSource</code>s:</div>
ドメインクラスが複数の<code>DataSource</code>を使用している場合、特定の<code>DataSource</code>へGORMの呼び出しを行うために、<code>DataSource</code>名ごとに暗黙で定義された名前空間を使うことが出来ます。例えば、2つの<code>DataSource</code>が使われているこのクラスを考えます。<p class="paragraph"/><div class="code"><pre>class ZipCode &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> code<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      datasources(&#91;'lookup', 'auditing'&#93;)
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The first <code>DataSource</code> specified is the default when not using an explicit namespace, so in this case we default to 'lookup'. But you can call GORM methods on the 'auditing' <code>DataSource</code> with the <code>DataSource</code> name, for example:</div>
明示的に名前空間を使用しない場合、先頭の<code>DataSource</code>がデフォルトとして使用されます。この場合デフォルトは'lookup'となります。また、以下のように'auditing' <code>DataSource</code>上でGORMメソッドを呼ぶことができます。<p class="paragraph"/><div class="code"><pre>def zipCode = ZipCode.auditing.get(42)
&#8230;
zipCode.auditing.save()</pre></div><p class="paragraph"/><div class="hidden-block">As you can see, you add the <code>DataSource</code> to the method call in both the static case and the instance case.</div>
ご覧のように、メソッド呼び出しが静的呼び出しの場合とインスタンス呼び出しの場合どちらでも<code>DataSource</code>を追加します。<p class="paragraph"/><div class="hidden-block">h4. Hibernate Mapped Domain Classes</div>
<h4>ドメインクラスのHibernateマップ</h4><p class="paragraph"/><div class="hidden-block">You can also partition annotated Java classes into separate datasources. Classes using the default datasource are registered in <code>grails-app/conf/hibernate/hibernate.cfg.xml</code>. To specify that an annotated class uses a non-default datasource, create a <code>hibernate.cfg.xml</code> file for that datasource with the file name prefixed with the datasource name.</div>
アノテーションの付いたJavaクラスを別々のデータソースに分割することもできます。デフォルトのデータソースを使用しているクラスは<code>grails-app/conf/hibernate/hibernate.cfg.xml</code>に登録されます。デフォルトでないデータソースを使う注釈されたクラスを明示するためには、ファイル名の先頭にデータソース名をつけた<code>hibernate.cfg.xml</code>を作成します。<p class="paragraph"/><div class="hidden-block">For example if the <code>Book</code> class is in the default datasource, you would register that in <code>grails-app/conf/hibernate/hibernate.cfg.xml</code>:</div>
例えば、<code>Book</code>クラスがデフォルトのデータソースを使う場合、<code>grails-app/conf/hibernate/hibernate.cfg.xml</code>に登録します。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;?xml version='1.0' encoding='UTF&#45;8'?&#62;</span>
&#60;!DOCTYPE hibernate&#45;configuration PUBLIC
          '&#45;//Hibernate/Hibernate Configuration DTD 3.0//EN'
          'http://hibernate.sourceforge.net/hibernate&#45;configuration&#45;3.0.dtd'&#62;
<span class="xml&#45;tag">&#60;hibernate&#45;configuration&#62;</span>
   <span class="xml&#45;tag">&#60;session&#45;factory&#62;</span>
      <span class="xml&#45;tag">&#60;mapping class='org.example.Book'/&#62;</span>
   <span class="xml&#45;tag">&#60;/session&#45;factory&#62;</span>
<span class="xml&#45;tag">&#60;/hibernate&#45;configuration&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">and if the <code>Library</code> class is in the "ds2" datasource, you would register that in <code>grails-app/conf/hibernate/ds2_hibernate.cfg.xml</code>:</div>
<code>Library</code>クラスが"ds2"データソースを使う場合、<code>grails-app/conf/hibernate/ds2_hibernate.cfg.xml</code>に登録します。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;?xml version='1.0' encoding='UTF&#45;8'?&#62;</span>
&#60;!DOCTYPE hibernate&#45;configuration PUBLIC
          '&#45;//Hibernate/Hibernate Configuration DTD 3.0//EN'
          'http://hibernate.sourceforge.net/hibernate&#45;configuration&#45;3.0.dtd'&#62;
<span class="xml&#45;tag">&#60;hibernate&#45;configuration&#62;</span>
   <span class="xml&#45;tag">&#60;session&#45;factory&#62;</span>
      <span class="xml&#45;tag">&#60;mapping class='org.example.Library'/&#62;</span>
   <span class="xml&#45;tag">&#60;/session&#45;factory&#62;</span>
<span class="xml&#45;tag">&#60;/hibernate&#45;configuration&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The process is the same for classes mapped with hbm.xml files - just list them in the appropriate hibernate.cfg.xml file.</div>
hbm.xmlファイルでマッピングされたクラスについても方法は同じです。適切なhibernate.cfg.xmlファイルにリスト化するだけです。<p class="paragraph"/><div class="hidden-block">h4. Services</div>
<h4>サービス</h4><p class="paragraph"/><div class="hidden-block">Like Domain classes, by default Services use the default <code>DataSource</code> and <code>PlatformTransactionManager</code>. To configure a Service to use a different <code>DataSource</code>, use the static <code>datasource</code> property, for example:</div>
ドメインクラスと同様に、デフォルトのサービスによってデフォルト<code>DataSource</code>と<code>PlatformTransactionManager</code>が使用されます。サービスの設定で異なる<code>DataSource</code>を使用する場合は、staticな<code>datasource</code>プロパティを使用します。例えば：<p class="paragraph"/><div class="code"><pre>class DataService &#123;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> datasource = 'lookup'<p class="paragraph"/>   void someMethod(...) &#123;
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">A transactional service can only use a single <code>DataSource</code>, so be sure to only make changes for domain classes whose <code>DataSource</code> is the same as the Service.</div>
トランザクション管理されたサービスでは単一のデータソースしか扱えないため、<code>DataSource</code>がサービスと同じドメインクラスだけ値を変更できることに注意してください。<p class="paragraph"/><div class="hidden-block">Note that the datasource specified in a service has no bearing on which datasources are used for domain classes; that's determined by their declared datasources in the domain classes themselves. It's used to declare which transaction manager to use.</div>
サービスで指定されたデータソースがドメインクラスで利用されるかは、データソースがドメインクラスで利用されるかとは関係ないため注意してください。ドメインクラス自体に宣言されたデータソースによって決定されます。<p class="paragraph"/><div class="hidden-block">What you'll see is that if you have a Foo domain class in dataSource1 and a Bar domain class in dataSource2, and WahooService uses dataSource1, a service method that saves a new Foo and a new Bar will only be transactional for Foo since they share the datasource. The transaction won't affect the Bar instance. If you want both to be transactional you'd need to use two services and XA datasources for two-phase commit, e.g. with the Atomikos plugin.</div>
つまり、データソース1にFooドメインクラスを、データソース2にBarドメインクラスを持ち、WahooServiceがデータソース1を使うならば、FooとBarをnewするサービスのメソッドはデータソースを共有しているFooのためだけにトランザクション管理ができるということです。トランザクションはBarのインスタンスに影響を与えません。両方ともトランザクション管理をしたい場合は、2相コミットのために2つのサービスとXAデータソースを用いる必要があります。(例: Atomikosプラグイン)<p class="paragraph"/><div class="hidden-block">h4. XA and Two-phase Commit</div>
<h4>XAと2相コミット</h4><p class="paragraph"/><div class="hidden-block">Grails has no native support for <a href="https://secure.wikimedia.org/wikipedia/en/wiki/X/Open_XA" target="blank">XA</a> <code>DataSource</code>s or <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Two-phase_commit" target="blank">two-phase commit</a>, but the <a href="http://grails.org/plugin/atomikos" target="blank">Atomikos plugin</a> makes it easy. See the plugin documentation for the simple changes needed in your <code>DataSource</code> definitions to reconfigure them as XA <code>DataSource</code>s.</div>
Grailsはネイティブで<a href="https://ja.wikipedia.org/wiki/X/Open_XA" target="blank">XA</a> <code>DataSource</code>や<a href="https://ja.wikipedia.org/wiki/2%E7%9B%B8%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88" target="blank">2相コミット</a>に対応していませんが、<a href="http://grails.org/plugin/atomikos" target="blank">Atomikosプラグイン</a>で簡単に行うことができます。<code>DataSource</code>定義をXA <code>DataSource</code>として再設定するのには簡単な変更が必要となるため、プラグインのドキュメントを参照してください。<p class="paragraph"/>

<a name="3.4 Externalized Configuration"><!-- Legacy link --></a>
<h2 id="configExternalized">4.4 設定の外部化</h2>
<div class="hidden-block">Some deployments require that configuration be sourced from more than one place and be changeable without requiring a rebuild of the application. In order to support deployment scenarios such as these the configuration can be externalized. To do so, point Grails at the locations of the configuration files that should be used by adding a <code>grails.config.locations</code> setting in <code>Config.groovy</code>, for example:</div>
デプロイの際に複数箇所で設定を記述したい場合や、アプリケーションの再ビルドなしで設定を変更したい場合があります。このような要望をサポートするために設定を外部に追い出すことができます。そのためには、<code>Config.groovy</code>ファイルに<code>grails.config.locations</code>の設定を追加し、設定ファイルの位置をGrailsに伝えます。例えば：<p class="paragraph"/><div class="code"><pre>grails.config.locations = &#91;
    <span class="java&#45;quote">"classpath:$&#123;appName&#125;&#45;config.properties"</span>,
    <span class="java&#45;quote">"classpath:$&#123;appName&#125;&#45;config.groovy"</span>,
    <span class="java&#45;quote">"file:$&#123;userHome&#125;/.grails/$&#123;appName&#125;&#45;config.properties"</span>,
    <span class="java&#45;quote">"file:$&#123;userHome&#125;/.grails/$&#123;appName&#125;&#45;config.groovy"</span> &#93;</pre></div><p class="paragraph"/><div class="hidden-block">In the above example we're loading configuration files (both Java Properties files and <a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a> configurations) from different places on the classpath and files located in <code>USER_HOME</code>.</div>
上記の例では、クラスパスや<code>USER_HOME</code>内のファイルといった異なる場所から、設定ファイル（Javaのプロパティファイルや <a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a> 設定ファイル）を読み込んでいます。<p class="paragraph"/><div class="hidden-block">It is also possible to load config by specifying a class that is a config script.</div>
設定が記述されたスクリプトクラスを指定することによって、設定を読み込むことも可能です。<p class="paragraph"/><div class="code"><pre>grails.config.locations = &#91;com.my.app.MyConfig&#93;</pre></div><p class="paragraph"/><div class="hidden-block">This can be useful in situations where the config is either coming from a plugin or some other part of your application. A typical use for this is re-using configuration provided by plugins across multiple applications.</div>
これは設定をプラグインまたは他のアプリケーションから取得する場合に便利です。この方法は複数のアプリケーション上で動作するプラグインで提供される設定を、再利用する際の典型的なやり方です。<p class="paragraph"/><div class="hidden-block">Ultimately all configuration files get merged into the <code>config</code> property of the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> object and are hence obtainable from there.</div>
最終的に、すべての設定ファイルは最終的に<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a>オブジェクトの<code>config</code>プロパティへ統合され、そこから取得可能です。<p class="paragraph"/><div class="hidden-block">Values that have the same name as previously defined values will overwrite the existing values, and the pointed to configuration sources are loaded in the order in which they are defined.</div>
既に定義されている値と同じ名前を持つ値が記述されていた場合は、既存の値が上書きされます。また、指定された設定の取得元は、定義した順番で読み込まれます。<p class="paragraph"/><h4>デフォルトの設定</h4><p class="paragraph"/><div class="hidden-block">The configuration values contained in the locations described by the <code>grails.config.locations</code> property will <strong class="bold">override</strong> any values defined in your application <code>Config.groovy</code> file which may not be what you want. You may want to have a set of  <em class="italic">default</em>  values be be loaded that can be overridden in either your application's <code>Config.groovy</code> file or in a named config location. For this you can use the <code>grails.config.defaults.locations</code> property.</div>
望まないことかもしれませんが、<code>grails.config.defaults.locations</code>プロパティから読み込んだ設定値は、アプリケーションの<code>Config.groovy</code>で定義された任意の値を上書きします。アプリケーションの<code>Config.groovy</code>ファイルか、指定した設定ファイル場所のいずれかで値をオーバライドすることで、デフォルト値として値を読み込ませることが出来ます。これについては、<code>grails.config.defaults.locations</code>プロパティを使用することができます。<p class="paragraph"/>
<div class="hidden-block">This property supports the same values as the <code>grails.config.locations</code> property (i.e. paths to config scripts, property files or classes), but the config described by <code>grails.config.defaults.locations</code> will be loaded  <em class="italic">before</em>  all other values and can therefore be overridden. Some plugins use this mechanism to supply one or more sets of default configuration that you can choose to include in your application config.</div>
このプロパティは<code>grails.config.locations</code>プロパティと同じ値（すなわち、設定スクリプト、プロパティのファイルやクラスへのパス）をサポートしています。しかし、<code>grails.config.defaults.locations</code>で記述された設定ははじめに読み込まれるため、あとから読み込む設定値で上書きすることができます。プラグインの中にはこのメカニズムを利用して、プラグインが提供するデフォルト値をアプリケーションに含めるかをユーザが選択する形をとっているものがあります。<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Grails also supports the concept of property place holders and property override configurers as defined in <a href="http://www.springframework.org." target="blank">Spring</a> For more information on these see the section on <a href="../guide/single.html#spring" class="guide">Grails and Spring</a>
</blockquote></div>
<blockquote class="note">
GrailsはSpringで定義されているようなプレースホルダや設定のオーバライドといったプロパティの概念をサポートしています。より詳しい情報は<a href="../guide/single.html#spring" class="guide">Grails and Spring</a>の章を参照してください。
</blockquote>


<a name="3.5 Versioning"><!-- Legacy link --></a>
<h2 id="versioning">4.5 バージョニング</h2>
<div class="hidden-block">h4. Versioning Basics</div>
<h4>バージョン管理の基本</h4><p class="paragraph"/><div class="hidden-block">Grails has built in support for application versioning. The version of the application is set to <code>0.1</code> when you first create an application with the <a href="../ref/Command Line/create-app.html" class="commandLine">create-app</a> command. The version is stored in the application meta data file <code>application.properties</code> in the root of the project.</div>
Grailsにはアプリケーションのバージョン管理のためのサポートが組み込まれています。最初に<a href="../ref/Command Line/create-app.html" class="commandLine">create-app</a>コマンドを使用してアプリケーションを作成した際には、アプリケーションのバージョンは<code>0.1</code>に設定されています。バージョンは、プロジェクトルートにあるアプリケーションのメタデータファイルの<code>application.properties</code>に記述されます。<p class="paragraph"/><div class="hidden-block">To change the version of your application you can edit the file manually, or run the <a href="../ref/Command Line/set-version.html" class="commandLine">set-version</a> command:</div>
アプリケーションのバージョンを変更するには、ファイルを手動で編集するか、<a href="../ref/Command Line/set-version.html" class="commandLine">set-version</a>コマンドを実行します。<p class="paragraph"/><div class="code"><pre>grails set&#45;version 0.2</pre></div><p class="paragraph"/><div class="hidden-block">The version is used in various commands including the <a href="../ref/Command Line/war.html" class="commandLine">war</a> command which will append the application version to the end of the created WAR file.</div>
バージョンは、<a href="../ref/Command Line/war.html" class="commandLine">war</a>コマンドを含む様々なコマンドで使用されています。このwarコマンドは作成されるWARファイルの最後にアプリケーションのバージョンを追加します。<p class="paragraph"/><div class="hidden-block">h4. Detecting Versions at Runtime</div>
<h4>実行時のバージョン検出</h4><p class="paragraph"/><div class="hidden-block">You can detect the application version using Grails' support for application metadata using the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> class. For example within <a href="../guide/single.html#controllers" class="guide">controllers</a> there is an implicit <a href="../ref/Controllers/grailsApplication.html" class="controllers">grailsApplication</a> variable that can be used:</div>
<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a>クラスを使って、アプリケーションのメタデータからアプリケーションのバージョンを検出することができます。例えば<a href="../guide/single.html#controllers" class="guide">controllers</a>内では暗黙的な<a href="../ref/Controllers/grailsApplication.html" class="controllers">grailsApplication</a>変数が使用できます。<p class="paragraph"/><div class="code"><pre>def version = grailsApplication.metadata&#91;'app.version'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">You can retrieve the the version of Grails that is running with:</div>
実行しているGrailsのバージョンを取得することができます。<p class="paragraph"/><div class="code"><pre>def grailsVersion = grailsApplication.metadata&#91;'app.grails.version'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">or the <code>GrailsUtil</code> class:</div>
または、<code>GrailsUtil</code>クラスを使います。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.util.GrailsUtil
&#8230;
def grailsVersion = GrailsUtil.grailsVersion</pre></div>


<a name="3.6 Project Documentation"><!-- Legacy link --></a>
<h2 id="docengine">4.6 プロジェクト・ドキュメント</h2>
<div class="hidden-block">Since Grails 1.2, the documentation engine that powers the creation of this documentation has been available for your own Grails projects.</div>
Grails1.2から、ドキュメントの作成を行うドキュメンテーションエンジンが、Grailsプロジェクトのドキュメント作成のために利用されています。<p class="paragraph"/><div class="hidden-block">The documentation engine uses a variation on the <a href="http://textile.sitemonks.com/" target="blank">Textile</a> syntax to automatically create project documentation with smart linking, formatting etc.</div>
ドキュメンテーションエンジンは、スマートなリンク指定や書式設定で、自動的にプロジェクトのドキュメントを作成する<a href="http://textile.sitemonks.com/" target="blank">Textile</a>構文に変化を持たせたものを利用しています。<p class="paragraph"/><div class="hidden-block">h4. Creating project documentation</div>
<h4>プロジェクトドキュメントの作成</h4><p class="paragraph"/><div class="hidden-block">To use the engine you need to follow a few conventions. First, you need to create a <code>src/docs/guide</code> directory where your documentation source files will go. Then, you need to create the source docs themselves. Each chapter should have its own gdoc file as should all numbered sub-sections. You will end up with something like:</div>
エンジンを利用するには規則に従う必要があります。はじめに、ドキュメントのソースファイル置き場として<code>src/docs/guide</code>ディレクトリを作る必要があります。次に、ソースファイル自体を作成する必要があります。すべてのサブセクションに番号が振られているように、各章には独自のgdocファイルをもつべきです。以下のようになります。<p class="paragraph"/><div class="code"><pre>+ src/docs/guide/introduction.gdoc
+ src/docs/guide/introduction/changes.gdoc
+ src/docs/guide/gettingStarted.gdoc
+ src/docs/guide/configuration.gdoc
+ src/docs/guide/configuration/build.gdoc
+ src/docs/guide/configuration/build/controllers.gdoc</pre></div><p class="paragraph"/><div class="hidden-block">Note that you can have all your gdoc files in the top-level directory if you want, but you can also put sub-sections in sub-directories named after the parent section - as the above example shows.</div>
トップレベルのディレクトリにすべてのgdocを配置することもできますが、上記例のように親セクションの下に指定したサブセクションを配置することもできます。<p class="paragraph"/><div class="hidden-block">Once you have your source files, you still need to tell the documentation engine what the structure of your user guide is going to be. To do that, you add a <code>src/docs/guide/toc.yml</code> file that contains the structure and titles for each section. This file is in <a href="http://www.yaml.org/" target="blank">YAML</a> format and basically represents the structure of the user guide in tree form. For example, the above files could be represented as:</div>
ソースファイルを作成したら、さらにユーザガイドの構造をドキュメンテーションエンジンに教えてあげる必要があります。これを行うには各セクションの構造やタイトルが含まれる、<code>src/docs/guide/toc.yml</code>ファイルを追加します。このファイルは<a href="http://www.yaml.org/" target="blank">YAML</a>形式で、基本的にはツリー形式でユーザガイドの構造を表しています。例えば、上記のファイル構造は次のように表すことができます。<p class="paragraph"/><div class="code"><pre>introduction:
  title: Introduction
  changes: Change Log
gettingStarted: Getting Started
configuration:
  title: Configuration
  build:
    title: Build Config
    controllers: Specifying Controllers</pre></div><p class="paragraph"/><div class="hidden-block">The format is pretty straightforward. Any section that has sub-sections is represented with the corresponding filename (minus the .gdoc extension) followed by a colon. The next line should contain <code>title:</code> plus the title of the section as seen by the end user. Every sub-section then has its own line after the title. Leaf nodes, i.e. those without any sub-sections, declare their title on the same line as the section name but after the colon.</div>
フォーマットは非常に簡単です。サブセクションを持つセクションは、対応するファイル名（.gdocを除く）の後にコロンをつけて表されています。次の行には<code>title:</code>に加えて、エンドユーザが目にするセクションのタイトルを記述します。すべてのサブセクションではタイトルの後に独自のラインを持っています。サブセクションを持たないセクションでは、セクション名と同じ行のコロンの後にタイトルを宣言します。<p class="paragraph"/><div class="hidden-block">That's it. You can easily add, remove, and move sections within the <code>toc.yml</code> to restructure the generated user guide. You should also make sure that all section names, i.e. the gdoc filenames, should be unique since they are used for creating internal links and for the HTML filenames. Don't worry though, the documentation engine will warn you of duplicate section names.</div>
また、生成されたユーザガイドを再構築するために、<code>toc.yml</code>内部で簡単にセクションの追加や削除、移動ができます。すべてのセクション名（gdocのファイル名）はユニークである必要があります。なぜなら、それらは内部リンクの作成やHTMLのファイル名に使用されるからです。しかし、心配はいりません。ドキュメンテーションエンジンはセクション名が重複していた場合に警告を表示します。<p class="paragraph"/><div class="hidden-block">h4. Creating reference items</div>
<h4>参照項目の作成</h4><p class="paragraph"/><div class="hidden-block">Reference items appear in the Quick Reference section of the documentation. Each reference item belongs to a category and a category is a directory located in the <code>src/docs/ref</code> directory. For example, suppose you have defined a new controller method called <code>renderPDF</code>. That belongs to the <code>Controllers</code> category so you would create a gdoc text file at the following location:</div>
リファレンス項目はドキュメントのクイックリファレンスセクションに表示されます。各参照項目はカテゴリに属し、カテゴリは<code>src/docs/ref</code>ディレクトリに配置します。例えば、コントローラに新しく<code>renderPDF</code>のメソッドを定義したとしましょう。これが<code>Controllers</code>カテゴリに所属する場合、以下のようにgdocのテキストファイルを作成します。:<p class="paragraph"/><div class="code"><pre>+ src/docs/ref/Controllers/renderPDF.gdoc</pre></div><p class="paragraph"/><div class="hidden-block">h4. Configuring Output Properties</div>
<h4>出力プロパティの設定</h4><p class="paragraph"/><div class="hidden-block">There are various properties you can set within your <code>grails-app/conf/Config.groovy</code> file that customize the output of the documentation such as:</div>
以下のようにドキュメント出力をカスタマイズする、<code>grails-app/conf/Config.groovy</code>内で設定できる様々なプロパティがあります。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><strong class="bold">grails.doc.title</strong> - The title of the documentation</li>
<li><strong class="bold">grails.doc.subtitle</strong> - The subtitle of the documentation</li>
<li><strong class="bold">grails.doc.authors</strong> - The authors of the documentation</li>
<li><strong class="bold">grails.doc.license</strong> - The license of the software</li>
<li><strong class="bold">grails.doc.copyright</strong> - The copyright message to display</li>
<li><strong class="bold">grails.doc.footer</strong> - The footer to use</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><strong class="bold">grails.doc.title</strong> - ドキュメントのタイトル</li>
<li><strong class="bold">grails.doc.subtitle</strong> - ドキュメントのサブタイトル</li>
<li><strong class="bold">grails.doc.authors</strong> - ドキュメントの著者</li>
<li><strong class="bold">grails.doc.license</strong> - ソフトウェアライセンス</li>
<li><strong class="bold">grails.doc.copyright</strong> - copyrightメッセージの表示</li>
<li><strong class="bold">grails.doc.footer</strong> - 使用するフッター</li>
</ul><p class="paragraph"/><div class="hidden-block">Other properties such as the version are pulled from your project itself.  If a title is not specified, the application name is used.</div>
バージョンなどの他のプロパティは、プロジェクト自体から取得します。タイトルが指定されていない場合は、アプリケーション名が使用されます。<p class="paragraph"/><div class="hidden-block">You can also customise the look of the documentation and provide images by setting a few other options:</div>
また、他のオプションの設定によって、ドキュメントの外観をカスタマイズしたり、画像を設定したりできます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><strong class="bold">grails.doc.css</strong> - The location of a directory containing custom CSS files (type <code>java.io.File</code>)</li>
<li><strong class="bold">grails.doc.js</strong> - The location of a directory containing custom JavaScript files (type <code>java.io.File</code>)</li>
<li><strong class="bold">grails.doc.style</strong> - The location of a directory containing custom HTML templates for the guide (type <code>java.io.File</code>)</li>
<li><strong class="bold">grails.doc.images</strong> - The location of a directory containing image files for use in the style templates and within the documentation pages themselves (type <code>java.io.File</code>)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><strong class="bold">grails.doc.css</strong> - カスタマイズしたCSSファイルを含むディレクトリ場所（<code>java.io.File</code>クラスの型）</li>
<li><strong class="bold">grails.doc.js</strong> - カスタマイズしたJavaScriptファイルを含むディレクトリ場所（<code>java.io.File</code>クラスの型）</li>
<li><strong class="bold">grails.doc.style</strong> - ガイド用にカスタマイズしたHTMLテンプレートを含むディレクトリ場所(<code>java.io.File</code>クラスの型)</li>
<li><strong class="bold">grails.doc.images</strong> - スタイルテンプレートやドキュメントページ自身で使用する画像ファイルを含むディレクトリ場所(<code>java.io.File</code>の型)</li>
</ul><p class="paragraph"/><div class="hidden-block">One of the simplest ways to customise the look of the generated guide is to provide a value for <code>grails.doc.css</code> and then put a custom.css file in the corresponding directory. Grails will automatically include this CSS file in the guide. You can also place a custom-pdf.css file in that directory. This allows you to override the styles for the PDF version of the guide.</div>
生成したドキュメントの見た目をカスタマイズする一番シンプルな方法は、<code>grails.doc.css</code>の値を記述し、対応するディレクトリにcustom.cssファイルを置くことです。Grailsは自動的にドキュメント内にこのCSSファイルを取り込みます。また、そのディレクトリにcustom-pdf.cssファイルを置くことができます。これは、ドキュメントのpdfバージョンのスタイルを上書きできます。<p class="paragraph"/><div class="hidden-block">h4. Generating Documentation</div>
<h4>ドキュメントの生成</h4><p class="paragraph"/><div class="hidden-block">Once you have created some documentation (refer to the syntax guide in the next chapter) you can generate an HTML version of the documentation using the command:</div>
一度ドキュメントが作成（次の章の構文ガイドを参照）できたら、次のコマンドを使用してHTML形式のドキュメントを生成できます。<p class="paragraph"/><div class="code"><pre>grails doc</pre></div><p class="paragraph"/><div class="hidden-block">This command will output an <code>docs/manual/index.html</code> which can be opened in a browser to view your documentation.</div>
このコマンドで、ブラウザで表示できる形式のドキュメントが<code>docs/manual/index.html</code>に出力されます。<p class="paragraph"/><div class="hidden-block">h4. Documentation Syntax</div>
<h4>ドキュメントの構文</h4><p class="paragraph"/><div class="hidden-block">As mentioned the syntax is largely similar to Textile or Confluence style wiki markup. The following sections walk you through the syntax basics.</div>
ドキュメントの構文はwikiのTextile記法やConfluence記法とほぼ同じです。以下のセクションでは、構文の基礎を説明します。<p class="paragraph"/><div class="hidden-block">h5. Basic Formatting</div>
<h5>基本的なフォーマット</h5><p class="paragraph"/><div class="hidden-block">Monospace: <code>monospace</code></div>
等幅フォント: <code>monospace</code>
<div class="code"><pre>&#64;monospace&#64;</pre></div><p class="paragraph"/><div class="hidden-block">Italic:  <em class="italic">italic</em> </div>
イタリック体:  <em class="italic">italic</em> 
<div class="code"><pre>&#95;italic&#95;</pre></div><p class="paragraph"/><div class="hidden-block">Bold: <strong class="bold">bold</strong></div>
太字: <strong class="bold">bold</strong>
<div class="code"><pre>&#42;bold&#42;</pre></div><p class="paragraph"/><div class="hidden-block">Image:</div>
画像:
<img border="0" class="center" src="http://grails.org/images/new/grailslogo_topNav.png"></img><p class="paragraph"/><div class="code"><pre>&#33;http://grails.org/images/new/grailslogo_topNav.png&#33;</pre></div><p class="paragraph"/><div class="hidden-block">You can also link to internal images like so:</div>
次のように内部の画像へリンクすることもできます。<p class="paragraph"/><div class="code"><pre>&#33;someFolder/my_diagram.png&#33;</pre></div><p class="paragraph"/><div class="hidden-block">This will link to an image stored locally within your project. There is currently no default location for doc images, but you can specify one with the <code>grails.doc.images</code> setting in Config.groovy like so:</div>
これはプロジェクト内でローカルに保存された画像にリンクします。デフォルトの画像置き場はありませんが、次のようにConfig.groovy内の<code>grails.doc.images</code>の設定で指定できます。<p class="paragraph"/><div class="code"><pre>grails.doc.images = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"src/docs/images"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">In this example, you would put the my_diagram.png file in the directory 'src/docs/images/someFolder'.</div>
この例では、'src/docs/images/someFolder'ディレクトリ内にmy_diagram.pngファイルを置いています。<p class="paragraph"/><div class="hidden-block">h5. Linking</div>
<h5>リンク生成</h5><p class="paragraph"/><div class="hidden-block">There are several ways to create links with the documentation generator. A basic external link can either be defined using confluence or textile style markup:</div>
ドキュメントジェネレータでリンクを生成する方法はいくつかあります。基本的な外部リンクはconfluence記法、またはtextile記法のどちらかを使うことで定義できます。<p class="paragraph"/><div class="code"><pre>&#91;SpringSource|http://www.springsource.com/&#93;</pre></div><p class="paragraph"/>or<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"SpringSource"</span>:http://www.springsource.com/</pre></div><p class="paragraph"/><div class="hidden-block">For links to other sections inside the user guide you can use the <code>guide:</code> prefix with the name of the section you want to link to:</div>
ユーザガイド内の他のセクションへのリンクについては、リンクしたいセクションの頭に<code>guide:</code>をつけることで実現できます。<p class="paragraph"/><div class="code"><pre>&#91;Intro|guide:introduction&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The section name comes from the corresponding gdoc filename. The documentation engine will warn you if any links to sections in your guide break.</div>
セクション名は対応するgdocファイル名を使用します。ガイドのセクションへのリンクが壊れると、ドキュメンテーションエンジンは警告を表示します。<p class="paragraph"/><div class="hidden-block">To link to reference items you can use a special syntax:</div>
参照項目へのリンクは、特別な構文で使用できます。<p class="paragraph"/><div class="code"><pre>&#91;controllers|renderPDF&#93;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the category of the reference item is on the left hand side of the | and the name of the reference item on the right.</div>
この場合では、参照項目のカテゴリは|の左側に記述し、右側には参照項目の名前を記述します。<p class="paragraph"/><div class="hidden-block">Finally, to link to external APIs you can use the <code>api:</code> prefix. For example:</div>
最後に、<code>api:</code>プレフィックスを使うことで外部APIへリンクできます。例えば：<p class="paragraph"/><div class="code"><pre>&#91;<span class="java&#45;object">String</span>|api:java.lang.<span class="java&#45;object">String</span>&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The documentation engine will automatically create the appropriate javadoc link in this case. To add additional APIs to the engine you can configure them in <code>grails-app/conf/Config.groovy</code>. For example:</div>
この場合、ドキュメンテーションエンジンは自動的に適切なJavadocリンクを生成します。<code>grails-app/conf/Config.groovy</code>に設定を追加することで、エンジンに追加のAPIを加えることができます。例えば：<p class="paragraph"/><div class="code"><pre>grails.doc.api.org.hibernate=
            <span class="java&#45;quote">"http://docs.jboss.org/hibernate/stable/core/javadocs"</span></pre></div><p class="paragraph"/><div class="hidden-block">The above example configures classes within the <code>org.hibernate</code> package to link to the Hibernate website's API docs.</div>
上記の例では、<code>org.hibernate</code>パッケージ内のクラスを、HibernateのAPIドキュメントへリンクするように設定しています。<p class="paragraph"/><div class="hidden-block">h5. Lists and Headings</div>
<h5>リストと見出し</h5><p class="paragraph"/><div class="hidden-block">Headings can be created by specifying the letter 'h' followed by a number and then a dot:</div>
見出しは'h'の後に数字とドットを指定することで作成できます。<p class="paragraph"/><div class="code"><pre>h3.&#60;space&#62;Heading3
h4.&#60;space&#62;Heading4</pre></div><p class="paragraph"/><div class="hidden-block">Unordered lists are defined with the use of the * character:</div>
順不同のリストは*文字を使うことで定義できます。<p class="paragraph"/><div class="code"><pre>&#42; item 1
&#42;&#42; subitem 1
&#42;&#42; subitem 2
&#42; item 2</pre></div><p class="paragraph"/><div class="hidden-block">Numbered lists can be defined with the # character:</div>
番号付きリストは#文字で定義できます。<p class="paragraph"/><div class="code"><pre>&#35; item 1</pre></div><p class="paragraph"/><div class="hidden-block">Tables can be created using the <code>table</code> macro:</div>
テーブルは<code>table</code>マクロを使って作成できます。<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Name</strong></th><th><strong class="bold">Number</strong></th></tr><tr class="table-odd"><td>Albert</td><td>46</td></tr><tr class="table-even"><td>Wilma</td><td>1348</td></tr><tr class="table-odd"><td>James</td><td>12</td></tr></table><p class="paragraph"/><div class="code"><pre>&#123;table&#125;
 &#42;Name&#42; | &#42;<span class="java&#45;object">Number</span>&#42;
 Albert | 46
 Wilma | 1348
 James | 12
&#123;table&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h5. Code and Notes</div>
<h5>コードとノート</h5><p class="paragraph"/><div class="hidden-block">You can define code blocks with the <code>code</code> macro:</div>
<code>code</code>マクロでコードブロックを定義できます。<p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>&#123;code&#125;
class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;
&#123;code&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The example above provides syntax highlighting for Java and Groovy code, but you can also highlight XML markup:</div>
上記の例は、JavaやGroovyのシンタックスハイライトで記述していますが、XMLのハイライト表示でも記述できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;hello&#62;</span>world<span class="xml&#45;tag">&#60;/hello&#62;</span></pre></div><p class="paragraph"/><div class="code"><pre>&#123;code:xml&#125;
&#60;hello&#62;world&#60;/hello&#62;
&#123;code&#125;</pre></div><p class="paragraph"/><div class="hidden-block">There are also a couple of macros for displaying notes and warnings:</div>
注意や警告を表示するためのマクロもあります。<p class="paragraph"/>Note:
<blockquote class="note">
This is a note!
</blockquote><p class="paragraph"/><div class="code"><pre>&#123;note&#125;
This is a note!
&#123;note&#125;</pre></div><p class="paragraph"/>Warning:<p class="paragraph"/><blockquote class="warning">
This is a warning!
</blockquote><p class="paragraph"/><div class="code"><pre>&#123;warning&#125;
This is a warning!
&#123;warning&#125;</pre></div>


<a name="3.7 Dependency Resolution"><!-- Legacy link --></a>
<h2 id="dependencyResolution">4.7 依存性解決</h2>
<div class="hidden-block">Grails features a dependency resolution DSL that lets you control how plugins and JAR dependencies are resolved.</div>
Grailsは依存関係解決のためのDSLクエリー言語を持ち、これによりプラグインとJARの依存関係を解決する方法を制御できます。<p class="paragraph"/><div class="hidden-block">You can choose to use Aether (since Grails 2.3) or Apache Ivy as the dependency resolution engine. Aether is the dependency resolution library used by the Maven build tool, so if you are looking for Maven-like behavior then Aether is the better choise. Ivy allows more flexibility if you wish to resolve jars from flat file systems or none HTTP repositories. Aether is the default dependency resolution engine for Grails applications since Grails 2.3. </div>
依存関係解決エンジンとして、Aether（Grails2.3以降）あるいはApache Ivyのどちらかを選択できます。Aetherは、Mavenビルド・ツール内で使用されている依存関係解決ライブラリであり、Mavenのような振る舞いを期待しているなら、Aetherを選択すべきです。Ivyは、単層ファイルシステムまたはHTTP通信を行わないリポジトリからjarファイルを解決したい場合には、より柔軟性が高いです。Grails 2.3以降においては、AetherがGrailsアプリケーションのデフォルトの依存関係解決エンジンです。<p class="paragraph"/><div class="hidden-block">To configure which dependency resolution engine to use you can specify the <code>grails.project.dependency.resolver</code> setting in <code>grails-app/conf/BuildConfig.groovy</code>. The default setting is shown below:</div>
使用する依存関係解決エンジンは、<code>grails-app/conf/BuildConfig.groovy</code>ファイル内の<code>grails.project.dependency.resolver</code>を設定することで指定出来ます。デフォルト設定は次のとおりです:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolver = <span class="java&#45;quote">"maven"</span> // or ivy</pre></div><p class="paragraph"/><div class="hidden-block">You can then specify a <code>grails.project.dependency.resolution</code> property inside the <code>grails-app/conf/BuildConfig.groovy</code> file that configures how dependencies are resolved:</div>
<code>grails-app/conf/BuildConfig.groovyの</code>ファイル内の、<code>grails.project.dependency.resolution</code>プロパティを次のように指定することで、依存関係を解決する方法が設定できます:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
   // config here
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The default configuration looks like the following:</div>
デフォルト設定は以下です:<p class="paragraph"/><div class="code"><pre>grails.project.class.dir = <span class="java&#45;quote">"target/classes"</span>
grails.project.test.class.dir = <span class="java&#45;quote">"target/test&#45;classes"</span>
grails.project.test.reports.dir = <span class="java&#45;quote">"target/test&#45;reports"</span>
//grails.project.war.file = <span class="java&#45;quote">"target/&#36;&#123;appName&#125;&#45;&#36;&#123;appVersion&#125;.war"</span><p class="paragraph"/>grails.project.dependency.resolution = &#123;
    // inherit Grails' <span class="java&#45;keyword">default</span> dependencies
    inherits(<span class="java&#45;quote">"global"</span>) &#123;
        // uncomment to disable ehcache
        // excludes 'ehcache'
    &#125;
    log <span class="java&#45;quote">"warn"</span>
    repositories &#123;
        grailsPlugins()
        grailsHome()
        grailsCentral()
        mavenCentral()
        mavenLocal()<p class="paragraph"/>        // uncomment these to enable remote dependency resolution
        // from <span class="java&#45;keyword">public</span> Maven repositories
        //mavenRepo <span class="java&#45;quote">"http://snapshots.repository.codehaus.org"</span>
        //mavenRepo <span class="java&#45;quote">"http://repository.codehaus.org"</span>
        //mavenRepo <span class="java&#45;quote">"http://download.java.net/maven/2/"</span>
        //mavenRepo <span class="java&#45;quote">"http://repository.jboss.com/maven2/"</span>
    &#125;
    dependencies &#123;
        // specify dependencies here under either 'build', 'compile',
        // 'runtime', 'test' or 'provided' scopes eg.<p class="paragraph"/>        // runtime 'mysql:mysql&#45;connector&#45;java:5.1.16'
        build <span class="java&#45;quote">"org.grails:grails&#45;plugin&#45;tomcat:$grailsVersion"</span>
        runtime <span class="java&#45;quote">"org.grails:grails&#45;plugin&#45;hibernate:$grailsVersion"</span>        
    &#125;<p class="paragraph"/>    plugins &#123;<p class="paragraph"/>        compile <span class="java&#45;quote">"&#58;jquery:1.8.3"</span>
        compile <span class="java&#45;quote">"&#58;resources:1.1.6"</span><p class="paragraph"/>        build <span class="java&#45;quote">"&#58;tomcat:&#36;grailsVersion"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The details of the above will be explained in the next few sections.</div>
上記の詳細については、次節以降で説明します。<p class="paragraph"/>

<a name="3.7.1 Configurations and Dependencies"><!-- Legacy link --></a>
<h2 id="configurationsAndDependencies">4.7.1 設定と依存</h2>
<div class="hidden-block">Grails features five dependency resolution configurations (or 'scopes'):</div>
Grailsは、依存関係解決のための5つの設定（'スコープ'とも呼ばれます）を用意しています:<p class="paragraph"/><div class="hidden-block">*  <code>build</code>: Dependencies for the build system only</div>
<ul class="star">
<li> <code>build</code>: ビルドシステムのためだけの依存関係</li>
</ul><p class="paragraph"/><div class="hidden-block">*  <code>compile</code>: Dependencies for the compile step</div>
<ul class="star">
<li> <code>compile</code>: コンパイルのための依存関係</li>
</ul><p class="paragraph"/><div class="hidden-block">*  <code>runtime</code>: Dependencies needed at runtime but not for compilation (see above)</div>
<ul class="star">
<li> <code>runtime</code>: 実行時には必要だが、コンパイル時には不必要な依存関係（上記参照）</li>
</ul><p class="paragraph"/><div class="hidden-block">*  <code>test</code>: Dependencies needed for testing but not at runtime (see above)</div>
<ul class="star">
<li> <code>test</code>: テスト時には必要だが、実行時には不必要な依存関係（上記参照）</li>
</ul><p class="paragraph"/><div class="hidden-block">*  <code>provided</code>: Dependencies needed at development time, but not during WAR deployment</div>
<ul class="star">
<li> <code>provided</code>: 開発時には必要だが、WARファイルのデプロイ時には不必要な依存関係</li>
</ul><p class="paragraph"/><div class="hidden-block">Within the <code>dependencies</code> block you can specify a dependency that falls into one of these configurations by calling the equivalent method. For example if your application requires the MySQL driver to function at <code>runtime</code> you can specify that like this:</div>
<code>dependencies</code>ブロックの内部で上記のメソッドを呼び出すことにより、依存関係を指定することができます。たとえば、アプリケーションが<code>runtime</code>時にMySQLドライバを必要とする場合は、次のように指定することができます:<p class="paragraph"/><div class="code"><pre>runtime 'com.mysql:mysql&#45;connector&#45;java:5.1.16'</pre></div><p class="paragraph"/><div class="hidden-block">This uses the string syntax: <code>group:name:version</code>. </div>
上記では、<code>グループ:名前:バージョン</code>というString構文を使用しています。<p class="paragraph"/>
<div class="hidden-block">If you are using Aether as the dependency resolution library, the Maven pattern of:</div>
Aetherを依存関係解決ライブラリーとして利用する場合は、以下のようなMaven形式で記載します:<p class="paragraph"/><div class="code"><pre>&#60;groupId&#62;:&#60;artifactId&#62;&#91;:&#60;extension&#62;&#91;:&#60;classifier&#62;&#93;&#93;:&#60;version&#62;</pre></div><p class="paragraph"/><div class="hidden-block">You can also use a Map-based syntax:</div>
Map構文も使用できます:<p class="paragraph"/><div class="code"><pre>runtime group: 'com.mysql',
        name: 'mysql&#45;connector&#45;java',
        version: '5.1.16'</pre></div><p class="paragraph"/><div class="hidden-block">Possible settings to the map syntax are:</div>
Map構文で可能な設定は次のとおりです:<p class="paragraph"/><div class="hidden-block">* <code>group</code> - The group / organization (or groupId in Maven terminology)</div>
<ul class="star">
<li><code>group</code> - グループ/組織（Mavenの用語ではgroupId）</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>name</code> - The dependency name (or artifactId in Maven terminology)</div>
<ul class="star">
<li><code>name</code> - 依存関係名 (Mavenの用語ではartifactId)</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>version</code> - The version of the dependency</div>
<ul class="star">
<li><code>version</code> - 依存関係のバージョン</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>extension</code> (Aether only) - The file extension of the dependency</div>
<ul class="star">
<li><code>extension</code> (Aetherのみ) - 依存関係のファイル拡張子</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>classifier</code> - The dependency classifier</div>
<ul class="star">
<li><code>classifier</code> - 依存関係の分類</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>branch</code> (Ivy only) - The branch of the dependency</div>
<ul class="star">
<li><code>branch</code>（Ivyのみ） - 依存関係のブランチ</li>
</ul><p class="paragraph"/><div class="hidden-block">* <code>transitive</code> (Ivy only) - Whether the dependency has transitive dependencies</div>
<ul class="star">
<li><code>transitive</code> (Ivyのみ) - 推移的依存関係の有無</li>
</ul><p class="paragraph"/><div class="hidden-block">As you can see from the list above some dependency configuration settings work only in Aether and some only in Ivy.</div>
上記のリストからわかるように、依存関係の設定の一部は、Ivyのみで動作するものと、Aetherのみでと一部のみで動作するものがあります。<p class="paragraph"/><div class="hidden-block">Multiple dependencies can be specified by passing multiple arguments:</div>
複数の依存関係は、複数の引数を渡すことで指定できます:<p class="paragraph"/><div class="code"><pre>runtime 'com.mysql:mysql&#45;connector&#45;java:5.1.16',
        'net.sf.ehcache:ehcache:1.6.1'<p class="paragraph"/>// Or<p class="paragraph"/>runtime(
    &#91;group:'com.mysql', name:'mysql&#45;connector&#45;java', version:'5.1.16'&#93;,
    &#91;group:'net.sf.ehcache', name:'ehcache', version:'1.6.1'&#93;
)</pre></div><p class="paragraph"/><div class="hidden-block">h3. Disabling transitive dependency resolution</div>
<h3>推移的依存関係解決の無効化</h3><p class="paragraph"/><div class="hidden-block">By default, Grails will not only get the JARs and plugins that you declare, but it will also get their transitive dependencies. This is usually what you want, but there are occasions where you want a dependency without all its baggage. In such cases, you can disable transitive dependency resolution on a case-by-case basis:</div>
デフォルトでは、Grailsは宣言したJARファイルやプラグインだけでなく、それらの推移的依存関係を取得します。これは、通常は望ましいことですが、推移的依存関係を取得したくない場合もあります。そのような場合、状況に応じて推移的依存関係解決を無効にできます:<p class="paragraph"/><div class="code"><pre>runtime('com.mysql:mysql&#45;connector&#45;java:5.1.16',
        'net.sf.ehcache:ehcache:1.6.1') &#123;
    transitive = <span class="java&#45;keyword">false</span>
&#125;<p class="paragraph"/>// Or
runtime group:'com.mysql',
        name:'mysql&#45;connector&#45;java',
        version:'5.1.16',
        transitive:<span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="warning">
Disabling transitive dependency resolution only works with the Ivy dependency manager. Aether does not support disabling of transitive resolution, instead explicit exclusions are required (see below).
</blockquote>
</div><p class="paragraph"/><blockquote class="warning">
推移的依存関係解決の無効化は、Ivy依存関係マネージャとだけ連携して動作します。Aetherは推移的解決をサポートしておらず、明示的に除外する必要があります（下記参照）。
</blockquote><p class="paragraph"/>
<div class="hidden-block">h3. Excluding specific transitive dependencies</div>
<h3>特定の推移的依存関係の除外</h3><p class="paragraph"/><div class="hidden-block">A far more common scenario is where you want the transitive dependencies, but some of them cause issues with your own dependencies or are unnecessary. For example, many Apache projects have 'commons-logging' as a transitive dependency, but it shouldn't be included in a Grails project (we use SLF4J). That's where the <code>excludes</code> option comes in:</div>
頻繁に起こりうるシチュエーションは、推移的依存関係解決は動作させたい一方で、そのうちいくつかの依存関係は独自プログラムの依存関係に問題を発生させたり、不要だったりする場合です。たとえば、多くのApacheプロジェクトは推移依存関係として"commons-logging"を持っていますが、それはGrailsプロジェクトに含まれるべきではありません（GrailsはSLF4Jを使用している）。このような場合は、<code>excludes</code>オプションを使用します:<p class="paragraph"/><div class="code"><pre>runtime('com.mysql:mysql&#45;connector&#45;java:5.1.16',
        'net.sf.ehcache:ehcache:1.6.1') &#123;
    excludes <span class="java&#45;quote">"xml&#45;apis"</span>, <span class="java&#45;quote">"commons&#45;logging"</span>
&#125;<p class="paragraph"/>// Or
runtime(group:'com.mysql', name:'mysql&#45;connector&#45;java', version:'5.1.16') &#123;
    excludes(&#91; group: 'xml&#45;apis', name: 'xml&#45;apis'&#93;,
             &#91; group: 'org.apache.httpcomponents' &#93;,
             &#91; name: 'commons&#45;logging' &#93;)</pre></div><p class="paragraph"/><div class="hidden-block">As you can see, you can either exclude dependencies by their artifact ID (also known as a module name) or any combination of group and artifact IDs (if you use the Map notation). You may also come across <code>exclude</code> as well, but that can only accept a single string or Map:</div>
見てのとおり、アーティファクトID（モジュール名と言うこともあります）、または任意のグループIDとアーティファクトIDの組み合わせ（Map表記を使用している場合）によって、推移的依存関係解決を行う依存関係を除外できます。<code>exclude</code>オプションを利用する場合も同様ですが、こちらは単一の文字列またはMapのみを許容します:<p class="paragraph"/><div class="code"><pre>runtime('com.mysql:mysql&#45;connector&#45;java:5.1.16',
        'net.sf.ehcache:ehcache:1.6.1') &#123;
    exclude <span class="java&#45;quote">"xml&#45;apis"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h3. Using Ivy module configurations</div>
<h3>Ivyモジュール構成の使用</h3><p class="paragraph"/><div class="hidden-block">Using the Ivy dependency manager (Aether not supported), if you use Ivy module configurations and wish to depend on a specific configuration of a module, you can use the <code>dependencyConfiguration</code> method to specify the configuration to use.</div>
Ivyモジュール構成を使用していて、指定したモジュール構成に依存させたい場合は、<code>dependencyConfiguration</code>メソッドを用いて使用する構成を指定できます。<p class="paragraph"/><div class="code"><pre>provided(<span class="java&#45;quote">"my.org:web&#45;service:1.0"</span>) &#123;
    dependencyConfiguration <span class="java&#45;quote">"api"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If the dependency configuration is not explicitly set, the configuration named <code>"default"</code> will be used (which is also the correct value for dependencies coming from Maven style repositories).</div>
依存関係の設定が明示的にされていない場合は、<code>"default"</code>設定が使用されます。（これは、Mavenスタイルのリポジトリから来る依存関係に対しても正しい値です）<p class="paragraph"/><div class="hidden-block">h3. Where are the JARs?</div>
<h3>JARファイルの場所</h3><p class="paragraph"/><div class="hidden-block">With all these declarative dependencies, you may wonder where all the JARs end up. They have to go somewhere after all. By default Grails puts them into a directory, called the dependency cache, that resides on your local file system at <code>user.home/.grails/ivy-cache</code> or <code>user.home/.m2/repository</code> when using Aether. You can change this either via the <code>settings.groovy</code> file:</div>
当然、宣言された全ての依存関係の実態であるJARファイルは、必ずどこかに存在している必要があります。デフォルトでは、Grailsは依存関係キャッシュと呼ばれるディレクトリにJARファイルを入れます。このディレクトリは、ローカル・ファイル・システム上の<code>user.home/.grails/ivy-cache</code>もしくは<code>user.home/.m2/repository</code>（Aether使用時）に配置されます。<code>settings.groovy</code>ファイルによって、この場所を変更できます:<p class="paragraph"/><div class="code"><pre>grails.dependency.cache.dir = <span class="java&#45;quote">"$&#123;userHome&#125;/.my&#45;dependency&#45;cache"</span></pre></div><p class="paragraph"/><div class="hidden-block">or in the dependency DSL:</div>
依存関係DSLクエリー言語内でも変更可能です:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    &#8230;
    cacheDir <span class="java&#45;quote">"target/ivy&#45;cache"</span>
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>settings.groovy</code> option applies to all projects, so it's the preferred approach.</div>
<code>settings.groovy</code>オプションを使用すると、すべてのプロジェクトに適用されるため、こちらがおすすめの方法です。


<a name="3.7.2 Dependency Repositories"><!-- Legacy link --></a>
<h2 id="dependencyRepositories">4.7.2 依存管理リポジトリ</h2>
<div class="hidden-block">h4. Remote Repositories</div>
<h4>リモートリポジトリ</h4><p class="paragraph"/><div class="hidden-block">Initially your BuildConfig.groovy does not use any remote public Maven repositories. There is a default <code>grailsHome()</code> repository that will locate the JAR files Grails needs from your Grails installation. To use a public repository, specify it in the <code>repositories</code> block:</div>
初期状態では、BuildConfig.groovyはどのMavenの公開リモートリポジトリも使用していません。デフォルトでGrailsは、Grailsのインストールに必要なJARファイルが配置されている<code>grailsHome()</code>リポジトリが存在します。公開リポジトリを使用するには、<code>repositories</code>ブロック内で以下を指定します:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    mavenCentral()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the default public Maven repository is specified. </div>
上のケースでは、デフォルトのMavenの公開リポジトリが指定されています。<p class="paragraph"/><div class="hidden-block">You can also specify a specific Maven repository to use by URL:</div>
URLによって使用する特定のMavenのリポジトリを指定することもできます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    mavenRepo <span class="java&#45;quote">"http://repository.codehaus.org"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">and even give it a name:</div>
名前をつけることもできます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    mavenRepo name: <span class="java&#45;quote">"Codehaus"</span>, root: <span class="java&#45;quote">"http://repository.codehaus.org"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">so that you can easily identify it in logs.</div>
名前をつける事によって、ログ上で簡単に特定することができます。<p class="paragraph"/><div class="hidden-block">h4. Controlling Repositories Inherited from Plugins</div>
<h4>プラグインから継承したリポジトリの制御</h4><p class="paragraph"/><div class="hidden-block">A plugin you have installed may define a reference to a remote repository just as an application can. By default your application will inherit this repository definition when you install the plugin.</div>
インストールしたプラグインは、アプリケーションが正しく参照できるように、リモートリポジトリへの参照を定義しています。デフォルトでは、アプリケーションはプラグインをインストールするときに、このリポジトリの定義を継承します。<p class="paragraph"/><div class="hidden-block">If you do not wish to inherit repository definitions from plugins then you can disable repository inheritance:</div>
プラグインからリポジトリの定義を継承したくない場合、継承を無効にすることができます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    inherit <span class="java&#45;keyword">false</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case your application will not inherit any repository definitions from plugins and it is down to you to provide appropriate (possibly internal) repository definitions.</div>
上記のケースでは、アプリケーションは、プラグインからいかなるリポジトリの定義も継承しません。適切な（おそらく内部の）リポジトリの定義を自分で提供する必要があります。<p class="paragraph"/><div class="hidden-block">h4. Offline Mode</div>
<h4>オフラインモード</h4><p class="paragraph"/><div class="hidden-block">There are times when it is not desirable to connect to any remote repositories (whilst working on the train for example!). In this case you can use the <code>offline</code> flag to execute Grails commands and Grails will not connect to any remote repositories:</div>
リモートリポジトリに接続したくない時もあります（たとえば電車の中で作業している時など）。その場合、<code>offline</code>フラグを付加してGrailsコマンドを実行すれば、Grailsはリモートリポジトリに接続しません:<p class="paragraph"/><div class="code"><pre>grails &#45;&#45;offline run&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
Note that this command will fail if you do not have the necessary dependencies in your local Ivy cache
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
ローカルIvyキャッシュ内に必要な依存関係が存在しない場合、このコマンドは失敗することに注意してください。
</blockquote><p class="paragraph"/><div class="hidden-block">You can also globally configure offline mode by setting <code>grails.offline.mode</code> to <code>true</code> in <code>~/.grails/settings.groovy</code> or in your project's <code>BuildConfig.groovy</code> file:</div>
また、<code>~/.grails/settings.groovy</code>ファイルか、プロジェクトの<code>BuildConfig.groovy</code>ファイルの<code>grails.offline.mode</code>を<code>true</code>にすることでにオフラインモードを設定することができます:<p class="paragraph"/><div class="code"><pre>grails.offline.mode=<span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">h4. Local Resolvers</div>
<h4>ローカルリゾルバ</h4><p class="paragraph"/><div class="hidden-block">If you do not wish to use a public Maven repository you can specify a flat file repository:</div>
Mavenの公開リポジトリを使用したくない場合は、フラットファイルリポジトリを指定できます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    flatDir name:'myRepo', dirs:'/path/to/repo'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="warning">
Aether does not support the <code>flatDir</code> resolver or any custom file system resolvers. The above feature works only if you are using the Ivy dependency manager.
</blockquote>
</div><p class="paragraph"/><blockquote class="warning">
Aetherは<code>flatDir</code>リゾルバを含め、いかなるカスタムファイルシステムリゾルバもサポートしていません。上記の機能は、Ivy依存関係マネージャを使用している場合にのみ動作します。
</blockquote><p class="paragraph"/><div class="hidden-block">To specify your local Maven cache (<code>~/.m2/repository</code>) as a repository:</div>
Mavenのローカルキャッシュ（<code>~/.m2/repository</code>）をリポジトリとして指定する場合は以下のようにします:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    mavenLocal()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Custom Resolvers</div>
<h4>カスタムリゾルバ</h4><p class="paragraph"/><div class="hidden-block">If you are using the Ivy dependency manager (Aether does not support custom resolvers), then you can explicitly specify an Ivy resolver:</div>
Ivy依存関係マネージャを使用している場合（Aetherはカスタムリゾルバをサポートしていません）は、明示的にIvyリゾルバを指定することができます:<p class="paragraph"/><div class="code"><pre>/&#42;
 &#42; Configure our resolver.
 &#42;/
def libResolver = <span class="java&#45;keyword">new</span> org.apache.ivy.plugins.resolver.URLResolver()
&#91;'libraries', 'builds'&#93;.each &#123;<p class="paragraph"/>    libResolver.addArtifactPattern(
            <span class="java&#45;quote">"http://my.repository/&#36;&#123;it&#125;/"</span> +
            <span class="java&#45;quote">"&#91;organisation&#93;/&#91;module&#93;/&#91;revision&#93;/&#91;type&#93;s/&#91;artifact&#93;.&#91;ext&#93;"</span>)<p class="paragraph"/>    libResolver.addIvyPattern(
            <span class="java&#45;quote">"http://my.repository/&#36;&#123;it&#125;/"</span> +
            <span class="java&#45;quote">"&#91;organisation&#93;/&#91;module&#93;/&#91;revision&#93;/&#91;type&#93;s/&#91;artifact&#93;.&#91;ext&#93;"</span>)
&#125;<p class="paragraph"/>libResolver.name = <span class="java&#45;quote">"my&#45;repository"</span>
libResolver.settings = ivySettings<p class="paragraph"/>resolver libResolver</pre></div><p class="paragraph"/><div class="hidden-block">It's also possible to pull dependencies from a repository using SSH. Ivy comes with a dedicated resolver that you can configure and include in your project like so:</div>
SSHを使用して、リポジトリから依存関係を取得することも可能です。Ivyは、プロジェクト内で設定できる専用のリゾルバを用意しています:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.ivy.plugins.resolver.SshResolver
&#8230;
repositories &#123;
    ...<p class="paragraph"/>    def sshResolver = <span class="java&#45;keyword">new</span> SshResolver(
            name: <span class="java&#45;quote">"myRepo"</span>,
            user: <span class="java&#45;quote">"username"</span>,
            host: <span class="java&#45;quote">"dev.x.com"</span>,
            keyFile: <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/home/username/.ssh/id_rsa"</span>),
            m2compatible: <span class="java&#45;keyword">true</span>)<p class="paragraph"/>    sshResolver.addArtifactPattern(
            <span class="java&#45;quote">"/home/grails/repo/&#91;organisation&#93;/&#91;artifact&#93;/"</span> +
            <span class="java&#45;quote">"&#91;revision&#93;/&#91;artifact&#93;&#45;&#91;revision&#93;.&#91;ext&#93;"</span>)<p class="paragraph"/>    sshResolver.latestStrategy =
            <span class="java&#45;keyword">new</span> org.apache.ivy.plugins.latest.LatestTimeStrategy()<p class="paragraph"/>    sshResolver.changingPattern = <span class="java&#45;quote">".&#42;SNAPSHOT"</span><p class="paragraph"/>    sshResolver.setCheckmodified(<span class="java&#45;keyword">true</span>)<p class="paragraph"/>    resolver sshResolver
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Download the <a href="http://www.jcraft.com/jsch/" target="blank">JSch</a> JAR and add it to Grails' classpath to use the SSH resolver. You can do this by passing the path in the Grails command line:</div>
SSHリゾルバを使用するために、<a href="http://www.jcraft.com/jsch/" target="blank">JSch</a> JARをダウンロードしGrailsのクラスパスに追加します。Grailsのコマンドラインでパスを通すことによってこれを実行出来ます:<p class="paragraph"/><div class="code"><pre>grails &#45;classpath /path/to/jsch compile|run&#45;app|etc.</pre></div><p class="paragraph"/><div class="hidden-block">You can also add its path to the <code>CLASSPATH</code> environment variable but be aware this it affects many Java applications. An alternative on Unix is to create an alias for <code>grails -classpath ...</code> so that you don't have to type the extra arguments each time.</div>
また、<code>CLASSPATH</code>環境変数にパスを通すことでも追加できますが、多くのJavaアプリケーションに影響を与えることに注意する必要があります。Unix上で引数を毎回入力する面倒を避けるには、<code>grails -classpath...</code>コマンドのエイリアスを作成するのが良いでしょう。<p class="paragraph"/><div class="hidden-block">h4. Authentication</div>
<h4>認証</h4><p class="paragraph"/><div class="hidden-block">If your repository requires authentication you can configure this using a <code>credentials</code> block:</div>
リポジトリが認証を必要とする場合は、<code>credentials</code>ブロックを使用してこれを設定することができます:<p class="paragraph"/><div class="code"><pre>credentials &#123;
    realm = <span class="java&#45;quote">".."</span>
    host = <span class="java&#45;quote">"localhost"</span>
    username = <span class="java&#45;quote">"myuser"</span>
    password = <span class="java&#45;quote">"mypass"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This can be placed in your <code>USER_HOME/.grails/settings.groovy</code> file using the <code>grails.project.ivy.authentication</code> setting:</div>
<code>grails.project.ivy.authentication</code>を使用して<code>USER_HOME/.grails/settings.groovy</code>ファイル内に記述することができます:<p class="paragraph"/><div class="code"><pre>grails.project.ivy.authentication = &#123;
    credentials &#123;
        realm = <span class="java&#45;quote">".."</span>
        host = <span class="java&#45;quote">"localhost"</span>
        username = <span class="java&#45;quote">"myuser"</span>
        password = <span class="java&#45;quote">"mypass"</span>
    &#125;
&#125;</pre></div>


<a name="3.7.3 Debugging Resolution"><!-- Legacy link --></a>
<h2 id="debuggingResolution">4.7.3 依存解決デバッグ</h2>
<div class="hidden-block">If you are having trouble getting a dependency to resolve you can enable more verbose debugging from the underlying engine using the <code>log</code> method:</div>
依存関係解決に関して問題を抱えている場合は、<code>log</code>メソッドを使用して内部システムからより詳細なデバッグ情報を得ることができます:<p class="paragraph"/><div class="code"><pre>// log level of the Aether or Ivy resolver, either 'error', 'warn',
// 'info', 'debug' or 'verbose'
log <span class="java&#45;quote">"warn"</span></pre></div><p class="paragraph"/><div class="hidden-block">A common issue is that the checksums for a dependency don't match the associated JAR file, and so Ivy rejects the dependency. This helps ensure that the dependencies are valid. But for a variety of reasons some dependencies simply don't have valid checksums in the repositories, even if they are valid JARs. To get round this, you can disable Ivy's dependency checks like so:</div>
依存関係のチェックサムが関連付けられたJARファイルと一致しない場合、Ivyはその依存関係を拒否しますが、これが問題になることがよくあります。この機能は依存関係の有効性の確認に役立ちます。しかし何らかの原因で、有効なJARファイルであっても、いくつかの依存関係はリポジトリに有効なチェックサムを持っていない場合があります。このような場合でも依存関係を取得するために、次のようにIvyの依存関係チェックを無効にできます:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    &#8230;
    log <span class="java&#45;quote">"warn"</span>
    checksums <span class="java&#45;keyword">false</span>
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is a global setting, so only use it if you have to.</div>
これはグローバル設定なので、必要な時だけ使用してください。


<a name="3.7.4 Inherited Dependencies"><!-- Legacy link --></a>
<h2 id="inheritedDependencies">4.7.4 依存の受け継ぎ</h2>
<div class="hidden-block">By default every Grails application inherits several framework dependencies. This is done through the line:</div>
デフォルトで、すべてのGrailsアプリケーションは、いくつかのフレームワークの依存関係を継承します。これは以下の設定を通じて行われます:<p class="paragraph"/><div class="code"><pre>inherits <span class="java&#45;quote">"global"</span></pre></div><p class="paragraph"/><div class="hidden-block">Inside the <code>BuildConfig.groovy</code> file. To exclude specific inherited dependencies you use the <code>excludes</code> method:</div>
上記は、<code>BuildConfig.groovy</code>ファイル内に記載します。特定の依存関係を除外するには、<code>excludes</code>メソッドを使用します:<p class="paragraph"/><div class="code"><pre>inherits(<span class="java&#45;quote">"global"</span>) &#123;
    excludes <span class="java&#45;quote">"oscache"</span>, <span class="java&#45;quote">"ehcache"</span>
&#125;</pre></div>


<a name="3.7.5 Providing Default Dependencies"><!-- Legacy link --></a>
<h2 id="providingDefaultDependencies">4.7.5 基本依存管理の提供</h2>
<div class="hidden-block">Most Grails applications have runtime dependencies on several jar files that are provided by the Grails framework.  These include libraries like Spring, Sitemesh, Hibernate etc.  When a war file is created, all of these dependencies will be included in it.  But, an application may choose to exclude these jar files from the war.  This is useful when the jar files will be provided by the container, as would normally be the case if multiple Grails applications are deployed to the same container.</div>
ほとんどのGrailsアプリケーションは、Grailsフレームワークによって提供されるいくつかのjarファイルに対し実行時の依存関係を持っています。これらにはSpring、Sitemesh、Hibernateなどのフレームワークが含まれます。WARファイルが作成される際に、これらすべての依存関係がWARファイルに含まれます。しかし、アプリケーションはWARファイルからこれらのjarファイルを除外することもできます。通常よくあるように、複数のGrailsアプリケーションが同じコンテナにデプロイされており、共通のjarファイルをコンテナによって提供するといった場合に便利な機能です。<p class="paragraph"/><div class="hidden-block">The dependency resolution DSL provides a mechanism to express that all of the default dependencies will be provided by the container. This is done by invoking the <code>defaultDependenciesProvided</code> method and passing <code>true</code> as an argument:</div>
依存関係解決DSLクエリー言語は、デフォルトのすべての依存関係がコンテナによって提供されることを表現するためのメカニズムを提供します。これは、<code>defaultDependenciesProvided</code>メソッドに<code>true</code>を引数として渡して呼び出すことで実行されます:<p class="paragraph"/><div class="hidden-block">
<div class="code"><pre>grails.project.dependency.resolution = &#123;<p class="paragraph"/>    defaultDependenciesProvided <span class="java&#45;keyword">true</span> // all of the <span class="java&#45;keyword">default</span> dependencies will
                                     // be <span class="java&#45;quote">"provided"</span> by the container<p class="paragraph"/>    inherits <span class="java&#45;quote">"global"</span> // inherit Grails' <span class="java&#45;keyword">default</span> dependencies<p class="paragraph"/>    repositories &#123;
        grailsHome()
        &#8230;
    &#125;
    dependencies &#123;
        &#8230;
    &#125;
&#125;</pre></div>
</div><p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;<p class="paragraph"/>    defaultDependenciesProvided <span class="java&#45;keyword">true</span> // 全てのデフォルトの依存関係は
                                     // コンテナによって提供される<p class="paragraph"/>    inherits <span class="java&#45;quote">"global"</span> // Grailsのデフォルト依存関係を継承する<p class="paragraph"/>    repositories &#123;
        grailsHome()
        &#8230;
    &#125;
    dependencies &#123;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
<code>defaultDependenciesProvided</code> must come before <code>inherits</code>, otherwise the Grails dependencies will be included in the war.
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
<code>defaultDependenciesProvided</code>は、<code>inherits</code>より前に記述されている必要があり、そうしなければGrailsの依存関係はWARファイルに含まれます。
</blockquote>


<a name="3.7.11 Changing/Snapshot Dependencies"><!-- Legacy link --></a>
<h2 id="changingDependencies">4.7.6 スナップショットと他の変化する依存関係</h2>
<div class="hidden-block">h4. Configuration Changing dependencies</div>
<h4>変化する依存関係の設定</h4><p class="paragraph"/><div class="hidden-block">Typically, dependencies are constant. That is, for a given combination of <code>group</code>, <code>name</code> and <code>version</code> the jar (or plugin) that it refers to will never change. The Grails dependency management system uses this fact to cache dependencies in order to avoid having to download them from the source repository each time. Sometimes this is not desirable. For example, many developers use the convention of a  <em class="italic">snapshot</em>  (i.e. a dependency with a version number ending in “-SNAPSHOT”) that can change from time to time while still retaining the same version number. We call this a "changing dependency".</div>
基本的に、依存関係は不変です。ここでの不変とは、ある特定の<code>グループ</code>、<code>名前</code>、<code>バージョン</code>の組み合わせが参照するjar（もしくはプラグイン）は変化することはない、ということです。これによりGrailsの依存関係管理システムは、ソースリポジトリから毎回ダウンロードすることを回避するために、依存関係をキャッシュできます。時に、この仕様には不都合が生じます。例えば、多くの開発者は慣習的にスナップショット（つまり、バージョン番号が”-SNAPSHOT”で終わる依存関係）を使っています。このスナップショットは同一のバージョン番号を保持しつつ、変更される可能性があります。このことは”変化する依存関係”と呼ばれています。<p class="paragraph"/><div class="hidden-block">Whenever you have a changing dependency, Grails will always check the remote repository for a new version. More specifically, when a changing dependency is encountered during dependency resolution its last modified timestamp in the local cache is compared against the last modified timestamp in the dependency repositories. If the version on the remote server is deemed to be newer than the version in the local cache, the new version will be downloaded and used.</div>
変化する依存関係を持っている場合は必ず、Grailsは新しいバージョンのリモートリポジトリをチェックします。具体的には、依存関係の解決中に変化する依存関係に遭遇した場合、ローカルキャッシュの最終更新日時と依存関係のリポジトリの最終更新日時と比較します。リモートサーバ上のバージョンがローカルキャッシュ内のバージョンよりも新しい場合は、新しいバージョンがダウンロードされ使用されます。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
Be sure to read the next section on “Dependency Resolution Caching” in addition to this one as it affects changing dependencies.
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
変化する依存関係に作用する、依存関係解決キャッシングについて、次のセクションを必ずお読みください。
</blockquote><p class="paragraph"/><div class="hidden-block">All dependencies (jars and plugins) with a version number ending in <code>-SNAPSHOT</code> are <strong class="bold">implicitly</strong> considered to be changing by Grails. You can also explicitly specify that a dependency is changing by setting the changing flag in the dependency DSL (This is only required for Ivy, Aether does not support the 'changing' flag and treats dependencies that end with -SNAPSHOT as changing):</div>
Grailsは<code>暗黙的に</code>バージョン番号が<code>-SNAPSHOT</code>で終わるすべての依存関係（jarファイルもしくはプラグイン）を、変化する依存関係として扱います。また、明示的に依存DSLクエリー言語に変更フラグを設定することでも、変化する依存関係として扱う事ができます。（このDSLクエリー言語はIvyにのみ必要です。Aetherは'changing'フラグをサポートしておらず、-SNAPSHOTで終わる場合は変化する依存関係として扱います）<p class="paragraph"/><div class="code"><pre>runtime ('org.my:lib:1.2.3') &#123;
    changing = <span class="java&#45;keyword">true</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Aether and SNAPSHOT dependencies</h4>
</div>
<h4>AetherとSNAPSHOTの依存関係</h4><p class="paragraph"/><div class="hidden-block">
The semantics for handling snapshots when using Aether in Grails are the same as those when using the Maven build tool. The default snapshot check policy is to check once a day for a new version of the dependency. This means that if a new snapshot is published during the day to a remote repository you may not see that change unless you manually clear out your local snapshot.
</div>
Grails内でAetherを使用した場合、スナップショットを処理するためのセマンティクスは、Mavenを使用した場合と同じです。
デフォルトのスナップショットのチェックポリシーでは、1日に1回、依存関係の新しいバージョンをチェックします。
これはその日リモートリポジトリに公開された新たなスナップショットが、手動でロカールリポジトリのスナップショットをクリアしない限り、変更を検知できない場合があるということです。<p class="paragraph"/><div class="hidden-block">
If you wish to change the snapshot update policy you can do so by configuring an <code>updatePolicy</code> for the repository where the snapshot was resolved from, for example:
</div>
もし、スナップショットのアップデートポリシーを変更したい場合は、スナップショットの依存を解決するリポジトリで<code>updatePolicy</code>を設定します。
例えば以下のようにします:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    mavenCentral &#123;
        updatePolicy <span class="java&#45;quote">"interval:1"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The above example configures an update policy that checks once a minute for changes. Note that that an <code>updatePolicy</code> like the above will seriously impact performance of dependency resolution. The possibly configuration values for <code>updatePolicy</code> are as follows:
</div>
上記の例では、1分に1回チェックをするアップデートポリシーを設定しています。
上記の<code>updatePolicy</code>のように、この設定は依存関係解決のパフォーマンスに影響を与えることに注意してください。
<code>updatePolicy</code>に設定が可能な値は以下のとおりです:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>never</code> - Never check for new snapshots</li>
<li><code>always</code> - Always check for new snapshots</li>
<li><code>daily</code> - Check once a day for new snapshots (the default)</li>
<li><code>interval:x</code> - Check once every x minutes for new snapshots</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>never</code> - 新しいスナップショットをチェックしない</li>
<li><code>always</code> - 常に新しいスナップショットをチェックする</li>
<li><code>daily</code> - 1日に1回新しいスナップショットをチェックする (デフォルト)</li>
<li><code>interval:x</code> - x分ごとに1回新しいスナップショットをチェックする</li>
</ul><p class="paragraph"/><div class="hidden-block">h4. Ivy and Changing dependencies</div>
<h4>Ivyと変化する依存関係</h4><p class="paragraph"/><div class="hidden-block">For those used to Maven snapshot handling, if you use Aether dependency management you can expect the same semantics as Maven. If you choose to use Ivy there is a caveat to the support for changing dependencies that you should be aware of. Ivy will stop looking for newer versions of a dependency once it finds a remote repository that has the dependency.</div>
Mavenのスナップショットの処理に使用されているものについては、Aetherの依存関係管理を使用する場合は、Mavenと同じセマンティクスを期待できます。Ivyを選択した場合は、変化する依存関係のサポートに対する注意があります。Ivyは依存関係を持つリモートリポジトリが見つかった時点で、新しいバージョンの依存関係の検索を終了します。<p class="paragraph"/><div class="hidden-block">Consider the following setup:</div>
以下の設定を考えてみましょう:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    repositories &#123;
        mavenLocal()
        mavenRepo <span class="java&#45;quote">"http://my.org/repo"</span>
    &#125;
    dependencies &#123;
        compile <span class="java&#45;quote">"myorg:mylib:1.0&#45;SNAPSHOT"</span>
    &#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example we are using the local maven repository and a remote network maven repository. Assuming that the local OI dependency and the local Maven cache do not contain the dependency but the remote repository does, when we perform dependency resolution the following actions will occur:</div>
この例では、MavenのローカルリポジトリとMavenのリモートネットワークリポジトリを使用しています。ローカルにあるGrailsの依存関係とMavenのキャッシュには該当する依存関係が含まれていませんが、リモートリポジトリには含まれているとします。この状況で依存関係を解決する場合は、次のように動作します。<p class="paragraph"/><div class="hidden-block">* maven local repository is searched, dependency not found</div>
<ul class="star">
<li>Mavenのローカルリポジトリが検索されますが、依存関係は見つかりません。</li>
</ul><p class="paragraph"/><div class="hidden-block">* maven network repository is searched, dependency is downloaded to the cache and used</div>
<ul class="star">
<li>Mavenのネットワークリポジトリが検索され、依存関係をキャッシュへダウンロードして使用します。</li>
</ul><p class="paragraph"/><div class="hidden-block">Note that the repositories are checked in the order they are defined in the <code>BuildConfig.groovy</code> file. </div>
リポジトリは<code>BuildConfig.groovy</code>のファイルに定義されている順にチェックされることに注意してください。<p class="paragraph"/><div class="hidden-block">If we perform dependency resolution again without the dependency changing on the remote server, the following will happen:</div>
リモートサーバー上の依存関係が変化していない状況で、再び依存関係解決を行う場合、次の処理が実行されます。<p class="paragraph"/><div class="hidden-block">* maven local repository is searched, dependency not found</div>
<ul class="star">
<li>Mavenのローカルリポジトリが検索されますが、依存関係は見つかりません。</li>
</ul><p class="paragraph"/><div class="hidden-block">* maven network repository is searched, dependency is found to be the same “age” as the version in the cache so will not be updated (i.e. downloaded)</div>
<ul class="star">
<li>Mavenのネットワークリポジトリが検索され依存関係が見つかりますが、キャッシュ内のバージョンと同じ最終更新日時のため更新（すなわちダウンロード）はされません。</li>
</ul><p class="paragraph"/><div class="hidden-block">Later on, a new version of <code>mylib 1.0-SNAPSHOT</code> is published changing the version on the server. The next time we perform dependency resolution, the following will happen:</div>
その後、<code>mylib 1.0-SNAPSHOT</code>の新しいバージョンが公開され、サーバ上のファイルが更新されたとします。この状況で依存関係の解決を実行した場合、以下の処理が行われます。<p class="paragraph"/><div class="hidden-block">* maven local repository is searched, dependency not found</div>
<ul class="star">
<li>Mavenのローカルリポジトリが検索されますが、依存関係は見つかりません。</li>
</ul><p class="paragraph"/><div class="hidden-block">* maven network repository is searched, dependency is found to newer than version in the cache so will be updated (i.e. downloaded to the cache)</div>
<ul class="star">
<li>Mavenのネットワークリポジトリが検索され、キャッシュ内のバージョンよりも新しい依存関係が見つかり、更新（つまり、キャッシュにダウンロード）されます。</li>
</ul><p class="paragraph"/><div class="hidden-block">So far everything is working well.</div>
ここまで、すべてが正常に機能しています。<p class="paragraph"/><div class="hidden-block">Now we want to test some local changes to the <code>mylib</code> library. To do this we build it locally and install it to the local Maven cache (how doesn't particularly matter). The next time we perform a dependency resolution, the following will occur:</div>
ここで、<code>mylib</code>ライブラリのローカル上での変更をテストしたい場合を考えてみます。これを行うには、ライブラリをローカル上でビルドし、Mavenのローカルキャッシュにインストールします（方法は特に重要ではありません）。この状況で、依存関係の解決を実行した場合、以下のようになります。<p class="paragraph"/><div class="hidden-block">* maven local repository is searched, dependency is found to newer than version in the cache so will be updated (i.e. downloaded to the cache)</div>
Mavenのローカルリポジトリが検索され、キャッシュ内のバージョンよりも新しい依存関係が見つかるため、更新（つまり、キャッシュにダウンロード）されます。
<div class="hidden-block">* maven network repository is NOT searched as we've already found the dependency</div>
すでに依存関係を発見したため、Mavenのネットワークリポジトリは検索されません。<p class="paragraph"/><div class="hidden-block">This is what we wanted to occur. </div>
これは、期待通りの結果です。<p class="paragraph"/><div class="hidden-block">Later on, a new version of <code>mylib 1.0-SNAPSHOT</code> is published changing the version on the server. The next time we perform dependency resolution, the following will happen:</div>
その後、<code>mylib 1.0-SNAPSHOT</code>の新しいバージョンが公開され、サーバ上のファイルが更新されたとします。この状況で依存関係の解決を実行した場合、以下の処理が行われます。<p class="paragraph"/><div class="hidden-block">* maven local repository is searched, dependency is found to be the same “age” as the version in the cache so will not be updated (i.e. downloaded)</div>
<ul class="star">
<li>Mavenのローカルリポジトリが検索され、キャッシュ内バージョンと同じ”年齢”の依存関係が見つかりますが、更新（すなわちダウンロード）はされません。</li>
</ul><p class="paragraph"/><div class="hidden-block">* maven network repository is NOT searched as we've already found the dependency</div>
<ul class="star">
<li>すでに依存関係を発見したため、Mavenのネットワークリポジトリは検索されません。</li>
</ul><p class="paragraph"/><div class="hidden-block">This is likely to not be the desired outcome. We are now out of sync with the latest published snapshot and will continue to keep using the version from the local maven repository.</div>
これは望ましい結果ではない可能性があります。最新の公開された（ネットワークリポジトリの）スナップショットと同期をとらず、Mavenのローカルリポジトリのバージョンを使用し続けます。<p class="paragraph"/><div class="hidden-block">The rule to remember is this: when resolving a dependency, Ivy will stop searching as soon as it finds a repository that has the dependency at the specified version number. It will <strong class="bold">not</strong> continue searching all repositories trying to find a more recently modified instance.</div>
覚えておくべきルール:依存関係を解決するときに、Grailsはできるだけ早く、バージョン番号の指定された依存関係を持つリポジトリを見つけ、検索を終了します。より最新のインスタンスを検索するためにすべてのリポジトリを検索し続けることは<code>しません</code>。<p class="paragraph"/><div class="hidden-block">To remedy this situation (i.e. build against the  <em class="italic">newer</em>  version of <code>mylib 1.0-SNAPSHOT</code> in the remote repository), you can either:</div>
この状況を改善するために（すなわちリモートリポジトリ内の、より新しいバージョンの<code>mylib 1.0-SNAPSHOT</code>をビルドするために）、次のいずれかを実行できます。<p class="paragraph"/><div class="hidden-block">* Delete the version from the local maven repository, or</div>
<ul class="star">
<li>Mavenのローカルリポジトリからバージョンを削除する</li>
</ul><p class="paragraph"/><div class="hidden-block">* Reorder the repositories in the <code>BuildConfig.groovy</code> file</div>
<ul class="star">
<li><code>BuildConfig.groovy</code>ファイル内のリポジトリの順序を変更する</li>
</ul><p class="paragraph"/><div class="hidden-block">Where possible, prefer deleting the version from the local maven repository. In general, when you have finished building against a locally built SNAPSHOT always try to clear it from the local maven repository.</div>
可能であれば、Mavenのローカルリポジトリからバージョンを削除することが望ましいでしょう。通常は、ローカルスナップショットのビルドが終了したら、常にMavenのローカルリポジトリからクリアしましょう。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
This changing dependency behaviour is an unmodifiable characteristic of the underlying dependency management system Apache Ivy. It is currently not possible to have Ivy search all repositories to look for newer versions (in terms of modification date) of the same dependency (i.e. the same combination of <code>group</code>, <code>name</code> and <code>version</code>). If you want this behavior consider switching to Aether as the dependency manager.
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
この変化する依存関係の挙動は、Grailsの依存関係管理システムの基礎となっているApache Ivyの変更不可能な特性です。現在のところIvyは、すべてのリポジトリを検索し、同じ依存関係（すなわち等しい<code>グループ</code>、<code>名前</code>、<code>バージョン</code>の組み合わせ）の中から（修正日付の面で）より新しいバージョンのものを探すことはできません。
</blockquote>


<a name="3.7.6 Dependency Reports"><!-- Legacy link --></a>
<h2 id="dependencyReports">4.7.7 依存管理レポート</h2>
<div class="hidden-block">As mentioned in the previous section a Grails application consists of dependencies inherited from the framework, the plugins installed and the application dependencies itself.</div>
以前の節で述べたように、Grailsアプリケーションの依存関係は、フレームワークから継承した依存関係、インストールしたプラグインの依存関係、またアプリケーション自身で設定した依存関係で構成されます。<p class="paragraph"/><div class="hidden-block">To obtain a report of an application's dependencies you can run the <a href="../ref/Command Line/dependency-report.html" class="commandLine">dependency-report</a> command:</div>
アプリケーションの依存関係のレポートを取得するには、<a href="../ref/Command Line/dependency-report.html" class="commandLine">dependency-report</a>コマンドを実行します:<p class="paragraph"/><div class="code"><pre>grails dependency&#45;report</pre></div><p class="paragraph"/><div class="hidden-block">By default this will generate reports in the <code>target/dependency-report</code> directory. You can specify which configuration (scope) you want a report for by passing an argument containing the configuration name:</div>
デフォルトでは、<code>target/dependency-report</code>ディレクトリにレポートが生成されます。設定名を引数に渡すことで、レポートを作成したい設定（スコープ）を指定することもできます:<p class="paragraph"/><div class="code"><pre>grails dependency&#45;report runtime</pre></div><p class="paragraph"/><div class="hidden-block">As of Grails 2.3 the <code>dependency-report</code> command will also output to the console a graph of the dependencies of an application. Example output it shown below:</div>
Grails2.3では、<code>dependency-report</code>コマンドはアプリケーションの依存関係のグラフをコンソールへ出力します。出力例を以下に示します:<p class="paragraph"/><div class="code"><pre>compile &#45; Dependencies placed on the classpath <span class="java&#45;keyword">for</span> compilation (total: 73)
+&#45;&#45;&#45; org.codehaus.groovy:groovy&#45;all:2.0.6
+&#45;&#45;&#45; org.grails:grails&#45;plugin&#45;codecs:2.3.0
|    &#45;&#45;&#45; org.grails:grails&#45;web:2.3.0
|         &#45;&#45;&#45; commons&#45;fileupload:commons&#45;fileupload:1.2.2
|         &#45;&#45;&#45; xpp3:xpp3_min:1.1.4c
|         &#45;&#45;&#45; commons&#45;el:commons&#45;el:1.0
|         &#45;&#45;&#45; opensymphony:sitemesh:2.4
|         &#45;&#45;&#45; org.springframework:spring&#45;webmvc:3.1.2.RELEASE
|    &#45;&#45;&#45; commons&#45;codec:commons&#45;codec:1.5
|    &#45;&#45;&#45; org.slf4j:slf4j&#45;api:1.7.2
+&#45;&#45;&#45; org.grails:grails&#45;plugin&#45;controllers:2.3.0
|    &#45;&#45;&#45; commons&#45;beanutils:commons&#45;beanutils:1.8.3
|    &#45;&#45;&#45; org.grails:grails&#45;core:2.3.0
...</pre></div>


<a name="3.7.7 Plugin JAR Dependencies"><!-- Legacy link --></a>
<h2 id="pluginJARDependencies">4.7.8 プラグインJAR依存</h2>
<div class="hidden-block">h4. Specifying Plugin JAR dependencies</div>
<h4>プラグインJARの依存関係を指定する</h4><p class="paragraph"/><div class="hidden-block">The way in which you specify dependencies for a <a href="../guide/single.html#plugins" class="guide">plugin</a> is identical to how you specify dependencies in an application. When a plugin is installed into an application the application automatically inherits the dependencies of the plugin.</div>
<a href="../guide/single.html#plugins" class="guide">plugin</a>の依存関係を指定する方法は、アプリケーションの依存関係を指定する方法と同じです。プラグインがアプリケーションにインストールされている場合、アプリケーションは自動的にプラグインの依存関係を継承します。<p class="paragraph"/><div class="hidden-block">To define a dependency that is resolved for use with the plugin but not  <em class="italic">exported</em>  to the application then you can set the <code>export</code> property of the dependency:</div>
プラグインには必要で、アプリケーションには<code>エクスポートしたくない</code>依存関係を定義するには、<code>export</code>プロパティを使用します:
<div class="code"><pre>compile('org.spockframework:spock&#45;core:0.5&#45;groovy&#45;1.8') &#123;
    export = <span class="java&#45;keyword">false</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the Spock dependency will be available only to the plugin and not resolved as an application dependency. Alternatively, if you're using the Map syntax:</div>
このケースではSpockの依存関係はプラグインのみが利用できるようになり、アプリケーションの依存関係としては解決されません。また、Mapを使用している場合は以下のようになります:<p class="paragraph"/><div class="code"><pre>compile group: 'org.spockframework', name: 'spock&#45;core',
     version: '0.5&#45;groovy&#45;1.8', export: <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
You can use <code>exported = false</code> instead of <code>export = false</code>, but we recommend the latter because it's consistent with the Map argument.
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
<code>export=false</code>の代わりに<code>exported=false</code>を使用することができますが、Mapの引数と一致しているため前者を推奨します。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Overriding Plugin JAR Dependencies in Your Application</div>
<h4>独自アプリケーションでプラグインのJAR依存関係をオーバーライドする</h4><p class="paragraph"/><div class="hidden-block">If a plugin is using a JAR which conflicts with another plugin, or an application dependency then you can override how a plugin resolves its dependencies inside an application using exclusions. For example:</div>
プラグインが、他のプラグインまたはアプリケーションの依存関係と競合するJarを利用している場合、除外設定を使用することでプラグイン内部で使用している依存関係を上書きできます。例を以下に示します:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    compile(<span class="java&#45;quote">"&#58;hibernate&#58;&#36;grailsVersion"</span>) &#123;
        excludes <span class="java&#45;quote">"javassist"</span>
    &#125;
&#125;<p class="paragraph"/>dependencies &#123;
    runtime <span class="java&#45;quote">"javassist:javassist:3.4.GA"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the application explicitly declares a dependency on the "hibernate" plugin and specifies an exclusion using the <code>excludes</code> method, effectively excluding the javassist library as a dependency.</div>
上記の場合、アプリケーションで明示的に"hibernate"プラグインの依存関係を宣言し、<code>excludes</code>メソッドを使用して除外する依存関係を指定することで、Javassistライブラリを依存関係から除外します。


<a name="3.7.8 Maven Integration"><!-- Legacy link --></a>
<h2 id="mavenIntegration">4.7.9 Maven統合</h2>
<div class="hidden-block">When using the Grails Maven plugin with the Maven build tool, Grails' dependency resolution mechanics are disabled as it is assumed that you will manage dependencies with Maven's <code>pom.xml</code> file.</div>
Grails Maven pluginでMavenビルドツールを使用している場合は、Mavanの<code>pom.xml</code>ファイルで依存関係の解決が行なわれると判断し、Grailsでの依存関係解決機能は無効化されます<p class="paragraph"/><div class="hidden-block">However, if you would like to continue using Grails regular commands like <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>, <a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a> and so on then you can tell Grails' command line to load dependencies from the Maven <code>pom.xml</code> file instead.</div>
しかし、<a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>や<a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a>等のGrails標準コマンドを使用し続けたい場合は、代わりにGrailsのコマンドラインにMavenの<code>pom.xml</code>ファイルから依存関係をロードするように教えることができます<p class="paragraph"/><div class="hidden-block">To do so simply add the following line to your <code>BuildConfig.groovy</code>:</div>
これは、<code>BuildConfig.groovy</code>に以下の行を追加するだけで簡単にできます:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    pom <span class="java&#45;keyword">true</span>
    ..
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The line <code>pom true</code> tells Grails to parse Maven's <code>pom.xml</code> and load dependencies from there.</div>
<code>pom true</code>行は、Mavenの<code>pom.xml</code>ファイルの構文解析を行いそこから依存関係をロードする、ということをGrailsに通達します。


<a name="3.7.9 Deploying to a Maven Repository"><!-- Legacy link --></a>
<h2 id="mavendeploy">4.7.10 Mavenリポジトリへのデプロイ</h2>
<div class="hidden-block">If you use Maven to build your Grails project, you can use the standard Maven targets <code>mvn install</code> and <code>mvn deploy</code>.</div>
GrailsプロジェクトのビルドにMavenを使用する場合は、標準のMavenのターゲットである<code>mvn install</code>および<code>mvn deploy</code>を使用できます。
<div class="hidden-block">If not, you can deploy a Grails project or plugin to a Maven repository using the <a href="http://grails.org/plugin/release" target="blank">release</a> plugin.</div>
そうでない場合は、<a href="http://grails.org/plugin/release" target="blank">release</a>プラグインを使用してMavenのリポジトリにGrailsプロジェクトやプラグインをデプロイすることができます。<p class="paragraph"/><div class="hidden-block">The plugin provides the ability to publish Grails projects and plugins to local and remote Maven repositories. There are two key additional targets added by the plugin:</div>
プラグインは、MavenのローカルリポジトリおよびリモートリポジトリにGrailsプロジェクトやプラグインを公開する機能を提供します。プラグインによって追加された2つの重要なターゲットがあります。<p class="paragraph"/><div class="hidden-block"><strong class="bold"> </strong>maven-install* - Installs a Grails project or plugin into your local Maven cache</div>
<ul class="star">
<li><strong class="bold">maven-install</strong> - MavenのローカルキャッシュにGrailsプロジェクトやプラグインをインストールします。</li>
</ul><p class="paragraph"/><div class="hidden-block"><strong class="bold"> </strong>maven-deploy* - Deploys a Grails project or plugin to a remote Maven repository</div>
<ul class="star">
<li><strong class="bold">maven-deploy</strong> - MavenのリモートリポジトリにGrailsプロジェクトやプラグインをデプロイします。</li>
</ul><p class="paragraph"/><div class="hidden-block">By default this plugin will automatically generate a valid <code>pom.xml</code> for you unless a <code>pom.xml</code> is already present in the root of the project, in which case this <code>pom.xml</code> file will be used.</div>
デフォルトでは、このプラグインは自動的に有効な<code>pom.xml</code>を生成します。ただし、<code>pom.xml</code>がすでにプロジェクトルートに存在する場合には、プロジェクトルート上の<code>pom.xml</code>ファイルが使用されます。<p class="paragraph"/><div class="hidden-block">h4. maven-install</div>
<h4>maven-installコマンド</h4><p class="paragraph"/><div class="hidden-block">The <code>maven-install</code> command will install the Grails project or plugin artifact into your local Maven cache:</div>
<code>maven-install</code>コマンドは、MavenのローカルキャッシュにGrailsプロジェクトやプラグインをインストールします:<p class="paragraph"/><div class="code"><pre>grails maven&#45;install</pre></div><p class="paragraph"/><div class="hidden-block">In the case of plugins, the plugin zip file will be installed, whilst for application the application WAR file will be installed.</div>
プラグインの場合はプラグインのzipファイルが、アプリケーションのアプリケーションのWARファイルがインストールされます。<p class="paragraph"/><div class="hidden-block">h4. maven-deploy</div>
<h4>maven-deployコマンド</h4><p class="paragraph"/><div class="hidden-block">The <code>maven-deploy</code> command will deploy a Grails project or plugin into a remote Maven repository:</div>
<code>maven-deploy</code>コマンドは、MavenのリモートリポジトリにGrailsプロジェクトやプラグインをデプロイします:<p class="paragraph"/><div class="code"><pre>grails maven&#45;deploy</pre></div><p class="paragraph"/><div class="hidden-block">It is assumed that you have specified the necessary <code>&#60;distributionManagement&#62;</code> configuration within a <code>pom.xml</code> or that you specify the <code>id</code> of the remote repository to deploy to:</div>
<code>pom.xml</code>ファイル内に必要な<code>&#60;distributionManagement&#62;</code>の設定がされているか、もしくはデプロイするリモートリポジトリの<code>id</code>を指定すること前提としています:<p class="paragraph"/><div class="code"><pre>grails maven&#45;deploy &#45;&#45;repository=myRepo</pre></div><p class="paragraph"/><div class="hidden-block">The <code>repository</code> argument specifies the 'id' for the repository. Configure the details of the repository specified by this 'id' within your <code>grails-app/conf/BuildConfig.groovy</code> file or in your <code>$USER_HOME/.grails/settings.groovy</code> file:</div>
<code>repository</code>引数は、リポジトリの'id'を指定します。この指定した'id'に対するリポジトリの詳細を、<code>grails-app/conf/BuildConfig.groovy</code>ファイルもしくは<code>$USER_HOME/.grails/settings.groovy</code>ファイル内で設定します:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.distribution = &#123;
    localRepository = <span class="java&#45;quote">"/path/to/my/local"</span>
    remoteRepository(id: <span class="java&#45;quote">"myRepo"</span>, url: <span class="java&#45;quote">"http://myserver/path/to/repo"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The syntax for configuring remote repositories matches the syntax from the <a href="http://maven.apache.org/ant-tasks/reference.html#remoteRepository" target="blank">remoteRepository</a> element in the Ant Maven tasks. For example the following XML:</div>
リモートリポジトリを設定するための構文は、MavenのAntタスク内の<a href="http://maven.apache.org/ant-tasks/reference.html#remoteRepository" target="blank">remoteRepository</a>要素の構文と一致します。例えば次のXMLです:<p class="paragraph"/><div class="code"><pre>&#60;remoteRepository id=<span class="java&#45;quote">"myRepo"</span> url=<span class="java&#45;quote">"scp://localhost/www/repository"</span>&#62;
    &#60;authentication username=<span class="java&#45;quote">"..."</span> privateKey=<span class="java&#45;quote">"&#36;&#123;user.home&#125;/.ssh/id_dsa"</span>/&#62;
&#60;/remoteRepository&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Can be expressed as:</div>
以下の様に表すこともできます:<p class="paragraph"/><div class="code"><pre>remoteRepository(id: <span class="java&#45;quote">"myRepo"</span>, url: <span class="java&#45;quote">"scp://localhost/www/repository"</span>) &#123;
    authentication username: <span class="java&#45;quote">"..."</span>, privateKey: <span class="java&#45;quote">"&#36;&#123;userHome&#125;/.ssh/id_dsa"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">By default the plugin will try to detect the protocol to use from the URL of the repository (ie "http" from "http://.." etc.), however to specify a different protocol you can do:</div>
デフォルトではmaven-publisherプラグインはリポジトリのURLから、使用するプロトコルを検出しようとします（例えば、URLが"http://.."の場合は"http"、等）が、以下のように別のプロトコルを指定することもできます:<p class="paragraph"/><div class="code"><pre>grails maven&#45;deploy &#45;&#45;repository=myRepo &#45;&#45;protocol=webdav</pre></div><p class="paragraph"/><div class="hidden-block">The available protocols are:</div>
利用可能なプロトコルは以下のとおりです:
<ul class="star">
<li>http</li>
<li>scp</li>
<li>scpexe</li>
<li>ftp</li>
<li>webdav</li>
</ul><p class="paragraph"/><div class="hidden-block">h4. Groups, Artifacts and Versions</div>
<h4>グループ、アーティファクト、バージョン</h4><p class="paragraph"/><div class="hidden-block">Maven defines the notion of a 'groupId', 'artifactId' and a 'version'. This plugin pulls this information from the Grails project conventions or plugin descriptor.</div>
Mavenは 'groupId'、'artifactId'、'version'という概念を定義しています。maven-publisherプラグインは、Grailsプロジェクトの規約またはプラグイン識別子からこれらの情報を取得します。<p class="paragraph"/><div class="hidden-block">h5. Projects</div>
<h5>プロジェクト</h5><p class="paragraph"/><div class="hidden-block">For applications this plugin will use the Grails application name and version provided by Grails when generating the <code>pom.xml</code> file. To change the version you can run the <code>set-version</code> command:</div>
アプリケーションでは、このプラグインは<code>pom.xml</code>ファイル生成時にGrailによって提供されるGrailsアプリケーションの名前とバージョンを使用します。バージョンを変更するには、<code>set-version</code>コマンドを実行します:<p class="paragraph"/><div class="code"><pre>grails set&#45;version 0.2</pre></div><p class="paragraph"/><div class="hidden-block">The Maven <code>groupId</code> will be the same as the project name, unless you specify a different one in Config.groovy:</div>
Mavenの<code>groupId</code>は、Config.groovyに別の名前を指定しない限り、プロジェクト名と同じになります:<p class="paragraph"/><div class="code"><pre>grails.project.groupId=<span class="java&#45;quote">"com.mycompany"</span></pre></div><p class="paragraph"/><div class="hidden-block">h5. Plugins</div>
<h5>プラグイン</h5><p class="paragraph"/><div class="hidden-block">With a Grails plugin the <code>groupId</code> and <code>version</code> are taken from the following properties in the <code>GrailsPlugin.groovy</code> descriptor:</div>
Grailsプラグインの<code>groupId</code>と<code>version</code>は、<code>GrailsPlugin.groovy</code>内の以下のプロパティから取得されます:<p class="paragraph"/>
<div class="code"><pre><span class="java&#45;object">String</span> groupId = 'myOrg'
<span class="java&#45;object">String</span> version = '0.1'</pre></div><p class="paragraph"/><div class="hidden-block">The 'artifactId' is taken from the plugin name. For example if you have a plugin called <code>FeedsGrailsPlugin</code> the <code>artifactId</code> will be "feeds". If your plugin does not specify a <code>groupId</code> then this defaults to "org.grails.plugins".</div>
'artifactId'は、プラグイン名から取得されます。たとえば、<code>FeedsGrailsPlugin</code>というプラグインの場合、<code>artifactId</code>は "feeds"になります。プラグインが<code>groupId</code>を指定していない場合、デフォルト設定の"org.grails.plugins"となります。


<a name="3.7.10 Plugin Dependencies"><!-- Legacy link --></a>
<h2 id="pluginDependencies">4.7.11 プラグイン依存管理</h2>
<div class="hidden-block">You can declaratively specify plugins as dependencies via the dependency DSL instead of using the <a href="../ref/Command Line/install-plugin.html" class="commandLine">install-plugin</a> command:</div>
<a href="../ref/Command Line/install-plugin.html" class="commandLine">install-plugin</a>コマンドを使用する代わりに依存関係DSLクエリー言語を用いることで依存するプラグインを指定できます:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    &#8230;
    repositories &#123;
        &#8230;
    &#125;<p class="paragraph"/>    plugins &#123;
        runtime ':hibernate:1.2.1'
    &#125;<p class="paragraph"/>    dependencies &#123;
        &#8230;
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you don't specify a group id the default plugin group id of <code>org.grails.plugins</code> is used. </div>
グループIDを指定しない場合、デフォルトのプラグインのグループIDである<code>org.grails.plugins</code>が使用されます。<p class="paragraph"/><div class="hidden-block">h4. Latest Integration</div>
<h4>Latest Integrationラベル</h4><p class="paragraph"/><div class="hidden-block">
<blockquote class="warning">
Only the Ivy dependency manager supports the "latest.integration" version. For Aether you can achieve a similar effect with version ranges.
</blockquote>
</div><p class="paragraph"/><blockquote class="warning">
Ivy依存関係マネージャは"latest.integration"バージョンをサポートしています。Aetherの場合は、バージョンの範囲指定で同様の効果を得ることができます。
</blockquote><p class="paragraph"/><div class="hidden-block">You can specify to use the latest version of a particular plugin by using "latest.integration" as the version number:</div>
バージョン番号として "latest.integration"を使用することで、特定のプラグインの最新バージョンを使用するように指定できます:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    runtime ':hibernate:latest.integration'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Integration vs. Release</div>
<h4>Integrationラベル vs. Releaseラベル</h4><p class="paragraph"/><div class="hidden-block">The "latest.integration" version label will also include resolving snapshot versions. To not include snapshot versions then use the "latest.release" label:</div>
"latest.integration"ラベルはスナップショットのバージョンも含まれます。スナップショットのバージョンが含まれないようにするには、 "latest.release"ラベルを使用します。<p class="paragraph"/><div class="code"><pre>plugins &#123;
    runtime ':hibernate:latest.release'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The "latest.release" label only works with Maven compatible repositories. If you have a regular SVN-based Grails repository then you should use "latest.integration".
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
"latest.release"ラベルはMavenの互換リポジトリでのみ動作します。通常のSVNベースのGrailsリポジトリの場合は、"latest.integration"を使用する必要があります。
</blockquote><p class="paragraph"/><div class="hidden-block">And of course if you use a Maven repository with an alternative group id you can specify a group id:</div>
もちろん、別のグループIDでMavenのリポジトリを使用する場合は、グループIDを指定することができます:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    runtime 'mycompany:hibernate:latest.integration'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Plugin Exclusions</div>
<h4>プラグインの除外</h4><p class="paragraph"/><div class="hidden-block">You can control how plugins transitively resolves both plugin and JAR dependencies using exclusions. For example:</div>
excludesメソッドを使用して、プラグインおよびJARの依存関係を推移的に解決する方法を制御できます。以下に例を示します:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    runtime(':weceem:0.8') &#123;
        excludes <span class="java&#45;quote">"searchable"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we have defined a dependency on the "weceem" plugin which transitively depends on the "searchable" plugin. By using the <code>excludes</code> method you can tell Grails  <em class="italic">not</em>  to transitively install the searchable plugin. You can combine this technique to specify an alternative version of a plugin:</div>
ここでは、推移的に"searchable"プラグインに依存する"weceem"プラグインへの依存関係を定義しました。<code>excludes</code>メソッドを使用することで、Grailsにsearchableプラグインを推移的にインストール_しない_ことを教えることができます。あわせて、プラグインの代替バージョンを指定することもできます:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    runtime(':weceem:0.8') &#123;
        excludes <span class="java&#45;quote">"searchable"</span> // excludes most recent version
    &#125;
    runtime ':searchable:0.5.4' // specifies a fixed searchable version
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also completely disable transitive plugin installs, in which case no transitive dependencies will be resolved:</div>
推移的なプラグインのインストールを完全に無効にすることもでき、その場合、いかなる推移的な依存関係も解決されません:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    runtime(':weceem:0.8') &#123;
        transitive = <span class="java&#45;keyword">false</span>
    &#125;
    runtime ':searchable:0.5.4' // specifies a fixed searchable version
&#125;</pre></div>


<a name="3.7.12 Dependency Resolution Caching"><!-- Legacy link --></a>
<h2 id="dependencyResolutionCaching">4.7.12 依存管理のキャッシュ</h2>
<div class="hidden-block">As a performance optimisation, when using Ivy (this does not apply to Aether), Grails does not resolve dependencies for every command invocation. Even with all the necessary dependencies downloaded and cached, resolution may take a second or two. To minimise this cost, Grails caches the result of dependency resolution (i.e. the location on the local file system of all of the declared dependencies, typically inside the dependency cache) and reuses this result for subsequent commands when it can reasonably expect that nothing has changed.</div>
Ivyを使用している場合（Aetherには適用されません）、パフォーマンスの最適化のために、Grailsはコマンド呼び出しで依存関係解決をしない場合があります。必要なすべての依存関係がダウンロードされ、キャッシュされている場合でも、依存関係解決は1秒から2秒かかることがあります。このコストを最小限に抑えるために、Grailsは依存関係解決の結果をキャッシュし（すなわち、宣言された依存関係のすべてのローカルファイルシステム上の場所、通常は依存キャッシュ内）、後続のコマンドについては、依存関係に変更がないことがある程度期待できる場合は、このキャッシュを再利用します。<p class="paragraph"/><div class="hidden-block">Grails only performs dependency resolution under the following circumstances:</div>
Grailsは、以下の場合にのみ依存関係解決を実行します:<p class="paragraph"/><div class="hidden-block">* The project is clean (i.e. fresh checkout or after <code>grails clean</code>)</div>
<ul class="star">
<li>プロジェクトがクリーンな場合（すなわち、チェックアウト直後または<code>grails clean</code>の実行後）</li>
</ul><p class="paragraph"/><div class="hidden-block">* The <code>BuildConfig.groovy</code> file has changed since the last command was run</div>
<ul class="star">
<li>最後にコマンドが実行された後に、<code>BuildConfig.groovy</code>ファイルが変更された場合</li>
</ul><p class="paragraph"/><div class="hidden-block">* The <code>&#45;&#45;refresh-dependencies</code> command line switch is provided to the command (any command)</div>
<ul class="star">
<li><code>&#45;&#45;refresh-dependencies</code>引数が、何らかのコマンドに与えられる場合</li>
</ul><p class="paragraph"/><div class="hidden-block">* The <code>refresh-dependencies</code> command is the command being executed</div>
<ul class="star">
<li><code>refresh-dependencies</code>コマンドが実行された場合</li>
</ul><p class="paragraph"/><div class="hidden-block">Generally, this strategy works well and you can ignore dependency resolution caching. Every time you change your dependencies (i.e. modify <code>BuildConfig.groovy</code>) Grails will do the right thing and resolve your new dependencies.</div>
一般に、この手法はうまく動作し、依存関係解決のキャッシュを無視することができます。依存関係を変更するたびに（すなわち<code>BuildConfig.groovy</code>を変更するたびに）Grailsは正しく新たに依存関係解決を実行します。<p class="paragraph"/><div class="hidden-block">However, when you have  <em class="italic">changing</em>  or  <em class="italic">dynamic</em>  dependencies you will have to consider dependency resolution caching.</div>
しかし、  <em class="italic">変化する依存関係</em>  または  <em class="italic">動的な依存関係</em>  がある場合は、依存関係解決のキャッシングを考慮する必要があります。<p class="paragraph"/><div class="hidden-block">
{info}
A  <em class="italic">changing</em>  dependency is one whose version number does not change, but its contents do (like a SNAPSHOT). A  <em class="italic">dynamic</em>  dependency is one that is defined as one of many possible options (like a dependency with a version range, or symbolic version number like <code>latest.integration</code>).
{info}
</div><p class="paragraph"/>{info}
 <em class="italic">変化する依存関係</em>  は、バージョン番号が変更されずに、内容が変化するもの（スナップショットなど）です。  <em class="italic">動的な依存関係</em>  は多くの可能なオプションのいずれかとして定義されるものです。（バージョンが範囲指定されている、または<code>latest.integration</code>のように抽象的なバージョン番号を持つ依存関係など）
{info}<p class="paragraph"/><div class="hidden-block">Both  <em class="italic">changing</em>  and  <em class="italic">dynamic</em>  dependencies are influenced by the environment. With caching active, any changes to the environment are effectively ignored. For example, your project may not automatically fetch the very latest version of a dependency when using <code>latest.integration</code>. Or if you declare a <code>SNAPSHOT</code> dependency, you may not automatically get the latest that's available on the server.</div>
変化する依存関係 と 動的な依存関係は共に、リモートリポジトリ等の外部環境に影響されます。キャッシュが有効な場合、これらの環境の変更は事実上無視されます。例えば、<code>latest.integration</code>を使用している場合、プロジェクトは依存関係の最新バージョンを自動的に取得しないでしょう。また、<code>SNAPSHOT</code>の依存関係を宣言した場合、サーバー上で使用可能な最新のものを自動的に取得できない可能性があります。<p class="paragraph"/><div class="hidden-block">To ensure you have the correct version of a  <em class="italic">changing</em>  or  <em class="italic">dynamic</em>  dependency in your project, you can:</div>
プロジェクトの  <em class="italic">変化する依存関係</em>  や  <em class="italic">動的な依存関係</em>  が正しいバージョンであることを確認するために、以下のことができます:<p class="paragraph"/><div class="hidden-block">* clean the project</div>
<ul class="star">
<li>プロジェクトのクリーンアップ</li>
</ul><p class="paragraph"/><div class="hidden-block">* run the <code>refresh-dependencies</code> command</div>
<ul class="star">
<li><code>refresh-dependencies</code>コマンドの実行</li>
</ul><p class="paragraph"/><div class="hidden-block">* run  <em class="italic">any</em>  command with the <code>&#45;&#45;refresh-dependencies</code> switch; or</div>
<ul class="star">
<li><code>任意のコマンド</code>に<code>&#45;&#45;refresh-dependencies</code>を付与して実行</li>
</ul><p class="paragraph"/><div class="hidden-block">* make a change to <code>BuildConfig.groovy</code></div>
<ul class="star">
<li><code>BuildConfig.groovy</code>を変更</li>
</ul><p class="paragraph"/><div class="hidden-block">If you have your CI builds configured to not perform clean builds, it may be worth adding the <code>&#45;&#45;refresh-dependencies</code> switch to the command you use to build your projects.</div>
CIビルドツールがクリーンビルドを実行しないように設定されている場合、プロジェクトのビルドコマンドに<code>&#45;&#45;refresh-dependencies</code>を追加しておくと有効でしょう。


<a name="4. The Command Line"><!-- Legacy link --></a>
<h1 id="commandLine">5 コマンドライン</h1>
<div class="hidden-block">
Grails' command line system is built on <a href="http://gant.codehaus.org/" target="blank">Gant</a> - a simple Groovy wrapper around <a href="http://ant.apache.org" target="blank">Apache Ant</a>.
</div>
Grailsのコマンドラインシステムは<a href="http://gant.codehaus.org/" target="blank">Gant</a>(シンプルな<a href="http://ant.apache.org" target="blank">Apache Ant</a>のGroovyによるラッパー)によって構築されています。<p class="paragraph"/><div class="hidden-block">However, Grails takes it further through the use of convention and the <code>grails</code> command. When you type:</div>
Grailsでは<code>grails</code>コマンドを使用し、Gantとは少し違った実行方法になります。<p class="paragraph"/><div class="code"><pre>grails &#91;command name&#93;</pre></div><p class="paragraph"/><div class="hidden-block">Grails searches in the following directories for Gant scripts to execute:</div>
このように入力した場合、GrailsはGantスクリプトを実行するために以下のディレクトリを探しに行きます。
<ul class="star">
<li><code>USER_HOME/.grails/scripts</code></li>
<li><code>PROJECT_HOME/scripts</code></li>
<li><code>PROJECT_HOME/plugins/*/scripts</code></li>
<li><code>GRAILS_HOME/scripts</code></li>
</ul><p class="paragraph"/><div class="hidden-block">Grails will also convert command names that are in lower case form such as run-app into camel case. So typing </div>
Grailsは "run-app" のような小文字のコマンドをキャメルケースに変換して探します。なので次のように入力すると:<p class="paragraph"/><div class="code"><pre>grails run&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">Results in a search for the following files:</div>
結果、以下のファイルを検索するよう指定したことになります。
<ul class="star">
<li><code>USER_HOME/.grails/scripts/RunApp.groovy</code></li>
<li><code>PROJECT_HOME/scripts/RunApp.groovy</code></li>
<li><code>PLUGINS_HOME/*/scripts/RunApp.groovy</code></li>
<li><code>GLOBAL_PLUGINS_HOME/*/scripts/RunApp.groovy</code></li>
<li><code>GRAILS_HOME/scripts/RunApp.groovy</code></li>
</ul><p class="paragraph"/><div class="hidden-block">If multiple matches are found Grails will give you a choice of which one to execute.</div>
もし、複数の結果が見つかった場合はGrailsはどれを実行するかの選択肢を提示してきます。<p class="paragraph"/><div class="hidden-block">When Grails executes a Gant script, it invokes the "default" target defined in that script. If there is no default, Grails will quit with an error.</div>
GrailsがGantスクリプトを実行するとき、デフォルトとして設定されたターゲットを起動します。デフォルト指定（setDefaultTarget(main)など）がない場合、Grailsはエラーで終了します。<p class="paragraph"/><div class="hidden-block">To get a list of all commands and some help about the available commands type:</div>
実行可能なコマンドのヘルプとリストを表示したい場合は以下を入力します:<p class="paragraph"/><div class="code"><pre>grails help</pre></div><p class="paragraph"/><div class="hidden-block">which outputs usage instructions and the list of commands Grails is aware of:</div>
このように入力すると、Grailsが認識しているコマンドのリストと使用方法が出力されます:<p class="paragraph"/><div class="code"><pre>Usage (optionals marked with &#42;):
grails &#91;environment&#93;&#42; &#91;target&#93; &#91;arguments&#93;&#42;<p class="paragraph"/>Examples:
grails dev run&#45;app
grails create&#45;app books<p class="paragraph"/>Available Targets (type grails help 'target&#45;name' <span class="java&#45;keyword">for</span> more info):
grails bootstrap
grails bug&#45;report
grails clean
grails compile
...</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Refer to the Command Line reference in the Quick Reference menu of the reference guide for more information about individual commands </div>
左メニューにある個別のコマンドラインリファレンス情報も参照して下さい。
</blockquote><p class="paragraph"/>It's often useful to provide custom arguments to the JVM when running Grails commands, in particular with <code>run-app</code> where you may for example want to set a higher maximum heap size. The Grails command will use any JVM options provided in the general <code>JAVA_OPTS</code> environment variable, but you can also specify a Grails-specific environment variable too:<p class="paragraph"/><div class="code"><pre>export GRAILS_OPTS=<span class="java&#45;quote">"&#45;Xmx1G &#45;Xms256m &#45;XX:MaxPermSize=256m"</span>
grails run&#45;app</pre></div><p class="paragraph"/><h4>non-interactive mode</h4><p class="paragraph"/>When you run a script manually and it prompts you for information, you can answer the questions and continue running the script. But when you run a script as part of an automated process, for example a continuous integration build server, there's no way to "answer" the questions. So you can pass the <code>&#45;&#45;non-interactive</code> switch to the script command to tell Grails to accept the default answer for any questions, for example whether to install a missing plugin.<p class="paragraph"/>For example:<p class="paragraph"/><div class="code"><pre>grails war &#45;&#45;non&#45;interactive</pre></div>



<h2 id="interactiveMode">5.1 インタラクティブモード</h2>
Interactive mode is the a feature of the Grails command line which keeps the JVM running and allows for quicker execution of commands. To activate interactive mode type 'grails' at the command line and then use TAB completion to get a list of commands:<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-output.png"></img><p class="paragraph"/>If you need to open a file whilst within interactive mode you can use the <code>open</code> command which will TAB complete file paths:<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-open-cmd.png"></img><p class="paragraph"/>Even better, the <code>open</code> command understands the logical aliases 'test-report' and 'dep-report', which will open the most recent test and dependency reports respectively. In other words, to open the test report in a browser simply execute <code>open test-report</code>. You can even open multiple files at once: <code>open test-report test/unit/MyTests.groovy</code> will open the HTML test report in your browser and the <code>MyTests.groovy</code> source file in your text editor.<p class="paragraph"/>TAB completion also works for class names after the <code>create-*</code> commands:<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-complete-class.png"></img><p class="paragraph"/>If you need to run an external process whilst interactive mode is running you can do so by starting the command with a !:<p class="paragraph"/><img border="0" class="center" src="../../img/interactive-run-external.png"></img><p class="paragraph"/>Note that with &#33; (bang) commands, you get file path auto completion - ideal for external commands that operate on the file system such as 'ls', 'cat', 'git', etc.<p class="paragraph"/>The <code>stop-app</code> command will stop an application that has been run with the <code>run-app</code> command.<p class="paragraph"/>To exit interactive mode enter the <code>exit</code> command.  Note that if the Grails application has been run with <code>run-app</code> normally it will terminate when the interactive mode console exits because the JVM will be terminated. An exception to this would be if the application were running in forked mode which means the application is running in a different JVM.  In that case the application will be left running afer the interactive mode console terminates.  If you want to exit interactive mode and stop an application that is running in forked mode, use the <code>quit</code> command.  The <code>quit</code> command will stop the running application and then close interactive mode.


<a name="5.2 Forked Execution"><!-- Legacy link --></a>
<h2 id="forkedMode">5.2 フォーク実行</h2>
<div class="hidden-block">h4. Forked Execution</div>
<h4>フォーク実行</h4><p class="paragraph"/><div class="hidden-block">Since Grails 2.3, the <code>run-app</code>, <code>run-war</code>, <code>test-app</code> and <code>console</code> commands are now executed in a forked JVM in order to isolate the build classpath from the runtime classpath.</div>
ランタイムクラスパスからビルドクラスパスを隔離するために、Grails 2.3から<code>run-app</code>、<code>run-war</code>、<code>test-app</code>、<code>console</code>コマンドはフォークされたJVM上で実行されます。<p class="paragraph"/><div class="hidden-block">Forked execution is configured via the <code>grails-app/conf/BuildConfig.groovy</code> file. The following is the default configuration:</div>
フォーク実行は<code>grails-app/conf/BuildConfig.groovy</code>ファイルで設定します。
以下はデフォルト設定です:<p class="paragraph"/><div class="code"><pre>forkConfig = &#91;maxMemory: 1024, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;
grails.project.fork = &#91;
   test: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the test&#45;app JVM
   run: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the run&#45;app JVM
   war: forkConfig, // configure settings <span class="java&#45;keyword">for</span> the run&#45;war JVM
   console: forkConfig // configure settings <span class="java&#45;keyword">for</span> the Swing console JVM
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The memory requirements of the forked JVM can be tweaked as per the requirements of the application.</div>
フォークされたJVM用のメモリ容量は、アプリケーション要件に従って調整してください。<p class="paragraph"/><div class="hidden-block">h4. Forked Test Execution</div>
<h4>フォークされたテスト実行</h4><p class="paragraph"/><div class="hidden-block">When running the <a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a> command, a separate JVM is launched to execute this tests. This will have a notable impact on the speed of execution of the tests when running the command directly:</div>
<a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a>コマンドの実行時、そのテストを実行するための個別のJVMが起動されます。
この起動時間が加算されるため、直接コマンドを実行したときの実行速度はかなりの影響を受けます:<p class="paragraph"/><div class="code"><pre>grails test&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">To mitigate this, Grails 2.3 and above include a feature that launches a background JVM on standby to run tests when using interactive mode. In other words, running <code>test-app</code> from interactive mode will result in faster test execution times:</div>
これを緩和するため、Grails 2.3以上には、インタラクティブモード利用時にテスト実行に備えてバックグラウンドでJVMを起動する機能があります。
つまり、インタラクティブモードからの<code>test-app</code>の実行では、テスト実行時間が速くなります:<p class="paragraph"/><div class="code"><pre>$ grails
$ grails&#62; test&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">It is recommended that forked execution is used for tests, however it does require modern hardware due to the use of multiple JVMs. You can therefore disable forked execution by setting the <code>grails.project.fork.test</code> setting to <code>false</code>:</div>
テストにはフォーク実行の利用をお勧めしますが、複数のJVMを利用するには最新のハードウェアが必要になります。
そのため、<code>grails.project.fork.test</code>を<code>false</code>にセットすることで、フォーク実行を無効にすることもできます。<p class="paragraph"/><div class="code"><pre>forkConfig = &#91;maxMemory: 1024, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;
grails.project.fork = &#91;
   test: <span class="java&#45;keyword">false</span>,
   &#8230;
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Forked Tomcat Execution</div>
<h4>フォークされたTomcat実行</h4><p class="paragraph"/><div class="hidden-block">Grails 2.2 and above support forked JVM execution of the Tomcat container in development mode. This has several benefits including:</div>
Grails 2.2以上では、開発モードにおけるTomcatコンテナのフォーク実行をサポートしています。
これにはいくつかのメリットがあります:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Reduced memory consumption, since the Grails build system can exit</li>
<li>Isolation of the build classpath from the runtime classpath</li>
<li>The ability to deploy other Grails/Spring applications in parallels without conflicting dependencies</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>Grailsビルドシステムを終了できるため、メモリ消費量を減らせる</li>
<li>ランタイムクラスパスからビルドクラスパスを隔離できる</li>
<li>依存関係のコンフリクトなしに、他のGrails/Springアプリケーションを並列デプロイできる</li>
</ul><p class="paragraph"/><div class="hidden-block">To enable forked execution you can set the <code>grails.project.fork.run</code> property to <code>true</code>:</div>
フォーク実行を有効化するためには、<code>grails.project.fork.run</code>プロパティを<code>true</code>にセットします:<p class="paragraph"/><div class="code"><pre>grails.project.fork.run=<span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">Then just us the regular <code>run-app</code> command as per normal. Note that in forked mode the <code>grails</code> process will exit and leave the container running in the background. To stop the server there is a new <code>stop-app</code> command:</div>
それから、いつも通り普通の<code>run-app</code>コマンドを使います。
フォークモードでは<code>grails</code>プロセスは終了し、バックグラウンドで実行中のコンテナから切り離されることに注意してください。
サーバを停止するために、新しい<code>stop-app</code>コマンドが用意されています:<p class="paragraph"/><div class="code"><pre>grails stop&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">To customize the JVM arguments passed to the forked JVM you can specify a map instead:</div>
フォークされたJVMに渡すJVM引数をカスタマイズするために、代わりにマップを指定できます:<p class="paragraph"/><div class="code"><pre>grails.project.fork.run= &#91;maxMemory:1024, minMemory:64, debug:<span class="java&#45;keyword">false</span>, maxPerm:256, jvmArgs: '..arbitrary JVM arguments..'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Auto-deploying additional WAR files in Forked Mode</div>
<h4>フォークモードでの追加WARファイルの自動デプロイ</h4><p class="paragraph"/><div class="hidden-block">Since forked execution isolates classpaths more effectively than embedded execution you can deploy additional WAR files (such as other Grails or Spring applications) to the container.</div>
組み込み実行に比べてフォーク実行はより効果的にクラスパスを分離できるため、(他のGrails/Springアプリケーションの)追加WARファイルをコンテナへデプロイできます。<p class="paragraph"/><div class="hidden-block">The easiest way to do so is to drop the WAR files into the <code>src/autodeploy</code> directory (if it doesn't exist you can create it).</div>
最も簡単な方法は、WARファイルを<code>src/autodeploy</code>ディレクトリに置くことです(もしディレクトリが存在していなければ、作成してください)。<p class="paragraph"/><div class="hidden-block">You can customize the location of the autodeploy directory by specifying an alternative location in <code>BuildConfig.groovy</code>:</div>
<code>BuildConfig.groovy</code>で別のパスを指定して<code>autodeploy</code>ディレクトリの位置をカスタマイズできます:<p class="paragraph"/><div class="code"><pre>grails.project.autodeploy.dir=<span class="java&#45;quote">"/path/to/my/war/files"</span></pre></div><p class="paragraph"/><div class="hidden-block">h4. Customizing the Forked Tomcat instance</div>
<h4>フォークされたTomcatインスタンスのカスタマイズ</h4><p class="paragraph"/><div class="hidden-block">If you want to programmatically customize the forked <a href="http://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/catalina/startup/Tomcat.html" target="blank">Tomcat</a> instance you can do so by implementing a class named <code>org.grails.plugins.tomcat.ForkedTomcatCustomizer</code> which provides a method with the following signature:</div>
フォークされた<a href="http://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/catalina/startup/Tomcat.html" target="blank">Tomcat</a>インスタンスをプログラム的にカスタマイズしたい場合は、<code>org.grails.plugins.tomcat.ForkedTomcatCustomizer</code>という名前のクラスを実装します。
このクラスは以下のシグネチャのメソッドを提供します:<p class="paragraph"/><div class="code"><pre>void customize(Tomcat tomcat) &#123;
 // your code here
&#125;</pre></div><p class="paragraph"/>

<a name="4.1 Creating Gant Scripts"><!-- Legacy link --></a>
<h2 id="creatingGantScripts">5.3 Gantスクリプトの作成</h2>
<div class="hidden-block">You can create your own Gant scripts by running the <a href="../ref/Command Line/create-script.html" class="commandLine">create-script</a> command from the root of your project. For example the following command:</div>
プロジェクトのルートディレクトリで<a href="../ref/Command Line/create-script.html" class="commandLine">create-script</a>コマンドを実行することにより、自分でGantスクリプトを作成することができます。例えば以下のようなコマンドです:<p class="paragraph"/><div class="code"><pre>grails create&#45;script compile&#45;sources</pre></div><p class="paragraph"/><div class="hidden-block">Will create a script called <code>scripts/CompileSources.groovy</code>. A Gant script itself is similar to a regular Groovy script except that it supports the concept of "targets" and dependencies between them:</div>
このコマンドにより<code>scripts/CompileSources.groovy</code>というスクリプトが作成されます。Gantスクリプト自身は通常のGroovyスクリプトと似ていますが、ターゲットという概念とそれぞれのターゲットの依存関係をサポートしています。<p class="paragraph"/><div class="code"><pre>target(<span class="java&#45;keyword">default</span>:<span class="java&#45;quote">"The <span class="java&#45;keyword">default</span> target is the one that gets executed by Grails"</span>) &#123;
    depends(clean, compile)
&#125;<p class="paragraph"/>target(clean:<span class="java&#45;quote">"Clean out things"</span>) &#123;
    ant.delete(dir:<span class="java&#45;quote">"output"</span>)
&#125;<p class="paragraph"/>target(compile:<span class="java&#45;quote">"Compile some sources"</span>) &#123;
    ant.mkdir(dir:<span class="java&#45;quote">"mkdir"</span>)
    ant.javac(srcdir:<span class="java&#45;quote">"src/java"</span>, destdir:<span class="java&#45;quote">"output"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
As demonstrated in the script above, there is an implicit <code>ant</code> variable (an instance of <code>groovy.util.AntBuilder</code>) that allows access to the <a href="http://ant.apache.org/manual/index.html" target="blank">Apache Ant API</a>.
</div>
上記で示したスクリプトのように、暗黙的な変数のantは<a href="http://ant.apache.org/manual/index.html" target="blank">Apache Ant API</a>を使うことができます。
<blockquote class="note">
<div class="hidden-block">In previous versions of Grails (1.0.3 and below), the variable was <code>Ant</code>, i.e. with a capital first letter.</div>
前バージョンのGrails(1.0.3以前)では、変数名はAntのように大文字始まりでした。
</blockquote><p class="paragraph"/><div class="hidden-block">You can also "depend" on other targets using the <code>depends</code> method demonstrated in the <code>default</code> target above.</div>
また、上記のdefaultターゲットで示したように、<code>depends</code>メソッドを使って他のターゲットに 依存させることができます。<p class="paragraph"/><h3>デフォルトターゲット <div class="hidden-block">The default target </div></h3><p class="paragraph"/><div class="hidden-block">In the example above, we specified a target with the explicit name "default". This is one way of defining the default target for a script. An alternative approach is to use the <code>setDefaultTarget()</code> method:</div>
上記の例では"default"と明示的にターゲットを指定しました。これは、スクリプトでデフォルトターゲットを定義する方法の一つです。（最新のバージョンでは使用できません）代わりに<code>setDefaultTarget()</code>メソッドを使用することもできます。<p class="paragraph"/><div class="code"><pre>target(<span class="java&#45;quote">"clean&#45;compile"</span>: <span class="java&#45;quote">"Performs a clean compilation on the app source"</span>) &#123;
    depends(clean, compile)
&#125;<p class="paragraph"/>target(clean:<span class="java&#45;quote">"Clean out things"</span>) &#123;
    ant.delete(dir:<span class="java&#45;quote">"output"</span>)
&#125;<p class="paragraph"/>target(compile:<span class="java&#45;quote">"Compile some sources"</span>) &#123;
    ant.mkdir(dir:<span class="java&#45;quote">"mkdir"</span>)
    ant.javac(srcdir:<span class="java&#45;quote">"src/java"</span>, destdir:<span class="java&#45;quote">"output"</span>)
&#125;<p class="paragraph"/>setDefaultTarget(<span class="java&#45;quote">"clean&#45;compile"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">This lets you call the default target directly from other scripts if you wish. Also, although we have put the call to <code>setDefaultTarget()</code> at the end of the script in this example, it can go anywhere as long as it comes  <em class="italic">after</em>  the target it refers to ("clean-compile" in this case).</div>
こうすることで、他のスクリプトのターゲットを直接デフォルトターゲットに指定できます。<code>setDefaultTarget()</code>は、対象のターゲット(今回の場合は "clean-compile")の後であればどこにでも書くことができます。<p class="paragraph"/><div class="hidden-block">Which approach is better? To be honest, you can use whichever you prefer - there don't seem to be any major advantages in either case. One thing we would say is that if you want to allow other scripts to call your "default" target, you should move it into a shared script that doesn't have a default target at all. We'll talk some more about this in the next section.</div>
どちらのアプローチが良いのでしょうか？正直なところ、あなたは好みで使い分けて使用することができます。どちらの場合も、王道の利点があるわけではありません。一つ言えることは、他のスクリプトからデフォルトターゲットを呼び出せるようにしたい場合は、デフォルトターゲットを持っていない共有スクリプトにそれを移動する必要があるということです。これについては次のセクションでも詳しく説明します。


<a name="4.2 Re-using Grails scripts"><!-- Legacy link --></a>
<h2 id="reusingGrailsScripts">5.4 Grailsスクリプトの再利用</h2>
<div class="hidden-block">Grails ships with a lot of command line functionality out of the box that you may find useful in your own scripts (See the command line reference in the reference guide for info on all the commands). Of particular use are the <a href="../ref/Command Line/compile.html" class="commandLine">compile</a>, <a href="../ref/Command Line/package.html" class="commandLine">package</a> and <a href="../ref/Command Line/bootstrap.html" class="commandLine">bootstrap</a> scripts.</div>
Grailsは独自のスクリプトでも使用できる便利なコマンドライン機能を提供しています（コマンドに関する詳細はリファレンスガイド内のコマンドラインリファレンスを参照してください）。特に<a href="../ref/Command Line/compile.html" class="commandLine">compile</a>、<a href="../ref/Command Line/package.html" class="commandLine">package</a>および<a href="../ref/Command Line/bootstrap.html" class="commandLine">bootstrap</a>スクリプトはよく利用されます。<p class="paragraph"/><div class="hidden-block">The <a href="../ref/Command Line/bootstrap.html" class="commandLine">bootstrap</a> script for example lets you bootstrap a Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a> instance to get access to the data source and so on (the integration tests use this):</div>
<a href="../ref/Command Line/bootstrap.html" class="commandLine">bootstrap</a>スクリプトはデータソースなどを参照可能にするSpringの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a>インスタンスを生成します。(統合テストはこの機能を使っています):<p class="paragraph"/><div class="code"><pre>includeTargets &#60;&#60; grailsScript(<span class="java&#45;quote">"_GrailsBootstrap"</span>)<p class="paragraph"/>target ('<span class="java&#45;keyword">default</span>': <span class="java&#45;quote">"Database stuff"</span>) &#123;
    depends(configureProxy, packageApp, classpath, loadApp, configureApp)<p class="paragraph"/>    Connection c
    <span class="java&#45;keyword">try</span> &#123;
        c = appCtx.getBean('dataSource').getConnection()
        // <span class="java&#45;keyword">do</span> something with connection
    &#125;
    <span class="java&#45;keyword">finally</span> &#123;
        c?.close()
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>他のスクリプトからターゲットを取り出す <div class="hidden-block">Pulling in targets from other scripts </div></h3><p class="paragraph"/><div class="hidden-block">Gant lets you pull in all targets (except "default") from another Gant script. You can then depend upon or invoke those targets as if they had been defined in the current script. The mechanism for doing this is the <code>includeTargets</code> property. Simply "append" a file or class to it using the left-shift operator:</div>
Gantはターゲットを他のGantスクリプトから取り込むことができます。取り込んだターゲットは、あたかも現在のスクリプトで定義されているかのように実行することができます。この仕組みは<code>includeTargets</code>プロパティにより実現されます。単純に左シフト演算子でファイル又は使用するクラスを追加します:<p class="paragraph"/><div class="code"><pre>includeTargets &#60;&#60; <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/path/to/my/script.groovy"</span>)
includeTargets &#60;&#60; gant.tools.Ivy</pre></div>
<div class="hidden-block">Don't worry too much about the syntax using a class, it's quite specialised. If you're interested, look into the Gant documentation.</div>
クラスを使用している構文はGantのルールに従って記述されたクラスを使用しています。もし興味があればGantのドキュメントを参照して下さい。<p class="paragraph"/><h3>Core Grailsターゲット <div class="hidden-block">Core Grails targets </div></h3><p class="paragraph"/><div class="hidden-block">As you saw in the example at the beginning of this section, you use neither the File- nor the class-based syntax for <code>includeTargets</code> when including core Grails targets. Instead, you should use the special <code>grailsScript()</code> method that is provided by the Grails command launcher (note that this is not available in normal Gant scripts, just Grails ones).</div>
この章の冒頭の例でお見せしたように、Core Grailsターゲットを含める際に利用する<code>includeTargets</code>では、ファイルベース構文、クラスベース構文のどちらも使用しません。代わりに、Grailsコマンドランチャが提供している<code>grailsScript()</code>という特別なメソッドを使用します（このメソッドはGrails専用であり、通常のGantでは利用できません）。<p class="paragraph"/><div class="hidden-block">The syntax for the <code>grailsScript()</code> method is pretty straightforward: simply pass it the name of the Grails script to include, without any path information. Here is a list of Grails scripts that you could reuse:</div>
<code>grailsScript()</code>メソッドの構文は、単に含めたいGrailsスクリプトの名称を渡すだけです。以下に再利用できるGrailsスクリプトの一覧を示します:
<div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Script</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>&#95;GrailsSettings</td><td>You really should include this! Fortunately, it is included automatically by all other Grails scripts except &#95;GrailsProxy, so you usually don't have to include it explicitly.</td></tr><tr class="table-even"><td>&#95;GrailsEvents</td><td>Include this to fire events. Adds an <code>event(String eventName, List args)</code> method. Again, included by almost all other Grails scripts.</td></tr><tr class="table-odd"><td>&#95;GrailsClasspath</td><td>Configures compilation, test, and runtime classpaths. If you want to use or play with them, include this script. Again, included by almost all other Grails scripts.</td></tr><tr class="table-even"><td>&#95;GrailsProxy</td><td>If you don't have direct access to the internet and use a proxy, include this script to configure access through your proxy.</td></tr><tr class="table-odd"><td>&#95;GrailsArgParsing</td><td>Provides a <code>parseArguments</code> target that does what it says on the tin: parses the arguments provided by the user when they run your script. Adds them to the <code>argsMap</code> property.</td></tr><tr class="table-even"><td>&#95;GrailsTest</td><td>Contains all the shared test code. Useful if you want to add any extra tests.</td></tr><tr class="table-odd"><td>&#95;GrailsRun</td><td>Provides all you need to run the application in the configured servlet container, either normally (<code>runApp</code>/<code>runAppHttps</code>) or from a WAR file (<code>runWar</code>/<code>runWarHttps</code>).</td></tr></table>
</div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">スクリプト</strong></th><th><strong class="bold">説明</strong></th></tr><tr class="table-odd"><td>&#95;GrailsSettings</td><td>Grailsの設定などを読み込むスクリプト。このスクリプトは他のスクリプト（_GrailsProxyなど）で自動的にインクルードされているので、通常は明示的にインクルードする必要はありません。</td></tr><tr class="table-even"><td>&#95;GrailsEvents</td><td>イベントトリガーを実装するためのメソッド（<code>event(String eventName, List args)</code>）を使用するには、これをインクルードする必要があります。このスクリプトもほぼ全てのGrailsスクリプトでインクルードされています。</td></tr><tr class="table-odd"><td>&#95;GrailsClasspath</td><td>コンパイル、テスト、およびランタイムのクラスパスを設定します。このスクリプトもほぼ全ての Grailsスクリプトでインクルードされています。</td></tr><tr class="table-even"><td>&#95;GrailsProxy</td><td>インターネットにアクセスする場合は、プロキシの解決をするためにこのスクリプトをインクルードして下さい。</td></tr><tr class="table-odd"><td>&#95;GrailsArgParsing</td><td><code>parseArguments</code>ターゲットはその名の通り解析する機能を提供します。スクリプトを実行する際に指定した引数を解析します。<code>argsMap</code>プロパティにそれらの設定の追加します。</td></tr><tr class="table-even"><td>&#95;GrailsTest</td><td>すべてのテスト実行に使用するコードが含まれています。他の種類のテストを追加する際に便利です。</td></tr><tr class="table-odd"><td>&#95;GrailsRun</td><td>アプリケーションを起動させるために必要な機能を提供します。通常は（<code>runApp/runAppHttps</code>）から、またはWARファイル（<code>runWar/runWarHttps</code>）から実行します。</td></tr></table><p class="paragraph"/><div class="hidden-block">There are many more scripts provided by Grails, so it is worth digging into the scripts themselves to find out what kind of targets are available. Anything that starts with an "&#95;" is designed for reuse.</div>
Grailsではもっと多くのスクリプトが提供されていますので、どんな種類のターゲットが利用可能かを調べてみる価値があるでしょう。" <em class="italic">"で始まっているものはすべて再利用されることを考慮してデザインされています。<p class="paragraph"/><h3>スクリプトアーキテクチャ <div class="hidden-block">Script architecture </div></h3><p class="paragraph"/><div class="hidden-block">You maybe wondering what those underscores are doing in the names of the Grails scripts. That is Grails' way of determining that a script is _internal</em> , or in other words that it has not corresponding "command". So you can't run "grails &#95;grails-settings" for example. That is also why they don't have a default target.</div>
アンダースコアで始まるGrailsスクリプトは、何を示しているものかを説明すると、それらはコマンドではなく、他のスクリプトから利用されるスクリプト群として認識されます。なので、それらのスクリプト（内部スクリプト）はデフォルトターゲットを持っておらず、スクリプトは実行できません。<p class="paragraph"/><div class="hidden-block">Internal scripts are all about code sharing and reuse. In fact, we recommend you take a similar approach in your own scripts: put all your targets into an internal script that can be easily shared, and provide simple command scripts that parse any command line arguments and delegate to the targets in the internal script. For example if you have a script that runs some functional tests, you can split it like this:</div>
内部スクリプトは共有して再利用するために存在します。実際に独自のスクリプトを書く場合は、同等の手法をとることをお勧めします。簡単に共有できるターゲットは内部スクリプトにすべて置き、コマンドライン引数を解析して、内部スクリプト内のターゲットを呼び出すだけのコマンドスクリプトを提供します。例えば、いくつかのファンクショナルテストを行うスクリプトがあるという場合、以下のように分割できます。<p class="paragraph"/><div class="code"><pre>./scripts/FunctionalTests.groovy:<p class="paragraph"/>includeTargets &#60;&#60; <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"$&#123;basedir&#125;/scripts/_FunctionalTests.groovy"</span>)<p class="paragraph"/>target(<span class="java&#45;keyword">default</span>: <span class="java&#45;quote">"Runs the functional tests <span class="java&#45;keyword">for</span> <span class="java&#45;keyword">this</span> project."</span>) &#123;
    depends(runFunctionalTests)
&#125;<p class="paragraph"/>./scripts/_FunctionalTests.groovy:<p class="paragraph"/>includeTargets &#60;&#60; grailsScript(<span class="java&#45;quote">"_GrailsTest"</span>)<p class="paragraph"/>target(runFunctionalTests: <span class="java&#45;quote">"Run functional tests."</span>) &#123;
    depends(...)
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here are a few general guidelines on writing scripts:</div>
以下にスクリプトを書く際のガイドラインを示します:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Split scripts into a "command" script and an internal one.</li>
<li>Put the bulk of the implementation in the internal script.</li>
<li>Put argument parsing into the "command" script.</li>
<li>To pass arguments to a target, create some script variables and initialise them before calling the target.</li>
<li>Avoid name clashes by using closures assigned to script variables instead of targets. You can then pass arguments direct to the closures.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>スクリプトを"コマンドスクリプト"と"内部スクリプト"に分割します。</li>
<li>実装の大部分は"内部スクリプト"で行います。</li>
<li>引数の解析は"コマンドスクリプト"で行います。</li>
<li>ターゲットに引数を渡すには、いくつかのスクリプト変数を作成し、ターゲットを呼び出す前にそれらを初期化します。</li>
<li>ターゲットの代わりにスクリプト変数に割り当てられているクロージャを使用して名前の衝突を避けるようにします。そうすれば、引数をクロージャに直接渡すことができます。</li>
</ul><p class="paragraph"/>

<a name="4.3 Hooking into Events"><!-- Legacy link --></a>
<h2 id="events">5.5 イベントを取得する</h2>
<div class="hidden-block">Grails provides the ability to hook into scripting events. These are events triggered during execution of Grails target and plugin scripts.</div>
Grailsはスクリプトのイベントフックを提供しています。イベントフックとは、Grailsターゲット実行時やプラグインスクリプト実行時に発行されるイベントを取得して処理を行うことができる機能です。<p class="paragraph"/><div class="hidden-block">The mechanism is deliberately simple and loosely specified. The list of possible events is not fixed in any way, so it is possible to hook into events triggered by plugin scripts, for which there is no equivalent event in the core target scripts.</div>
仕組みはわざと単純でゆるく明記できるようになっています。起こりうるイベントは予測できないからです。なので、コアターゲットと同等のイベントが無い場合はプラグインスクリプトからトリガーされたイベントにフックする事も可能です。<p class="paragraph"/><h4>イベントハンドラを定義する <div class="hidden-block">Defining event handlers </div></h4><p class="paragraph"/><div class="hidden-block">Event handlers are defined in scripts called <code>_Events.groovy</code>. Grails searches for these scripts in the following locations:</div>
イベントハンドラは<code>_Events.groovy</code>という名称のスクリプトで定義します。Grailsは次の場所からスクリプトを検索します:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>USER_HOME/.grails/scripts</code> - user-specific event handlers</li>
<li><code>PROJECT_HOME/scripts</code> - applicaton-specific event handlers</li>
<li><code>PLUGINS_HOME/*/scripts</code> - plugin-specific event handlers</li>
<li><code>GLOBAL_PLUGINS_HOME/*/scripts</code> - event handlers provided by global plugins</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>USER_HOME/.grails/scripts</code> - ユーザー固有のイベントハンドラ</li>
<li><code>PROJECT_HOME/scripts</code> - アプリケーション固有のイベントハンドラ</li>
<li><code>PLUGINS_HOME/*/scripts</code> - プラグイン固有のイベントハンドラ</li>
<li><code>GLOBAL_PLUGINS_HOME/*/scripts</code> - グローバルプラグインによって提供されているイベントハンドラ</li>
</ul><p class="paragraph"/><div class="hidden-block">Whenever an event is fired,  <em class="italic">all</em>  the registered handlers for that event are executed. Note that the registration of handlers is performed automatically by Grails, so you just need to declare them in the relevant <code>_Events.groovy</code> file.</div>
イベントが発生するたびに登録されている  <em class="italic">すべての</em>  ハンドラが実行されます。ハンドラの登録はGrailsによって自動的に行われることに注意してください。なので、必要な作業は関連する<code>_Events.groovy</code>ファイルにそれらを宣言するだけです。<p class="paragraph"/><div class="hidden-block">Event handlers are blocks defined in <code>_Events.groovy</code>, with a name beginning with "event". The following example can be put in your /scripts directory to demonstrate the feature:</div>
イベントハンドラは _Events.groovy で定義されている名前が "event" で始まっているブロックです。次の例のように<code>_Events.groovy</code>を記述して、/scripts ディレクトリに配置することによって、イベントハンドラを実装することができます:<p class="paragraph"/><div class="code"><pre>eventCreatedArtefact = &#123; type, name &#45;&#62;
   println <span class="java&#45;quote">"Created $type $name"</span>
&#125;<p class="paragraph"/>eventStatusUpdate = &#123; msg &#45;&#62;
   println msg
&#125;<p class="paragraph"/>eventStatusFinal = &#123; msg &#45;&#62;
   println msg
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can see here the three handlers <code>eventCreatedArtefact</code>, <code>eventStatusUpdate</code>, <code>eventStatusFinal</code>. Grails provides some standard events, which are documented in the command line reference guide. For example the <a href="../ref/Command Line/compile.html" class="commandLine">compile</a> command fires the following events:</div>
ここでは三つのハンドラが指定されています。<code>eventCreatedArtefact</code>、<code>eventStatusUpdate</code>、<code>eventStatusFinal</code>。Grailsはいくつかの標準的なイベントを提供しています。詳細はコマンドラインリファレンスガイドを参照してください。たとえば、 <a href="../ref/Command Line/compile.html" class="commandLine">compile</a>コマンドは、次のようなイベントを発行させます。
<div class="hidden-block">
<ul class="star">
<li><code>CompileStart</code>  - Called when compilation starts, passing the kind of compile - source or tests</li>
<li><code>CompileEnd</code> - Called when compilation is finished, passing the kind of compile - source or tests</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>CompileStart</code> - sourceまたはtestsコンパイル開始時に発行されます。</li>
<li><code>CompileEnd</code> - sourceまたはtestsコンパイル終了時に発行されます。</li>
</ul><p class="paragraph"/><h4>イベントトリガー <div class="hidden-block">Triggering events </div></h4><p class="paragraph"/><div class="hidden-block">To trigger an event simply include the Init.groovy script and call the event() closure:</div>
イベントを発行するには _GrailsEvents.groovy スクリプトをインクルードしてevent()クロージャを使用します:<p class="paragraph"/><div class="code"><pre>includeTargets &#60;&#60; grailsScript(<span class="java&#45;quote">"_GrailsEvents"</span>)<p class="paragraph"/>event(<span class="java&#45;quote">"StatusFinal"</span>, &#91;<span class="java&#45;quote">"Super duper plugin action complete!"</span>&#93;)</pre></div><p class="paragraph"/><h4>共通イベント <div class="hidden-block">Common Events </div></h4><p class="paragraph"/><div class="hidden-block">Below is a table of some of the common events that can be leveraged:</div>
以下はいくつかの利用可能な共通イベントの一覧です:<p class="paragraph"/><div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Event</th><th>Parameters</th><th>Description</th></tr><tr class="table-odd"><td>StatusUpdate</td><td>message</td><td>Passed a string indicating current script status/progress</td></tr><tr class="table-even"><td>StatusError</td><td>message</td><td>Passed a string indicating an error message from the current script</td></tr><tr class="table-odd"><td>StatusFinal</td><td>message</td><td>Passed a string indicating the final script status message, i.e. when completing a target, even if the target does not exit the scripting environment</td></tr><tr class="table-even"><td>CreatedArtefact</td><td>artefactType,artefactName</td><td>Called when a create-xxxx script has completed and created an artefact</td></tr><tr class="table-odd"><td>CreatedFile</td><td>fileName</td><td>Called whenever a project source filed is created, not including files constantly managed by Grails</td></tr><tr class="table-even"><td>Exiting</td><td>returnCode</td><td>Called when the scripting environment is about to exit cleanly</td></tr><tr class="table-odd"><td>PluginInstalled</td><td>pluginName</td><td>Called after a plugin has been installed</td></tr><tr class="table-even"><td>CompileStart</td><td>kind</td><td>Called when compilation starts, passing the kind of compile - source or tests</td></tr><tr class="table-odd"><td>CompileEnd</td><td>kind</td><td>Called when compilation is finished, passing the kind of compile - source or tests</td></tr><tr class="table-even"><td>DocStart</td><td>kind</td><td>Called when documentation generation is about to start - javadoc or groovydoc</td></tr><tr class="table-odd"><td>DocEnd</td><td>kind</td><td>Called when documentation generation has ended - javadoc or groovydoc</td></tr><tr class="table-even"><td>SetClasspath</td><td>rootLoader</td><td>Called during classpath initialization so plugins can augment the classpath with rootLoader.addURL(...). Note that this augments the classpath <strong class="bold">after</strong> event scripts are loaded so you cannot use this to load a class that your event script needs to import, although you can do this if you load the class by name.</td></tr><tr class="table-odd"><td>PackagingEnd</td><td>none</td><td>Called at the end of packaging (which is called prior to the Tomcat server being started and after web.xml is generated)</td></tr></table>
</div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>イベント</th><th>パラメータ</th><th>説明</th></tr><tr class="table-odd"><td>StatusUpdate</td><td>message</td><td>実行されているスクリプトのステータス、進捗メッセージを知らせる</td></tr><tr class="table-even"><td>StatusError</td><td>message</td><td>実行されているスクリプトのエラーメッセージを 知らせる</td></tr><tr class="table-odd"><td>StatusFinal</td><td>message</td><td>スクリプトの終了時に最終メッセージを知らせる。 スクリプトによっては完全終了時ではなく、コマ ンドの終了時に動作する</td></tr><tr class="table-even"><td>CreatedArtefact</td><td>artefactType,artefactName</td><td>create-xxxxなどのアーティファクト生成スクリプトが、アーティファクトの生成完了時にアーティ ファクトタイプとアーティファクト名を知らせる</td></tr><tr class="table-odd"><td>CreatedFile</td><td>fileName</td><td>ファイルがスクリプトによって生成されたときに ファイル名を知らせる</td></tr><tr class="table-even"><td>Exiting</td><td>returnCode</td><td>スクリプトが正常に終了したときに終了コードを 知らせる</td></tr><tr class="table-odd"><td>PluginInstalled</td><td>pluginName</td><td>プラグインのインストールが終了した後にプラグイン 名を知らせる</td></tr><tr class="table-even"><td>CompileStart</td><td>kind</td><td>コンパイル開始時にコンパイルする種類(source または tests)を知らせる</td></tr><tr class="table-odd"><td>CompileEnd</td><td>kind</td><td>コンパイル終了時にコンパイルした種類(source または tests)を知らせる</td></tr><tr class="table-even"><td>DocStart</td><td>kind</td><td>ドキュメント生成時に、どのドキュメント生成(javadoc または groovydoc)が開始するかを知らせる</td></tr><tr class="table-odd"><td>DocEnd</td><td>kind</td><td>ドキュメント生成完了時に、どのドキュメント生成(javadoc または groovydoc)が完了したかを知らせる</td></tr><tr class="table-even"><td>SetClasspath</td><td>rootLoader</td><td>クラスパス初期化中にGrailsRootLoader が渡されるので、「rootLoader.addURL( &#8230; )」でクラスをGrailsRootLoader に追加できる</td></tr><tr class="table-odd"><td>PackagingEnd</td><td>none</td><td>Grailsアプリケーションのパッケージング完了時 (web.xml生成後、Tomcatサーバ起動前)に呼び出される</td></tr></table><p class="paragraph"/>

<a name="4.4 Customising the build"><!-- Legacy link --></a>
<h2 id="buildCustomising">5.6 ビルドのカスタマイズ</h2>
<div class="hidden-block">Grails is most definitely an opinionated framework and it prefers convention to configuration, but this doesn't mean you  <em class="italic">can't</em>  configure it. In this section, we look at how you can influence and modify the standard Grails build.</div>
Grailsは確かにものすごく固執したフレームワークであり、設定よりも規約という方式を主張していますが、それは様々な設定をできないという意味ではありません。このセクションでは、どのようにGrailsの標準的なビルドをカスタマイズする方法を解説します。<p class="paragraph"/><h3>初期値 <div class="hidden-block">The defaults </div></h3><p class="paragraph"/><div class="hidden-block">The core of the Grails build configuration is the <code>grails.util.BuildSettings</code> class, which contains quite a bit of useful information. It controls where classes are compiled to, what dependencies the application has, and other such settings.</div>
ビルド設定の中心部分は、ビルド時に有用な情報が含まれている <code>grails.util.BuildSettings</code>クラスです。このクラスは、どこにコンパイルされるのか、アプリケーションが何に依存関係を持っているのか、どのような設定を保持しているのか、を制御します。<p class="paragraph"/><div class="hidden-block">Here is a selection of the configuration options and their default values:</div>
設定オプションと初期値は以下のようになります:
<div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Config option</strong></th><th><strong class="bold">Default value</strong></th></tr><tr class="table-odd"><td>grailsWorkDir</td><td>grails.work.dir</td><td>$USER_HOME/.grails/&#60;grailsVersion&#62;</td></tr><tr class="table-even"><td>projectWorkDir</td><td>grails.project.work.dir</td><td>&#60;grailsWorkDir&#62;/projects/&#60;baseDirName&#62;</td></tr><tr class="table-odd"><td>classesDir</td><td>grails.project.class.dir</td><td>&#60;projectWorkDir&#62;/classes</td></tr><tr class="table-even"><td>testClassesDir</td><td>grails.project.test.class.dir</td><td>&#60;projectWorkDir&#62;/test-classes</td></tr><tr class="table-odd"><td>testReportsDir</td><td>grails.project.test.reports.dir</td><td>&#60;projectWorkDir&#62;/test/reports</td></tr><tr class="table-even"><td>resourcesDir</td><td>grails.project.resource.dir</td><td>&#60;projectWorkDir&#62;/resources</td></tr><tr class="table-odd"><td>projectPluginsDir</td><td>grails.project.plugins.dir</td><td>&#60;projectWorkDir&#62;/plugins</td></tr><tr class="table-even"><td>globalPluginsDir</td><td>grails.global.plugins.dir</td><td>&#60;grailsWorkDir&#62;/global-plugins</td></tr><tr class="table-odd"><td>verboseCompile</td><td>grails.project.compile.verbose</td><td><code>false</code></td></tr></table>
</div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">プロパティ</strong></th><th><strong class="bold">設定オプション</strong></th><th><strong class="bold">初期値</strong></th></tr><tr class="table-odd"><td>grailsWorkDir</td><td>grails.work.dir</td><td>$USER_HOME/.grails/&#60;grailsVersion&#62;</td></tr><tr class="table-even"><td>projectWorkDir</td><td>grails.project.work.dir</td><td>&#60;grailsWorkDir&#62;/projects/&#60;baseDirName&#62;</td></tr><tr class="table-odd"><td>classesDir</td><td>grails.project.class.dir</td><td>&#60;projectWorkDir&#62;/classes</td></tr><tr class="table-even"><td>testClassesDir</td><td>grails.project.test.class.dir</td><td>&#60;projectWorkDir&#62;/test-classes</td></tr><tr class="table-odd"><td>testReportsDir</td><td>grails.project.test.reports.dir</td><td>&#60;projectWorkDir&#62;/test/reports</td></tr><tr class="table-even"><td>resourcesDir</td><td>grails.project.resource.dir</td><td>&#60;projectWorkDir&#62;/resources</td></tr><tr class="table-odd"><td>projectPluginsDir</td><td>grails.project.plugins.dir</td><td>&#60;projectWorkDir&#62;/plugins</td></tr><tr class="table-even"><td>globalPluginsDir</td><td>grails.global.plugins.dir</td><td>&#60;grailsWorkDir&#62;/global-plugins</td></tr><tr class="table-odd"><td>verboseCompile</td><td>grails.project.compile.verbose</td><td><code>false</code></td></tr></table><p class="paragraph"/><div class="hidden-block">The <code>BuildSettings</code> class has some other properties too, but they should be treated as read-only:</div>
<code>BuildSettings</code>クラスは、他にもいくつかの読み取り専用のプロパティを持っています:
<div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>baseDir</td><td>The location of the project.</td></tr><tr class="table-even"><td>userHome</td><td>The user's home directory.</td></tr><tr class="table-odd"><td>grailsHome</td><td>The location of the Grails installation in use (may be <code>null</code>).</td></tr><tr class="table-even"><td>grailsVersion</td><td>The version of Grails being used by the project.</td></tr><tr class="table-odd"><td>grailsEnv</td><td>The current Grails environment.</td></tr><tr class="table-even"><td>config</td><td>The configuration settings defined in the project's <code>BuildConfig.groovy</code> file. Access properties in the same way as you access runtime settings: <code>grailsSettings.config.foo.bar.hello</code>.</td></tr><tr class="table-odd"><td>compileDependencies</td><td>A list of compile-time project dependencies as <code>File</code> instances.</td></tr><tr class="table-even"><td>testDependencies</td><td>A list of test-time project dependencies as <code>File</code> instances.</td></tr><tr class="table-odd"><td>runtimeDependencies</td><td>A list of runtime-time project dependencies as <code>File</code> instances.</td></tr></table>
</div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">プロパティ</strong></th><th><strong class="bold">説明</strong></th></tr><tr class="table-odd"><td>baseDir</td><td>プロジェクトの場所。</td></tr><tr class="table-even"><td>userHome</td><td>ユーザーのホームディレクトリ。</td></tr><tr class="table-odd"><td>grailsHome</td><td>使用中のGrailsのインストール先（<code>null</code>の場合あり）。</td></tr><tr class="table-even"><td>grailsVersion</td><td>プロジェクトで使用されているGrailsのバージョン。</td></tr><tr class="table-odd"><td>grailsEnv</td><td>現在のGrails環境。</td></tr><tr class="table-even"><td>config</td><td>プロジェクトの <code>BuildConfig.groovy</code> に定義された設定。ランタイム時と同様にプロパティにアクセスできます: <code>grailsSettings.config.foo.bar.hello</code></td></tr><tr class="table-odd"><td>compileDependencies</td><td>コンパイル時のプロジェクト依存関係のFileインスタンスのリスト。</td></tr><tr class="table-even"><td>testDependencies</td><td>テスト時のプロジェクト依存関係のFileインスタンスのリスト。</td></tr><tr class="table-odd"><td>runtimeDependencies</td><td>実行時のプロジェクト依存関係のFileインスタンスのリスト。</td></tr></table><p class="paragraph"/><div class="hidden-block">Of course, these properties aren't much good if you can't get hold of them. Fortunately that's easy to do: an instance of <code>BuildSettings</code> is available to your scripts as the <code>grailsSettings</code> script variable. You can also access it from your code by using the <code>grails.util.BuildSettingsHolder</code> class, but this isn't recommended.</div>
もちろんこれらのプロパティがぴったり合うとは限りません。幸いなことに、<code>BuildSettings</code>のインスタンスの<code>grailsSettingspスクリプト変数を介して利用可能です。他のコードからも</code>grails.util.BuildSettingsHolder@クラスを使用してアクセスすることができます。でもこれは推奨されません。<p class="paragraph"/><h3>初期値を上書きする <div class="hidden-block">Overriding the defaults </div></h3><p class="paragraph"/><div class="hidden-block">All of the properties in the first table can be overridden by a system property or a configuration option - simply use the "config option" name. For example, to change the project working directory, you could either run this command:</div>
1つめの表内のすべてのプロパティは、システムプロパティや設定オプションで上書きすることができます。たとえば、プロジェクトの作業ディレクトリ(projectWorkDir)を変更するには、このようにコマンドを実行することができます:
<div class="code"><pre>grails &#45;Dgrails.project.work.dir=work compile</pre></div>
<div class="hidden-block">or add this option to your <code>grails-app/conf/BuildConfig.groovy</code> file:</div>
<code>grails-app/conf/BuildConfig.groovy</code>に記述します:
<div class="code"><pre>grails.project.work.dir = <span class="java&#45;quote">"work"</span></pre></div>
<div class="hidden-block">Note that the default values take account of the property values they depend on, so setting the project working directory like this would also relocate the compiled classes, test classes, resources, and plugins.</div>
注意点として、プロパティが依存しているプロパティのデフォルト値にも影響するので、このようにプロジェクトの作業ディレクトリを設定すると、コンパイルされたクラス、テストクラス、リソース、およびプラグインの場所を変更することにもなります。<p class="paragraph"/><div class="hidden-block">What happens if you use both a system property and a configuration option? Then the system property wins because it takes precedence over the <code>BuildConfig.groovy</code> file, which in turn takes precedence over the default values.</div>
システムプロパティと設定オプションの両方を指定した場合、システムプロパティは<code>BuildConfig.groovy</code>ファイルの設定よりも優先順位が高いので、システムプロパティの値が設定されます。<p class="paragraph"/><div class="hidden-block">The <code>BuildConfig.groovy</code> file is a sibling of <code>grails-app/conf/Config.groovy</code> - the former contains options that only affect the build, whereas the latter contains those that affect the application at runtime. It's not limited to the options in the first table either: you will find build configuration options dotted around the documentation, such as ones for specifying the port that the embedded servlet container runs on or for determining what files get packaged in the WAR file.</div>
<code>BuildConfig.groovy</code>ファイルは、<code>grails-app/conf/Config.groovy</code>と兄妹関係にあります。前者は、ビルド時にのみ影響を及ぼすオプションを含んでいるのに対して、後者はアプリケーションの実行時に影響を与えるオプションを含んでいます。設定オプションは、1つめの表で示したオプション以外にも、サーブレットコンテナを動かすポート指定や、WARファイルにどのファイルを格納するかを決定する指定など、他にも指定可能なビルド設定が存在します。<p class="paragraph"/><h3>使用可能なビルド設定 <div class="hidden-block">Available build settings </div></h3><p class="paragraph"/><div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Name</th><th>Description</th></tr><tr class="table-odd"><td>grails.server.port.http</td><td>Port to run the embedded servlet container on ("run-app" and "run-war"). Integer.</td></tr><tr class="table-even"><td>grails.server.port.https</td><td>Port to run the embedded servlet container on for HTTPS ("run-app &#45;&#45;https" and "run-war &#45;&#45;https"). Integer.</td></tr><tr class="table-odd"><td>grails.config.base.webXml</td><td>Path to a custom web.xml file to use for the application (alternative to using the web.xml template).</td></tr><tr class="table-even"><td>grails.compiler.dependencies</td><td>Legacy approach to adding extra dependencies to the compiler classpath. Set it to a closure containing "fileset()" entries. These entries will be processed by an <code>AntBuilder</code> so the syntax is the Groovy form of the corresponding XML elements in an Ant build file, e.g. <code>fileset(dir: "$basedir/lib", includes: "&#42;&#42;/&#42;.class")</code>.</td></tr><tr class="table-odd"><td>grails.testing.patterns</td><td>A list of Ant path patterns that let you control which files are included in the tests. The patterns should not include the test case suffix, which is set by the next property.</td></tr><tr class="table-even"><td>grails.testing.nameSuffix</td><td>By default, tests are assumed to have a suffix of "Tests". You can change it to anything you like but setting this option. For example, another common suffix is "Test".</td></tr><tr class="table-odd"><td>grails.project.war.file</td><td>A string containing the file path of the generated WAR file, along with its full name (include extension). For example, "target/my-app.war".</td></tr><tr class="table-even"><td>grails.war.dependencies</td><td>A closure containing "fileset()" entries that allows you complete control over what goes in the WAR's "WEB-INF/lib" directory.</td></tr><tr class="table-odd"><td>grails.war.copyToWebApp</td><td>A closure containing "fileset()" entries that allows you complete control over what goes in the root of the WAR. It overrides the default behaviour of including everything under "web-app".</td></tr><tr class="table-even"><td>grails.war.resources</td><td>A closure that takes the location of the staging directory as its first argument. You can use any Ant tasks to do anything you like. It is typically used to remove files from the staging directory before that directory is jar'd up into a WAR.</td></tr><tr class="table-odd"><td>grails.project.web.xml</td><td>The location to generate Grails' web.xml to</td></tr></table>
</div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>名前</th><th>説明</th></tr><tr class="table-odd"><td>grails.server.port.http</td><td>組み込みのサーブレットコンテナを実行するポート番号。（"run-app" と "run-war"）</td></tr><tr class="table-even"><td>grails.server.port.https</td><td>HTTPS用の組み込みのサーブレットコンテナを実行するポート番号。（"run-app &#45;&#45;https"と"run-war &#45;&#45;https"）</td></tr><tr class="table-odd"><td>grails.config.base.webXml</td><td>アプリケーションで使用するカスタムのweb.xmlファイルへのパス。（web.xmlテンプレートを使用しない場合）</td></tr><tr class="table-even"><td>grails.compiler.dependencies</td><td>コンパイラのクラスパスに依存関係を追加する。"fileset()"を含んでいるクロージャに設定。</td></tr><tr class="table-odd"><td>grails.testing.patterns</td><td>テストに含まれるファイルを制御するためのAntパスのパターンリスト。パターンは、次のgrails.testing.nameSuffixに設定されているテストケースのサフィックス以外。</td></tr><tr class="table-even"><td>grails.testing.nameSuffix</td><td>デフォルトでは、テストは"Tests"のサフィックスが設定されていますが、好きなようにオプション設定を変更することができます。</td></tr><tr class="table-odd"><td>grails.project.war.file</td><td>生成されるWARファイルの名称（拡張子を含む）のファイルパス。例として、"target/my-app.war" 等。</td></tr><tr class="table-even"><td>grails.war.dependencies</td><td>WARファイルの"WEB-INF/lib"階層に含む内容を、クロージャ内の"fileset()"でコントロール。</td></tr><tr class="table-odd"><td>grails.war.copyToWebApp</td><td>WARのルートディレクトリ階層に含む内容を、クロージャ内の"fileset()"でコントロール。</td></tr><tr class="table-even"><td>grails.war.resources</td><td>最初の引数としてステージングディレクトリの場所を受け取れるクロージャを指定。クロージャ内でAntタスクを使用することで、WAR化される前にステージングディレクトリの内容を変更する事ができます。</td></tr><tr class="table-odd"><td>grails.project.web.xml</td><td>Grailsがweb.xmlを生成する場所の指定。</td></tr></table><p class="paragraph"/><h3>リローディングエージェントキャッシュディレクトリ<div class="hidden-block">Reloading Agent Cache Directory</div></h3><p class="paragraph"/>Grails uses an agent based reloading system in the development environment that allows source code changes to be picked up while the application is running.  This reloading agent caches information needed to carry out the reloading efficiently.  By default this information is stored under <code>&#60;USER_HOME_DIR&#62;&#47;.grails&#47;.slcache&#47;</code>.  The <code>GRAILS_AGENT_CACHE_DIR</code> environment variable may be assigned a value to cause this cache information to be stored somewhere else.  Note that this is an operating system environment variable, not a JVM system property or a property which may be defined in <code>BuildConfig.groovy</code>.  This setting must be defined as an environment variable because the agent cache directory must be configured very early in the JVM startup process, before any Grails code is executed.


<a name="4.5 Ant and Maven"><!-- Legacy link --></a>
<h2 id="antAndMaven">5.7 AntとMaven</h2>
<div class="hidden-block">If all the other projects in your team or company are built using a standard build tool such as Ant or Maven, you become the black sheep of the family when you use the Grails command line to build your application. Fortunately, you can easily integrate the Grails build system into the main build tools in use today (well, the ones in use in Java projects at least).</div>
もし、あなたのプロジェクトチームや会社でAntやMavenなどのような標準的なビルドツールを利用している場合は、アプリケーションをビルドする時にGrailsのコマンドラインを使っていると一家の厄介者にされてしまいます。幸いなことに、Grailsビルドシステムは今日使われている主なビルドツールに簡単に統合することができます。（少なくともJavaプロジェクトで使用されているものへ）<p class="paragraph"/><h3>Antへの統合 <div class="hidden-block">Ant Integration </div></h3><p class="paragraph"/><div class="hidden-block">When you create a Grails application with the <a href="../ref/Command Line/create-app.html" class="commandLine">create-app</a> command, Grails doesn't automatically create an Ant <code>build.xml</code> file but you can generate one with the <a href="../ref/Command Line/integrate-with.html" class="commandLine">integrate-with</a> command:</div>
<a href="../ref/Command Line/create-app.html" class="commandLine">create-app</a>コマンドでGrailsアプリケーションを作成した際に、Grailsは自動的にはApache Antの<code>build.xml</code>を生成しません。<a href="../ref/Command Line/integrate-with.html" class="commandLine">integrate-with</a>コマンドを使用して生成することが可能です。<p class="paragraph"/><pre class="bq"><code>
grails integrate-with --ant</code></pre><p class="paragraph"/><div class="hidden-block">This creates a <code>build.xml</code> file containing the following targets:</div>
作成された<code>build.xml</code>ファイルには、次のターゲットが含まれています:
<div class="hidden-block">
<ul class="star">
<li><code>clean</code> - Cleans the Grails application</li>
<li><code>compile</code> - Compiles your application's source code</li>
<li><code>test</code> - Runs the unit tests</li>
<li><code>run</code> - Equivalent to "grails run-app"</li>
<li><code>war</code> - Creates a WAR file</li>
<li><code>deploy</code> - Empty by default, but can be used to implement automatic deployment</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>clean</code> - Grailsアプリケーションをクリーンします。</li>
<li><code>compile</code> - アプリケーションのソースコードをコンパイルします。</li>
<li><code>test</code> - ユニットテストを実行します。</li>
<li><code>run</code> - Grailsの"run-app"コマンド相当を実行します。</li>
<li><code>war</code> - WARファイルを作成します。</li>
<li><code>deploy</code> - デフォルトでは空ですが、自動配備を実装することができます。</li>
</ul><p class="paragraph"/><div class="hidden-block">Each of these can be run by Ant, for example:</div>
これらは例えば、以下のようなAntコマンドで実行できます。<p class="paragraph"/><div class="code"><pre>ant war</pre></div><p class="paragraph"/><div class="hidden-block">The build file is configured to use <a href="http://ant.apache.org/ivy/" target="blank">Apache Ivy</a> for dependency management, which means that it will automatically download all the requisite Grails JAR files and other dependencies on demand. You don't even have to install Grails locally to use it! That makes it particularly useful for continuous integration systems such as <a href="http://cruisecontrol.sourceforge.net/" target="blank">CruiseControl</a> or <a href="http://jenkins-ci.org/" target="blank">Jenkins</a>.</div>
ビルドファイルは <a href="http://ant.apache.org/ivy/" target="blank">Apache Ivy</a> をの依存性管理を使う準備ができています。必要に応じてGrailsが利用したり、またはそれ以外で利用される依存関係のあるJARファイルを自動的にダウンロードしてくることができるということです。それを使うにはローカルにGrailsをインストールする必要すらありません！<a href="http://cruisecontrol.sourceforge.net/" target="blank">CruiseControl</a>や<a href="http://jenkins-ci.org/" target="blank">Jenkins</a>のような継続的インテグレーションツールを使う場合、特に便利でしょう。<p class="paragraph"/><div class="hidden-block">It uses the Grails <a href="http://grails.org/doc/latest/api/grails/ant/GrailsTask.html" class="api">Ant task</a> to hook into the existing Grails build system. The task lets you run any Grails script that's available, not just the ones used by the generated build file. To use the task, you must first declare it:</div>
これはGrailsの<a href="http://grails.org/doc/latest/api/grails/ant/GrailsTask.html" class="api">Antタスク</a>を既存のGrailsビルドシステムにフックします。タスクは、Grailsの生成されたビルドファイル以外の利用可能なスクリプトの実行を許可されています。タスクを使用するには、まずこう宣言します。
<div class="code"><pre>&#60;taskdef name=<span class="java&#45;quote">"grailsTask"</span>
         classname=<span class="java&#45;quote">"grails.ant.GrailsTask"</span>
         classpathref=<span class="java&#45;quote">"grails.classpath"</span>/&#62;</pre></div><p class="paragraph"/><div class="hidden-block">This raises the question: what should be in "grails.classpath"? The task itself is in the "grails-bootstrap" JAR artifact, so that needs to be on the classpath at least. You should also include the "groovy-all" JAR. With the task defined, you just need to use it! The following table shows you what attributes are available:</div>
ここで疑問が生じます。どれが"grails.classpath"でしょうか。タスク自体は"grails-bootstrap"JARの一部です。なので、少なくともクラスパス上にある必要があります。また、"groovy-all" JARを含める必要があります。タスク宣言ではこれらを仕使用する必要があります！次の表は、どんな属性が利用可能かを示しています。
<div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Attribute</th><th>Description</th><th>Required</th></tr><tr class="table-odd"><td>home</td><td>The location of the Grails installation directory to use for the build.</td><td>Yes, unless classpath is specified.</td></tr><tr class="table-even"><td>classpathref</td><td>Classpath to load Grails from. Must include the "grails-bootstrap" artifact and should include "grails-scripts".</td><td>Yes, unless <code>home</code> is set or you use a <code>classpath</code> element.</td></tr><tr class="table-odd"><td>script</td><td>The name of the Grails script to run, e.g. "TestApp".</td><td>Yes.</td></tr><tr class="table-even"><td>args</td><td>The arguments to pass to the script, e.g. "-unit -xml".</td><td>No. Defaults to "".</td></tr><tr class="table-odd"><td>environment</td><td>The Grails environment to run the script in.</td><td>No. Defaults to the script default.</td></tr><tr class="table-even"><td>includeRuntimeClasspath</td><td>Advanced setting: adds the application's runtime classpath to the build classpath if true.</td><td>No. Defaults to <code>true</code>.</td></tr></table>
</div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>属性</th><th>説明</th><th>必須</th></tr><tr class="table-odd"><td>home</td><td>ビルドに使用するGrailsのインストールディレクトリの場所。</td><td>パスが指定されている場合を除き必須です。</td></tr><tr class="table-even"><td>classpathref</td><td>Grailsがロードする基点となるクラスパス。"grails-bootstrap"を含めなければなりません。また、"grails-scripts"を含めるべきです。</td><td><code>home</code>が設定されていなかったり、<code>classpath</code>要素を使う場合は必須です。</td></tr><tr class="table-odd"><td>script</td><td>Grailsスクリプトの実行名。例えば "TestApp"。</td><td>必須です。</td></tr><tr class="table-even"><td>args</td><td>スクリプトに渡す引数。例えば "-unix -xml"。</td><td>必須ではありません。デフォルトは "" です。</td></tr><tr class="table-odd"><td>environment</td><td>スクリプト実行時のGrails環境変数。</td><td>必須ではありません。デフォルトはスクリプトのデフォルトになります。</td></tr><tr class="table-even"><td>includeRuntimeClasspath</td><td>高度な設定です。 trueの場合、アプリケーション実行時クラスパスをクラスパスに追加します。</td><td>必須ではありません。 デフォルトは<code>true</code>です。</td></tr></table><p class="paragraph"/><div class="hidden-block">The task also supports the following nested elements, all of which are standard Ant path structures:</div>
タスクネスト要素をサポートします。こられの全ては標準的なAntの構造となっています。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>classpath</code> - The build classpath (used to load Gant and the Grails scripts).</li>
<li><code>compileClasspath</code> - Classpath used to compile the application's classes.</li>
<li><code>runtimeClasspath</code> - Classpath used to run the application and package the WAR. Typically includes everything in @compileClasspath.</li>
<li><code>testClasspath</code> - Classpath used to compile and run the tests. Typically includes everything in <code>runtimeClasspath</code>.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>classpath</code> - ビルド時のクラスパス。（GantとGrailsスクリプトロード時に使用）</li>
<li><code>compileClasspath</code> - アプリケーションコンパイル時のクラスパス。</li>
<li><code>runtimeClasspath</code> - アプリケーションとWARパッケージ実行時のクラスパス。通常<code>compileClasspath</code>に全てが含まれます。</li>
<li><code>testClasspath</code> - コンパイル時と、テスト実行時のクラスパス。通常<code>runtimeClasspath</code>に全てが含まれます。</li>
</ul><p class="paragraph"/><div class="hidden-block">How you populate these paths is up to you. If you use the <code>home</code> attribute and put your own dependencies in the <code>lib</code> directory, then you don't even need to use any of them. For an example of their use, take a look at the generated Ant build file for new apps.</div>
どうやってパスを追加するかはあなた次第です。もし、<code>home</code>を利用しており、自分自身の依存関係を<code>lib</code>ディレクトリに設定している場合は、これらを使う必要はありません。こららの利用例としては、生成された新しいアプリケーションのAntビルドファイルを見てみましょう。<p class="paragraph"/><h3>Maven統合 <div class="hidden-block">Maven Integration</div></h3><p class="paragraph"/><div class="hidden-block">Grails provides integration with <a href="http://maven.apache.org" target="blank">Maven 2</a> with a Maven plugin. </div>
GrailsはMavenプラグインを介して Maven 2":http://maven.apache.org との統合を提供しています。<p class="paragraph"/><h4>準備 <div class="hidden-block">Preparation </div></h4><p class="paragraph"/><div class="hidden-block">In order to use the Maven plugin, all you need is Maven 2 installed and set up. This is because <strong class="bold">you no longer need to install Grails separately to use it with Maven!</strong></div>
Mavenプラグインを使用するにあたって必要な手順は、Maven2をインストールし設定するだけです。<strong class="bold">MavenでGrailsを使用する場合、使用方法によっては別途Grailsをインストールする必要がありません。</strong><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">The Maven 2 integration for Grails has been designed and tested for Maven 2.0.9 and above. It will not work with earlier versions.</div>
GrailsのMaven2統合は、Maven 2.0.9以上を対象として設計・テストされています。それ以前のバージョンでは動作しません。
</blockquote><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">The default mvn setup DOES NOT supply sufficient memory to run the Grails environment. We recommend that you add the following environment variable setting to prevent poor performance:</div>
既定のmvnコマンド設定ではGrails環境で実行するための十分なメモリを供給できません。パフォーマンス低下を防止するため、次の環境変数を追加することをお勧めします:<p class="paragraph"/><code>export MAVEN_OPTS="-Xmx512m -XX:MaxPermSize=256"</code>
</blockquote><p class="paragraph"/><h4>GrailsのMavenのプロジェクトを作成する <div class="hidden-block">Creating a Grails Maven Project </div></h4><p class="paragraph"/><div class="hidden-block">Using the <code>create-pom</code> command you can generate a valid Maven <code>pom.xml</code> file for any existing Grails project. The below presents an example:</div>
<code>create-pom</code> コマンドを使用することで、既存のGrailsプロジェクトに対して、Mavenの <code>pom.xml</code> を作成する事ができます。次のように実行します:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;app myapp
$ cd myapp
$ grails create&#45;pom com.mycompany</pre></div><p class="paragraph"/><div class="hidden-block">The <code>create-pom</code> command expects a group id as an argument. The name and the version are taken from the <code>application.properties</code> of the application. The Maven plugin will keep the version in the <code>pom.xml</code> in sync with the version in <code>application.properties</code>.</div>
<code>create-pom</code> コマンドには引数としてグループIDを指定することができます。バージョン番号は、アプリケーションの <code>application.properties</code> から取得します。 Mavenプラグインは、常に <code>pom.xml</code> のバージョンと <code>application.properties</code> のバージョンを同期します。<p class="paragraph"/><div class="hidden-block">The following standard Maven commands are then possible:</div>
以下のMaven標準コマンドが使用可能です:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>compile</code> - Compiles a Grails project</li>
<li><code>package</code> - Builds a WAR file from the Grails project.</li>
<li><code>install</code> - Builds a WAR file (or plugin zip/jar if a plugin) and installs it into your local Maven cache</li>
<li><code>test</code> - Runs the tests of a Grails project</li>
<li><code>clean</code> - Cleans the Grails project</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>compile</code> - Grailsプロジェクトをコンパイル</li>
<li><code>package</code> - GrailsプロジェクトのWARファイルをビルドする</li>
<li><code>install</code> - WARファイル(又はプラグインの場合はZIPかJAR)をビルドしてMavenローカルキャッシュにインストールします</li>
<li><code>test</code> - Grailsプロジェクトのテストを実行します</li>
<li><code>clean</code> - Grailsプロジェクトをクリーンします</li>
</ul><p class="paragraph"/><div class="hidden-block">Other standard Maven commands will likely work too.</div>
その他のMaven標準コマンドも動作します。<p class="paragraph"/><div class="hidden-block">You can also use some of the Grails commands that have been wrapped as Maven goals:</div>
さらに、一部のGrailsコマンドもMavenゴールとしてラップされています:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>grails:create-controller</code> - Calls the <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a> command</li>
<li><code>grails:create-domain-class</code> - Calls the <a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a> command</li>
<li><code>grails:create-integration-test</code> - Calls the <a href="../ref/Command Line/create-integration-test.html" class="commandLine">create-integration-test</a> command</li>
<li><code>grails:create-pom</code> - Creates a new Maven POM for an existing Grails project</li>
<li><code>grails:create-script</code> - Calls the <a href="../ref/Command Line/create-script.html" class="commandLine">create-script</a> command</li>
<li><code>grails:create-service</code> - Calls the <a href="../ref/Command Line/create-service.html" class="commandLine">create-service</a> command</li>
<li><code>grails:create-taglib</code> - Calls the <a href="../ref/Command Line/create-tag-lib.html" class="commandLine">create-tag-lib</a> command</li>
<li><code>grails:create-unit-test</code> - Calls the <a href="../ref/Command Line/create-unit-test.html" class="commandLine">create-unit-test</a> command</li>
<li><code>grails:exec</code> - Executes an arbitrary Grails command line script</li>
<li><code>grails:generate-all</code> - Calls the <a href="../ref/Command Line/generate-all.html" class="commandLine">generate-all</a> command</li>
<li><code>grails:generate-controller</code>  - Calls the <a href="../ref/Command Line/generate-controller.html" class="commandLine">generate-controller</a> command</li>
<li><code>grails:generate-views</code> - Calls the <a href="../ref/Command Line/generate-views.html" class="commandLine">generate-views</a> command</li>
<li><code>grails:install-templates</code> - Calls the <a href="../ref/Command Line/install-templates.html" class="commandLine">install-templates</a> command</li>
<li><code>grails:list-plugins</code> - Calls the <a href="../ref/Command Line/list-plugins.html" class="commandLine">list-plugins</a> command</li>
<li><code>grails:package</code> - Calls the <a href="../ref/Command Line/package.html" class="commandLine">package</a> command</li>
<li><code>grails:run-app</code> - Calls the <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a> command</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>grails:create-controller</code> - <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a>コマンドを呼び出します</li>
<li><code>grails:create-domain-class</code> - <a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a>コマンドを呼び出します</li>
<li><code>grails:create-integration-test</code> - <a href="../ref/Command Line/create-integration-test.html" class="commandLine">create-integration-test</a>コマンドを呼び出します</li>
<li><code>grails:create-pom</code> - 既存のGrailsプロジェクトにMaven POMを新規作成します</li>
<li><code>grails:create-script</code> - <a href="../ref/Command Line/create-script.html" class="commandLine">create-script</a>コマンドを呼び出します</li>
<li><code>grails:create-service</code> - <a href="../ref/Command Line/create-service.html" class="commandLine">create-service</a>コマンドを呼び出します</li>
<li><code>grails:create-taglib</code> - <a href="../ref/Command Line/create-tag-lib.html" class="commandLine">create-tag-lib</a>コマンドを呼び出します</li>
<li><code>grails:create-unit-test</code> - <a href="../ref/Command Line/create-unit-test.html" class="commandLine">create-unit-test</a>コマンドを呼び出します</li>
<li><code>grails:exec</code> - 任意のGrailsコマンドラインスクリプトを実行します</li>
<li><code>grails:generate-all</code> - <a href="../ref/Command Line/generate-all.html" class="commandLine">generate-all</a>コマンドを呼び出します</li>
<li><code>grails:generate-controller</code>  - <a href="../ref/Command Line/generate-controller.html" class="commandLine">generate-controller</a>コマンドを呼び出します</li>
<li><code>grails:generate-views</code> - <a href="../ref/Command Line/generate-views.html" class="commandLine">generate-views</a>コマンドを呼び出します</li>
<li><code>grails:install-templates</code> - <a href="../ref/Command Line/install-templates.html" class="commandLine">install-templates</a>コマンドを呼び出します</li>
<li><code>grails:list-plugins</code> - <a href="../ref/Command Line/list-plugins.html" class="commandLine">list-plugins</a>コマンドを呼び出します</li>
<li><code>grails:package</code> - <a href="../ref/Command Line/package.html" class="commandLine">package</a>コマンドを呼び出します</li>
<li><code>grails:run-app</code> - <a href="../ref/Command Line/run-app.html" class="commandLine">run-app</a>コマンドを呼び出します</li>
</ul><p class="paragraph"/><div class="hidden-block">For a complete, up to date list, run <code>mvn grails:help</code></div>
最新のリストを見るには、 <code>mvn grails:help</code> を実行してください。<p class="paragraph"/><h4>Archetypeを使用したGrails Mavenプロジェクトの作成 <div class="hidden-block">Creating a Grails Maven Project using the Archetype</div></h4><p class="paragraph"/><div class="hidden-block">You can create a Maven Grails project without having Grails installed, simply run the following command:</div>
Grailsのインストール無しでMaven Grailsプロジェクトの作成が可能です。次のコマンドを実行します:<p class="paragraph"/>
<div class="code"><pre>mvn archetype:generate &#45;DarchetypeGroupId=org.grails &#92;
    &#45;DarchetypeArtifactId=grails&#45;maven&#45;archetype &#92;
    &#45;DarchetypeVersion=2.1.0.RC1 &#92;
    &#45;DgroupId=example &#45;DartifactId=my&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">Choose whichever grails version, group ID and artifact ID you want for your application, but everything else must be as written. This will create a new Maven project with a POM and a couple of other files. What you won't see is anything that looks like a Grails application. So, the next step is to create the project structure that you're used to.</div>
アプリケーションで使用するGrailsバージョン、グループID、アーティファクトIDを指定するだけで必要な内容が書き込まれます。このコマンドで新規にMavenプロジェクトのPOMと他のファイルが生成されます。生成された内容を見るとGrailsアプリケーションで必要なものが見つかりません。次のステップでいつも通りの物が出来上がります。
<div class="hidden-block">But first, to set target JDK to Java 6, do that now. Open my-app/pom.xml and change </div>
はじめに、ターゲットJDKをJava 6にセットします。my-app/pom.xmlを開いて、次のように変更します:<p class="paragraph"/><div class="code"><pre>&#60;plugin&#62;
  &#60;artifactId&#62;maven&#45;compiler&#45;plugin&#60;/artifactId&#62;
  &#60;configuration&#62;
    &#60;source&#62;1.5&#60;/source&#62;
    &#60;target&#62;1.5&#60;/target&#62;
  &#60;/configuration&#62;
&#60;/plugin&#62;</pre></div>
<div class="hidden-block">to </div>
上記を、以下のように変更します。
<div class="code"><pre>&#60;plugin&#62;
  &#60;artifactId&#62;maven&#45;compiler&#45;plugin&#60;/artifactId&#62;
  &#60;configuration&#62;
    &#60;source&#62;1.6&#60;/source&#62;
    &#60;target&#62;1.6&#60;/target&#62;
  &#60;/configuration&#62;
&#60;/plugin&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Then you're ready to create the project structure:</div>
これでプロジェクト構造を作成する環境が整いました。<p class="paragraph"/><div class="code"><pre>cd my&#45;app
mvn initialize</pre></div><p class="paragraph"/><h4>プラグイン依存を定義する <div class="hidden-block">Defining Plugin Dependencies</div></h4><p class="paragraph"/>All Grails plugins are published to a standard Maven repository located at <a href="http://repo.grails.org/grails/plugins/" target="blank"></a>. When using the Maven plugin for Grails you must ensure that this repository is declared in your list of remote repositories:
全ての公式Grailsプラグインは、<a href="http://repo.grails.org/grails/plugins/" target="blank"></a>のMavenリポジトリに公開されています。Mavenプラグインを使用する場合は、リモートリポジトリの定義にリポジトリが追加されている必要があります。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;repository&#62;</span>
    <span class="xml&#45;tag">&#60;id&#62;</span>grails&#45;plugins<span class="xml&#45;tag">&#60;/id&#62;</span>
    <span class="xml&#45;tag">&#60;name&#62;</span>grails&#45;plugins<span class="xml&#45;tag">&#60;/name&#62;</span>
    <span class="xml&#45;tag">&#60;url&#62;</span>http://repo.grails.org/grails/plugins<span class="xml&#45;tag">&#60;/url&#62;</span>
<span class="xml&#45;tag">&#60;/repository&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">With this done you can declare plugin dependencies within your <code>pom.xml</code> file:</div>
この設定が完了したら、 <code>pom.xml</code> ファイルに、プラグイン依存定義を行います:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;dependency&#62;</span>
    <span class="xml&#45;tag">&#60;groupId&#62;</span>org.grails.plugins<span class="xml&#45;tag">&#60;/groupId&#62;</span>
    <span class="xml&#45;tag">&#60;artifactId&#62;</span>database&#45;migration<span class="xml&#45;tag">&#60;/artifactId&#62;</span>
    <span class="xml&#45;tag">&#60;version&#62;</span>1.1<span class="xml&#45;tag">&#60;/version&#62;</span>
    <span class="xml&#45;tag">&#60;scope&#62;</span>runtime<span class="xml&#45;tag">&#60;/scope&#62;</span>
    <span class="xml&#45;tag">&#60;type&#62;</span>zip<span class="xml&#45;tag">&#60;/type&#62;</span>
<span class="xml&#45;tag">&#60;/dependency&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Note that the <code>type</code> element must be set to <code>zip</code>.</div>
注意点としては、 <code>type</code> エレメントの定義は <code>zip</code> となる部分です。<p class="paragraph"/><h4>Grailsフォーク実行 <div class="hidden-block">Forked Grails Execution</div></h4><p class="paragraph"/>By default the Maven plugin will run Grails commands in-process, meaning that the Grails process occupies the same JVM as the Maven process. This can put strain on the Maven process for particularly large applications.<p class="paragraph"/>In this case it is recommended to use forked execution. Forked execution can be configured in the <code>configuration</code> element of the plugin:<p class="paragraph"/><div class="code"><pre>&#60;plugin&#62;
    &#60;groupId&#62;org.grails&#60;/groupId&#62;
    &#60;artifactId&#62;grails&#45;maven&#45;plugin&#60;/artifactId&#62;
    &#60;version&#62;$&#123;grails.version&#125;&#60;/version&#62;
    &#60;configuration&#62;
        &#60;!&#45;&#45; Whether <span class="java&#45;keyword">for</span> Fork a JVM to run Grails commands &#45;&#45;&#62;
        &#60;fork&#62;<span class="java&#45;keyword">true</span>&#60;/fork&#62;
    &#60;/configuration&#62;
    &#60;extensions&#62;<span class="java&#45;keyword">true</span>&#60;/extensions&#62;
&#60;/plugin&#62;</pre></div><p class="paragraph"/>With this configuration in place a separate JVM will be forked when running Grails commands. If you wish to debug the JVM that is forked you can add the <code>forkDebug</code> element:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;comment">&#60;!&#45;&#45; Whether for Fork a JVM to run Grails commands &#45;&#45;&#62;</span>
    <span class="xml&#45;tag">&#60;fork&#62;</span>true<span class="xml&#45;tag">&#60;/fork&#62;</span>
    <span class="xml&#45;tag">&#60;forkDebug&#62;</span>true<span class="xml&#45;tag">&#60;/forkDebug&#62;</span></pre></div><p class="paragraph"/>If you need to customize the memory of the forked process the following elements are available:
<ul class="star">
<li><code>forkMaxMemory</code> - The maximum amount of heap (default 1024)</li>
<li><code>forkMinMemory</code> - The minimum amount of heap (default 512)</li>
<li><code>forkPermGen</code> - The amount of permgen (default 256)</li>
</ul><p class="paragraph"/><h4>Multi Module Maven Builds</h4><p class="paragraph"/>The Maven plugin can be used to power multi-module Grails builds. The easiest way to set this is up is with the <code>create-multi-project-build</code> command:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;app myapp
$ grails create&#45;plugin plugin1
$ grails create&#45;plugin plugin2
$ grails create&#45;multi&#45;project&#45;build org.mycompany:parent:1.0</pre></div><p class="paragraph"/>Running <code>mvn install</code> will build all projects together. To enable the 'grails' command to read the POMs you can modify <code>BuildConfig.groovy</code> to use the POM and resolve dependencies from your Maven local cache:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    &#8230;
    pom <span class="java&#45;keyword">true</span>
    repositories &#123;
        &#8230;
        mavenLocal()    
    &#125;
&#125;</pre></div><p class="paragraph"/>By reading the <code>pom.xml</code> file you can do an initial <code>mvn install</code> from the parent project to build all plugins and install them into your local maven cache and then <code>cd</code> into your project and use the regular <code>grails run-app</code> command to run your application. All previously built plugins will be resolved from the local Maven cache.<p class="paragraph"/><h4>Grailsコマンドをフェーズに追加する <div class="hidden-block">Adding Grails commands to phases </div></h4><p class="paragraph"/><div class="hidden-block">The standard POM created for you by Grails already attaches the appropriate core Grails commands to their corresponding build phases, so "compile" goes in the "compile" phase and "war" goes in the "package" phase. That doesn't help though when you want to attach a plugin's command to a particular phase. The classic example is functional tests. How do you make sure that your functional tests (using which ever plugin you have decided on) are run during the "integration-test" phase?</div>
Grailsが作成した標準のPOMファイルは、Grailsのビルドフェーズに対応したコアコマンドに適切に付属しています。"compile" は "compile"フェーズに、"war" は "package"フェーズに。特定のフェーズにプラグインコマンドを付属させたい場合には役立ちません。古典的な例は、ファンクショナルテストです。どうやってファンクショナルテストが統合テストフェーズの間に（あなた使用しているどんなプラグインを使った場合でも）実行されるのかを確かめるのでしょうか？<p class="paragraph"/><div class="hidden-block">Fear not: all things are possible. In this case, you can associate the command to a phase using an extra "execution" block:</div>
恐れる必要はありません、すべて可能です。この場合には、"execution"ブロックを追加してフェーズに関連付けることができます。
<div class="code"><pre><span class="xml&#45;tag">&#60;plugin&#62;</span>
    <span class="xml&#45;tag">&#60;groupId&#62;</span>org.grails<span class="xml&#45;tag">&#60;/groupId&#62;</span>
    <span class="xml&#45;tag">&#60;artifactId&#62;</span>grails&#45;maven&#45;plugin<span class="xml&#45;tag">&#60;/artifactId&#62;</span>
    <span class="xml&#45;tag">&#60;version&#62;</span>2.1.0.RC2<span class="xml&#45;tag">&#60;/version&#62;</span>
    <span class="xml&#45;tag">&#60;extensions&#62;</span>true<span class="xml&#45;tag">&#60;/extensions&#62;</span>
    <span class="xml&#45;tag">&#60;executions&#62;</span>
        <span class="xml&#45;tag">&#60;execution&#62;</span>
            <span class="xml&#45;tag">&#60;goals&#62;</span>
            &#8230;
            <span class="xml&#45;tag">&#60;/goals&#62;</span>
        <span class="xml&#45;tag">&#60;/execution&#62;</span>
        <span class="xml&#45;comment">&#60;!&#45;&#45; Add the <span class="xml&#45;quote">"functional&#45;tests"</span> command to the <span class="xml&#45;quote">"integration&#45;test"</span> phase &#45;&#45;&#62;</span>
        <span class="xml&#45;tag">&#60;execution&#62;</span>
            <span class="xml&#45;tag">&#60;id&#62;</span>functional&#45;tests<span class="xml&#45;tag">&#60;/id&#62;</span>
            <span class="xml&#45;tag">&#60;phase&#62;</span>integration&#45;test<span class="xml&#45;tag">&#60;/phase&#62;</span>
            <span class="xml&#45;tag">&#60;goals&#62;</span>
                <span class="xml&#45;tag">&#60;goal&#62;</span>exec<span class="xml&#45;tag">&#60;/goal&#62;</span>
            <span class="xml&#45;tag">&#60;/goals&#62;</span>
            <span class="xml&#45;tag">&#60;configuration&#62;</span>
                <span class="xml&#45;tag">&#60;command&#62;</span>functional&#45;tests<span class="xml&#45;tag">&#60;/command&#62;</span>
            <span class="xml&#45;tag">&#60;/configuration&#62;</span>
        <span class="xml&#45;tag">&#60;/execution&#62;</span>
    <span class="xml&#45;tag">&#60;/executions&#62;</span>
<span class="xml&#45;tag">&#60;/plugin&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This also demonstrates the <code>grails:exec</code> goal, which can be used to run any Grails command. Simply pass the name of the command as the <code>command</code> system property, and optionally specify the arguments with the <code>args</code> property:</div>
またこれは <code>grails:exec</code> goal の実演にもなっています。Grailsのどんなコマンドも実行できるのです。単にコマンド名を渡す<code>command</code>システムプロパティと、オプションで引数を渡す<code>args</code>プロパティがあります:<p class="paragraph"/><div class="code"><pre>mvn grails:exec &#45;Dcommand=create&#45;webtest &#45;Dargs=Book</pre></div><p class="paragraph"/><h4>GrailsのMavenプロジェクトのデバッグ <div class="hidden-block">Debugging a Grails Maven Project </div></h4><p class="paragraph"/><div class="hidden-block">Maven can be launched in debug mode using the "mvnDebug" command. To launch your Grails application in debug, simply run:</div>
Mavenは "mvnDebug" コマンドを使用して、デバッグモードで起動することができます。デバッグでGrailsアプリケーションを起動するには、単純に以下のコマンドを実行します:<p class="paragraph"/><div class="code"><pre>mvnDebug grails:run&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">The process will be suspended on startup and listening for a debugger on port 8000.</div>
プロセスは起動時に停止して、デバッガをポート8000上で待ち受けます。<p class="paragraph"/><div class="hidden-block">If you need more control of the debugger, this can be specified using the MAVEN_OPTS environment variable, and launch Maven with the default "mvn" command:</div>
デバッガのより詳細に制御する必要がある場合は、環境変数のMAVEN_OPTSを指定して標準の "mvn" コマンドを使用してMavenを起動させます。<p class="paragraph"/><div class="code"><pre>MAVEN_OPTS=<span class="java&#45;quote">"&#45;Xdebug &#45;Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"</span>
mvn grails:run&#45;app</pre></div><p class="paragraph"/><h4>問題提起 <div class="hidden-block">Raising issues </div></h4><p class="paragraph"/><div class="hidden-block">If you come across any problems with the Maven integration, please raise a <a href="http://jira.grails.org/browse/MAVEN" target="blank">JIRA issue</a>.</div>
Maven統合を使っている際になにか問題に直面した場合、<a href="http://jira.grails.org/browse/MAVEN" target="blank">JIRA issue</a>に問題を提起して下さい。



<h2 id="wrapper">5.8 Grailsラッパー</h2>
The Grails Wrapper allows a Grails application to built without having to install Grails and configure a GRAILS_HOME environment variable.  The wrapper includes a small shell script and a couple of small bootstrap jar files that typically would be checked in to source code control along with the rest of the project.  The first time the wrapper is executed it will download and configure a Grails installation.  This wrapper makes it more simple to setup a development environment, configure CI and manage upgrades to future versions of Grails.  When the application is upgraded to the next version of Grails, the wrapper is updated and checked in to the source code control system and the next time developers update their workspace and run the wrapper, they will automatically be using the correct version of Grails.<p class="paragraph"/><h4>Generating The Wrapper</h4><p class="paragraph"/>The <a href="../ref/Command Line/wrapper.html" class="commandLine">wrapper</a> command can be used to generate the wrapper shell scripts and supporting jar files.  Execute the wrapper command at the top of an existing Grails project.<p class="paragraph"/><div class="code"><pre>grails wrapper</pre></div><p class="paragraph"/>In order to do this of course Grails must be installed and configured.  This is only a requirement for bootstrapping the wrapper.  Once the wrapper is generated there is no need to have a Grails installation configured in order to use the wrapper.<p class="paragraph"/>See the <a href="../ref/Command Line/wrapper.html" class="commandLine">wrapper</a> command documentation for details about command line arguments.<p class="paragraph"/>By default the wrapper command will generate a <code>grailsw</code> shell script and <code>grailsw.bat</code> batch file at the top of the project.  In addition to those, a <code>wrapper/</code> directory (the name of the directory is configurable via command line options) is generated which contains some support files which are necessary to run the wrapper.  All of these files should be checked into the source code control system along with the rest of the project.  This allows developers to check the project out of source code control and immediately start using the wrapper to execute Grails commands without having to install and configure Grails.<p class="paragraph"/><h4>Using The Wrapper</h4><p class="paragraph"/>The wrapper script accepts all of the same arguments as the normal grails command.<p class="paragraph"/><div class="code"><pre>./grailsw create&#45;domain&#45;class com.demo.Person
./grailsw run&#45;app
./grailsw test&#45;app unit:<p class="paragraph"/>etc...</pre></div>


<a name="5. Object Relational Mapping (GORM)"><!-- Legacy link --></a>
<h1 id="GORM">6 O/Rマッピング (GORM)</h1>
<div class="hidden-block">Domain classes are core to any business application. They hold state about business processes and hopefully also implement behavior. They are linked together through relationships; one-to-one, one-to-many, or many-to-many.</div><p class="paragraph"/>ドメインクラスは業務アプリケーションの中心です。
それらは業務プロセスについての状態や振る舞いを保持します。
また、それらは1対1、1対多、多対多などの関連を通して結びつけられます。<p class="paragraph"/><div class="hidden-block">GORM is Grails' object relational mapping (ORM) implementation. Under the hood it uses Hibernate 3 (a very popular and flexible open source ORM solution) and thanks to the dynamic nature of Groovy with its static and dynamic typing, along with the convention of Grails, there is far less configuration involved in creating Grails domain classes.</div><p class="paragraph"/>GORMは、Grailsのオブジェクトリレーショナルマッピング(ORM)の実装です。
その裏では、広く使われていて柔軟性の高いオープンソースORMであるHibernate 3を利用しています。
Grailsの規約と、静的・動的型付けというGroovyのダイナミックな特性のおかげで、Grailsのドメインクラスに必要となる設定はほとんどありません。<p class="paragraph"/><div class="hidden-block">You can also write Grails domain classes in Java. See the section on Hibernate Integration for how to write domain classes in Java but still use dynamic persistent methods. Below is a preview of GORM in action:</div><p class="paragraph"/>GrailsのドメインクラスをJavaで書くこともできます。
Javaでドメインクラスを書いて、動的な永続化メソッドも使えるようにする方法については、<a href="../guide/single.html#hibernate" class="guide">GrailsとHibernate</a>のセクションを参照してください。<p class="paragraph"/>以下は、GORMのサンプルコードです:
<div class="code"><pre>def book = Book.findByTitle(<span class="java&#45;quote">"Groovy in Action"</span>)<p class="paragraph"/>book
  .addToAuthors(name:<span class="java&#45;quote">"Dierk Koenig"</span>)
  .addToAuthors(name:<span class="java&#45;quote">"Guillaume LaForge"</span>)
  .save()</pre></div>


<a name="5.1 Quick Start Guide"><!-- Legacy link --></a>
<h2 id="quickStartGuide">6.1 クイックスタートガイド</h2>
<div class="hidden-block">A domain class can be created with the <a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a> command:</div>
以下のように<a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a>コマンドでドメインクラスを作成できます。<p class="paragraph"/><div class="code"><pre>grails create&#45;domain&#45;class helloworld.Person</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If no package is specified with the create-domain-class script, Grails automatically uses the application name as the package name.</div>
パッケージ名を指定しない場合、自動的にアプリケーション名をパッケージ名として使用します。
</blockquote><p class="paragraph"/><div class="hidden-block">This will create a class at the location <code>grails-app/domain/helloworld/Person.groovy</code> such as the one below:</div>
コマンドを実行すると<code>grails-app/domain/helloworld/Person.groovy</code>に以下のようなドメインクラスを作成します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> helloworld<p class="paragraph"/>class Person &#123;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If you have the <code>dbCreate</code> property set to "update", "create" or "create-drop" on your <a href="../guide/single.html#dataSource" class="guide">DataSource</a>, Grails will automatically generate/modify the database tables for you.</div>
<a href="../guide/single.html#dataSource" class="guide">データソース</a>の<code>dbCreate</code>プロパティに"update", "create" または "create-drop"が設定されている場合は、ドメインクラスに対応したデータベースのテーブルを自動的に作成/修正します。
</blockquote><p class="paragraph"/><div class="hidden-block">You can customize the class by adding properties:</div>
プロパティを追加することでドメインクラスをカスタマイズできます。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">Integer</span> age
    Date lastVisit
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Once you have a domain class try and manipulate it with the <a href="../ref/Command Line/shell.html" class="commandLine">shell</a> or <a href="../ref/Command Line/console.html" class="commandLine">console</a> by typing:</div>
<a href="../ref/Command Line/shell.html" class="commandLine">shell</a>や<a href="../ref/Command Line/console.html" class="commandLine">console</a>上で、作成したドメインクラスを操作できます。<p class="paragraph"/><div class="code"><pre>grails console</pre></div><p class="paragraph"/><div class="hidden-block">This loads an interactive GUI where you can run Groovy commands with access to the Spring ApplicationContext, GORM, etc.</div>
このコマンドはGroovyコードを実行可能なインタラクティブなGUIを起動します。GroovyコードからSpring ApplicationContextやGORMなどを使用できます。


<a name="5.1.1 Basic CRUD"><!-- Legacy link --></a>
<h2 id="basicCRUD">6.1.1 基本CRUD</h2>
<div class="hidden-block">Try performing some basic CRUD (Create/Read/Update/Delete) operations.</div>
いくつかの単純なCRUD操作(作成/参照/更新/削除)を実行してみましょう。<p class="paragraph"/><div class="hidden-block">h4. Create</div>
<h4>作成</h4><p class="paragraph"/><div class="hidden-block">To create a domain class use Map constructor to set its properties and call <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>:</div>
ドメインクラスを作成するにはマップコンストラクタでプロパティをセットし、<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドを呼び出します。<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person(name: <span class="java&#45;quote">"Fred"</span>, age: 40, lastVisit: <span class="java&#45;keyword">new</span> Date())
p.save()</pre></div><p class="paragraph"/><div class="hidden-block">The <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> method will persist your class to the database using the underlying Hibernate ORM layer.</div>
上記の<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドはHibernateのORM層を通じてドメインクラスをデータベースに永続化します。<p class="paragraph"/><div class="hidden-block">h4. Read</div>
<h4>参照</h4><p class="paragraph"/><div class="hidden-block">Grails transparently adds an implicit <code>id</code> property to your domain class which you can use for retrieval:</div>
Grailsはユーザが特に意識しなくても暗黙的な<code>id</code>プロパティをドメインクラスの永続化時に付与します。この<code>id</code>によって検索時にドメインクラスを一意に識別することができます。<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
assert 1 == p.id</pre></div><p class="paragraph"/><div class="hidden-block">This uses the <a href="../ref/Domain Classes/get.html" class="domainClasses">get</a> method that expects a database identifier to read the <code>Person</code> object back from the database.</div>
この<a href="../ref/Domain Classes/get.html" class="domainClasses">get</a>メソッドは引数にデータベースの主キーを受け取り、データベースから主キーに対応する<code>Person</code>オブジェクトを返します。
<div class="hidden-block">You can also load an object in a read-only state by using the <a href="../ref/Domain Classes/read.html" class="domainClasses">read</a> method:</div>
<a href="../ref/Domain Classes/read.html" class="domainClasses">read</a>メソッドを使用することで、読み取り専用でオブジェクトを参照することができます。<p class="paragraph"/><div class="code"><pre>def p = Person.read(1)</pre></div><p class="paragraph"/><div class="hidden-block">In this case the underlying Hibernate engine will not do any dirty checking and the object will not be persisted. Note that</div>
<div class="hidden-block">if you explicitly call the <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> method then the object is placed back into a read-write state.</div>
読み取り専用でオブジェクトを参照した場合は、下層のHibernateはdirtyチェックと永続化処理を行いません。
しかし、<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドを明示的に呼び出した時は、オブジェクトは読み書き可能な状態に戻るということに留意してください。<p class="paragraph"/><div class="hidden-block">In addition, you can also load a proxy for an instance by using the <a href="../ref/Domain Classes/load.html" class="domainClasses">load</a> method:</div>
さらに<a href="../ref/Domain Classes/load.html" class="domainClasses">load</a>メソッドを使用することで、プロキシインスタンスを参照することができます。<p class="paragraph"/><div class="code"><pre>def p = Person.load(1)</pre></div><p class="paragraph"/><div class="hidden-block">This incurs no database access until a method other than getId() is called. Hibernate then initializes the proxied instance, or</div>
<div class="hidden-block">throws an exception if no record is found for the specified id.</div>
このプロキシインスタンスはgetId()メソッド以外の何らかのメソッドを呼び出すまでデータベースにアクセスしません。getId()メソッド以外の何らかのメソッドを呼び出した時に、Hibernateがプロキシインスタンスを初期化します。対象の主キーを持つレコードが見つからなかった場合は例外が投げられます。<p class="paragraph"/><div class="hidden-block">h4. Update</div>
<h4>更新</h4><p class="paragraph"/><div class="hidden-block">To update an instance, change some properties and then call <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> again:</div>
インスタンスを更新するには、いずれかのプロパティを変更した後で作成と同じように<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドを使用します。<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
p.name = <span class="java&#45;quote">"Bob"</span>
p.save()</pre></div><p class="paragraph"/><div class="hidden-block">h4. Delete</div>
<h4>削除</h4><p class="paragraph"/><div class="hidden-block">To delete an instance use the <a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a> method:</div>
インスタンスを削除するには<a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a>メソッドを使用します。<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
p.delete()</pre></div>


<a name="5.2 Domain Modelling in GORM"><!-- Legacy link --></a>
<h2 id="domainClasses">6.2 GORMでのドメインモデリング</h2>
<div class="hidden-block">When building Grails applications you have to consider the problem domain you are trying to solve. For example if you were building an <a href="http://www.amazon.com/" target="blank">Amazon</a>-style bookstore you would be thinking about books, authors, customers and publishers to name a few.</div>
Grailsアプリケーションを構築するときは、解決しようとしている問題のドメインについて深く考える必要があります。例えば、<a href="http://www.amazon.com/" target="blank">Amazon</a>のような書店を構築する場合のドメインをいくつか挙げるなら、本、著者、購入者、そして出版社などについて考えることになるでしょう。<p class="paragraph"/><div class="hidden-block">These are modeled in GORM as Groovy classes, so a <code>Book</code> class may have a title, a release date, an ISBN number and so on. The next few sections show how to model the domain in GORM.</div>
そのようなドメインはGroovyのクラスとしてGORM内でモデル化されており、<code>Book</code>クラスはタイトル、出版日、ISBNコードなどを持つでしょう。以降のいくつかの節でGORM内でどのようにドメインをモデル化すればよいかをお見せします。<p class="paragraph"/><div class="hidden-block">To create a domain class you run the <a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a> command as follows:</div>
ドメインクラスを作成するために、次のように<a href="../ref/Command Line/create-domain-class.html" class="commandLine">create-domain-class</a>コマンドを実行します。<p class="paragraph"/><div class="code"><pre>grails create&#45;domain&#45;class org.bookstore.Book</pre></div><p class="paragraph"/><div class="hidden-block">The result will be a class at <code>grails-app/domain/org/bookstore/Book.groovy</code>:</div>
<code>grails-app/domain/org/bookstore/Book.groovy</code>クラスが作成されます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> org.bookstore<p class="paragraph"/>class Book &#123;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This class will map automatically to a table in the database called <code>book</code> (the same name as the class). This behaviour is customizable through the <a href="../guide/single.html#ormdsl" class="guide">ORM Domain Specific Language</a></div>
このクラスは自動的にデータベースの<code>book</code>テーブル(作成したクラスと同じ名前)と対応付けられます。この動作は<a href="../guide/single.html#ormdsl" class="guide">ORMのドメイン固有言語</a>によってカスタマイズできます。<p class="paragraph"/><div class="hidden-block">Now that you have a domain class you can define its properties as Java types. For example:</div>
先ほど作成したドメインクラスに、Javaの型を持つプロパティを定義することができます。例：<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> org.bookstore<p class="paragraph"/>class Book &#123;
    <span class="java&#45;object">String</span> title
    Date releaseDate
    <span class="java&#45;object">String</span> ISBN
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Each property is mapped to a column in the database, where the convention for column names is all lower case separated by underscores. For example <code>releaseDate</code> maps onto a column <code>release_date</code>. The SQL types are auto-detected from the Java types, but can be customized with <a href="../guide/single.html#constraints" class="guide">Constraints</a> or the <a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>.</div>
定義した各プロパティは規約として、大文字はアンダースコアをつけて小文字にしたデータベースのカラムに対応付けられます。例えば、<code>releaseDate</code>プロパティは<code>release_date</code>カラムに対応付けられます。SQLの型はJavaの型から自動的に判別されますが、<a href="../guide/single.html#constraints" class="guide">Constraints</a>や<a href="../guide/single.html#ormdsl" class="guide">ORMのドメイン固有言語</a>によってカスタマイズすることができます。


<a name="5.2.1 Association in GORM"><!-- Legacy link --></a>
<h2 id="gormAssociation">6.2.1 GORMでの関連</h2>
<div class="hidden-block">Relationships define how domain classes interact with each other. Unless specified explicitly at both ends, a relationship exists only in the direction it is defined.</div>
ドメインクラスがどのように相互作用するのかを関連として定義します。両側のドメインクラスで明確に関連が定義されていない限り、関連はそれが定義された方向にだけ存在します。<p class="paragraph"/>

<a name="5.2.1.1 Many-to-one and one-to-one"><!-- Legacy link --></a>
<h2 id="manyToOneAndOneToOne">6.2.1.1 多対1、1対1 (Many-to-One, One-to-one)</h2>
<div class="hidden-block">A many-to-one relationship is the simplest kind, and is defined with a property of the type of another domain class. Consider this example:</div>
多対1の関連は最も単純で、他のドメインクラス型のプロパティとして定義されます。次のような例を考えてみましょう。<p class="paragraph"/><h5>Example A</h5><p class="paragraph"/><div class="code"><pre>class Face &#123;
    Nose nose
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Nose &#123;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case we have a unidirectional many-to-one relationship from <code>Face</code> to <code>Nose</code>. To make this relationship bidirectional define the other side as follows (and see the section on controlling the ends of the association just below):</div>
この場合は、<code>Face</code>から<code>Nose</code>への単方向の多対1の関連が存在しています。この関連を双方向にする場合は、もう片方のクラスを次のように定義します。(加えて本項最後の関連の両端をコントロールするの項を参照してください。)<p class="paragraph"/><h5>Example B</h5><p class="paragraph"/><div class="code"><pre>class Face &#123;
    Nose nose
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Nose &#123;
    <span class="java&#45;keyword">static</span> belongsTo = &#91;face:Face&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case we use the <code>belongsTo</code> setting to say that <code>Nose</code> "belongs to" <code>Face</code>. The result of this is that we can create a <code>Face</code>, attach a <code>Nose</code> instance to it and when we save or delete the <code>Face</code> instance, GORM will save or delete the <code>Nose</code>. In other words, saves and deletes will cascade from <code>Face</code> to the associated <code>Nose</code>:</div>
この場合<code>belongsTo</code>を設定することで、<code>Nose</code>"が"<code>Face</code>に"属している"ということを表現しています。結果として、<code>Nose</code>インスタンスを保持する<code>Face</code>インスタンスを作成し、その<code>Face</code>インスタンスをsave、deleteした場合、GORMは<code>Nose</code>のsave、deleteを自動的に行います。別の言い方をすれば、saveとdeleteが<code>Face</code>から関連した<code>Nose</code>へcascadeします。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Face(nose:<span class="java&#45;keyword">new</span> Nose()).save()</pre></div><p class="paragraph"/><div class="hidden-block">The example above will save both face and nose. Note that the inverse  <em class="italic">is not</em>  true and will result in an error due to a transient <code>Face</code>:</div>
上記の例はfaceとnoseの両方を作成します。双方向の関連を持っていますが、faceとnoseの対応を逆にした場合は<code>Face</code>が保存されず、意図しない動作となる点に注意してください。<p class="paragraph"/><div class="hidden-block"><div class="code"><pre><span class="java&#45;keyword">new</span> Nose(face:<span class="java&#45;keyword">new</span> Face()).save() // will cause an error</pre></div></div>
<div class="code"><pre><span class="java&#45;keyword">new</span> Nose(face:<span class="java&#45;keyword">new</span> Face()).save() // 意図しない動作 Noseは保存されるが、Faceは保存されない</pre></div><p class="paragraph"/><div class="hidden-block">Now if we delete the <code>Face</code> instance, the <code>Nose</code> will go too:</div>
次に<code>Face</code>インスタンスを削除すると、<code>Nose</code>も削除される例です:<p class="paragraph"/><div class="hidden-block"><div class="code"><pre>def f = Face.get(1)
f.delete() // both Face and Nose deleted</pre></div></div>
<div class="code"><pre>def f = Face.get(1)
f.delete() // FaseとNose両方が削除される</pre></div><p class="paragraph"/><div class="hidden-block">To make the relationship a true one-to-one, use the <code>hasOne</code> property on the owning side, e.g. <code>Face</code>:</div>
本当の1対1の関連を作る場合、関連を保持する側に<code>hasOne</code>プロパティを使います。<code>Face</code>の例:<p class="paragraph"/><h5>Example C</h5><p class="paragraph"/><div class="code"><pre>class Face &#123;
    <span class="java&#45;keyword">static</span> hasOne = &#91;nose:Nose&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Nose &#123;
    Face face
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that using this property puts the foreign key on the inverse table to the previous example, so in this case the foreign key column is stored in the <code>nose</code> table inside a column called <code>face_id</code>. Also, <code>hasOne</code> only works with bidirectional relationships.</div>
1つ前のExample Bでは、<code>face</code>テーブルに<code>nose</code>テーブルへの外部キーが生成されますが、このプロパティを使用すると外部キーが作成されるテーブルが逆になる点に注意してください。この例だと、<code>nose</code>テーブルに<code>face_id</code>カラムが追加されます。<code>hasOne</code>も双方向の関連としてのみ動作します。<p class="paragraph"/><div class="hidden-block">Finally, it's a good idea to add a unique constraint on one side of the one-to-one relationship:</div>
最後に、1対1関連の片側にユニーク制約を付加しておくと良いでしょう。<p class="paragraph"/><div class="code"><pre>class Face &#123;
    <span class="java&#45;keyword">static</span> hasOne = &#91;nose:Nose&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        nose unique: <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Nose &#123;
    Face face
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h5. Controlling the ends of the association</div>
<h5>関連の両端をコントロールする    </h5><p class="paragraph"/><div class="hidden-block">Occasionally you may find yourself with domain classes that have multiple properties of the same type. They may even be self-referential, i.e. the association property has the same type as the domain class it's in. Such situations can cause problems because Grails may guess incorrectly the type of the association. Consider this simple class:</div>
時々、同じ種類のプロパティを複数持つドメインクラスを作成することがあるでしょう。自己参照を持つ場合さえあります。例えば、関連するプロパティの種類が、自分自身の種類と同じドメインクラスなどです。 そのような状態が問題となる場合があります。これはGrailsが関連の種類を誤って推測するために起こりえます。次のシンプルなクラスについて考えてみましょう:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    Person parent<p class="paragraph"/>    <span class="java&#45;keyword">static</span> belongsTo = &#91; supervisor: Person &#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123; supervisor nullable: <span class="java&#45;keyword">true</span> &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">As far as Grails is concerned, the <code>parent</code> and <code>supervisor</code> properties are two directions of the same association. So when you set the <code>parent</code> property on a <code>Person</code> instance, Grails will automatically set the <code>supervisor</code> property on the other <code>Person</code> instance. This may be what you want, but if you look at the class, what we in fact have are two unidirectional relationships.</div>
Grailsの動作としては、<code>parent</code>プロパティと<code>supervisor</code>プロパティを2方向の同じ関連として扱います。つまり、<code>Person</code>インスタンスAの<code>parent</code>プロパティに<code>Person</code>インスタンスBを格納した時、Grailsは自動的に<code>Person</code>インスタンスBの<code>supervisor</code>プロパティに<code>Person</code>インスタンスAを格納します。 これは期待した動作かもしれません。しかしクラスを見れば、むしろ2つの単方向の関連を持つことを期待するでしょう。<p class="paragraph"/><div class="hidden-block">To guide Grails to the correct mapping, you can tell it that a particular association is unidirectional through the <code>mappedBy</code> property:</div>
正しいマッピングをGrailsに伝えるために、 <code>mappedBy</code>プロパティを使用して特定の関連が単方向であることを示すことができます:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    Person parent<p class="paragraph"/>    <span class="java&#45;keyword">static</span> belongsTo = &#91; supervisor: Person &#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mappedBy = &#91; supervisor: <span class="java&#45;quote">"none"</span>, parent: <span class="java&#45;quote">"none"</span> &#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123; supervisor nullable: <span class="java&#45;keyword">true</span> &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also replace "none" with any property name of the target class. And of course this works for normal domain classes too, not just self-referential ones. Nor is the <code>mappedBy</code> property limited to many-to-one and one-to-one associations: it also works for one-to-many and many-to-many associations as you'll see in the next section.</div>
対象クラスのどんなプロパティ名も"none"に置き換えることができます。もちろん自己参照の時だけではなく一般的なドメインクラスに対してもこの方法は動作します。そして<code>mappedBy</code>プロパティは多対1と1対1関連だけに限定されていません。次項でわかるように、1対多と多対多の関連の場合も動作します。<p class="paragraph"/><div class="hidden-block"><blockquote class="warning">
If you have a property called "none" on your domain class, this approach won't work currently! The "none" property will be treated as the reverse direction of the association (or the "back reference"). Fortunately, "none" is not a common domain class property name.
</blockquote></div>
<blockquote class="warning">
ドメインクラスに"none"という名前のプロパティがある場合はこの方法は上手く動きません！ "none"プロパティは反対方向、あるいは後方への参照として扱われます。 "none"はプロパティ名としては珍しい名前のため、特に気にする必要はないでしょう。
</blockquote>


<a name="5.2.1.2 One-to-many"><!-- Legacy link --></a>
<h2 id="oneToMany">6.2.1.2 1対多 (One-to-many)</h2>
<div class="hidden-block">
A one-to-many relationship is when one class, example <code>Author</code>, has many instances of another class, example <code>Book</code>. With Grails you define such a relationship with the <code>hasMany</code> setting:
</div>
1対多の関連は、<code>Author</code>のような1つのクラス、<code>Book</code>のような他クラスのインスタンスを複数保持します。
Grailsでは<code>hasMany</code>の設定でこの関連を定義します。<p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;<p class="paragraph"/>    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this case we have a unidirectional one-to-many. Grails will, by default, map this kind of relationship with a join table.
</div>
この場合は単方向の1対多を持っています。
Grailsはデフォルトでは結合テーブルによって、この種類の関連をマップします。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The <a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a> allows mapping unidirectional relationships using a foreign key association instead
</blockquote>
</div>
<blockquote class="note">
<a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>では代わりに外部キーの参照を使用した単方向関連の設定もできます。
</blockquote><p class="paragraph"/><div class="hidden-block">
Grails will automatically inject a property of type <code>java.util.Set</code> into the domain class based on the <code>hasMany</code> setting. This can be used to iterate over the collection:
</div>
Grailsは<code>hasMany</code>を持つドメインクラスに<code>java.util.Set</code>型のプロパティを自動的に注入します。
このコレクションはイテレートして使えます。<p class="paragraph"/><div class="code"><pre>def a = Author.get(1)<p class="paragraph"/><span class="java&#45;keyword">for</span> (book in a.books) &#123;
    println book.title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The default fetch strategy used by Grails is "lazy", which means that the collection will be lazily initialized on first access. This can lead to the <a href="http://www.javalobby.org/java/forums/t20533.html" target="blank">n+1 problem</a> if you are not careful.<p class="paragraph"/>If you need "eager" fetching you can use the <a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a> or specify eager fetching as part of a <a href="../guide/single.html#querying" class="guide">query</a>
</blockquote>
</div>
<blockquote class="note">
Grailsによるデフォルトのフェッチ戦略は"lazy"です。これは最初のアクセスによってコレクションが遅延初期化されること意味します。
この遅延初期化は、注意を怠ると<a href="http://www.javalobby.org/java/forums/t20533.html" target="blank">N+1問題</a>を引き起こします。<p class="paragraph"/>もし"eager"フェッチが必要な場合は、<a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>を使うか、または<a href="../guide/single.html#querying" class="guide">クエリ</a>中で"eager"フェッチを指定してください。
</blockquote><p class="paragraph"/><div class="hidden-block">
The default cascading behaviour is to cascade saves and updates, but not deletes unless a <code>belongsTo</code> is also specified:
</div>
デフォルトでは保存と更新がカスケードされます。しかし、削除は<code>belongsTo</code>が指定されるまでカスケードされません。<p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;<p class="paragraph"/>    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;keyword">static</span> belongsTo = &#91;author: Author&#93;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If you have two properties of the same type on the many side of a one-to-many you have to use <code>mappedBy</code> to specify which the collection is mapped:
</div>
もし、1対多の「多」側で同じ型のプロパティが2つある場合は、マップされるコレクションを指定するために<code>mappedBy</code>を使ってください。<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;flights: Flight&#93;
    <span class="java&#45;keyword">static</span> mappedBy = &#91;flights: <span class="java&#45;quote">"departureAirport"</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Flight &#123;
    Airport departureAirport
    Airport destinationAirport
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This is also true if you have multiple collections that map to different properties on the many side:
</div>
これは、「多」側で異なるプロパティへマップされた複数のコレクションがある場合でも同じです。<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;outboundFlights: Flight, inboundFlights: Flight&#93;
    <span class="java&#45;keyword">static</span> mappedBy = &#91;outboundFlights: <span class="java&#45;quote">"departureAirport"</span>,
                       inboundFlights: <span class="java&#45;quote">"destinationAirport"</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Flight &#123;
    Airport departureAirport
    Airport destinationAirport
&#125;</pre></div><p class="paragraph"/>

<a name="5.2.1.3 Many-to-many"><!-- Legacy link --></a>
<h2 id="manyToMany">6.2.1.3 多対多 (Many-to-many)</h2>
<div class="hidden-block">
Grails supports many-to-many relationships by defining a <code>hasMany</code> on both sides of the relationship and having a <code>belongsTo</code> on the owned side of the relationship:
</div>
Grailsでは関連の両側で<code>hasMany</code>を定義し、関連の所有される側に<code>belongsTo</code>を付けることで、多対多の関連をサポートします。<p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;keyword">static</span> belongsTo = Author
    <span class="java&#45;keyword">static</span> hasMany = &#91;authors:Author&#93;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;books:Book&#93;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Grails maps a many-to-many using a join table at the database level. The owning side of the relationship, in this case <code>Author</code>, takes responsibility for persisting the relationship and is the only side that can cascade saves across.
</div>
Grailsはデータベースレベルでは結合テーブルを使用して多対多をマップします。
関連の所有する側（この例では<code>Author</code>）は、関連の永続化の責務を持ちます。そして、この所有する側からのみ保存のカスケードが可能です。<p class="paragraph"/><div class="hidden-block">
For example this will work and cascade saves:
</div>
例えば、これは正しくカスケード保存されます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Author(name:<span class="java&#45;quote">"Stephen King"</span>)
        .addToBooks(<span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Stand"</span>))
        .addToBooks(<span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Shining"</span>))
        .save()</pre></div><p class="paragraph"/><div class="hidden-block">
However this will only save the <code>Book</code> and not the authors!
</div>
しかし、これは<code>Book</code>だけが保存されauthorsは保存されません！<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Book(name:<span class="java&#45;quote">"Groovy in Action"</span>)
        .addToAuthors(<span class="java&#45;keyword">new</span> Author(name:<span class="java&#45;quote">"Dierk Koenig"</span>))
        .addToAuthors(<span class="java&#45;keyword">new</span> Author(name:<span class="java&#45;quote">"Guillaume Laforge"</span>))
        .save()</pre></div><p class="paragraph"/><div class="hidden-block">
This is the expected behaviour as, just like Hibernate, only one side of a many-to-many can take responsibility for managing the relationship.
</div>
Hibernateがそうであるように、多対多の片側だけが関連を管理する責務を持てるので、これは期待通りの振る舞いです。<p class="paragraph"/><div class="hidden-block">
<blockquote class="warning">
Grails' <a href="../guide/single.html#scaffolding" class="guide">Scaffolding</a> feature <strong class="bold">does not</strong> currently support many-to-many relationship and hence you must write the code to manage the relationship yourself
</blockquote>
</div>
<blockquote class="warning">
Grailsの<a href="../guide/single.html#scaffolding" class="guide">スカッフォルド</a>は現在、多対多の関連をサポートしていません。
そのため、関連を管理するコードは自分で書かなければなりません。
</blockquote>


<a name="5.2.1.4 Basic Collection Types"><!-- Legacy link --></a>
<h2 id="basicCollectionTypes">6.2.1.4 基本コレクション型</h2>
<div class="hidden-block">
As well as associations between different domain classes, GORM also supports mapping of basic collection types.
For example, the following class creates a <code>nicknames</code> association that is a <code>Set</code> of <code>String</code> instances:
</div>
異なるドメインクラス間の関連に加えて、GORMは基本コレクション型のマッピングもサポートしています。
例えば、以下のクラスは<code>String</code>の<code>Set</code>である<code>nicknames</code>の関連を作成します。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;nicknames: <span class="java&#45;object">String</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
GORM will map an association like the above using a join table. You can alter various aspects of how the join table is mapped using the <code>joinTable</code> argument:
</div>
GORMでは、上記のような関連は結合テーブルを用いてマップされます。
<code>joinTable</code>引数を使って、どのように結合テーブルにマップされるかを変更できます。<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;nicknames: <span class="java&#45;object">String</span>&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
       hasMany joinTable: &#91;name: 'bunch_o_nicknames',
                           key: 'person_id',
                           column: 'nickname',
                           type: <span class="java&#45;quote">"text"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The example above will map to a table that looks like the following:
</div>
例えば、上記は以下のようなテーブルにマップします。<p class="paragraph"/><strong class="bold">bunch_o_nicknames Table</strong>
<div class="code"><pre>&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
| person_id         |     nickname          |
&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
|   1               |      Fred             |
&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</pre></div>


<a name="5.2.2 Composition in GORM"><!-- Legacy link --></a>
<h2 id="gormComposition">6.2.2 GORMでのコンポジション</h2>
<div class="hidden-block">
As well as <a href="../guide/single.html#gormAssociation" class="guide">association</a>, Grails supports the notion of composition. In this case instead of mapping classes onto separate tables a class can be "embedded" within the current table. For example:
</div>
<a href="../guide/single.html#gormAssociation" class="guide">関連</a>に加えて、Grailsはコンポジションの概念をサポートしています。
次の場合は、それぞれのドメインクラス毎に別々のテーブルにマッピングされる代わりに、別のドメインクラスのカラムを対象ドメインクラスのテーブルに「埋め込む」ことができます。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    Address homeAddress
    Address workAddress
    <span class="java&#45;keyword">static</span> embedded = &#91;'homeAddress', 'workAddress'&#93;
&#125;<p class="paragraph"/>class Address &#123;
    <span class="java&#45;object">String</span> number
    <span class="java&#45;object">String</span> code
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The resulting mapping would looking like this:
</div>
マッピング結果はこのようになります。<p class="paragraph"/><img border="0" class="center" src="../../img/5.2.2-composition.jpg"></img><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
If you define the <code>Address</code> class in a separate Groovy file in the <code>grails-app/domain</code> directory you will also get an <code>address</code> table. If you don't want this to happen use Groovy's ability to define multiple classes per file and include the <code>Address</code> class below the <code>Person</code> class in the <code>grails-app/domain/Person.groovy</code> file
</blockquote>
</div>
<blockquote class="note">
もし<code>grails-app/domain</code>ディレクトリ内に別のGroovyファイルとして<code>Address</code>クラスを定義した場合は、以前と同じように<code>address</code>テーブルが作成されてしまいます。
これを避けたい場合は、1ファイルに複数のクラスを定義できるGroovyの能力を使い、<code>grails-app/domain/Person.groovy</code>ファイルの<code>Person</code>クラスの下に<code>Address</code>クラスを含めてください。
</blockquote>


<a name="5.2.3 Inheritance in GORM"><!-- Legacy link --></a>
<h2 id="inheritanceInGORM">6.2.3 GORMでの継承</h2>
<div class="hidden-block">
GORM supports inheritance both from abstract base classes and concrete persistent GORM entities. For example:
</div>
GORMは抽象クラス、または他のGORMエンティティクラスからの継承をサポートしています。
例えば:<p class="paragraph"/><div class="code"><pre>class Content &#123;
     <span class="java&#45;object">String</span> author
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class BlogEntry <span class="java&#45;keyword">extends</span> Content &#123;
    URL url
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">extends</span> Content &#123;
    <span class="java&#45;object">String</span> ISBN
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class PodCast <span class="java&#45;keyword">extends</span> Content &#123;
    <span class="java&#45;object">byte</span>&#91;&#93; audioStream
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In the above example we have a parent <code>Content</code> class and then various child classes with more specific behaviour.
</div>
上の例では、親の<code>Content</code>クラスと個別の振る舞いを持ったさまざまな子クラスを定義しています。<p class="paragraph"/><div class="hidden-block">
<h4>Considerations</h4>
</div>
<h4>考慮すべきこと</h4><p class="paragraph"/><div class="hidden-block">
At the database level Grails by default uses table-per-hierarchy mapping with a discriminator column called <code>class</code> so the parent class (<code>Content</code>) and its subclasses (<code>BlogEntry</code>, <code>Book</code> etc.), share the <strong class="bold">same</strong> table.
</div>
データベースレベルでは、Grailsはデフォルトで<code>class</code>という名前の識別カラムと共にtable-per-hierarchyマッピングを使います。
これは親クラス（<code>Content</code>）と、その子クラス（<code>BlogEntry</code>や<code>Book</code>など）が同じテーブル上に格納されます。<p class="paragraph"/><div class="hidden-block">
Table-per-hierarchy mapping has a down side in that you <strong class="bold">cannot</strong> have non-nullable properties with inheritance mapping. An alternative is to use table-per-subclass which can be enabled with the <a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>
</div>
table-per-hierarchyマッピングは継承先のマッピングで非nullableプロパティを持てないという難点があります。
代替手段はtable-per-subclassを使うことです。
これは<a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>で有効にできます。<p class="paragraph"/><div class="hidden-block">
However, excessive use of inheritance and table-per-subclass can result in poor query performance due to the use of outer join queries. In general our advice is if you're going to use inheritance, don't abuse it and don't make your inheritance hierarchy too deep.
</div>
しかし、過度の継承とtable-per-subclassの使用は、外部結合（OUTER JOIN）のせいでクエリ性能が劣化する可能性があります。
一般的なアドバイスとして、もし継承を使うなら、継承を乱用せず、継承階層が深くならないようにしてください。<p class="paragraph"/><div class="hidden-block">
<h4>Polymorphic Queries</h4>
</div>
<h4>ポリモーフィズムなクエリ</h4><p class="paragraph"/><div class="hidden-block">
The upshot of inheritance is that you get the ability to polymorphically query. For example using the <a href="../ref/Domain Classes/list.html" class="domainClasses">list</a> method on the <code>Content</code> super class will return all subclasses of <code>Content</code>:
</div>
継承の結果としてポリモーフィズムを使ったクエリが可能になります。
例えば、親の<code>Content</code>クラス上で<a href="../ref/Domain Classes/list.html" class="domainClasses">list</a>メソッドを使うと、<code>Content</code>のすべてのサブクラスが返されます:<p class="paragraph"/><div class="code"><pre>def content = Content.list() // list all blog entries, books and podcasts
content = Content.findAllByAuthor('Joe Bloggs') // find all by author<p class="paragraph"/>def podCasts = PodCast.list() // list only podcasts</pre></div>


<a name="5.2.4 Sets, Lists and Maps"><!-- Legacy link --></a>
<h2 id="sets,ListsAndMaps">6.2.4 セット、リスト、マップ</h2>
<div class="hidden-block">h4. Sets of Objects</div>
<h4>オブジェクトのセット</h4><p class="paragraph"/><div class="hidden-block">
By default when you define a relationship with GORM it is a <code>java.util.Set</code> which is an unordered collection that cannot contain duplicates. In other words when you have:
</div>
デフォルトでは、GORMを使って関連を定義した場合、<code>java.util.Set</code>になります。
これは、順序を持たないコレクションで、重複要素を含めません。
言い換えると、次のようなドメインクラスがあるとき:<p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The books property that GORM injects is a <code>java.util.Set</code>. Sets guarantee uniquenes but not order, which may not be what you want. To have custom ordering you configure the Set as a <code>SortedSet</code>:
</div>
GORMが注入する<code>books</code>プロパティは<code>java.util.Set</code>になる、ということです。
セットはユニーク性を保証しますが、順序は保証しません。
これでは都合が悪い場合もあるかもしれません。
独自の順序を持つにはセットを<code>SortedSet</code>に設定します:<p class="paragraph"/><div class="code"><pre>class Author &#123;<p class="paragraph"/>    SortedSet books<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this case a <code>java.util.SortedSet</code> implementation is used which means you must implement <code>java.lang.Comparable</code> in your Book class:
</div>
この場合は、<code>java.util.SortedSet</code>の実装が使われます。
これは、Bookクラスで<code>java.lang.Comparable</code>を実装しなければならないことを意味します:<p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">implements</span> Comparable &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title
    Date releaseDate = <span class="java&#45;keyword">new</span> Date()<p class="paragraph"/>    <span class="java&#45;object">int</span> compareTo(obj) &#123;
        releaseDate.compareTo(obj.releaseDate)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The result of the above class is that the Book instances in the books collection of the Author class will be ordered by their release date.
</div>
上記のようにクラスを変更することで、Authorクラスのbooksコレクションのインスタンスがリリース日時順になります。<p class="paragraph"/><div class="hidden-block">
<h4>Lists of Objects</h4>
</div>
<h4>オブジェクトのリスト</h4><p class="paragraph"/><div class="hidden-block">
To keep objects in the order which they were added and to be able to reference them by index like an array you can define your collection type as a <code>List</code>:
</div>
追加された順にオブジェクトを保ち、配列のようにインデックスで参照できるようにするには、コレクション型をListで定義します:<p class="paragraph"/><div class="code"><pre>class Author &#123;<p class="paragraph"/>    List books<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this case when you add new elements to the books collection the order is retained in a sequential list indexed from 0 so you can do:
</div>
この場合は、新しい要素をbooksコレクションへ追加したときに、0からインデックスが付与された一連のリストとして、順序が保持されます。
そして、次のようにアクセスできます:<p class="paragraph"/><div class="code"><pre>author.books&#91;0&#93; // get the first book</pre></div><p class="paragraph"/><div class="hidden-block">
The way this works at the database level is Hibernate creates a <code>books_idx</code> column where it saves the index of the elements in the collection to retain this order at the database level.
</div>
データベースレベルにおいて、Hibernateはデータベース上に順序を保持するために、<code>books_idx</code>カラムを作成して、コレクション内の要素のインデックスを保存します。<p class="paragraph"/><div class="hidden-block">
When using a <code>List</code>, elements must be added to the collection before being saved, otherwise Hibernate will throw an exception (<code>org.hibernate.HibernateException</code>: null index column for collection):
</div>
<code>List</code>を使った場合、要素は保存前にコレクションへ追加されなければなりません。
コレクション追加前に単体で保存されてしまっていると、Hibernateが例外をスローします（<code>org.hibernate.HibernateException</code>: コレクションのインデックスカラムがnull）。<p class="paragraph"/><div class="code"><pre>// This won't work!
def book = <span class="java&#45;keyword">new</span> Book(title: 'The Shining')
book.save()
author.addToBooks(book)<p class="paragraph"/>// Do it <span class="java&#45;keyword">this</span> way instead.
def book = <span class="java&#45;keyword">new</span> Book(title: 'Misery')
author.addToBooks(book)
author.save()</pre></div><p class="paragraph"/><div class="hidden-block">h4. Bags of Objects</div>
<h4>オブジェクトのバッグ(Bag)</h4><p class="paragraph"/><div class="hidden-block">If ordering and uniqueness aren't a concern (or if you manage these explicitly) then you can use the Hibernate <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/collections.html" target="blank">Bag</a> type to represent mapped collections.</div><p class="paragraph"/>ユニークや順序が必要の無い場合は(また明示的に自分で管理する場合)、Hibernateの<a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/collections.html" target="blank">Bag</a>型をコレクションマップとして使用できます。<p class="paragraph"/><div class="hidden-block">The only change required for this is to define the collection type as a <code>Collection</code>:</div>
この場合はコレクションの型を<code>Collection</code>型として定義します。<p class="paragraph"/><div class="code"><pre>class Author &#123;<p class="paragraph"/>   Collection books<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Since uniqueness and order aren't managed by Hibernate, adding to or removing from collections mapped as a Bag don't trigger a load of all existing instances from the database, so this approach will perform better and require less memory than using a <code>Set</code> or a <code>List</code>.</div>
Hibernateでユニークとオーダーが管理されないので、Bagにマップされたコレクションは、追加削除時に既存のインスタンスをデータベースからロードしません。このため<code>Set</code>または@Listよりメモリ使用量が少なくパフォーマンスが良くなります。<p class="paragraph"/><div class="hidden-block">h4. Maps of Objects</div>
<h4>オブジェクトのマップ</h4><p class="paragraph"/><div class="hidden-block">If you want a simple map of string/value pairs GORM can map this with the following:</div>
文字列/値のような、単純なマップを使用する場合、GORMでは次のように定義します。<p class="paragraph"/><div class="code"><pre>class Author &#123;
    Map books // map of ISBN:book names
&#125;<p class="paragraph"/>def a = <span class="java&#45;keyword">new</span> Author()
a.books = &#91;<span class="java&#45;quote">"1590597583"</span>:<span class="java&#45;quote">"Grails Book"</span>&#93;
a.save()</pre></div>
<div class="hidden-block">In this case the key and value of the map MUST be strings.</div>
このケースでは、 キーと値は<strong class="bold">必ず</strong>文字列である必要があります。<p class="paragraph"/><div class="hidden-block">If you want a Map of objects then you can do this:</div>
オブジェクトのマップが必要な場合は次のように:<p class="paragraph"/><div class="code"><pre>class Book &#123;<p class="paragraph"/>    Map authors<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;authors: Author&#93;
&#125;<p class="paragraph"/>def a = <span class="java&#45;keyword">new</span> Author(name:<span class="java&#45;quote">"Stephen King"</span>)<p class="paragraph"/>def book = <span class="java&#45;keyword">new</span> Book()
book.authors = &#91;stephen:a&#93;
book.save()</pre></div><p class="paragraph"/><div class="hidden-block">The static <code>hasMany</code> property defines the type of the elements within the Map. The keys for the map <strong class="bold">must</strong> be strings.</div>
<code>hasMany</code>プロパティで、Mapのエレメントの型を定義します。マップのキーは<strong class="bold">必ず</strong>文字列にしてください。<p class="paragraph"/><div class="hidden-block">
<h4>A Note on Collection Types and Performance</h4>
</div>
<h4>コレクション型とパフォーマンスについて</h4><p class="paragraph"/><div class="hidden-block">
The Java <code>Set</code> type doesn't allow duplicates. To ensure uniqueness when adding an entry to a <code>Set</code> association Hibernate has to load the entire associations from the database. If you have a large numbers of entries in the association this can be costly in terms of performance.
</div>
Javaの<code>Set</code>型は重複を許容しません。
<code>Set</code>の関連へエントリを追加するときに、ユニーク性を保証するため、Hibernateはデータベースからすべての関連を読み込まなければなりません。
もし関連のエントリの数が大量の場合、パフォーマンスの点でコストがかかりすぎる可能性があります。<p class="paragraph"/><div class="hidden-block">
The same behavior is required for <code>List</code> types, since Hibernate needs to load the entire association to maintain order. Therefore it is recommended that if you anticipate a large numbers of records in the association that you make the association bidirectional so that the link can be created on the inverse side. For example consider the following code:
</div>
同じ振る舞いが<code>List</code>型でも必要になります。
これは、Hibernateがすべての関連の順序を保持するため、事前にすべての関連を読み込む必要があるからです。
そのため、事前に関連エントリが大量になることがわかっている場合は、双方向関連にして、反対側から関連を作成することをお勧めします。
たとえば、以下のコードを考えてみます:<p class="paragraph"/><div class="code"><pre>def book = <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"New Grails Book"</span>)
def author = Author.get(1)
book.author = author
book.save()</pre></div><p class="paragraph"/><div class="hidden-block">
In this example the association link is being created by the child (Book) and hence it is not necessary to manipulate the collection directly resulting in fewer queries and more efficient code. Given an <code>Author</code> with a large number of associated <code>Book</code> instances if you were to write code like the following you would see an impact on performance:
</div>
この例では、関連は子（Book）によって作成されます。
このようにすることで、直接コレクションを操作する必要がなくなるため、より少ないクエリで効率的なコードとなります。
<code>Author</code>と関連する大量の<code>Book</code>インスタンスが与えられたとき、下のようなコードを書いてしまうとパフォーマンスに重大な影響があります:<p class="paragraph"/><div class="code"><pre>def book = <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"New Grails Book"</span>)
def author = Author.get(1)
author.addToBooks(book)
author.save()</pre></div><p class="paragraph"/><div class="hidden-block">
You could also model the collection as a Hibernate Bag as described above.
</div>
また、上記で説明したように、HibernateのBagとしてコレクションを作ることもできます。


<a name="5.3 Persistence Basics"><!-- Legacy link --></a>
<h2 id="persistenceBasics">6.3 永続化の基礎</h2>
<div class="hidden-block">A key thing to remember about Grails is that under the surface Grails is using <a href="http://www.hibernate.org/" target="blank">Hibernate</a> for persistence. If you are coming from a background of using <a href="http://wiki.rubyonrails.org/rails/pages/ActiveRecord" target="blank">ActiveRecord</a> or <a href="http://www.mybatis.org/" target="blank">iBatis/MyBatis</a>, Hibernate's "session" model may feel a little strange.</div>
Grailsでは、永続化実現のために<a href="http://www.hibernate.org/" target="blank">Hibernate</a> が使われています。Hibernateは「セッション」という概念を採用していますが、この概念は<a href="http://wiki.rubyonrails.org/rails/pages/ActiveRecord" target="blank">ActiveRecord</a> や<a href="http://www.mybatis.org/" target="blank">iBatis/MyBatis</a>に慣れ親しんでいる人にとっては、少し不可解に感じるかも知れません。<p class="paragraph"/><div class="hidden-block">Grails automatically binds a Hibernate session to the currently executing request. This lets you use the <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> and <a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a> methods as well as other GORM methods transparently.</div>
Grailsは、自動的に、現在実行中のリクエストにHibernateのセッションをバインドします。そのため、<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドや<a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a>メソッドを、他のGORMメソッドと同様に透過的に利用することができます。<p class="paragraph"/><div class="hidden-block">h4. Transactional Write-Behind</div>
<h4>トランザクション内における遅延書き込み</h4><p class="paragraph"/><div class="hidden-block">A useful feature of Hibernate over direct JDBC calls and even other frameworks is that when you call <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> or <a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a> it does not necessarily perform any SQL operations <strong class="bold">at that point</strong>. Hibernate batches up SQL statements and executes them as late as possible, often at the end of the request when flushing and closing the session. This is typically done for you automatically by Grails, which manages your Hibernate session.</div>
Hibernateは、直接JDBC APIを呼び出す方法や、他のフレームワークを使う方法と比べて便利な特徴を備えています。具体的には<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドや<a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a>メソッドを呼び出した<strong class="bold">瞬間</strong>にはSQLを発行せず、できる限り後ろで、まとめて発行しようとします。セッションがフラッシュ、またはクローズされるまでSQLが発行されないことも珍しくありません。なお、通常では、これらの動作はHibernateのセッションを管理しているGrailsによって自動的に行われます。<p class="paragraph"/><div class="hidden-block">Hibernate caches database updates where possible, only actually pushing the changes when it knows that a flush is required, or when a flush is triggered programmatically. One common case where Hibernate will flush cached updates is when performing queries since the cached information might be included in the query results. But as long as you're doing non-conflicting saves, updates, and deletes, they'll be batched until the session is flushed. This can be a significant performance boost for applications that do a lot of database writes.</div>
Hibernateは、データベースの更新についても可能な限りキャッシュします。具体的には、Hibernateによって必要と判断されたときか、プログラム上でflushが行われたときにのみ、キャッシュの反映が行われます。キャッシュの反映が行われる良くあるケースの1つに、キャッシュされたままのクエリーによる更新結果を利用するようなクエリーを実行した場合が挙げられます。ただし、後続するクエリーと競合しないような保存、更新、削除のみを実行している限りは、キャッシュの反映は遅延され、セッションがフラッシュされるタイミングで、まとめてクエリーが実行されることになります。このような仕組みによって、大量のデータベース更新を行うアプリケーションの性能が大幅に向上します。<p class="paragraph"/><div class="hidden-block">Note that flushing is not the same as committing a transaction. If your actions are performed in the context of a transaction, flushing will execute SQL updates but the database will save the changes in its transaction queue and only finalize the updates when the transaction commits.</div>
なお、キャッシュの反映とトランザクションのコミットは同じではないことに注意してください。トランザクション内でキャッシュが反映されると、データベースに更新SQLが発行されることになりますが、それらの更新はトランザクションキューに留まったままになります。実際にデータベースに更新が反映されるのは、トランザクションのコミットが実行された時となります。<p class="paragraph"/>

<a name="5.3.1 Saving and Updating"><!-- Legacy link --></a>
<h2 id="savingAndUpdating">6.3.1 保存と更新</h2>
<div class="hidden-block">An example of using the <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> method can be seen below:</div>
<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドの利用例を以下に示します:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
p.save()</pre></div><p class="paragraph"/><div class="hidden-block">This save will be not be pushed to the database immediately - it will be pushed when the next flush occurs. But there are occasions when you want to control when those statements are executed or, in Hibernate terminology, when the session is "flushed". To do so you can use the flush argument to the save method:</div>
このようにsaveメソッドを呼び出しても、データベースへの即時反映は行われず、変更内容は保留されます。保留された内容をデータベースに反映する操作のことを、Hibernateの用語では「フラッシュ」と呼びますが、フラッシュが発生した時に、それまで保留されていた全ての変更内容がデータベースに反映されます。もし、saveメソッドの呼び出しと同時にフラッシュしたい場合には、名前付き引数<code>flush</code>を使って、以下のようにしてください:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
p.save(flush: <span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/><div class="hidden-block">Note that in this case  <em class="italic">all</em>  pending SQL statements including previous saves, deletes, etc. will be synchronized with the database. This also lets you catch any exceptions, which is typically useful in highly concurrent scenarios involving <a href="../guide/single.html#locking" class="guide">optimistic locking</a>:</div>
この形式のsaveメソッドの呼び出しによって、保留されていた  <em class="italic">全て</em>  のSQL(以前にflush指定なしに呼び出されたsaveメソッドやdeleteメソッドを含む)が発行され、データベースと同期することになります。
SQL発行に伴い発生する可能性のある例外は、このタイミングで必要に応じてキャッチしてください。たとえば、<a href="../guide/single.html#locking" class="guide">楽観的ロック</a>利用時に競合が発生した場合の例外は、ここでキャッチします。<p class="paragraph"/>
<div class="code"><pre>def p = Person.get(1)
<span class="java&#45;keyword">try</span> &#123;
    p.save(flush: <span class="java&#45;keyword">true</span>)
&#125;
<span class="java&#45;keyword">catch</span> (org.springframework.dao.DataIntegrityViolationException e) &#123;
    // deal with exception
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Another thing to bear in mind is that Grails <a href="../guide/single.html#validation" class="guide">validates</a> a domain instance every time you save it. If that validation fails the domain instance will  <em class="italic">not</em>  be persisted to the database. By default, <code>save()</code> will simply return <code>null</code> in this case, but if you would prefer it to throw an exception you can use the <code>failOnError</code> argument:</div>
saveメソッドに関して、もうひとつ注意すべきことがあります。ドメインインスタンスはsaveされる度に<a href="../guide/single.html#validation" class="guide">バリデーション</a>が実行されますが、バリデーションに失敗した場合は、データベースへの反映は  <em class="italic">行われません</em> 。
バリデーションに失敗したとき、<code>save()</code>メソッドは、デフォルトでは<code>null</code>を返します。例外を発生させたい場合には、名前付き引数<code>failOnError</code>を使って、以下のようにしてください:<p class="paragraph"/>
<div class="code"><pre>def p = Person.get(1)
<span class="java&#45;keyword">try</span> &#123;
    p.save(failOnError: <span class="java&#45;keyword">true</span>)
&#125;
<span class="java&#45;keyword">catch</span> (ValidationException e) &#123;
    // deal with exception
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can even change the default behaviour with a setting in <code>Config.groovy</code>, as described in the <a href="../guide/single.html#configGORM" class="guide">section on configuration</a>. Just remember that when you are saving domain instances that have been bound with data provided by the user, the likelihood of validation exceptions is quite high and you won't want those exceptions propagating to the end user.</div>
<code>failOnError</code>引数を省略した時のデフォルト動作は、<code>Config.groovy</code>の設定により変更することができます。具体的な変更方法は<a href="../guide/single.html#configGORM" class="guide">「設定」の章</a>に記載されています。ただし、エンドユーザの入力値を格納しているドメインインスタンスをsaveするケースでは、バリデーション例外が発生する可能性は非常に高く、かつ、例外をエンドユーザに直接表示することは避けたいと思うことが多いでしょう。その点を踏まえて、デフォルト動作を決定するようにしてください。<p class="paragraph"/><div class="hidden-block">You can find out more about the subtleties of saving data in <a href="http://blog.springsource.com/2010/06/23/gorm-gotchas-part-1/" target="blank">this article</a> - a must read!</div>
データのsaveにかかわる、より細かい点については<a href="http://blog.springsource.com/2010/06/23/gorm-gotchas-part-1/" target="blank">こちらの記事</a>が詳しいです。是非読んでみてください！


<a name="5.3.2 Deleting Objects"><!-- Legacy link --></a>
<h2 id="deletingObjects">6.3.2 オブジェクトの削除</h2>
<div class="hidden-block">An example of the <a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a> method can be seen below:</div>
<a href="../ref/Domain Classes/delete.html" class="domainClasses">delete</a>メソッドの使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
p.delete()</pre></div><p class="paragraph"/><div class="hidden-block">As with saves, Hibernate will use transactional write-behind to perform the delete; to perform the delete in-place you can use the <code>flush</code> argument:</div>
saveメソッドの時と同様に、deleteメソッド実行時にも、Hibernateはトランザクション内で遅延書き込みを行います。その場で削除を実行したい場合には、名前付き引数<code>flush</code>を使うことができます:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)
p.delete(flush: <span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/><div class="hidden-block">Using the <code>flush</code> argument lets you catch any errors that occur during a delete. A common error that may occur is if you violate a database constraint, although this is normally down to a programming or schema error. The following example shows how to catch a <code>DataIntegrityViolationException</code> that is thrown when you violate the database constraints:</div>
<code>flush</code>引数を使うことによって、削除にともなって発生する可能性のあるエラーに対処する必要が出てきます。
このタイミングで発生する、よくあるエラーの1つに、データベースの制約違反があります。
このエラーは、プログラミングやデータベーススキーマの間違いに起因することが多いのですが、その時に発生する例外<code>DataIntegrityViolationException</code>をキャッチする例を以下に示します:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)<p class="paragraph"/><span class="java&#45;keyword">try</span> &#123;
    p.delete(flush: <span class="java&#45;keyword">true</span>)
&#125;
<span class="java&#45;keyword">catch</span> (org.springframework.dao.DataIntegrityViolationException e) &#123;
    flash.message = <span class="java&#45;quote">"Could not delete person $&#123;p.name&#125;"</span>
    redirect(action: <span class="java&#45;quote">"show"</span>, id: p.id)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that Grails does not supply a <code>deleteAll</code> method as deleting data is discouraged and can often be avoided through boolean flags/logic.</div>
なお、Grailsは<code>deleteAll</code>メソッドは提供しておらず、そのような削除の方法は推奨されていません。代わりに、削除されたかどうか判定するためのフラグやロジックを用意するなどの方法を検討してください。<p class="paragraph"/><div class="hidden-block">If you really need to batch delete data you can use the <a href="../ref/Domain Classes/executeUpdate.html" class="domainClasses">executeUpdate</a> method to do batch DML statements:</div>
もし、どうしてもデータの一括削除が必要な場合は<a href="../ref/Domain Classes/executeUpdate.html" class="domainClasses">executeUpdate</a>メソッドを利用してください。このメソッドを使えば、以下のように一括でデータ操作を行うDML文を発行することができます:<p class="paragraph"/><div class="code"><pre>Customer.executeUpdate(<span class="java&#45;quote">"delete Customer c where c.name = :oldName"</span>,
                       &#91;oldName: <span class="java&#45;quote">"Fred"</span>&#93;)</pre></div>


<a name="5.3.3 Understanding Cascading Updates and Deletes"><!-- Legacy link --></a>
<h2 id="cascades">6.3.3 カスケード更新削除を理解する</h2>
<div class="hidden-block">It is critical that you understand how cascading updates and deletes work when using GORM. The key part to remember is the <code>belongsTo</code> setting which controls which class "owns" a relationship.</div>
GORMを使うにあたって、カスケード更新とカスケード削除がどのように動作するか理解しておくことは非常に重要です。特に、クラス間の所有関係を制御する<code>belongsTo</code>設定については覚えておく必要があります。<p class="paragraph"/><div class="hidden-block">Whether it is a one-to-one, one-to-many or many-to-many, defining <code>belongsTo</code> will result in updates cascading from the owning class to its dependant (the other side of the relationship), and for many-/one-to-one and one-to-many relationships deletes will also cascade.</div>
2つのドメインクラス間の関連が1対1、1対多、多対多のいずれの場合でも、<code>belongsTo</code>を定義することで、所有者のクラスから、所有されているクラス(関連の他方)に対して更新がカスケードします。また、多対1、1対1、1対多の場合は、削除も同様にカスケードします。<p class="paragraph"/><div class="hidden-block">If you  <em class="italic">do not</em>  define <code>belongsTo</code> then no cascades will happen and you will have to manually save each object (except in the case of the one-to-many, in which case saves will cascade automatically if a new instance is in a <code>hasMany</code> collection).</div>
<code>belongsTo</code>を定義  <em class="italic">しない</em>  場合はカスケードしないため、関連するオブジェクトを1つ1つsaveしなければなりません(ただし、1対多の場合だけは例外です。このケースでは<code>hasMeny</code>コレクション内に新しいインスタンスが有れば保存が自動的にカスケードします)。<p class="paragraph"/><div class="hidden-block">Here is an example:</div>
以下に例を示します:<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> hasMany = &#91;flights: Flight&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Flight &#123;
    <span class="java&#45;object">String</span> number
    <span class="java&#45;keyword">static</span> belongsTo = &#91;airport: Airport&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If I now create an <code>Airport</code> and add some <code>Flight</code>s to it I can save the <code>Airport</code> and have the updates cascaded down to each flight, hence saving the whole object graph:</div>
ここで、新規に<code>Airport</code>インスタンスを生成し、そこに<code>Flight</code>インスタンスをいくつか追加してみます。その後に<code>Airport</code>インスタンスを保存すると、各<code>Flight</code>インスタンスにも保存がカスケードし、結果として、<code>Airport</code>を起点とするオブジェクトグラフ全体が保存されることになります:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Airport(name: <span class="java&#45;quote">"Gatwick"</span>)
        .addToFlights(<span class="java&#45;keyword">new</span> Flight(number: <span class="java&#45;quote">"BA3430"</span>))
        .addToFlights(<span class="java&#45;keyword">new</span> Flight(number: <span class="java&#45;quote">"EZ0938"</span>))
        .save()</pre></div><p class="paragraph"/><div class="hidden-block">Conversely if I later delete the <code>Airport</code> all <code>Flight</code>s associated with it will also be deleted:</div>
今度は<code>Airport</code>インスタンスを削除してみます。すると、削除がカスケードするため、関連している全ての<code>Flight</code>インスタンスも合わせて削除されます:<p class="paragraph"/><div class="code"><pre>def airport = Airport.findByName(<span class="java&#45;quote">"Gatwick"</span>)
airport.delete()</pre></div><p class="paragraph"/><div class="hidden-block">However, if I were to remove <code>belongsTo</code> then the above cascading deletion code <strong class="bold">would not work</strong>. To understand this better take a look at the summaries below that describe the default behaviour of GORM with regards to specific associations. Also read <a href="http://blog.springsource.com/2010/07/02/gorm-gotchas-part-2/" target="blank">part 2</a> of the GORM Gotchas series of articles to get a deeper understanding of relationships and cascading.</div>
ところが、<code>bilongsTo</code> の定義が削除されている状態で、上記に記載した削除のコードを実行した場合は、カスケード削除は<strong class="bold">動作しません</strong>。以降では、この事象をより良く理解できるように、それぞれの関連に対するGORMのデフォルトの振る舞いを説明します。
関連とカスケードについて、更に深く理解したい場合には、<a href="http://blog.springsource.com/2010/07/02/gorm-gotchas-part-2/" target="blank">GORM Gotchas (Part 2)</a>も参照してください。<p class="paragraph"/><div class="hidden-block">h5. Bidirectional one-to-many with belongsTo</div>
<h5>双方向1対多関係でbelongsToが定義されている場合</h5><p class="paragraph"/><div class="code"><pre>class A &#123; <span class="java&#45;keyword">static</span> hasMany = &#91;bees: B&#93; &#125;</pre></div><p class="paragraph"/><div class="code"><pre>class B &#123; <span class="java&#45;keyword">static</span> belongsTo = &#91;a: A&#93; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of a bidirectional one-to-many where the many side defines a <code>belongsTo</code> then the cascade strategy is set to "ALL" for the one side and "NONE" for the many side.</div>
双方向1対多関係で、かつ「多」側に<code>belongsTo</code>が定義されている場合は、Hibernateのカスケード戦略として「1」側に"ALL"が、「多」側に"NONE"が、それぞれ設定されます。<p class="paragraph"/><div class="hidden-block">h5. Unidirectional one-to-many</div>
<h5>単方向1対多関係の場合</h5><p class="paragraph"/>
<div class="code"><pre>class A &#123; <span class="java&#45;keyword">static</span> hasMany = &#91;bees: B&#93; &#125;</pre></div><p class="paragraph"/><div class="code"><pre>class B &#123;  &#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of a unidirectional one-to-many where the many side defines no belongsTo then the cascade strategy is set to "SAVE-UPDATE".</div>
単方向1対多関係で、かつ「多」側に<code>belongsTo</code>が定義されていない場合は、Hibernateのカスケード戦略として"SAVE-UPDATE"が設定されます。<p class="paragraph"/><div class="hidden-block">h5. Bidirectional one-to-many, no belongsTo</div>
<h5>双方向1対多関係でbelongsToが定義されていない場合</h5><p class="paragraph"/><div class="code"><pre>class A &#123; <span class="java&#45;keyword">static</span> hasMany = &#91;bees: B&#93; &#125;</pre></div><p class="paragraph"/><div class="code"><pre>class B &#123; A a &#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of a bidirectional one-to-many where the many side does not define a <code>belongsTo</code> then the cascade strategy is set to "SAVE-UPDATE" for the one side and "NONE" for the many side.</div>
双方向1対多関係で、かつ「多」側に<code>belongsTo</code>が定義されていない場合は、Hibernateのカスケード戦略として「1」側に"SAVE-UPDATE"が、「多」側に"NONE"が、それぞれ設定されます。<p class="paragraph"/><div class="hidden-block">h5. Unidirectional one-to-one with belongsTo</div>
<h5>単方向1対1関係でbelongsToが定義されている場合</h5><p class="paragraph"/><div class="code"><pre>class A &#123;  &#125;</pre></div><p class="paragraph"/><div class="code"><pre>class B &#123; <span class="java&#45;keyword">static</span> belongsTo = &#91;a: A&#93; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of a unidirectional one-to-one association that defines a <code>belongsTo</code> then the cascade strategy is set to "ALL" for the owning side of the relationship (A-&#62;B) and "NONE" from the side that defines the <code>belongsTo</code> (B-&#62;A)</div>
単方向1対1関係で<code>belongsTo</code>が定義されている場合は、Hibernateのカスケード戦略として、所有者側(上記の例ではAがBを所有しているのでA)に"ALL"が、<code>belongsTo</code>が定義されている側(上記の例ではB)に"NONE"が、それぞれ設定されます。<p class="paragraph"/><div class="hidden-block">Note that if you need further control over cascading behaviour, you can use the <a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>.</div>
なお、カスケードの振る舞いについて、ここに書かれている内容を超える制御が必要な場合は、<a href="../guide/single.html#ormdsl" class="guide">ORM DSL</a>を利用してください。


<a name="5.3.4 Eager and Lazy Fetching"><!-- Legacy link --></a>
<h2 id="fetching">6.3.4 EagerフェッチとLazyフェッチ</h2>
<div class="hidden-block">Associations in GORM are by default lazy. This is best explained by example:</div>
GORMでは、関連のあるドメインクラスのインスタンスは、デフォルトでlazyに取得するように振る舞います。以下に例を示します:<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> hasMany = &#91;flights: Flight&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Flight &#123;
    <span class="java&#45;object">String</span> number
    Location destination
    <span class="java&#45;keyword">static</span> belongsTo = &#91;airport: Airport&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Location &#123;
    <span class="java&#45;object">String</span> city
    <span class="java&#45;object">String</span> country
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Given the above domain classes and the following code:</div>
上記のようなドメインクラスが定義されているとして、以下のコードを考えます:<p class="paragraph"/><div class="code"><pre>def airport = Airport.findByName(<span class="java&#45;quote">"Gatwick"</span>)
<span class="java&#45;keyword">for</span> (flight in airport.flights) &#123;
    println flight.destination.city
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">GORM will execute a single SQL query to fetch the <code>Airport</code> instance, another to get its flights, and then 1 extra query for  <em class="italic">each iteration</em>  over the <code>flights</code> association to get the current flight's destination. In other words you get N+1 queries (if you exclude the original one to get the airport).</div>
このコードを実行すると、GORMは、まず、<code>Airport</code>インスタンスを取得するためのSQLを発行します。
次に、<code>airport.flights</code>にアクセスしようとして、その<code>Airport</code>が所有している<code>Flight</code>インスタンスの集合を取得するためのSQLを発行します。
それから、 <code>airport.flights</code>内に格納されている各<code>Flight</code>インスタンスについて、そのフライトの<code>destination</code>を取得するために、  <em class="italic">それぞれ</em>  1回のSQLを発行します。以上をまとめると、上記コード実行のために N+1 回のクエリーが発行されることになります(初回の<code>Airport</code>インスタンスを取得するためのクエリーを除く)。<p class="paragraph"/><div class="hidden-block">h3. Configuring Eager Fetching</div>
<h3>Eagerフェッチングのための設定</h3><p class="paragraph"/><div class="hidden-block">An alternative approach that avoids the N+1 queries is to use eager fetching, which can be specified as follows:</div>
N+1 回のクエリーが発行されてしまうことを回避するためのアプローチの1つに、eagerフェッチングがあります。eagerフェッチングを使うには、以下のように指定します:<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> hasMany = &#91;flights: Flight&#93;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        flights lazy: <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the <code>flights</code> association will be loaded at the same time as its <code>Airport</code> instance, although a second query will be executed to fetch the collection. You can also use <code>fetch: 'join'</code> instead of <code>lazy: false</code> , in which case GORM will only execute a single query to get the airports and their flights. This works well for single-ended associations, but you need to be careful with one-to-manys. Queries will work as you'd expect right up to the moment you add a limit to the number of results you want. At that point, you will likely end up with fewer results than you were expecting. The reason for this is quite technical but ultimately the problem arises from GORM using a left outer join.</div>
このようにすることで、<code>Airport</code>インスタンスを取得する時に、同時に、関連している<code>flights</code>も取得するようになりますが、それぞれ別のクエリーが発行される点は変わりません。<code>lazy: false</code>の代わりに<code>fetch: 'join'</code>を使うと、1回のクエリーで、<code>Airport</code>インスタンスと、それに関連する<code>flights</code>を取得するようになります。ところが、<code>fetch: 'join'</code>を使う方法は、単一端関連ではうまく動作するのですが、この例のような1対多の関連に適用する場合には注意が必要です。具体的には、取得するレコード数に上限(<code>limit</code>)を指定しなければ、クエリーは問題なく動作するものの、上限を指定すると、本来返されるべき数よりも少ないレコードしか取得できないという事象が発生してしまいます。このようなことが発生する理由は技術的なもので、GORMが、この機能を実現するためにleft outer joinを使っていることに起因します。<p class="paragraph"/><div class="hidden-block">So, the recommendation is currently to use <code>fetch: 'join'</code> for single-ended associations and <code>lazy: false</code> for one-to-manys.</div>
以上の理由により、現時点では、単一端関連では<code>fetch: 'join'</code>を、1対多関連では<code>lazy: false</code>を使うことを推奨します。<p class="paragraph"/><div class="hidden-block">Be careful how and where you use eager loading because you could load your entire database into memory with too many eager associations. You can find more information on the mapping options in the <a href="../guide/single.html#fetchingDSL" class="guide">section on the ORM DSL</a>.</div>
あまりに多くの関連をeagerフェッチングとしてしまうと、データベース全体がメモリにロードされてしまう可能性があるため、eagerフェッチングを採用する場合は、使うべき場所と方法について十分に注意するようにしてください。<code>mapping</code>に指定できるオプションについての詳しい情報は<a href="../guide/single.html#fetchingDSL" class="guide">ORM DSLの章</a>に記載されています。<p class="paragraph"/><div class="hidden-block">h3. Using Batch Fetching</div>
<h3>一括フェッチングの利用</h3><p class="paragraph"/><div class="hidden-block">Although eager fetching is appropriate for some cases, it is not always desirable. If you made everything eager you could quite possibly load your entire database into memory resulting in performance and memory problems. An alternative to eager fetching is to use batch fetching. You can configure Hibernate to lazily fetch results in "batches". For example:</div>
eagerフェッチングが適切なケースはもちろん有りますが、常に最適なわけではありません。
たとえば、全てをeagerフェッチングにしてしまうと、データベース全体がメモリにロードされ、性能問題やメモリ不足の問題が発生するでしょう。そこで、eagerフェッチングに代わるもう1つの選択肢として一括フェッチングが用意されています。一括フェッチングでは、あるまとまった複数のレコードを1単位として、lazyフェッチングするように設定することができます。以下に例を示します:<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> hasMany = &#91;flights: Flight&#93;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        flights batchSize: 10
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case, due to the <code>batchSize</code> argument, when you iterate over the <code>flights</code> association, Hibernate will fetch results in batches of 10. For example if you had an <code>Airport</code> that had 30 flights, if you didn't configure batch fetching you would get 1 query to fetch the <code>Airport</code> and then <code>30</code> queries to fetch each flight. With batch fetching you get 1 query to fetch the <code>Airport</code> and 3 queries to fetch each <code>Flight</code> in batches of 10. In other words, batch fetching is an optimization of the lazy fetching strategy. Batch fetching can also be configured at the class level as follows:</div>
このコードでは<code>batchSize</code>引数が指定されています。この指定によって、<code>flights</code>が保持している各<code>Flight</code>インスタンスにアクセスするときに、10個単位で、一括して結果を取得するようになります。例えば、ある<code>Airport</code>インスタンスが30個の<code>Flight</code>インスタンスを保持しているとします。一括フェッチングが指定されていなければ、1つの<code>Flight</code>インスタンスにつき1回のクエリーを発行するので、全<code>Flight</code>インスタンスにアクセスするには、合計30個のクエリーが必要になります。一方、一括フェッチングが上記のように指定されていれば、10個の<code>Flight</code>インスタンスを1回のクエリーで取得するようになるので、必要なクエリーの数は3回になります。すなわち、一括フェッチングは、lazyフェッチングの最適化の1手法と言うことができます。なお、一括フェッチングは、以下のように、クラスのレベルで指定することも可能です:<p class="paragraph"/><div class="code"><pre>class Flight &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        batchSize 10
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Check out <a href="http://blog.springsource.com/2010/07/28/gorm-gotchas-part-3/" target="blank">part 3</a> of the GORM Gotchas series for more in-depth coverage of this tricky topic.</div>
この部分について、より深く、網羅的な知識が必要な場合には、<a href="http://blog.springsource.com/2010/07/28/gorm-gotchas-part-3/" target="blank">GORM Gotchas (Part 3)</a>の記事を参照してください。


<a name="5.3.5 Pessimistic and Optimistic Locking"><!-- Legacy link --></a>
<h2 id="locking">6.3.5 悲観的ロックと楽観的ロック</h2>
<div class="hidden-block">h4. Optimistic Locking</div>
<h4>楽観的ロック</h4><p class="paragraph"/><div class="hidden-block">By default GORM classes are configured for optimistic locking. Optimistic locking is a feature of Hibernate which involves storing a version value in a special <code>version</code> column in the database that is incremented after each update.</div>
GORMでは、デフォルトで、各ドメインクラスは楽観的ロックを使うように設定されています。
楽観的ロックは、Hibernateが備えている機能の1つです。
データベース上の専用の<code>version</code>カラムにバージョン番号を格納して、レコードを更新する度に値をインクリメントします。<p class="paragraph"/><div class="hidden-block">The <code>version</code> column gets read into a <code>version</code> property that contains the current versioned state of persistent instance which you can access:</div>
<code>version</code>カラムは、永続化済みのドメインクラスインスタンスの<code>version</code>プロパティとして読み込まれます。
このプロパティを使って、データベースから取得した時点のバージョン番号を取得できます。
以下にコード例を示します:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)<p class="paragraph"/>println airport.version</pre></div><p class="paragraph"/><div class="hidden-block">When you perform updates Hibernate will automatically check the version property against the  version column in the database and if they differ will throw a <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/StaleObjectStateException.html" class="api">StaleObjectException</a>. This will roll back the transaction if one is active.</div>
データベースを更新するときには、Hibernateは自動的に、データベースの<code>version</code>カラムに格納されている値と、更新対象のインスタンスが保持している<code>version</code>プロパティの値を比較します。
そして、2つの値が異なる場合には<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/StaleObjectStateException.html" class="api">StaleObjectException</a>例外をスローします。
トランザクションが有効な場合は、この例外発生によって、トランザクションもロールバックします。<p class="paragraph"/><div class="hidden-block">This is useful as it allows a certain level of atomicity without resorting to pessimistic locking that has an inherit performance penalty. The downside is that you have to deal with this exception if you have highly concurrent writes. This requires flushing the session:</div>
この方法は、本質的に性能上の問題をかかえている悲観的ロックに頼らずとも、ある水準の原子性を保証することができる点が便利ですが、一方で短所も存在します。
それは、実際に並行に更新が発生してしまった場合に、開発者が明示的に例外処理しなければならいという点です。
そして、この例外処理のためにはセッションのフラッシュが必要になります:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)<p class="paragraph"/><span class="java&#45;keyword">try</span> &#123;
    airport.name = <span class="java&#45;quote">"Heathrow"</span>
    airport.save(flush: <span class="java&#45;keyword">true</span>)
&#125;
<span class="java&#45;keyword">catch</span> (org.springframework.dao.OptimisticLockingFailureException e) &#123;
    // deal with exception
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The way you deal with the exception depends on the application. You could attempt a programmatic merge of the data or go back to the user and ask them to resolve the conflict.</div>
この例外が発生した時にどのように振る舞うべきかは、アプリケーションの要件に依存します。
たとえば、競合が発生したデータを機械的にマージする、エンドユーザに競合を解決するように頼む、などの振る舞いが考えられるでしょう。<p class="paragraph"/><div class="hidden-block">Alternatively, if it becomes a problem you can resort to pessimistic locking.</div>
あるいは、そのような振る舞いをすることが問題になることもあるでしょう。
そのときは最後の手段として、悲観的ロックを使うこともできます。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">The <code>version</code> will only be updated after flushing the session.</div>
<code>version</code>プロパティの値は、セッションをフラッシュしない限り更新されません。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Pessimistic Locking</div>
<h4>悲観的ロック</h4><p class="paragraph"/><div class="hidden-block">Pessimistic locking is equivalent to doing a SQL "SELECT * FOR UPDATE" statement and locking a row in the database. This has the implication that other read operations will be blocking until the lock is released.</div>
悲観的ロックの利用は、"SELECT * FOR UPDATE" というSQL文を発行して、データベースの行をロックすることに相当します。
そのため、行ロックがリリースされるまでは、他の読み取り操作もブロックされてしまいます。<p class="paragraph"/><div class="hidden-block">In Grails pessimistic locking is performed on an existing instance with the <a href="../ref/Domain Classes/lock.html" class="domainClasses">lock</a> method:</div>
Grailsでは、ドメインクラスのインスタンスに対して<a href="../ref/Domain Classes/lock.html" class="domainClasses">lock</a>メソッドを発行することで、悲観的ロックを使うことができます:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)
airport.lock() // lock <span class="java&#45;keyword">for</span> update
airport.name = <span class="java&#45;quote">"Heathrow"</span>
airport.save()</pre></div><p class="paragraph"/><div class="hidden-block">Grails will automatically deal with releasing the lock for you once the transaction has been committed. However, in the above case what we are doing is "upgrading" from a regular SELECT to a SELECT..FOR UPDATE and another thread could still have updated the record in between the call to <code>get()</code> and the call to <code>lock()</code>.</div>
このようにして獲得したロックは、トランザクションがコミットされたタイミングで、Grailsによって自動的にリリースされます。
ただし、この方法は、通常のSELECT文で一旦レコードを取得した後に、SELECT..FOR UPDATE文で取得し直すことになってしまうことに注意してください。
そのため、<code>get()</code>メソッドを呼び出してから<code>lock()</code>メソッドを呼び出す間に、他のスレッドがレコードを更新する可能性が残ってしまいます。<p class="paragraph"/><div class="hidden-block">To get around this problem you can use the static <a href="../ref/Domain Classes/lock.html" class="domainClasses">lock</a> method that takes an id just like <a href="../ref/Domain Classes/get.html" class="domainClasses">get</a>:</div>
この問題を回避するために、<a href="../ref/Domain Classes/get.html" class="domainClasses">get</a>メソッドと同様にidを引数に取るstaticな<a href="../ref/Domain Classes/lock.html" class="domainClasses">lock</a>メソッドが使えます:<p class="paragraph"/><div class="code"><pre>def airport = Airport.lock(10) // lock <span class="java&#45;keyword">for</span> update
airport.name = <span class="java&#45;quote">"Heathrow"</span>
airport.save()</pre></div><p class="paragraph"/><div class="hidden-block">In this case only SELECT..FOR UPDATE is issued.</div>
この方法を使えば、SELECT..FOR UPDATE文だけが発行されるので、最初の方法のような問題は発生しません。<p class="paragraph"/><div class="hidden-block">As well as the <a href="../ref/Domain Classes/lock.html" class="domainClasses">lock</a> method you can also obtain a pessimistic locking using queries. For example using a dynamic finder:</div>
<a href="../ref/Domain Classes/lock.html" class="domainClasses">lock</a>メソッドを使う方法以外に、クエリで悲観的ロックを使う方法もあります。
たとえば、ダイナミックファインダを使う場合は:<p class="paragraph"/><div class="code"><pre>def airport = Airport.findByName(<span class="java&#45;quote">"Heathrow"</span>, &#91;lock: <span class="java&#45;keyword">true</span>&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">Or using criteria:</div>
クライテリアを使う場合は:<p class="paragraph"/><div class="code"><pre>def airport = Airport.createCriteria().get &#123;
    eq('name', 'Heathrow')
    lock <span class="java&#45;keyword">true</span>
&#125;</pre></div>


<a name="5.3.6 Modification Checking"><!-- Legacy link --></a>
<h2 id="modificationChecking">6.3.6 変更確認</h2>
<div class="hidden-block">Once you have loaded and possibly modified a persistent domain class instance, it isn't straightforward to retrieve the original values. If you try to reload the instance using <a href="../ref/Domain Classes/get.html" class="domainClasses">get</a> Hibernate will return the current modified instance from its Session cache. Reloading using another query would trigger a flush which could cause problems if your data isn't ready to be flushed yet. So GORM provides some methods to retrieve the original values that Hibernate caches when it loads the instance (which it uses for dirty checking).</div>
永続化されたドメインクラスのインスタンスを読み込み、いったん変更を加えると、簡単に元の値を取り出すことはできません。
もし、<a href="../ref/Domain Classes/get.html" class="domainClasses">get</a>を使ってインスタンスを再読み込みしようとすると、Hibernateはセッションのキャッシュから現在変更を加えたインスタンスを返します。
まだデータがフラッシュできる状態でない場合、他のクエリを使って再読み込みをしようとすると、データがフラッシュできる状態でないにもかかわらずフラッシュが行われ問題を引き起こします。
GORMは、Hibernateがインスタンスの読み込み時にキャッシュする値(このインスタンスはdirtyチェックに使われる)を取り出すいくつかのメソッドを提供します。<p class="paragraph"/><div class="hidden-block">h4. isDirty</div>
<h4>isDirty</h4><p class="paragraph"/><div class="hidden-block">You can use the <a href="../ref/Domain Classes/isDirty.html" class="domainClasses">isDirty</a> method to check if any field has been modified:</div>
フィールドに変更が加えられているかどうかのチェックに、<a href="../ref/Domain Classes/isDirty.html" class="domainClasses">isDirty</a>メソッドが使えます:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)
assert !airport.isDirty()<p class="paragraph"/>airport.properties = params
<span class="java&#45;keyword">if</span> (airport.isDirty()) &#123;
   // <span class="java&#45;keyword">do</span> something based on changed state
&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="note">
<code>isDirty()</code> does not currently check collection associations, but it does check all other persistent properties and associations.
</blockquote></div>
<blockquote class="note">
<code>isDirty()</code>は、今のところ関連のコレクションをチェックしません。
しかし、他のすべての永続化プロパティと関連をチェックします。
</blockquote><p class="paragraph"/><div class="hidden-block">You can also check if individual fields have been modified:</div>
個々のフィールドが変更されいているかチェックすることもできます:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)
assert !airport.isDirty()<p class="paragraph"/>airport.properties = params
<span class="java&#45;keyword">if</span> (airport.isDirty('name')) &#123;
   // <span class="java&#45;keyword">do</span> something based on changed name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. getDirtyPropertyNames</div>
<h4>getDirtyPropertyNames</h4><p class="paragraph"/><div class="hidden-block">You can use the <a href="../ref/Domain Classes/getDirtyPropertyNames.html" class="domainClasses">getDirtyPropertyNames</a> method to retrieve the names of modified fields; this may be empty but will not be null:</div>
変更されたフィールドの名前を取得するには<a href="../ref/Domain Classes/getDirtyPropertyNames.html" class="domainClasses">getDirtyPropertyNames</a>メソッドを使います。
このメソッドは空リストを返すかもしれませんが、nullを返すことはありません:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)
assert !airport.isDirty()<p class="paragraph"/>airport.properties = params
def modifiedFieldNames = airport.getDirtyPropertyNames()
<span class="java&#45;keyword">for</span> (fieldName in modifiedFieldNames) &#123;
   // <span class="java&#45;keyword">do</span> something based on changed value
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. getPersistentValue</div>
<h4>getPersistentValue</h4><p class="paragraph"/><div class="hidden-block">You can use the <a href="../ref/Domain Classes/getPersistentValue.html" class="domainClasses">getPersistentValue</a> method to retrieve the value of a modified field:</div>
変更されたフィールドの元の値を取得するには<a href="../ref/Domain Classes/getPersistentValue.html" class="domainClasses">getPersistentValue</a>メソッドを使います:<p class="paragraph"/><div class="code"><pre>def airport = Airport.get(10)
assert !airport.isDirty()<p class="paragraph"/>airport.properties = params
def modifiedFieldNames = airport.getDirtyPropertyNames()
<span class="java&#45;keyword">for</span> (fieldName in modifiedFieldNames) &#123;
    def currentValue = airport.<span class="java&#45;quote">"$fieldName"</span>
    def originalValue = airport.getPersistentValue(fieldName)
    <span class="java&#45;keyword">if</span> (currentValue != originalValue) &#123;
        // <span class="java&#45;keyword">do</span> something based on changed value
    &#125;
&#125;</pre></div><p class="paragraph"/>

<a name="5.4 Querying with GORM"><!-- Legacy link --></a>
<h2 id="querying">6.4 GORMでのクエリー</h2>
<div class="hidden-block">GORM supports a number of powerful ways to query from dynamic finders, to criteria to Hibernate's object oriented query language HQL. Depending on the complexity of the query you have the following options in order of flexibility and power:</div>
GORMはダイナミックファインダーやHibernateのオブジェクト指向クエリー言語HQLなど、多くの便利な方法を提供します。クエリーの複雑さを考慮して、以下のような選択肢から選択することができます。上位にある選択肢ほど柔軟性と利便性が高くなります。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Dynamic Finders</li>
<li>Where Queries</li>
<li>Criteria Queries</li>
<li>Hibernate Query Language (HQL)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>ダイナミックファインダー</li>
<li>Whereクエリー</li>
<li>クライテリアクエリー</li>
<li>Hibernateクエリー言語 (HQL)</li>
</ul><p class="paragraph"/><div class="hidden-block">In addition, Groovy's ability to manipulate collections with <a href="http://groovy.codehaus.org/GPath" target="blank">GPath</a> and methods like sort, findAll and so on combined with GORM results in a powerful combination.</div>
さらに、Groovyの機能であるコレクション操作機能 <a href="http://groovy.codehaus.org/Japanese+GPath" target="blank">GPath</a> と、GORMの持つsortやfindAllなどのメソッドの組み合わせは、すばらしい結果をもたらします。<p class="paragraph"/><div class="hidden-block">However, let's start with the basics.</div>
まずは、基本的な使い方から始めましょう。<p class="paragraph"/><div class="hidden-block">h4. Listing instances</div>
<h4>インスタンスの一覧取得</h4><p class="paragraph"/><div class="hidden-block">Use the <a href="../ref/Domain Classes/list.html" class="domainClasses">list</a> method to obtain all instances of a given class:</div>
対象のクラスのすべてのインスタンスを取得するには、<a href="../ref/Domain Classes/list.html" class="domainClasses">list</a>を使います。:<p class="paragraph"/><div class="code"><pre>def books = Book.list()</pre></div><p class="paragraph"/><div class="hidden-block">The <a href="../ref/Domain Classes/list.html" class="domainClasses">list</a> method supports arguments to perform pagination:</div>
以下の様に、<a href="../ref/Domain Classes/list.html" class="domainClasses">list</a>メソッドは、行数を指定するための引数をサポートします。:<p class="paragraph"/><div class="code"><pre>def books = Book.list(offset:10, max:20)</pre></div><p class="paragraph"/><div class="hidden-block">as well as sorting:</div>
同様に、ソートを行う場合は以下の通りです。:<p class="paragraph"/><div class="code"><pre>def books = Book.list(sort:<span class="java&#45;quote">"title"</span>, order:<span class="java&#45;quote">"asc"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">Here, the <code>sort</code> argument is the name of the domain class property that you wish to sort on, and the <code>order</code> argument is either <code>asc</code> for <strong class="bold">asc</strong>ending or <code>desc</code> for <strong class="bold">desc</strong>ending.</div>
ここで、<code>sort</code>はソート対象にしたいドメインクラスのプロパティを指定します。<code>order</code>は<code>asc</code>であれば昇順(<strong class="bold">asc</strong>ending)、<code>desc</code>であれば降順(<strong class="bold">desc</strong>ending)となります。<p class="paragraph"/><div class="hidden-block">h4. Retrieval by Database  Identifier</div>
<h4>データベースのIDによる取得</h4><p class="paragraph"/><div class="hidden-block">The second basic form of retrieval is by database identifier using the <a href="../ref/Domain Classes/get.html" class="domainClasses">get</a> method:</div>
次の検索の基本形は、データベースのIDを利用して、<a href="../ref/Domain Classes/get.html" class="domainClasses">get</a>メソッドで取得する方法です。:<p class="paragraph"/><div class="code"><pre>def book = Book.get(23)</pre></div><p class="paragraph"/><div class="hidden-block">You can also obtain a list of instances for a set of identifiers using <a href="../ref/Domain Classes/getAll.html" class="domainClasses">getAll</a>:</div>
また、複数のIDの組み合わせを指定して<a href="../ref/Domain Classes/getAll.html" class="domainClasses">getAll</a>を使う事で、インスタンスの一覧を取得することもできます。:<p class="paragraph"/><div class="code"><pre>def books = Book.getAll(23, 93, 81)</pre></div>


<a name="5.4.1 Dynamic Finders"><!-- Legacy link --></a>
<h2 id="finders">6.4.1 ダイナミックファインダー</h2>
<div class="hidden-block">GORM supports the concept of <strong class="bold">dynamic finders</strong>. A dynamic finder looks like a static method invocation, but the methods themselves don't actually exist in any form at the code level.</div>
GORMは<strong class="bold">ダイナミックファインダー</strong>のコンセプトをサポートしています。ダイナミックファインダーは静的メソッドの呼び出しのように利用できますが、対象クラスの実際のコード上にはそのようなコードは存在しません。<p class="paragraph"/><div class="hidden-block">Instead, a method is auto-magically generated using code synthesis at runtime, based on the properties of a given class. Take for example the <code>Book</code> class:</div>
それどころか、そのメソッドは与えられたクラスのプロパティに応じ、コードの実行時に自動でコードが生成されます。以下に<code>Book</code>クラスの例をあげます。:<p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;object">String</span> title
    Date releaseDate
    Author author
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>Book</code> class has properties such as <code>title</code>, <code>releaseDate</code> and <code>author</code>. These can be used by the <a href="../ref/Domain Classes/findBy.html" class="domainClasses">findBy</a> and <a href="../ref/Domain Classes/findAllBy.html" class="domainClasses">findAllBy</a> methods in the form of "method expressions":
</div>
<code>Book</code>クラスは<code>title</code>や<code>releaseDate</code>、<code>auther</code>などのプロパティを持ちます。これらのプロパティは"メソッド表現方式"を用いて、<a href="../ref/Domain Classes/findBy.html" class="domainClasses">findBy</a>や<a href="../ref/Domain Classes/findAllBy.html" class="domainClasses">findAllBy</a>メソッド内で使用することができます。<p class="paragraph"/><div class="code"><pre>def book = Book.findByTitle(<span class="java&#45;quote">"The Stand"</span>)<p class="paragraph"/>book = Book.findByTitleLike(<span class="java&#45;quote">"Harry Pot%"</span>)<p class="paragraph"/>book = Book.findByReleaseDateBetween(firstDate, secondDate)<p class="paragraph"/>book = Book.findByReleaseDateGreaterThan(someDate)<p class="paragraph"/>book = Book.findByTitleLikeOrReleaseDateLessThan(<span class="java&#45;quote">"%Something%"</span>, someDate)</pre></div><p class="paragraph"/><div class="hidden-block">h4. Method Expressions</div>
<h4>メソッド表現方式によるメソッド名の指定</h4><p class="paragraph"/><div class="hidden-block">A method expression in GORM is made up of the prefix such as <a href="../ref/Domain Classes/findBy.html" class="domainClasses">findBy</a> followed by an expression that combines one or more properties. The basic form is:</div>
GORMでは、<a href="../ref/Domain Classes/findBy.html" class="domainClasses">findBy</a>に続けて1つ以上のプロパティ名を組み合わせたメソッド名の形式で呼び出す事により、特定のプロパティに対して検索をかけることができます。基本的な書式は以下の通りです。:<p class="paragraph"/><div class="code"><pre>Book.findBy(&#91;Property&#93;&#91;Comparator&#93;&#91;<span class="java&#45;object">Boolean</span> Operator&#93;)?&#91;Property&#93;&#91;Comparator&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The tokens marked with a '?' are optional. Each comparator changes the nature of the query. For example:</div>
'?' 以降はオプションとなります。比較演算子によって、自然な文体でクエリーを書く事が出来るようになります。以下はその例です。:<p class="paragraph"/><div class="code"><pre>def book = Book.findByTitle(<span class="java&#45;quote">"The Stand"</span>)<p class="paragraph"/>book =  Book.findByTitleLike(<span class="java&#45;quote">"Harry Pot%"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">In the above example the first query is equivalent to equality whilst the latter, due to the <code>Like</code> comparator, is equivalent to a SQL <code>like</code> expression.</div>
上の例では、1つ目のクエリーは指定された文字列と<code>title</code>が一致するものを検索します。2番目の<code>Like</code>比較演算子を使ったクエリーは、SQLの<code>like</code>表現と同様の検索を行います。<p class="paragraph"/><div class="hidden-block">The possible comparators include:</div>
利用できる比較演算子には以下が含まれます。：<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>InList</code> - In the list of given values</li>
<li><code>LessThan</code> - less than a given value</li>
<li><code>LessThanEquals</code> - less than or equal a give value</li>
<li><code>GreaterThan</code> - greater than a given value</li>
<li><code>GreaterThanEquals</code> - greater than or equal a given value</li>
<li><code>Like</code> - Equivalent to a SQL like expression</li>
<li><code>Ilike</code> - Similar to a <code>Like</code>, except case insensitive</li>
<li><code>NotEqual</code> - Negates equality</li>
<li><code>Between</code> - Between two values (requires two arguments)</li>
<li><code>IsNotNull</code> - Not a null value (doesn't take an argument)</li>
<li><code>IsNull</code> - Is a null value (doesn't take an argument)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>InList</code> - パラメータの値のリストのいずれかに一致する</li>
<li><code>LessThan</code> - パラメータの値よりも小さい</li>
<li><code>LessThanEquals</code> - パラメータの値より小さいか、等しい</li>
<li><code>GreaterThan</code> - パラメータの値より大きい</li>
<li><code>GreaterThanEquals</code> - パラメータの値より大きいか、等しい</li>
<li><code>Like</code> - SQL文の Like句と同様</li>
<li><code>Ilike</code> - 上の<code>Like</code>の同類だが、アルファベットの大文字と小文字の差を無視する</li>
<li><code>NotEqual</code> - パラメータの値と等しくない</li>
<li><code>Between</code> - 2つの値の範囲内である (2つのパラメータが必要)</li>
<li><code>IsNotNull</code> - Nullではない (パラメータ不要)</li>
<li><code>IsNull</code> - Nullである (パラメータ不要)</li>
</ul><p class="paragraph"/><div class="hidden-block">Notice that the last three require different numbers of method arguments compared to the rest, as demonstrated in the following example:</div>
最後の3つのメソッドの引数の数が、他のメソッドと違うのに気が付きましたか？ 以下にサンプルコードを示します。:<p class="paragraph"/><div class="code"><pre>def now = <span class="java&#45;keyword">new</span> Date()
def lastWeek = now &#45; 7
def book = Book.findByReleaseDateBetween(lastWeek, now)<p class="paragraph"/>books = Book.findAllByReleaseDateIsNull()
books = Book.findAllByReleaseDateIsNotNull()</pre></div><p class="paragraph"/><div class="hidden-block">h4. Boolean logic (AND/OR)</div>
<h4>AND/ORによる複数条件</h4><p class="paragraph"/><div class="hidden-block">Method expressions can also use a boolean operator to combine two or more criteria:</div>
メソッド表現方式では、ANDやORを利用して複数のクライテリアを結合することもできます。:<p class="paragraph"/><div class="code"><pre>def books = Book.findAllByTitleLikeAndReleaseDateGreaterThan(
                      <span class="java&#45;quote">"%Java%"</span>, <span class="java&#45;keyword">new</span> Date() &#45; 30)</pre></div><p class="paragraph"/><div class="hidden-block">In this case we're using <code>And</code> in the middle of the query to make sure both conditions are satisfied, but you could equally use <code>Or</code>:</div>
この例では２つの条件を共に満たすように<code>And</code>を使いましたが、同様のやり方で<code>Or</code>を使うこともできます:<p class="paragraph"/><div class="code"><pre>def books = Book.findAllByTitleLikeOrReleaseDateGreaterThan(
                      <span class="java&#45;quote">"%Java%"</span>, <span class="java&#45;keyword">new</span> Date() &#45; 30)</pre></div><p class="paragraph"/><div class="hidden-block">You can combine as many criteria as you like, but they must all be combined with <code>And</code> or all <code>Or</code>. If you need to combine <code>And</code> and <code>Or</code> or if the number of criteria creates a very long method name, just convert the query to a <a href="../guide/single.html#criteria" class="guide">Criteria</a> or <a href="../guide/single.html#hql" class="guide">HQL</a> query.</div>
GORMでは、好きなだけのクライテリアを<code>And</code>や<code>Or</code>を使用して結合することができます。また、メソッド名があまりにも長くなりすぎてしまったときは、クエリーを<a href="../guide/single.html#criteria" class="guide">Criteria</a>や<a href="../guide/single.html#hql" class="guide">HQL</a>に変換することもできます。<p class="paragraph"/><div class="hidden-block">h4. Querying Associations</div>
<h4>クエリーと関連</h4><p class="paragraph"/><div class="hidden-block">Associations can also be used within queries:</div>
ドメインクラス同士の関連はクエリーの中でも利用することが出来ます。:<p class="paragraph"/><div class="code"><pre>def author = Author.findByName(<span class="java&#45;quote">"Stephen King"</span>)<p class="paragraph"/>def books = author ? Book.findAllByAuthor(author) : &#91;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">In this case if the <code>Author</code> instance is not null we use it in a query to obtain all the <code>Book</code> instances for the given <code>Author</code>.</div>
上記のようなケースでは、<code>Author</code>インスタンスがNullの場合は空の集合を返し、そうでない場合はパラメータに指定した<code>Author</code>が持つ全ての<code>Book</code>インスタンスを取得します。<p class="paragraph"/><div class="hidden-block">h4. Pagination and Sorting</div>
<h4>ページングとソート</h4><p class="paragraph"/><div class="hidden-block">The same pagination and sorting parameters available on the <a href="../ref/Domain Classes/list.html" class="domainClasses">list</a> method can also be used with dynamic finders by supplying a map as the final parameter:</div>
ダイナミックファインダーのパラメータの末尾に追加のパラメータを指定する事で、ページングとソートを行うことが出来ます。:<p class="paragraph"/><div class="code"><pre>def books = Book.findAllByTitleLike(<span class="java&#45;quote">"Harry Pot%"</span>,
               &#91;max: 3, offset: 2, sort: <span class="java&#45;quote">"title"</span>, order: <span class="java&#45;quote">"desc"</span>&#93;)</pre></div>



<h2 id="whereQueries">6.4.2 Whereクエリー</h2>
<div class="hidden-block">The <code>where</code> method, introduced in Grails 2.0, builds on the support for <a href="../guide/single.html#detachedCriteria" class="guide">Detached Criteria</a> by providing an enhanced, compile-time checked query DSL for common queries. The <code>where</code> method is more flexible than dynamic finders, less verbose than criteria and provides a powerful mechanism to compose queries.</div>
Grails 2.0から実装された<code>where</code>メソッドは<a href="../guide/single.html#detachedCriteria" class="guide">Detached Criteria</a>の拡張であり、コンパイル時に型チェックなどを実施することが出来るDSLクエリー言語を実現しています。また、<code>where</code>メソッドはダイナミックファインダーより柔軟で、クライテリアよりは冗長ではないクエリー作成のメカニズムを提供します。<p class="paragraph"/><div class="hidden-block">h4. Basic Querying</div>
<h4>基本の構文</h4><p class="paragraph"/><div class="hidden-block">The <code>where</code> method accepts a closure that looks very similar to Groovy's regular collection methods. The closure should define the logical criteria in regular Groovy syntax, for example:</div>
<code>where</code>メソッドはGroovyのコレクションの標準的なメソッドによく似たを受け取ります。このクロージャは標準的なGroovyの文法に従います。例えば以下の通りです。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
   firstName == <span class="java&#45;quote">"Bart"</span>
&#125;
Person bart = query.find()</pre></div><p class="paragraph"/><div class="hidden-block">The returned object is a <code>DetachedCriteria</code> instance, which means it is not associated with any particular database connection or session. This means you can use the <code>where</code> method to define common queries at the class level:</div>
<code>where</code>メソッドから返ってくるのは<code>DetachedCriteria</code>のインスタンスです。つまり、この段階では特定のデータベース接続やセッションと紐づいているわけではありません。そのため、共通的なクエリーをクラスレベルで定義したい場合にも<code>where</code>メソッドを追加して対応する事が出来ます。:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;keyword">static</span> simpsons = where &#123;
         lastName == <span class="java&#45;quote">"Simpson"</span>
    &#125;
    &#8230;
&#125;
&#8230;
Person.simpsons.each &#123;
    println it.firstname
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Query execution is lazy and only happens upon usage of the <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> instance. If you want to execute a where-style query immediately there are variations of the <code>findAll</code> and <code>find</code> methods to accomplish this:</div>
実際のクエリーは<a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a>インスタンスの使用時に遅れて実行されます。もし即座にwhere形式のクエリーを実行したい場合、以下のように<code>findAll</code>や<code>find</code>メソッドの引数として指定してください。:<p class="paragraph"/><div class="code"><pre>def results = Person.findAll &#123;
     lastName == <span class="java&#45;quote">"Simpson"</span>
&#125;
def results = Person.findAll(sort:<span class="java&#45;quote">"firstName"</span>) &#123;
     lastName == <span class="java&#45;quote">"Simpson"</span>
&#125;
Person p = Person.find &#123; firstName == <span class="java&#45;quote">"Bart"</span> &#125;</pre></div><p class="paragraph"/><div class="hidden-block">Each Groovy operator maps onto a regular criteria method. The following table provides a map of Groovy operators to methods:</div>
Groovyで利用できる比較演算子のいずれもクライテリアのメソッドとしてマッピングされています。以下の表はGroovyの比較演算子とクライテリアのメソッドのマッピング表です。:<p class="paragraph"/><div class="hidden-block"><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Operator</th><th>Criteria Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">==</strong></td><td>eq</td><td>Equal to</td></tr><tr class="table-even"><td><strong class="bold">!=</strong></td><td>ne</td><td>Not equal to</td></tr><tr class="table-odd"><td><strong class="bold">&#62;</strong></td><td>gt</td><td>Greater than</td></tr><tr class="table-even"><td><strong class="bold">&#60;</strong></td><td>lt</td><td>Less than</td></tr><tr class="table-odd"><td><strong class="bold">&#62;=</strong></td><td>ge</td><td>Greater than or equal to</td></tr><tr class="table-even"><td><strong class="bold">&#60;=</strong></td><td>le</td><td>Less than or equal to</td></tr><tr class="table-odd"><td><strong class="bold">in</strong></td><td>inList</td><td>Contained within the given list</td></tr><tr class="table-even"><td><strong class="bold">==~</strong></td><td>like</td><td>Like a given string</td></tr><tr class="table-odd"><td><strong class="bold">=~</strong></td><td>ilike</td><td>Case insensitive like</td></tr></table></div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>比較演算子</th><th>クライテリアのメソッド</th><th>説明</th></tr><tr class="table-odd"><td><strong class="bold">==</strong></td><td>eq</td><td>一致する</td></tr><tr class="table-even"><td><strong class="bold">!=</strong></td><td>ne</td><td>一致しない</td></tr><tr class="table-odd"><td><strong class="bold">&#62;</strong></td><td>gt</td><td>より大きい</td></tr><tr class="table-even"><td><strong class="bold">&#60;</strong></td><td>lt</td><td>より小さい</td></tr><tr class="table-odd"><td><strong class="bold">&#62;=</strong></td><td>ge</td><td>以上</td></tr><tr class="table-even"><td><strong class="bold">&#60;=</strong></td><td>le</td><td>以下</td></tr><tr class="table-odd"><td><strong class="bold">in</strong></td><td>inList</td><td>指定されたリストのいずれかと一致する</td></tr><tr class="table-even"><td><strong class="bold">==~</strong></td><td>like</td><td>指定された文字列とのLike比較</td></tr><tr class="table-odd"><td><strong class="bold">=~</strong></td><td>ilike</td><td>指定された文字列とのLike比較(大文字小文字の違いを無視)</td></tr></table><p class="paragraph"/><div class="hidden-block">It is possible use regular Groovy comparison operators and logic to formulate complex queries:</div>
Groovyの比較演算子と論理演算子を使う事で複雑なクエリを構成することが出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    (lastName != <span class="java&#45;quote">"Simpson"</span> &#38;&#38; firstName != <span class="java&#45;quote">"Fred"</span>) || (firstName == <span class="java&#45;quote">"Bart"</span> &#38;&#38; age &#62; 9)
&#125;
def results = query.list(sort:<span class="java&#45;quote">"firstName"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">The Groovy regex matching operators map onto like and ilike queries unless the expression on the right hand side is a <code>Pattern</code> object, in which case they map onto an <code>rlike</code> query:</div>
Groovyの正規表現マッチング演算子は<code>like</code>と<code>ilike</code>メソッドにマッピングされます。もし右側が<code>Pattern</code>オブジェクトになっていれば、<code>rlike</code>メソッドにマッピングされます。:<p class="paragraph"/>
<div class="code"><pre>def query = Person.where &#123;
     firstName ==~ ~/B.+/
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
Note that <code>rlike</code> queries are only supported if the underlying database supports regular expressions
</blockquote>
</div>
<blockquote class="note">
<code>rlike</code>クエリーは正規表現をサポートしているデータベースでのみ利用できることに注意してください。
</blockquote><p class="paragraph"/><div class="hidden-block">A <code>between</code> criteria query can be done by combining the <code>in</code> keyword with a range:</div>
<code>between</code>クライテリアクエリーは<code>in</code>による範囲指定で同様の結果を得る事が出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
     age in 18..65
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Finally, you can do <code>isNull</code> and <code>isNotNull</code> style queries by using <code>null</code> with regular comparison operators:</div>
<code>isNull</code>や<code>isNotNull</code>を条件にしたい場合、<code>null</code>キーワードと比較演算子を使う事で条件指定する事が出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
     middleName == <span class="java&#45;keyword">null</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Query Composition</div>
<h4>クエリーの構成</h4><p class="paragraph"/><div class="hidden-block">Since the return value of the <code>where</code> method is a <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> instance you can compose new queries from the original query:</div>
<code>where</code>メソッドの戻り値は<a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a>インスタンスです。戻り値の<a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a>インスタンスを元に、さらに条件を追加したクエリーを作成することが出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
     lastName == <span class="java&#45;quote">"Simpson"</span>
&#125;
def bartQuery = query.where &#123;
     firstName == <span class="java&#45;quote">"Bart"</span>
&#125;
Person p = bartQuery.find()</pre></div><p class="paragraph"/><div class="hidden-block">Note that you cannot pass a closure defined as a variable into the <code>where</code> method unless it has been explicitly cast to a <code>DetachedCriteria</code> instance. In other words the following will produce an error:</div>
明示的に<code>DetachedCriteria</code>インスタンスとしてキャストされていない限り、<code>where</code>メソッドのパラメータとして渡すことは出来ない事に注意してください。以下のような例ではエラーが発生します。:<p class="paragraph"/><div class="code"><pre>def callable = &#123;
    lastName == <span class="java&#45;quote">"Simpson"</span>
&#125;
def query = Person.where(callable)</pre></div><p class="paragraph"/><div class="hidden-block">The above must be written as follows:</div>
上記の例は以下のように修正する必要があります。:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.gorm.DetachedCriteria<p class="paragraph"/>def callable = &#123;
    lastName == <span class="java&#45;quote">"Simpson"</span>
&#125; as DetachedCriteria&#60;Person&#62;
def query = Person.where(callable)</pre></div><p class="paragraph"/><div class="hidden-block">As you can see the closure definition is cast (using the Groovy <code>as</code> keyword) to a <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> instance targeted at the <code>Person</code> class.</div>
上記のようにGroovyの<code>as</code>キーワードを使えば、クロージャの定義を<code>Person</code>クラス向けの<a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a>インスタンスとしてキャストする事が出来ます。<p class="paragraph"/><div class="hidden-block">h4. Conjunction, Disjunction and Negation</div>
<h4>論理積、論理和と否定</h4><p class="paragraph"/><div class="hidden-block">As mentioned previously you can combine regular Groovy logical operators (<code>||</code> and <code>&#38;&#38;</code>) to form conjunctions and disjunctions:</div>
既に記載したように、論理積や論理和を指定するためにGroovyの論理演算子(<code>||</code>や<code>&#38;&#38;</code>)を組み合わせる事が出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    (lastName != <span class="java&#45;quote">"Simpson"</span> &#38;&#38; firstName != <span class="java&#45;quote">"Fred"</span>) || (firstName == <span class="java&#45;quote">"Bart"</span> &#38;&#38; age &#62; 9)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also negate a logical comparison using <code>!</code>:</div>
また、論理演算子の比較結果を<code>!</code>を使って否定する事もできます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    firstName == <span class="java&#45;quote">"Fred"</span> &#38;&#38; !(lastName == 'Simpson')
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Property Comparison Queries</div>
<h4>プロパティの比較クエリー</h4><p class="paragraph"/><div class="hidden-block">If you use a property name on both the left hand and right side of a comparison expression then the appropriate property comparison criteria is automatically used:</div>
比較式の両辺にプロパティ名を指定した場合、適切なプロパティの比較クライテリアが自動的に使用されます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
   firstName == lastName
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The following table described how each comparison operator maps onto each criteria property comparison method:</div>
以下の表は比較演算子とクライテリアのプロパティ比較メソッドの対応表です。:<p class="paragraph"/><div class="hidden-block"><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Operator</th><th>Criteria Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">==</strong></td><td>eqProperty</td><td>Equal to</td></tr><tr class="table-even"><td><strong class="bold">!=</strong></td><td>neProperty</td><td>Not equal to</td></tr><tr class="table-odd"><td><strong class="bold">&#62;</strong></td><td>gtProperty</td><td>Greater than</td></tr><tr class="table-even"><td><strong class="bold">&#60;</strong></td><td>ltProperty</td><td>Less than</td></tr><tr class="table-odd"><td><strong class="bold">&#62;=</strong></td><td>geProperty</td><td>Greater than or equal to</td></tr><tr class="table-even"><td><strong class="bold">&#60;=</strong></td><td>leProperty</td><td>Less than or equal to</td></tr></table></div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>演算子</th><th>クライテリアのメソッド</th><th>説明</th></tr><tr class="table-odd"><td><strong class="bold">==</strong></td><td>eqProperty</td><td>一致する</td></tr><tr class="table-even"><td><strong class="bold">!=</strong></td><td>neProperty</td><td>一致しない</td></tr><tr class="table-odd"><td><strong class="bold">&#62;</strong></td><td>gtProperty</td><td>より大きい</td></tr><tr class="table-even"><td><strong class="bold">&#60;</strong></td><td>ltProperty</td><td>より小さい</td></tr><tr class="table-odd"><td><strong class="bold">&#62;=</strong></td><td>geProperty</td><td>以上</td></tr><tr class="table-even"><td><strong class="bold">&#60;=</strong></td><td>leProperty</td><td>以下</td></tr></table><p class="paragraph"/><div class="hidden-block">h4. Querying Associations</div>
<h4>関連を利用したクエリー</h4><p class="paragraph"/><div class="hidden-block">Associations can be queried by using the dot operator to specify the property name of the association to be queried:</div>
ピリオド演算子を使用すれば、関連先のプロパティ名を指定することが出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Pet.where &#123;
    owner.firstName == <span class="java&#45;quote">"Joe"</span> || owner.firstName == <span class="java&#45;quote">"Fred"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can group multiple criterion inside a closure method call where the name of the method matches the association name:</div>
クロージャメソッド呼出の内部において、関連の名前に一致する複数のクライテリアをグループ化する事ができます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    pets &#123; name == <span class="java&#45;quote">"Jack"</span> || name == <span class="java&#45;quote">"Joe"</span> &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This technique can be combined with other top-level criteria:</div>
同様に上位レベルのクライテリアと結合する事も出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
     pets &#123; name == <span class="java&#45;quote">"Jack"</span> &#125; || firstName == <span class="java&#45;quote">"Ed"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">For collection associations it is possible to apply queries to the size of the collection:</div>
1対多の関連ではコレクションのサイズをクエリーに利用する事が出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
       pets.size() == 2
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The following table shows which operator maps onto which criteria method for each size() comparison:</div>
以下の表は演算子とsize()との比較に利用されるクライテリアのメソッドの対応表です。:<p class="paragraph"/><div class="hidden-block"><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Operator</th><th>Criteria Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">==</strong></td><td>sizeEq</td><td>The collection size is equal to</td></tr><tr class="table-even"><td><strong class="bold">!=</strong></td><td>sizeNe</td><td>The collection size is not equal to</td></tr><tr class="table-odd"><td><strong class="bold">&#62;</strong></td><td>sizeGt</td><td>The collection size is greater than</td></tr><tr class="table-even"><td><strong class="bold">&#60;</strong></td><td>sizeLt</td><td>The collection size is less than</td></tr><tr class="table-odd"><td><strong class="bold">&#62;=</strong></td><td>sizeGe</td><td>The collection size is greater than or equal to</td></tr><tr class="table-even"><td><strong class="bold">&#60;=</strong></td><td>sizeLe</td><td>The collection size is less than or equal to</td></tr></table></div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>演算子</th><th>クライテリアのメソッド</th><th>説明</th></tr><tr class="table-odd"><td><strong class="bold">==</strong></td><td>sizeEq</td><td>コレクションのサイズが等しい</td></tr><tr class="table-even"><td><strong class="bold">!=</strong></td><td>sizeNe</td><td>コレクションのサイズが等しくない</td></tr><tr class="table-odd"><td><strong class="bold">&#62;</strong></td><td>sizeGt</td><td>コレクションのサイズより大きい</td></tr><tr class="table-even"><td><strong class="bold">&#60;</strong></td><td>sizeLt</td><td>コレクションのサイズより小さい</td></tr><tr class="table-odd"><td><strong class="bold">&#62;=</strong></td><td>sizeGe</td><td>コレクションのサイズ以上</td></tr><tr class="table-even"><td><strong class="bold">&#60;=</strong></td><td>sizeLe</td><td>コレクションのサイズ以下</td></tr></table><p class="paragraph"/>
<div class="hidden-block">h4. Subqueries</div>
<h4>サブクエリー</h4><p class="paragraph"/><div class="hidden-block">It is possible to execute subqueries within where queries. For example to find all the people older than the average age the following query can be used:</div>
Whereクエリーの内部ではサブクエリーを実行する事が出来ます。たとえば、平均より大きいageを持つPersonを検索するには以下のようになります。:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">final</span> query = Person.where &#123;
  age &#62; avg(age)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The following table lists the possible subqueries:</div>
以下の表は利用可能なサブクエリーのリストです。:<p class="paragraph"/><div class="hidden-block"><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">avg</strong></td><td>The average of all values</td></tr><tr class="table-even"><td><strong class="bold">sum</strong></td><td>The sum of all values</td></tr><tr class="table-odd"><td><strong class="bold">max</strong></td><td>The maximum value</td></tr><tr class="table-even"><td><strong class="bold">min</strong></td><td>The minimum value</td></tr><tr class="table-odd"><td><strong class="bold">count</strong></td><td>The count of all values</td></tr><tr class="table-even"><td><strong class="bold">property</strong></td><td>Retrieves a property of the resulting entities</td></tr></table></div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>メソッド</th><th>説明</th></tr><tr class="table-odd"><td><strong class="bold">avg</strong></td><td>全ての値の平均</td></tr><tr class="table-even"><td><strong class="bold">sum</strong></td><td>全ての値の合計</td></tr><tr class="table-odd"><td><strong class="bold">max</strong></td><td>最大値</td></tr><tr class="table-even"><td><strong class="bold">min</strong></td><td>最小値</td></tr><tr class="table-odd"><td><strong class="bold">count</strong></td><td>全ての値の個数</td></tr><tr class="table-even"><td><strong class="bold">property</strong></td><td>結果のエンティティのプロパティを取得する。</td></tr></table><p class="paragraph"/><div class="hidden-block">
You can apply additional criteria to any subquery by using the <code>of</code> method and passing in a closure containing the criteria:
</div>
任意のサブクエリーに<code>of</code>メソッドを使い、クライテリアが含まれているクロージャを渡すことによって、追加のクライテリアを指定することが出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
  age &#62; avg(age).of &#123; lastName == <span class="java&#45;quote">"Simpson"</span> &#125; &#38;&#38; firstName == <span class="java&#45;quote">"Homer"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Since the <code>property</code> subquery returns multiple results, the criterion used compares all results. For example the following query will find all people younger than people with the surname "Simpson":
</div>
<code>property</code>サブクエリーが複数の結果を返すため、クライテリアは全ての結果との比較に利用されます。たとえば、以下の例では姓が"Simpson"である人よりも若い人を検索しています。:<p class="paragraph"/><div class="code"><pre>Person.where &#123;
    age &#60; property(age).of &#123; lastName == <span class="java&#45;quote">"Simpson"</span> &#125;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Other Functions</div>
<h4>その他の機能</h4><p class="paragraph"/><div class="hidden-block">There are several functions available to you within the context of a query. These are summarized in the table below:</div>
クエリーのコンテキストの中で利用できるいくつかの機能が他にもあります。以下の表はその要約です。:<p class="paragraph"/><div class="hidden-block"><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">second</strong></td><td>The second of a date property</td></tr><tr class="table-even"><td><strong class="bold">minute</strong></td><td>The minute of a date property</td></tr><tr class="table-odd"><td><strong class="bold">hour</strong></td><td>The hour of a date property</td></tr><tr class="table-even"><td><strong class="bold">day</strong></td><td>The day of the month of a date property</td></tr><tr class="table-odd"><td><strong class="bold">month</strong></td><td>The month of a date property</td></tr><tr class="table-even"><td><strong class="bold">year</strong></td><td>The year of a date property</td></tr><tr class="table-odd"><td><strong class="bold">lower</strong></td><td>Converts a string property to upper case</td></tr><tr class="table-even"><td><strong class="bold">upper</strong></td><td>Converts a string property to lower case</td></tr><tr class="table-odd"><td><strong class="bold">length</strong></td><td>The length of a string property</td></tr><tr class="table-even"><td><strong class="bold">trim</strong></td><td>Trims a string property</td></tr></table></div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>メソッド</th><th>説明</th></tr><tr class="table-odd"><td><strong class="bold">second</strong></td><td>日付プロパティの秒</td></tr><tr class="table-even"><td><strong class="bold">minute</strong></td><td>日付プロパティの分</td></tr><tr class="table-odd"><td><strong class="bold">hour</strong></td><td>日付プロパティの時</td></tr><tr class="table-even"><td><strong class="bold">day</strong></td><td>日付プロパティの日</td></tr><tr class="table-odd"><td><strong class="bold">month</strong></td><td>日付プロパティの月</td></tr><tr class="table-even"><td><strong class="bold">year</strong></td><td>日付プロパティの年</td></tr><tr class="table-odd"><td><strong class="bold">lower</strong></td><td>文字列プロパティを小文字に変換</td></tr><tr class="table-even"><td><strong class="bold">upper</strong></td><td>文字列プロパティを大文字に変換</td></tr><tr class="table-odd"><td><strong class="bold">length</strong></td><td>文字列プロパティの長さ</td></tr><tr class="table-even"><td><strong class="bold">trim</strong></td><td>文字列プロパティをトリムする</td></tr></table><p class="paragraph"/>
<div class="hidden-block"><blockquote class="note">
Currently functions can only be applied to properties or associations of domain classes. You cannot, for example, use a function on a result of a subquery. 
</blockquote></div>
<blockquote class="note">
今のところ、これらの機能はプロパティか、ドメインクラスの関連のみで使用できます。例えば、サブクエリーの結果に対してこれらの機能を使用する事はできません。
</blockquote><p class="paragraph"/>
<div class="hidden-block">For example the following query can be used to find all pet's born in 2011:</div>
例えば、以下のクエリーは2011年に生まれた全てのペットを検索することが出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Pet.where &#123;
    year(birthDate) == 2011
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also apply functions to associations:</div>
これらの機能は関連にも使用する事が出来ます。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    year(pets.birthDate) == 2009
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Batch Updates and Deletes</div>
<h4>バッチ更新と削除</h4><p class="paragraph"/><div class="hidden-block">
Since each <code>where</code> method call returns a <a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a> instance, you can use <code>where</code> queries to execute batch operations such as batch updates and deletes. For example, the following query will update all people with the surname "Simpson" to have the surname "Bloggs":
</div>
それぞれの<code>where</code>メソッドの呼び出しが<a href="../guide/single.html#detachedCriteria" class="guide">DetachedCriteria</a>インスタンスを返却するため、バッチ更新や削除などの操作をバッチ操作を実行するために<code>where</code>クエリを使用する事が出来ます。例えば、以下のクエリーは"Bloggs"という姓を持っている全てのPersonを"Simpson"で更新します。:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    lastName == 'Simpson'
&#125;
<span class="java&#45;object">int</span> total = query.updateAll(lastName:<span class="java&#45;quote">"Bloggs"</span>)</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Note that one limitation with regards to batch operations is that join queries (queries that query associations) are not allowed.
</blockquote></div>
<blockquote class="note">
バッチ操作では、関連を使用した結合クエリが許可されていないという制約に注意してください。
</blockquote><p class="paragraph"/><div class="hidden-block">To batch delete records you can use the <code>deleteAll</code> method:</div>
バッチ削除には、<code>deleteAll</code>メソッドを使用する事が出来ます:<p class="paragraph"/><div class="code"><pre>def query = Person.where &#123;
    lastName == 'Simpson'
&#125;
<span class="java&#45;object">int</span> total = query.deleteAll()</pre></div>


<a name="5.4.2 Criteria"><!-- Legacy link --></a>
<h2 id="criteria">6.4.3 クライテリア</h2>
<div class="hidden-block">
Criteria is an advanced way to query that uses a Groovy builder to construct potentially complex queries. It is a much better approach than building up query strings using a <code>StringBuffer</code>.
</div>
クライテリアは、潜在的に複雑なクエリを構築するためにGroovyのビルダを利用するという、クエリのためのより進んだ方法です。
これは<code>StringBuffer</code>を使ってクエリ文字列を構築するより優れたやり方です。<p class="paragraph"/><div class="hidden-block">
Criteria can be used either with the <a href="../ref/Domain Classes/createCriteria.html" class="domainClasses">createCriteria</a> or <a href="../ref/Domain Classes/withCriteria.html" class="domainClasses">withCriteria</a> methods. The builder uses Hibernate's Criteria API. The nodes on this builder map the static methods found in the <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/criterion/Restrictions.html" class="api">Restrictions</a> class of the Hibernate Criteria API. For example:
</div>
クライテリアは<a href="../ref/Domain Classes/createCriteria.html" class="domainClasses">createCriteria</a>メソッド、または<a href="../ref/Domain Classes/withCriteria.html" class="domainClasses">withCriteria</a>メソッドのいずれかで使用できます。
このビルダーはHibernateのクライテリアAPIを使用します。
ビルダー上のノードはHibernateのクライテリアAPIの<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/criterion/Restrictions.html" class="api">Restrictions</a>クラス内の静的メソッドにマッピングされます。
以下はその例です:<p class="paragraph"/><div class="code"><pre>def c = Account.createCriteria()
def results = c &#123;
    between(<span class="java&#45;quote">"balance"</span>, 500, 1000)
    eq(<span class="java&#45;quote">"branch"</span>, <span class="java&#45;quote">"London"</span>)
    or &#123;
        like(<span class="java&#45;quote">"holderFirstName"</span>, <span class="java&#45;quote">"Fred%"</span>)
        like(<span class="java&#45;quote">"holderFirstName"</span>, <span class="java&#45;quote">"Barney%"</span>)
    &#125;
    maxResults(10)
    order(<span class="java&#45;quote">"holderLastName"</span>, <span class="java&#45;quote">"desc"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This criteria will select up to 10 <code>Account</code> objects in a List matching the following criteria:
</div>
このクライテリアは以下の条件に一致する<code>Account</code>オブジェクトを最大10件検索します:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>balance</code> is between 500 and 1000</li>
<li><code>branch</code> is 'London'</li>
<li><code>holderFirstName</code> starts with 'Fred' or 'Barney'</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>balance</code>が<code>500</code>から<code>1000</code>の間である</li>
<li><code>branch</code>が<code>London</code>である</li>
<li><code>holderFirstName</code>が<code>Fred</code>か<code>Barney</code>で始まっている</li>
</ul><p class="paragraph"/><div class="hidden-block">
The results will be sorted in descending order by <code>holderLastName</code>.
</div>
結果は<code>holderLastName</code>の降順でソートされます。<p class="paragraph"/><div class="hidden-block">
If no records are found with the above criteria, an empty List is returned.
</div>
もし上記のクライテリアでレコードが1件も見つからない場合、空のリストが返却されます。<p class="paragraph"/><div class="hidden-block">
<h4>Conjunctions and Disjunctions</h4>
</div>
<h4>論理積と論理和</h4><p class="paragraph"/><div class="hidden-block">
As demonstrated in the previous example you can group criteria in a logical OR using an <code>or { }</code> block:
</div>
前の例で提示したように、<code>or { }</code>ブロックを使用し、クライテリアを論理和でグループ化できます。<p class="paragraph"/><div class="code"><pre>or &#123;
    between(<span class="java&#45;quote">"balance"</span>, 500, 1000)
    eq(<span class="java&#45;quote">"branch"</span>, <span class="java&#45;quote">"London"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This also works with logical AND:
</div>
論理積でも同様です:<p class="paragraph"/><div class="code"><pre>and &#123;
    between(<span class="java&#45;quote">"balance"</span>, 500, 1000)
    eq(<span class="java&#45;quote">"branch"</span>, <span class="java&#45;quote">"London"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
And you can also negate using logical NOT:
</div>
さらに否定を使うこともできます:<p class="paragraph"/><div class="code"><pre>not &#123;
    between(<span class="java&#45;quote">"balance"</span>, 500, 1000)
    eq(<span class="java&#45;quote">"branch"</span>, <span class="java&#45;quote">"London"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
All top level conditions are implied to be AND'd together.
</div>
なお、すべてのトップレベルの条件は暗黙的にANDになります。<p class="paragraph"/><div class="hidden-block">
<h4>Querying Associations</h4>
</div>
<h4>関連のクエリ</h4><p class="paragraph"/><div class="hidden-block">
Associations can be queried by having a node that matches the property name. For example say the <code>Account</code> class had many <code>Transaction</code> objects:
</div>
関連はプロパティ名と一致するノードを持つことで問い合わせができます。
例えば、<code>Account</code>クラスが1対多の関連として<code>Transaction</code>オブジェクトを持っているとします:<p class="paragraph"/><div class="code"><pre>class Account &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> hasMany = &#91;transactions: Transaction&#93;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
We can query this association by using the property name <code>transactions</code> as a builder node:
</div>
この場合、ビルダーノードとしてプロパティ名<code>transactions</code>を使いこの関連を問い合わせできます:<p class="paragraph"/><div class="code"><pre>def c = Account.createCriteria()
def now = <span class="java&#45;keyword">new</span> Date()
def results = c.list &#123;
    transactions &#123;
        between('date', now &#45; 10, now)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The above code will find all the <code>Account</code> instances that have performed <code>transactions</code> within the last 10 days.
You can also nest such association queries within logical blocks:
</div>
上記のコードは最近10日以内の<code>transactions</code>を持つ全ての<code>Account</code>インスタンスを検索できます。
また、論理ブロック内に関連のクエリをネストすることもできます:<p class="paragraph"/><div class="code"><pre>def c = Account.createCriteria()
def now = <span class="java&#45;keyword">new</span> Date()
def results = c.list &#123;
    or &#123;
        between('created', now &#45; 10, now)
        transactions &#123;
            between('date', now &#45; 10, now)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Here we find all accounts that have either performed transactions in the last 10 days OR have been recently created in the last 10 days.
</div>
これは、最近10日以内に取引があり、最近10日以内に作成された口座をすべて取得します。<p class="paragraph"/><div class="hidden-block">
<h4>Querying with Projections</h4>
</div>
<h4>プロジェクション(射影)を利用したクエリ</h4><p class="paragraph"/><div class="hidden-block">
Projections may be used to customise the results. Define a "projections" node within the criteria builder tree to use projections. There are equivalent methods within the projections node to the methods found in the Hibernate <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/criterion/Projections.html" class="api">Projections</a> class:
</div>
プロジェクションは取得した結果をカスタマイズするために使われます。
プロジェクションを使うには、クライテリアビルダーのツリーの中で<code>projections</code>ノードを定義します。
プロジェクションノードのメソッドは、Hibernateの<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/criterion/Projections.html" class="api">Projections</a>クラスのメソッドに相当します。<p class="paragraph"/><div class="code"><pre>def c = Account.createCriteria()<p class="paragraph"/>def numberOfBranches = c.get &#123;
    projections &#123;
        countDistinct('branch')
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
When multiple fields are specified in the projection, a List of values will be returned. A single value will be returned otherwise.
</div>
プロジェクション内に複数のフィールドが指定された場合、値のリストが返却されます。
そうでなければ、単一の値が返却されます。<p class="paragraph"/><div class="hidden-block">
<h4>SQL Projections</h4>
</div>
<h4>SQLプロジェクション</h4><p class="paragraph"/><div class="hidden-block">
The criteria DSL provides access to Hibernate's SQL projection API.
</div>
クライテリアDSLはHibernateのSQLプロジェクションAPIへのアクセスを提供します。<p class="paragraph"/><div class="code"><pre>// Box is a domain class&#8230;
class Box &#123;
    <span class="java&#45;object">int</span> width
    <span class="java&#45;object">int</span> height
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// Use SQL projections to retrieve the perimeter and area of all of the Box instances&#8230;
def c = Box.createCriteria()<p class="paragraph"/>def results = c.list &#123;
    projections &#123;
      sqlProjection '(2 &#42; (width + height)) as perimeter, (width &#42; height) as area', &#91;'perimeter', 'area'&#93;, &#91;INTEGER, INTEGER&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The first argument to the <code>sqlProjection</code> method is the SQL which defines the projections.  The second argument is a list of
Strings which represent column aliases corresponding to the projected values expressed in the SQL.  The third argument
is a list of <code>org.hibernate.type.Type</code> instances which correspond to the projected values expressed in the SQL.  The API
supports all <code>org.hibernate.type.Type</code> objects but constants like INTEGER, LONG, FLOAT etc. are provided by the DSL which
correspond to all of the types defined in <code>org.hibernate.type.StandardBasicTypes</code>.
</div>
<code>sqlProjection</code>メソッドの最初の引数は、プロジェクションを定義するSQLです。
第2引数は、SQLで表現されたプロジェクションの値に対応するカラムのエイリアスの文字列リストです。
第3引数は、SQLで表現されたプロジェクションの値に対応する<code>org.hibernate.type.Type</code>インスタンスのリストです。
このAPIはすべての<code>org.hibernate.type.Type</code>オブジェクトをサポートしています。
しかし、INTEGER・LONG・FLOATなどの定数については、<code>org.hibernate.type.StandardBasicTypes</code>で定義されたすべての型に対応付けられているDSLによって提供されています。<p class="paragraph"/><div class="hidden-block">
Consider that the following table represents the data in the
<code>BOX</code> table.
</div>
以下の表は<code>BOX</code>テーブル内のデータを表すと考えてください。<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>width</th><th>height</th></tr><tr class="table-odd"><td>2</td><td>7</td></tr><tr class="table-even"><td>2</td><td>8</td></tr><tr class="table-odd"><td>2</td><td>9</td></tr><tr class="table-even"><td>4</td><td>9</td></tr></table><p class="paragraph"/><div class="hidden-block">
The query above would return results like this:
</div>
上記のクエリは以下のような結果を返します:<p class="paragraph"/><div class="code"><pre>&#91;&#91;18, 14&#93;, &#91;20, 16&#93;, &#91;22, 18&#93;, &#91;26, 36&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">
Each of the inner lists contains the 2 projected values for each <code>Box</code>, perimeter and area.
</div>
内側のリストは、それぞれの<code>Box</code>に対する全周と面積を表す、2つのプロジェクションされた値を含んでいます。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
Note that if there are other references in scope wherever your criteria query is expressed that have names that conflict 
with any of the type constants described above, the code in your criteria will refer to those references, not the type
constants provided by the DSL.  In the unlikely event of that happening you can disambiguate the conflict by referring
to the fully qualified Hibernate type.  For example <code>StandardBasicTypes.INTEGER</code> instead of <code>INTEGER</code>.
</blockquote>
</div>
<blockquote class="note">
もしクライテリアクエリ内から参照できるスコープ内に前述の型定数と重複する名前の変数が宣言されている場合は、クライテリア中のコードは、DSLが提供する型定数ではなく、その変数を利用してしまうことに注意してください。
そのような場合は、完全修飾されたHibernateの型を指定することであいまいさを無くし衝突を回避できます。
例えば、<code>INTEGER</code>の代わりに<code>StandardBasicTypes.INTEGER</code>を指定します。
</blockquote><p class="paragraph"/><div class="hidden-block">
If only 1 value is being projected, the alias and the type do not need to be included in a list.
</div>
1つの値だけをプロジェクションする場合は、エイリアスと型はリストとして指定する必要はありません。<p class="paragraph"/><div class="code"><pre>def results = c.list &#123;
    projections &#123;
      sqlProjection 'sum(width &#42; height) as totalArea', 'totalArea', INTEGER
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
That query would return a single result with the value of 84 as the total area of all of the <code>Box</code> instances.
</div>
上記のクエリは全<code>Box</code>インスタンスの面積の合計である84という単一の結果を返します。<p class="paragraph"/><div class="hidden-block">
The DSL supports grouped projections with the <code>sqlGroupProjection</code> method.
</div>
DSLは<code>sqlGroupProjection</code>メソッドでグループ化されたプロジェクションをサポートしています。<p class="paragraph"/><div class="code"><pre>def results = c.list &#123;
    projections &#123;
        sqlGroupProjection 'width, sum(height) as combinedHeightsForThisWidth', 'width', &#91;'width', 'combinedHeightsForThisWidth'&#93;, &#91;INTEGER, INTEGER&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The first argument to the <code>sqlProjection</code> method is the SQL which defines the projections.  The second argument represents the
group by clause that should be part of the query.  That string may be single column name or a comma separated list of column
names.  The third argument is a list of
Strings which represent column aliases corresponding to the projected values expressed in the SQL.  The fourth argument
is a list of <code>org.hibernate.type.Type</code> instances which correspond to the projected values expressed in the SQL.
</div>
<code>sqlGroupProjection</code>への最初の引数は、プロジェクションを定義するSQLです。
第2引数は、クエリの一部となるGROUP BY句を表しています。単一のカラム名または複数のカラム名のカンマ区切り文字列を指定します。
第3引数は、SQLで表現されたプロジェクションの値に対応するカラムのエイリアスの文字列リストです。
第4引数は、SQLで表現されたプロジェクションの値に対応する<code>org.hibernate.type.Type</code>インスタンスのリストです。<p class="paragraph"/><div class="hidden-block">
The query above is projecting the combined heights of boxes grouped by width and would return results that look like this:
</div>
上記のクエリは<code>width</code>によってグループ化した上で<code>heights</code>を合計した値をプロジェクションしています。
これは以下のような結果を返します:<p class="paragraph"/><div class="code"><pre>&#91;&#91;2, 24&#93;, &#91;4, 9&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">
Each of the inner lists contains 2 values.  The first value is a box width and the second value is the sum of the heights
of all of the boxes which have that width.
</div>
それぞれの内側のリストには2つの値が格納されています。
最初の値は<code>width</code>の値、次の値は<code>width</code>によってグループ化した上で<code>height</code>を合計した値となります。<p class="paragraph"/><div class="hidden-block">
<h4>Using SQL Restrictions</h4>
</div>
<h4>SQL Restrictionsの使用</h4><p class="paragraph"/><div class="hidden-block">
You can access Hibernate's SQL Restrictions capabilities.
</div>
HibernateのSQL Restrictions機能を使用できます。<p class="paragraph"/><div class="code"><pre>def c = Person.createCriteria()<p class="paragraph"/>def peopleWithShortFirstNames = c.list &#123;
    sqlRestriction <span class="java&#45;quote">"char_length(first_name) &#60;= 4"</span>
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">
SQL Restrictions may be parameterized to deal with SQL injection vulnerabilities related to dynamic restrictions.
</div>
SQL Restrictionsは、動的な条件に関連するSQLインジェクションの脆弱性に対処するために、条件に埋め込む値をパラメータ化できます。<p class="paragraph"/><div class="code"><pre>def c = Person.createCriteria()<p class="paragraph"/>def peopleWithShortFirstNames = c.list &#123;
    sqlRestriction <span class="java&#45;quote">"char_length(first_name) &#60; ? AND char_length(first_name) &#62; ?"</span>, &#91;maxValue, minValue&#93;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">
<blockquote class="note">
Note that the parameter there is SQL. The <code>first_name</code> attribute referenced in the example refers to the persistence model, not the object model like in HQL queries. The <code>Person</code> property named <code>firstName</code> is mapped to the <code>first_name</code> column in the database and you must refer to that in the <code>sqlRestriction</code> string.<p class="paragraph"/>Also note that the SQL used here is not necessarily portable across databases.
</blockquote>
</div>
<blockquote class="note">
パラメータがSQLであることに注意してください。
上記の例で参照している<code>first_name</code>属性はHQLクエリのようにオブジェクトモデルではなく、永続化モデルを示します。
<code>Person</code>の<code>firstName</code>プロパティはデータベース内の<code>first_name</code>列にマッピングされており、<code>sqlRestriction</code>文字列内では<code>first_name</code>を指定する必要があります。<p class="paragraph"/>また、ここで使われるSQLは必ずしもデータベース間で移植可能ではありません。
</blockquote><p class="paragraph"/><div class="hidden-block">
<h4>Using Scrollable Results</h4>
</div>
<h4>スクロール可能な検索結果の使用</h4><p class="paragraph"/><div class="hidden-block">
You can use Hibernate's <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/ScrollableResults.html" class="api">ScrollableResults</a> feature by calling the scroll method:
</div>
<code>scroll</code>メソッドを呼び出すことで、Hibernateの<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/ScrollableResults.html" class="api">ScrollableResults</a>機能を使用できます:<p class="paragraph"/><div class="code"><pre>def results = crit.scroll &#123;
    maxResults(10)
&#125;
def f = results.first()
def l = results.last()
def n = results.next()
def p = results.previous()<p class="paragraph"/>def <span class="java&#45;keyword">future</span> = results.scroll(10)
def accountNumber = results.getLong('number')</pre></div><p class="paragraph"/><div class="hidden-block">
To quote the documentation of Hibernate ScrollableResults:
</div>
以下はHibernateの<code>ScrollableResults</code>のドキュメントからの引用です:<p class="paragraph"/><div class="hidden-block">
<blockquote class="quote">
A result iterator that allows moving around within the results by arbitrary increments. The Query / ScrollableResults pattern is very similar to the JDBC PreparedStatement/ ResultSet pattern and the semantics of methods of this interface are similar to the similarly named methods on ResultSet.
</blockquote>
</div>
<blockquote class="quote">
任意の増分を指定して結果内を自由に移動できる結果イテレータです。
このQuery/ScrollableResultsのパターンは、JDBCのPreparedStatement/ResultSetパターンに非常に似ています。
そして、インタフェースのメソッドの意味も、ResultSet上の似た名前のメソッドと同じような意味になります。
</blockquote><p class="paragraph"/><div class="hidden-block">
Contrary to JDBC, columns of results are numbered from zero.
</div>
JDBCとは異なり結果のカラムは0から採番されます。<p class="paragraph"/><div class="hidden-block">
<h4>Setting properties in the Criteria instance</h4>
</div>
<h4>クライテリアインスタンス内でのプロパティの設定</h4><p class="paragraph"/><div class="hidden-block">
If a node within the builder tree doesn't match a particular criterion it will attempt to set a property on the Criteria object itself. This allows full access to all the properties in this class. This example calls <code>setMaxResults</code> and <code>setFirstResult</code> on the <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/Criteria.html" class="api">Criteria</a> instance:
</div>
もしこのビルダツリー内のノードが特定のクライテリアにマッチしない場合は、クライテリアオブジェクト自身のプロパティを設定しようとします。
これは、このクラス内のすべてのプロパティへのフルアクセスを許可します。
この例では、<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/Criteria.html" class="api">Criteria</a>インスタンス上の<code>setMaxResults</code>と<code>setFirstResult</code>を呼んでいます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.hibernate.FetchMode as FM
&#8230;
def results = c.list &#123;
    maxResults(10)
    firstResult(50)
    fetchMode(<span class="java&#45;quote">"aRelationship"</span>, FM.JOIN)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Querying with Eager Fetching</h4>
</div>
<h4>Eagerフェッチによるクエリ</h4><p class="paragraph"/><div class="hidden-block">
In the section on <a href="../guide/single.html#fetching" class="guide">Eager and Lazy Fetching</a> we discussed how to declaratively specify fetching to avoid the N+1 SELECT problem. However, this can also be achieved using a criteria query:
</div>
<a href="../guide/single.html#fetching" class="guide">EagerフェッチとLazyフェッチ</a>のセクションでは、N+1 SELECT問題を避けるためにフェッチ方法を宣言的に指定する方法について説明しました。
しかし、このクライテリアを使っても同じことを実現できます。<p class="paragraph"/><div class="code"><pre>def criteria = Task.createCriteria()
def tasks = criteria.list&#123;
    eq <span class="java&#45;quote">"assignee.id"</span>, task.assignee.id
    join 'assignee'
    join 'project'
    order 'priority', 'asc'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Notice the usage of the <code>join</code> method: it tells the criteria API to use a <code>JOIN</code> to fetch the named associations with the <code>Task</code> instances. It's probably best not to use this for one-to-many associations though, because you will most likely end up with duplicate results. Instead, use the 'select' fetch mode:
</div>
<code>join</code>メソッドの使い方に注意してください。
これは、<code>Task</code>インスタンスと指定された関連をフェッチするために、<code>JOIN</code>を利用するようにクライテリアAPIに指示します。
とはいえ、最終的に重複した結果が得られることになる可能性が非常に高いため、<code>join</code>は1対多関連に対して使わないのがおそらくベストです。
代わりに<code>select</code>フェッチモードを使用しましょう:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.hibernate.FetchMode as FM
&#8230;
def results = Airport.withCriteria &#123;
    eq <span class="java&#45;quote">"region"</span>, <span class="java&#45;quote">"EMEA"</span>
    fetchMode <span class="java&#45;quote">"flights"</span>, FM.SELECT
&#125;</pre></div>
<div class="hidden-block">
Although this approach triggers a second query to get the <code>flights</code> association, you will get reliable results  - even with the <code>maxResults</code> option.
</div>
このアプローチは<code>flights</code>関連を取得するために2次クエリを発行しますが、<code>maxResults</code>オプションを使いさえすれば、正しい結果が得られます。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
<code>fetchMode</code> and <code>join</code> are general settings of the query and can only be specified at the top-level, i.e. you cannot use them inside projections or association constraints.
</blockquote>
</div>
<blockquote class="note">
<code>FetchMode</code>と<code>join</code>はそのクエリ全体に対する設定のため、トップレベルでのみ指定できます。
つまり、プロジェクションや関連のブロック内では使用できません。
</blockquote><p class="paragraph"/><div class="hidden-block">
An important point to bear in mind is that if you include associations in the query constraints, those associations will automatically be eagerly loaded. For example, in this query:
</div>
覚えておくべき重要なこととして、クエリ条件に関連を含んでいる場合は、その関連は自動的にEagerフェッチされるということです。
例えば、次のクエリでは:<p class="paragraph"/><div class="code"><pre>def results = Airport.withCriteria &#123;
    eq <span class="java&#45;quote">"region"</span>, <span class="java&#45;quote">"EMEA"</span>
    flights &#123;
        like <span class="java&#45;quote">"number"</span>, <span class="java&#45;quote">"BA%"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
the <code>flights</code> collection would be loaded eagerly via a join even though the fetch mode has not been explicitly set.
</div>
フェッチモードを明示的に設定していないにもかかわらず、この<code>flights</code>コレクションはJOINによってEagerフェッチされます。<p class="paragraph"/><div class="hidden-block">
<h4>Method Reference</h4>
</div>
<h4>メソッドの参照</h4><p class="paragraph"/><div class="hidden-block">
If you invoke the builder with no method name such as:
</div>
もし、ビルダーをメソッド名を指定せずに実行すると:<p class="paragraph"/><div class="code"><pre>c &#123; &#8230; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The build defaults to listing all the results and hence the above is equivalent to:
</div>
ビルダーのデフォルト動作は全件の一覧取得です。
そのため上記は以下のように書いた場合と同等です:<p class="paragraph"/><div class="code"><pre>c.list &#123; &#8230; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">list</strong></td><td>This is the default method. It returns all matching rows.</td></tr><tr class="table-even"><td><strong class="bold">get</strong></td><td>Returns a unique result set, i.e. just one row. The criteria has to be formed that way, that it only queries one row. This method is not to be confused with a limit to just the first row.</td></tr><tr class="table-odd"><td><strong class="bold">scroll</strong></td><td>Returns a scrollable result set.</td></tr><tr class="table-even"><td><strong class="bold">listDistinct</strong></td><td>If subqueries or associations are used, one may end up with the same row multiple times in the result set, this allows listing only distinct entities and is equivalent to <code>DISTINCT_ROOT_ENTITY</code> of the <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/criterion/CriteriaSpecification.html" class="api">CriteriaSpecification</a> class.</td></tr><tr class="table-odd"><td><strong class="bold">count</strong></td><td>Returns the number of matching rows.</td></tr></table>
</div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>メソッド</th><th>概要</th></tr><tr class="table-odd"><td><strong class="bold">list</strong></td><td>これがデフォルトのメソッドです。条件に一致するすべての行を返します。</td></tr><tr class="table-even"><td><strong class="bold">get</strong></td><td>1つのユニークな結果セット、つまり、1行だけを返します。クライテリアは1行だけを検索するように書かれていなければなりません。このメソッドが最初の行だけに限定して返すと勘違いしないようにしてください。</td></tr><tr class="table-odd"><td><strong class="bold">scroll</strong></td><td>スクロール可能な結果セットを返します。</td></tr><tr class="table-even"><td><strong class="bold">listDistinct</strong></td><td>サブクエリや関連を使うと、結果セット中に同じ行が複数回現れる可能性がありますが、このメソッドは重複したエンティティを取り除いたリストを返します。<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/criterion/CriteriaSpecification.html" class="api">CriteriaSpecification</a>クラスの<code>DISTINCT_ROOT_ENTITY</code>を使用するのと同じです。</td></tr><tr class="table-odd"><td><strong class="bold">count</strong></td><td>一致する行の数を返します。</td></tr></table><p class="paragraph"/><div class="hidden-block">
<h4>Combining Criteria</h4>
</div>
<h4>クライテリアの結合</h4><p class="paragraph"/><div class="hidden-block">
You can combine multiple criteria closures in the following way:
</div>
複数のクライテリアのクロージャを以下のように結合できます:<p class="paragraph"/><div class="code"><pre>def emeaCriteria = &#123;
    eq <span class="java&#45;quote">"region"</span>, <span class="java&#45;quote">"EMEA"</span>
&#125;<p class="paragraph"/>def results = Airport.withCriteria &#123;
    emeaCriteria.delegate = delegate
    emeaCriteria()
    flights &#123;
        like <span class="java&#45;quote">"number"</span>, <span class="java&#45;quote">"BA%"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This technique requires that each criteria must refer to the same domain class (i.e. <code>Airport</code>).
A more flexible approach is to use Detached Criteria, as described in the following section.
</div>
このテクニックでは、それぞれのクライテリアが同じドメインクラス(ここでは<code>Airport</code>)に対するものでなければなりません。
より柔軟なアプローチとして、この後のセクションで説明するDetachedクライテリアの使用があります。



<h2 id="detachedCriteria">6.4.4 Detachedクライテリア</h2>
Detached Criteria are criteria queries that are not associated with any given database session/connection. Supported since Grails 2.0, Detached Criteria queries have many uses including allowing you to create common reusable criteria queries, execute subqueries and execute batch updates/deletes.<p class="paragraph"/>
<h4>Building Detached Criteria Queries</h4><p class="paragraph"/>The primary point of entry for using the Detached Criteria is the <code>grails.gorm.DetachedCriteria</code> class which accepts a domain class as the only argument to its constructor:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.gorm.&#42;
&#8230;
def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person)</pre></div><p class="paragraph"/>Once you have obtained a reference to a detached criteria instance you can execute <a href="../guide/single.html#whereQueries" class="guide">where</a> queries or criteria queries to build up the appropriate query. To build a normal criteria query you can use the <code>build</code> method:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;</pre></div><p class="paragraph"/>Note that methods on the <code>DetachedCriteria</code> instance <strong class="bold">do not</strong> mutate the original object but instead return a new query. In other words, you have to use the return value of the <code>build</code> method to obtain the mutated criteria object:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
def bartQuery = criteria.build &#123;
    eq 'firstName', 'Bart'
&#125;</pre></div><p class="paragraph"/><h4>Executing Detached Criteria Queries</h4><p class="paragraph"/>Unlike regular criteria, Detached Criteria are lazy, in that no query is executed at the point of definition. Once a Detached Criteria query has been constructed then there are a number of useful query methods which are summarized in the table below:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">list</strong></td><td>List all matching entities</td></tr><tr class="table-even"><td><strong class="bold">get</strong></td><td>Return a single matching result</td></tr><tr class="table-odd"><td><strong class="bold">count</strong></td><td>Count all matching records</td></tr><tr class="table-even"><td><strong class="bold">exists</strong></td><td>Return true if any matching records exist</td></tr><tr class="table-odd"><td><strong class="bold">deleteAll</strong></td><td>Delete all matching records</td></tr><tr class="table-even"><td><strong class="bold">updateAll(Map)</strong></td><td>Update all matching records with the given properties</td></tr></table><p class="paragraph"/>As an example the following code will list the first 4 matching records sorted by the <code>firstName</code> property:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
def results = criteria.list(max:4, sort:<span class="java&#45;quote">"firstName"</span>)</pre></div><p class="paragraph"/>You can also supply additional criteria to the list method:<p class="paragraph"/><div class="code"><pre>def results = criteria.list(max:4, sort:<span class="java&#45;quote">"firstName"</span>) &#123;
    gt 'age', 30
&#125;</pre></div><p class="paragraph"/>To retrieve a single result you can use the <code>get</code> or <code>find</code> methods (which are synonyms):<p class="paragraph"/><div class="code"><pre>Person p = criteria.find() // or criteria.get()</pre></div><p class="paragraph"/>The <code>DetachedCriteria</code> class itself also implements the <code>Iterable</code> interface which means that it can be treated like a list:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
criteria.each &#123;
    println it.firstName
&#125;</pre></div><p class="paragraph"/>In this case the query is only executed when the <code>each</code> method is called. The same applies to all other Groovy collection iteration methods.<p class="paragraph"/>You can also execute dynamic finders on <code>DetachedCriteria</code> just like on domain classes. For example:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
def bart = criteria.findByFirstName(<span class="java&#45;quote">"Bart"</span>)</pre></div><p class="paragraph"/><h4>Using Detached Criteria for Subqueries</h4><p class="paragraph"/>Within the context of a regular criteria query you can use <code>DetachedCriteria</code> to execute subquery. For example if you want to find all people who are older than the average age the following query will accomplish that:<p class="paragraph"/><div class="code"><pre>def results = Person.withCriteria &#123;
     gt <span class="java&#45;quote">"age"</span>, <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
         projections &#123;
             avg <span class="java&#45;quote">"age"</span>
         &#125;
     &#125;
     order <span class="java&#45;quote">"firstName"</span>
 &#125;</pre></div><p class="paragraph"/>Notice that in this case the subquery class is the same as the original criteria query class (ie. <code>Person</code>) and hence the query can be shortened to:<p class="paragraph"/><div class="code"><pre>def results = Person.withCriteria &#123;
     gt <span class="java&#45;quote">"age"</span>, &#123;
         projections &#123;
             avg <span class="java&#45;quote">"age"</span>
         &#125;
     &#125;
     order <span class="java&#45;quote">"firstName"</span>
 &#125;</pre></div><p class="paragraph"/>If the subquery class differs from the original criteria query then you will have to use the original syntax.<p class="paragraph"/>In the previous example the projection ensured that only a single result was returned (the average age). If your subquery returns multiple results then there are different criteria methods that need to be used to compare the result. For example to find all the people older than the ages 18 to 65 a <code>gtAll</code> query can be used:<p class="paragraph"/><div class="code"><pre>def results = Person.withCriteria &#123;
    gtAll <span class="java&#45;quote">"age"</span>, &#123;
        projections &#123;
            property <span class="java&#45;quote">"age"</span>
        &#125;
        between 'age', 18, 65
    &#125;<p class="paragraph"/>    order <span class="java&#45;quote">"firstName"</span>
&#125;</pre></div><p class="paragraph"/>The following table summarizes criteria methods for operating on subqueries that return multiple results:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Method</th><th>Description</th></tr><tr class="table-odd"><td><strong class="bold">gtAll</strong></td><td>greater than all subquery results</td></tr><tr class="table-even"><td><strong class="bold">geAll</strong></td><td>greater than or equal to all subquery results</td></tr><tr class="table-odd"><td><strong class="bold">ltAll</strong></td><td>less than all subquery results</td></tr><tr class="table-even"><td><strong class="bold">leAll</strong></td><td>less than or equal to all subquery results</td></tr><tr class="table-odd"><td><strong class="bold">eqAll</strong></td><td>equal to all subquery results</td></tr><tr class="table-even"><td><strong class="bold">neAll</strong></td><td>not equal to all subquery results</td></tr></table><p class="paragraph"/><h4>Batch Operations with Detached Criteria</h4><p class="paragraph"/>The <code>DetachedCriteria</code> class can be used to execute batch operations such as batch updates and deletes. For example, the following query will update all people with the surname "Simpson" to have the surname "Bloggs":<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
<span class="java&#45;object">int</span> total = criteria.updateAll(lastName:<span class="java&#45;quote">"Bloggs"</span>)</pre></div><p class="paragraph"/><blockquote class="note">
Note that one limitation with regards to batch operations is that join queries (queries that query associations) are not allowed within the <code>DetachedCriteria</code> instance. 
</blockquote><p class="paragraph"/>To batch delete records you can use the <code>deleteAll</code> method:<p class="paragraph"/><div class="code"><pre>def criteria = <span class="java&#45;keyword">new</span> DetachedCriteria(Person).build &#123;
    eq 'lastName', 'Simpson'
&#125;
<span class="java&#45;object">int</span> total = criteria.deleteAll()</pre></div>


<a name="5.4.3 Hibernate Query Language (HQL)"><!-- Legacy link --></a>
<h2 id="hql">6.4.5 Hibernateクエリー言語 (HQL)</h2>
<div class="hidden-block">GORM classes also support Hibernate's query language HQL, a very complete reference for which can be found <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/queryhql.html" target="blank">in the Hibernate documentation</a> of the Hibernate documentation.</div>
GORMのドメインクラスはHibernateのクエリ言語であるHQLもサポートしています。
HQLに関するとても充実したリファレンスが<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/queryhql.html" target="blank">Hibernateのドキュメント</a>にあります。<p class="paragraph"/><div class="hidden-block">GORM provides a number of methods that work with HQL including <a href="../ref/Domain Classes/find.html" class="domainClasses">find</a>, <a href="../ref/Domain Classes/findAll.html" class="domainClasses">findAll</a> and <a href="../ref/Domain Classes/executeQuery.html" class="domainClasses">executeQuery</a>. An example of a query can be seen below:</div>
GORMは、<a href="../ref/Domain Classes/find.html" class="domainClasses">find</a>、<a href="../ref/Domain Classes/findAll.html" class="domainClasses">findAll</a>、そして<a href="../ref/Domain Classes/executeQuery.html" class="domainClasses">executeQuery</a>といった、HQLと連携するいくつかのメソッドを提供しています。
以下はクエリの使用例です:<p class="paragraph"/><div class="code"><pre>def results =
      Book.findAll(<span class="java&#45;quote">"from Book as b where b.title like 'Lord of the%'"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">h4. Positional and Named Parameters</div>
<h4>位置パラメータと名前付きパラメータ</h4><p class="paragraph"/><div class="hidden-block">In this case the value passed to the query is hard coded, however you can equally use positional parameters:</div>
クエリへ値を渡す場合はハードコードになりますが位置パラメータが使えます:<p class="paragraph"/><div class="code"><pre>def results =
      Book.findAll(<span class="java&#45;quote">"from Book as b where b.title like ?"</span>, &#91;<span class="java&#45;quote">"The Shi%"</span>&#93;)</pre></div><p class="paragraph"/><div class="code"><pre>def author = Author.findByName(<span class="java&#45;quote">"Stephen King"</span>)
def books = Book.findAll(<span class="java&#45;quote">"from Book as book where book.author = ?"</span>,
                         &#91;author&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">Or even named parameters:</div>
または、名前付きパラメータが使えます:<p class="paragraph"/><div class="code"><pre>def results =
      Book.findAll(<span class="java&#45;quote">"from Book as b "</span> +
                   <span class="java&#45;quote">"where b.title like :search or b.author like :search"</span>,
                   &#91;search: <span class="java&#45;quote">"The Shi%"</span>&#93;)</pre></div><p class="paragraph"/><div class="code"><pre>def author = Author.findByName(<span class="java&#45;quote">"Stephen King"</span>)
def books = Book.findAll(<span class="java&#45;quote">"from Book as book where book.author = :author"</span>,
                         &#91;author: author&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">h4. Multiline Queries</div>
<h4>複数行のクエリ</h4><p class="paragraph"/><div class="hidden-block">Use the line continuation character to separate the query across multiple lines:</div>
クエリを複数行に分割する場合は、行継続文字を使ってください:<p class="paragraph"/><div class="code"><pre>def results = Book.findAll(<span class="java&#45;quote">"&#92;
from Book as b, &#92;
     Author as a &#92;
where b.author = a and a.surname = ?"</span>, &#91;'Smith'&#93;)</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Triple-quoted Groovy multiline Strings will NOT work with HQL queries.
</blockquote></div>
<blockquote class="note">
トリプルクォートを使ったGroovyの複数行文字列はHQLクエリではうまく動作しません。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Pagination and Sorting</div>
<h4>ページングとソート</h4><p class="paragraph"/><div class="hidden-block">You can also perform pagination and sorting whilst using HQL queries. To do so simply specify the pagination options as a Map at the end of the method call and include an "ORDER BY" clause in the HQL:</div>
HQLクエリを使いながら、ページングとソートを行うこともできます。
これには、メソッドの最後の引数にMapとしてページングオプションを指定し、HQLの中に<code>ORDER BY</code>節を追加します:<p class="paragraph"/><div class="code"><pre>def results =
      Book.findAll(<span class="java&#45;quote">"from Book as b where "</span> +
                   <span class="java&#45;quote">"b.title like 'Lord of the%' "</span> +
                   <span class="java&#45;quote">"order by b.title asc"</span>,
                   &#91;max: 10, offset: 20&#93;)</pre></div>


<a name="5.5 Advanced GORM Features"><!-- Legacy link --></a>
<h2 id="advancedGORMFeatures">6.5 高度なGORMの機能</h2>
<div class="hidden-block">The following sections cover more advanced usages of GORM including caching, custom mapping and events.</div>
このセクションからはキャッシング、カスタムマッピング、イベントなどのもっと高度なGORMの使用方法を紹介していきます。


<a name="5.5.1 Events and Auto Timestamping"><!-- Legacy link --></a>
<h2 id="eventsAutoTimestamping">6.5.1 イベントと自動タイムスタンプ</h2>
GORM supports the registration of events as methods that get fired when certain events occurs such as deletes, inserts and updates. The following is a list of supported events:
<ul class="star">
<li><code>beforeInsert</code> - Executed before an object is initially persisted to the database</li>
<li><code>beforeUpdate</code> - Executed before an object is updated</li>
<li><code>beforeDelete</code> - Executed before an object is deleted</li>
<li><code>beforeValidate</code> - Executed before an object is validated</li>
<li><code>afterInsert</code> - Executed after an object is persisted to the database</li>
<li><code>afterUpdate</code> - Executed after an object has been updated</li>
<li><code>afterDelete</code> - Executed after an object has been deleted</li>
<li><code>onLoad</code> - Executed when an object is loaded from the database</li>
</ul><p class="paragraph"/>To add an event simply register the relevant closure with your domain class.<p class="paragraph"/><blockquote class="warning">
Do not attempt to flush the session within an event (such as with obj.save(flush:true)). Since events are fired during flushing this will cause a StackOverflowError.
</blockquote><p class="paragraph"/><h3>Event types</h3><p class="paragraph"/><h4>The beforeInsert event</h4><p class="paragraph"/>Fired before an object is saved to the database<p class="paragraph"/><div class="code"><pre>class Person &#123;
   <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> Date NULL_DATE = <span class="java&#45;keyword">new</span> Date(0)<p class="paragraph"/>   <span class="java&#45;object">String</span> firstName
   <span class="java&#45;object">String</span> lastName
   Date signupDate = NULL_DATE<p class="paragraph"/>   def beforeInsert() &#123;
      <span class="java&#45;keyword">if</span> (signupDate == NULL_DATE) &#123;
         signupDate = <span class="java&#45;keyword">new</span> Date()
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>The beforeUpdate event</h4><p class="paragraph"/>Fired before an existing object is updated<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>   def securityService<p class="paragraph"/>   <span class="java&#45;object">String</span> firstName
   <span class="java&#45;object">String</span> lastName
   <span class="java&#45;object">String</span> lastUpdatedBy<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      lastUpdatedBy nullable: <span class="java&#45;keyword">true</span>
   &#125;<p class="paragraph"/>   def beforeUpdate() &#123;
      lastUpdatedBy = securityService.currentAuthenticatedUsername()
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>The beforeDelete event</h4><p class="paragraph"/>Fired before an object is deleted.<p class="paragraph"/><div class="code"><pre>class Person &#123;
   <span class="java&#45;object">String</span> name<p class="paragraph"/>   def beforeDelete() &#123;
      ActivityTrace.withNewSession &#123;
         <span class="java&#45;keyword">new</span> ActivityTrace(eventName: <span class="java&#45;quote">"Person Deleted"</span>, data: name).save()
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>Notice the usage of <code>withNewSession</code> method above. Since events are triggered whilst Hibernate is flushing using persistence methods like <code>save()</code> and <code>delete()</code> won't result in objects being saved unless you run your operations with a new <code>Session</code>.<p class="paragraph"/>Fortunately the <code>withNewSession</code> method lets you share the same transactional JDBC connection even though you're using a different underlying <code>Session</code>.<p class="paragraph"/><h4>The beforeValidate event</h4><p class="paragraph"/>Fired before an object is validated.<p class="paragraph"/><div class="code"><pre>class Person &#123;
   <span class="java&#45;object">String</span> name<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
       name size: 5..45
   &#125;<p class="paragraph"/>   def beforeValidate() &#123;
       name = name?.trim()
   &#125;
&#125;</pre></div><p class="paragraph"/>The <code>beforeValidate</code> method is run before any validators are run.<p class="paragraph"/><blockquote class="note">
Validation may run more often than you think. It is triggered by the <code>validate()</code> and <code>save()</code> methods as you'd expect, but it is also typically triggered just before the view is rendered as well. So when writing <code>beforeValidate()</code> implementations, make sure that they can handle being called multiple times with the same property values.
</blockquote><p class="paragraph"/>GORM supports an overloaded version of <code>beforeValidate</code> which accepts a <code>List</code> parameter which may include
the names of the properties which are about to be validated.  This version of <code>beforeValidate</code> will be called
when the <code>validate</code> method has been invoked and passed a <code>List</code> of property names as an argument.<p class="paragraph"/><div class="code"><pre>class Person &#123;
   <span class="java&#45;object">String</span> name
   <span class="java&#45;object">String</span> town
   <span class="java&#45;object">Integer</span> age<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
       name size: 5..45
       age range: 4..99
   &#125;<p class="paragraph"/>   def beforeValidate(List propertiesBeingValidated) &#123;
      // <span class="java&#45;keyword">do</span> pre validation work based on propertiesBeingValidated
   &#125;
&#125;<p class="paragraph"/>def p = <span class="java&#45;keyword">new</span> Person(name: 'Jacob Brown', age: 10)
p.validate(&#91;'age', 'name'&#93;)</pre></div><p class="paragraph"/><blockquote class="note">
Note that when <code>validate</code> is triggered indirectly because of a call to the <code>save</code> method that
the <code>validate</code> method is being invoked with no arguments, not a <code>List</code> that includes all of
the property names.
</blockquote><p class="paragraph"/>Either or both versions of <code>beforeValidate</code> may be defined in a domain class.  GORM will
prefer the <code>List</code> version if a <code>List</code> is passed to <code>validate</code> but will fall back on the
no-arg version if the <code>List</code> version does not exist.  Likewise, GORM will prefer the
no-arg version if no arguments are passed to <code>validate</code> but will fall back on the
<code>List</code> version if the no-arg version does not exist.  In that case, <code>null</code> is passed to <code>beforeValidate</code>.<p class="paragraph"/><h4>The onLoad/beforeLoad event</h4><p class="paragraph"/>Fired immediately before an object is loaded from the database:<p class="paragraph"/><div class="code"><pre>class Person &#123;
   <span class="java&#45;object">String</span> name
   Date dateCreated
   Date lastUpdated<p class="paragraph"/>   def onLoad() &#123;
      log.debug <span class="java&#45;quote">"Loading &#36;&#123;id&#125;"</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><code>beforeLoad()</code> is effectively a synonym for <code>onLoad()</code>, so only declare one or the other.<p class="paragraph"/><h4>The afterLoad event</h4><p class="paragraph"/>Fired immediately after an object is loaded from the database:<p class="paragraph"/><div class="code"><pre>class Person &#123;
   <span class="java&#45;object">String</span> name
   Date dateCreated
   Date lastUpdated<p class="paragraph"/>   def afterLoad() &#123;
      name = <span class="java&#45;quote">"I'm loaded"</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>Custom Event Listeners</h4><p class="paragraph"/>As of Grails 2.0 there is a new API for plugins and applications to register and listen for persistence events. This API is not tied to Hibernate and also works for other persistence plugins such as the <a href="http://grails.org/plugin/mongodb" target="blank">MongoDB plugin for GORM</a>.<p class="paragraph"/>To use this API you need to subclass <code>AbstractPersistenceEventListener</code> (in package  <em class="italic">org.grails.datastore.mapping.engine.event</em> ) and implement the methods <code>onPersistenceEvent</code> and <code>supportsEventType</code>. You also must provide a reference to the datastore to the listener.  The simplest possible implementation can be seen below:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> MyPersistenceListener(<span class="java&#45;keyword">final</span> Datastore datastore) &#123;
    <span class="java&#45;keyword">super</span>(datastore)
&#125;<p class="paragraph"/>@Override
<span class="java&#45;keyword">protected</span> void onPersistenceEvent(<span class="java&#45;keyword">final</span> AbstractPersistenceEvent event) &#123;
    <span class="java&#45;keyword">switch</span>(event.eventType) &#123;
        <span class="java&#45;keyword">case</span> PreInsert:
            println <span class="java&#45;quote">"PRE INSERT &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>
        <span class="java&#45;keyword">case</span> PostInsert:
            println <span class="java&#45;quote">"POST INSERT &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>
        <span class="java&#45;keyword">case</span> PreUpdate:
            println <span class="java&#45;quote">"PRE UPDATE &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>;
        <span class="java&#45;keyword">case</span> PostUpdate:
            println <span class="java&#45;quote">"POST UPDATE &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>;
        <span class="java&#45;keyword">case</span> PreDelete:
            println <span class="java&#45;quote">"PRE DELETE &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>;
        <span class="java&#45;keyword">case</span> PostDelete:
            println <span class="java&#45;quote">"POST DELETE &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>;
        <span class="java&#45;keyword">case</span> PreLoad:
            println <span class="java&#45;quote">"PRE LOAD &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>;
        <span class="java&#45;keyword">case</span> PostLoad:
            println <span class="java&#45;quote">"POST LOAD &#36;&#123;event.entityObject&#125;"</span>
        <span class="java&#45;keyword">break</span>;
    &#125;
&#125;<p class="paragraph"/>@Override
<span class="java&#45;keyword">public</span> <span class="java&#45;object">boolean</span> supportsEventType(<span class="java&#45;object">Class</span>&#60;? <span class="java&#45;keyword">extends</span> ApplicationEvent&#62; eventType) &#123;
    <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span>
&#125;</pre></div><p class="paragraph"/>The <code>AbstractPersistenceEvent</code> class has many subclasses (<code>PreInsertEvent</code>, <code>PostInsertEvent</code> etc.) that provide further information specific to the event. A <code>cancel()</code> method is also provided on the event which allows you to veto an insert, update or delete operation.<p class="paragraph"/>Once you have created your event listener you need to register it with the <code>ApplicationContext</code>. This can be done in <code>BootStrap.groovy</code>:<p class="paragraph"/><div class="code"><pre>def init = &#123;
    application.mainContext.eventTriggeringInterceptor.datastores.each &#123; k, datastore &#45;&#62;
        applicationContext.addApplicationListener <span class="java&#45;keyword">new</span> MyPersistenceListener(datastore)
    &#125;
&#125;</pre></div><p class="paragraph"/>or use this in a plugin:<p class="paragraph"/><div class="code"><pre>def doWithApplicationContext = &#123; applicationContext &#45;&#62;
    application.mainContext.eventTriggeringInterceptor.datastores.each &#123; k, datastore &#45;&#62;
        applicationContext.addApplicationListener <span class="java&#45;keyword">new</span> MyPersistenceListener(datastore)
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Hibernate Events</h4><p class="paragraph"/>It is generally encouraged to use the non-Hibernate specific API described above, but if you need access to more detailed Hibernate events then you can define custom Hibernate-specific event listeners.<p class="paragraph"/>You can also register event handler classes in an application's <code>grails-app/conf/spring/resources.groovy</code> or in the <code>doWithSpring</code> closure in a plugin descriptor by registering a Spring bean named <code>hibernateEventListeners</code>. This bean has one property, <code>listenerMap</code> which specifies the listeners to register for various Hibernate events.<p class="paragraph"/>The values of the Map are instances of classes that implement one or more Hibernate listener interfaces. You can use one class that implements all of the required interfaces, or one concrete class per interface, or any combination. The valid Map keys and corresponding interfaces are listed here:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Name</strong></th><th><strong class="bold">Interface</strong></th></tr><tr class="table-odd"><td>auto-flush</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/AutoFlushEventListener.html" class="api">AutoFlushEventListener</a></td></tr><tr class="table-even"><td>merge</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/MergeEventListener.html" class="api">MergeEventListener</a></td></tr><tr class="table-odd"><td>create</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PersistEventListener.html" class="api">PersistEventListener</a></td></tr><tr class="table-even"><td>create-onflush</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PersistEventListener.html" class="api">PersistEventListener</a></td></tr><tr class="table-odd"><td>delete</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/DeleteEventListener.html" class="api">DeleteEventListener</a></td></tr><tr class="table-even"><td>dirty-check</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/DirtyCheckEventListener.html" class="api">DirtyCheckEventListener</a></td></tr><tr class="table-odd"><td>evict</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/EvictEventListener.html" class="api">EvictEventListener</a></td></tr><tr class="table-even"><td>flush</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/FlushEventListener.html" class="api">FlushEventListener</a></td></tr><tr class="table-odd"><td>flush-entity</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/FlushEntityEventListener.html" class="api">FlushEntityEventListener</a></td></tr><tr class="table-even"><td>load</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/LoadEventListener.html" class="api">LoadEventListener</a></td></tr><tr class="table-odd"><td>load-collection</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/InitializeCollectionEventListener.html" class="api">InitializeCollectionEventListener</a></td></tr><tr class="table-even"><td>lock</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/LockEventListener.html" class="api">LockEventListener</a></td></tr><tr class="table-odd"><td>refresh</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/RefreshEventListener.html" class="api">RefreshEventListener</a></td></tr><tr class="table-even"><td>replicate</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/ReplicateEventListener.html" class="api">ReplicateEventListener</a></td></tr><tr class="table-odd"><td>save-update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/SaveOrUpdateEventListener.html" class="api">SaveOrUpdateEventListener</a></td></tr><tr class="table-even"><td>save</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/SaveOrUpdateEventListener.html" class="api">SaveOrUpdateEventListener</a></td></tr><tr class="table-odd"><td>update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/SaveOrUpdateEventListener.html" class="api">SaveOrUpdateEventListener</a></td></tr><tr class="table-even"><td>pre-load</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreLoadEventListener.html" class="api">PreLoadEventListener</a></td></tr><tr class="table-odd"><td>pre-update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreUpdateEventListener.html" class="api">PreUpdateEventListener</a></td></tr><tr class="table-even"><td>pre-delete</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreDeleteEventListener.html" class="api">PreDeleteEventListener</a></td></tr><tr class="table-odd"><td>pre-insert</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreInsertEventListener.html" class="api">PreInsertEventListener</a></td></tr><tr class="table-even"><td>pre-collection-recreate</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreCollectionRecreateEventListener.html" class="api">PreCollectionRecreateEventListener</a></td></tr><tr class="table-odd"><td>pre-collection-remove</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreCollectionRemoveEventListener.html" class="api">PreCollectionRemoveEventListener</a></td></tr><tr class="table-even"><td>pre-collection-update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PreCollectionUpdateEventListener.html" class="api">PreCollectionUpdateEventListener</a></td></tr><tr class="table-odd"><td>post-load</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostLoadEventListener.html" class="api">PostLoadEventListener</a></td></tr><tr class="table-even"><td>post-update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostUpdateEventListener.html" class="api">PostUpdateEventListener</a></td></tr><tr class="table-odd"><td>post-delete</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostDeleteEventListener.html" class="api">PostDeleteEventListener</a></td></tr><tr class="table-even"><td>post-insert</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostInsertEventListener.html" class="api">PostInsertEventListener</a></td></tr><tr class="table-odd"><td>post-commit-update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostUpdateEventListener.html" class="api">PostUpdateEventListener</a></td></tr><tr class="table-even"><td>post-commit-delete</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostDeleteEventListener.html" class="api">PostDeleteEventListener</a></td></tr><tr class="table-odd"><td>post-commit-insert</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostInsertEventListener.html" class="api">PostInsertEventListener</a></td></tr><tr class="table-even"><td>post-collection-recreate</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostCollectionRecreateEventListener.html" class="api">PostCollectionRecreateEventListener</a></td></tr><tr class="table-odd"><td>post-collection-remove</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostCollectionRemoveEventListener.html" class="api">PostCollectionRemoveEventListener</a></td></tr><tr class="table-even"><td>post-collection-update</td><td><a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/event/PostCollectionUpdateEventListener.html" class="api">PostCollectionUpdateEventListener</a></td></tr></table><p class="paragraph"/>For example, you could register a class <code>AuditEventListener</code> which implements <code>PostInsertEventListener</code>, <code>PostUpdateEventListener</code>, and <code>PostDeleteEventListener</code> using the following in an application:<p class="paragraph"/><div class="code"><pre>beans = &#123;<p class="paragraph"/>   auditListener(AuditEventListener)<p class="paragraph"/>   hibernateEventListeners(HibernateEventListeners) &#123;
      listenerMap = &#91;'post&#45;insert': auditListener,
                     'post&#45;update': auditListener,
                     'post&#45;delete': auditListener&#93;
   &#125;
&#125;</pre></div><p class="paragraph"/>or use this in a plugin:<p class="paragraph"/><div class="code"><pre>def doWithSpring = &#123;<p class="paragraph"/>   auditListener(AuditEventListener)<p class="paragraph"/>   hibernateEventListeners(HibernateEventListeners) &#123;
      listenerMap = &#91;'post&#45;insert': auditListener,
                     'post&#45;update': auditListener,
                     'post&#45;delete': auditListener&#93;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>Automatic timestamping</h4><p class="paragraph"/>If you define a <code>dateCreated</code> property it will be set to the current date for you when you create new instances. Likewise, if you define a <code>lastUpdated</code> property it will be automatically be updated for you when you change persistent instances.<p class="paragraph"/>If this is not the behaviour you want you can disable this feature with:<p class="paragraph"/><div class="code"><pre>class Person &#123;
   Date dateCreated
   Date lastUpdated
   <span class="java&#45;keyword">static</span> mapping = &#123;
      autoTimestamp <span class="java&#45;keyword">false</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
If you have <code>nullable: false</code> constraints on either <code>dateCreated</code> or <code>lastUpdated</code>, your domain instances will fail validation - probably not what you want. Omit constraints from these properties unless you disable automatic timestamping.
</blockquote>


<a name="5.5.2 Custom ORM Mapping"><!-- Legacy link --></a>
<h2 id="ormdsl">6.5.2 O/Rマッピングのカスタマイズ</h2>
<div class="hidden-block">Grails domain classes can be mapped onto many legacy schemas with an Object Relational Mapping DSL (domain specific language). The following sections takes you through what is possible with the ORM DSL.</div>
GrailsのドメインクラスはObject Relation Mapping DSL(Domain Specific Language; ドメイン特化言語)を利用して、多くのレガシースキーマにマッピングさせることができます。
この後に続くセクションでは、ORM DSLを使って何ができるかをひとつひとつ見ていきます。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">None of this is necessary if you are happy to stick to the conventions defined by GORM for table names, column names and so on. You only needs this functionality if you need to tailor the way GORM maps onto legacy schemas or configures caching</div>
もしあなたがGORMが定めるテーブル名やカラム名などの規約で満足しているのであれば、これはまったく必要ありません。
GORMをレガシースキーマにマッピングしたり、キャッシュを設定したりするようなカスタマイズが必要な場合にのみ、この機能が必要となります。
</blockquote><p class="paragraph"/><div class="hidden-block">Custom mappings are defined using a static <code>mapping</code> block defined within your domain class:</div>
カスタムマッピングは、ドメインクラス内で定義されるstaticな<code>mapping</code>ブロックを利用して設定します:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        version <span class="java&#45;keyword">false</span>
        autoTimestamp <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also configure global mappings in Config.groovy (or an external config file) using this setting:</div>
Config.groovy内（または外部設定ファイル）で、グローバルマッピングを設定することもできます:<p class="paragraph"/><div class="code"><pre>grails.gorm.<span class="java&#45;keyword">default</span>.mapping = &#123;
    version <span class="java&#45;keyword">false</span>
    autoTimestamp <span class="java&#45;keyword">false</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">It has the same syntax as the standard <code>mapping</code> block but it applies to all your domain classes! You can then override these defaults within the <code>mapping</code> block of a domain class.</div>
これは通常の<code>mapping</code>ブロックと同じシンタックスを持ちますが、すべてのドメインクラスに適用されます。
更に、ドメインクラスの<code>mapping</code>内でこれらのデフォルト設定を上書きすることもできます。


<a name="5.5.2.1 Table and Column Names"><!-- Legacy link --></a>
<h2 id="tableAndColumnNames">6.5.2.1 テーブル名、カラム名</h2>
<div class="hidden-block">h4. Table names</div>
<h4>テーブル名</h4><p class="paragraph"/><div class="hidden-block">The database table name which the class maps to can be customized using the <code>table</code> method:</div>
ドメインクラスと対応するデータベースのテーブル名は<code>table</code>メソッドを使ってカスタマイズすることができます:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the class would be mapped to a table called <code>people</code> instead of the default name of <code>person</code>.</div>
この場合、このクラスはデフォルト名の<code>person</code>の代わりに<code>people</code>テーブルに対応付けられます。<p class="paragraph"/><div class="hidden-block">h4. Column names</div>
<h4>カラム名</h4><p class="paragraph"/><div class="hidden-block">It is also possible to customize the mapping for individual columns onto the database. For example to change the name you can do:</div>
また、個々のカラムに対するデータベースとの対応付けもカスタマイズできます。
名前を変更する例として、次のように書けます:<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        firstName column: 'First_Name'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here <code>firstName</code> is a dynamic method within the <code>mapping</code> Closure that has a single Map parameter. Since its name corresponds to a domain class persistent field, the parameter values (in this case just <code>"column"</code>) are used to configure the mapping for that property.</div>
ここで、<code>firstName</code>は<code>mapping</code>クロージャ内におけるダイナミックメソッドで、Map型の引数を1つ取ります。
その名前はドメインクラスの永続化フィールドと対応していて、Map引数の値（この例ではちょうど<code>"column"</code>の値）はこのプロパティとのマッピングに使われます。<p class="paragraph"/><div class="hidden-block">h4. Column type</div>
<h4>カラムの型</h4><p class="paragraph"/><div class="hidden-block">GORM supports configuration of Hibernate types with the DSL using the type attribute. This includes specifing user types that implement the Hibernate <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/usertype/UserType.html" class="api">org.hibernate.usertype.UserType</a> interface, which allows complete customization of how a type is persisted. As an example if you had a <code>PostCodeType</code> you could use it as follows:</div><p class="paragraph"/>GORMでは、<code>type</code>属性を利用したDSLによって、Hibernateの型を指定できます。
Hibernateの<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/usertype/UserType.html" class="api">org.hibernate.usertype.UserType</a>インターフェイスを実装したユーザ型も指定できます。
これを使えば、ある型がどのように永続化されるかを完全にカスタマイズできます。<p class="paragraph"/><div class="code"><pre>class Address &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> number
    <span class="java&#45;object">String</span> postCode<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        postCode type: PostCodeType
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Alternatively if you just wanted to map it to one of Hibernate's basic types other than the default chosen by Grails you could use:</div>
単にGrailsがデフォルトで選んだものとは別のHibernateの基本型に対応付けしたいだけであれば、以下のように書くこともできます:<p class="paragraph"/><div class="code"><pre>class Address &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> number
    <span class="java&#45;object">String</span> postCode<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        postCode type: 'text'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This would make the <code>postCode</code> column map to the default large-text type for the database you're using (for example TEXT or CLOB).</div>
これは、<code>postCode</code>カラムを使用中のデータベースの標準ラージ文字列型(例えば、TEXTやCLOB型)に対応付けています。<p class="paragraph"/><div class="hidden-block">See the Hibernate documentation regarding <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-types-basictypes" target="blank">Basic Types</a> for further information.</div>
<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/mapping.html#mapping-types-basictypes" target="blank">基本的な型</a>についてのより詳細な情報は、Hibernateのドキュメントを参照してください。<p class="paragraph"/><div class="hidden-block">h4. Many-to-One/One-to-One Mappings</div>
<h4>多対1/1対1マッピング</h4><p class="paragraph"/><div class="hidden-block">In the case of associations it is also possible to configure the foreign keys used to map associations. In the case of a many-to-one or one-to-one association this is exactly the same as any regular column. For example consider the following:</div>
関連の場合、対応付けに使われる外部キーを変更することもできます。
多対1と1対1関連の場合、この方法は普通のカラムの場合とまったく同じです。
例えば、以下を考えます:<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName
    Address address<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        firstName column: 'First_Name'
        address column: 'Person_Address_Id'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">By default the <code>address</code> association would map to a foreign key column called <code>address_id</code>. By using the above mapping we have changed the name of the foreign key column to <code>Person_Adress_Id</code>.</div>
デフォルトでは、<code>address</code>関連は<code>address_id</code>という名前の外部キーカラムに対応付けられます。
上記のマッピングを使うと、その外部キーカラムの名前が<code>Person_Adress_Id</code>に変更されます。<p class="paragraph"/><div class="hidden-block">h4. One-to-Many Mapping</div>
<h4>1対多マッピング</h4><p class="paragraph"/><div class="hidden-block">With a bidirectional one-to-many you can change the foreign key column used by changing the column name on the many side of the association as per the example in the previous section on one-to-one associations. However, with unidirectional associations the foreign key needs to be specified on the association itself. For example given a unidirectional one-to-many relationship between <code>Person</code> and <code>Address</code> the following code will change the foreign key in the <code>address</code> table:</div>
双方向の1対多では、前のセクションの1対1関連の例に従って、関連における「多」側のカラム名を変更することで、外部キーカラムを変更することができます。
一方、単方向の1対多関連の場合は、Grailsはデフォルトで結合テーブルを利用します。
例えば、<code>Person</code>と<code>Address</code>間の単方向1対多関連では、以下のコードで<code>address</code>テーブルに対する外部キーカラム名を変更できます。<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;addresses: Address&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        firstName column: 'First_Name'
        addresses column: 'Person_Address_Id'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you don't want the column to be in the <code>address</code> table, but instead some intermediate join table you can use the <code>joinTable</code> parameter:</div>
もし、結合テーブル自体のテーブル名も含めて指定したい場合は、<code>joinTable</code>パラメータが使えます。<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;addresses: Address&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        firstName column: 'First_Name'
        addresses joinTable: &#91;name: 'Person_Addresses',
                              key: 'Person_Id',
                              column: 'Address_Id'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Many-to-Many Mapping</div>
<h4>多対多マッピング</h4><p class="paragraph"/><div class="hidden-block">Grails, by default maps a many-to-many association using a join table. For example consider this many-to-many association:</div>
Grailsは、デフォルトで結合テーブルを利用して多対多関連を実現します。
例えば、次の多対多関連を考えます:<p class="paragraph"/><div class="code"><pre>class Group &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> hasMany = &#91;people: Person&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> belongsTo = Group
    <span class="java&#45;keyword">static</span> hasMany = &#91;groups: Group&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case Grails will create a join table called <code>group_person</code> containing foreign keys called <code>person_id</code> and <code>group_id</code> referencing the <code>person</code> and <code>group</code> tables. To change the column names you can specify a column within the mappings for each class.</div>
この場合、Grailsは<code>group_person</code>という名前の結合テーブルを生成します。
この結合テーブルは、<code>person</code>と<code>group</code>テーブルを参照する<code>person_id</code>と<code>group_id</code>という名前の外部キーを持っています。
このカラム名を変更するには、それぞれのクラスの<code>mapping</code>内に<code>column</code>を指定します。<p class="paragraph"/><div class="code"><pre>class Group &#123;
   &#8230;
   <span class="java&#45;keyword">static</span> mapping = &#123;
       people column: 'Group_Person_Id'
   &#125;
&#125;
class Person &#123;
   &#8230;
   <span class="java&#45;keyword">static</span> mapping = &#123;
       groups column: 'Group_Group_Id'
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also specify the name of the join table to use:</div>
結合テーブル名を指定することもできます。<p class="paragraph"/><div class="code"><pre>class Group &#123;
   &#8230;
   <span class="java&#45;keyword">static</span> mapping = &#123;
       people column: 'Group_Person_Id',
              joinTable: 'PERSON_GROUP_ASSOCIATIONS'
   &#125;
&#125;
class Person &#123;
   &#8230;
   <span class="java&#45;keyword">static</span> mapping = &#123;
       groups column: 'Group_Group_Id',
              joinTable: 'PERSON_GROUP_ASSOCIATIONS'
   &#125;
&#125;</pre></div>


<a name="5.5.2.2 Caching Strategy"><!-- Legacy link --></a>
<h2 id="caching">6.5.2.2 キャッシングストラテジ</h2>
<div class="hidden-block">h4. Setting up caching</div>
<h4>キャッシング設定</h4><p class="paragraph"/><div class="hidden-block"><a href="http://www.hibernate.org/" target="blank">Hibernate</a> features a second-level cache with a customizable cache provider. This needs to be configured in the <code>grails-app/conf/DataSource.groovy</code> file as follows:</div>
<a href="http://www.hibernate.org/" target="blank">Hibernate</a> はカスタマイズ可能なキャッシュプロバイダによる二次キャッシュを持っています。
利用するには<code>grails-app/conf/DataSource.groovy</code>で次のような設定が必要です:<p class="paragraph"/><div class="code"><pre>hibernate &#123;
    cache.use_second_level_cache=<span class="java&#45;keyword">true</span>
    cache.use_query_cache=<span class="java&#45;keyword">true</span>
    cache.provider_class='org.hibernate.cache.EhCacheProvider'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can customize any of these settings, for example to use a distributed caching mechanism.</div>
分散キャッシュ機構などを使うように設定を変更することもできます。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">For further reading on caching and in particular Hibernate's second-level cache, refer to the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/performance.html#performance-cache" target="blank">Hibernate documentation</a> on the subject.</div>
キャッシングと、特にHibernateの二次キャッシュについてもっと知りたい場合は、<a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/performance.html#performance-cache" target="blank">Hibernateのドキュメント</a>を参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Caching instances</div>
<h4>インスタンスのキャッシュ</h4><p class="paragraph"/><div class="hidden-block">Call the <code>cache</code> method in your mapping block to enable caching with the default settings:</div>
デフォルト設定においてキャッシュを有効にするには、<code>mapping</code>ブロックの中で<code>cache</code>メソッドを呼びます:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        cache <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will configure a 'read-write' cache that includes both lazy and non-lazy properties. You can customize this further:</div>
上の設定では、lazyとnon-lazyの両方のプロパティを含んだread-writeキャッシュが設定されます。
次のようにもっと細かく設定することもできます:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        cache usage: 'read&#45;only', include: 'non&#45;lazy'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Caching associations</div>
<h4>関連のキャッシュ</h4><p class="paragraph"/><div class="hidden-block">As well as the ability to use Hibernate's second level cache to cache instances you can also cache collections (associations) of objects. For example:</div>
Hibernateの2次キャッシュは、インスタンスのキャッシュだけではなく、オブジェクトのコレクション(関連)もキャッシュできます。
例えば:<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;addresses: Address&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        version <span class="java&#45;keyword">false</span>
        addresses column: 'Address', cache: <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Address &#123;
    <span class="java&#45;object">String</span> number
    <span class="java&#45;object">String</span> postCode
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will enable a 'read-write' caching mechanism on the <code>addresses</code> collection. You can also use:</div>
これは<code>addresses</code>コレクション上でのread-writeキャッシュ機構を有効にします。
より細かくカスタマイズするために<p class="paragraph"/><div class="code"><pre>cache: 'read&#45;write' // or 'read&#45;only' or 'transactional'</pre></div><p class="paragraph"/><div class="hidden-block">to further configure the cache usage.</div>
を使うこともできます。<p class="paragraph"/><div class="hidden-block">h4. Caching Queries</div>
<h4>クエリのキャッシュ</h4><p class="paragraph"/><div class="hidden-block">You can cache queries such as dynamic finders and criteria. To do so using a dynamic finder you can pass the <code>cache</code> argument:</div>
ダイナミックファインダやクライテリアのようなクエリをキャッシュすることもできます。
ダイナミックファインダをキャッシュするためには、<code>cache</code>引数を渡します:<p class="paragraph"/><div class="code"><pre>def person = Person.findByFirstName(<span class="java&#45;quote">"Fred"</span>, &#91;cache: <span class="java&#45;keyword">true</span>&#93;)</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">In order for the results of the query to be cached, you must enable caching in your mapping as discussed in the previous section.</div>
キャッシュされたクエリの結果のために、前のセクションで示したように<code>mapping</code>でキャッシュを有効にしなければなりません。
</blockquote><p class="paragraph"/><div class="hidden-block">You can also cache criteria queries:</div>
クライテリアのクエリもキャッシュできます。<p class="paragraph"/><div class="code"><pre>def people = Person.withCriteria &#123;
    like('firstName', 'Fr%')
    cache <span class="java&#45;keyword">true</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Cache usages</div>
<h4>キャッシュの使い方</h4><p class="paragraph"/><div class="hidden-block">Below is a description of the different cache settings and their usages:</div>
それぞれのキャッシュ設定と使い方を以下に示します:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>read-only</code> - If your application needs to read but never modify instances of a persistent class, a read-only cache may be used.</li>
<li><code>read-write</code> - If the application needs to update data, a read-write cache might be appropriate.</li>
<li><code>nonstrict-read-write</code> - If the application only occasionally needs to update data (ie. if it is very unlikely that two transactions would try to update the same item simultaneously) and strict transaction isolation is not required, a <code>nonstrict-read-write</code> cache might be appropriate.</li>
<li><code>transactional</code> - The <code>transactional</code> cache strategy provides support for fully transactional cache providers such as JBoss TreeCache. Such a cache may only be used in a JTA environment and you must specify <code>hibernate.transaction.manager_lookup_class</code> in the <code>grails-app/conf/DataSource.groovy</code> file's <code>hibernate</code> config.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>read-only</code> -アプリケーションが永続化されたデータを変更せず単に読むだけであれば、read-onlyキャッシュが使えます。</li>
<li><code>read-write</code> - アプリケーションがデータを更新する必要があれば、read-writeキャッシュが適しているかも知れません。</li>
<li><code>nonstrict-read-write</code> - アプリケーションがごくたまにデータを更新するぐらいで(すなわち、2つのトランザクションが同時に同一の項目を更新することがほとんどなく)、かつ、厳密なトランザクション分離を必要としないのであれば、<code>nonstrict-read-write</code>キャッシュが適しているかも知れません。</li>
<li><code>transactional</code> - このキャッシュ戦略はJBoss TreeCacheのようなトランザクション対応キャッシュプロバイダを完全にサポートします。このようなキャッシュはJTA環境でのみ使えます。<code>grails-app/conf/DataSource.groovy</code>ファイルの<code>hibernate</code>設定に<code>hibernate.transaction.manager_lookup_class</code>を指定も必要です。</li>
</ul><p class="paragraph"/>

<a name="5.5.2.3 Inheritance Strategies"><!-- Legacy link --></a>
<h2 id="inheritanceStrategies">6.5.2.3 継承ストラテジ</h2>
<div class="hidden-block">By default GORM classes use <code>table-per-hierarchy</code> inheritance mapping. This has the disadvantage that columns cannot have a <code>NOT-NULL</code> constraint applied to them at the database level. If you would prefer to use a <code>table-per-subclass</code> inheritance strategy you can do so as follows:</div>
デフォルトでは、GORMのクラスは<code>table-per-hierarchy</code>継承マッピングを用います。
この場合、データベースレベルで<code>NOT-NULL</code>制約が適用できないというデメリットがあります。
もし<code>table-per-subclass</code>継承を使いたければ、次のように書くことができます:<p class="paragraph"/><div class="code"><pre>class Payment &#123;
    <span class="java&#45;object">Integer</span> amount<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        tablePerHierarchy <span class="java&#45;keyword">false</span>
    &#125;
&#125;<p class="paragraph"/>class CreditCardPayment <span class="java&#45;keyword">extends</span> Payment &#123;
    <span class="java&#45;object">String</span> cardNumber
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The mapping of the root <code>Payment</code> class specifies that it will not be using <code>table-per-hierarchy</code> mapping for all child classes.</div>
<code>Payment</code>スーパクラスのマッピングで、すべてのサブクラスに対して<code>table-per-hierarchy</code>マッピングを使わないように指定しています。


<a name="5.5.2.4 Custom Database Identity"><!-- Legacy link --></a>
<h2 id="identity">6.5.2.4 データベース識別子のカスタマイズ</h2>
<div class="hidden-block">You can customize how GORM generates identifiers for the database using the DSL. By default GORM relies on the native database mechanism for generating ids. This is by far the best approach, but there are still many schemas that have different approaches to identity.</div>
DSLを用いて、GORMがデータベース上の識別子を生成する方法をカスタマイズできます。
デフォルトでは、GORMはIDの生成をデータベース固有の機構に頼っています。
これは最良のアプローチですが、アイデンティティの管理方法として異なるアプローチをとるスキーマも多くあります。<p class="paragraph"/><div class="hidden-block">To deal with this Hibernate defines the concept of an id generator. You can customize the id generator and the column it maps to as follows:</div>
それらを取り扱えるように、HibernateはIDジェネレータという概念を定義しています。
IDジェネレータとそれに対応するカラムは次のようにカスタマイズできます:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        version <span class="java&#45;keyword">false</span>
        id generator: 'hilo',
           params: &#91;table: 'hi_value',
                    column: 'next_value',
                    max_lo: 100&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case we're using one of Hibernate's built in 'hilo' generators that uses a separate table to generate ids.</div>
この例では、Hibernateにビルトインされているhiloジェネレータを使っています。このジェネレータは、IDを生成するために個別のテーブルを使います。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">For more information on the different Hibernate generators refer to the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-declaration-id-generator" target="blank">Hibernate reference documentation</a></div>
Hibernateの各種ジェネレータについての情報は、<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/mapping.html#mapping-declaration-id-generator" target="blank">Hibernateリファレンスドキュメント</a>を参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">Although you don't typically specify the <code>id</code> field (Grails adds it for you) you can still configure its mapping like the other properties. For example to customise the column for the id property you can do:</div>
Grailsが自動的に追加してくれるため、通常はわざわざ<code>id</code>フィールドを指定することはありませんが、
他のプロパティと同様にマッピングを変更することもできます:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        version <span class="java&#45;keyword">false</span>
        id column: 'person_id'
    &#125;
&#125;</pre></div>


<a name="5.5.2.5 Composite Primary Keys"><!-- Legacy link --></a>
<h2 id="compositePrimaryKeys">6.5.2.5 複合主キー</h2>
<div class="hidden-block">GORM supports the concept of composite identifiers (identifiers composed from 2 or more properties). It is not an approach we recommend, but is available to you if you need it:</div>
GORMは複合主キー(2つ以上のプロパティから構成される識別子)をサポートしています。
複合主キーはお勧めの方法ではありませんが、必要ならば利用可能です。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.commons.lang.builder.HashCodeBuilder<p class="paragraph"/>class Person <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName<p class="paragraph"/>    <span class="java&#45;object">boolean</span> equals(other) &#123;
        <span class="java&#45;keyword">if</span> (!(other <span class="java&#45;keyword">instanceof</span> Person)) &#123;
            <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
        &#125;<p class="paragraph"/>        other.firstName == firstName &#38;&#38; other.lastName == lastName
    &#125;<p class="paragraph"/>    <span class="java&#45;object">int</span> hashCode() &#123;
        def builder = <span class="java&#45;keyword">new</span> HashCodeBuilder()
        builder.append firstName
        builder.append lastName
        builder.toHashCode()
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        id composite: &#91;'firstName', 'lastName'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above will create a composite id of the <code>firstName</code> and <code>lastName</code> properties of the Person class. To retrieve an instance by id you use a prototype of the object itself:</div>
上の例では、<code>Person</code>クラスの<code>firstName</code>と<code>lastName</code>プロパティを複合主キーにしています。
IDでインスタンスを取得するためには、そのドメインクラスの未保存のインスタンスを検索条件として使用します:<p class="paragraph"/><div class="code"><pre>def p = Person.get(<span class="java&#45;keyword">new</span> Person(firstName: <span class="java&#45;quote">"Fred"</span>, lastName: <span class="java&#45;quote">"Flintstone"</span>))
println p.firstName</pre></div><p class="paragraph"/><div class="hidden-block">Domain classes mapped with composite primary keys must implement the <code>Serializable</code> interface and override the <code>equals</code> and <code>hashCode</code> methods, using the properties in the composite key for the calculations. The example above uses a <code>HashCodeBuilder</code> for convenience but it's fine to implement it yourself.</div>
複合主キーを用いるドメインクラスでは、<code>Serializable</code>インターフェイスの実装と<code>equals</code>と<code>hashCode</code>メソッドのオーバライドが必要です。
これによって複合キーのプロパティを同一性の算定に利用できるようになります。
前述の例では、簡便のため<code>HashCodeBuilder</code>を利用しましたが、もちろん自分で実装しても構いません。<p class="paragraph"/><div class="hidden-block">Another important consideration when using composite primary keys is associations. If for example you have a many-to-one association where the foreign keys are stored in the associated table then 2 columns will be present in the associated table.</div>
複合主キーを利用する上で、もう一つ抑えておかなければならないのが関連です。
例えば多対1関連の場合、外部キーが関連元テーブル上に格納されますが、上記のように複合主キーを利用すると外部キー用に2つのカラムが必要なことになります。<p class="paragraph"/><div class="hidden-block">For example consider the following domain class:</div>
例えば、次のドメインクラスを考えます:<p class="paragraph"/><div class="code"><pre>class Address &#123;
    Person person
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the <code>address</code> table will have an additional two columns called <code>person_first_name</code> and <code>person_last_name</code>. If you wish the change the mapping of these columns then you can do so using the following technique:</div>
この場合、<code>address</code>テーブルには、<code>person_first_name</code>と<code>person_last_name</code>という2つのカラムが追加されることになります。
もし、これらのカラムへの対応付けを変更したいのであれば、次のようにできます:<p class="paragraph"/><div class="code"><pre>class Address &#123;
    Person person
    <span class="java&#45;keyword">static</span> mapping = &#123;
        columns &#123;
		    person &#123;
                column name: <span class="java&#45;quote">"FirstName"</span>
                column name: <span class="java&#45;quote">"LastName"</span>
			&#125;
        &#125;
    &#125;
&#125;</pre></div>


<a name="5.5.2.6 Database Indices"><!-- Legacy link --></a>
<h2 id="databaseIndices">6.5.2.6 データベースインデックス</h2>
<div class="hidden-block">To get the best performance out of your queries it is often necessary to tailor the table index definitions. How you tailor them is domain specific and a matter of monitoring usage patterns of your queries. With GORM's DSL you can specify which columns are used in which indexes:</div>
クエリに対してベストな性能を得るために、多くの場合は、テーブルに対するインデックス定義の追加が必要となります。
GORMのDSLで、どのカラムがどのインデックスを使うかを指定することができます。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> address
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        version <span class="java&#45;keyword">false</span>
        id column: 'person_id'
        firstName column: 'First_Name', index: 'Name_Idx'
        address column: 'Address', index: 'Name_Idx,Address_Index'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that you cannot have any spaces in the value of the <code>index</code> attribute; in this example <code>index:'Name_Idx, Address_Index'</code> will cause an error.</div>
<code>index</code>属性の値にスペースを入れることはできないことに注意してください。
例えば、<code>index:'Name_Idx, Address_Index'</code>はエラーになります。


<a name="5.5.2.7 Optimistic Locking and Versioning"><!-- Legacy link --></a>
<h2 id="optimisticLockingAndVersioning">6.5.2.7 楽観的ロックとバージョニング</h2>
<div class="hidden-block">As discussed in the section on <a href="../guide/single.html#locking" class="guide">Optimistic and Pessimistic Locking</a>, by default GORM uses optimistic locking and automatically injects a <code>version</code> property into every class which is in turn mapped to a <code>version</code> column at the database level.</div>
<a href="../guide/single.html#locking" class="guide">楽観的ロックと悲観的ロック</a>のセクションで書いたように、GORMはデフォルトで、楽観的ロックを使用し、データベースの<code>version</code>カラムにそれぞれ対応付けられている<code>version</code>プロパティを全てのドメインクラスに自動的に注入します。<p class="paragraph"/><div class="hidden-block">If you're mapping to a legacy schema that doesn't have version columns (or there's some other reason why you don't want/need this feature) you can disable this with the <code>version</code> method:</div>
もし<code>version</code>カラムを持たないレガシースキーマとの対応付けをしている(または、楽観的ロックを必要としない他の理由がある)ならば、<code>version</code>メソッドを使ってこの機能を無効化できます。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
        version <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If you disable optimistic locking you are essentially on your own with regards to concurrent updates and are open to the risk of users losing data (due to data overriding) unless you use <a href="../guide/single.html#locking" class="guide">pessimistic locking</a></div>
楽観的ロックを無効化した場合、同時更新に対するサポートがなくなるため、<a href="../guide/single.html#locking" class="guide">悲観的ロック</a>を使わない限り(データ上書きによる)ユーザのデータ消失リスクに晒されます。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Version columns types</div>
<h4>バージョンのカラム型</h4><p class="paragraph"/><div class="hidden-block">By default Grails maps the <code>version</code> property as a <code>Long</code> that gets incremented by one each time an instance is updated. But Hibernate also supports using a <code>Timestamp</code>, for example:</div>
Grailsはデフォルトで、<code>version</code>プロパティを<code>Long</code>型にマッピングし、インスタンスが更新されるごとにインクリメントします。
しかし、Hibernateは<code>Timetamp</code>型もサポートしています。例えば:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> java.sql.Timestamp<p class="paragraph"/>class Person &#123;<p class="paragraph"/>    &#8230;
    Timestamp version<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        table 'people'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">There's a slight risk that two updates occurring at nearly the same time on a fast server can end up with the same timestamp value but this risk is very low. One benefit of using a <code>Timestamp</code> instead of a <code>Long</code> is that you combine the optimistic locking and last-updated semantics into a single column.</div>
高性能なサーバ上でほぼ同時に発生した2つの更新が同一のタイムスタンプ値になってしまう、というリスクが僅かながらあります。しかし、このリスクは非常に小さいです。
<code>Long</code>型の代わりに<code>Timestamp</code>型を使うメリットの1つは、1つのカラムで楽観的ロックと最終更新日時の意味を兼任できることです。


<a name="5.5.2.8 Eager and Lazy Fetching"><!-- Legacy link --></a>
<h2 id="fetchingDSL">6.5.2.8 EagerフェッチとLazyフェッチ</h2>
<div class="hidden-block">h4. Lazy Collections</div>
<h4>Lazyコレクション</h4><p class="paragraph"/><div class="hidden-block">As discussed in the section on <a href="../guide/single.html#fetching" class="guide">Eager and Lazy fetching</a>, GORM collections are lazily loaded by default but you can change this behaviour with the ORM DSL. There are several options available to you, but the most common ones are:</div>
永続化の基礎の<a href="../guide/single.html#fetching" class="guide">EagerフェッチとLazyフェッチ</a>のセクションで書いたように、GORMのコレクションはデフォルトでLazyにロードされます。
しかし、ORM DSLでこの振る舞いを変更することができます。
いくつかのオプションが使えますが、もっともよく使われるのは次の2つです:
<ul class="star">
<li>lazy: false</li>
<li>fetch: 'join'</li>
</ul><p class="paragraph"/><div class="hidden-block">and they're used like this:</div>
次のように使います:<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName
    Pet pet<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;addresses: Address&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        addresses lazy: <span class="java&#45;keyword">false</span>
        pet fetch: 'join'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Address &#123;
    <span class="java&#45;object">String</span> street
    <span class="java&#45;object">String</span> postCode
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Pet &#123;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The first option, <code>lazy: false</code> , ensures that when a <code>Person</code> instance is loaded, its <code>addresses</code> collection is loaded at the same time with a second SELECT. The second option is basically the same, except the collection is loaded with a JOIN rather than another SELECT. Typically you want to reduce the number of queries, so <code>fetch: 'join'</code> is the more appropriate option. On the other hand, it could feasibly be the more expensive approach if your domain model and data result in more and larger results than would otherwise be necessary.</div>
最初のオプションの<code>lazy: false</code>は、<code>Person</code>インスタンスがロードされるときに、同時に2本目のSELECTが発行されて<code>addresses</code>コレクションがロードされることを保証します。
2つめのオプションは別のSELECT文ではなくJOIN構文によってロードされる点を除けば、基本的に同じです。
一般的にクエリの数を減らしたいときは、<code>fetch: 'join'</code>は適切なオプションです。
一方で、ドメインモデルとデータが大量にヒットしてしまう場合、JOINはより高コストなアプローチになってしまう可能性もあります。<p class="paragraph"/><div class="hidden-block">For more advanced users, the other settings available are:</div>
他にも上級ユーザ向けの役立つ設定があります:
<ol>
<li>batchSize: N</li>
<li>lazy: false, batchSize: N</li>
</ol><p class="paragraph"/><div class="hidden-block">where N is an integer. These let you fetch results in batches, with one query per batch. As a simple example, consider this mapping for <code>Person</code>:</div>
Nは整数とします。
これによって結果をバッチでフェッチできます。
それぞれのバッチごとに1つのクエリが発行されます。
単純な例として、<code>Person</code>でのマッピングを考えます。<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName
    Pet pet<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        pet batchSize: 5
    &#125;
&#125;</pre></div>
<div class="hidden-block">If a query returns multiple <code>Person</code> instances, then when we access the first <code>pet</code> property, Hibernate will fetch that <code>Pet</code> plus the four next ones. You can get the same behaviour with eager loading by combining <code>batchSize</code> with the <code>lazy: false</code> option. You can find out more about these options in the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/performance.html#performance-fetching" target="blank">Hibernate user guide</a> and this <a href="http://community.jboss.org/wiki/AShortPrimerOnFetchingStrategies" target="blank">primer on fetching strategies</a>. Note that ORM DSL does not currently support the "subselect" fetching strategy.</div>
クエリが複数の<code>Person</code>インスタンスを返す場合、最初の<code>Person</code>インスタンスの<code>pet</code>プロパティにアクセスしたときに、Hibernateはその<code>Person</code>インスタンスに関連する<code>Pet</code>インスタンスと、それに続く4つの<code>Pet</code>インスタンスをフェッチします。
<code>batchSize</code>と<code>lazy: false</code>オプションを同時に指定したEagerフェッチの場合も同じ挙動になります。
<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/performance.html#performance-fetching" target="blank">Hibernateユーザガイドのフェッチ戦略</a>と<a href="http://community.jboss.org/wiki/AShortPrimerOnFetchingStrategies" target="blank">フェッチ戦略入門</a>で、これらのオプションについてもっと情報を得ることができます。
ORM DSLは今のところ「subselect」フェッチ戦略をサポートしていないことに注意してください。<p class="paragraph"/><div class="hidden-block">h4. Lazy Single-Ended Associations</div>
<h4>Lazy単一終端関連</h4><p class="paragraph"/><div class="hidden-block">In GORM, one-to-one and many-to-one associations are by default lazy. Non-lazy single ended associations can be problematic when you load many entities because each non-lazy association will result in an extra SELECT statement. If the associated entities also have non-lazy associations, the number of queries grows significantly!</div>
GORMでは、1対1と多対1関連はデフォルトでLazyです。
非Lazyの単一終端関連では、大量のエンティティをロードするときに問題が発生する可能性があります。
非Lazy関連ごとに追加のSELECT文を発行してしまうためです。
関連エンティティが更に非Lazy関連を持つ場合、クエリは相当な数になってしまいます!<p class="paragraph"/><div class="hidden-block">Use the same technique as for lazy collections to make a one-to-one or many-to-one association non-lazy/eager:</div>
1対1/多対1関連を非LazyつまりEagerにするには、Lazyコレクションのときと同じ方法を使います:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Address &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> street
    <span class="java&#45;object">String</span> postCode<p class="paragraph"/>    <span class="java&#45;keyword">static</span> belongsTo = &#91;person: Person&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        person lazy: <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we configure GORM to load the associated <code>Person</code> instance (through the <code>person</code> property) whenever an <code>Address</code> is loaded.</div>
ここでは、<code>Address</code>がロードされるごとに、(<code>person</code>プロパティを通して)関連づけられた<code>Person</code>インスタンスをロードするようにGORMを設定しています。<p class="paragraph"/><div class="hidden-block">h4. Lazy Single-Ended Associations and Proxies</div>
<h4>Lazy単一終端関連とプロキシ</h4><p class="paragraph"/><div class="hidden-block">Hibernate uses runtime-generated proxies to facilitate single-ended lazy associations; Hibernate dynamically subclasses the entity class to create the proxy.</div>
HibernateはLazy単一終端関連を扱うためにプロキシを実行時に生成して利用しています。
Hibernateはプロキシを生成するためにエンティティクラスを動的にサブクラス化します。<p class="paragraph"/><div class="hidden-block">Consider the previous example but with a lazily-loaded <code>person</code> association: Hibernate will set the <code>person</code> property to a proxy that is a subclass of <code>Person</code>. When you call any of the getters (except for the <code>id</code> property) or setters on that proxy, Hibernate will load the entity from the database.</div>
前項の例で、<code>person</code>関連がLazyロードされる場合を考えます。
Hibernateは<code>Person</code>のサブクラスであるプロキシを<code>person</code>プロパティにセットします。
そのプロキシに対してsetterか(<code>id</code>プロパティ以外の)getterを呼んだとき、Hibernateはデータベースからそのエンティティをロードします。<p class="paragraph"/><div class="hidden-block">Unfortunately this technique can produce surprising results. Consider the following example classes:</div>
残念なことに、この機構は驚くべき結果をもたらします。
以下のようなサンプルクラスを考えます:<p class="paragraph"/><div class="code"><pre>class Pet &#123;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Dog <span class="java&#45;keyword">extends</span> Pet &#123;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    Pet pet
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">and assume that we have a single <code>Person</code> instance with a <code>Dog</code> as the <code>pet</code>. The following code will work as you would expect:</div>
ここで、<code>pet</code>として<code>Dog</code>を持っている1つの<code>Person</code>インスタンスがあると仮定します。
以下のコードは期待通りに動作します:<p class="paragraph"/><div class="code"><pre>def person = Person.get(1)
assert person.pet <span class="java&#45;keyword">instanceof</span> Dog
assert Pet.get(person.petId) <span class="java&#45;keyword">instanceof</span> Dog</pre></div><p class="paragraph"/><div class="hidden-block">But this won't:</div>
しかし、次のコードは期待通りに動作しません:<p class="paragraph"/><div class="code"><pre>def person = Person.get(1)
assert person.pet <span class="java&#45;keyword">instanceof</span> Dog
assert Pet.list()&#91;0&#93; <span class="java&#45;keyword">instanceof</span> Dog</pre></div><p class="paragraph"/><div class="hidden-block">The second assertion fails, and to add to the confusion, this will work:</div>
2番目のアサーションが失敗します。
混乱がさらに深まるでしょうが、次のコードは動作します。<p class="paragraph"/><div class="code"><pre>assert Pet.list()&#91;0&#93; <span class="java&#45;keyword">instanceof</span> Dog</pre></div><p class="paragraph"/><div class="hidden-block">What's going on here? It's down to a combination of how proxies work and the guarantees that the Hibernate session makes. When you load the <code>Person</code> instance, Hibernate creates a proxy for its <code>pet</code> relation and attaches it to the session. Once that happens, whenever you retrieve that <code>Pet</code> instance with a query, a <code>get()</code>, or the <code>pet</code> relation  <em class="italic">within the same session</em>  , Hibernate gives you the proxy.</div>
一体何が起こっているのでしょうか？
この原因はプロキシの働きとHibernateセッションによる1次キャッシュの連携です。
<code>Person</code>インスタンスをロードしたとき、Hibernateは<code>pet</code>プロパティ用にプロキシを生成してセッションにアタッチします。
一度その状態になってしまうと、  <em class="italic">同一セッション内で</em>  クエリや<code>get()</code>や<code>pet</code>プロパティを経由して<code>Pet</code>インスタンスを取得するたびに、Hibernateはセッションに登録されているプロキシを返します。<p class="paragraph"/><div class="hidden-block">Fortunately for us, GORM automatically unwraps the proxy when you use <code>get()</code> and <code>findBy&#42;()</code>, or when you directly access the relation. That means you don't have to worry at all about proxies in the majority of cases. But GORM doesn't do that for objects returned with a query that returns a list, such as <code>list()</code> and <code>findAllBy&#42;()</code>. However, if Hibernate hasn't attached the proxy to the session, those queries will return the real instances - hence why the last example works.</div>
幸いなことに、GORMは<code>get()</code>と<code>findBy&#42;()</code>を使ったとき、または、直接関連プロパティにアクセスしたときには、自動的にプロキシをアンラップしてくれます。
これは大部分のケースにおいては、プロキシについて少しも心配する必要がないことを意味します。
しかし、<code>list()</code>や<code>findAllBy&#42;()</code>のようなリストを返すクエリによって取得したオブジェクトに対しては、GORMはそのようなサポートをしてくれません。
しかし、Hibernateがプロキシをセッションにアタッチしていなければ、これらのクエリはプロキシではない本物のインスタンスを返します。このため、先ほどの最後の例はうまく動作したのです。<p class="paragraph"/><div class="hidden-block">You can protect yourself to a degree from this problem by using the <code>instanceOf</code> method by GORM:</div>
GORMが提供する<code>instanceOf</code>メソッドを使ってこの問題をある程度回避することもできます。<p class="paragraph"/><div class="code"><pre>def person = Person.get(1)
assert Pet.list()&#91;0&#93;.instanceOf(Dog)</pre></div><p class="paragraph"/><div class="hidden-block">However, it won't help here if casting is involved. For example, the following code will throw a <code>ClassCastException</code> because the first pet in the list is a proxy instance with a class that is neither <code>Dog</code> nor a sub-class of <code>Dog</code>:</div>
しかし、キャストを伴う場合はこれでは解決できません。
たとえば、以下のコードは<code>ClassCastException</code>をスローします。
なぜなら、リスト中の最初のペットが<code>Dog</code>でも<code>Dog</code>のサブクラスでもないプロキシインスタンスだからです。<p class="paragraph"/><div class="code"><pre>def person = Person.get(1)
Dog pet = Pet.list()&#91;0&#93;</pre></div><p class="paragraph"/><div class="hidden-block">Of course, it's best not to use static types in this situation. If you use an untyped variable for the pet instead, you can access any <code>Dog</code> properties or methods on the instance without any problems.</div>
もちろん、この場合は静的型を使わないのがベストです。
代わりに型宣言の無い変数をpetに使えば、問題なくそのインスタンス上の<code>Dog</code>プロパティやメソッドにアクセスできます。<p class="paragraph"/><div class="hidden-block">These days it's rare that you will come across this issue, but it's best to be aware of it just in case. At least you will know why such an error occurs and be able to work around it.</div>
最近はこの問題に出くわすことは滅多にないですが、万一のために知っておくことは大切です。
少なくとも、なぜそのようなエラーが発生するのかを理解して回避できます。


<a name="5.5.2.9 Custom Cascade Behaviour"><!-- Legacy link --></a>
<h2 id="customCascadeBehaviour">6.5.2.9 カスケードの振る舞いを変える</h2>
<div class="hidden-block">As described in the section on <a href="../guide/single.html#cascades" class="guide">cascading updates</a>, the primary mechanism to control the way updates and deletes cascade from one association to another is the static <a href="../ref/Domain Classes/belongsTo.html" class="domainClasses">belongsTo</a> property.</div>
<a href="../guide/single.html#cascades" class="guide">カスケード更新</a>のセクションで記載した通り、更新と削除が1つの関連からもう一方へとカスケードする方法を制御するためには、staticの<a href="../ref/Domain Classes/belongsTo.html" class="domainClasses">belongsTo</a>プロパティを使います。<p class="paragraph"/><div class="hidden-block">However, the ORM DSL gives you complete access to Hibernate's <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/objectstate.html#objectstate-transitive" target="blank">transitive persistence</a> capabilities using the <code>cascade</code> attribute.</div>
しかし、ORM DSLでは、Hibernateの<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/objectstate.html#objectstate-transitive" target="blank">連鎖的な永続化</a>機能への<code>cascade</code>属性を使った完全なアクセスを提供しています。<p class="paragraph"/><div class="hidden-block">Valid settings for the cascade attribute include:</div>
<code>cascade</code>属性のための有効な設定値は以下の通りです:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>merge</code> - merges the state of a detached association</li>
<li><code>save-update</code> - cascades only saves and updates to an association</li>
<li><code>delete</code> - cascades only deletes to an association</li>
<li><code>lock</code> - useful if a pessimistic lock should be cascaded to its associations</li>
<li><code>refresh</code> - cascades refreshes to an association</li>
<li><code>evict</code> - cascades evictions (equivalent to <code>discard()</code> in GORM) to associations if set</li>
<li><code>all</code> - cascade  <em class="italic">all</em>  operations to associations</li>
<li><code>all-delete-orphan</code> - Applies only to one-to-many associations and indicates that when a child is removed from an association then it should be automatically deleted. Children are also deleted when the parent is.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>merge</code> - デタッチされた関連の状態をマージする</li>
<li><code>save-update</code> - saveとupdateのみを関連先にカスケードする</li>
<li><code>delete</code> - deleteのみを関連先にカスケードする</li>
<li><code>lock</code> - 悲観的ロックを関連先にカスケードしたいときに役立つ</li>
<li><code>refresh</code> - refreshを関連先にカスケードする</li>
<li><code>evict</code> - これをセットすると、evict(GORMでの<code>discard()</code>に相当)を関連先にカスケードする</li>
<li><code>all</code> -  <em class="italic">すべての</em>  操作を関連先にカスケードする</li>
<li><code>all-delete-orphan</code> - 1対多関連にのみ適用する。子要素を関連から取り除いたときに自動的にその子要素を削除することを意味する。親が削除されたときは、子要素すべてが削除される。</li>
</ul><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">
It is advisable to read the section in the Hibernate documentation on <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/objectstate.html#objectstate-transitive" target="blank">transitive persistence</a> to obtain a better understanding of the different cascade styles and recommendations for their usage
</div>
様々なカスケード方式と推奨される利用方法についてより良く理解するために、Hibernateのドキュメントの<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/objectstate.html#objectstate-transitive" target="blank">連鎖的な永続化</a>のセクションを読むことをお勧めします。
</blockquote><p class="paragraph"/><div class="hidden-block">To specify the cascade attribute simply define one or more (comma-separated) of the aforementioned settings as its value:</div>
<code>cascade</code>属性を指定するには、単純に1つまたは(カンマで区切られた)複数の前述の設定値を定義します。<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstName<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;addresses: Address&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        addresses cascade: <span class="java&#45;quote">"all&#45;delete&#45;orphan"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Address &#123;
    <span class="java&#45;object">String</span> street
    <span class="java&#45;object">String</span> postCode
&#125;</pre></div>


<a name="5.5.2.10 Custom Hibernate Types"><!-- Legacy link --></a>
<h2 id="customHibernateTypes">6.5.2.10 Hibernateのカスタム型</h2>
<div class="hidden-block">You saw in an earlier section that you can use composition (with the <code>embedded</code> property) to break a table into multiple objects. You can achieve a similar effect with Hibernate's custom user types. These are not domain classes themselves, but plain Java or Groovy classes. Each of these types also has a corresponding "meta-type" class that implements <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/usertype/UserType.html" class="api">org.hibernate.usertype.UserType</a>.</div>
以前のセクションで、1つのテーブルに対して複数のオブジェクトを対応付けるために、<code>embedded</code>プロパティによるコンポジションが使えることを説明しました。
Hibernateのカスタム型を利用すると同じようなことができます。
カスタム型自体はドメインクラスではなく、普通のJavaやGroovyクラスです。
また、それぞれのカスタム型には対応する「メタ型(meta-type)」クラスがあります。メタ型クラスは<a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/usertype/UserType.html" class="api">org.hibernate.usertype.UserType</a>インタフェースを実装します。<p class="paragraph"/><div class="hidden-block">The <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-types-custom" target="blank">Hibernate reference manual</a> has some information on custom types, but here we will focus on how to map them in Grails. Let's start by taking a look at a simple domain class that uses an old-fashioned (pre-Java 1.5) type-safe enum class:</div>
カスタム型についての情報は<a href="http://docs.jboss.org/hibernate/core/3.6/reference/ja-JP/html/mapping.html#mapping-types-custom" target="blank">Hibernateリファレンスマニュアル</a>にあります。
ここではそれをGrails上でどのようにマッピングするかに焦点を絞ります。
(Java1.5以前の)昔ながらのタイプセーフenumクラスを使ったシンプルなドメインクラスをみてみましょう:<p class="paragraph"/><div class="code"><pre>class Book &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title
    <span class="java&#45;object">String</span> author
    Rating rating<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        rating type: RatingUserType
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">All we have done is declare the <code>rating</code> field the enum type and set the property's type in the custom mapping to the corresponding <code>UserType</code> implementation. That's all you have to do to start using your custom type. If you want, you can also use the other column settings such as "column" to change the column name and "index" to add it to an index.</div>
<code>rating</code>フィールドをenum型として宣言し、カスタムマッピングでそのプロパティの型を<code>UserType</code>実装型にマッピングしています。
カスタム型に必要な設定はこれだけですが、必要であれば、カラム名を変更する「column」やインデックスを追加する「index」のような他のカラムの設定を使うこともできます。<p class="paragraph"/><div class="hidden-block">Custom types aren't limited to just a single column - they can be mapped to as many columns as you want. In such cases you explicitly define in the mapping what columns to use, since Hibernate can only use the property name for a single column. Fortunately, Grails lets you map multiple columns to a property using this syntax:</div>
カスタム型は単一カラム用に制限されているわけではありません。必要な分の複数カラムに対してマッピングできます。
単一カラムの場合はHibernateはプロパティ名を利用できますが、複数カラムの場合はどのカラムを使うのか<code>mapping</code>で明示的に定義する必要があります:<p class="paragraph"/><div class="code"><pre>class Book &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title
    Name author
    Rating rating<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        author type: NameUserType, &#123;
            column name: <span class="java&#45;quote">"first_name"</span>
            column name: <span class="java&#45;quote">"last_name"</span>
        &#125;
        rating type: RatingUserType
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above example will create "first_name" and "last_name" columns for the <code>author</code> property. You'll be pleased to know that you can also use some of the normal column/property mapping attributes in the column definitions. For example:</div>
上の例では、<code>author</code>プロパティに対して、「first_name」と「last_name」という2つのカラムが作成されます。
嬉しいことに、このカラム定義において、通常のカラム/プロパティのマッピング属性がいくつか使えます。
例えば:<p class="paragraph"/><div class="code"><pre>column name: <span class="java&#45;quote">"first_name"</span>, index: <span class="java&#45;quote">"my_idx"</span>, unique: <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">The column definitions do  <em class="italic">not</em>  support the following attributes: <code>type</code>, <code>cascade</code>, <code>lazy</code>, <code>cache</code>, and <code>joinTable</code>.</div>
このカラム定義では次の属性はサポートされていません: <code>type</code>, <code>cascade</code>, <code>lazy</code>, <code>cache</code>, <code>joinTable</code><p class="paragraph"/><div class="hidden-block">One thing to bear in mind with custom types is that they define the  <em class="italic">SQL types</em>  for the corresponding database columns. That helps take the burden of configuring them yourself, but what happens if you have a legacy database that uses a different SQL type for one of the columns? In that case, override the column's SQL type using the <code>sqlType</code> attribute:</div>
カスタム型について覚えておくべきことの1つは、対応するデータベースのカラムの  <em class="italic">SQLデータ型</em>  があらかじめ決められていることです。
これによって自分で設定する負担が低減されます。しかし、カスタム型の想定とは異なるSQLデータ型が使われているレガシーデータベース上では、どうなってしまうのでしょうか？
そのような場合は、<code>sqlType</code>属性を使ってそのカラムのSQLデータ型を上書きしてください:<p class="paragraph"/><div class="code"><pre>class Book &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title
    Name author
    Rating rating<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        author type: NameUserType, &#123;
            column name: <span class="java&#45;quote">"first_name"</span>, sqlType: <span class="java&#45;quote">"text"</span>
            column name: <span class="java&#45;quote">"last_name"</span>, sqlType: <span class="java&#45;quote">"text"</span>
        &#125;
        rating type: RatingUserType, sqlType: <span class="java&#45;quote">"text"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Mind you, the SQL type you specify needs to still work with the custom type. So overriding a default of "varchar" with "text" is fine, but overriding "text" with "yes_no" isn't going to work.</div>
指定したSQLデータ型とカスタム型に整合性が必要なことに注意してください。
デフォルトの「varchar」を「text」に上書きするのは良いですが、「text」を「yes_no」に上書きしてもうまく動きません。


<a name="5.5.2.11 Derived Properties"><!-- Legacy link --></a>
<h2 id="derivedProperties">6.5.2.11 派生プロパティ</h2>
<div class="hidden-block">A derived property is one that takes its value from a SQL expression, often but not necessarily based on the value of one or more other persistent properties.  Consider a Product class like this:</div>
派生プロパティはSQL式によって値が定まるプロパティです。
しかし、必ずしも他の1つ以上の永続化プロパティの値に基づいている必要はありません。
次のようなProductクラスを考えます:<p class="paragraph"/><div class="code"><pre>class Product &#123;
    <span class="java&#45;object">Float</span> price
    <span class="java&#45;object">Float</span> taxRate
    <span class="java&#45;object">Float</span> tax
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If the <code>tax</code> property is derived based on the value of <code>price</code> and <code>taxRate</code> properties then is probably no need to persist the <code>tax</code> property.  The SQL used to derive the value of a derived property may be expressed in the ORM DSL like this:</div>
もし<code>tax</code>プロパティが<code>price</code>と<code>taxRate</code>プロパティの値に基づいて算出されているなら、おそらく<code>tax</code>プロパティを永続化する必要はないでしょう。
派生プロパティの算出に使われるSQLは、ORM DSLで次のように表すことができます:<p class="paragraph"/><div class="code"><pre>class Product &#123;
    <span class="java&#45;object">Float</span> price
    <span class="java&#45;object">Float</span> taxRate
    <span class="java&#45;object">Float</span> tax<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        tax formula: 'PRICE &#42; TAX_RATE'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that the formula expressed in the ORM DSL is SQL so references to other properties should relate to the persistence model not the object model, which is why the example refers to <code>PRICE</code> and <code>TAX_RATE</code> instead of <code>price</code> and <code>taxRate</code>.</div>
ORM DSLで表された式はSQLであるため、他のプロパティへの参照はオブジェクトモデルではなくデータベース上の永続化モデルの方に合わせることに注意してください。
サンプルコード上で<code>price</code>と<code>taxRate</code>ではなく、<code>PRICE</code>と<code>TAX_RATE</code>となっているのはそのためです。<p class="paragraph"/><div class="hidden-block">With that in place, when a Product is retrieved with something like <code>Product.get(42)</code>, the SQL that is generated to support that will look something like this:</div>
このような設定で、Productが<code>Product.get(42)</code>のように取得されたとき、生成されるSQLは次のようになります:<p class="paragraph"/><div class="code"><pre>select
    product0_.id as id1_0_,
    product0_.version as version1_0_,
    product0_.price as price1_0_,
    product0_.tax_rate as tax4_1_0_,
    product0_.PRICE &#42; product0_.TAX_RATE as formula1_0_
from
    product product0_
where
    product0_.id=?</pre></div><p class="paragraph"/><div class="hidden-block">Since the <code>tax</code> property is derived at runtime and not stored in the database it might seem that the same effect could be achieved by adding a method like <code>getTax()</code> to the <code>Product</code> class that simply returns the product of the <code>taxRate</code> and <code>price</code> properties.  With an approach like that you would give up the ability query the database based on the value of the <code>tax</code> property.  Using a derived property allows exactly that.  To retrieve all <code>Product</code> objects that have a <code>tax</code> value greater than 21.12 you could execute a query like this:</div>
<code>tax</code>プロパティは実行時に算出されデータベース上には格納されないため、<code>Product</code>クラスに<code>getTax()</code>のようなメソッドを追加して、単純に<code>taxRate</code>と<code>price</code>プロパティの積を返すようにすることで、同じ結果を達成できるようにみえるかもしれません。
しかし、そのようなアプローチでは、<code>tax</code>プロパティの値に基づいてデータベースを検索する能力を放棄することになります。
派生プロパティを使えばそれが可能です。
たとえば、<code>tax</code>の値が21.12以上のすべての<code>Product</code>オブジェクトを取得するために、
次のようなクエリを実行できます:<p class="paragraph"/><div class="code"><pre>Product.findAllByTaxGreaterThan(21.12)</pre></div><p class="paragraph"/><div class="hidden-block">Derived properties may be referenced in the Criteria API:</div>
派生プロパティはクライテリアAPIでも使えます:<p class="paragraph"/><div class="code"><pre>Product.withCriteria &#123;
    gt 'tax', 21.12f
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The SQL that is generated to support either of those would look something like this:</div>
これらを実行するために生成されたSQLは次のようになります:<p class="paragraph"/><div class="code"><pre>select
    this_.id as id1_0_,
    this_.version as version1_0_,
    this_.price as price1_0_,
    this_.tax_rate as tax4_1_0_,
    this_.PRICE &#42; this_.TAX_RATE as formula1_0_
from
    product this_
where
    this_.PRICE &#42; this_.TAX_RATE&#62;?</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Because the value of a derived property is generated in the database and depends on the execution of SQL code, derived properties may not have GORM constraints applied to them.  If constraints are specified for a derived property, they will be ignored.</div>
派生プロパティの値はデータベース上で生成されたものでSQLコードの実行に依存するため、派生プロパティにはGORMの制約を適用できません。
もし派生プロパティに対して制約が指定されても無視されます。
</blockquote>


<a name="5.5.2.12 Custom Naming Strategy"><!-- Legacy link --></a>
<h2 id="customNamingStrategy">6.5.2.12 命名規則のカスタマイズ</h2>
<div class="hidden-block">By default Grails uses Hibernate's <code>ImprovedNamingStrategy</code> to convert domain class Class and field names to SQL table and column names by converting from camel-cased Strings to ones that use underscores as word separators. You can customize these on a per-class basis in the <code>mapping</code> closure but if there's a consistent pattern you can specify a different <code>NamingStrategy</code> class to use.</div>
GrailsはデフォルトでHibernateの<code>ImprovedNamingStrategy</code>を使って、キャメルケースからアンダースコア区切りに変換することで、ドメインクラスのクラス名とフィールド名をSQLのテーブル名とカラム名に変換します。
テーブル名やカラム名は<code>mapping</code>クロージャでクラスごとにカスタマイズできますが、もし一貫した命名規則が存在するのであれば、異なる<code>NamingStrategy</code>クラスを使うように指定できます。<p class="paragraph"/><div class="hidden-block">Configure the class name to be used in <code>grails-app/conf/DataSource.groovy</code> in the <code>hibernate</code> section, e.g.</div>
<code>hibernate</code>セクションの<code>grails-app/conf/DataSource.groovy</code>で使われるクラス名を指定します。例えば:<p class="paragraph"/><div class="code"><pre>dataSource &#123;
    pooled = <span class="java&#45;keyword">true</span>
    dbCreate = <span class="java&#45;quote">"create&#45;drop"</span>
    &#8230;
&#125;<p class="paragraph"/>hibernate &#123;
    cache.use_second_level_cache = <span class="java&#45;keyword">true</span>
    &#8230;
    naming_strategy = com.myco.myproj.CustomNamingStrategy
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also specify the name of the class and it will be loaded for you:</div>
文字列としてクラス名を指定して、ロードさせることもできます:<p class="paragraph"/><div class="code"><pre>hibernate &#123;
    &#8230;
    naming_strategy = 'com.myco.myproj.CustomNamingStrategy'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">A third option is to provide an instance if there is some configuration required beyond calling the default constructor:</div>
3番目の方法として、デフォルトコンストラクタの呼出以外に必要な設定がある場合は、設定済みのインスタンス自体を指定します:<p class="paragraph"/><div class="code"><pre>hibernate &#123;
    &#8230;
    def strategy = <span class="java&#45;keyword">new</span> com.myco.myproj.CustomNamingStrategy()
    // configure as needed
    naming_strategy = strategy
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can use an existing class or write your own, for example one that prefixes table names and column names:</div>
既存のクラスを使うか、自分で書くことができます。
たとえば、テーブル名とカラム名の頭に文字列を追加するには以下のようなクラスを用意します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.myco.myproj<p class="paragraph"/><span class="java&#45;keyword">import</span> org.hibernate.cfg.ImprovedNamingStrategy
<span class="java&#45;keyword">import</span> org.hibernate.util.StringHelper<p class="paragraph"/>class CustomNamingStrategy <span class="java&#45;keyword">extends</span> ImprovedNamingStrategy &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> classToTableName(<span class="java&#45;object">String</span> className) &#123;
        <span class="java&#45;quote">"table_"</span> + StringHelper.unqualify(className)
    &#125;<p class="paragraph"/>    <span class="java&#45;object">String</span> propertyToColumnName(<span class="java&#45;object">String</span> propertyName) &#123;
        <span class="java&#45;quote">"col_"</span> + StringHelper.unqualify(propertyName)
    &#125;
&#125;</pre></div><p class="paragraph"/>

<a name="5.5.3 Default Sort Order"><!-- Legacy link --></a>
<h2 id="defaultSortOrder">6.5.3 デフォルトソート順</h2>
<div class="hidden-block">You can sort objects using query arguments such as those found in the <a href="../ref/Domain Classes/list.html" class="domainClasses">list</a> method:</div>
<a href="../ref/Domain Classes/list.html" class="domainClasses">list</a>メソッドにあるようなクエリ引数を使うと、結果オブジェクトをソートできます。<p class="paragraph"/><div class="code"><pre>def airports = Airport.list(sort:'name')</pre></div><p class="paragraph"/><div class="hidden-block">However, you can also declare the default sort order for a collection in the mapping:</div>
一方、<code>mapping</code>でコレクションに対するデフォルトソート順を宣言することもできます。<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        sort <span class="java&#45;quote">"name"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above means that all collections of <code>Airport</code> instances will by default be sorted by the airport name. If you also want to change the sort  <em class="italic">order</em> , use this syntax:</div>
上記はすべての<code>Airport</code>のコレクションがデフォルトで空港名によってソートされることを意味します。
もしソート  <em class="italic">順序</em>  を変えたいなら、次のシンタックスを使います:<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        sort name: <span class="java&#45;quote">"desc"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Finally, you can configure sorting at the association level:</div>
あと、関連レベルでのソートも設定できます:<p class="paragraph"/><div class="code"><pre>class Airport &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> hasMany = &#91;flights: Flight&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        flights sort: 'number', order: 'desc'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case, the <code>flights</code> collection will always be sorted in descending order of flight number.</div>
この場合、<code>flights</code>コレクションは常にフライト番号の降順でソートされます。<p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">
These mappings will not work for default unidirectional one-to-many or many-to-many relationships because they involve a join table. See <a href="http://jira.codehaus.org/browse/GRAILS-4089" target="blank">this issue</a> for more details. Consider using a <code>SortedSet</code> or queries with sort parameters to fetch the data you need.
</div>
これらのマッピングはデフォルトの単方向1対多/多対多関連では動作しません。結合テーブルが使われているためです。
より詳しくは、<a href="http://jira.codehaus.org/browse/GRAILS-4089" target="blank">このチケット</a>を参照してください。
それらのソートされたデータを取得するには、<code>SortedSet</code>やソートパラメータを指定したクエリを使うことを検討してください。
</blockquote>


<a name="5.6 Programmatic Transactions"><!-- Legacy link --></a>
<h2 id="programmaticTransactions">6.6 プログラマチックトランザクション</h2>
<div class="hidden-block">Grails is built on Spring and uses Spring's Transaction abstraction for dealing with programmatic transactions. However, GORM classes have been enhanced to make this simpler with the <a href="../ref/Domain Classes/withTransaction.html" class="domainClasses">withTransaction</a> method. This method has a single parameter, a Closure, which has a single parameter which is a Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/transaction/TransactionStatus.html" class="api">TransactionStatus</a> instance.</div>
GrailsはSpringをベースに構築されていて、プログラマチックトランザクションを扱うためにSpringのトランザクション抽象を使います。
と言っても、<a href="../ref/Domain Classes/withTransaction.html" class="domainClasses">withTransaction</a>メソッドを使ってシンプルに利用できるようにGORMクラスが拡張されています。
このメソッドはクロージャを1つ引数に取ります。このクロージャは<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/transaction/TransactionStatus.html" class="api">TransactionStatus</a>インスタンスを引数に取ります。<p class="paragraph"/><div class="hidden-block">Here's an example of using <code>withTransaction</code> in a controller methods:</div><p class="paragraph"/>コントローラのメソッドで<code>withTransaction</code>を利用する例を示します:<p class="paragraph"/><div class="code"><pre>def transferFunds() &#123;
    Account.withTransaction &#123; status &#45;&#62;
        def source = Account.get(params.from)
        def dest = Account.get(params.to)<p class="paragraph"/>        def amount = params.amount.toInteger()
        <span class="java&#45;keyword">if</span> (source.active) &#123;
            <span class="java&#45;keyword">if</span> (dest.active) &#123;
                source.balance &#45;= amount
                dest.amount += amount
            &#125;
            <span class="java&#45;keyword">else</span> &#123;
                status.setRollbackOnly()
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example we rollback the transaction if the destination account is not active. Also, if an unchecked <code>Exception</code> or <code>Error</code> (but not a checked <code>Exception</code>, even though Groovy doesn't require that you catch checked exceptions) is thrown during the process the transaction will automatically be rolled back.</div>
この例では、送金先口座が有効ではない場合に、トランザクションをロールバックします。
また、もし非チェック例外である<code>RuntimeException</code>や<code>Error</code>がトランザクション処理中にスローされた場合も、自動的にロールバックされます。
（Groovyはチェック例外のcatchを必須としていないため、チェック例外と非チェック例外の区別が曖昧になりがちですが）チェック例外である<code>Exception</code>の場合にはロールバックされません。<p class="paragraph"/><div class="hidden-block">You can also use "save points" to rollback a transaction to a particular point in time if you don't want to rollback the entire transaction. This can be achieved through the use of Spring's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/transaction/SavepointManager.html" class="api">SavePointManager</a> interface.</div>
また、もしトランザクション全体をロールバックしたくなければ、トランザクションを特定のポイントにロールバックする「セーブポイント」を使うこともできます。これはSpringの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/transaction/SavepointManager.html" class="api">SavePointManager</a>インタフェースを使うことで実現されています。<p class="paragraph"/><div class="hidden-block">The <code>withTransaction</code> method deals with the begin/commit/rollback logic for you within the scope of the block.</div>
<code>withTransaction</code>メソッドは、ブロックのスコープ内で開始/コミット/ロールバックを制御します。<p class="paragraph"/>

<a name="5.7 GORM and Constraints"><!-- Legacy link --></a>
<h2 id="gormConstraints">6.7 GORMと制約</h2>
<div class="hidden-block">Although constraints are covered in the <a href="../guide/single.html#constraints" class="guide">Validation</a> section, it is important to mention them here as some of the constraints can affect the way in which the database schema is generated.</div>
制約については<a href="../guide/single.html#constraints" class="guide">バリデーション</a>のセクションでカバーしていますが、いくつかの制約はデータベーススキーマの生成にも影響を与えるため、ここで言及しておくことは重要です。<p class="paragraph"/><div class="hidden-block">Where feasible, Grails uses a domain class's constraints to influence the database columns generated for the corresponding domain class properties.</div>
ドメインクラスのプロパティごとに対応するデータベースのカラムを生成するときにも、可能であれば、Grailsは制約を利用します。<p class="paragraph"/><div class="hidden-block">Consider the following example.  Suppose we have a domain model with the following properties:</div>
次のような例を考えてみます。以下のプロパティを持ったドメインクラスを仮定します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;object">String</span> name
<span class="java&#45;object">String</span> description</pre></div><p class="paragraph"/><div class="hidden-block">By default, in MySQL, Grails would define these columns as</div>
デフォルトで、MySQL上では、Grailsは次のようなカラムを定義します。<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Column</th><th>Data Type</th></tr><tr class="table-odd"><td>name</td><td>varchar(255)</td></tr><tr class="table-even"><td>description</td><td>varchar(255)</td></tr></table><p class="paragraph"/><div class="hidden-block">But perhaps the business rules for this domain class state that a description can be up to 1000 characters in length.  If that were the case, we would likely define the column as follows  <em class="italic">if</em>  we were creating the table with an SQL script.</div>
しかし、このドメインクラスに対するビジネスルールでは、<code>description</code>は1000文字まで入力したいかもしれません。
その場合、 <em class="italic">もし</em>  SQLスクリプトでテーブルを作成しているなら、たぶん次のようにカラムを定義するでしょう。<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Column</th><th>Data Type</th></tr><tr class="table-odd"><td>description</td><td>TEXT</td></tr></table><p class="paragraph"/><div class="hidden-block">Chances are we would also want to have some application-based validation to make sure we don't exceed that 1000 character limit  <em class="italic">before</em>  we persist any records.  In Grails, we achieve this validation with <a href="../guide/single.html#constraints" class="guide">constraints</a>.  We would add the following constraint declaration to the domain class.</div>
ひょっとすると、レコードに永続化する  <em class="italic">前に</em>  1000文字の上限を超えないか確認できるように、アプリケーションベースのバリデーションも欲しくなるかもしれません。
Grailsではこのバリデーションは<a href="../guide/single.html#constraints" class="guide">制約</a>で達成できます。
次のような制約の宣言をドメインクラスに追加します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> constraints = &#123;
    description maxSize: 1000
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This constraint would provide both the application-based validation we want and it would also cause the schema to be generated as shown above.  Below is a description of the other constraints that influence schema generation.</div>
この制約は、欲しかったアプリケーションベースのバリデーションを提供するだけでなく、前述したような1000文字分を格納できるスキーマも生成してくれます。
以下は、スキーマ生成に影響するその他の制約の説明です。<p class="paragraph"/><div class="hidden-block">h4. Constraints Affecting String Properties</div>
<h4>文字列型プロパティに影響する制約</h4>
<ul class="star">
<li><a href="../ref/Constraints/inList.html" class="constraints">inList</a></li>
<li><a href="../ref/Constraints/maxSize.html" class="constraints">maxSize</a></li>
<li><a href="../ref/Constraints/size.html" class="constraints">size</a></li>
</ul><p class="paragraph"/><div class="hidden-block">If either the <code>maxSize</code> or the <code>size</code> constraint is defined, Grails sets the maximum column length based on the constraint value.</div>
<code>maxSize</code>と<code>size</code>制約のどちらかが定義されると、Grailsは制約の値に従ってカラムの最大長を設定します。<p class="paragraph"/><div class="hidden-block">In general, it's not advisable to use both constraints on the same domain class property.  However, if both the <code>maxSize</code> constraint and the <code>size</code> constraint are defined, then Grails sets the column length to the minimum of the <code>maxSize</code> constraint and the upper bound of the size constraint.  (Grails uses the minimum of the two, because any length that exceeds that minimum will result in a validation error.)</div><p class="paragraph"/>一般的に、<code>maxSize</code>制約と<code>size</code>制約を同時に同じドメインクラスのプロパティに適用することは推奨されません。
しかし、もしそれらが同時に定義された場合には、Grailsは<code>maxSize</code>制約の値と<code>size</code>制約の上限値の小さい方の値をカラムの長さとしてセットします。
（Grailsがその2つの値の最小値を利用するのは、その最小値を超える長さであれば結局バリデーションエラーになるためです。）<p class="paragraph"/><div class="hidden-block">If the <code>inList</code> constraint is defined (and the <code>maxSize</code> and the <code>size</code> constraints are not defined), then Grails sets the maximum column length based on the length of the longest string in the list of valid values.  For example, given a list including values "Java", "Groovy", and "C++", Grails would set the column length to 6 (i.e., the number of characters in the string "Groovy").</div><p class="paragraph"/><code>inList</code>制約が定義された場合（<code>maxSize</code>と<code>size</code>制約は定義されていないとする）、Grailsは有効な値のリストの中でもっとも長い文字列長を元にカラムの長さをセットします。
例えば、"Java", "Groovy", "C++"を含むリストが与えられた場合、Grailsはカラムの長さを6（すなわち、"Groovy"の文字数）にセットします。<p class="paragraph"/><div class="hidden-block">h4. Constraints Affecting Numeric Properties</div>
<h4>数値型プロパティに影響する制約</h4>
<ul class="star">
<li><a href="../ref/Constraints/min.html" class="constraints">min</a></li>
<li><a href="../ref/Constraints/max.html" class="constraints">max</a></li>
<li><a href="../ref/Constraints/range.html" class="constraints">range</a></li>
</ul><p class="paragraph"/><div class="hidden-block">If the <code>max</code>, <code>min</code>, or <code>range</code> constraint is defined, Grails attempts to set the column precision based on the constraint value.  (The success of this attempted influence is largely dependent on how Hibernate interacts with the underlying DBMS.)</div>
<code>max</code>や<code>min</code>, <code>range</code>制約が定義されると、Grailsは制約の値に基づいた精度（有効桁数）をカラムにセットしようと試みます。
(その試みが成功するかどうかは、Hibernateが裏にあるDBMSとどのように相互作用するかに大きく依存します。)<p class="paragraph"/><div class="hidden-block">In general, it's not advisable to combine the pair <code>min</code>/<code>max</code> and <code>range</code> constraints together on the same domain class property.  However, if both of these constraints is defined, then Grails uses the minimum precision value from the constraints.  (Grails uses the minimum of the two, because any length that exceeds that minimum precision will result in a validation error.)</div><p class="paragraph"/>一般的に、<code>min</code>/<code>max</code>のペアと<code>range</code>制約を同時に同一のドメインクラスプロパティに適用することは推奨されません。
しかし、もしそれらが同時に定義された場合には、Grailsは制約から算出される精度の内で最も小さい精度を使います。
（Grailsがそれらの最小精度を利用するのは、その最小精度を超える場合は結局バリデーションエラーになるためです。）
<ul class="star">
<li><a href="../ref/Constraints/scale.html" class="constraints">scale</a></li>
</ul><p class="paragraph"/><div class="hidden-block">If the scale constraint is defined, then Grails attempts to set the column <a href="../ref/Constraints/scale.html" class="constraints">scale</a> based on the constraint value.  This rule only applies to floating point numbers (i.e., <code>java.lang.Float</code>, <code>java.Lang.Double</code>, <code>java.lang.BigDecimal</code>, or subclasses of <code>java.lang.BigDecimal</code>). The success of this attempted influence is largely dependent on how Hibernate interacts with the underlying DBMS.</div>
<code>scale</code>制約が定義されると、Grailsは制約の値に基づいた<a href="../ref/Constraints/scale.html" class="constraints">scale</a>をカラムにセットしようと試みます。
このルールは浮動小数点型（すなわち、<code>java.lang.Float</code>, <code>java.Lang.Double</code>, <code>java.lang.BigDecimal</code>、または、<code>java.lang.BigDecimal</code>のサブクラスのいずれか）の場合にのみ適用されます。
その試みが成功するかどうかは、Hibernateが裏にあるDBMSとどのように相互作用するかに大きく依存します。<p class="paragraph"/><div class="hidden-block">The constraints define the minimum/maximum numeric values, and Grails derives the maximum number of digits for use in the precision. Keep in mind that specifying only one of <code>min</code>/<code>max</code> constraints will not affect schema generation (since there could be large negative value of property with max:100, for example), unless the specified constraint value requires more digits than default Hibernate column precision is (19 at the moment). For example:</div>
<code>max</code>/<code>min</code>や<code>range</code>制約では、最大/最小の数値を定義します。そして、そこからGrailsは精度として利用するための最大桁数を算出します。
指定された制約値がHibernateのデフォルトカラム精度（現在は19）よりも多くの桁数を必要とする場合を除いて、<code>min</code>制約と<code>max</code>制約のどちらかひとつだけを指定しても、スキーマ生成には影響しないことを覚えておいてください。
（なぜなら、例えば<code>max:100</code>を指定したとしても、大きな負の数も許容されるため、必要な精度は確定できないからです。）<p class="paragraph"/>例えば:<p class="paragraph"/><div class="code"><pre>someFloatValue max: 1000000, scale: 3</pre></div><p class="paragraph"/><div class="hidden-block">would yield:</div>
は、次のようになります。<p class="paragraph"/><div class="code"><pre>someFloatValue DECIMAL(19, 3) // precision is <span class="java&#45;keyword">default</span></pre></div><p class="paragraph"/><div class="hidden-block">but</div>
しかし、<p class="paragraph"/><div class="code"><pre>someFloatValue max: 12345678901234567890, scale: 5</pre></div><p class="paragraph"/><div class="hidden-block">would yield:</div>
は、次のようになります。<p class="paragraph"/><div class="code"><pre>someFloatValue DECIMAL(25, 5) // precision = digits in max + scale</pre></div><p class="paragraph"/><div class="hidden-block">and</div>
そして、<p class="paragraph"/><div class="code"><pre>someFloatValue max: 100, min: &#45;100000</pre></div><p class="paragraph"/><div class="hidden-block">would yield:</div>
は、次のようになります。<p class="paragraph"/><div class="code"><pre>someFloatValue DECIMAL(8, 2) // precision = digits in min + <span class="java&#45;keyword">default</span> scale</pre></div>


<a name="7. The Web Layer"><!-- Legacy link --></a>
<h1 id="theWebLayer">7 Webレイヤ</h1>


<a name="7.1 Controllers"><!-- Legacy link --></a>
<h2 id="controllers">7.1 コントローラ</h2>
<div class="hidden-block">A controller handles requests and creates or prepares the response. A controller can generate the response directly or delegate to a view. To create a controller, simply create a class whose name ends with <code>Controller</code> in the <code>grails-app/controllers</code> directory (in a subdirectory if it's in a package).</div>
コントローラはリクエストを処理してレスポンスの準備・作成を行います。コントローラはレスポンスをビューに委譲したり、直接返す事ができます。単純に<code>grails-app/controlers</code>ディレクトリに、クラス名称の最後を<code>Controller</code>にしたクラスを作成することで、コントローラを追加できます。(パッケージに入れる場合は、パッケージ名のサブディレクトリに作成します。)<p class="paragraph"/><div class="hidden-block">The default <a href="../guide/single.html#urlmappings" class="guide">URL Mapping</a> configuration ensures that the first part of your controller name is mapped to a URI and each action defined within your controller maps to URIs within the controller name URI.</div>
<a href="../guide/single.html#urlmappings" class="guide">URL マッピング</a>のデフォルト設定では、Controllerの前に付けた名称がベースのURIにマップされ、コントローラに定義したそれぞれのアクション名称がコントローラ名称と繫がれてURIをマップします。


<a name="7.1.1 Understanding Controllers and Actions"><!-- Legacy link --></a>
<h2 id="understandingControllersAndActions">7.1.1 コントローラとアクションの理解</h2>
<h4>コントローラを作成する</h4><p class="paragraph"/><div class="hidden-block">Controllers can be created with the <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a> or <a href="../ref/Command Line/generate-controller.html" class="commandLine">generate-controller</a> command. For example try running the following command from the root of a Grails project:</div>
<a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a>または<a href="../ref/Command Line/generate-controller.html" class="commandLine">generate-controller</a>コマンドでコントローラが作成できます。Grailsプロジェクトのルートで以下のようにコマンドを実行します。<p class="paragraph"/><div class="code"><pre>grails create&#45;controller book</pre></div><p class="paragraph"/><div class="hidden-block">The command will create a controller at the location <code>grails-app/controllers/myapp/BookController.groovy</code>:</div>
コマンドを実行すると<code>grails-app/controllers/myapp/BookController.groovy</code>にコントローラを生成します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> myapp<p class="paragraph"/>class BookController &#123;<p class="paragraph"/>    def index() &#123; &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">where "myapp" will be the name of your application, the default package name if one isn't specified.</div>
パッケージ名を指定しない場合は、"myapp"というアプリケーション名であれば、自動的にデフォルトパッケージとして生成されます。<p class="paragraph"/><div class="hidden-block"><code>BookController</code> by default maps to the /book URI (relative to your application root).</div>
デフォルトでは、<code>BookController</code>は、URIが /bookとなります。(アプリケーションのコンテキストルートからの相対パス)<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
The <code>create-controller</code> and <code>generate-controller</code> commands are just for convenience and you can just as easily create controllers using your favorite text editor or IDE
<code>create-controller</code>と<code>generate-controller</code>コマンドは、簡単にコントローラを生成する便利なコマンドですが、IDEやテキストエディタの機能でクラスを作成してもかまいません。
</blockquote></div>
<blockquote class="note">
<code>create-controller</code>と<code>generate-controller</code>コマンドは、簡単にコントローラを生成する便利なコマンドですが、IDEやテキストエディタの機能でクラスを作成してもかまいません。
</blockquote><p class="paragraph"/><h4>アクションの作成</h4><p class="paragraph"/><div class="hidden-block">A controller can have multiple public action methods; each one maps to a URI:</div>
コントローラは複数のアクションメソッドを持つことができます。それぞれURIにマップされます:<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    def list() &#123;<p class="paragraph"/>        // <span class="java&#45;keyword">do</span> controller logic
        // create model<p class="paragraph"/>        <span class="java&#45;keyword">return</span> model
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This example maps to the <code>/book/list</code> URI by default thanks to the property being named <code>list</code>.</div>
この例では、アクションメソッド名が<code>list</code>なので、URIは<code>/book/list</code>にマップされます。<p class="paragraph"/><h4>パブリックメソッドをアクションとする</h4><p class="paragraph"/><div class="hidden-block">In earlier versions of Grails actions were implemented with Closures. This is still supported, but the preferred approach is to use methods.</div>
以前のバージョンまでは、アクションがクロージャで実装されてました。この方式はまだサポートされています。ただし今後のアクションの実装はメソッドを使用することを推奨します。<p class="paragraph"/><div class="hidden-block">Leveraging methods instead of Closure properties has some advantages:</div>
クロージャではなく、メソッドにすることによって以下の利点があります:
<div class="hidden-block">
<ul class="star">
<li>Memory efficient</li>
<li>Allow use of stateless controllers (<code>singleton</code> scope)</li>
<li>You can override actions from subclasses and call the overridden superclass method with <code>super.actionName()</code></li>
<li>Methods can be intercepted with standard proxying mechanisms, something that is complicated to do with Closures since they're fields.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>メモリ効率</li>
<li>ステートレスコントローラの使用 (<code>シングルトンスコープ</code>指定)</li>
<li>サブクラスでのアクションのオーバーライドが可能。スーパークラスのアクションメソッド呼び出しが可能。<code>super.actionName()</code></li>
<li>クロージャはフィールドのため複雑だった、スタンダードなプロキシを使用したメソッドのインターセプトが可能。</li>
</ul><p class="paragraph"/><div class="hidden-block">If you prefer the Closure syntax or have older controller classes created in earlier versions of Grails and still want the advantages of using methods, you can set the <code>grails.compile.artefacts.closures.convert</code> property to true in <code>BuildConfig.groovy</code>:</div>
クロージャを使用したい場合や、旧バージョンで作られたコントローラを使用しながら、メソッドの利点も欲しい場合は、<code>BuildConfig.groovy</code>に、 <code>grails.compile.artefacts.closures.convert</code>を定義します:
<div class="code"><pre>grails.compile.artefacts.closures.convert = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">and a compile-time AST transformation will convert your Closures to methods in the generated bytecode.</div>
この定義をすることで、AST変換を使用してクロージャをメソッドに変換したバイトコードを生成します。<p class="paragraph"/><blockquote class="note">
If a controller class extends some other class which is not defined under the <code>grails-app/controllers/</code> directory, methods inherited from that class are not converted to controller actions.  If the intent is to expose those inherited methods as controller actions the methods may be overridden in the subclass and the subclass method may invoke the method in the super class.
</blockquote><p class="paragraph"/><h4>デフォルトアクション</h4><p class="paragraph"/><div class="hidden-block">A controller has the concept of a default URI that maps to the root URI of the controller, for example <code>/book</code> for <code>BookController</code>. The action that is called when the default URI is requested is dictated by the following rules:</div>
コントローラのルートURIににデフォルトURIをマップする概念をもっています。例として<code>BookController</code>の場合は <code>/book</code>になります。デフォルトURIが呼ばれたときに呼ばれるアクションは以下のルールになっています:
<div class="hidden-block">
<ul class="star">
<li>If there is only one action, it's the default</li>
<li>If you have an action named <code>index</code>, it's the default</li>
<li>Alternatively you can set it explicitly with the <code>defaultAction</code> property:</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>アクションが１つの場合は、それがデフォルトになります。</li>
<li><code>index</code>という名称のアクションがある場合は、それがデフォルトになります。</li>
<li><code>defaultAction</code>を定義して指定できます。</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> defaultAction = <span class="java&#45;quote">"list"</span></pre></div>


<a name="7.1.2 Controllers and Scopes"><!-- Legacy link --></a>
<h2 id="controllersAndScopes">7.1.2 コントローラとスコープ</h2>
<h4>使用可能なスコープ</h4><p class="paragraph"/><div class="hidden-block">Scopes are hash-like objects where you can store variables. The following scopes are available to controllers:</div>
スコープは、変数を収納可能なハッシュのようなオブジェクトです。コントローラでは、次のスコープが使用可能です。
<div class="hidden-block">
<ul class="star">
<li><a href="../ref/Controllers/servletContext.html" class="controllers">servletContext</a> - Also known as application scope, this scope lets you share state across the entire web application. The servletContext is an instance of <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">ServletContext</a></li>
<li><a href="../ref/Controllers/session.html" class="controllers">session</a> - The session allows associating state with a given user and typically uses cookies to associate a session with a client. The session object is an instance of <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a></li>
<li><a href="../ref/Controllers/request.html" class="controllers">request</a> - The request object allows the storage of objects for the current request only. The request object is an instance of <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a></li>
<li><a href="../ref/Controllers/params.html" class="controllers">params</a> - Mutable map of incoming request query string or POST parameters</li>
<li><a href="../ref/Controllers/flash.html" class="controllers">flash</a> - See below</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="../ref/Controllers/servletContext.html" class="controllers">servletContext</a> - webアプリケーションの全体にわたってスコープを共有するアプリケーションスコープです。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">ServletContext</a>のインスタンスです。</li>
<li><a href="../ref/Controllers/session.html" class="controllers">session</a> - セッションは、通常クッキーを使用してリクエストを行ったクライアントとの連携をして、ステートを保持します。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a>のインスタンスです。</li>
<li><a href="../ref/Controllers/request.html" class="controllers">request</a> - リクエストオブジェクトはリクエスト時のみオブジェクトを保持するオブジェクトです。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>のインスタンスです。</li>
<li><a href="../ref/Controllers/params.html" class="controllers">params</a> - 受け取ったリクエストクエリー文字列または、POSTパラメータを保持するミュータブルマップです。</li>
<li><a href="../ref/Controllers/flash.html" class="controllers">flash</a> - 以下を参照</li>
</ul><p class="paragraph"/><h4>スコープへのアクセス</h4><p class="paragraph"/><div class="hidden-block">Scopes can be accessed using the variable names above in combination with Groovy's array index operator, even on classes provided by the Servlet API such as the <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>:</div>
以下のようにスコープはGroovyの配列インデクスオペレータで、変数の名称を指定して参照することができます。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>にあるような、Servlet APIの提供する変数に関しても同じようにアクセスできます<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def find() &#123;
        def findBy = params&#91;<span class="java&#45;quote">"findBy"</span>&#93;
        def appContext = request&#91;<span class="java&#45;quote">"foo"</span>&#93;
        def loggedUser = session&#91;<span class="java&#45;quote">"logged_user"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also access values within scopes using the de-reference operator, making the syntax even more clear:</div>
フィールド参照オペレータを使用してスコープの変数を参照すれば、シンタックスもっと簡潔にすることもできます:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def find() &#123;
        def findBy = params.findBy
        def appContext = request.foo
        def loggedUser = session.logged_user
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is one of the ways that Grails unifies access to the different scopes.</div>
これはGrailsでの、様々なスコープにアクセスする一例です。<p class="paragraph"/><h4>フラッシュスコープを使用する</h4><p class="paragraph"/><div class="hidden-block">Grails supports the concept of <a href="../ref/Controllers/flash.html" class="controllers">flash</a> scope as a temporary store to make attributes available for this request and the next request only. Afterwards the attributes are cleared. This is useful for setting a message directly before redirecting, for example:</div>
Grailsは、今回のリクエストと次のリクエストのみで値を一時的に保持する <a href="../ref/Controllers/flash.html" class="controllers">flash</a>スコープをサポートしています。保持された内容は自動的に削除されます。リダイレクト等を行う前にメッセージを残す時などに使用できます。以下が例です。<p class="paragraph"/><div class="code"><pre>def delete() &#123;
    def b = Book.get(params.id)
    <span class="java&#45;keyword">if</span> (!b) &#123;
        flash.message = <span class="java&#45;quote">"User not found <span class="java&#45;keyword">for</span> id $&#123;params.id&#125;"</span>
        redirect(action:list)
    &#125;
    &#8230; // remaining code
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">When the <code>list</code> action is requested, the <code>message</code> value will be in scope and can be used to display an information message. It will be removed from the <code>flash</code> scope after this second request.</div>
この例では、<code>delete</code>アクションに対してリクエストをすると、リダイレクトされて<code>list</code>アクションが実行された際に、flashスコープの<code>message</code>に代入した内容がメッセージ表示等に使用可能になります。このリダイレクトされた<code>list</code>アクション(<code>delete</code>の次のアクション)の処理が終了したら、<code>flash</code>スコープの内容が削除されます。<p class="paragraph"/><div class="hidden-block">Note that the attribute name can be anything you want, and the values are often strings used to display messages, but can be any object type.</div>
メッセージ表示などで文字列型が頻繁に使用されますが、flashスコープに一時的に保持する値は、どのようなオブジェクトでもかまいません。<p class="paragraph"/><h4>コントローラのスコープ設定</h4><p class="paragraph"/><div class="hidden-block">By default, a new controller instance is created for each request. In fact, because the controller is <code>prototype</code> scoped, it is thread-safe since each request happens on its own thread.</div>
デフォルトでは、コントローラはリクエスト毎にインスタンスが生成されます。コントローラのスコープは<code>prototype</code>になっているため、リクエストがそれぞれのスレッドを持っているので、スレッドセーフになります。<p class="paragraph"/><div class="hidden-block">You can change this behaviour by placing a controller in a particular scope. The supported scopes are:</div>
コントローラにスコープを指定することで振る舞いを変更できます。サポートされているスコープは:
<div class="hidden-block">
<ul class="star">
<li><code>prototype</code> (default) - A new controller will be created for each request (recommended for actions as Closure properties)</li>
<li><code>session</code> - One controller is created for the scope of a user session</li>
<li><code>singleton</code> - Only one instance of the controller ever exists (recommended for actions as methods)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>prototype</code> (デフォルト) - リクエスト毎にコントローラが生成されます。(クロージャでアクションを推奨)</li>
<li><code>session</code> - ユーザのセッションを通して1個のコントローラが生成されます。</li>
<li><code>singleton</code> -  1個のコントローラのみが存在する状態です。(メソッドでのアクションをお勧めします)</li>
</ul><p class="paragraph"/><div class="hidden-block">To enable one of the scopes, add a static <code>scope</code> property to your class with one of the valid scope values listed above, for example</div>
スコープを定義するには、コントローラクラスに、static scope 変数で指定したいスコープを定義します。以下が例になります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> scope = <span class="java&#45;quote">"singleton"</span></pre></div><p class="paragraph"/><div class="hidden-block">You can define the default strategy under in <code>Config.groovy</code> with the <code>grails.controllers.defaultScope</code> key, for example:</div>
デフォルトスコープは、<code>Config.groovy</code>に<code>grails.controllers.defaultScope</code>を指定する事で変更できます。<p class="paragraph"/><div class="code"><pre>grails.controllers.defaultScope = <span class="java&#45;quote">"singleton"</span></pre></div>
<div class="hidden-block">
<blockquote class="note">
Use scoped controllers wisely. For instance, we don't recommend having any properties in a singleton-scoped controller since they will be shared for  <em class="italic">all</em>  requests. Setting a default scope other than <code>prototype</code> may also lead to unexpected behaviors if you have controllers provided by installed plugins that expect that the scope is <code>prototype</code>.
</blockquote>
</div>
<blockquote class="note">
コントローラのスコープは使用状況を考えてお使いください。例えば、シングルトンのコントローラは、_全ての_リクエストで共有されるためプロパティを持つべきではありません。デフォルトで定義されているスコープの<code>prototype</code> を変更することで、プラグインなどで提供されたコントローラが<code>protopype</code>を前提で実装されている場合があるので注意しましょう
</blockquote>


<a name="7.1.3 Models and Views"><!-- Legacy link --></a>
<h2 id="modelsAndViews">7.1.3 モデルとビュー</h2>
<h4>モデルを返す</h4><p class="paragraph"/><div class="hidden-block">A model is a Map that the view uses when rendering. The keys within that Map correspond to variable names accessible by the view. There are a couple of ways to return a model. First, you can explicitly return a Map instance:</div>
モデルはビューを描写する際に使用するMapインスタンスです。ビュー内でMapのキーに一致する変数名が使用できます。モデルを返すには、数種類の方法があります。先ずはじめにMapインスタンスを明示的に返す方法です。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    &#91;book: Book.get(params.id)&#93;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">The above does  <em class="italic">not</em>  reflect what you should use with the scaffolding views - see the <a href="../guide/single.html#scaffolding" class="guide">scaffolding section</a> for more details.</div>
上記の例はスカッフォルドのビューで使用する例ではありません。スカッフォルドに関しては、スカッフォルドのセクションを参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">If no explicit model is returned the controller's properties will be used as the model, thus allowing you to write code like this:</div>
以下の例のように、明示的にモデルを返さない場合は、コントローラのプロパティがモデルとして使用されます。<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    List books
    List authors<p class="paragraph"/>    def list() &#123;
        books = Book.list()
        authors = Author.list()
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">This is possible due to the fact that controllers are prototype scoped. In other words a new controller is created for each request. Otherwise code such as the above would not be thread-safe, and all users would share the same data.</div>
これはコントローラのスコープがprototype(リクエスト毎にコントローラが生成される)の場合に可能な方法です。他の場合はスレッドセーフではありません。
</blockquote><p class="paragraph"/><div class="hidden-block">In the above example the <code>books</code> and <code>authors</code> properties will be available in the view.</div>
上記の例では、 プロパティの<code>book</code>と<code>authors</code>がビューで参照できます。<p class="paragraph"/><div class="hidden-block">A more advanced approach is to return an instance of the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a> class:</div>
上級者向けのアプローチとしては、Springの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a>インスタンスを返す方法があります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.web.servlet.ModelAndView<p class="paragraph"/>def index() &#123;
    // get some books just <span class="java&#45;keyword">for</span> the index page, perhaps your favorites
    def favoriteBooks = ...<p class="paragraph"/>    // forward to the list view to show them
    <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">new</span> ModelAndView(<span class="java&#45;quote">"/book/list"</span>, &#91; bookList : favoriteBooks &#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">One thing to bear in mind is that certain variable names can not be used in your model:</div>
一つ覚えておいて欲しいのが、一定の変数名が、モデル使用できないという事です。
<ul class="star">
<li><code>attributes</code></li>
<li><code>application</code></li>
</ul><p class="paragraph"/><div class="hidden-block">Currently, no error will be reported if you do use them, but this will hopefully change in a future version of Grails.</div>
現状では使用したとしてもエラーが出ることはありませんが、将来的には変わるかもしれません。<p class="paragraph"/><h4>ビューの選択<div class="hidden-block">Selecting the View </div></h4><p class="paragraph"/><div class="hidden-block">In both of the previous two examples there was no code that specified which <a href="../guide/single.html#gsp" class="guide">view</a> to render. So how does Grails know which one to pick? The answer lies in the conventions. Grails will look for a view at the location <code>grails-app/views/book/show.gsp</code> for this <code>show</code> action:</div>
これまでの例ではビューがどのように設定されるのかを説明しませんでたが、Grailsではどのようにビューを選択しているのでしょうか？答えは慣習にあります。何も指定しなければ、以下のアクションでは、Grailsが自動的に、<code>grails-app/views/book/show.gsp</code>をビューとして使用します。<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def show() &#123;
         &#91;book: Book.get(params.id)&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">To render a different view, use the <a href="../ref/Controllers/render.html" class="controllers">render</a> method:</div>
別のビューを描写する場合は、<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドで指定します。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    def map = &#91;book: Book.get(params.id)&#93;
    render(view: <span class="java&#45;quote">"display"</span>, model: map)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case Grails will attempt to render a view at the location <code>grails-app/views/book/display.gsp</code>. Notice that Grails automatically qualifies the view location with the <code>book</code> directory of the <code>grails-app/views</code> directory. This is convenient, but to access shared views you need instead you can use an absolute path instead of a relative one:</div>
上記の例では、<code>grails-app/views/book/display.gsp</code>の描写を試みます。注目する場所はGrailsは自動的にコントローラが<code>book</code>であれば、<code>grails-app/views</code>ディレクトリの<code>book</code>ディレクトリを、指定しなくても取得する所です。これは便利なのですが、ビューを共有する場合は、パスを指定する必要があります。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    def map = &#91;book: Book.get(params.id)&#93;
    render(view: <span class="java&#45;quote">"/shared/display"</span>, model: map)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case Grails will attempt to render a view at the location <code>grails-app/views/shared/display.gsp</code>.</div>
上記の例では、<code>grails-app/views/shared/display.gsp</code>の描写を試みます。<p class="paragraph"/><div class="hidden-block">Grails also supports JSPs as views, so if a GSP isn't found in the expected location but a JSP is, it will be used instead.</div>
Grailsでは、ビューにJSPもサポートしています。これによって、参照したパスにGSPが存在しない場合は、JSPが代わりに使用されます。<p class="paragraph"/><h4>レスポンスの描写</h4><p class="paragraph"/><div class="hidden-block">Sometimes it's easier (for example with Ajax applications) to render snippets of text or code to the response directly from the controller. For this, the highly flexible <code>render</code> method can be used:</div>
直接文字列をコントローラからレスポンス(例としてAjaxアプリケーションなど)したい場合、とてもフレキシブルな<code>render</code>メソッドを使うと簡単にできます。<p class="paragraph"/><div class="code"><pre>render <span class="java&#45;quote">"Hello World!"</span></pre></div><p class="paragraph"/><div class="hidden-block">The above code writes the text "Hello World!" to the response. Other examples include:</div>
上記の例ではレスポンスに"Hello World!"を返します。他の例として:<p class="paragraph"/><div class="hidden-block">
// write some markup
// render a specific view
// render a template for each item in a collection
// render some text with encoding and content type
</div><p class="paragraph"/><div class="code"><pre>// マークアップを返す
render &#123;
   <span class="java&#45;keyword">for</span> (b in books) &#123;
      div(id: b.id, b.title)
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// 指定したビューを描写
render(view: 'show')</pre></div><p class="paragraph"/><div class="code"><pre>// コレクションの中身をそれぞれ指定したテンプレートを適応して描写
render(template: 'book_template', collection: Book.list())</pre></div><p class="paragraph"/><div class="code"><pre>// 文字列を指定したエンコーディングとコンテントタイプで描写
render(text: <span class="java&#45;quote">"&#60;xml&#62;some xml&#60;/xml&#62;"</span>, contentType: <span class="java&#45;quote">"text/xml"</span>, encoding: <span class="java&#45;quote">"UTF&#45;8"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">If you plan on using Groovy's <code>MarkupBuilder</code> to generate HTML for use with the <code>render</code> method be careful of naming clashes between HTML elements and Grails tags, for example:</div>
<code>render</code>メソッドでGroovyの<code>MarkupBuilder</code>を使用してHTMLを生成する場合は、HTMLエレメント名とGrailsタグとの名称衝突を気をつけましょう。(Grailsのタグはアクション内部でメソッドとして使用できるため)<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> groovy.xml.MarkupBuilder
&#8230;
def login() &#123;
    def writer = <span class="java&#45;keyword">new</span> StringWriter()
    def builder = <span class="java&#45;keyword">new</span> MarkupBuilder(writer)
    builder.html &#123;
        head &#123;
            title 'Log in'
        &#125;
        body &#123;
            h1 'Hello'
            form &#123;
            &#125;
        &#125;
    &#125;<p class="paragraph"/>    def html = writer.toString()
    render html
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will actually <a href="../guide/single.html#tagsAsMethodCalls" class="guide">call the form tag</a> (which will return some text that will be ignored by the <code>MarkupBuilder</code>). To correctly output a <code>&#60;form&#62;</code> element, use the following:</div>
上記の例ではformの場所にform<a href="../guide/single.html#tagsAsMethodCalls" class="guide">タグが呼ばれて</a>しまいます。これを回避して<code>&#60;form&#62;</code>タグを正常に生成するには、以下のように<code>builder.form</code>とします。<p class="paragraph"/><div class="code"><pre>def login() &#123;
    // &#8230;
    body &#123;
        h1 'Hello'
        builder.form &#123;
        &#125;
    &#125;
    // &#8230;
&#125;</pre></div>


<a name="7.1.4 Redirects and Chaining"><!-- Legacy link --></a>
<h2 id="redirectsAndChaining">7.1.4 リダイレクトとチェイン</h2>
<h4>リダイレクト<div class="hidden-block">Redirects</div></h4><p class="paragraph"/><div class="hidden-block">Actions can be redirected using the <a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> controller method:</div>
コントローラのメソッド、<a href="../ref/Controllers/redirect.html" class="controllers">redirect</a>を使用して、アクションをリダイレクトすることができます:<p class="paragraph"/><div class="code"><pre>class OverviewController &#123;<p class="paragraph"/>    def login() &#123;&#125;<p class="paragraph"/>    def find() &#123;
        <span class="java&#45;keyword">if</span> (!session.user)
            redirect(action: 'login')
            <span class="java&#45;keyword">return</span>
        &#125;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Internally the <a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> method uses the <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a> object's <code>sendRedirect</code> method.</div>
<a href="../ref/Controllers/redirect.html" class="controllers">redirect</a>メソッドは内部的に<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a>オブジェクトの<code>sendRedirect</code>メソッドを使用しています。<p class="paragraph"/><div class="hidden-block">The <code>redirect</code> method expects one of:</div>
<code>redirect</code>メソッドでは以下のいずれかのように使用します:<p class="paragraph"/><div class="hidden-block">* Another closure within the same controller class:</div>
*同じコントローラ内のアクションクロージャ(プロパティで)の指定:<p class="paragraph"/><div class="code"><pre>// Call the login action within the same class
redirect(action: login)</pre></div><p class="paragraph"/><div class="hidden-block">* The name of an action (and controller name if the redirect isn't to an action in the current controller):</div>
<ul class="star">
<li>アクション名称でのしていと、別のコントローラのアクションの場合はコントローラの指定:</li>
</ul><p class="paragraph"/><div class="code"><pre>// Also redirects to the index action in the home controller
redirect(controller: 'home', action: 'index')</pre></div><p class="paragraph"/><div class="hidden-block">*  A URI for a resource relative the application context path:</div>
<ul class="star">
<li>アプリケーションコンテキストパス内のリソースのURI:</li>
</ul><p class="paragraph"/><div class="code"><pre>// Redirect to an explicit URI
redirect(uri: <span class="java&#45;quote">"/login.html"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">* Or a full URL:</div>
<ul class="star">
<li>URLを全指定:</li>
</ul><p class="paragraph"/><div class="code"><pre>// Redirect to a URL
redirect(url: <span class="java&#45;quote">"http://grails.org"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">Parameters can optionally be passed from one action to the next using the <code>params</code> argument of the method:</div>
メソッドのparams引数をにパラメータを指定することで、アクションへのパラメータを渡せます:<p class="paragraph"/><div class="code"><pre>redirect(action: 'myaction', params: &#91;myparam: <span class="java&#45;quote">"myvalue"</span>&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">These parameters are made available through the <a href="../ref/Controllers/params.html" class="controllers">params</a> dynamic property that accesses request parameters. If a parameter is specified with the same name as a request parameter, the request parameter is overridden and the controller parameter is used.</div>
これらのパラメータは、アクセス時のリクエストパラメータの<a href="../ref/Controllers/params.html" class="controllers">params</a>プロパティから参照できるようになります。もしリクエストと同じパラメータを指定した場合は、パラメータは上書きされます。<p class="paragraph"/><div class="hidden-block">Since the <code>params</code> object is a Map, you can use it to pass the current request parameters from one action to the next:</div>
<code>params</code>オブジェクトはMapなので、以下のように、そのまま全てのリクエストパラメータを次のアクションに渡すことができます:<p class="paragraph"/><div class="code"><pre>redirect(action: <span class="java&#45;quote">"next"</span>, params: params)</pre></div><p class="paragraph"/><div class="hidden-block">Finally, you can also include a fragment in the target URI:</div>
ターゲットURIに、フラグメントを含めることもできます:<p class="paragraph"/><div class="code"><pre>redirect(controller: <span class="java&#45;quote">"test"</span>, action: <span class="java&#45;quote">"show"</span>, fragment: <span class="java&#45;quote">"profile"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">which will (depending on the URL mappings) redirect to something like "/myapp/test/show#profile".</div>
この例では(URLマッピング定義によりますが)、リダイレクトは"/myapp/test/show#profile"になります。<p class="paragraph"/><h4>チェイニング <div class="hidden-block">Chaining </div></h4><p class="paragraph"/><div class="hidden-block">Actions can also be chained. Chaining allows the model to be retained from one action to the next. For example calling the <code>first</code> action in this action:</div>
アクションのチェインが可能です。チェインではアクションからアクションへのモデル参照が可能です。以下の例でアクション<code>first</code>を呼び出します:<p class="paragraph"/><div class="code"><pre>class ExampleChainController &#123;<p class="paragraph"/>    def first() &#123;
        chain(action: second, model: &#91;one: 1&#93;)
    &#125;<p class="paragraph"/>    def second () &#123;
        chain(action: third, model: &#91;two: 2&#93;)
    &#125;<p class="paragraph"/>    def third() &#123;
        &#91;three: 3&#93;)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">results in the model:</div>
結果モデルは以下のようになります:<p class="paragraph"/><div class="code"><pre>&#91;one: 1, two: 2, three: 3&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The model can be accessed in subsequent controller actions in the chain using the <code>chainModel</code> map. This dynamic property only exists in actions following the call to the <code>chain</code> method:</div>
途中でコントローラアクションからモデルにアクセスするには、chainModelマップを使用します。この動的プロパティはchainメソッドから呼ばれた時のみに存在します。<p class="paragraph"/><div class="code"><pre>class ChainController &#123;<p class="paragraph"/>    def nextInChain() &#123;
        def model = chainModel.myModel
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Like the <code>redirect</code> method you can also pass parameters to the <code>chain</code> method:</div>
<code>redirect</code>メソッドと同じように、<code>chain</code>メソッドにパラメータを渡すこともできます:<p class="paragraph"/><div class="code"><pre>chain(action: <span class="java&#45;quote">"action1"</span>, model: &#91;one: 1&#93;, params: &#91;myparam: <span class="java&#45;quote">"param1"</span>&#93;)</pre></div>


<a name="7.1.5 Controller Interceptors"><!-- Legacy link --></a>
<h2 id="interceptors">7.1.5 コントローラ・インターセプター</h2>
<div class="hidden-block">Often it is useful to intercept processing based on either request, session or application state. This can be achieved with action interceptors. There are currently two types of interceptors: before and after.</div>
リクエスト、セッションまたはアプリケーションで処理のインターセプトができると、たいへん役に立ちます。これはアクションインターセプターで達成できます。現在2種類のインターセプターbeforeとafterがあります。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If your interceptor is likely to apply to more than one controller, you are almost certainly better off writing a <a href="../guide/single.html#filters" class="guide">Filter</a>. Filters can be applied to multiple controllers or URIs without the need to change the logic of each controller </div>
複数のコントローラにインターセプターを反映させたい場合は、<a href="../guide/single.html#filters" class="guide">Filter</a>を使用することをお勧めします。Filterは多数のコントローラまたはURIに、ロジックを追加すること無く反映できます。
</blockquote><p class="paragraph"/><h4>ビフォア・インターセプション<div class="hidden-block">Before Interception </div></h4><p class="paragraph"/><div class="hidden-block">The <code>beforeInterceptor</code> intercepts processing before the action is executed. If it returns <code>false</code> then the intercepted action will not be executed. The interceptor can be defined for all actions in a controller as follows:</div>
<code>beforeInterceptor</code>は、アクションが実行される前に処理の追加を行うことができます。<code>beforeInterceptor</code>で、<code>false</code>を返すとアクションは実行されません。コントローラ内の全てのアクションにインターセプターを定義するには以下のようにします。<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#123;
    println <span class="java&#45;quote">"Tracing action $&#123;actionUri&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above is declared inside the body of the controller definition.  It will be executed before all actions and does not interfere with processing. A common use case is very simplistic authentication:</div>
上記はコントローラ内部に設定します。全てのアクションの前に実行され処理を干渉することはありません。
他によくある実装例としては簡単な認証などです:<p class="paragraph"/>
<div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, except: 'login'&#93;<p class="paragraph"/>// defined with <span class="java&#45;keyword">private</span> scope, so it's not considered an action
<span class="java&#45;keyword">private</span> auth() &#123;
    <span class="java&#45;keyword">if</span> (!session.user) &#123;
        redirect(action: 'login')
        <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
    &#125;
&#125;<p class="paragraph"/>def login() &#123;
    // display login page
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above code defines a method called <code>auth</code>. A private method is used so that it is not exposed as an action to the outside world. The <code>beforeInterceptor</code> then defines an interceptor that is used on all actions  <em class="italic">except</em>  the login action and it executes the <code>auth</code> method. The <code>auth</code> method is referenced using Groovy's method pointer syntax. Within the method it detects whether there is a user in the session, and if not it redirects to the <code>login</code> action and returns <code>false</code>, causing the intercepted action to not be processed.</div>
上記の例では先ず、<code>auth</code>メソッドを定義します。外部にアクションとして認識されないように<code>private</code>メソッドにします。
今回は、アクション名が<code>login</code>以外の全てのアクションで実行されるように、実行するメソッドをaction:に指定し、除外するアクション'login'を except:に指定して、<code>beforeInterceptor</code>を定義します。<code>auth</code>メソッドはGroovyのメソッドポインターシンタックスで指定します。これで、<code>auth</code>の処理によって、sessionにuser変数が見つからなかった場合は'login'アクションへリダイレクトして<code>false</code>を返しアクションを実行しないインターセプターが行えます。<p class="paragraph"/>
<h4>アフター・インターセプション <div class="hidden-block">After Interception </div></h4><p class="paragraph"/><div class="hidden-block">Use the <code>afterInterceptor</code> property to define an interceptor that is executed after an action:</div>
<code>afterInterceptor</code>は、アクションが実行される後に処理の追加を行うことができます:<p class="paragraph"/><div class="code"><pre>def afterInterceptor = &#123; model &#45;&#62;
    println <span class="java&#45;quote">"Tracing action $&#123;actionUri&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The after interceptor takes the resulting model as an argument and can hence manipulate the model or response.</div>
アフター・インターセプターでは、処理結果のモデルを引数として取得して、モデルやレスポンスを操作することができます。<p class="paragraph"/><div class="hidden-block">An after interceptor may also modify the Spring MVC <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a> object prior to rendering. In this case, the above example becomes:</div>
描写直前のSpring MVCの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a>も取得して変更することも可能です。以下のケースでは、前の例に追記すると:<p class="paragraph"/><div class="code"><pre>def afterInterceptor = &#123; model, modelAndView &#45;&#62;
    println <span class="java&#45;quote">"Current view is $&#123;modelAndView.viewName&#125;"</span>
    <span class="java&#45;keyword">if</span> (model.someVar) modelAndView.viewName = <span class="java&#45;quote">"/mycontroller/someotherview"</span>
    println <span class="java&#45;quote">"View is now $&#123;modelAndView.viewName&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This allows the view to be changed based on the model returned by the current action. Note that the <code>modelAndView</code> may be <code>null</code> if the action being intercepted called <code>redirect</code> or <code>render</code>.</div>
この例では返されたモデルの内容を元にビューを変更しています。インターセプトされた、アクションが<code>redirect</code>や<code>render</code>を呼び出している場合は、<code>modelANdView</code>は<code>null</code>になります。<p class="paragraph"/><h4>インターセプションの条件指定 <div class="hidden-block">Interception Conditions </div></h4><p class="paragraph"/><div class="hidden-block">Rails users will be familiar with the authentication example and how the 'except' condition was used when executing the interceptor (interceptors are called 'filters' in Rails; this terminology conflicts with Servlet filter terminology in Java):</div>
'excepr'条件は、Railsユーザにとってインターセプターを使う時はお馴染みだと思います。(Railsではインターセプターはフィルターと呼ばれています。Javaでは用語的にサーブレットフィルターと衝突するのでインターセプターとしています)<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, except: 'login'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">This executes the interceptor for all actions except the specified action. A list of actions can also be defined as follows:</div>
上記の例では、exceptで指定したアクション以外でインターセプターを実行します。次のように、複数指定する場合はリストで指定します:<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, except: &#91;'login', 'register'&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The other supported condition is 'only', this executes the interceptor for only the specified action(s):</div>
指定したアクションのみでインターセプターを実行する場合は、'only'を使用します:<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, only: &#91;'secure'&#93;&#93;</pre></div>


<a name="7.1.6 Data Binding"><!-- Legacy link --></a>
<h2 id="dataBinding">7.1.6 データバインディング</h2>
<div class="hidden-block">Data binding is the act of "binding" incoming request parameters onto the properties of an object or an entire graph of objects. Data binding should deal with all necessary type conversion since request parameters, which are typically delivered by a form submission, are always strings whilst the properties of a Groovy or Java object may well not be.</div>
データバインディングとは、受信したリクエストパラメータを、オブジェクトのプロパティやオブジェクト構造へ結合させる機能です。データバインディングでは、フォームから送信された文字列のリクエストパラメータを必要な型へに変換します。<p class="paragraph"/><div class="hidden-block">h4. Map Based Binding</div>
<h4>マップを用いたバインディング</h4><p class="paragraph"/><div class="hidden-block">The data binder is capable of converting and assigning values in a Map to properties of an object.  The binder will associate entries in the Map to properties of the object using the keys in the Map that have values which correspond to property names on the object.  The following code demonstrates the basics:</div>
データバインダは、マップの値を変換してオブジェクトのプロパティに代入します。
バインダは、オブジェクトのプロパティ名に一致するマップのキーを使って、マップのエントリをオブジェクトのプロパティに結びつけます。
以下のコードはその基本形を示します:<p class="paragraph"/><div class="code"><pre>// grails&#45;app/domain/Person.groovy
class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">Integer</span> age
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;firstName: 'Peter', lastName: 'Gabriel', age: 63&#93;<p class="paragraph"/>def person = <span class="java&#45;keyword">new</span> Person(bindingMap)<p class="paragraph"/>assert person.firstName == 'Peter'
assert person.lastNaem == 'Gabriel'
assert person.age == 63</pre></div><p class="paragraph"/><div class="hidden-block">To update properties of a domain object you may assign a Map to the <code>properties</code> property of the domain class:</div>
ドメインオブジェクトのプロパティを更新するために、そのドメインクラスの<code>properties</code>プロパティにマップを代入できます。<p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;firstName: 'Peter', lastName: 'Gabriel', age: 63&#93;<p class="paragraph"/>def person = Person.get(someId)
person.properties = bindingMap<p class="paragraph"/>assert person.firstName == 'Peter'
assert person.lastNaem == 'Gabriel'
assert person.age == 63</pre></div><p class="paragraph"/><div class="hidden-block">The binder can populate a full graph of objects using Maps of Maps.</div>
バインダはオブジェクトの完全なデータ構造をマップのマップを使って表現できます。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">Integer</span> age
    Address homeAddress
&#125;<p class="paragraph"/>class Address &#123;
    <span class="java&#45;object">String</span> county
    <span class="java&#45;object">String</span> country
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;firstName: 'Peter', lastName: 'Gabriel', age: 63, homeAddress: &#91;county: 'Surrey', country: 'England'&#93; &#93;<p class="paragraph"/>def person = <span class="java&#45;keyword">new</span> Person(bindingMap)<p class="paragraph"/>assert person.firstName == 'Peter'
assert person.lastNaem == 'Gabriel'
assert person.age == 63
assert person.homeAddress.county == 'Surrey'
assert person.homeAddress.country == 'England'</pre></div><p class="paragraph"/><div class="hidden-block">h4. Binding To Collections And Maps</div>
<h4>コレクションとマップへのバインディング</h4><p class="paragraph"/><div class="hidden-block">The data binder can populate and update Collections and Maps.  The following code shows a simple example of populating a <code>List</code> of objects in a domain class:</div>
データバインダは、コレクションとマップへの格納と更新ができます。
以下のコードはドメインクラス上の<code>List</code>への格納の単純な例を示します。<p class="paragraph"/><div class="code"><pre>class Band &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> hasMany = &#91;albums: Album&#93;
    List albums
&#125;<p class="paragraph"/>class Album &#123;
    <span class="java&#45;object">String</span> title
    <span class="java&#45;object">Integer</span> numberOfTracks
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;name: 'Genesis',
                  'albums&#91;0&#93;': &#91;title: 'Foxtrot', numberOfTracks: 6&#93;,
                  'albums&#91;1&#93;': &#91;title: 'Nursery Cryme', numberOfTracks: 7&#93;&#93;<p class="paragraph"/>def band = <span class="java&#45;keyword">new</span> Band(bindingMap)<p class="paragraph"/>assert band.name == 'Genesis'
assert band.albums.size() == 2
assert band.albums&#91;0&#93;.title == 'Foxtrot'
assert band.albums&#91;0&#93;.numberOfTracks == 6
assert band.albums&#91;1&#93;.title == 'Nursery Cryme'
assert band.albums&#91;1&#93;.numberOfTracks == 7</pre></div><p class="paragraph"/><div class="hidden-block">That code would work in the same way if <code>albums</code> were an array instead of a <code>List</code>.</div>
このコードは<code>albums</code>が<code>List</code>の代わりに配列だったとしても同様に動作します。<p class="paragraph"/><div class="hidden-block">Note that when binding to a <code>Set</code> the structure of the <code>Map</code> being bound to the <code>Set</code> is the same as that of a <code>Map</code> being bound to a <code>List</code> but since a <code>Set</code> is unordered, the indexes don't necessarily correspond to the order of elements in the <code>Set</code>.  In the code example above, if <code>albums</code> were a <code>Set</code> instead of a <code>List</code>, the <code>bindingMap</code> could look exactly the same but 'Foxtrot' might be the first album in the <code>Set</code> or it might be the second.  When updating existing elements in a <code>Set</code> the <code>Map</code> being assigned to the <code>Set</code> must have <code>id</code> elements in it which represent the element in the <code>Set</code> being updated, as in the following example:</div>
<code>Set</code>へとバインディングするとき、<code>Set</code>にバインドされた<code>Map</code>の構造は<code>List</code>にバインドされた<code>Map</code>と同じですが、<code>Set</code>は順序を保持しないため、添字は必ずしも<code>Set</code>内の要素の順序と一致しないことに注意してください。
上記のサンプルコードで<code>albums</code>が<code>List</code>の代わりに<code>Set</code>だったとしたら、<code>bindingMap</code>は一見まったく同じに見えるかもしれませんが、「Foxtrot」は<code>Set</code>内の最初のアルバムかもしれませんし、2番目であるかもしれません。
以下の例のように、<code>Set</code>内の既存の要素を更新するとき、<code>Set</code>に代入する<code>Map</code>は更新されようとしている<code>Set</code>内の要素を表す<code>id</code>要素を持っていなければなりません:<p class="paragraph"/><div class="code"><pre>/&#42;
 &#42; The value of the indexes 0 and 1 in albums&#91;0&#93; and albums&#91;1&#93; are arbitrary
 &#42; values that can be anything as <span class="java&#45;object">long</span> as they are unique within the Map.
 &#42; They <span class="java&#45;keyword">do</span> not correspond to the order of elements in albums because albums
 &#42; is a Set.
 &#42;/
def bindingMap = &#91;'albums&#91;0&#93;': &#91;id: 9, title: 'The Lamb Lies Down On Broadway'&#93;
                  'albums&#91;1&#93;': &#91;id: 4, title: 'Selling England By The Pound'&#93;&#93;<p class="paragraph"/>def band = Band.get(someBandId)<p class="paragraph"/>/&#42;
 &#42; This will find the Album in albums that has an id of 9 and will set its title
 &#42; to 'The Lamb Lies Down On Broadway' and will find the Album in albums that has
 &#42; an id of 4 and set its title to 'Selling England By The Pound'.  In both
 &#42; cases <span class="java&#45;keyword">if</span> the Album cannot be found in albums then the album will be retrieved
 &#42; from the database by id, the Album will be added to albums and will be updated
 &#42; with the values described above.  If a Album with the specified id cannot be
 &#42; found in the database, then a binding error will be created and associated
 &#42; with the band object.  More on binding errors later.
 &#42;/
band.properties = bindingMap</pre></div><p class="paragraph"/><div class="hidden-block">When binding to a <code>Map</code> the structure of the binding <code>Map</code> is the same as the structore of a <code>Map</code> used for binding to a <code>List</code> or a <code>Set</code> and the index inside of square brackets corresponds to the key in the <code>Map</code> being bound to.  See the following code:</div>
<code>Map</code>へとバインディングするとき、バインド元の<code>Map</code>の構造は<code>List</code>や<code>Set</code>へのバインディングに使われる<code>Map</code>と同じです。
角括弧内の添字はバインド先の<code>Map</code>内のキーとなります。
以下のコードを見てください:<p class="paragraph"/><div class="code"><pre>class Album &#123;
    <span class="java&#45;object">String</span> title
    <span class="java&#45;keyword">static</span> hasMany = &#91;players: Player&#93;
    Map players
&#125;<p class="paragraph"/>class Player &#123;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;title: 'The Lamb Lies Down On Broadway',
                  'players&#91;guitar&#93;': &#91;name: 'Steve Hacket'&#93;,
                  'players&#91;vocals&#93;': &#91;name: 'Peter Gabriel'&#93;
                  'players&#91;keyboards&#93;': &#91;name: 'Tony Banks'&#93;&#93;<p class="paragraph"/>def album = <span class="java&#45;keyword">new</span> Album(bindingMap)<p class="paragraph"/>assert album.title == 'The Lamb Lies Down On Broadway'
assert album.players.size() == 3
assert album.players.guitar == 'Steve Hacket'
assert album.players.vocals == 'Peter Gabriel'
assert album.players.keyboards == 'Tony Banks'</pre></div><p class="paragraph"/><div class="hidden-block">When updating an exisiting <code>Map</code>, if the key specified in the binding <code>Map</code> does not exist in the <code>Map</code> being bound to then a new value will be created and added to the <code>Map</code> with the specified key as in the following example:</div>
以下の例のように、既存の<code>Map</code>を更新するときに、バインド元の<code>Map</code>内で指定されたキーがバインド先の<code>Map</code>内に存在しない場合、新しい値が生成されて指定されたキーでバインド先の<code>Map</code>に追加されます:<p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;title: 'The Lamb Lies Down On Broadway',
                  'players&#91;guitar&#93;': &#91;name: 'Steve Hacket'&#93;,
                  'players&#91;vocals&#93;': &#91;name: 'Peter Gabriel'&#93;
                  'players&#91;keyboards&#93;': &#91;name: 'Tony Banks'&#93;&#93;<p class="paragraph"/>def album = <span class="java&#45;keyword">new</span> Album(bindingMap)<p class="paragraph"/>assert album.title == 'The Lamb Lies Down On Broadway'
assert album.players.size() == 3
assert album.players.guitar == 'Steve Hacket'
assert album.players.vocals == 'Peter Gabriel'
assert album.players.keyboards == 'Tony Banks'<p class="paragraph"/>def updatedBindingMap = &#91;'players&#91;drums&#93;': &#91;name: 'Phil Collins'&#93;,
                         'players&#91;keyboards&#93;': &#91;name: 'Anthony George Banks'&#93;&#93;<p class="paragraph"/>album.properties = updatedBindingMap<p class="paragraph"/>assert album.title == 'The Lamb Lies Down On Broadway'
assert album.players.size() == 4
assert album.players.guitar == 'Steve Hacket'
assert album.players.vocals == 'Peter Gabriel'
assert album.players.keyboards == 'Anthony George Banks'
assert album.players.drums == 'Phil Collins'</pre></div><p class="paragraph"/><div class="hidden-block">h4. Binding Request Data to the Model</div>
<h4>モデルにリクエストデータをバインドする</h4><p class="paragraph"/><div class="hidden-block">The <a href="../ref/Controllers/params.html" class="controllers">params</a> object that is available in a controller has special behavior that helps convert dotted request parameter names into nested Maps that the data binder can work with.  For example, if a request includes request parameters named <code>person.homeAddress.country</code> and <code>person.homeAddress.city</code> with values 'USA' and 'St. Louis' respectively, <code>params</code> would include entries like these:</div>
コントローラで利用できる<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトには、ドット区切りのリクエストパラメータ名をネストされたMapに変換する
という特別なサポートがあります。
たとえば、値がそれぞれ「USA」と「St. Louis」であるような<code>person.homeAddress.country</code>と<code>person.homeAddress.city</code>という名前のリクエストパラメータを持っているリクエストの場合、<code>params</code>のエントリは以下のようになります:<p class="paragraph"/><div class="code"><pre>&#91;person: &#91;homeAddress: &#91;country: 'USA', city: 'St. Louis'&#93;&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">There are two ways to bind request parameters onto the properties of a domain class. The first involves using a domain classes' Map constructor:</div>
リクエストパラメータをドメインクラスのプロパティへバインドするには、2通りの方法があります。1つめはドメインクラスのマップを指定するコンストラクタを使用します。<p class="paragraph"/><div class="code"><pre>def save() &#123;
    def b = <span class="java&#45;keyword">new</span> Book(params)
    b.save()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The data binding happens within the code <code>new Book(params)</code>. By passing the <a href="../ref/Controllers/params.html" class="controllers">params</a> object to the domain class constructor Grails automatically recognizes that you are trying to bind from request parameters. So if we had an incoming request like:</div>
この例では、<code>new Book(params)</code>の部分でデータバインディングが実行されます。<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトをドメインクラスのコンストラクタに渡すことで、Grailsが自動にリクエストパラメータを認識してバインドします。例えば、以下のようなリクエストを受信したとします。<p class="paragraph"/><div class="code"><pre>/book/save?title=The%20Stand&#38;author=Stephen%20King</pre></div><p class="paragraph"/><div class="hidden-block">Then the <code>title</code> and <code>author</code> request parameters would automatically be set on the domain class. You can use the <a href="../ref/Domain Classes/properties.html" class="domainClasses">properties</a> property to perform data binding onto an existing instance:</div>
リクエストパラメータの<code>title</code>と<code>author</code>が、自動的にドメインクラスへセットされます。もう1つの方法として、既存のドメインクラスインスタンスへデータバインディングするために、<a href="../ref/Domain Classes/properties.html" class="domainClasses">properties</a>プロパティを利用することができます。<p class="paragraph"/><div class="code"><pre>def save() &#123;
    def b = Book.get(params.id)
    b.properties = params
    b.save()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This has the same effect as using the implicit constructor.</div>
これは先ほどのコンストラクタを利用したのと同じ結果になります。<p class="paragraph"/><div class="hidden-block">When binding an empty String (a String with no characters in it, not even spaces) to a constrained property which has been configured as nullable, the data binder will convert the empty String to null.  This simplifies the most common case where the intent is to treat an empty form field as having the value null since there isn't a way to actually submit a null as a request parameter.  When this behavior is not desireable the application may assign the value directly.</div>
空文字(スペースすら含まない文字数0のString)をnullable制約を付与されたプロパティにバインディングするとき、データバインダはその空文字をnullに変換します。
これによって、リクエストパラメータとしてnullをサブミットする方法が実際には存在しないため空文字として送信せざるを得ないが、フォームの空フィールドについて値がnullであるとみなしたい、というよくあるケースを簡単に扱えるようになります。
この振る舞いが望ましくないときは、アプリケーションは値を直接代入することもできます。<p class="paragraph"/><div class="hidden-block">The mass property binding mechanism will by default automatically trim all Strings at binding time.  To disable this behavior set the <code>grails.databinding.trimStrings</code> property to false in <code>grails-app/conf/Config.groovy</code>.</div>
大量プロパティバインディング機構は、デフォルトでバインディング時にすべての文字列を自動的にトリムします。
この挙動を無効化するには、<code>grails-app/conf/Config.groovy</code>の<code>grails.databinding.trimStrings</code> プロパティにfalseをセットしてください。<p class="paragraph"/><div class="code"><pre>// the <span class="java&#45;keyword">default</span> value is <span class="java&#45;keyword">true</span>
grails.databinding.trimStrings = <span class="java&#45;keyword">false</span><p class="paragraph"/>// ...</pre></div><p class="paragraph"/><div class="hidden-block">The mass property binding mechanism will by default automatically convert all empty Strings to null at binding time.  To disable this behavior set the <code>grails.databinding.convertEmptyStringsToNull</code> property to false in <code>grials-app/conf/Config.groovy</code>.</div>
大量プロパティバインディング機構は、デフォルトでバインディング時にすべての空文字を自動的にnullに変換します。
この挙動を無効化するには、<code>grails-app/conf/Config.groovy</code>の<code>grails.databinding.convertEmptyStringsToNull</code> プロパティにfalseをセットしてください。<p class="paragraph"/><div class="code"><pre>// the <span class="java&#45;keyword">default</span> value is <span class="java&#45;keyword">true</span>
grails.databinding.convertEmptyStringsToNull = <span class="java&#45;keyword">false</span><p class="paragraph"/>// ...</pre></div><p class="paragraph"/><div class="hidden-block">The order of events is that the String trimming happens and then null conversion happens so if <code>trimStrings</code> is <code>true</code> and <code>convertEmptyStringsToNull</code> is <code>true</code>, not only will empty Strings be converted to null but also blank Strings.  A blank String is any String such that the <code>trim()</code> method returns an empty String.</div>
<code>trimStrings</code>が<code>true</code>で<code>convertEmptyStringsToNull</code>が<code>true</code>のとき、イベントの順番としては、文字列がトリムされた後にnull変換が実行されます。つまり、空文字がnullに変換されるだけでなく、空白文字列もnullに変換されることになります。
ここで、空白文字列とは<code>trim()</code>メソッドが空文字を返す文字列のことです。<p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">These forms of data binding in Grails are very convenient, but also indiscriminate. In other words, they will bind  <em class="italic">all</em>  non-transient, typed instance properties of the target object, including ones that you may not want bound. Just because the form in your UI doesn't submit all the properties, an attacker can still send malign data via a raw HTTP request. Fortunately, Grails also makes it easy to protect against such attacks - see the section titled "Data Binding and Security concerns" for more information.</div>
Grailsでのこのようなデータバインディングは大変便利ですが、同時に無差別的でもあります。
言い換えると、バインドしたくないものまで含めて、対象オブジェクトの「すべて」の非transientな型付けされたインスタンスプロパティをバインドしてしまいます。
単にUI上のフォームがすべてのプロパティをサブミットするわけではないだけであって、今もなお攻撃者は生のHTTPリクエストを使って悪意あるデータを送信することができます。
幸い、Grailsではそのような攻撃に対して防御するのも簡単です。
詳しくは、「データバインディングとセキュリティ考慮」のセクションを参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Data binding and Single-ended Associations </div>
<h4>単一終端関連のデータバインディング</h4><p class="paragraph"/><div class="hidden-block">If you have a <code>one-to-one</code> or <code>many-to-one</code> association you can use Grails' data binding capability to update these relationships too. For example if you have an incoming request such as:</div>
1対1や多対1関連の場合も、Grailsデータバインディングの機能で更新可能です。例として次のようなリクエストを受信したとします:<p class="paragraph"/><div class="code"><pre>/book/save?author.id=20</pre></div><p class="paragraph"/><div class="hidden-block">Grails will automatically detect the <code>.id</code> suffix on the request parameter and look up the <code>Author</code> instance for the given id when doing data binding such as:</div>
同じ方法で、Grailsがリクエストパラメータの<code>.id</code>接尾辞を自動認識して、与えられたidで該当する<code>Author</code>インスタンスを検索してデータバインディングを行います<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(params)</pre></div><p class="paragraph"/><div class="hidden-block">An association property can be set to <code>null</code> by passing the literal <code>String</code> "null". For example:</div>
次のように、関連のプロパティに文字列で"null"と指定することで<code>null</code>をセットすることができます<p class="paragraph"/><div class="code"><pre>/book/save?author.id=<span class="java&#45;keyword">null</span></pre></div><p class="paragraph"/><div class="hidden-block">h4. Data Binding and Many-ended Associations </div>
<h4>複数終端関連のデータバインディング</h4><p class="paragraph"/><div class="hidden-block">If you have a one-to-many or many-to-many association there are different techniques for data binding depending of the association type.</div>
1対多や多対多関連の場合、それぞれの関連タイプによって違ったデータバインディング方法があります。<p class="paragraph"/><div class="hidden-block">If you have a <code>Set</code> based association (the default for a <code>hasMany</code>) then the simplest way to populate an association is to send a list of identifiers. For example consider the usage of <code>&#60;g:select&#62;</code> below:</div>
<code>Set</code>ベースの関連(<code>hasMany</code>でのデフォルト)で、簡単に関連を設定するには、idのリストを送る方法が有ります。以下の例は<code>&#60;g:select&#62;</code>を使用した方法です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books"</span>
          from=<span class="xml&#45;quote">"$&#123;Book.list()&#125;"</span>
          size=<span class="xml&#45;quote">"5"</span> multiple=<span class="xml&#45;quote">"yes"</span> optionKey=<span class="xml&#45;quote">"id"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This produces a select box that lets you select multiple values. In this case if you submit the form Grails will automatically use the identifiers from the select box to populate the <code>books</code> association.</div>
このタグでは複数選択のセレクトボックスが生成されます。この例でフォームを送信すると、Grailsが自動的にセレクトボックスで選択されたidを使用して、<code>books</code>の関連を設定します。<p class="paragraph"/><div class="hidden-block">However, if you have a scenario where you want to update the properties of the associated objects the this technique won't work. Instead you use the subscript operator:</div>
ただしこの方法は、関連オブジェクトのプロパティを更新する場合は使用できません。代わりに添字演算子を使用します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;0&#93;.title"</span> value=<span class="xml&#45;quote">"the Stand"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;1&#93;.title"</span> value=<span class="xml&#45;quote">"the Shining"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">However, with <code>Set</code> based association it is critical that you render the mark-up in the same order that you plan to do the update in. This is because a <code>Set</code> has no concept of order, so although we're referring to <code>books0</code> and <code>books1</code> it is not guaranteed that the order of the association will be correct on the server side unless you apply some explicit sorting yourself.</div>
ただし、<code>Set</code>ベースの関連では、マークアップ(HTML)が描写された順序とは同じ順序で更新されない危険性あります。 これは<code>Set</code>には順序という概念がなく、<code>books&#91;0&#93;</code>や<code>books&#91;1&#93;</code>と指定したとしても、サーバサイドでの関連のソートを明快に指定しない限り、順序が保証されないことになるからです。<p class="paragraph"/><div class="hidden-block">This is not a problem if you use <code>List</code> based associations, since a <code>List</code> has a defined order and an index you can refer to. This is also true of <code>Map</code> based associations.</div>
<code>List</code>ベースの関連の場合は、<code>List</code>の順序とインデックスを指定することができるので問題ありません。<code>Map</code>ベースの関連も同じことがいえます。<p class="paragraph"/><div class="hidden-block">Note also that if the association you are binding to has a size of two and you refer to an element that is outside the size of association:</div>
さらに注意するポイントとして、バインドする関連が2個の物に、それより多い数の場合は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;0&#93;.title"</span> value=<span class="xml&#45;quote">"the Stand"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;1&#93;.title"</span> value=<span class="xml&#45;quote">"the Shining"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;2&#93;.title"</span> value=<span class="xml&#45;quote">"Red Madder"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then Grails will automatically create a new instance for you at the defined position. If you "skipped" a few elements in the middle:</div>
Grailsが新たにインスタンスを指定したポジションに生成します。途中のいくつかのエレメントを飛ばした数値を指定した場合は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;0&#93;.title"</span> value=<span class="xml&#45;quote">"the Stand"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;1&#93;.title"</span> value=<span class="xml&#45;quote">"the Shining"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;5&#93;.title"</span> value=<span class="xml&#45;quote">"Red Madder"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then Grails will automatically create instances in between. For example in the above case Grails will create 4 additional instances if the association being bound had a size of 2.</div>
Grailsが間のインスタンスも自動的に生成します。上記のケースでは関連が2個の場合は、4個のインスタンスが追加されます。<p class="paragraph"/><div class="hidden-block">You can bind existing instances of the associated type to a <code>List</code> using the same <code>.id</code> syntax as you would use with a single-ended association. For example:</div>
既存のインスタンスを<code>List</code>関連でバインドするには、単一終端関連と同じように<code>.id</code>シンタックスを使用します。例として:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;0&#93;.id"</span> from=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;0&#93;?.id&#125;"</span> /&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;1&#93;.id"</span> from=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;1&#93;?.id&#125;"</span> /&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;2&#93;.id"</span> from=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;2&#93;?.id&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Would allow individual entries in the <code>books List</code> to be selected separately.</div>
この例では、別々に選択して、<code>books List</code>の特定の場所にエントリを可能にします。<p class="paragraph"/><div class="hidden-block">Entries at particular indexes can be removed in the same way too. For example:</div>
同じ方法で、個々のインデックスからエントリの削除も可能です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;0&#93;.id"</span>
          from=<span class="xml&#45;quote">"$&#123;Book.list()&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;0&#93;?.id&#125;"</span>
          noSelection=<span class="xml&#45;quote">"&#91;'null': ''&#93;"</span>/&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Will render a select box that will remove the association at <code>books0</code> if the empty option is chosen.</div>
上記の例では、空のオプションを選択することで、<code>book&#91;0&#93;</code>の関連を削除します。<p class="paragraph"/><div class="hidden-block">Binding to a <code>Map</code> property works the same way except that the list index in the parameter name is replaced by the map key:</div>
リストのインデックス数値をパラメータ名称にすることで、マップのキーとして認識されるので、<code>Map</code>のプロパティも同じ方法で動作します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"images&#91;cover&#93;.id"</span>
          from=<span class="xml&#45;quote">"$&#123;Image.list()&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;book?.images&#91;cover&#93;?.id&#125;"</span>
          noSelection=<span class="xml&#45;quote">"&#91;'null': ''&#93;"</span>/&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This would bind the selected image into the <code>Map</code> property <code>images</code> under a key of <code>"cover"</code>.</div>
この例では、Mapプロパティimagesのキー"cover"に対してバインドされます。<p class="paragraph"/><div class="hidden-block">When binding to Maps, Arrays and Collections the data binder will automatically grow the size of the collections as necessary.  The default limit to how large the binder will grow a collection is 256.  If the data binder encounters an entry that requires the collection be grown beyond that limit, the entry is ignored.  The limit may be configured by assigning a value to the <code>grails.databinding.autoGrowCollectionLimit</code> property in <code>Config.groovy</code>.</div>
Map・配列・コレクションにバインディングするとき、データバインダは必要に応じて自動的にコレクションのサイズを大きくします。
バインダがコレクションを大きくするときのデフォルトの上限は256です。
もしデータバインダが上限を超えてコレクションを大きくする必要のある要素に出会った場合、その要素は無視されます。
上限は<code>Config.groovy</code>の<code>grails.databinding.autoGrowCollectionLimit</code>プロパティに値を代入すれば変更できます。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/Config.groovy<p class="paragraph"/>// the <span class="java&#45;keyword">default</span> value is 256
grails.databinding.autoGrowCollectionLimit = 128<p class="paragraph"/>// ...</pre></div><p class="paragraph"/><div class="hidden-block">h4. Data binding with Multiple domain classes </div>
<h4>複数ドメインクラスでのデータバインディング</h4><p class="paragraph"/><div class="hidden-block">It is possible to bind data to multiple domain objects from the <a href="../ref/Controllers/params.html" class="controllers">params</a> object.</div>
<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトから、複数のドメインオブジェクトへのデータのバインドが可能です。<p class="paragraph"/><div class="hidden-block">For example so you have an incoming request to:</div>
例として以下のようなリクエストがあったとします:<p class="paragraph"/><div class="code"><pre>/book/save?book.title=The%20Stand&#38;author.name=Stephen%20King</pre></div><p class="paragraph"/><div class="hidden-block">You'll notice the difference with the above request is that each parameter has a prefix such as <code>author.</code> or <code>book.</code> which is used to isolate which parameters belong to which type. Grails' <code>params</code> object is like a multi-dimensional hash and you can index into it to isolate only a subset of the parameters to bind.</div>
上記のリクエストでは、それぞれのパラメータに<code>author.</code>また<code>book.</code>という接頭辞が付いていて、どちらの型(ドメインクラス)に属するかを区別しています。Grailsの<code>params</code>オブジェクトは多次元ハッシュのようになっており、それぞれバインドするためのパラメータサブセットとして区別されて索引されます。<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(params.book)</pre></div><p class="paragraph"/><div class="hidden-block">Notice how we use the prefix before the first dot of the <code>book.title</code> parameter to isolate only parameters below this level to bind. We could do the same with an <code>Author</code> domain class:</div>
上記のように接頭辞bookをparams指定することで、ドメインクラスBookに対して、<code>book.title</code>パラメータだけが区別されてバインドされます。ドメインクラス<code>Author</code>も同じように指定します。<p class="paragraph"/><div class="code"><pre>def a = <span class="java&#45;keyword">new</span> Author(params.author)</pre></div><p class="paragraph"/><div class="hidden-block">h4. Data Binding and Action Arguments </div>
<h4>データバインディングとアクション引数</h4><p class="paragraph"/><div class="hidden-block">Controller action arguments are subject to request parameter data binding.  There are 2 categories of controller action arguments.  The first category is command objects.  Complex types are treated as command objects.  See the <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> section of the user guide for details.  The other category is basic object types.  Supported types are the 8 primitives, their corresponding type wrappers and <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/String.html" class="api">java.lang.String</a>.  The default behavior is to map request parameters to action arguments by name:</div>
コントローラのアクション引数はリクエストパラメータのデータバインディング対象です。
コントローラのアクション引数は大きく2つに分類されます。
1つめはコマンドオブジェクトです。
複合型はコマンドオブジェクトとして扱われます。
詳しくはこのユーザガイドの<a href="../guide/single.html#commandObjects" class="guide">コマンドオブジェクト</a>のセクションを参照してください。
もう一つは基本オブジェクト型です。
サポートしている方は8つのプリミティブ型とそれに対応するラッパー型と<a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/String.html" class="api">java.lang.String</a>です。
デフォルトの挙動では、リクエストパラメータとアクション引数は名前に基づいて関連づけられます。<p class="paragraph"/><div class="code"><pre>class AccountingController &#123;<p class="paragraph"/>   // accountNumber will be initialized with the value of params.accountNumber
   // accountType will be initialized with params.accountType
   def displayInvoice(<span class="java&#45;object">String</span> accountNumber, <span class="java&#45;object">int</span> accountType) &#123;
       // &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">For primitive arguments and arguments which are instances of any of the primitive type wrapper classes a type conversion has to be carried out before the request parameter value can be bound to the action argument.  The type conversion happens automatically.  In a case like the example shown above, the <code>params.accountType</code> request parameter has to be converted to an <code>int</code>.  If type conversion fails for any reason, the argument will have its default value per normal Java behavior (null for type wrapper references, false for booleans and zero for numbers) and a corresponding error will be added to the <code>errors</code> property of the defining controller.</div>
プリミティブ型の引数とプリミティブ型のラッパークラスのインスタンスの引数に対しては、リクエストパラメータの値がアクション引数にバインドされる前に、型変換を実行する必要があります。
この型変換は自動的に行われます。
先に示した例のようなケースでは、<code>params.accountType</code>リクエストパラメータは<code>int</code>型に変換する必要があります。
もし型変換が何らかの理由により失敗した場合は、引数はJava標準的な挙動によるデフォルト値(ラッパー型はnull、boolean型はfalse、数値型は0)をとります。
そして、対応するエラーが対象コントローラの<code>errors</code>プロパティに追加されます。<p class="paragraph"/><div class="code"><pre>/accounting/displayInvoice?accountNumber=B59786&#38;accountType=bogusValue</pre></div><p class="paragraph"/><div class="hidden-block"></div>Since "bogusValue" cannot be converted to type int, the value of accountType will be zero, the controller's <code>errors.hasErrors()</code> will be true, the controller's <code>errors.errorCount</code> will be equal to 1 and the controller's <code>errors.getFieldError('accountType')</code> will contain the corresponding error.
"bogusValue"はint型に変換できないため、<code>accountType</code>は0になります。そして、コントローラの<code>errors.hasErrors()</code>はtrueに、<code>errors.errorCount</code>は1になり、<code>errors.getFieldError('accountType')</code>には対応するエラーが保持されます。<p class="paragraph"/><div class="hidden-block">If the argument name does not match the name of the request parameter then the <code>&#64;grails.web.RequestParameter</code> annotation may be applied to an argument to express the name of the request parameter which should be bound to that argument:</div>
引数名がリクエストパラメータの名前と一致しない場合、その引数にバインドすべきリクエストパラメータの名前を指定するために、<code>&#64;grails.web.RequestParameter</code>アノテーションを引数に付与することができます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.web.RequestParameter<p class="paragraph"/>class AccountingController &#123;<p class="paragraph"/>   // mainAccountNumber will be initialized with the value of params.accountNumber
   // accountType will be initialized with params.accountType
   def displayInvoice(@RequestParameter('accountNumber') <span class="java&#45;object">String</span> mainAccountNumber, <span class="java&#45;object">int</span> accountType) &#123;
       // &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Data binding and type conversion errors </div>
<h4>型変換エラーとデータバインディング</h4><p class="paragraph"/><div class="hidden-block">Sometimes when performing data binding it is not possible to convert a particular String into a particular target type. This results in a type conversion error. Grails will retain type conversion errors inside the <a href="../ref/Domain Classes/errors.html" class="domainClasses">errors</a> property of a Grails domain class. For example:</div>
時折データバインディングの際に、特有の文字列を特有の型に変換できない場合があります。この場合の結果は型変換エラーとなります。Grailsではドメインインスタンスの<a href="../ref/Domain Classes/errors.html" class="domainClasses">errors</a>プロパティで型変換エラーを保持します。例えば:<p class="paragraph"/>
<div class="code"><pre>class Book &#123;
    &#8230;
    URL publisherURL
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we have a domain class <code>Book</code> that uses the <code>java.net.URL</code> class to represent URLs. Given an incoming request such as:</div>
ドメインクラス<code>Book</code>でURLを表すプロパティに<code>java.net.URL</code>クラスを使用したとします。次のようなリクエストを受信したとします:<p class="paragraph"/><div class="code"><pre>/book/save?publisherURL=a&#45;bad&#45;url</pre></div><p class="paragraph"/><div class="hidden-block">it is not possible to bind the string <code>a-bad-url</code> to the <code>publisherURL</code> property as a type mismatch error occurs. You can check for these like this:</div>
型違いエラーが起きるため、文字列<code>a-bad-url</code>を<code>publisherURL</code>にバインドすることはできません。次のようにしてエラーを確認します:<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(params)<p class="paragraph"/><span class="java&#45;keyword">if</span> (b.hasErrors()) &#123;
    println <span class="java&#45;quote">"The value $&#123;b.errors.getFieldError('publisherURL').rejectedValue&#125;"</span> +
            <span class="java&#45;quote">" is not a valid URL!"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Although we have not yet covered error codes (for more information see the section on <a href="../guide/single.html#validation" class="guide">Validation</a>), for type conversion errors you would want a message from the <code>grails-app/i18n/messages.properties</code> file to use for the error. You can use a generic error message handler such as:</div>
この章までは、まだエラーコードの説明していませんが(詳しくは<a href="../guide/single.html#validation" class="guide">Validation</a>を参照)、型変換エラーでは<code>grails-app/i18n/messages.properties</code>を使用してメッセージを返す事もあると思います。次のような一般的なメッセージハンドラーを使用することもできます<p class="paragraph"/><div class="code"><pre>typeMismatch.java.net.URL=The field &#123;0&#125; is not a valid URL</pre></div><p class="paragraph"/><div class="hidden-block">Or a more specific one:</div>
また、さらに対象を特定する場合は:<p class="paragraph"/><div class="code"><pre>typeMismatch.Book.publisherURL=The publisher URL you specified is not a valid URL</pre></div><p class="paragraph"/><div class="hidden-block">h4. The BindUsing Annotation</div>
<h4>BindUsingアノテーション</h4><p class="paragraph"/><div class="hidden-block">The <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a> annotation may be used to define a custom binding mechanism for a particular field in a class.  Any time data binding is being applied to the field the closure value of the annotation will be invoked with 2 arguments.  The first argument is the object that data binding is being applied to and the second argument is a <code>Map</code> which is the data source for the data binding.  The value returned from the closure will be bound to the property.  The following example would result in the upper case version of the <code>name</code> value in the source being applied to the <code>name</code> field during data binding.</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a>アノテーションはクラスの特定のフィールドに独自のバインディング方法を定義するために使います。
データバインディングがそのフィールドに適用されるときは毎回アノテーションに指定されたクロージャが2つの引数で実行されます。
最初の引数はデータバインディングを適用しようとしているオブジェクトで、2番目の引数はデータバインディングのためのデータソースとなる<code>Map</code>です。
クロージャが返す値はオブジェクトのプロパティにバインドされます。
以下の例では、データバーディングによってデータソースの<code>name</code>の値が大文字に変換されたものが<code>name</code>フィールドに設定されます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindUsing<p class="paragraph"/>class SomeClass &#123;
    @BindUsing(&#123;
        obj, source &#45;&#62; source&#91;'name'&#93;?.toUpperCase()
    &#125;)
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a> annotation may be used to define a custom binding mechanism for all of the fields on a particular class. When the annotation is applied to a class, the value assigned to the annotation should be a class which implements the <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingHelper.html" class="api">BindingHelper</a> interface.  An instance of that class will be used any time a value is bound to a property in the class that this annotation has been applied to.</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a>アノテーションは特定のクラス上のすべてのフィールドに対する独自のバインディング方法を定義するためにも使えます。
このアノテーションをクラスに指定するときは、アノテーションに指定する値は <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingHelper.html" class="api">BindingHelper</a>インターフェイスを実装したクラスにしなくてはいけません。
このクラスのインスタンスは、アノテーションが指定されたクラス内のプロパティに値がバインドされるときに毎回使われます。<p class="paragraph"/><div class="code"><pre>@BindUsing(SomeClassWhichImplementsBindingHelper)
class SomeClass &#123;
    <span class="java&#45;object">String</span> someProperty
    <span class="java&#45;object">Integer</span> someOtherProperty
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Custom Data Converters</div>
<h4>カスタムデータコンバータ</h4><p class="paragraph"/><div class="hidden-block">The binder will do a lot of type conversion automatically.  Some applications may want to define their own mechanism for converting values and a simple way to do this is to write a class which implements <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/ValueConverter.html" class="api">ValueConverter</a> and register an instance of that class as a bean in the Spring application context.</div>
バインダはたくさんの型変換を自動的に行います。
いくつかのアプリケーションでは、値を変換するための独自の機構を定義したいかもしれません。
そのための簡単な方法は<a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/ValueConverter.html" class="api">ValueConverter</a>を実装するクラスを書いて、そのクラスのインスタンスをビーンとしてSpringのアプリケーションコンテキストに登録することです。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.myapp.converters<p class="paragraph"/><span class="java&#45;keyword">import</span> org.grails.databinding.converters.ValueConverter<p class="paragraph"/>/&#42;&#42;
 &#42; A custom converter which will convert <span class="java&#45;object">String</span> of the
 &#42; form 'city:state' into an Address object.
 &#42;/
class AddressValueConverter <span class="java&#45;keyword">implements</span> ValueConverter &#123;<p class="paragraph"/>    <span class="java&#45;object">boolean</span> canConvert(value) &#123;
        value <span class="java&#45;keyword">instanceof</span> <span class="java&#45;object">String</span>
    &#125;<p class="paragraph"/>    def convert(value) &#123;
        def pieces = value.split(':')
        <span class="java&#45;keyword">new</span> com.myapp.Address(city: pieces&#91;0&#93;, state: pieces&#91;1&#93;)
    &#125;<p class="paragraph"/>    <span class="java&#45;object">Class</span>&#60;?&#62; getTargetType() &#123;
        com.myapp.Address
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">An instance of that class needs to be registered as a bean in the Spring application context.  The bean name is not important.  All beans that implemented ValueConverter will be automatically plugged in to the data binding process.</div>
クラスのインスタンスはSpringのアプリケーションコンテキストにビーンとして登録する必要があります。
ビーンの名前は重要ではありません。
<code>ValueConverter</code>を実装したすべてのビーンは、自動的にデータバインディングプロセスに組み込まれます。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy<p class="paragraph"/>beans = &#123;<p class="paragraph"/>    addressConverter com.myapp.converters.AddressValueConverter<p class="paragraph"/>    // ...<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    Address homeAddress
&#125;<p class="paragraph"/>class Address &#123;
    <span class="java&#45;object">String</span> city
    <span class="java&#45;object">String</span> state
&#125;<p class="paragraph"/>def person = <span class="java&#45;keyword">new</span> Person()
person.properties = &#91;firstName: 'Jeff', homeAddress: <span class="java&#45;quote">"O'Fallon:Missouri"</span>&#93;
assert person.firstName == 'Jeff'
assert person.homeAddress.city = <span class="java&#45;quote">"O'Fallon"</span>
assert person.homeAddress.state = 'Missouri'</pre></div><p class="paragraph"/><div class="hidden-block">h4. Date Formats For Data Binding</div>
<h4>データバインディングのためのデータフォーマット</h4><p class="paragraph"/><div class="hidden-block">A custom date format may be specified to be used when binding a String to a Date value by applying the <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a> annotation to a Date field.</div>
文字列を<code>Date</code>の値にバインドするとき、<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a>アノテーションをデータフィールドに付与することで、カスタムデータフォーマットを指定できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindingFormat<p class="paragraph"/>class Person &#123;
    @BindingFormat('MMddyyyy')
    Date birthDate
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Custom Formatted Converters</div>
<h4>カスタムフォーマットコンバータ</h4><p class="paragraph"/><div class="hidden-block">You may supply your own handler for the <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a> annotation by writing a class which implements the <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/FormattedValueConverter.html" class="api">FormattedValueConverter</a> interface and regiserting an instance of that class as a bean in the Spring application context.  Below is an example of a trivial custom String formatter that might convert the case of a String based on the value assigned to the BindingFormat annotation.</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/FormattedValueConverter.html" class="api">FormattedValueConverter</a>インターフェイスを実装したクラスを書いて、そのクラスのインスタンスをビーンとしてSpringのアプリケーションコンテキストに登録することで、<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a>アノテーションに対して独自のハンドラを提供できます。
以下は、<code>BindingFormat</code>アノテーションが指定された値の文字列の大文字/小文字を変換するという、ちょっとした文字列のカスタムフォーマッタの例です。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.myapp.converters<p class="paragraph"/><span class="java&#45;keyword">import</span> org.grails.databinding.converters.FormattedValueConverter<p class="paragraph"/>class FormattedStringValueConverter <span class="java&#45;keyword">implements</span> FormattedValueConverter &#123;
    def convert(value, <span class="java&#45;object">String</span> format) &#123;
        <span class="java&#45;keyword">if</span>('UPPERCASE' == format) &#123;
            value = value.toUpperCase()
        &#125; <span class="java&#45;keyword">else</span> <span class="java&#45;keyword">if</span>('LOWERCASE' == format) &#123;
            value = value.toLowerCase()
        &#125;
        value
    &#125;<p class="paragraph"/>    <span class="java&#45;object">Class</span> getTargetType() &#123;
        // specifies the type to which <span class="java&#45;keyword">this</span> converter may be applied
        <span class="java&#45;object">String</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">An instance of that class needs to be registered as a bean in the Spring application context.  The bean name is not important.  All beans that implemented FormattedValueConverter will be automatically plugged in to the data binding process.</div>
クラスのインスタンスはSpringのアプリケーションコンテキストにビーンとして登録する必要があります。
ビーンの名前は重要ではありません。
<code>FormattedValueConverter</code>を実装したすべてのビーンは、自動的にデータバインディングプロセスに組み込まれます。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy<p class="paragraph"/>beans = &#123;<p class="paragraph"/>    formattedStringConverter com.myapp.converters.FormattedStringValueConverter<p class="paragraph"/>    // ...<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With that in place the <code>BindingFormat</code> annotation may be applied to String fields to inform the data binder to take advantage of the custom converter.</div>
所定の場所にこれがあれば、データバインダにカスタムコンバータを利用することを伝えるために、<code>BindingFormat</code>アノテーションを文字列フィールドに適用できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindingFormat<p class="paragraph"/>class Person &#123;
    @BindingFormat('UPPERCASE')
    <span class="java&#45;object">String</span> someUpperCaseString<p class="paragraph"/>    @BindingFormat('LOWERCASE')
    <span class="java&#45;object">String</span> someLowerCaseString<p class="paragraph"/>    <span class="java&#45;object">String</span> someOtherString
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Data Binding and Security concerns </div>
<h4>データバインディングとセキュリティ考慮</h4><p class="paragraph"/><div class="hidden-block">When batch updating properties from request parameters you need to be careful not to allow clients to bind malicious data to domain classes and be persisted in the database. You can limit what properties are bound to a given domain class using the subscript operator:</div>
リクエストパラメータからの一括プロパティ更新をする際は、クライアントからの悪意のあるデータをドメインクラスにバインドし、データベースに永続化してしまわないように注意が必要です。
添字演算子を使用してドメインクラスにバインドするプロパティを制限することができます:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)<p class="paragraph"/>p.properties&#91;'firstName','lastName'&#93; = params</pre></div><p class="paragraph"/><div class="hidden-block">In this case only the <code>firstName</code> and <code>lastName</code> properties will be bound.</div>
上記の例では、<code>firstName</code>と<code>lastName</code>のみバインドされます。<p class="paragraph"/><div class="hidden-block">Another way to do this is is to use <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> as the target of data binding instead of domain classes. Alternatively there is also the flexible <a href="../ref/Controllers/bindData.html" class="controllers">bindData</a> method.</div>
他には、データバインディングの対象をドメインクラスではなく<a href="../guide/single.html#commandObjects" class="guide">コマンドオブジェクト</a>を利用する方法があります。あるいは柔軟な<a href="../ref/Controllers/bindData.html" class="controllers">bindData</a>メソッドを使用します。<p class="paragraph"/><div class="hidden-block">The <code>bindData</code> method allows the same data binding capability, but to arbitrary objects:</div>
<code>bindData</code>メソッドは任意のオブジェクトに同様のデータバインディングができます:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, params)</pre></div><p class="paragraph"/><div class="hidden-block">The <code>bindData</code> method also lets you exclude certain parameters that you don't want updated:</div>
<code>bindData</code>メソッドでは、更新したくないパラメータを除外することができます:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, params, &#91;exclude: 'dateOfBirth'&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">Or include only certain properties:</div>
または、指定したプロパティのみの更新も可能です:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, params, &#91;include: &#91;'firstName', 'lastName'&#93;&#93;)</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Note that if an empty List is provided as a value for the <code>include</code> parameter then all fields will be subject to binding if they are not explicitly excluded.</div>
空のリストが<code>include</code>パラメータの値として与えられた場合、明示的に除外指定がなされていない限り、すべてのフィールドがバインディング対象となることに注意してください。
</blockquote>



<h2 id="xmlAndJSON">7.1.7 XMLとJSONのレスポンス</h2>
<h4>renderメソッドでXMLを出力する <div class="hidden-block">Using the render method to output XML </div></h4><p class="paragraph"/><div class="hidden-block">Grails supports a few different ways to produce XML and JSON responses. The first is the <a href="../ref/Controllers/render.html" class="controllers">render</a> method.</div>
GrailsにはXMLとJSONを生成する複数の方法があります。はじめに<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッド。<p class="paragraph"/><div class="hidden-block">The <code>render</code> method can be passed a block of code to do mark-up building in XML:</div>
<code>render</code>メソッドに、マークアップビルダーのコードブロックを渡してXML生成:<p class="paragraph"/><div class="code"><pre>def list() &#123;<p class="paragraph"/>    def results = Book.list()<p class="paragraph"/>    render(contentType: <span class="java&#45;quote">"text/xml"</span>) &#123;
        books &#123;
            <span class="java&#45;keyword">for</span> (b in results) &#123;
                book(title: b.title)
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The result of this code would be something like:</div>
このコードの結果は以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;books&#62;</span>
    <span class="xml&#45;tag">&#60;book title=<span class="xml&#45;quote">"The Stand"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;book title=<span class="xml&#45;quote">"The Shining"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/books&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Be careful to avoid naming conflicts when using mark-up building. For example this code would produce an error:</div>
マークアップビルダーを使用する際は、変数名称の衝突を回避する必要があります。例として次のコードはエラーになります:<p class="paragraph"/><div class="code"><pre>def list() &#123;<p class="paragraph"/>    def books = Book.list()  // naming conflict here<p class="paragraph"/>    render(contentType: <span class="java&#45;quote">"text/xml"</span>) &#123;
        books &#123;
            <span class="java&#45;keyword">for</span> (b in results) &#123;
                book(title: b.title)
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is because there is local variable <code>books</code> which Groovy attempts to invoke as a method.</div>
この例では、Groovyがローカル変数のbooksをメソッドとして実行してしまいます。<p class="paragraph"/><h4>renderメソッドでJSONを出力する <div class="hidden-block">Using the render method to output JSON </div></h4><p class="paragraph"/><div class="hidden-block">The <code>render</code> method can also be used to output JSON:</div>
JSONを出力する場合も<code>render</code>メソッドが使用できます:<p class="paragraph"/><div class="code"><pre>def list() &#123;<p class="paragraph"/>    def results = Book.list()<p class="paragraph"/>    render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
        books = array &#123;
            <span class="java&#45;keyword">for</span> (b in results) &#123;
                book title: b.title
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the result would be something along the lines of:</div>
このコードの結果は以下のようになります:<p class="paragraph"/><div class="code"><pre>&#91;
    &#123;<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;,
    &#123;<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Shining"</span>&#125;
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The same dangers with naming conflicts described above for XML also apply to JSON building.</div>
JSONビルダーもXMLと同じく、変数名称の衝突を回避する必要があります。<p class="paragraph"/><h4>自動XMLマーシャリング <div class="hidden-block">Automatic XML Marshalling </div></h4><p class="paragraph"/><div class="hidden-block">Grails also supports automatic marshalling of <a href="../guide/single.html#GORM" class="guide">domain classes</a> to XML using special converters.</div>
Grailsでは<a href="../guide/single.html#GORM" class="guide">ドメインクラス</a>から特別なコンバータを使用した自動マーシャリングをサポートしています。<p class="paragraph"/><div class="hidden-block">To start off with, import the <code>grails.converters</code> package into your controller:</div>
使用するには、<code>grails.converters</code>パッケージをインポートする必要があります:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.&#42;</pre></div><p class="paragraph"/><div class="hidden-block">Now you can use the following highly readable syntax to automatically convert domain classes to XML:</div>
ドメインクラスをXMLに変換するのに、次のように見やすいシンタックスで記述できます:<p class="paragraph"/><div class="code"><pre>render Book.list() as XML</pre></div><p class="paragraph"/><div class="hidden-block">The resulting output would look something like the following::</div>
この例では次のような結果を出力します:<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"ISO&#45;8859&#45;1"</span>?&#62;
&#60;list&#62;
  &#60;book id=<span class="java&#45;quote">"1"</span>&#62;
    &#60;author&#62;Stephen King&#60;/author&#62;
    &#60;title&#62;The Stand&#60;/title&#62;
  &#60;/book&#62;
  &#60;book id=<span class="java&#45;quote">"2"</span>&#62;
    &#60;author&#62;Stephen King&#60;/author&#62;
    &#60;title&#62;The Shining&#60;/title&#62;
  &#60;/book&#62;
&#60;/list&#62;</pre></div><p class="paragraph"/><div class="hidden-block">An alternative to using the converters is to use the <a href="../guide/single.html#codecs" class="guide">codecs</a> feature of Grails. The codecs feature provides <a href="../guide/single.html#codecs" class="guide">encodeAsXML</a> and <a href="../guide/single.html#codecs" class="guide">encodeAsJSON</a> methods:</div>
またconvertersを使用する別の方法としてGrailsの<a href="../guide/single.html#codecs" class="guide">codecs</a>を使用することもできます。codecsでは、<a href="../guide/single.html#codecs" class="guide">encodeAsXML</a>と<a href="../guide/single.html#codecs" class="guide">encodeAsJSON</a>メソッドを提供しています:<p class="paragraph"/><div class="code"><pre>def xml = Book.list().encodeAsXML()
render xml</pre></div><p class="paragraph"/><div class="hidden-block">For more information on XML marshalling see the section on <a href="../guide/single.html#REST" class="guide">REST</a></div>
XMLマーシャリングの情報は<a href="../guide/single.html#REST" class="guide">REST</a>のセクションも参照してください。<p class="paragraph"/><h4>自動JSONマーシャリング <div class="hidden-block">Automatic JSON Marshalling </div></h4><p class="paragraph"/><div class="hidden-block">Grails also supports automatic marshalling to JSON using the same mechanism. Simply substitute <code>XML</code> with <code>JSON</code>:</div>
Grailsでは<code>XML</code>と同じ仕組みで、<code>JSON</code>の自動マーシャリングもサポートしています。単純に先の<code>XML</code>を<code>JSON</code>にするだけです<p class="paragraph"/><div class="code"><pre>render Book.list() as JSON</pre></div><p class="paragraph"/><div class="hidden-block">The resulting output would look something like the following:</div>
この例では次のような結果を出力します:<p class="paragraph"/><div class="code"><pre>&#91;
    &#123;<span class="java&#45;quote">"id"</span>:1,
     <span class="java&#45;quote">"class"</span>:<span class="java&#45;quote">"Book"</span>,
     <span class="java&#45;quote">"author"</span>:<span class="java&#45;quote">"Stephen King"</span>,
     <span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;,
    &#123;<span class="java&#45;quote">"id"</span>:2,
     <span class="java&#45;quote">"class"</span>:<span class="java&#45;quote">"Book"</span>,
     <span class="java&#45;quote">"author"</span>:<span class="java&#45;quote">"Stephen King"</span>,
     <span class="java&#45;quote">"releaseDate"</span>:<span class="java&#45;keyword">new</span> Date(1194127343161),
     <span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Shining"</span>&#125;
 &#93;</pre></div><p class="paragraph"/><div class="hidden-block">Again as an alternative you can use the <code>encodeAsJSON</code> to achieve the same effect.</div>
もちろん、<code>encodeAsJSON</code>も同じ結果になります。


<a name="7.1.8 More on JSONBuilder"><!-- Legacy link --></a>
<h2 id="moreOnJSONBuilder">7.1.8 JSONBuilder (JSONビルダー)</h2>
<div class="hidden-block">The previous section on on XML and JSON responses covered simplistic examples of rendering XML and JSON responses. Whilst the XML builder used by Grails is the standard <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy's+XmlSlurper" target="blank">XmlSlurper</a> found in Groovy, the JSON builder is a custom implementation specific to Grails.</div>
前のセクション「 XMLとJSONレスポンス」で単純なXMLとJSONのを描写してレスポンスする例を紹介しました。Grailsで使用してるXMLビルダーがGroovyの標準的な <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy's+XmlSlurper" target="blank">XmlSlurper</a> に対して、JSONビルダーに関してはGrails特有の実装になっています。<p class="paragraph"/><h4>JSONBuilderとGrailsのバージョン <div class="hidden-block">JSONBuilder and Grails versions </div></h4><p class="paragraph"/><div class="hidden-block">JSONBuilder behaves different depending on the version of Grails you use. For version below 1.2 the deprecated <a href="http://grails.org/doc/latest/api/grails/web/JSONBuilder.html" class="api">grails.web.JSONBuilder</a> class is used. This section covers the usage of the Grails 1.2 JSONBuilder </div>
JSONBuilderの振る舞いは使用するGrailsのバージョンに依存します。1.2以前では現在非推奨となる<a href="http://grails.org/doc/latest/api/grails/web/JSONBuilder.html" class="api">grails.web.JSONBuilder</a>が使用されます。このセクションでは、Grails 1.2のJSONBuilderの説明をします。<p class="paragraph"/><div class="hidden-block">For backwards compatibility the old <code>JSONBuilder</code> class is used with the <code>render</code> method for older applications; to use the newer/better <code>JSONBuilder</code> class set the following in <code>Config.groovy</code>:</div>
下位互換として、古いバージョンからメンテナンスしているアプリケーションのために、<code>render</code>メソッドで古い<code>JSONBuilder</code>を使用するようになっています。新しい良くなった<code>JSONBuilder</code>を使用するには<code>Config.groovy</code>に、次のような設定をします:<p class="paragraph"/><div class="code"><pre>grails.json.legacy.builder = <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><h4>単純なオブジェクトを描写 <div class="hidden-block">Rendering Simple Objects </div></h4><p class="paragraph"/><div class="hidden-block">To render a simple JSON object just set properties within the context of the Closure:</div>
単純なJSONオブジェクトを生成するには、クロージャの中にプロパティをセットするだけです:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    hello = <span class="java&#45;quote">"world"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above will produce the JSON:</div>
上記の例では、このような結果が得られます:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"hello"</span>:<span class="java&#45;quote">"world"</span>&#125;</pre></div><p class="paragraph"/><h4>JSON配列描写 <div class="hidden-block">Rendering JSON Arrays </div></h4><p class="paragraph"/><div class="hidden-block">To render a list of objects simple assign a list:</div>
オブジェクトのリストを描写するには、変数に配列を指定するだけです:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    categories = &#91;'a', 'b', 'c'&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will produce:</div>
この例では以下を生成:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"categories"</span>:&#91;<span class="java&#45;quote">"a"</span>,<span class="java&#45;quote">"b"</span>,<span class="java&#45;quote">"c"</span>&#93;&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also render lists of complex objects, for example:</div>
複雑なオブジェクトのリストも可能です。例として:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    categories = &#91; &#123; a = <span class="java&#45;quote">"A"</span> &#125;, &#123; b = <span class="java&#45;quote">"B"</span> &#125; &#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will produce:</div>
この例では以下を生成:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"categories"</span>:&#91; &#123;<span class="java&#45;quote">"a"</span>:<span class="java&#45;quote">"A"</span>&#125; , &#123;<span class="java&#45;quote">"b"</span>:<span class="java&#45;quote">"B"</span>&#125;&#93; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">Use the special <code>element</code> method to return a list as the root:</div>
<code>element</code>メソッドを使用することで、リストをルートとして返す事ができます:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    element 1
    element 2
    element 3
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above code produces:</div>
この例では以下を生成:<p class="paragraph"/><div class="code"><pre>&#91;1,2,3&#93;</pre></div><p class="paragraph"/><h4>複雑なオブジェクトの描写 <div class="hidden-block">Rendering Complex Objects </div></h4><p class="paragraph"/><div class="hidden-block">Rendering complex objects can be done with Closures. For example:</div>
より複雑なオブジェクトをクロージャで描写できます。例として:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    categories = &#91;'a', 'b', 'c'&#93;
    title = <span class="java&#45;quote">"Hello JSON"</span>
    information = &#123;
        pages = 10
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above will produce the JSON:</div>
この例では次のようなJSONを生成します:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"categories"</span>:&#91;<span class="java&#45;quote">"a"</span>,<span class="java&#45;quote">"b"</span>,<span class="java&#45;quote">"c"</span>&#93;,<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"Hello JSON"</span>,<span class="java&#45;quote">"information"</span>:&#123;<span class="java&#45;quote">"pages"</span>:10&#125;&#125;</pre></div><p class="paragraph"/><h4>複雑なオブジェクトの配列 <div class="hidden-block">Arrays of Complex Objects </div></h4><p class="paragraph"/><div class="hidden-block">As mentioned previously you can nest complex objects within arrays using Closures:</div>
前述したように、クロージャを使用してオブジェクトを配列にネストすることも可能です:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    categories = &#91; &#123; a = <span class="java&#45;quote">"A"</span> &#125;, &#123; b = <span class="java&#45;quote">"B"</span> &#125; &#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can use the <code>array</code> method to build them up dynamically:</div>
<code>array</code>メソッドを使用して動的に生成する事もできます:<p class="paragraph"/><div class="code"><pre>def results = Book.list()
render(contentType: <span class="java&#45;quote">"text/json"</span>) &#123;
    books = array &#123;
        <span class="java&#45;keyword">for</span> (b in results) &#123;
            book title: b.title
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>JSONBuilder APIに直接アクセスする <div class="hidden-block">Direct JSONBuilder API Access </div></h4><p class="paragraph"/><div class="hidden-block">If you don't have access to the <code>render</code> method, but still want to produce JSON you can use the API directly:</div>
renderメソッドと関係の無い場所ではJSONを生成したい場合はAPIを直に使用できます:<p class="paragraph"/><div class="code"><pre>def builder = <span class="java&#45;keyword">new</span> JSONBuilder()<p class="paragraph"/>def result = builder.build &#123;
    categories = &#91;'a', 'b', 'c'&#93;
    title = <span class="java&#45;quote">"Hello JSON"</span>
    information = &#123;
        pages = 10
    &#125;
&#125;<p class="paragraph"/>// prints the JSON text
println result.toString()<p class="paragraph"/>def sw = <span class="java&#45;keyword">new</span> StringWriter()
result.render sw</pre></div>


<a name="7.1.9 Uploading Files"><!-- Legacy link --></a>
<h2 id="uploadingFiles">7.1.9 ファイルアップロード</h2>
<h4>プログラムによるファイルアップロード <div class="hidden-block">Programmatic File Uploads </div></h4><p class="paragraph"/><div class="hidden-block">Grails supports file uploads using Spring's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartHttpServletRequest.html" class="api">MultipartHttpServletRequest</a> interface. The first step for file uploading is to create a multipart form like this:</div>
Grailsでは、Springの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartHttpServletRequest.html" class="api">MultipartHttpServletRequest</a>インターフェイスを使用してファイルアップロードをサポートしています。ファイルアップロードを実装するには、先に次のようにフォームをマルチパートフォームにします:<p class="paragraph"/><div class="code"><pre>Upload Form: <span class="xml&#45;tag">&#60;br /&#62;</span>
    <span class="xml&#45;tag">&#60;g:uploadForm action=<span class="xml&#45;quote">"upload"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"file"</span> name=<span class="xml&#45;quote">"myFile"</span> /&#62;</span>
        <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"submit"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;/g:uploadForm&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The <code>uploadForm</code> tag conveniently adds the <code>enctype="multipart/form-data"</code> attribute to the standard <code>&#60;g:form&#62;</code> tag.</div>
<code>uploadForm</code>タグは、通常の<code>&#60;g:form&#62;</code>タグに、<code>enctype="multipart/form-data"</code>の属性を追加します。<p class="paragraph"/><div class="hidden-block">There are then a number of ways to handle the file upload. One is to work with the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a> instance directly:</div>
アップロードされたファイルを処理するには複数の方法があります。そのうちの一つはSpringの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a>インスタンスを直接操作する方法です:<p class="paragraph"/><div class="code"><pre>def upload() &#123;
    def f = request.getFile('myFile')
    <span class="java&#45;keyword">if</span> (f.empty) &#123;
        flash.message = 'file cannot be empty'
        render(view: 'uploadForm')
        <span class="java&#45;keyword">return</span>
    &#125;<p class="paragraph"/>    f.transferTo(<span class="java&#45;keyword">new</span> File('/some/local/dir/myfile.txt'))
    response.sendError(200, 'Done')
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is convenient for doing transfers to other destinations and manipulating the file directly as you can obtain an <code>InputStream</code> and so on with the <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a> interface.</div>
この<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a>を使用すると、ファイルを別の場所に転送したり、<code>InputStream</code>を取得して直接ファイルを操作したりなど便利です。<p class="paragraph"/><h4>データバインディング経由のファイルアップロード <div class="hidden-block">File Uploads through Data Binding </div></h4><p class="paragraph"/><div class="hidden-block">File uploads can also be performed using data binding. Consider this <code>Image</code> domain class:</div>
データバインディングでファイルアップロードを処理する事ができます。<code>Image</code>というドメインクラスがあるとします:<p class="paragraph"/><div class="code"><pre>class Image &#123;
    <span class="java&#45;object">byte</span>&#91;&#93; myFile<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        // Limit upload file size to 2MB
        myFile maxSize: 1024 &#42; 1024 &#42; 2
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you create an image using the <code>params</code> object in the constructor as in the example below, Grails will automatically bind the file's contents as a <code>byte</code> to the <code>myFile</code> property:</div>
次の例のように、<code>params</code>をコンストラクタに渡してImageオブジェクトを生成すると、Grailsが自動的にファイルのコンテントを<code>myFile</code>プロパティに<code>byte&#91;&#93;</code>としてバインドします:<p class="paragraph"/><div class="code"><pre>def img = <span class="java&#45;keyword">new</span> Image(params)</pre></div><p class="paragraph"/><div class="hidden-block">It's important that you set the <a href="../ref/Constraints/size.html" class="constraints">size</a> or <a href="../ref/Constraints/maxSize.html" class="constraints">maxSize</a> constraints, otherwise your database may be created with a small column size that can't handle reasonably sized files. For example, both H2 and MySQL default to a blob size of 255 bytes for <code>byte</code> properties.</div>
この場合、データベースカラムのサイズが小さいと処理できなくなるので、<a href="../ref/Constraints/size.html" class="constraints">size</a>または<a href="../ref/Constraints/maxSize.html" class="constraints">maxSize</a>の制約を指定しましょう。例としてH2とMySQLは、<code>byte&#91;&#93;</code>プロパティで指定した場合のblobのデフォルトサイズが255バイトになります。<p class="paragraph"/><div class="hidden-block">It is also possible to set the contents of the file as a string by changing the type of the <code>myFile</code> property on the image to a String type:</div>
テキストファイルなどの場合は、<code>myFile</code>プロパティの型をString型にすることで文字列にすることも可能です:<p class="paragraph"/><div class="code"><pre>class Image &#123;
   <span class="java&#45;object">String</span> myFile
&#125;</pre></div>


<a name="7.1.10 Command Objects"><!-- Legacy link --></a>
<h2 id="commandObjects">7.1.10 コマンドオブジェクト</h2>
<div class="hidden-block">Grails controllers support the concept of command objects. A command object is a class that is used in conjunction with <a href="../guide/single.html#dataBinding" class="guide">data binding</a>, usually to allow validation of data that may not fit into an existing domain class.</div><p class="paragraph"/>Grailsのコマンドオブジェクトの設計概念をサポートしています。 コマンドオブジェクトは <a href="../guide/single.html#dataBinding" class="guide">data binding</a> と連結して使用するクラスであり、通常ドメインクラスとして扱わないデータに対してバリデーションを可能にします。<p class="paragraph"/><blockquote class="note">
Note: A class is only considered to be a command object when it is used as a parameter of an action.
</blockquote><p class="paragraph"/><h4>コマンドオブジェクトの宣言 <div class="hidden-block">Declaring Command Objects </div></h4><p class="paragraph"/><div class="hidden-block">Command object classes are defined just like any other class.</div>
コマンドオブジェクトクラスは他の通常クラスと同じように設定します:<p class="paragraph"/><div class="code"><pre>@grails.validation.Validateable
class LoginCommand &#123;
    <span class="java&#45;object">String</span> username
    <span class="java&#45;object">String</span> password<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        username(blank: <span class="java&#45;keyword">false</span>, minSize: 6)
        password(blank: <span class="java&#45;keyword">false</span>, minSize: 6)
    &#125;
&#125;</pre></div><p class="paragraph"/>In this example, the command object is marked with the <code>Validateable</code> annotation. The <code>Validateable</code> annotation allows the definition of <a href="../guide/single.html#constraints" class="guide">constraints</a> just like in <a href="../guide/single.html#GORM" class="guide">domain classes</a>. If the command object is defined in the same source file as the controller that is using it, Grails will automatically mark it as <code>Validateable</code>. It is not required that command object classes be validateable.<p class="paragraph"/>
<h4>コマンドオブジェクトを使用する <div class="hidden-block">Using Command Objects </div></h4><p class="paragraph"/>To use command objects, controller actions may optionally specify any number of command object parameters. The parameter types must be supplied so that Grails knows what objects to create and initialize.<p class="paragraph"/>Before the controller action is executed Grails will automatically create an instance of the command object class and populate its properties by binding the request parameters.  If the command object class is marked with <code>Validateable</code> then the command object will be validated. For example:<p class="paragraph"/><div class="code"><pre>class LoginController &#123;<p class="paragraph"/>    def login(LoginCommand cmd) &#123;
        <span class="java&#45;keyword">if</span> (cmd.hasErrors()) &#123;
            redirect(action: 'loginForm')
            <span class="java&#45;keyword">return</span>
        &#125;<p class="paragraph"/>        // work with the command object data
    &#125;
&#125;</pre></div><p class="paragraph"/>If the command object's type is that of a domain class and there is an <code>id</code> request parameter then instead of invoking the domain class constructor to create a new instance a call will be made to the static <code>get</code> method on the domain class and the value of the <code>id</code> parameter will be passed as an argument.  Whatever is returned from that call to <code>get</code> is what will be passed into the controller action.  This means that if there is an <code>id</code> request parameter and no corresponding record is found in the database then the value of the command object will be <code>null</code>.<p class="paragraph"/><h4>コマンドオブジェクトと依存注入 <div class="hidden-block">Command Objects and Dependency Injection </div></h4><p class="paragraph"/><div class="hidden-block">Command objects can participate in dependency injection. This is useful if your command object has some custom validation logic which uses a Grails <a href="../guide/single.html#services" class="guide">service</a>:</div>
コマンドオブジェクトに依存注入をすることが可能です。Grailsの<a href="../guide/single.html#services" class="guide">サービス</a>を使用したカスタムバリデーションなどを使用する際に便利です:<p class="paragraph"/>
<div class="code"><pre>@grails.validation.Validateable
class LoginCommand &#123;<p class="paragraph"/>    def loginService<p class="paragraph"/>    <span class="java&#45;object">String</span> username
    <span class="java&#45;object">String</span> password<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        username validator: &#123; val, obj &#45;&#62;
            obj.loginService.canLogin(obj.username, obj.password)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example the command object interacts with the <code>loginService</code> bean which is injected by name from the Spring <code>ApplicationContext</code>.</div>
この例では、<code>loginService</code>をSpringの<code>ApplicatinContext</code>から名前解決でコマンドオブジェクトに注入しています。


<a name="7.1.11 Handling Duplicate Form Submissions"><!-- Legacy link --></a>
<h2 id="formtokens">7.1.11 フォーム二重送信のハンドリング</h2>
<div class="hidden-block">Grails has built-in support for handling duplicate form submissions using the "Synchronizer Token Pattern". To get started you define a token on the <a href="../ref/Tags/form.html" class="tags">form</a> tag:</div>
Grailsには、"同期トークンパターン"を使用した、フォーム二重送信ハンドリングをサポートしています。使用するには、先ずは<a href="../ref/Tags/form.html" class="tags">form</a>タグにuseToken属性を指定します:<p class="paragraph"/><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:form useToken=<span class="xml&#45;quote">"true"</span> ...&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then in your controller code you can use the <a href="../ref/Controllers/withForm.html" class="controllers">withForm</a> method to handle valid and invalid requests:</div>
そして、コントローラアクションで<a href="../ref/Controllers/withForm.html" class="controllers">withForm</a>メソッドを利用して、リクエストの有効・無効それぞれのコードを記述します:<p class="paragraph"/><div class="code"><pre>withForm &#123;
   // good request
&#125;.invalidToken &#123;
   // bad request
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you only provide the <a href="../ref/Controllers/withForm.html" class="controllers">withForm</a> method and not the chained <code>invalidToken</code> method then by default Grails will store the invalid token in a <code>flash.invalidToken</code> variable and redirect the request back to the original page. This can then be checked in the view:</div>
<a href="../ref/Controllers/withForm.html" class="controllers">withForm</a>メソッドのみを提供して<code>invalidToken</code>にチェインしなかった場合は、デフォルトでGrailsが無効トークンを<code>flash.invalidToken</code>に保持して、元のページにリクエストをリダイレクトします。これによってビューで以下のように確認できます:<p class="paragraph"/>
<div class="code"><pre><span class="xml&#45;tag">&#60;g:if test=<span class="xml&#45;quote">"$&#123;flash.invalidToken&#125;"</span>&#62;</span>
  Don't click the button twice!
<span class="xml&#45;tag">&#60;/g:if&#62;</span></pre></div><p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">The <a href="../ref/Controllers/withForm.html" class="controllers">withForm</a> tag makes use of the <a href="../ref/Controllers/session.html" class="controllers">session</a> and hence requires session affinity or clustered sessions if used in a cluster.</div>
<a href="../ref/Controllers/withForm.html" class="controllers">withForm</a>メソッドはセッション(<a href="../ref/Controllers/session.html" class="controllers">session</a>)を使用するので、セッションの類似性またはクラスタで使用する場合はクラスタ化されたセッションが必要です。
</blockquote>


<a name="7.1.12 Simple Type Converters"><!-- Legacy link --></a>
<h2 id="typeConverters">7.1.12 シンプルタイプコンバータ</h2>
<h3>型変換メソッド <div class="hidden-block">Type Conversion Methods </div></h3><p class="paragraph"/><div class="hidden-block">If you prefer to avoid the overhead of <a href="../guide/single.html#dataBinding" class="guide">Data Binding</a> and simply want to convert incoming parameters (typically Strings) into another more appropriate type the <a href="../ref/Controllers/params.html" class="controllers">params</a> object has a number of convenience methods for each type:</div>
<a href="../guide/single.html#dataBinding" class="guide">データバインディング</a>でのオーバーヘッドを避けたい場合や、受信したパラメータに対して、単純な型変換行いたい場合、 <a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトには、型によって幾つかの便利なメソッドが有ります:<p class="paragraph"/><div class="code"><pre>def total = params.<span class="java&#45;object">int</span>('total')</pre></div><p class="paragraph"/><div class="hidden-block">The above example uses the <code>int</code> method, and there are also methods for <code>boolean</code>, <code>long</code>, <code>char</code>, <code>short</code> and so on. Each of these methods is null-safe and safe from any parsing errors, so you don't have to perform any additional checks on the parameters.</div>
上記の例ではintメソッドを使用しています。ほかに、<code>boolean</code>,<code>long</code>,<code>char</code>,<code>short</code>等多数のメソッドがあります。これらのメソッドはnullセーフであり、パースエラーセーフなので、パラメータに対してのチェックを追加する必要がありません。<p class="paragraph"/>
<div class="hidden-block">Each of the conversion methods allows a default value to be passed as an optional second argument.  The default value will be returned if a corresponding entry cannot be found in the map or if an error occurs during the conversion.  Example:</div>
型変換メソッドの第二引数にデフォルト値を設定することができます。一致する入力が無い場合や、型変換でエラーが起きた場合に指定したデフォルト値が返されます:<p class="paragraph"/><div class="code"><pre>def total = params.<span class="java&#45;object">int</span>('total', 42)</pre></div><p class="paragraph"/><div class="hidden-block">These same type conversion methods are also available on the <code>attrs</code> parameter of GSP tags.</div>
GSPタグの<code>attrs</code>パラメータでも、同じ仕組みの型変換機能が使用できます。<p class="paragraph"/><h3>複数の同一名称パラメータのハンドリング <div class="hidden-block">Handling Multi Parameters </div></h3><p class="paragraph"/><div class="hidden-block">A common use case is dealing with multiple request parameters of the same name. For example you could get a query string such as <code>?name=Bob&#38;name=Judy</code>.</div>
よくあるケースとして、リクエストパラメータ内の複数の同じ名称を扱う場合があります。クエリーの例として、<code>"?name=Bob&#38;name=Judy"</code>等。<p class="paragraph"/><div class="hidden-block">In this case dealing with one parameter and dealing with many has different semantics since Groovy's iteration mechanics for <code>String</code> iterate over each character. To avoid this problem the <a href="../ref/Controllers/params.html" class="controllers">params</a> object provides a <code>list</code> method that always returns a list:</div>
パラメータに1つのみしか無い場合にイテレートしてしまうと、<code>String</code>の文字列が1文字ずつ参照されてしまいます。この問題を避けるために、<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトの<code>list</code>メソッドを使用することで毎回リストを返すことが可能です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (name in params.list('name')) &#123;
    println name
&#125;</pre></div>


<a name="7.2 Groovy Server Pages"><!-- Legacy link --></a>
<h2 id="gsp">7.2 Groovyサーバーページ</h2>
<div class="hidden-block">Groovy Servers Pages (or GSP for short) is Grails' view technology. It is designed to be familiar for users of technologies such as ASP and JSP, but to be far more flexible and intuitive.</div>
Groovy Server Pages(GSPと略す)は、Grailsのビュー技術です。より柔軟で直感的であり、ASPやJSPのような技術に精通しているユーザ向けに設計されています。<p class="paragraph"/>
<div class="hidden-block">GSPs live in the <code>grails-app/views</code> directory and are typically rendered automatically (by convention) or with the <a href="../ref/Controllers/render.html" class="controllers">render</a> method such as:</div>
GSPは、grails-app/viewsディレクトリに配置されていて、通常は自動的(慣習によって)または、以下のように<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドで描写します。<p class="paragraph"/><div class="code"><pre>render(view: <span class="java&#45;quote">"index"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">A GSP is typically a mix of mark-up and GSP tags which aid in view rendering.</div>
GSPはマークアップとビュー描写を補助するGSPタグで内容が構成されています。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Although it is possible to have Groovy logic embedded in your GSP and doing this will be covered in this document, the practice is strongly discouraged. Mixing mark-up and code is a <strong class="bold">bad</strong> thing and most GSP pages contain no code and needn't do so.</div>
GroovyロジックをGSPに埋め込むことも可能ですが推奨しません。マークアップとコードが混在するのは良いことではありません。ほとんどのGSPではコードを持つべきで無く、そうする必要がありません。
</blockquote><p class="paragraph"/><div class="hidden-block">A GSP typically has a "model" which is a set of variables that are used for view rendering. The model is passed to the GSP view from a controller. For example consider the following controller action:</div>
GSPは通常ビュー描写に使用される変数のセットなどの"モデル"を持っています。モデルはコントローラからGSPビューげ渡されます。例として次のコントローラアクションを見てみましょう。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    &#91;book: Book.get(params.id)&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This action will look up a <code>Book</code> instance and create a model that contains a key called <code>book</code>. This key can then be referenced within the GSP view using the name <code>book</code>:</div>
このアクションは<code>Book</code>インスタンスを取り出して、<code>book</code>というキーでモデルを作成しています。GSPでは、このキー<code>book</code>が参照できます。<p class="paragraph"/><div class="code"><pre>$&#123;book.title&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
Embedding data received from user input has the risk of making your application vulnerable to an Cross Site Scripting (XSS) attack. Please read the documentation on <a href="../guide/single.html#xssPrevention" class="guide">XSS prevention</a> for information on how to prevent XSS attacks.
</blockquote>

<a name="7.2.1 GSP Basics"><!-- Legacy link --></a>
<h2 id="GSPBasics">7.2.1 GSPの基本</h2>
<div class="hidden-block">In the next view sections we'll go through the basics of GSP and what is available to you. First off let's cover some basic syntax that users of JSP and ASP should be familiar with.</div>
ここのセクションでは、GSPで何が可能かの基礎を見ていきましょう。先ずはじめにJSPやASPのユーザに親和性の高い基本的なシンタックスをカバーしていきます。<p class="paragraph"/><div class="hidden-block">GSP supports the usage of <code>&#60;% %&#62;</code> scriptlet blocks to embed Groovy code (again this is discouraged):</div>
GSPは、Groovyを記述できる、スクリプトレットブロック<code>&#60;% %&#62;</code>をサポートしています。(しつこいですが推奨しません)<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
     <span class="xml&#45;tag">&#60;% out &#60;&#60; <span class="xml&#45;quote">"Hello GSP!"</span> %&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">You can also use the <code>&#60;%= %&#62;</code> syntax to output values:</div>
もちろん<code>&#60;%= %&#62;</code>を使用して値を出力することもできます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
     <span class="xml&#45;tag">&#60;%=<span class="xml&#45;quote">"Hello GSP!"</span> %&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">GSP also supports JSP-style server-side comments (which are not rendered in the HTML response) as the following example demonstrates:</div>
次のようなJSPスタイルのサーバサイドコメント(HTMLに出力されない)もサポートされています。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
     <span class="xml&#45;tag">&#60;%&#45;&#45; This is my comment &#45;&#45;%&#62;</span>
     <span class="xml&#45;tag">&#60;%=<span class="xml&#45;quote">"Hello GSP!"</span> %&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><blockquote class="warning">
Embedding data received from user input has the risk of making your application vulnerable to an Cross Site Scripting (XSS) attack. Please read the documentation on <a href="../guide/single.html#xssPrevention" class="guide">XSS prevention</a> for information on how to prevent XSS attacks.
</blockquote>

<a name="6.6.3 Variables and Scopes"><!-- Legacy link --></a>
<h2 id="variablesAndScopes">7.2.1.1 変数とスコープ</h2>
<div class="hidden-block">Within the <code>&#60;% %&#62;</code> brackets you can declare variables:</div>
<code>&#60;% %&#62;</code>で変数を宣言できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;% now = new Date() %&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">and then access those variables later in the page:</div>
宣言した変数はページ内でアクセスすることができます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;%=now%&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Within the scope of a GSP there are a number of pre-defined variables, including:</div>
GSPには、初期定義されたスコープ変数がいくつか存在します。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>application</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">javax.servlet.ServletContext</a> instance</li>
<li><code>applicationContext</code> The Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a> instance</li>
<li><code>flash</code> - The <a href="../ref/Controllers/flash.html" class="controllers">flash</a> object</li>
<li><code>grailsApplication</code> - The <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> instance</li>
<li><code>out</code> - The response writer for writing to the output stream</li>
<li><code>params</code> - The <a href="../ref/Controllers/params.html" class="controllers">params</a> object for retrieving request parameters</li>
<li><code>request</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a> instance</li>
<li><code>response</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a> instance</li>
<li><code>session</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a> instance</li>
<li><code>webRequest</code> - The <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/servlet/mvc/GrailsWebRequest.html" class="api">GrailsWebRequest</a> instance</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>application</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">javax.servlet.ServletContext</a>インスタンス</li>
<li><code>applicationContext</code> - Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a>インスタンス</li>
<li><code>flash</code> - flash オブジェクト</li>
<li><code>grailsApplication</code> - <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a>インスタンス</li>
<li><code>out</code> - 出力ストリームを書き込むレスポンスライター</li>
<li><code>params</code> - <a href="../ref/Controllers/params.html" class="controllers">params</a>リクエストパラメータを取得するオブジェクト</li>
<li><code>request</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>インスタンス</li>
<li><code>response</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a>インスタンス</li>
<li><code>session</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a>インスタンス</li>
<li><code>webRequest</code> - <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/servlet/mvc/GrailsWebRequest.html" class="api">GrailsWebRequest</a>インスタンス</li>
</ul><p class="paragraph"/>

<a name="7.2.2.2 Logic and Iteration"><!-- Legacy link --></a>
<h2 id="logicAndIteration">7.2.1.2 ロジックとイテレーション</h2>
<div class="hidden-block">Using the <code>&#60;% %&#62;</code> syntax you can embed loops and so on using this syntax:</div>
以下のように<code>&#60;% %&#62;</code>シンタックスを使ってループなどを記述できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      <span class="xml&#45;tag">&#60;% &#91;1,2,3,4&#93;.each &#123; num &#45;&#62;</span> %&#62;
         <span class="xml&#45;tag">&#60;p&#62;</span><span class="xml&#45;tag">&#60;%=<span class="xml&#45;quote">"Hello $&#123;num&#125;!"</span> %&#62;</span><span class="xml&#45;tag">&#60;/p&#62;</span>
      <span class="xml&#45;tag">&#60;%&#125;%&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">As well as logical branching:</div>
また他に分岐も<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      <span class="xml&#45;tag">&#60;% if (params.hello == 'true')%&#62;</span>
      <span class="xml&#45;tag">&#60;%=<span class="xml&#45;quote">"Hello!"</span>%&#62;</span>
      <span class="xml&#45;tag">&#60;% else %&#62;</span>
      <span class="xml&#45;tag">&#60;%=<span class="xml&#45;quote">"Goodbye!"</span>%&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div>


<a name="7.2.1.3 Page Directives"><!-- Legacy link --></a>
<h2 id="pageDirectives">7.2.1.3 ページディレクティブ</h2>
<div class="hidden-block">GSP also supports a few JSP-style page directives.</div>
GSPはJSPのページディレクティブの一部をサポートしています。<p class="paragraph"/><div class="hidden-block">The import directive lets you import classes into the page. However, it is rarely needed due to Groovy's default imports and <a href="../guide/single.html#tags" class="guide">GSP Tags</a>:</div>
importディレクティブは、ページにクラスをインポートします。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;%@ page import=<span class="xml&#45;quote">"java.awt.&#42;"</span> %&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">GSP also supports the contentType directive:</div>
contentTypeディレクティブもサポートしています。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;%@ page contentType=<span class="xml&#45;quote">"text/json"</span> %&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The contentType directive allows using GSP to render other formats.</div>
contentTypeディレクティブはGSPを別のフォーマットを可能にします。


<a name="7.2.1.4 Expressions"><!-- Legacy link --></a>
<h2 id="expressions">7.2.1.4 エクスプレッション</h2>
<div class="hidden-block">In GSP the <code>&#60;%= %&#62;</code> syntax introduced earlier is rarely used due to the support for GSP expressions. A GSP expression is similar to a JSP EL expression or a Groovy GString and takes the form <code>${expr}</code>:</div>
GSPでは、先に紹介した<code>&#60;%= %&#62;</code>シンタックスは滅多に使用しません。代わりに、JSPの式言語(JSP EL)と同じような機能をもつGSP(Groovy)表記または、<code>${expr}</code>のようなGroovyのGStringを使用します。<p class="paragraph"/>
<div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
  <span class="xml&#45;tag">&#60;body&#62;</span>
    Hello $&#123;params.name&#125;
  <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">However, unlike JSP EL you can have any Groovy expression within the <code>${..}</code> block. </div>
JSP式言語(JSP EL)と違い、Groovy表記は、 <code>${…}</code> ブロックに記述します。<p class="paragraph"/><blockquote class="warning">
Embedding data received from user input has the risk of making your application vulnerable to an Cross Site Scripting (XSS) attack. Please read the documentation on <a href="../guide/single.html#xssPrevention" class="guide">XSS prevention</a> for information on how to prevent XSS attacks.
</blockquote><p class="paragraph"/>

<a name="7.2.2 GSP Tags"><!-- Legacy link --></a>
<h2 id="tags">7.2.2 GSPタグ</h2>
<div class="hidden-block">Now that the less attractive JSP heritage has been set aside, the following sections cover GSP's built-in tags, which are the preferred way to define GSP pages.</div>
魅力の低い遺産JSPはさておき、このセクションではGSPの組込タグを、GSPページでどのように活用すると良いか解説していきます。<p class="paragraph"/>
<blockquote class="note">
<div class="hidden-block">The section on <a href="../guide/single.html#taglibs" class="guide">Tag Libraries</a> covers how to add your own custom tag libraries.</div>
カスタムタグの追加などは、<a href="../guide/single.html#taglibs" class="guide">タグライブラリ</a>のセクションで解説します。
</blockquote><p class="paragraph"/><div class="hidden-block">All built-in GSP tags start with the prefix <code>g:</code>. Unlike JSP, you don't specify any tag library imports. If a tag starts with <code>g:</code> it is automatically assumed to be a GSP tag. An example GSP tag would look like:</div>
全ての組込GSPタグは接頭辞<code>g:</code>で始まるタグです。JSPと違いタグライブラリのインポートが必要有りません。<code>g:</code>接頭辞のタグは自動的にGSPタグとして用いられます。例としてGSPタグの見ためは次のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:example /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">GSP tags can also have a body such as:</div>
GSPタグの内容も記述できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:example&#62;</span>
   Hello world
<span class="xml&#45;tag">&#60;/g:example&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Expressions can be passed into GSP tag attributes, if an expression is not used it will be assumed to be a String value:</div>
GSPのタグ属性にエクスプレッションを記述できます。エクスプレッションを使用しない場合は文字列として値が用いられます。:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:example attr=<span class="xml&#45;quote">"$&#123;new Date()&#125;"</span>&#62;</span>
   Hello world
<span class="xml&#45;tag">&#60;/g:example&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Maps can also be passed into GSP tag attributes, which are often used for a named parameter style syntax:</div>
GSPのタグ属性に、ひんぱんに使用する名前付きパラメータ構文として、Map型を記述できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:example attr=<span class="xml&#45;quote">"$&#123;new Date()&#125;"</span> attr2=<span class="xml&#45;quote">"&#91;one:1, two:2, three:3&#93;"</span>&#62;</span>
   Hello world
<span class="xml&#45;tag">&#60;/g:example&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Note that within the values of attributes you must use single quotes for Strings:</div>
属性内での、Mapの文字列値はシングルクォートを使用してください:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:example attr=<span class="xml&#45;quote">"$&#123;new Date()&#125;"</span> attr2=<span class="xml&#45;quote">"&#91;one:'one', two:'two'&#93;"</span>&#62;</span>
   Hello world
<span class="xml&#45;tag">&#60;/g:example&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">With the basic syntax out the way, the next sections look at the tags that are built into Grails by default.</div>
ここまでで基本構文は全てです。次のセクションではどのようなタグがGrailsにデフォルトで組み込まれているか見ていきましょう。



<h2 id="tagVariablesAndScopes">7.2.2.1 変数とスコープ</h2>
<div class="hidden-block">Variables can be defined within a GSP using the <a href="../ref/Tags/set.html" class="tags">set</a> tag:</div>
GSPでは変数を<a href="../ref/Tags/set.html" class="tags">set</a>タグで定義することができます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"now"</span> value=<span class="xml&#45;quote">"$&#123;new Date()&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Here we assign a variable called <code>now</code> to the result of a GSP expression (which simply constructs a new <code>java.util.Date</code> instance). You can also use the body of the <code>&#60;g:set&#62;</code> tag to define a variable:</div>
この例では変数<code>now</code>にGSP表記の結果を割り当てています(単純に<code>java.util.Date</code>のインスタンスを生成しただけです)。<code>&#60;g:set&#62;</code>タグのタグ内容に記述して定義することもできます。:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"myHTML"</span>&#62;</span>
   Some re&#45;usable code on: $&#123;new Date()&#125;
<span class="xml&#45;tag">&#60;/g:set&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The assigned value can also be a bean from the applicationContext:</div>
applicationContextにあるビーンを変数定義することも可能です。
<div class="code"><pre><span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"bookService"</span> bean=<span class="xml&#45;quote">"bookService"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Variables can also be placed in one of the following scopes:</div>
変数は以下のいずれかのスコープに定義することができます:
<div class="hidden-block">
<ul class="star">
<li><code>page</code> - Scoped to the current page (default)</li>
<li><code>request</code> - Scoped to the current request</li>
<li><code>flash</code> - Placed within <a href="../ref/Controllers/flash.html" class="controllers">flash</a> scope and hence available for the next request</li>
<li><code>session</code> - Scoped for the user session</li>
<li><code>application</code> - Application-wide scope.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>page</code> - (デフォルト)現在のページ</li>
<li><code>request</code> - 現在のリクエスト</li>
<li><code>flash</code> - <a href="../ref/Controllers/flash.html" class="controllers">flash</a>スコープに配置され、次のリクエストまで。</li>
<li><code>session</code> - ユーザのセッション</li>
<li><code>application</code> - アプリケーション全体</li>
</ul><p class="paragraph"/><div class="hidden-block">To specify the scope, use the <code>scope</code> attribute:</div>
スコープの定義は、<code>scope</code>属性に指定します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"now"</span> value=<span class="xml&#45;quote">"$&#123;new Date()&#125;"</span> scope=<span class="xml&#45;quote">"request"</span> /&#62;</span></pre></div>



<h2 id="tagLogicAndIteration">7.2.2.2 ロジックとイテレーション</h2>
<div class="hidden-block">GSP also supports logical and iterative tags out of the box. For logic there are <a href="../ref/Tags/if.html" class="tags">if</a>, <a href="../ref/Tags/else.html" class="tags">else</a> and <a href="../ref/Tags/elseif.html" class="tags">elseif</a> tags for use with branching:</div>
GSPにはすぐに活用できるロジックタグとイテレーションタグがあります。ロジックタグは分岐に使用する<a href="../ref/Tags/if.html" class="tags">if</a>, <a href="../ref/Tags/else.html" class="tags">else</a>, <a href="../ref/Tags/elseif.html" class="tags">elseif</a>です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:if test=<span class="xml&#45;quote">"$&#123;session.role == 'admin'&#125;"</span>&#62;</span>
   <span class="xml&#45;tag">&#60;%&#45;&#45; show administrative functions &#45;&#45;%&#62;</span>
<span class="xml&#45;tag">&#60;/g:if&#62;</span>
<span class="xml&#45;tag">&#60;g:else&#62;</span>
   <span class="xml&#45;tag">&#60;%&#45;&#45; show basic functions &#45;&#45;%&#62;</span>
<span class="xml&#45;tag">&#60;/g:else&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Use the <a href="../ref/Tags/each.html" class="tags">each</a> and <a href="../ref/Tags/while.html" class="tags">while</a> tags for iteration:</div>
イテレーションには<a href="../ref/Tags/each.html" class="tags">each</a>タグと<a href="../ref/Tags/while.html" class="tags">while</a>タグを使用します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:each in=<span class="xml&#45;quote">"$&#123;&#91;1,2,3&#93;&#125;"</span> var=<span class="xml&#45;quote">"num"</span>&#62;</span>
   <span class="xml&#45;tag">&#60;p&#62;</span>Number $&#123;num&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:each&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"num"</span> value=<span class="xml&#45;quote">"$&#123;1&#125;"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:while test=<span class="xml&#45;quote">"$&#123;num &#60; 5 &#125;"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;p&#62;</span>Number $&#123;num++&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:while&#62;</span></pre></div>


<a name="7.2.2.3 Search and Filtering"><!-- Legacy link --></a>
<h2 id="searchAndFiltering">7.2.2.3 検索とフィルタリング</h2>
<div class="hidden-block">If you have collections of objects you often need to sort and filter them. Use the <a href="../ref/Tags/findAll.html" class="tags">findAll</a> and <a href="../ref/Tags/grep.html" class="tags">grep</a> tags for these tasks:</div>
オブジェクトのコレクションを扱う場合はソート、フィルタリングが必要になります。その場合は <a href="../ref/Tags/findAll.html" class="tags">findAll</a>タグと<a href="../ref/Tags/grep.html" class="tags">grep</a>タグが活用できます:<p class="paragraph"/><div class="code"><pre>Stephen King's Books:
<span class="xml&#45;tag">&#60;g:findAll in=<span class="xml&#45;quote">"$&#123;books&#125;"</span> expr=<span class="xml&#45;quote">"it.author == 'Stephen King'"</span>&#62;</span>
     <span class="xml&#45;tag">&#60;p&#62;</span>Title: $&#123;it.title&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:findAll&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The <code>expr</code> attribute contains a Groovy expression that can be used as a filter. The <a href="../ref/Tags/grep.html" class="tags">grep</a> tag does a similar job, for example filtering by class:</div>
フィルターとして使うGroovy式を<code>expr</code>属性に記述します。<a href="../ref/Tags/grep.html" class="tags">grep</a>タグも同じような動作をします。クラスでのフィルタリングを例とすると:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:grep in=<span class="xml&#45;quote">"$&#123;books&#125;"</span> filter=<span class="xml&#45;quote">"NonFictionBooks.class"</span>&#62;</span>
     <span class="xml&#45;tag">&#60;p&#62;</span>Title: $&#123;it.title&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:grep&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Or using a regular expression:</div>
正規表現を使用した例:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:grep in=<span class="xml&#45;quote">"$&#123;books.title&#125;"</span> filter=<span class="xml&#45;quote">"~/.&#42;?Groovy.&#42;?/"</span>&#62;</span>
     <span class="xml&#45;tag">&#60;p&#62;</span>Title: $&#123;it&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:grep&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The above example is also interesting due to its usage of GPath. GPath is an XPath-like language in Groovy. The <code>books</code> variable is a collection of <code>Book</code> instances. Since each <code>Book</code> has a <code>title</code>, you can obtain a list of Book titles using the expression <code>books.title</code>. Groovy will auto-magically iterate the collection, obtain each title, and return a new list!</div>
上記の例ではGPathも使用方法も紹介されています。GPathはGroovyでのXpathのような言語です。変数<code>books</code>は<code>Book</code>インスタンスのコレクションです。全ての<code>Book</code>にプロパティ<code>title</code>が有る場合、<code>books.title</code>とすることで<code>Book</code>の<code>title</code>プロパティのリストを得られます。Groovyは自動的にコレクションを検索して全ての<code>title</code>を含んだリストを返してくれます。


<a name="7.2.2.4 Links and Resources"><!-- Legacy link --></a>
<h2 id="linksAndResources">7.2.2.4 リンクとリソース</h2>
<div class="hidden-block">GSP also features tags to help you manage linking to controllers and actions. The <a href="../ref/Tags/link.html" class="tags">link</a> tag lets you specify controller and action name pairing and it will automatically work out the link based on the <a href="../guide/single.html#urlmappings" class="guide">URL Mappings</a>, even if you change them! For example:</div>
コントローラとアクションでのリンクを操作するGSPタグがあります。<a href="../ref/Tags/link.html" class="tags">link</a>タグはコントローラとアクション名を指定するだけで<a href="../guide/single.html#urlmappings" class="guide">URLマッピング</a>をベースとしたリンクを自動的に生成します(<a href="../guide/single.html#urlmappings" class="guide">URLマッピング</a>で変更をしても)。:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:link action=<span class="xml&#45;quote">"show"</span> id=<span class="xml&#45;quote">"1"</span>&#62;</span>Book 1<span class="xml&#45;tag">&#60;/g:link&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:link action=<span class="xml&#45;quote">"show"</span> id=<span class="xml&#45;quote">"$&#123;currentBook.id&#125;"</span>&#62;</span>$&#123;currentBook.name&#125;<span class="xml&#45;tag">&#60;/g:link&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:link controller=<span class="xml&#45;quote">"book"</span>&#62;</span>Book Home<span class="xml&#45;tag">&#60;/g:link&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:link controller=<span class="xml&#45;quote">"book"</span> action=<span class="xml&#45;quote">"list"</span>&#62;</span>Book List<span class="xml&#45;tag">&#60;/g:link&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:link url=<span class="xml&#45;quote">"&#91;action: 'list', controller: 'book'&#93;"</span>&#62;</span>Book List<span class="xml&#45;tag">&#60;/g:link&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:link params=<span class="xml&#45;quote">"&#91;sort: 'title', order: 'asc', author: currentBook.author&#93;"</span>
        action=<span class="xml&#45;quote">"list"</span>&#62;</span>Book List<span class="xml&#45;tag">&#60;/g:link&#62;</span></pre></div>


<a name="7.2.2.5 Forms and Fields"><!-- Legacy link --></a>
<h2 id="formsAndFields">7.2.2.5 フォームとフィールド</h2>
<h4>フォームの基礎 <div class="hidden-block">Form Basics </div></h4><p class="paragraph"/><div class="hidden-block">GSP supports many different tags for working with HTML forms and fields, the most basic of which is the <a href="../ref/Tags/form.html" class="tags">form</a> tag. This is a controller/action aware version of the regular HTML form tag. The <code>url</code> attribute lets you specify which controller and action to map to:</div>
GSPではHTMLのフォームとフィールドに対応した様々なタグをサポートしています。フォーム・フィールドの基礎となるタグはformタグです。<a href="../ref/Tags/form.html" class="tags">form</a>タグは、通常のHTML formタグが、コントローラ・アクションを意識してる版みたいな物です。次のように、<code>url</code>属性にマップでコントローラアクションを指定します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:form name=<span class="xml&#45;quote">"myForm"</span> url=<span class="xml&#45;quote">"&#91;controller:'book',action:'list'&#93;"</span>&#62;</span>...<span class="xml&#45;tag">&#60;/g:form&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">In this case we create a form called <code>myForm</code> that submits to the <code>BookController</code>'s <code>list</code> action. Beyond that all of the usual HTML attributes apply.</div>
この例では、<code>myForm</code>という名称で、<code>BookController</code>の<code>list</code>アクションへ送信するフォームを生成します。通常のHTML属性はそのまま使用できます。<p class="paragraph"/><h4>フォームフィールド <div class="hidden-block">Form Fields </div></h4><p class="paragraph"/><div class="hidden-block">In addition to easy construction of forms, GSP supports custom tags for dealing with different types of fields, including:</div>
フォームを簡単に作成するために、GSPでは多数種類のフィールドタグをサポートしています:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><a href="../ref/Tags/textField.html" class="tags">textField</a> - For input fields of type 'text'</li>
<li><a href="../ref/Tags/passwordField.html" class="tags">passwordField</a> - For input fields of type 'password'</li>
<li><a href="../ref/Tags/checkBox.html" class="tags">checkBox</a> - For input fields of type 'checkbox'</li>
<li><a href="../ref/Tags/radio.html" class="tags">radio</a> - For input fields of type 'radio'</li>
<li><a href="../ref/Tags/hiddenField.html" class="tags">hiddenField</a> - For input fields of type 'hidden'</li>
<li><a href="../ref/Tags/select.html" class="tags">select</a> - For dealing with HTML select boxes</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="../ref/Tags/textField.html" class="tags">textField</a> - 属性typeが'text'のinputタグ用</li>
<li><a href="../ref/Tags/passwordField.html" class="tags">passwordField</a> -  属性typeが'password'のinputタグ用</li>
<li><a href="../ref/Tags/checkBox.html" class="tags">checkBox</a> -  属性typeが'checkbox'のinputタグ用</li>
<li><a href="../ref/Tags/radio.html" class="tags">radio</a> -  属性typeが'radio'のinputタグ用</li>
<li><a href="../ref/Tags/hiddenField.html" class="tags">hiddenField</a> -  属性typeが'hidden'のinputタグ用</li>
<li><a href="../ref/Tags/select.html" class="tags">select</a> - セレクトボックス用タグ</li>
</ul><p class="paragraph"/><div class="hidden-block">Each of these allows GSP expressions for the value:</div>
value属性の値にGSPエクスプレッションを使用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"myField"</span> value=<span class="xml&#45;quote">"$&#123;myValue&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">GSP also contains extended helper versions of the above tags such as <a href="../ref/Tags/radioGroup.html" class="tags">radioGroup</a> (for creating groups of <a href="../ref/Tags/radio.html" class="tags">radio</a> tags), <a href="../ref/Tags/localeSelect.html" class="tags">localeSelect</a>, <a href="../ref/Tags/currencySelect.html" class="tags">currencySelect</a> and <a href="../ref/Tags/timeZoneSelect.html" class="tags">timeZoneSelect</a> (for selecting locales, currencies and time zones respectively).</div>
そのほかに、これらのタグを拡張した、<a href="../ref/Tags/radioGroup.html" class="tags">radioGroup</a>(<a href="../ref/Tags/radio.html" class="tags">radio</a>タグのセットを作成)タグや、<a href="../ref/Tags/localeSelect.html" class="tags">localeSelect</a>、<a href="../ref/Tags/currencySelect.html" class="tags">currencySelect</a>、<a href="../ref/Tags/timeZoneSelect.html" class="tags">timeZoneSelect</a>等、それぞれ、ロケール、通貨、タイムゾーンに対応したタグもあります。<p class="paragraph"/><h4>マルチ送信ボタン <div class="hidden-block">Multiple Submit Buttons </div></h4><p class="paragraph"/><div class="hidden-block">The age old problem of dealing with multiple submit buttons is also handled elegantly with Grails using the <a href="../ref/Tags/actionSubmit.html" class="tags">actionSubmit</a> tag. It is just like a regular submit, but lets you specify an alternative action to submit to:</div>
Grailsでは、<a href="../ref/Tags/actionSubmit.html" class="tags">actionSubmit</a>タグを使用することで、マルチ送信ボタン対応は、すっきりと実装できます。単純な送信ボタンのように見えますが、action属性にアクションを指定すると、指定したアクションへフォームが送信されるようになります。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:actionSubmit value=<span class="xml&#45;quote">"Some update label"</span> action=<span class="xml&#45;quote">"update"</span> /&#62;</span></pre></div>


<a name="7.2.2.6 Tags as Method Calls"><!-- Legacy link --></a>
<h2 id="tagsAsMethodCalls">7.2.2.6 タグをメソッドとして使用</h2>
<div class="hidden-block">One major different between GSP tags and other tagging technologies is that GSP tags can be called as either regular tags or as method calls from <a href="../guide/single.html#controllers" class="guide">controllers</a>, <a href="../guide/single.html#taglibs" class="guide">tag libraries</a> or GSP views.</div>
GSPタグと他のタグ技術との大きな違いは、通常のタグとしての利用だけではなく、<a href="../guide/single.html#controllers" class="guide">コントローラ</a>、<a href="../guide/single.html#taglibs" class="guide">タグライブラリ</a>またはGSPビューから、メソッドとして呼び出せるという点です。<p class="paragraph"/><h4>GSPでタグをメソッドとして使用する <div class="hidden-block">Tags as method calls from GSPs </div></h4><p class="paragraph"/><div class="hidden-block">Tags return their results as a String-like object (a <code>StreamCharBuffer</code> which has all of the same methods as String) instead of writing directly to the response when called as methods. For example:</div>
タグをメソッドとして使用すると、結果をレスポンスへ出力する代わりに、文字列のようなオブジェクトで返します(Stringと同じメソッドを持つ<code>StreamCharBuffer</code>)。:<p class="paragraph"/><div class="code"><pre>Static Resource: $&#123;createLinkTo(dir: <span class="xml&#45;quote">"images"</span>, file: <span class="xml&#45;quote">"logo.jpg"</span>)&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is particularly useful for using a tag within an attribute:</div>
タグの属性内に使用する際などに特に便利です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;img src=<span class="xml&#45;quote">"$&#123;createLinkTo(dir: 'images', file: 'logo.jpg')&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">In view technologies that don't support this feature you have to nest tags within tags, which becomes messy quickly and often has an adverse effect of WYSWIG tools such as Dreamweaver that attempt to render the mark-up as it is not well-formed:</div>
以下の例のように、このような機能をもたないタグ技術は、タグをネストしないといけません。これだとすぐにコードは乱雑になり、Dreamweaver等のツールでの表示が正常になりません:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;img src=<span class="xml&#45;quote">"&#60;g:createLinkTo dir="</span>images<span class="xml&#45;quote">" file="</span>logo.jpg<span class="xml&#45;quote">" /&#62;</span>"</span> /&#62;</pre></div><p class="paragraph"/><h4>コントローラとタグライブラリでタグをメソッドとして使用する <div class="hidden-block">Tags as method calls from Controllers and Tag Libraries </div></h4><p class="paragraph"/><div class="hidden-block">You can also invoke tags from controllers and tag libraries. Tags within the default <code>g:</code> <a href="../guide/single.html#namespaces" class="guide">namespace</a> can be invoked without the prefix and a <code>StreamCharBuffer</code> result is returned:</div>
コントローラとタブライブラリ(実装側)で、タグを呼び出す事が可能です。デフォルトの<a href="../guide/single.html#namespaces" class="guide">ネームスペース</a><code>g:</code>を持つタグは、接頭辞無しで呼び出す事で、結果に<code>StreamCharBuffer</code>を返します:<p class="paragraph"/><div class="code"><pre>def imageLocation = createLinkTo(dir:<span class="java&#45;quote">"images"</span>, file:<span class="java&#45;quote">"logo.jpg"</span>).toString()</pre></div><p class="paragraph"/><div class="hidden-block">Prefix the namespace to avoid naming conflicts:</div>
名前の衝突を避けるために、ネームスペースを接頭辞とする場合は:<p class="paragraph"/><div class="code"><pre>def imageLocation = g.createLinkTo(dir:<span class="java&#45;quote">"images"</span>, file:<span class="java&#45;quote">"logo.jpg"</span>).toString()</pre></div><p class="paragraph"/><div class="hidden-block">For tags that use a <a href="../guide/single.html#namespaces" class="guide">custom namespace</a>, use that prefix for the method call. For example (from the <a href="http://grails.org/plugin/fckeditor" target="blank">FCK Editor plugin</a>):</div>
カスタムネームスペースを使用しているタグの場合は、<a href="../guide/single.html#namespaces" class="guide">カスタムネームスペース</a>を接頭辞として使います。<a href="http://grails.org/plugin/fckeditor" target="blank">FCKエディタープラグイン</a>を例とすると:<p class="paragraph"/><div class="code"><pre>def editor = fckeditor.editor(name: <span class="java&#45;quote">"text"</span>, width: <span class="java&#45;quote">"100%"</span>, height: <span class="java&#45;quote">"400"</span>)</pre></div>


<a name="7.2.3 Views and Templates"><!-- Legacy link --></a>
<h2 id="viewsAndTemplates">7.2.3 ビューとテンプレート</h2>
<div class="hidden-block">Grails also has the concept of templates. These are useful for partitioning your views into maintainable chunks, and combined with <a href="../guide/single.html#layouts" class="guide">Layouts</a> provide a highly re-usable mechanism for structured views.</div>
Grailsもテンプレートの概念を持っています。ビューを管理しやすいかたまりに分類して<a href="../guide/single.html#layouts" class="guide">レイアウト</a>機能で結合する際に活用できます。<p class="paragraph"/><h4>テンプレートの基礎 <div class="hidden-block">Template Basics </div></h4><p class="paragraph"/><div class="hidden-block">Grails uses the convention of placing an underscore before the name of a view to identify it as a template. For example, you might have a template that renders Books located at <code>grails-app/views/book/_bookTemplate.gsp</code>:</div>
Grailsでは、アンダースコアがビュー名称の前にあるとテンプレートとして認識するルールがあります。例として、Bookコントローラからbookを描写するテンプレートは<code>grails-app/views/books/</code>に <code>_bookTemplate.gsp</code>として配置:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;div class=<span class="xml&#45;quote">"book"</span> id=<span class="xml&#45;quote">"$&#123;book?.id&#125;"</span>&#62;</span>
   <span class="xml&#45;tag">&#60;div&#62;</span>Title: $&#123;book?.title&#125;<span class="xml&#45;tag">&#60;/div&#62;</span>
   <span class="xml&#45;tag">&#60;div&#62;</span>Author: $&#123;book?.author?.name&#125;<span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;/div&#62;</span></pre></div><p class="paragraph"/>Use the <a href="../ref/Tags/render.html" class="tags">render</a> tag to render this template from one of the views in <code>grails-app/views/book</code>:
<code>grails-app/views/book</code>の配置したビューで、テンプレートを使用するには、<a href="../ref/Tags/render.html" class="tags">render</a>タグを使います:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:render template=<span class="xml&#45;quote">"bookTemplate"</span> model=<span class="xml&#45;quote">"&#91;book: myBook&#93;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Notice how we pass into a model to use using the <code>model</code> attribute of the <code>render</code> tag. If you have multiple <code>Book</code> instances you can also render the template for each <code>Book</code> using the render tag with a <code>collection</code> attribute:</div>
この例のrenderタグのmodel属性を使用してモデルをテンプレートに渡している部分に注目してください。もし複数の<code>Book</code>インスタンスを使用して、それぞれの<code>Book</code>をテンプレートで描写する場合は、以下のように<code>render</code>タグの<code>collection</code>属性にコレクションを指定します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:render template=<span class="xml&#45;quote">"bookTemplate"</span> var=<span class="xml&#45;quote">"book"</span> collection=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><h4>テンプレートの共有 <div class="hidden-block">Shared Templates </div></h4><p class="paragraph"/><div class="hidden-block">In the previous example we had a template that was specific to the <code>BookController</code> and its views at <code>grails-app/views/book</code>. However, you may want to share templates across your application.</div>
前の例では<code>BookController</code>と<code>grails-app/views/book</code>階層以下のビューを対象に説明しました。テンプレートはアプリケーション全体を通して使用したいと思います。<p class="paragraph"/><div class="hidden-block">In this case you can place them in the root views directory at grails-app/views or any subdirectory below that location, and then with the template attribute use an absolute location starting with <code>/</code> instead of a relative location. For example if you had a template called <code>grails-app/views/shared/_mySharedTemplate.gsp</code>, you would reference it as:</div>
このケースでは、ビューのルートディレクトリである grails-app/views、あるいはルートディレクトのサブディレクトリにテンプレートファイルを配置して、template属性には、<code>/(スラッシュ)</code>から始まる grails-app/viewsからの絶対パスで指定します。例として、テンプレートファイルが、<code>grails-app/views/shared/_mySharedTemplate.gsp</code>だとした場合は次のように指定します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:render template=<span class="xml&#45;quote">"/shared/mySharedTemplate"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">You can also use this technique to reference templates in any directory from any view or controller:</div>
この方法では、どこにテンプレートが配置されていても、どのビューまたはコントローラからでもテンプレートが使用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:render template=<span class="xml&#45;quote">"/book/bookTemplate"</span> model=<span class="xml&#45;quote">"&#91;book: myBook&#93;"</span> /&#62;</span></pre></div><p class="paragraph"/><h4>テンプレートネームスペース <div class="hidden-block">The Template Namespace </div></h4><p class="paragraph"/><div class="hidden-block">Since templates are used so frequently there is template namespace, called <code>tmpl</code>, available that makes using templates easier. Consider for example the following usage pattern:</div>
テンプレートを多用する場合は、テンプレートを簡単に使用するための<code>tmpl</code>という名称の、テンプレートネームスペースが使用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:render template=<span class="xml&#45;quote">"bookTemplate"</span> model=<span class="xml&#45;quote">"&#91;book:myBook&#93;"</span> /&#62;</span></pre></div><p class="paragraph"/>This can be expressed with the <code>tmpl</code> namespace as follows:
上記の例を<code>tmpl</code>ネームスペースで記述すると以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;tmpl:bookTemplate book=<span class="xml&#45;quote">"$&#123;myBook&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><h4>コントローラとタグライブラリでのテンプレート <div class="hidden-block">Templates in Controllers and Tag Libraries </div></h4><p class="paragraph"/><div class="hidden-block">You can also render templates from controllers using the <a href="../ref/Controllers/render.html" class="controllers">render</a> controller method. This is useful for <a href="../guide/single.html#ajax" class="guide">Ajax</a> applications where you generate small HTML or data responses to partially update the current page instead of performing new request:</div>
コントローラの<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドを使用してコントローラでテンプレートを描写することもできます。<a href="../guide/single.html#ajax" class="guide">Ajax</a>アプリケーションのように、ページ内の一部をHTMLのパーツやデータをレスポンスして更新する場合に有用です:<p class="paragraph"/><div class="code"><pre>def bookData() &#123;
    def b = Book.get(params.id)
    render(template:<span class="java&#45;quote">"bookTemplate"</span>, model:&#91;book:b&#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <a href="../ref/Controllers/render.html" class="controllers">render</a> controller method writes directly to the response, which is the most common behaviour. To instead obtain the result of template as a String you can use the <a href="../ref/Tags/render.html" class="tags">render</a> tag:</div>
通常の振る舞いですが、コントローラの<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドは直接結果をレスポンス出力します。文字列としてテンプレートの結果を取得する場合は、<a href="../ref/Tags/render.html" class="tags">render</a>タグを使用できます。:<p class="paragraph"/><div class="code"><pre>def bookData() &#123;
    def b = Book.get(params.id)
    <span class="java&#45;object">String</span> content = g.render(template:<span class="java&#45;quote">"bookTemplate"</span>, model:&#91;book:b&#93;)
    render content
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Notice the usage of the <code>g</code> namespace which tells Grails we want to use the <a href="../guide/single.html#tagsAsMethodCalls" class="guide">tag as method call</a> instead of the <a href="../ref/Controllers/render.html" class="controllers">render</a> method.</div>
ネームスペース<code>g</code>を使用することで<a href="../guide/single.html#tagsAsMethodCalls" class="guide">タグをメソッドとして使用</a>するのか、コントローラの<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドなのかを区別しています。


<a name="7.2.4 Layouts with Sitemesh"><!-- Legacy link --></a>
<h2 id="layouts">7.2.4 Sitemeshでレイアウト</h2>
<h4>レイアウトを作成する <div class="hidden-block">Creating Layouts </div></h4><p class="paragraph"/><div class="hidden-block">Grails leverages <a href="http://www.opensymphony.com/sitemesh/" target="blank">Sitemesh</a>, a decorator engine, to support view layouts. Layouts are located in the <code>grails-app/views/layouts</code> directory. A typical layout can be seen below:</div>
Grailsはデコレータエンジン<a href="http://www.opensymphony.com/sitemesh/" target="blank">Sitemesh</a>の力を借りてビューレイアウトをサポートしています。レイアウトは<code>grails-app/views/layouts</code>ディレクトリに配置します。標準的なレイアウトは以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
    <span class="xml&#45;tag">&#60;head&#62;</span>
        <span class="xml&#45;tag">&#60;title&#62;</span><span class="xml&#45;tag">&#60;g:layoutTitle default=<span class="xml&#45;quote">"An example decorator"</span> /&#62;</span><span class="xml&#45;tag">&#60;/title&#62;</span>
        <span class="xml&#45;tag">&#60;g:layoutHead /&#62;</span>
    <span class="xml&#45;tag">&#60;/head&#62;</span>
    <span class="xml&#45;tag">&#60;body onload=<span class="xml&#45;quote">"$&#123;pageProperty(name:'body.onload')&#125;"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;div class=<span class="xml&#45;quote">"menu"</span>&#62;</span><span class="xml&#45;comment">&#60;!&#45;&#45;my common menu goes here&#45;&#45;&#62;</span><span class="xml&#45;tag">&#60;/menu&#62;</span>
            <span class="xml&#45;tag">&#60;div class=<span class="xml&#45;quote">"body"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;g:layoutBody /&#62;</span>
            <span class="xml&#45;tag">&#60;/div&#62;</span>
        <span class="xml&#45;tag">&#60;/div&#62;</span>
    <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The key elements are the <a href="../ref/Tags/layoutHead.html" class="tags">layoutHead</a>, <a href="../ref/Tags/layoutTitle.html" class="tags">layoutTitle</a> and <a href="../ref/Tags/layoutBody.html" class="tags">layoutBody</a> tag invocations:</div>
鍵となるエレメントは、 <a href="../ref/Tags/layoutHead.html" class="tags">layoutHead</a>、<a href="../ref/Tags/layoutTitle.html" class="tags">layoutTitle</a>、<a href="../ref/Tags/layoutBody.html" class="tags">layoutBody</a>タグです:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>layoutTitle</code> - outputs the target page's title</li>
<li><code>layoutHead</code> - outputs the target page's head tag contents</li>
<li><code>layoutBody</code> - outputs the target page's body tag contents</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>layoutTitle</code> - ページのタイトルを出力</li>
<li><code>layoutHead</code> - ページのheadタグコンテントを出力</li>
<li><code>layoutBody</code> - ページのbodyタグコンテントを出力</li>
</ul><p class="paragraph"/><div class="hidden-block">The previous example also demonstrates the <a href="../ref/Tags/pageProperty.html" class="tags">pageProperty</a> tag which can be used to inspect and return aspects of the target page.</div>
さらに前述した例では、指定した内容をターゲットページから精査して内容を返す<a href="../ref/Tags/pageProperty.html" class="tags">pageProperty</a>タグの紹介しています。<p class="paragraph"/><h4>レイアウトを反映させる <div class="hidden-block">Triggering Layouts </div></h4><p class="paragraph"/><div class="hidden-block">There are a few ways to trigger a layout. The simplest is to add a meta tag to the view:</div>
レイアウトを反映させる幾つかの方法があります。簡単な方法は、ビューにmetaタグを追加するだけです:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
    <span class="xml&#45;tag">&#60;head&#62;</span>
        <span class="xml&#45;tag">&#60;title&#62;</span>An Example Page<span class="xml&#45;tag">&#60;/title&#62;</span>
        <span class="xml&#45;tag">&#60;meta name=<span class="xml&#45;quote">"layout"</span> content=<span class="xml&#45;quote">"main"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;/head&#62;</span>
    <span class="xml&#45;tag">&#60;body&#62;</span>This is my content!<span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">In this case a layout called <code>grails-app/views/layouts/main.gsp</code> will be used to layout the page. If we were to use the layout from the previous section the output would resemble this:</div>
この例では、レイアウトの<code>grails-app/views/layouts/main.gsp</code>が呼び出されてページのレイアウトに使用されます。内容が先ほどのレイアウトの内奥であれば、以下のような出力が得られます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
    <span class="xml&#45;tag">&#60;head&#62;</span>
        <span class="xml&#45;tag">&#60;title&#62;</span>An Example Page<span class="xml&#45;tag">&#60;/title&#62;</span>
    <span class="xml&#45;tag">&#60;/head&#62;</span>
    <span class="xml&#45;tag">&#60;body onload=<span class="xml&#45;quote">""</span>&#62;</span>
        <span class="xml&#45;tag">&#60;div class=<span class="xml&#45;quote">"menu"</span>&#62;</span><span class="xml&#45;comment">&#60;!&#45;&#45;my common menu goes here&#45;&#45;&#62;</span><span class="xml&#45;tag">&#60;/div&#62;</span>
        <span class="xml&#45;tag">&#60;div class=<span class="xml&#45;quote">"body"</span>&#62;</span>
            This is my content!
        <span class="xml&#45;tag">&#60;/div&#62;</span>
    <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><h4>コントローラでレイアウトを指定 <div class="hidden-block">Specifying A Layout In A Controller </div></h4><p class="paragraph"/><div class="hidden-block">Another way to specify a layout is to specify the name of the layout by assigning a value to the "layout" property in a controller. For example, if you have a controller such as:</div>
別の方法として、コントローラに"layout"プロパティの値としてレイアウトする事ができます。例として以下のようなコントローラがあるとしたら:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    <span class="java&#45;keyword">static</span> layout = 'customer'<p class="paragraph"/>    def list() &#123; &#8230; &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can create a layout called <code>grails-app/views/layouts/customer.gsp</code> which will be applied to all views that the <code>BookController</code> delegates to.  The value of the "layout" property may contain a directory structure relative to the <code>grails-app/views/layouts/</code> directory.  For example:</div>
<code>grails-app/views/layouts/customer.gspと</code>いうレイアウトファイルを作成すると、<code>BookController</code>に連動する全てのビューに反映します。
"layout"プロパティの値は<code>grails-app/views/layouts/</code>ディレクトリが含まれます。例として:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    <span class="java&#45;keyword">static</span> layout = 'custom/customer'<p class="paragraph"/>    def list() &#123; &#8230; &#125;
&#125;</pre></div><p class="paragraph"/>Views rendered from that controller would be decorated with the <code>grails-app/views/layouts/custom/customer.gsp</code> template.
この例で、このコントローラのビューは、<code>grails-app/views/layouts/custom/customer.gsp</code>テンプレートでデコレートされます。<p class="paragraph"/><h4>慣習によるレイアウト <div class="hidden-block">Layout by Convention </div></h4><p class="paragraph"/><div class="hidden-block">Another way to associate layouts is to use "layout by convention". For example, if you have this controller:</div>
"慣習によるレイアウト"によってレイアウトと連動することが可能です。例として、次のようなコントローラがあるとします:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def list() &#123; &#8230; &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can create a layout called <code>grails-app/views/layouts/book.gsp</code>, which will be applied to all views that the <code>BookController</code> delegates to.</div>
<code>BookController</code>のビューに反映されるレイアウト<code>grails-app/views/layouts/book.gsp</code>を作成できます。<p class="paragraph"/><div class="hidden-block">Alternatively, you can create a layout called <code>grails-app/views/layouts/book/list.gsp</code> which will only be applied to the <code>list</code> action within the <code>BookController</code>.</div>
あるいは、<code>BookController</code>のアクション<code>list</code>のみに反映するレイアウト<code>grails-app/views/layouts/book/list.gsp</code>を作成できます。<p class="paragraph"/><div class="hidden-block">If you have both the above mentioned layouts in place the layout specific to the action will take precedence when the list action is executed.</div>
両方のレイアウトが存在する場合は、アクションに指定したレイアウトが優先されます。<p class="paragraph"/><div class="hidden-block">If a layout may not be located using any of those conventions, the convention of last resort is to look for the application default layout which
is <code>grails-app/views/layouts/application.gsp</code>.  The name of the application default layout may be changed by defining a property
in <code>grails-app/conf/Config.groovy</code> as follows:</div>
もしこれらの慣習にあわせたレイアウトが存在しない場合は、最終的にデフォルトレイアウトの<code>grails-app/views/layouts/application.gsp</code>を探しに行きます。アプリケーションのデフォルトレイアウト名称は、次のプロパティを<code>grails-app/conf/Config.groovy</code>に定義することで変更が可能です。:<p class="paragraph"/><div class="code"><pre>grails.sitemesh.<span class="java&#45;keyword">default</span>.layout = 'myLayoutName'</pre></div><p class="paragraph"/><div class="hidden-block">With that property in place, the application default layout will be <code>grails-app/views/layouts/myLayoutName.gsp</code>.</div>
この例でのアプリケーションのデフォルトレイアウトは<code>grails-app/views/layouts/myLayoutName.gsp</code>になります。<p class="paragraph"/><h4>インラインレイアウト <div class="hidden-block">Inline Layouts </div></h4><p class="paragraph"/><div class="hidden-block">Grails' also supports Sitemesh's concept of inline layouts with the <a href="../ref/Tags/applyLayout.html" class="tags">applyLayout</a> tag. This can be used to apply a layout to a template, URL or arbitrary section of content. This lets you even further modularize your view structure by "decorating" your template includes.</div>
Grailsでは、<a href="../ref/Tags/applyLayout.html" class="tags">applyLayout</a>タグを使用することでSitemeshのインラインレイアウトをサポートしています。インラインレイアウトでは、テンプレート、URL、任意のコンテントにレイアウトを使用することができます。<p class="paragraph"/><div class="hidden-block">Some examples of usage can be seen below:</div>
例としては以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"myLayout"</span> template=<span class="xml&#45;quote">"bookTemplate"</span> collection=<span class="xml&#45;quote">"$&#123;books&#125;"</span> /&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"myLayout"</span> url=<span class="xml&#45;quote">"http://www.google.com"</span> /&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"myLayout"</span>&#62;</span>
The content to apply a layout to
<span class="xml&#45;tag">&#60;/g:applyLayout&#62;</span></pre></div><p class="paragraph"/><h4>サーバーサイドインクルード <div class="hidden-block">Server-Side Includes </div></h4><p class="paragraph"/><div class="hidden-block">While the <a href="../ref/Tags/applyLayout.html" class="tags">applyLayout</a> tag is useful for applying layouts to external content, if you simply want to include external content in the current page you use the <a href="../ref/Tags/include.html" class="tags">include</a> tag:</div>
<a href="../ref/Tags/applyLayout.html" class="tags">applyLayout</a>タグは、外部コンテントに対してレイアウトを反映させるのに便利ですが、単純に外部コンテンツを現在のページに含みたい場合は<a href="../ref/Tags/include.html" class="tags">include</a>タグが使用できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:include controller=<span class="xml&#45;quote">"book"</span> action=<span class="xml&#45;quote">"list"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">You can even combine the <a href="../ref/Tags/include.html" class="tags">include</a> tag and the <a href="../ref/Tags/applyLayout.html" class="tags">applyLayout</a> tag for added flexibility:</div>
柔軟な対応をするために、<a href="../ref/Tags/applyLayout.html" class="tags">applyLayout</a>タグと<a href="../ref/Tags/include.html" class="tags">include</a>タグを一緒に利用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"myLayout"</span>&#62;</span>
   <span class="xml&#45;tag">&#60;g:include controller=<span class="xml&#45;quote">"book"</span> action=<span class="xml&#45;quote">"list"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/g:applyLayout&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Finally, you can also call the <a href="../ref/Tags/include.html" class="tags">include</a> tag from a controller or tag library as a method:</div>
もちろん、<a href="../ref/Tags/include.html" class="tags">include</a>タグをメソッドとして、コントローラやタグライブラリで使用できます:<p class="paragraph"/><div class="code"><pre>def content = include(controller:<span class="java&#45;quote">"book"</span>, action:<span class="java&#45;quote">"list"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">The resulting content will be provided via the return value of the <a href="../ref/Tags/include.html" class="tags">include</a> tag.</div>
コンテントの結果は、<a href="../ref/Tags/include.html" class="tags">include</a>タグの返値で提供されます。


<a name="7.2.5 Static Resources"><!-- Legacy link --></a>
<h2 id="resources">7.2.5 静的リソース</h2>
<div class="hidden-block">Grails 2.0 integrates with the <a href="http://grails.org/plugin/resources" target="blank">Resources plugin</a> to provide sophisticated static resource management. This plugin is installed by default in new Grails applications.</div>
 2.0から、洗練された静的リソース管理を提供する<a href="http://grails.org/plugin/resources" target="blank">Resourcesプラグイン</a>を統合しています。このプラグインはデフォルトで新規Grailsアプリケーションにインストールされます。<p class="paragraph"/><div class="hidden-block">The basic way to include a link to a static resource in your application is to use the <a href="../ref/Tags/resource.html" class="tags">resource</a> tag. This simple approach creates a URI pointing to the file.</div>
静的リソースのリンクを含む場合、通常<a href="../ref/Tags/resource.html" class="tags">resource</a>タグを使用します。これはURIでファイルを指定する簡単なアプローチになります。<p class="paragraph"/><div class="hidden-block">However modern applications with dependencies on multiple JavaScript and CSS libraries and frameworks (as well as dependencies on multiple Grails plugins) require something more powerful.</div>
しかし近頃のアプリケーションは、様々なJavaScriptやCSSライブラリやフレームワークに依存しており、もっとパワフルな方法が必要となります。<p class="paragraph"/>
<div class="hidden-block">The issues that the Resources framework tackles are:</div>
Resourceフレームワークの取り組んだ課題:
<div class="hidden-block">
<ul class="star">
<li>Web application performance tuning is difficult</li>
<li>Correct ordering of resources, and deferred inclusion of JavaScript</li>
<li>Resources that depend on others that must be loaded first</li>
<li>The need for a standard way to expose static resources in plugins and applications</li>
<li>The need for an extensible processing chain to optimize resources</li>
<li>Preventing multiple inclusion of the same resource</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>Webアプリケーションのパフォーマンスチューニングが難しい</li>
<li>リソースの配置順と、JavaScriptの遅延包括</li>
<li>先に読み込む必要のある依存関係のあるリソース</li>
<li>プラグインやアプリケーションでの、静的リソースを表示する方法の標準化が必要</li>
<li>リソースの最適化を行うための拡張可能な連鎖行程が必要</li>
<li>同じリソースの多重配置を防ぐ</li>
</ul><p class="paragraph"/><div class="hidden-block">The plugin achieves this by introducing new artefacts and processing the resources using the server's local file system.</div>
プラグインでアーテファクトの提供と、サーバのローカルファイルシステムを使用して処理をすることで、これらを達成しています。<p class="paragraph"/><div class="hidden-block">It adds artefacts for declaring resources, for declaring "mappers" that can process resources, and a servlet filter to serve processed resources.</div>
プラグインは、リソースを宣言するためのアーテファクト、リソースを処理する"マッパー"、処理されたリソースを提供するサーブレットフィルタを追加します。<p class="paragraph"/><div class="hidden-block">What you get is an incredibly advanced resource system that enables you to easily create highly optimized web applications that run the same in development and in production.</div>
信じられないほど上級のリソースシステムが、簡単に高度に最適化されたWebアプリケーション作成をdevelpoment,productionモード共に可能とします。<p class="paragraph"/><div class="hidden-block">The Resources plugin documentation provides a more detailed overview of the <a href="http://grails-plugins.github.com/grails-resources/" target="blank">concepts</a> which will be beneficial when reading the following guide.</div>
リソースプラグインの<a href="http://grails-plugins.github.com/grails-resources/" target="blank">ドキュメント</a>では、さらに詳細な内容を提供しています。


<a name="7.2.5.1 Including resources using the resource tags"><!-- Legacy link --></a>
<h2 id="includingResourcesUsingTheResourceTags">7.2.5.1 リソースタグでのリソースの使用</h2>
<h4>r:requireでリソースを制御する <div class="hidden-block">Pulling in resources with r:require</div></h4><p class="paragraph"/><div class="hidden-block">To use resources, your GSP page must indicate which resource modules it requires. For example with the <a href="http://grails.org/plugin/jquery" target="blank">jQuery plugin</a>, which exposes a "jquery" resource module, to use jQuery in any page on your site you simply add:</div>
リソースを使用するにはどのリソースモジュールが必要がGSPページで示す必要があります。例として、"jquery"リソースモジュールを提供している<a href="http://grails.org/plugin/jquery" target="blank">jQueryプラグイン</a>を、サイトの全てのページで使用する場合は単に次のように追加するだけです:<p class="paragraph"/>
<div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;head&#62;</span>
      <span class="xml&#45;tag">&#60;r:require module=<span class="xml&#45;quote">"jquery"</span>/&#62;</span>
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/head&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      &#8230;
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This will automatically include all resources needed for jQuery, including them at the correct locations in the page. By default the plugin sets the disposition to be "head", so they load early in the page.</div>
これで自動的にjQueryで必要なリソースをページの正確な場所に配置します。デフォルトではプラグインが"head"に配置するので、ページの初めの方でロードされます。<p class="paragraph"/><div class="hidden-block">You can call <code>r:require</code> multiple times in a GSP page, and you use the "modules" attribute to provide a list of modules:</div>
GSPページで<code>r:require</code>を複数回呼んでも構いません。そして"modules"属性を使用してモジュールを列挙することもできます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;head&#62;</span>
      <span class="xml&#45;tag">&#60;r:require modules=<span class="xml&#45;quote">"jquery, main, blueprint, charting"</span>/&#62;</span>
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/head&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      &#8230;
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The above may result in many JavaScript and CSS files being included, in the correct order, with some JavaScript files loading at the end of the body to improve the apparent page load time.</div>
上記の結果は、多くのJavaScriptとCSSファイルが正確な順番に、そして一部のJavaScriptはページ読み込み時間を向上させるために、ページボディの最後にロードされるようにページに含まれます。<p class="paragraph"/><div class="hidden-block">However you cannot use r:require in isolation - as per the examples you must have the &#60;r:layoutResources/&#62; tag to actually perform the render.</div>
r:requireは単体で使用することはできません。例にあるように実際に描写を行う<code>&#60;r:layoutResources/&#62;</code>タグが必要になります。<p class="paragraph"/><h4>r:layoutResourcesでリソースへのリンクを描写する <div class="hidden-block">Rendering the links to resources with r:layoutResources </div></h4><p class="paragraph"/><div class="hidden-block">When you have declared the resource modules that your GSP page requires, the framework needs to render the links to those resources at the correct time.</div>
GSPページに必要なリソースモジュールを宣言すると、フレームワークは正常なタイミングでリソースへのリンクを描写する必要があります。<p class="paragraph"/><div class="hidden-block">To achieve this correctly, you must include the r:layoutResources tag twice in your page, or more commonly, in your GSP layout:</div>
これを正常に行うには、r:layoutResourcesタグをページまたはGSPレイアウトの２ヶ所に配置します。:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;head&#62;</span>
      <span class="xml&#45;tag">&#60;g:layoutTitle/&#62;</span>
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/head&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      <span class="xml&#45;tag">&#60;g:layoutBody/&#62;</span>
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This represents the simplest Sitemesh layout you can have that supports Resources.</div>
これはリソースフレームワークに対応した、いちばん単純なSitemeshレイアウトの例です。<p class="paragraph"/><div class="hidden-block">The Resources framework has the concept of a "disposition" for every resource. This is an indication of where in the page the resource should be included.</div>
リソースフレームワークには全てのリソースに"配置"の概念を持っています。ページのどの部分にリソースを含めるべきかを指示する物です。<p class="paragraph"/><div class="hidden-block">The default disposition applied depends on the type of resource. All CSS must be rendered in &#60;head&#62; in HTML, so "head" is the default for all CSS, and will be rendered by the first r:layoutResources. Page load times are improved when JavaScript is loaded after the page content, so the default for JavaScript files is "defer", which means it is rendered when the second r:layoutResources is invoked.</div>
基本的な配置はリソースの種類によって適用されます。全てのCSSはHTMLの&#60;head&#62;に描写されるべきです。したがって全てのCSSは、デフォルトで最初のr:layoutResourcesによって"head"に描写されます。JavaScriptはページコンテンツの最後に読み込ませてJavaScriptファイルの実行を遅らせることで("defer")、ページのロード時間が向上されます。したがって２つ目のr:layoutResourcesが実行された時に描写されます。<p class="paragraph"/><div class="hidden-block">Note that both your GSP page and your Sitemesh layout (as well as any GSP template fragments) can call r:require to depend on resources. The only limitation is that you must call r:require before the r:layoutResources that should render it.</div>
GSPページとSItemeshレイアウト両方で(もちろんGSPテンプレートでも)、リソースに依存するr:requireを呼び出す事ができます。唯一の制約として、内容を描写するr:layoutResourcesの前に必ずr:requireを呼び出す必要があります。<p class="paragraph"/>
<h4>r:scriptでページ固有のJavaScriptコードを追加 <div class="hidden-block">Adding page-specific JavaScript code with r:script </div></h4><p class="paragraph"/><div class="hidden-block">Grails has the <a href="../ref/Tags/javascript.html" class="tags">javascript</a> tag which is adapted to defer to Resources plugin if installed, but it is recommended that you call <code>r:script</code> directly when you need to include fragments of JavaScript code.</div>
Grailsにはリソースプラグインがインストールされている場合には、リソースプラグインに従う<a href="../ref/Tags/javascript.html" class="tags">javascript</a>タグがありますが、JavaScriptコードを含みたい場合は、直接<code>r:script</code>を呼ぶことを推奨します。<p class="paragraph"/><div class="hidden-block">This lets you write some "inline" JavaScript which is actually <strong class="bold">not</strong> rendered inline, but either in the &#60;head&#62; or at the end of the body, based on the disposition.</div>
これはJavaScriptをインラインで記述できて描写はインラインでは無く、配置指定をした&#60;head&#62;またはボディの最後に描写されます。<p class="paragraph"/><div class="hidden-block">Given a Sitemesh layout like this:</div>
このようなSitemeshレイアウトがあるとします:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;head&#62;</span>
      <span class="xml&#45;tag">&#60;g:layoutTitle/&#62;</span>
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/head&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      <span class="xml&#45;tag">&#60;g:layoutBody/&#62;</span>
      <span class="xml&#45;tag">&#60;r:layoutResources/&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">...in your GSP you can inject some JavaScript code into the head or deferred regions of the page like this:</div>
GSPではJavaScriptコードをヘッドまたページの最後の方に以下のように記述します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;head&#62;</span>
      <span class="xml&#45;tag">&#60;title&#62;</span>Testing r:script magic!<span class="xml&#45;tag">&#60;/title&#62;</span>
   <span class="xml&#45;tag">&#60;/head&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      <span class="xml&#45;tag">&#60;r:script disposition=<span class="xml&#45;quote">"head"</span>&#62;</span>
         window.alert('This is at the end of <span class="xml&#45;tag">&#60;head&#62;</span>');
      <span class="xml&#45;tag">&#60;/r:script&#62;</span>
      <span class="xml&#45;tag">&#60;r:script disposition=<span class="xml&#45;quote">"defer"</span>&#62;</span>
         window.alert('This is at the end of the body, and the page has loaded.');
      <span class="xml&#45;tag">&#60;/r:script&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The default disposition is "defer", so the disposition in the latter r:script is purely included for demonstration.</div>
disposition属性のデフォルトは"defer"になります。従って後者のr:scriptはここでの説明として定義しているだけです。<p class="paragraph"/><div class="hidden-block">Note that such r:script code fragments <strong class="bold">always</strong> load after any modules that you have used, to ensure that any required libraries have loaded.</div>
 r:scripのコードブロックは、必要なライブラリがロードされているのを保証するために、常に指定したモジュールの後に読み込まれます。<p class="paragraph"/><h4>r:imgで画像へのリンク <div class="hidden-block">Linking to images with r:img </div></h4><p class="paragraph"/><div class="hidden-block">This tag is used to render <code>&#60;img&#62;</code> markup, using the Resources framework to process the resource on the fly (if configured to do so - e.g. make it eternally cacheable).</div>
このタグは、リソースフレームワークを使用してリソースを処理した、&#60;img&#62;タグを描写するのに使用します。(定義をした場合。e.g.画像キャッシュ等)<p class="paragraph"/><div class="hidden-block">This includes any extra attributes on the <code>&#60;img&#62;</code> tag if the resource has been previously declared in a module.</div>
あらかじめリソースモジュール宣言されたタグの属性も<code>&#60;img&#62;</code>タグの属性に追加します。<p class="paragraph"/><div class="hidden-block">With this mechanism you can specify the width, height and any other attributes in the resource declaration in the module, and they will be pulled in as necessary.</div>
この仕組みでは、モジュールに宣言した、width,heightまたその他の属性をタグに取り込みます。<p class="paragraph"/><div class="hidden-block">Example:</div>
例として:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
   <span class="xml&#45;tag">&#60;head&#62;</span>
      <span class="xml&#45;tag">&#60;title&#62;</span>Testing r:img<span class="xml&#45;tag">&#60;/title&#62;</span>
   <span class="xml&#45;tag">&#60;/head&#62;</span>
   <span class="xml&#45;tag">&#60;body&#62;</span>
      <span class="xml&#45;tag">&#60;r:img uri=<span class="xml&#45;quote">"/images/logo.png"</span>/&#62;</span>
   <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Note that Grails has a built-in <code>g:img</code> tag as a shortcut for rendering <code>&#60;img&#62;</code> tags that refer to a static resource. The Grails <a href="../ref/Tags/img.html" class="tags">img</a> tag is Resources-aware and will delegate to <code>r:img</code> if found. However it is recommended that you use <code>r:img</code> directly if using the Resources plugin.</div>
Grailsには、<code>&#60;img&#62;</code>タグを描写する、リソース参照できる<code>g:img</code>タグが存在します。Grailsの<a href="../ref/Tags/img.html" class="tags">img</a>タグは、存在した場合リソースフレームワークが認識して<code>r:img</code>に委譲しますが、リソースプラグインを使用している場合は直接<code>r:img</code>を使用することを推奨します。<p class="paragraph"/><div class="hidden-block">Alongside the regular Grails <a href="../ref/Tags/resource.html" class="tags">resource</a> tag attributes, this also supports the "uri" attribute for increased brevity.</div>
通常のGrails <a href="../ref/Tags/img.html" class="tags">img</a>タグと一緒で、簡潔に記述できる"uri"属性にも対応しています。<p class="paragraph"/><div class="hidden-block">See <a href="http://grails-plugins.github.com/grails-resources" target="blank">r:resource documentation</a> for full details.</div>
詳細は<a href="http://grails-plugins.github.com/grails-resources" target="blank">Resources</a>プラグインのドキュメントを参照。

<a name="7.2.5.2 Other resource tags"><!-- Legacy link --></a>
<h2 id="otherResourceTags">7.2.5.2 他のリソースタグ</h2>
<h4>r:resource</h4><p class="paragraph"/><div class="hidden-block">This is equivalent to the Grails <a href="../ref/Tags/resource.html" class="Tags">resource</a> tag, returning a link to the processed static resource. Grails' own <code>g:resource</code> tag delegates to this implementation if found, but if your code requires the Resources plugin, you should use <code>r:resource</code> directly.</div>
これはGrails <a href="../ref/Tags/resource.html" class="Tags">resource</a>タグと同じで静的リソースへのリンクを処理して返します。Grailsの<code>g:resource</code>タグが有った場合はこのタグに委譲します。リソースプラグインを使用している場合は直接<code>r:resource</code>を使用しましょう。<p class="paragraph"/><div class="hidden-block">Alongside the regular Grails <a href="../ref/Tags/resource.html" class="Tags">resource</a> tag attributes, this also supports the "uri" attribute for increased brevity.</div>
通常のGrails <a href="../ref/Tags/resource.html" class="Tags">resource</a>タグと一緒で、簡潔に記述できる"uri"属性にも対応しています。<p class="paragraph"/>
<div class="hidden-block">See <a href="http://grails-plugins.github.com/grails-resources" target="blank">r:resource documentation</a> for full details.</div>
詳細は<a href="http://grails-plugins.github.com/grails-resources" target="blank">Resources</a>プラグインのドキュメントを参照。<p class="paragraph"/><h4>r:external</h4><p class="paragraph"/><div class="hidden-block">This is a resource-aware version of Grails <a href="../ref/Tags/external.html" class="Tags">external</a> tag which renders the HTML markup necessary to include an external file resource such as CSS, JS or a favicon.</div>
Grailsでの<a href="../ref/Tags/external.html" class="Tags">external</a>タグのリソースフレームワーク版です。CSS,JS,favicon等の外部リソースを含む為のHTMLマークアップを描写します。<p class="paragraph"/><div class="hidden-block">See <a href="http://grails-plugins.github.com/grails-resources" target="blank">r:resource documentation</a> for full details.</div>
詳細は<a href="http://grails-plugins.github.com/grails-resources" target="blank">Resources</a>プラグインのドキュメントを参照。

<a name="7.2.5.3 Declaring resources"><!-- Legacy link --></a>
<h2 id="declaringResources">7.2.5.3 リソースの宣言</h2>
<div class="hidden-block">A DSL is provided for declaring resources and modules. This can go either in your <code>Config.groovy</code> in the case of application-specific resources, or more commonly in a resources artefact in <code>grails-app/conf</code>.</div>
リソースとモジュールを宣言するためのDSLが提供されています。アプリケーション固有の場合は<code>Config.groovy</code>ファイルに記述、また通常はリソースアーテファクトとして<code>grails-app/conf</code>にファイルで配置します。<p class="paragraph"/><div class="hidden-block">Note that you do not need to declare all your static resources, especially images. However you must to establish dependencies or other resources-specific attributes. Any resource that is not declared is called "ad-hoc" and will still be processed using defaults for that resource type.</div>
特に画像に関しては、全ての静的リソースを宣言する必要はありませんが、依存関係またはリソース固有の属性を確立する必要があります。宣言されていないリソースは"ad-hoc"とよばれ、リソースの種類に対応した処理が行われます。<p class="paragraph"/><div class="hidden-block">Consider this example resource configuration file, <code>grails-app/conf/MyAppResources.groovy</code>:</div>
次のようなリソース定義が<code>grails-app/conf/MyAppResources.groovy</code>ファイルで例として有るとします:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'<p class="paragraph"/>        resource url: '/js/core.js', disposition: 'head'
        resource url: '/js/ui.js'
        resource url: '/css/main.css',
        resource url: '/css/branding.css'
        resource url: '/css/print.css', attrs: &#91;media: 'print'&#93;
    &#125;<p class="paragraph"/>    utils &#123;
        dependsOn 'jquery'<p class="paragraph"/>        resource url: '/js/utils.js'
    &#125;<p class="paragraph"/>    forms &#123;
        dependsOn 'core,utils'<p class="paragraph"/>        resource url: '/css/forms.css'
        resource url: '/js/forms.js'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This defines three resource modules; 'core', 'utils' and 'forms'. The resources in these modules will be automatically bundled out of the box according to the module name, resulting in fewer files. You can override this with <code>bundle:'someOtherName'</code> on each resource, or call <code>defaultBundle</code> on the module (see <a href="http://grails-plugins.github.com/grails-resources" target="blank">resources plugin documentation</a>).</div>
ここでは'core','utils','forms'の３つのリソースモジュールを定義しています。このモジュールのリソースは、モジュール名に応じて、すぐに使えるように、より少ないファイルに自動的にバンドルされます。それぞれのリソースは<code>bundle:'someOtherName'</code>またはモジュールで<code>defaultBundle</code>を呼ぶことででオーバーライドできます。(<a href="http://grails-plugins.github.com/grails-resources" target="blank">Resourcesプラグイン</a>ドキュメントを参照)<p class="paragraph"/><div class="hidden-block">It declares dependencies between them using <code>dependsOn</code>, which controls the load order of the resources.</div>
リソースの読み込み順を操作するために、それぞれの依存関係を<code>dependsOn</code>で宣言しています。<p class="paragraph"/><div class="hidden-block">When you include an <code>&#60;r:require module="forms"/&#62;</code> in your GSP, it will pull in all the resources from 'core' and 'utils' as well as 'jquery', all in the correct order.</div>
GSPに<code>&#60;r:require module="forms"/&#62;</code>を含んだ場合、この例では'core','util'そして'jquery'のリソースを正常な順番で引っ張ります。<p class="paragraph"/><div class="hidden-block">You'll also notice the <code>disposition:'head'</code> on the <code>core.js</code> file. This tells Resources that while it can defer all the other JS files to the end of the body, this one must go into the <code>&#60;head&#62;</code>.</div>
さらにcore.jsファイルの<code>disposition:'head'</code>に注目してください。その他全てのリソースはボディの最後に配置して、このファイルは必ず<code>&#60;head&#62;</code>に配置する指定をしています。<p class="paragraph"/><div class="hidden-block">The CSS file for print styling adds custom attributes using the <code>attrs</code> map option, and these are passed through to the <code>r:external</code> tag when the engine renders the link to the resource, so you can customize the HTML attributes of the generated link.</div>
プリント指定用のCSSでは、カスタム属性を<code>attrs</code>マップで追加しています。そしてこれらは<code>r:external</code>タグを通してリソースへのリンクを形成します。これによってリンクのHTML属性をカスタマイズすることができます。<p class="paragraph"/><div class="hidden-block">There is no limit to the number of modules or xxxResources.groovy artefacts you can provide, and plugins can supply them to expose modules to applications, which is exactly how the jQuery plugin works.</div>
モジュールやxxxResources.groovyアーテファクトには数量制限がありません。jQueryプラグインのようにプラグインでモジュールを提供することもできます。<p class="paragraph"/><div class="hidden-block">To define modules like this in your application's Config.groovy, you simply assign the DSL closure to the <code>grails.resources.modules</code> Config variable.</div>
アプリケーションのConfig.groovyでモジュールを宣言する場合は、モジュールのDSLクロージャを<code>grails.resources.modules</code>に定義します。<p class="paragraph"/><div class="hidden-block">For full details of the resource DSL please see the <a href="http://grails-plugins.github.com/grails-resources" target="blank">resources plugin documentation</a>.</div>
リソースDSLの詳細は<a href="http://grails-plugins.github.com/grails-resources" target="blank">Resourcesプラグイン</a>のドキュメントを参考にしてください。


<a name="7.2.5.4 Overriding plugin resources"><!-- Legacy link --></a>
<h2 id="overridingPluginResources">7.2.5.4 プラグインリソースのオーバーライド</h2>
<div class="hidden-block">Because a resource module can define the bundle groupings and other attributes of resources, you may find that the settings provided are not correct for your application.</div>
リソースモジュールにバンドルのグルーピングと他のリソース属性の宣言ができることで、提供されている設定が個々のアプリケーションで違う場合が有るのを認識します。<p class="paragraph"/><div class="hidden-block">For example, you may wish to bundle jQuery and some other libraries all together in one file. There is a load-time and caching trade-off here, but often it is the case that you'd like to override some of these settings.</div>
例として、jQueryと他のライブラリをまとめてバンドルするとします。これだとロード時間とキャッシングのトレードオフになりますが、しかし良くあるケースとしてこれらの設定をオーバーライドするとします。<p class="paragraph"/><div class="hidden-block">To do this, the DSL supports an "overrides" clause, within which you can change the <code>defaultBundle</code> setting for a module, or attributes of individual resources that have been declared with a unique id:</div>
これには、モジュールまたは固有のリソース属性で変更可能な<code>defaultBundle</code>設定で定義した名称を指定する、DSLの"overrides"で対応しています。<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'
        defaultBundle 'monolith'<p class="paragraph"/>        resource url: '/js/core.js', disposition: 'head'
        resource url: '/js/ui.js'
        resource url: '/css/main.css',
        resource url: '/css/branding.css'
        resource url: '/css/print.css', attrs: &#91;media: 'print'&#93;
    &#125;<p class="paragraph"/>    utils &#123;
        dependsOn 'jquery'
        defaultBundle 'monolith'<p class="paragraph"/>        resource url: '/js/utils.js'
    &#125;<p class="paragraph"/>    forms &#123;
        dependsOn 'core,utils'
        defaultBundle 'monolith'<p class="paragraph"/>        resource url: '/css/forms.css'
        resource url: '/js/forms.js'
    &#125;<p class="paragraph"/>    overrides &#123;
        jquery &#123;
            defaultBundle 'monolith'
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will put all code into a single bundle named 'monolith'. Note that this can still result in multiple files, as separate bundles are required for head and defer dispositions, and JavaScript and CSS files are bundled separately.</div>
この設定で全てのコードが'monolith'という名称の一つのバンドルになります。この設定を行ってもそれぞれのバンドルとしてそれぞれのファイルで配置されます。<p class="paragraph"/><div class="hidden-block">Note that overriding individual resources requires the original declaration to have included a unique id for the resource.</div>
固有のリソースをオーバライドする場合は、もとの宣言がリソース毎にユニークIDで含まれている必要があります。<p class="paragraph"/>For full details of the resource DSL please see the <a href="http://grails-plugins.github.com/grails-resources" target="blank">resources plugin documentation</a>.
リソースDSLの詳細は<a href="http://grails-plugins.github.com/grails-resources" target="blank">リソースプラグイン</a>のドキュメントを参考にしてください。

<a name="7.2.5.5 Optimizing your resources"><!-- Legacy link --></a>
<h2 id="optimizingYourResources">7.2.5.5 リソースの最適化</h2>
<div class="hidden-block">The Resources framework uses "mappers" to mutate the resources into the final format served to the user.</div>
リソースフレームワークは"マッパー"を使用して、最終フォーマットへリソースを変化させてユーザへ配信します。<p class="paragraph"/><div class="hidden-block">The resource mappers are applied to each static resource once, in a specific order. You can create your own resource mappers, and several plugins provide some already for zipping, caching and minifying.</div>
リソースマッパーはそれぞれの静的リソースに一度だけ特定の順番で適用されます。幾つかのプラグインzipping, caching や minifyingのように独自のリソースマッパーを作成することが可能です。<p class="paragraph"/><div class="hidden-block">Out of the box, the Resources plugin provides bundling of resources into fewer files, which is achieved with a few mappers that also perform CSS re-writing to handle when your CSS files are moved into a bundle.</div>
すぐに使用できる仕組みとして、リソースをまとめて少なくするバンドルマッパーをResourcesプラグインで提供しています。<p class="paragraph"/><h4>複数のリソースを少ないファイルにまとめる <div class="hidden-block">Bundling multiple resources into fewer files </div></h4><p class="paragraph"/><div class="hidden-block">The 'bundle' mapper operates by default on any resource with a "bundle" defined - or inherited from a <code>defaultBundle</code> clause on the module. Modules have an implicit default bundle name the same as the name of the module.</div>
バンドルマッパーは、"bundle"が定義されたリソース、またはモジュールの<code>defaultBundle</code>に継承されたリソースに対してデフォルトで操作します。モジュールはモジュール名と同じ名称で、暗黙なデフォルトバンドル名を持っています。<p class="paragraph"/><div class="hidden-block">Files of the same kind will be aggregated into this bundle file. Bundles operate across module boundaries:</div>
同じ種類のファイルがこのバンドルに集計されます。バンドルはモジュールにわたって操作されます:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'
        defaultBundle 'common'<p class="paragraph"/>        resource url: '/js/core.js', disposition: 'head'
        resource url: '/js/ui.js', bundle: 'ui'
        resource url: '/css/main.css', bundle: 'theme'
        resource url: '/css/branding.css'
        resource url: '/css/print.css', attrs: &#91;media: 'print'&#93;
    &#125;<p class="paragraph"/>    utils &#123;
        dependsOn 'jquery'<p class="paragraph"/>        resource url: '/js/utils.js', bundle: 'common'
    &#125;<p class="paragraph"/>    forms &#123;
        dependsOn 'core,utils'<p class="paragraph"/>        resource url: '/css/forms.css', bundle: 'ui'
        resource url: '/js/forms.js', bundle: 'ui'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here you see that resources are grouped into bundles; 'common', 'ui' and 'theme' - across module boundaries.</div>
この例でモジュールにわたって、リソースは'common','ui','theme'のグループにまとめられます。<p class="paragraph"/><div class="hidden-block">Note that auto-bundling by module does <strong class="bold">not</strong> occur if there is only one resource in the module.</div>
もしモジュールにリソースが１つの場合は、自動バンドリング処理は行われません。<p class="paragraph"/><h4>クライアントのブラウザでリソースを"永久的に"キャッシュさせる <div class="hidden-block">Making resources cache "eternally" in the client browser </div></h4><p class="paragraph"/><div class="hidden-block">Caching resources "eternally" in the client is only viable if the resource has a unique name that changes whenever the contents change, and requires caching headers to be set on the response.</div>
リソースを"永久的に"キャッシュさせるには、コンテンツが変わらない限り唯一のリソース名を持ち、キャッシングヘッダーがレスポンスにセットされている時のみです。<p class="paragraph"/><div class="hidden-block">The <a href="http://grails.org/plugin/cached-resources" target="blank">cached-resources</a> plugin provides a mapper that achieves this by hashing your files and renaming them based on this hash. It also sets the caching headers on every response for those resources. To use, simply install the cached-resources plugin.</div>
<a href="http://grails.org/plugin/cached-resources" target="blank">cached-resources</a>プラグインでは、ファイルをハッシュ管理してハッシュ管理に基づいて名称を変更するマッパーを提供しています。さらにキャッシングヘッダーを全てのリソースのレスポンスにセットします。これを使用するには単にcached-resourcesをインストールするだけです。<p class="paragraph"/><div class="hidden-block">Note that the caching headers can only be set if your resources are being served by your application. If you have another server serving the static content from your app (e.g. Apache HTTPD), configure it to send caching headers. Alternatively you can configure it to request and proxy the resources from your container.</div>
キャッシングヘッダーはリソースがアプリケーションから配信されたときのみセットされます。もし別のサーバで静的コンテンツを配信している場合は(Apache HTTPD等で)、サーバでそれらのキャッシングヘッダーの定義を行ってください。あるいはリソースをアプリケーションコンテナーを介して配信するように設定も可能です。<p class="paragraph"/><h4>リソース(Zip)圧縮 <div class="hidden-block">Zipping resources </div></h4><p class="paragraph"/><div class="hidden-block">Returning gzipped resources is another way to reduce page load times and reduce bandwidth.</div>
ページロード時間と帯域を減らす別の方法として、gzipしたリソースを返すことができます。<p class="paragraph"/><div class="hidden-block">The <a href="http://grails.org/plugin/zipped-resources" target="blank">zipped-resources</a> plugin provides a mapper that automatically compresses your content, excluding by default already compressed formats such as gif, jpeg and png.</div>
<a href="http://grails.org/plugin/zipped-resources" target="blank">zipped-resources</a>プラグインは、デフォルトで圧縮されている画像等を除いたコンテンツを自動的に圧縮するマッパーを提供しています。<p class="paragraph"/><div class="hidden-block">Simply install the zipped-resources plugin and it works.</div>
単にzipped-resourcesプラグインをインストールするだけで使用できます。<p class="paragraph"/><h4>最小化(Minifying) <div class="hidden-block">Minifying </div></h4><p class="paragraph"/><div class="hidden-block">There are a number of CSS and JavaScript minifiers available to obfuscate and reduce the size of your code. At the time of writing none are publicly released but releases are imminent.</div>
最小化してコード内容をわかりにくくしたりサイズを縮小する幾つかのCSSとJavascript minifierが有ります。現段階ではプラグインの提供は無いですが近々リリースされると思います。


<a name="7.2.5.6 Debugging"><!-- Legacy link --></a>
<h2 id="debugging">7.2.5.6 デバッグ</h2>
<div class="hidden-block">When your resources are being moved around, renamed and otherwise mutated, it can be hard to debug client-side issues. Modern browsers, especially Safari, Chrome and Firefox have excellent tools that let you view all the resources requested by a page, including the headers and other information about them.</div>
リソースが、リソースフレームワークにより、動き回り、名称変更されたり、変更されるとクライアントサイドのデバッグが大変になります。最近のブラウザSafari,Chrome,Firefoxには、リクエストでのページの全てのリソースやヘッダーやその他の情報が閲覧できる優秀なツールがあります。<p class="paragraph"/><div class="hidden-block">There are several debugging features built in to the Resources framework.</div>
リソースフレームワークには、幾つかのデバッグ時に使用する機能を持ち合わせています。<p class="paragraph"/><h4>X-Grails-Resources-Original-Srcヘッダー <div class="hidden-block">X-Grails-Resources-Original-Src Header </div></h4><p class="paragraph"/><div class="hidden-block">Every resource served in development mode will have the X-Grails-Resources-Original-Src: header added, indicating the original source file(s) that make up the response.</div>
開発(development)モードでのリソースには、レスポンスを構成した元のリソースファイルを示す、X-Grails-Resources-Original-Src:ヘッダーが追加されています。<p class="paragraph"/><h4>デバッグフラグを追加 <div class="hidden-block">Adding the debug flag </div></h4><p class="paragraph"/><div class="hidden-block">If you add a query parameter <strong class="bold">_debugResources=y</strong> to your URL and request the page, Resources will bypass any processing so that you can see your original source files.</div>
クエリパラメータ <strong class="bold">_debugResources=y</strong> をURLに追加してページをリクエストすると、Resourcesプラグインはバイパスされて元のソースファイルを見ることができます。<p class="paragraph"/><div class="hidden-block">This also adds a unique timestamp to all your resource URLs, to defeat any caching that browsers may use. This means that you should always see your very latest code when you reload the page.</div>
さらにこの機能では、ユニークなタイムスタンプを全てのリソースに追加することでブラウザにキャッシュされるのを阻止します。したがってページをリロードするたびに最新のコードを参照することになります。<p class="paragraph"/><h4>常にデバッグを有効にする <div class="hidden-block">Turning on debug all the time </div></h4><p class="paragraph"/><div class="hidden-block">You can turn on the aforementioned debug mechanism without requiring a query parameter, but turning it on in Config.groovy:</div>
前途したデバッグ機能をクエリパラメータ無しで有効にするには、以下のようにConfig.groovyで設定します:<p class="paragraph"/><div class="code"><pre>grails.resources.debug = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">You can of course set this per-environment.</div>
もちろんこの設定は環境ごとに定義できます。


<a name="7.2.5.7 Preventing processing of resources"><!-- Legacy link --></a>
<h2 id="preventingProcessingOfResources">7.2.5.7 リソース生成・変換処理を防ぐ</h2>
<div class="hidden-block">Sometimes you do not want a resource to be processed in a particular way, or even at all. Occasionally you may also want to disable all resource mapping.</div>
特定のリソースだけ変換処理を行わない事もあります。時折リソースマッピングを無効にしたいこともあります。<p class="paragraph"/><h4>個々のリソースの特定のマッパー処理を防ぐ <div class="hidden-block">Preventing the application of a specific mapper to an individual resource </div></h4><p class="paragraph"/><div class="hidden-block">All resource declarations support a convention of noXXXX:true where XXXX is a mapper name.</div>
全てのリソース宣言では、XXXXがマッパー名称とすると、noXXXX:trueのような規約に対応しています。<p class="paragraph"/><div class="hidden-block">So for example to prevent the "hashandcache" mapper from being applied to a resource (which renames and moves it, potentially breaking relative links written in JavaScript code), you would do this:</div>
例として、リソースに適用される"hashandcache"マッパーの処理を防ぐ場合は:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    forms &#123;
        resource url: '/css/forms.css', nohashandcache: <span class="java&#45;keyword">true</span>
        resource url: '/js/forms.js', nohashandcache: <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>特定のマッパーでの、パス、ファイルタイプの除外と包含 <div class="hidden-block">Excluding/including paths and file types from specific mappers </div></h4><p class="paragraph"/><div class="hidden-block">Mappers have includes/excludes Ant patterns to control whether they apply to a given resource. Mappers set sensible defaults for these based on their activity, for example the zipped-resources plugin's "zip" mapper is set to exclude images by default.</div>
マッパーには、Antパターンで対象リソースを制御するincludes/excludes定義があります。各マッパーはそれぞれの動作に対応したふさわしいデフォルトをセットしています。例としてzipped-resourcesプラグインの"zip"マッパーはデフォルトで画像を除外する設定をしています。<p class="paragraph"/><div class="hidden-block">You can configure this in your <code>Config.groovy</code> using the mapper name e.g:</div>
<code>Config.groovy</code>にマッパー名で定義することができます:<p class="paragraph"/><div class="code"><pre>// We wouldn't link to .exe files using Resources but <span class="java&#45;keyword">for</span> the sake of example:
grails.resources.zip.excludes = &#91;'&#42;&#42;/&#42;.zip', '&#42;&#42;/&#42;.exe'&#93;<p class="paragraph"/>// Perhaps <span class="java&#45;keyword">for</span> some reason we want to prevent bundling on <span class="java&#45;quote">"less"</span> CSS files:
grails.resources.bundle.excludes = &#91;'&#42;&#42;/&#42;.less'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">There is also an "includes" inverse. Note that settings these replaces the default includes/excludes for that mapper - it is not additive.</div>
逆の意味の"includes"も使用できます。設定をするとマッパーデフォルトのincludes/excludesを入れ換えるので注意が必要です。<p class="paragraph"/><h4>"ad-hoc"(レガシー)リソースとして扱う物の操作 <div class="hidden-block">Controlling what is treated as an "ad-hoc" (legacy) resource </div></h4><p class="paragraph"/><div class="hidden-block">Ad-hoc resources are those undeclared, but linked to directly in your application <strong class="bold">without</strong> using the Grails or Resources linking tags (resource, img or external).</div>
"ad-hoc"リソースは、宣言されずGrailsまたResourcesのリンク系タグを使用しないで、直接アプリケーションにリンクされているリソースです。<p class="paragraph"/><div class="hidden-block">These may occur with some legacy plugins or code with hardcoded paths in.</div>
古い方式のプラグインやパスがコードに埋め込まれている場合をさします。<p class="paragraph"/><div class="hidden-block">There is a Config.groovy setting <strong class="bold">grails.resources.adhoc.patterns</strong> which defines a list of Servlet API compliant filter URI mappings, which the Resources filter will use to detect such "ad-hoc resource" requests.</div>
サーブレットAPI準拠のフィルタURIマッピングのリストを定義して、どのリクエストを"ad-hoc"リソースとしてResourcesのフィルタが使用するか認識させるConfig.groovy用の設定 <strong class="bold">grails.resources.adhoc.patterns</strong> があります。<p class="paragraph"/><div class="hidden-block">By default this is set to:</div>
デフォルトでは次のようにセットされています:
<div class="code"><pre>grails.resources.adhoc.patterns = &#91;'images/&#42;', '&#42;.js', '&#42;.css'&#93;</pre></div>


<a name="7.2.5.8 Other Resources-aware plugins"><!-- Legacy link --></a>
<h2 id="otherResourcesPlugins">7.2.5.8 リソース関連のプラグイン</h2>
<div class="hidden-block">At the time of writing, the following plugins include support for the Resources framework:</div>
現時点でのリソースフレームワークに対応したプラグイン:
<ul class="star">
<li><a href="http://grails.org/plugin/jquery" target="blank">jquery</a></li>
<li><a href="http://grails.org/plugin/jquery-ui" target="blank">jquery-ui</a></li>
<li><a href="http://grails.org/plugin/blueprint" target="blank">blueprint</a></li>
<li><a href="http://grails.org/plugin/lesscss-resources" target="blank">lesscss-resources</a></li>
<li><a href="http://grails.org/plugin/zipped-resources" target="blank">zipped-resources</a></li>
<li><a href="http://grails.org/plugin/cached-resources" target="blank">cached-resources</a></li>
</ul><p class="paragraph"/>

<a name="7.2.6 Sitemesh Content Blocks"><!-- Legacy link --></a>
<h2 id="sitemeshContentBlocks">7.2.6 Sitemeshコンテントブロック</h2>
<div class="hidden-block">Although it is useful to decorate an entire page sometimes you may find the need to decorate independent sections of your site. To do this you can use content blocks. To get started, partition the page to be decorated using the <code>&#60;content&#62;</code> tag:</div>
サイト全体のページをデコレートするのに便利ですが、ページ内のブロック(パーツ)をデコレートする必要も有ると思います。この場合はコンテントブロックを使用します。コンテントブロックを使用するには<code>&#60;content&#62;</code>タグでページ内をブロック分割します。<p class="paragraph"/><div class="hidden-block">
&#8230; draw the navbar here&#8230;
&#8230; draw the header here&#8230;
&#8230; draw the footer here&#8230;
&#8230; draw the body here&#8230;
</div><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;content tag=<span class="xml&#45;quote">"navbar"</span>&#62;</span>
&#8230; ここにナビゲーションバーコンテンツ&#8230;
<span class="xml&#45;tag">&#60;/content&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;content tag=<span class="xml&#45;quote">"header"</span>&#62;</span>
&#8230; ここにヘッダーコンテンツ&#8230;
<span class="xml&#45;tag">&#60;/content&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;content tag=<span class="xml&#45;quote">"footer"</span>&#62;</span>
&#8230; ここにフッターコンテンツ&#8230;
<span class="xml&#45;tag">&#60;/content&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;content tag=<span class="xml&#45;quote">"body"</span>&#62;</span>
&#8230; ここにボディコンテンツ&#8230;
<span class="xml&#45;tag">&#60;/content&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then within the layout you can reference these components and apply individual layouts to each:</div>
そしてレイアウト側には、それぞれのコンポーネントの参照を配置します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;html&#62;</span>
    <span class="xml&#45;tag">&#60;body&#62;</span>
        <span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"header"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"headerLayout"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;g:pageProperty name=<span class="xml&#45;quote">"page.header"</span> /&#62;</span>
            <span class="xml&#45;tag">&#60;/g:applyLayout&#62;</span>
        <span class="xml&#45;tag">&#60;/div&#62;</span>
        <span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"nav"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"navLayout"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;g:pageProperty name=<span class="xml&#45;quote">"page.navbar"</span> /&#62;</span>
            <span class="xml&#45;tag">&#60;/g:applyLayout&#62;</span>
        <span class="xml&#45;tag">&#60;/div&#62;</span>
        <span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"body"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"bodyLayout"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;g:pageProperty name=<span class="xml&#45;quote">"page.body"</span> /&#62;</span>
            <span class="xml&#45;tag">&#60;/g:applyLayout&#62;</span>
        <span class="xml&#45;tag">&#60;/div&#62;</span>
        <span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"footer"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;g:applyLayout name=<span class="xml&#45;quote">"footerLayout"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;g:pageProperty name=<span class="xml&#45;quote">"page.footer"</span> /&#62;</span>
            <span class="xml&#45;tag">&#60;/g:applyLayout&#62;</span>
        <span class="xml&#45;tag">&#60;/div&#62;</span>
    <span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div>


<a name="7.2.7 Making Changes to a Deployed Application"><!-- Legacy link --></a>
<h2 id="makingChangesToADeployedApplication">7.2.7 デプロイされたアプリケーションへの変更</h2>
<div class="hidden-block">One of the main issues with deploying a Grails application (or typically any servlet-based one) is that any change to the views requires that you redeploy your whole application. If all you want to do is fix a typo on a page, or change an image link, it can seem like a lot of unnecessary work. For such simple requirements, Grails does have a solution: the  <code>grails.gsp.view.dir</code>  configuration setting.</div>
Grailsアプリケーションをデプロイする際に起きる大きな問題の一つに(または他のサーブレットベースのアプリケーションも含む)、ビューを変更するたびにアプリケーション全体を再デプロイする必要がある事です。もし誤植や画像リンクの修正など有る場合は無駄な作業が発生します。そのような事を発生させないために、Grailsには、<code>grails.gsp.view.dir</code>定義という解決方法が存在します。<p class="paragraph"/><div class="hidden-block">How does this work? The first step is to decide where the GSP files should go. Let's say we want to keep them unpacked in a  <code>/var/www/grails/my-app</code>  directory. We add these two lines to  <code>grails-app/conf/Config.groovy</code> :</div>
はじめに、何処にGSPを配置するかを決めましょう。<code>/var/www/grails/my-app</code>の階層はパックしないこととします。以下の2行を<code>grails-app/conf/Config.groovy</code>に追加します:<p class="paragraph"/><div class="code"><pre>grails.gsp.enable.reload = <span class="java&#45;keyword">true</span>
grails.gsp.view.dir = <span class="java&#45;quote">"/<span class="java&#45;keyword">var</span>/www/grails/my&#45;app/"</span></pre></div>
<div class="hidden-block">The first line tells Grails that modified GSP files should be reloaded at runtime. If you don't have this setting, you can make as many changes as you like but they won't be reflected in the running application until you restart. The second line tells Grails where to load the views and layouts from.</div>
最初の行は変更されたGSPファイルはリロードするという指定です。この指定をしないと、GSPが更新されても再起動するまで反映されません。2行目は何処にあるビューとレイアウトをロードするかの指定です。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">The trailing slash on the  <code>grails.gsp.view.dir</code>  value is important! Without it, Grails will look for views in the parent directory.</div>
<code>grails.gsp.view.dir</code>の最後に付いているスラッシュは重要です。これが無いとGrailsが親ディレクトリにビューを探しに行きます。
</blockquote><p class="paragraph"/><div class="hidden-block">Setting "grails.gsp.view.dir" is optional. If it's not specified, you can update files directly to the application server's deployed war directory. Depending on the application server, these files might get overwritten when the server is restarted. Most application servers support "exploded war deployment" which is recommended in this case.</div>
"grails.gsp.view.dir"の設定は省略可能です。省略した場合はwarがデプロイされたディレクトリのファイルを変更できます。アプリケーションサーバによりますが、サーバのリスタート時にこれらのファイルは上書きされてしまいます。ホット再デプロイメントをサポートしたアプリケーションサーバの場合にのみ推奨します。<p class="paragraph"/><div class="hidden-block">With those settings in place, all you need to do is copy the views from your web application to the external directory. On a Unix-like system, this would look something like this:</div>
この場合に、サーバ内で設定をするには、Webアプリケーションのディレクトリから別のディレクトリへ全てのビューをコピーします。Unix系のシステムでは以下のように作業します:<p class="paragraph"/><div class="code"><pre>mkdir &#45;p /<span class="java&#45;keyword">var</span>/www/grails/my&#45;app/grails&#45;app/views
cp &#45;R grails&#45;app/views/&#42; /<span class="java&#45;keyword">var</span>/www/grails/my&#45;app/grails&#45;app/views</pre></div>
<div class="hidden-block">The key point here is that you must retain the view directory structure, including the  <code>grails-app/views</code>  bit. So you end up with the path  <code>/var/www/grails/my-app/grails-app/views/...</code> .</div>
ポイントとなるのは、<code>grails-app/views</code>を含んだ全てのビューディレクトリ階層を持たなくてはならない所です。この場合だとパスは、<code>/var/www/grails/my-app/grails-app/views/...</code>となります。<p class="paragraph"/><div class="hidden-block">One thing to bear in mind with this technique is that every time you modify a GSP, it uses up permgen space. So at some point you will eventually hit "out of permgen space" errors unless you restart the server. So this technique is not recommended for frequent or large changes to the views.</div>
ひとつ気にかけてほしいのが、GSPを更新するたびに、permgenスペースを多く使用するという事です。それにより再起動するのと比べて、そのうち"out of permgen space"エラーが起こります。したがって、常に更新される物や、ビューへの大きな変更には推奨できません。<p class="paragraph"/><div class="hidden-block">There are also some System properties to control GSP reloading:</div>
GSPリロードをコントロールするシステムプロパティも提供しています:
<div class="hidden-block">
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Name</strong></th><th><strong class="bold">Description</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td>grails.gsp.enable.reload</td><td>altervative system property for enabling the GSP reload mode without changing Config.groovy</td><td>&#160;</td></tr><tr class="table-even"><td>grails.gsp.reload.interval</td><td>interval between checking the lastmodified time of the gsp source file, unit is milliseconds</td><td>5000</td></tr><tr class="table-odd"><td>grails.gsp.reload.granularity</td><td>the number of milliseconds leeway to give before deciding a file is out of date. this is needed because different roundings usually cause a 1000ms difference in lastmodified times</td><td>1000</td></tr></table>
</div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">名称</strong></th><th><strong class="bold">説明</strong></th><th><strong class="bold">既存値</strong></th></tr><tr class="table-odd"><td>grails.gsp.enable.reload</td><td>Config.groovy変更せずにGSPリロードモードを許可にします。</td><td>&#160;</td></tr><tr class="table-even"><td>grails.gsp.reload.interval</td><td>gspソースファイルの更新を確認するインターバル。ミリ秒で指定。</td><td>5000</td></tr><tr class="table-odd"><td>grails.gsp.reload.granularity</td><td>ファイルが更新されたかを判断する時間のゆとり。ミリ秒で指定。</td><td>1000</td></tr></table><p class="paragraph"/><div class="hidden-block">GSP reloading is supported for precompiled GSPs since Grails 1.3.5 .</div>
プリコンパイルGSPに対してのGSPリロードはGrails 1.3.5からサポートされています。


<a name="7.2.8 GSP Debugging"><!-- Legacy link --></a>
<h2 id="GSPDebugging">7.2.8 GSPデバッグ</h2>
<h4>生成されたソースコードを表示する <div class="hidden-block">Viewing the generated source code </div></h4><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Adding "?showSource=true" or "&#38;showSource=true" to the url shows the generated Groovy source code for the view instead of rendering it. It won't show the source code of included templates. This only works in development mode</li>
<li>The saving of all generated source code can be activated by setting the property "grails.views.gsp.keepgenerateddir" (in Config.groovy) . It must point to a directory that exists and is writable.</li>
<li>During "grails war" gsp pre-compilation, the generated source code is stored in grails.project.work.dir/gspcompile (usually in ~/.grails/(grails_version)/projects/(project name)/gspcompile).</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>URLに、 "?showSource=true" または、"&#38;showSource=true"を追加するとページ描写の代わりに、ビュー用に生成されたGroovyコードが参照できます。但し含んだテンプレートのコードは含まれません。開発モードのみで動作します。</li>
<li>Config.groovyにプロパティ"grails.views.gsp.keepgenerateddir"を指定すると生成ファイルが指定された場所に保存されます。</li>
<li>"grails war"でのgspプリコンパイル時に、生成されたソースコードがgrails.project.work.dir/gspcompileに保存されます。(通常は~/.grails/(grails_version)/projects/(project name)/gspcompileです。)</li>
</ul><p class="paragraph"/><h4>デバッガでGSPコードをデバッグ <div class="hidden-block">Debugging GSP code with a debugger </div></h4><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>See <a href="http://contraptionsforprogramming.blogspot.com/2010/08/debuggable-gsps-in-springsource-tool.html" target="blank">Debugging GSP in STS</a></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="http://contraptionsforprogramming.blogspot.com/2010/08/debuggable-gsps-in-springsource-tool.html" target="blank">Debugging GSP in STS</a> を参照</li>
</ul><p class="paragraph"/><h4>使用されたテンプレートの情報を参照 <div class="hidden-block">Viewing information about templates used to render a single url </div></h4><p class="paragraph"/><div class="hidden-block">GSP templates are reused in large web applications by using the <code>g:render</code> taglib. Several small templates can be used to render a single page.
It might be hard to find out what GSP template actually renders the html seen in the result.
The debug templates -feature adds html comments to the output. The comments contain debug information about gsp templates used to render the page.</div>
規模の大きいなWebアプリケーションでは、<code>g:render</code>タグを使用してGSPテンプレートは再利用されます。幾つかの小さなテンプレートが１つのページで使われる事もあります。どの部分でGSPテンプレートが実際にHTMLを描写したか探すのは大変だと思います。テンプレートデバッグ機能ではhtmlコメントでGSPテンプレートのデバッグ情報を提供します。<p class="paragraph"/>
<div class="hidden-block">Usage is simple: append "?debugTemplates" or "&#38;debugTemplates" to the url and view the source of the result in your browser.
"debugTemplates" is restricted to development mode. It won't work in production.</div>
使用方法は簡単、URLに"?debugTemplates" または "&#38;debugTemplates"を追加して表示されたページのソースを参照します。"debugTemplates"は開発モードのみで動作します。<p class="paragraph"/><div class="hidden-block">Here is an example of comments added by debugTemplates :</div>
debugTemplatesでは以下のようなコメントが追記されます:<p class="paragraph"/><div class="code"><pre>&#60;!&#45;&#45; GSP &#35;2 START template: /home/.../views/_carousel.gsp
     precompiled: <span class="java&#45;keyword">false</span> lastmodified: &#8230; &#45;&#45;&#62;
.
.
.
&#60;!&#45;&#45; GSP &#35;2 END template: /home/.../views/_carousel.gsp
     rendering time: 115 ms &#45;&#45;&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Each comment block has a unique id so that you can find the start &#38; end of each template call.</div>
それぞれのコメントブロックには番号を持っていて、テンプレートの開始と終了を探し安くしてあります。


<a name="7.3 Tag Libraries"><!-- Legacy link --></a>
<h2 id="taglibs">7.3 タグライブラリ</h2>
<div class="hidden-block">Like <a href="http://www.oracle.com/technetwork/java/javaee/jsp/index.html" target="blank">Java Server Pages</a> (JSP), GSP supports the concept of custom tag libraries. Unlike JSP, Grails' tag library mechanism is simple, elegant and completely reloadable at runtime.</div>
<a href="http://www.oracle.com/technetwork/java/javaee/jsp/index.html" target="blank">Java Server Pages</a> (JSP)のように、GSPでもカスタムタグライブラリをサポートしています。JSPと違いGrailsでのタグライブラリは単純簡潔です。<p class="paragraph"/><div class="hidden-block">Quite simply, to create a tag library create a Groovy class that ends with the convention <code>TagLib</code> and place it within the <code>grails-app/taglib</code> directory:</div>
タグライブラリを作成するには、<code>grails-app/taglib</code>ディレクトリに、名称の最後が<code>TagLib</code>となるGroovyクラスを作成します:<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Now to create a tag create a Closure property that takes two arguments: the tag attributes and the body content:</div>
タグライブラリクラスを作成したら、２つの引数(属性とタグ内容)を受け取るクロージャを追加してタグを作成します:<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;
    def simple = &#123; attrs, body &#45;&#62;<p class="paragraph"/>    &#125;
&#125;</pre></div><p class="paragraph"/>The <code>attrs</code> argument is a Map of the attributes of the tag, whilst the <code>body</code> argument is a Closure that returns the body content when invoked:
引数<code>attrs</code>はタグ属性のMapです。引数<code>body</code>はタグ内容のコンテンツを呼び出すクロージャです:<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;
    def emoticon = &#123; attrs, body &#45;&#62;
       out &#60;&#60; body() &#60;&#60; (attrs.happy == '<span class="java&#45;keyword">true</span>' ? <span class="java&#45;quote">" :&#45;)"</span> : <span class="java&#45;quote">" :&#45;("</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">As demonstrated above there is an implicit <code>out</code> variable that refers to the output <code>Writer</code> which you can use to append content to the response. Then you can reference the tag inside your GSP; no imports are necessary:</div>
上記の例では、レスポンスを出力する<code>Writer</code>を参照する変数<code>out</code>に対してコンテンツを追加しています。ここまで作成したら、以下のように、GSPの中でタグをそのまま参照します。importは必要ありません。:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:emoticon happy=<span class="xml&#45;quote">"true"</span>&#62;</span>Hi John<span class="xml&#45;tag">&#60;/g:emoticon&#62;</span></pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">To help IDEs like SpringSource Tool Suite (STS) and others autocomplete tag attributes, you should add Javadoc comments to your tag closures with <code>&#64;attr</code> descriptions. Since taglibs use Groovy code it can be difficult to reliably detect all usable attributes.</div>
タグリブはGroovyコードを使用しているため、タグで使用可能な属性全てを認識することは困難です。SpringSource Tool Suite (STS)等のIDEでの補完機能に対しての手助けとして、タグクロージャのJavadocコメント内に<code>&#64;attr</code>を含めましょう。<p class="paragraph"/><div class="hidden-block">For example:</div>
例として:<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;<p class="paragraph"/>    /&#42;&#42;
     &#42; Renders the body with an emoticon.
     &#42;
     &#42; @attr happy whether to show a happy emoticon ('<span class="java&#45;keyword">true</span>') or
     &#42; a sad emoticon ('<span class="java&#45;keyword">false</span>')
     &#42;/
    def emoticon = &#123; attrs, body &#45;&#62;
       out &#60;&#60; body() &#60;&#60; (attrs.happy == '<span class="java&#45;keyword">true</span>' ? <span class="java&#45;quote">" :&#45;)"</span> : <span class="java&#45;quote">" :&#45;("</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">and any mandatory attributes should include the REQUIRED keyword, e.g.</div>
必須条件の属性には、キーワードREQUIREDを指定します。<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;<p class="paragraph"/>    /&#42;&#42;
     &#42; Creates a <span class="java&#45;keyword">new</span> password field.
     &#42;
     &#42; @attr name REQUIRED the field name
     &#42; @attr value the field value
     &#42;/
    def passwordField = &#123; attrs &#45;&#62;
        attrs.type = <span class="java&#45;quote">"password"</span>
        attrs.tagName = <span class="java&#45;quote">"passwordField"</span>
        fieldImpl(out, attrs)
    &#125;
&#125;</pre></div>
</blockquote>



<h2 id="taglibVariablesAndScopes">7.3.1 変数とスコープ</h2>
<div class="hidden-block">Within the scope of a tag library there are a number of pre-defined variables including:</div>
タグライブラリのスコープには、多数の前定義された変数があります:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>actionName</code> - The currently executing action name</li>
<li><code>controllerName</code> - The currently executing controller name</li>
<li><code>flash</code> - The <a href="../ref/Controllers/flash.html" class="controllers">flash</a> object</li>
<li><code>grailsApplication</code> - The <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> instance</li>
<li><code>out</code> - The response writer for writing to the output stream</li>
<li><code>pageScope</code> - A reference to the <a href="../ref/Tag Libraries/pageScope.html" class="tagLibraries">pageScope</a> object used for GSP rendering (i.e. the binding)</li>
<li><code>params</code> - The <a href="../ref/Controllers/params.html" class="controllers">params</a> object for retrieving request parameters</li>
<li><code>pluginContextPath</code> - The context path to the plugin that contains the tag library</li>
<li><code>request</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a> instance</li>
<li><code>response</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a> instance</li>
<li><code>servletContext</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">javax.servlet.ServletContext</a> instance</li>
<li><code>session</code> - The <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a> instance</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>actionName</code> - 現在実行中のアクション名</li>
<li><code>controllerName</code> - 現在実行中のコントローラ名</li>
<li><code>flash</code> - <a href="../ref/Controllers/flash.html" class="controllers">flash</a>オブジェクト</li>
<li><code>grailsApplication</code> - <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a>インスタンス</li>
<li><code>out</code> - 出力用のレスポンスライター</li>
<li><code>pageScope</code> - GSP描写で使用する<a href="../ref/Tag Libraries/pageScope.html" class="tagLibraries">pageScope</a>オブジェクトへの参照</li>
<li><code>params</code> - リクエストパラメータ取得用の<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクト</li>
<li><code>pluginContextPath</code> - タグライブラリを含むプラグインへのコンテキストパス。</li>
<li><code>request</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>インスタンス</li>
<li><code>response</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a>インスタンス</li>
<li><code>servletContext</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">javax.servlet.ServletContext</a> インスタンス</li>
<li><code>session</code> - <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a>インスタンス</li>
</ul><p class="paragraph"/>

<a name="7.3.2 Simple Tags"><!-- Legacy link --></a>
<h2 id="simpleTags">7.3.2 簡単なタグ</h2>
<div class="hidden-block">As demonstrated in the previous example it is easy to write simple tags that have no body and just output content. Another example is a <code>dateFormat</code> style tag:</div>
前の説明で、簡単にコンテンツを出力するタグは簡単に記述できると説明しました。他の例として<code>dateFormat</code>タグを紹介します:<p class="paragraph"/><div class="code"><pre>def dateFormat = &#123; attrs, body &#45;&#62;
    out &#60;&#60; <span class="java&#45;keyword">new</span> java.text.SimpleDateFormat(attrs.format).format(attrs.date)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above uses Java's <code>SimpleDateFormat</code> class to format a date and then write it to the response. The tag can then be used within a GSP as follows:</div>
この例ではJavaの<code>SimpleDateFormat</code>クラスを使ってフォーマットした日付をレスポンスに出力します。このタグは、GSPで次のように使用します:<p class="paragraph"/>
<div class="code"><pre><span class="xml&#45;tag">&#60;g:dateFormat format=<span class="xml&#45;quote">"dd&#45;MM&#45;yyyy"</span> date=<span class="xml&#45;quote">"$&#123;new Date()&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">With simple tags sometimes you need to write HTML mark-up to the response. One approach would be to embed the content directly:</div>
単純なタグでHTMLマークアップをレスポンスすることもあるでしょう。一つのアプローチとして直接コンテンツを埋め込む事ができます:<p class="paragraph"/>
<div class="code"><pre>def formatBook = &#123; attrs, body &#45;&#62;
    out &#60;&#60; <span class="java&#45;quote">"&#60;div id=&#34;$&#123;attrs.book.id&#125;&#34;&#62;"</span>
    out &#60;&#60; <span class="java&#45;quote">"Title : $&#123;attrs.book.title&#125;"</span>
    out &#60;&#60; <span class="java&#45;quote">"&#60;/div&#62;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Although this approach may be tempting it is not very clean. A better approach would be to reuse the <a href="../ref/Tags/render.html" class="tags">render</a> tag:</div>
上記の方法はあまりきれいでは無いので、実際には、<a href="../ref/Tags/render.html" class="tags">render</a>タグを使用すると良いでしょう:<p class="paragraph"/><div class="code"><pre>def formatBook = &#123; attrs, body &#45;&#62;
    out &#60;&#60; render(template: <span class="java&#45;quote">"bookTemplate"</span>, model: &#91;book: attrs.book&#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">And then have a separate GSP template that does the actual rendering.</div>
このようにして、実際に描写されるGSPテンプレートと切り離せます.


<a name="7.3.3 Logical Tags"><!-- Legacy link --></a>
<h2 id="logicalTags">7.3.3 制御タグ</h2>
<div class="hidden-block">You can also create logical tags where the body of the tag is only output once a set of conditions have been met. An example of this may be a set of security tags:</div>
条件に合ったときのみにタグ内容を出力する制御タグを作成できます。セキュリティタグを例とします:<p class="paragraph"/><div class="code"><pre>def isAdmin = &#123; attrs, body &#45;&#62;
    def user = attrs.user
    <span class="java&#45;keyword">if</span> (user &#38;&#38; checkUserPrivs(user)) &#123;
        out &#60;&#60; body()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The tag above checks if the user is an administrator and only outputs the body content if he/she has the correct set of access privileges:</div>
この例ではアクセスしたユーザをチェックして、管理者であった場合のみ内容を出力します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:isAdmin user=<span class="xml&#45;quote">"$&#123;myUser&#125;"</span>&#62;</span>
    // some restricted content
<span class="xml&#45;tag">&#60;/g:isAdmin&#62;</span></pre></div>


<a name="7.3.4 Iterative Tags"><!-- Legacy link --></a>
<h2 id="iterativeTags">7.3.4 イテレートタグ</h2>
<div class="hidden-block">Iterative tags are easy too, since you can invoke the body multiple times:</div>
タグ内容を複数回実行するような、イテレートタグも簡単に作れます:<p class="paragraph"/><div class="code"><pre>def repeat = &#123; attrs, body &#45;&#62;
    attrs.times?.toInteger()?.times &#123; num &#45;&#62;
        out &#60;&#60; body(num)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example we check for a <code>times</code> attribute and if it exists convert it to a number, then use Groovy's <code>times</code> method to iterate the specified number of times:</div>
この例では、属性<code>times</code>を有無や数値なのかを確認し、その数値でGroovyの<code>times</code>メソッドを実行して、与えられた数値の回数、実行内容を繰り返します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:repeat times=<span class="xml&#45;quote">"3"</span>&#62;</span>
<span class="xml&#45;tag">&#60;p&#62;</span>Repeat this 3 times! Current repeat = $&#123;it&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:repeat&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Notice how in this example we use the implicit <code>it</code> variable to refer to the current number. This works because when we invoked the body we passed in the current value inside the iteration:</div>
ここでは、数値を参照した変数<code>it</code>の使い方を紹介しています。これはbody実行時にイテレーションの数値をbodyに渡すことで動作しています。:<p class="paragraph"/><div class="code"><pre>out &#60;&#60; body(num)</pre></div><p class="paragraph"/><div class="hidden-block">That value is then passed as the default variable <code>it</code> to the tag. However, if you have nested tags this can lead to conflicts, so you should should instead name the variables that the body uses:</div>
この値はタグ内の変数<code>it</code>に渡されます。ただしタグをネストした場合は名称の衝突が起きるため違う名称を指定できるようにする必要があります。:<p class="paragraph"/><div class="code"><pre>def repeat = &#123; attrs, body &#45;&#62;
    def <span class="java&#45;keyword">var</span> = attrs.<span class="java&#45;keyword">var</span> ?: <span class="java&#45;quote">"num"</span>
    attrs.times?.toInteger()?.times &#123; num &#45;&#62;
        out &#60;&#60; body((<span class="java&#45;keyword">var</span>):num)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we check if there is a <code>var</code> attribute and if there is use that as the name to pass into the body invocation on this line:</div>
この例では、属性varが存在すれば、その値を名称として使用できるようにbodyに渡して実行します。<p class="paragraph"/><div class="code"><pre>out &#60;&#60; body((<span class="java&#45;keyword">var</span>):num)</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Note the usage of the parenthesis around the variable name. If you omit these Groovy assumes you are using a String key and not referring to the variable itself.</div>
変数名パーレン使用時の注意点です。これを省略するとGroovyは文字列キーとして解釈してしまい変数として参照できません。
</blockquote><p class="paragraph"/><div class="hidden-block">Now we can change the usage of the tag as follows:</div>
これで、以下のようにタグで使用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:repeat times=<span class="xml&#45;quote">"3"</span> var=<span class="xml&#45;quote">"j"</span>&#62;</span>
<span class="xml&#45;tag">&#60;p&#62;</span>Repeat this 3 times! Current repeat = $&#123;j&#125;<span class="xml&#45;tag">&#60;/p&#62;</span>
<span class="xml&#45;tag">&#60;/g:repeat&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Notice how we use the <code>var</code> attribute to define the name of the variable <code>j</code> and then we are able to reference that variable within the body of the tag.</div>
こうすることで、<code>var</code>属性に指定した変数名<code>j</code>をタグ内部で変数として参照することができます。


<a name="7.3.5 Tag Namespaces"><!-- Legacy link --></a>
<h2 id="namespaces">7.3.5 タグネームスペース</h2>
<div class="hidden-block">By default, tags are added to the default Grails namespace and are used with the <code>g:</code> prefix in GSP pages. However, you can specify a different namespace by adding a static property to your <code>TagLib</code> class:</div>
デフォルトでのタグは、Grailsのデフォルトネームスペースに追加され、GSPでは<code>g:</code>接頭辞が使用できます。ネームスペースはstaticプロパティ<code>namespace</code>を<code>TagLib</code>クラスに追加する事で、独自に定義することが可能です。:<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;
    <span class="java&#45;keyword">static</span> namespace = <span class="java&#45;quote">"my"</span><p class="paragraph"/>    def example = &#123; attrs &#45;&#62;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we have specified a <code>namespace</code> of <code>my</code> and hence the tags in this tag lib must then be referenced from GSP pages like this:</div>
この例では<code>namespace</code>を<code>my</code>と定義したので、このタグを参照するにはGSPページ内では以下のように参照できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;my:example name=<span class="xml&#45;quote">"..."</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">where the prefix is the same as the value of the static <code>namespace</code> property. Namespaces are particularly useful for plugins.</div>
これ例で<code>namespace</code>プロパティに設定したものが接頭辞として使用しています。ネームスペースはプラグインでタグ提供を行う際に有用です。<p class="paragraph"/><div class="hidden-block">Tags within namespaces can be invoked as methods using the namespace as a prefix to the method call:</div>
ネームスペース付きタグのメソッドコール時はネームスペースを接頭辞として使用します:<p class="paragraph"/><div class="code"><pre>out &#60;&#60; my.example(name:<span class="java&#45;quote">"foo"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">This works from GSP, controllers or tag libraries </div>
GSP、コントローラ、タグライブラリで使用できます。


<a name="7.3.6 Using JSP Tag Libraries"><!-- Legacy link --></a>
<h2 id="usingJSPTagLibraries">7.3.6 JSPタグライブラリの使用</h2>
<div class="hidden-block">In addition to the simplified tag library mechanism provided by GSP, you can also use JSP tags from GSP. To do so simply declare the JSP to use with the <code>taglib</code> directive:</div>
単純なタグライブラリ機能がGSPで提供されているのに加えて、GSPでは、JSPタグを使用することもできます。使用するには、<code>taglib</code>ディレクティブを定義します。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;%@ taglib prefix=<span class="xml&#45;quote">"fmt"</span> uri=<span class="xml&#45;quote">"http://java.sun.com/jsp/jstl/fmt"</span> %&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then you can use it like any other tag:</div>
他のタグと同じように使用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;fmt:formatNumber value=<span class="xml&#45;quote">"$&#123;10&#125;"</span> pattern=<span class="xml&#45;quote">".00"</span>/&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">With the added bonus that you can invoke JSP tags like methods:</div>
さらに追加として、JSPタグをメソッドとして実行可能です:<p class="paragraph"/><div class="code"><pre>$&#123;fmt.formatNumber(value:10, pattern:<span class="java&#45;quote">".00"</span>)&#125;</pre></div>

<a name="7.3.7 Tag return value"><!-- Legacy link --></a>
<h2 id="tagReturnValue">7.3.7 タグの戻り値</h2>
<div class="hidden-block">Since Grails 1.2, a tag library call returns an instance of <code>org.codehaus.groovy.grails.web.util.StreamCharBuffer</code> class by default.
This change improves performance by reducing object creation and optimizing buffering during request processing.
In earlier Grails versions, a <code>java.lang.String</code> instance was returned.</div>
Grails 1.2以降、タグライブラリを呼び出すと、デフォルトでは<code>org.codehaus.groovy.grails.web.util.StreamCharBuffer</code> クラスのインスタンスを返します。
この実装でリクエスト処理時のバッファリング最適化や、オブジェクト生成の減少によりパフォーマンスの向上が行われました。
それ以前のGrailsでは<code>java.lang.String</code>インスタンスを返します。<p class="paragraph"/><div class="hidden-block">Tag libraries can also return direct object values to the caller since Grails 1.2..
Object returning tag names are listed in a static <code>returnObjectForTags</code> property in the tag library class.</div>
さらに、Grails 1.2からは、タグライブラリから直接オブジェクトを返す事が可能です。オブジェクトを返すタグを定義するにはstatic <code>returnObjectForTags</code>プロパティにタグ名称をリストします。<p class="paragraph"/><div class="hidden-block">Example:</div>
例:
<div class="code"><pre>class ObjectReturningTagLib &#123;
    <span class="java&#45;keyword">static</span> namespace = <span class="java&#45;quote">"cms"</span>
    <span class="java&#45;keyword">static</span> returnObjectForTags = &#91;'content'&#93;<p class="paragraph"/>    def content = &#123; attrs, body &#45;&#62;
        CmsContent.findByCode(attrs.code)?.content
    &#125;
&#125;</pre></div>

<a name="7.4 URL Mappings"><!-- Legacy link --></a>
<h2 id="urlmappings">7.4 URLマッピング</h2>
<div class="hidden-block">Throughout the documentation so far the convention used for URLs has been the default of <code>/controller/action/id</code>. However, this convention is not hard wired into Grails and is in fact controlled by a URL Mappings class located at <code>grails-app/conf/UrlMappings.groovy</code>.</div>
ここまでのドキュメント内容では、URLのルールはデフォルトの<code>/controller/action/id</code>を使用しています。このルールはGrailsで必須になっているわけでは無く、<code>grails-app/conf/UrlMappings.groovy</code>に配置されているURLマッピングクラスでコントロールされています。<p class="paragraph"/><div class="hidden-block">The <code>UrlMappings</code> class contains a single property called <code>mappings</code> that has been assigned a block of code:</div>
<code>URLMappings</code>クラスは、コードブロックが定義された<code>mappings</code>というプロパティを持っています。:<p class="paragraph"/><div class="code"><pre>class UrlMappings &#123;
    <span class="java&#45;keyword">static</span> mappings = &#123;
    &#125;
&#125;</pre></div><p class="paragraph"/>

<a name="7.4.1 Mapping to Controllers and Actions"><!-- Legacy link --></a>
<h2 id="mappingToControllersAndActions">7.4.1 コントローラとアクションにマッピング</h2>
<div class="hidden-block">To create a simple mapping simply use a relative URL as the method name and specify named parameters for the controller and action to map to:</div>
簡単なマッピングは、相対URLをメソッド名とするメソッドに、マップ対象のコントローラとアクション名称を、名前付きパラメータ引数として作成します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/product"</span>(controller: <span class="java&#45;quote">"product"</span>, action: <span class="java&#45;quote">"list"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">In this case we've mapped the URL <code>/product</code> to the <code>list</code> action of the <code>ProductController</code>. Omit the action definition to map to the default action of the controller:</div>
この例ではURL <code>/product</code>は、<code>ProductController</code>の<code>list</code>アクションにマップ定義したことになります。アクションを省略すると、コントローラのデフォルトアクションにマップ定義できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/product"</span>(controller: <span class="java&#45;quote">"product"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">An alternative syntax is to assign the controller and action to use within a block passed to the method:</div>
他のシンタックスとして、コントローラとアクションを指定したコードブロックをメソッドに渡すこともできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/product"</span> &#123;
    controller = <span class="java&#45;quote">"product"</span>
    action = <span class="java&#45;quote">"list"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Which syntax you use is largely dependent on personal preference. </div>
どちらのシンタックスを使用するかは個人の選択に依存します。<p class="paragraph"/>If you have mappings that all fall under a particular path you can group mappings with the <code>group</code> method:<p class="paragraph"/><div class="code"><pre>group <span class="java&#45;quote">"/product"</span>, &#123;
    <span class="java&#45;quote">"/apple"</span>(controller:<span class="java&#45;quote">"product"</span>, id:<span class="java&#45;quote">"apple"</span>)
    <span class="java&#45;quote">"/htc"</span>(controller:<span class="java&#45;quote">"product"</span>, id:<span class="java&#45;quote">"htc"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">To rewrite one URI onto another explicit URI (rather than a controller/action pair) do something like this:</div>
URIを明示的なURIへ(コントローラ・アクションを指定するのでは無く)書き換えする場合は:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/hello"</span>(uri: <span class="java&#45;quote">"/hello.dispatch"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">Rewriting specific URIs is often useful when integrating with other frameworks.</div>
特定のURIへの書き換えは、他のフレームワークと統合する場合に便利です。


<a name="7.4.2 Mapping to REST resources"><!-- Legacy link --></a>
<h2 id="restfulMappings">7.4.2 RESTリソースへのマッピング</h2>
Since Grails 2.3, it possible to create RESTful URL mappings that map onto controllers by convention. The syntax to do so is as follows:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources:'book')</pre></div><p class="paragraph"/>You define a base URI and the name of the controller to map to using the <code>resources</code> parameter. The above mapping will result in the following URLs:<p class="paragraph"/>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>HTTP Method</th><th>URI</th><th>Grails Action</th></tr><tr class="table-odd"><td>GET</td><td>/books</td><td>index</td></tr><tr class="table-even"><td>GET</td><td>/books/create</td><td>create</td></tr><tr class="table-odd"><td>POST</td><td>/books</td><td>save</td></tr><tr class="table-even"><td>GET</td><td>/books/${id}</td><td>show</td></tr><tr class="table-odd"><td>GET</td><td>/books/${id}/edit</td><td>edit</td></tr><tr class="table-even"><td>PUT</td><td>/books/${id}</td><td>update</td></tr><tr class="table-odd"><td>DELETE</td><td>/books/${id}</td><td>delete</td></tr></table><p class="paragraph"/>If you wish to include or exclude any of the generated URL mappings you can do so with the <code>include</code> or <code>exclude</code> parameter, which accepts the name of the Grails action to include or exclude:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources:'book', exclude:&#91;'delete', 'update'&#93;)<p class="paragraph"/>or<p class="paragraph"/><span class="java&#45;quote">"/books"</span>(resources:'book', include:&#91;'index', 'show'&#93;)</pre></div><p class="paragraph"/><h4>Single resources</h4><p class="paragraph"/>A single resource is a resource for which there is only one (possibly per user) in the system. You can create a single resource using the <code>resource</code> parameter (as oppose to <code>resources</code>):<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/book"</span>(resource:'book')</pre></div><p class="paragraph"/>This results in the following URL mappings:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>HTTP Method</th><th>URI</th><th>Grails Action</th></tr><tr class="table-odd"><td>GET</td><td>/book</td><td>index</td></tr><tr class="table-even"><td>GET</td><td>/book/create</td><td>create</td></tr><tr class="table-odd"><td>POST</td><td>/book</td><td>save</td></tr><tr class="table-even"><td>GET</td><td>/book</td><td>show</td></tr><tr class="table-odd"><td>GET</td><td>/book/edit</td><td>edit</td></tr><tr class="table-even"><td>PUT</td><td>/book</td><td>update</td></tr><tr class="table-odd"><td>DELETE</td><td>/book</td><td>delete</td></tr></table><p class="paragraph"/>The main difference is that the id is not included in the URL mapping.<p class="paragraph"/><h4>Nested Resources</h4><p class="paragraph"/>You can nest resource mappings to generate child resources. For example:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources:'book') &#123;
  <span class="java&#45;quote">"/authors"</span>(resources:<span class="java&#45;quote">"author"</span>)
&#125;</pre></div><p class="paragraph"/>The above will result in the following URL mappings:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>HTTP Method</th><th>URL</th><th>Grails Action</th></tr><tr class="table-odd"><td>GET</td><td>/books/${bookId}/authors</td><td>index</td></tr><tr class="table-even"><td>GET</td><td>/books/${bookId}/authors/create</td><td>create</td></tr><tr class="table-odd"><td>POST</td><td>/books/${bookId}/authors</td><td>save</td></tr><tr class="table-even"><td>GET</td><td>/books/${bookId}/authors/${id}</td><td>show</td></tr><tr class="table-odd"><td>GET</td><td>/books/${bookId}/authors/edit/${id}</td><td>edit</td></tr><tr class="table-even"><td>PUT</td><td>/books/${bookId}/authors/${id}</td><td>update</td></tr><tr class="table-odd"><td>DELETE</td><td>/books/${bookId}/authors/${id}</td><td>delete</td></tr></table><p class="paragraph"/>You can also nest regular URL mappings within a resource mapping:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources: <span class="java&#45;quote">"book"</span>) &#123;
    <span class="java&#45;quote">"/publisher"</span>(controller:<span class="java&#45;quote">"publisher"</span>)
&#125;</pre></div><p class="paragraph"/>This will result in the following URL being available:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>HTTP Method</th><th>URL</th><th>Grails Action</th></tr><tr class="table-odd"><td>GET</td><td>/books/1/publisher</td><td>index</td></tr></table><p class="paragraph"/><h4>Linking to RESTful Mappings</h4><p class="paragraph"/>You can link to any URL mapping created with the <code>g:link</code> tag provided by Grails simply by referencing the controller and action to link to:<p class="paragraph"/><div class="code"><pre>&#60;g:link controller=<span class="java&#45;quote">"book"</span> action=<span class="java&#45;quote">"index"</span>&#62;My Link&#60;/g:link&#62;</pre></div><p class="paragraph"/>As a convenience you  can also pass a domain instance to the <code>resource</code> attribute of the <code>link</code> tag:<p class="paragraph"/><div class="code"><pre>&#60;g:link resource=<span class="java&#45;quote">"$&#123;book&#125;"</span>&#62;My Link&#60;/g:link&#62;</pre></div><p class="paragraph"/>This will automatically produce the correct link (in this case "/books/1" for an id of "1").<p class="paragraph"/>
The case of nested resources is a little different as they typically required two identifiers (the id of the resource and the one it is nested within). For example given the nested resources:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources:'book') &#123;
  <span class="java&#45;quote">"/authors"</span>(resources:<span class="java&#45;quote">"author"</span>)
&#125;</pre></div><p class="paragraph"/>If you wished to link to the <code>show</code> action of the <code>author</code> controller, you would write:<p class="paragraph"/><div class="code"><pre>// Results in /books/1/authors/2
&#60;g:link controller=<span class="java&#45;quote">"author"</span> action=<span class="java&#45;quote">"show"</span> method=<span class="java&#45;quote">"GET"</span> params=<span class="java&#45;quote">"&#91;bookId:1&#93;"</span> id=<span class="java&#45;quote">"2"</span>&#62;The Author&#60;/g:link&#62;</pre></div><p class="paragraph"/>However, to make this more concise there is a <code>resource</code> attribute to the link tag which can be used instead:<p class="paragraph"/><div class="code"><pre>// Results in /books/1/authors/2
&#60;g:link resource=<span class="java&#45;quote">"book/author"</span> action=<span class="java&#45;quote">"show"</span> bookId=<span class="java&#45;quote">"1"</span> id=<span class="java&#45;quote">"2"</span>&#62;My Link&#60;/g:link&#62;</pre></div><p class="paragraph"/>The resource attribute accepts a path to the resource separated by a slash (in this case "book/author"). The attributes of the tag can be used to specify the necessary <code>bookId</code> parameter.

<a name="7.4.3 Embedded Variables"><!-- Legacy link --></a>
<h2 id="embeddedVariables">7.4.3 埋込変数</h2>
<h4>簡単な変数 <div class="hidden-block">Simple Variables </div></h4><p class="paragraph"/><div class="hidden-block">The previous section demonstrated how to map simple URLs with concrete "tokens". In URL mapping speak tokens are the sequence of characters between each slash, '/'. A concrete token is one which is well defined such as as <code>/product</code>. However, in many circumstances you don't know what the value of a particular token will be until runtime. In this case you can use variable placeholders within the URL for example:</div>
前セクションでは、具体トークンURLを簡単にマップする方法を紹介しました。URLマッピングでのトークンとは"/"スラッシュの間にある文字列の事を指します。具体トークンは<code>/product</code>のように適切に指定できますが、状況によっては、ランタイム時にしか一部のトークンが予測できない場合があります。その場合は以下の例のように変数を指定できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
  <span class="java&#45;quote">"/product/$id"</span>(controller: <span class="java&#45;quote">"product"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case by embedding a $id variable as the second token Grails will automatically map the second token into a parameter (available via the <a href="../ref/Controllers/params.html" class="controllers">params</a> object) called <code>id</code>. For example given the URL <code>/product/MacBook</code>, the following code will render "MacBook" to the response:</div>
この例では、２つめのトークンとして変数$idを埋め込むことで、Grailsが自動的に２つめのトークンを名称が<code>id</code>のパラメータとしてマップします(このパラメータは<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトから取得できます)。例として、URL <code>/product/MacBook</code>へアクセスを行うと、次のコードでは、結果として"MacBook"をレスポンスします:<p class="paragraph"/><div class="code"><pre>class ProductController &#123;
     def index() &#123; render params.id &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can of course construct more complex examples of mappings. For example the traditional blog URL format could be mapped as follows:</div>
もっと複雑なマッピングも作成できます。例としてブログのようなURLフォーマットを次のようにしてマッピングできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"/$blog/$year/$month/$day/$id"</span>(controller: <span class="java&#45;quote">"blog"</span>, action: <span class="java&#45;quote">"show"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above mapping would let you do things like:</div>
このマッピングでは、以下のようなURLでアクセスを可能にします:<p class="paragraph"/><div class="code"><pre>/graemerocher/2007/01/10/my_funky_blog_entry</pre></div><p class="paragraph"/><div class="hidden-block">The individual tokens in the URL would again be mapped into the <a href="../ref/Controllers/params.html" class="controllers">params</a> object with values available for <code>year</code>, <code>month</code>, <code>day</code>, <code>id</code> and so on. </div>
URLの個々のトークンは<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトにマップされるため、変数<code>blog</code>, <code>year</code>, <code>month</code>, <code>day</code>, <code>id</code>として値を取得する事ができます。<p class="paragraph"/><h4>動的なコントローラ名とアクション名 <div class="hidden-block">Dynamic Controller and Action Names </div></h4><p class="paragraph"/><div class="hidden-block">Variables can also be used to dynamically construct the controller and action name. In fact the default Grails URL mappings use this technique:</div>
変数を使って動的にコントローラとアクション名を構成することができます。GrailsでのデフォルトURLマッピングはこの機能を使用しています:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/$controller/$action?/$id?"</span>()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here the name of the controller, action and id are implicitly obtained from the variables <code>controller</code>, <code>action</code> and <code>id</code> embedded within the URL.</div>
URLに指定された内容から、変数<code>controller</code>,<code>action</code>,<code>id</code>を取得して、コントローラ、アクション、idを確定します。<p class="paragraph"/><div class="hidden-block">You can also resolve the controller name and action name to execute dynamically using a closure:</div>
コントローラ名の解決を変数で行い、クロージャを実行して動的にアクション名を解決することもできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/$controller"</span> &#123;
        action = &#123; params.goHere &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>省略可能な変数 <div class="hidden-block">Optional Variables </div></h4><p class="paragraph"/><div class="hidden-block">Another characteristic of the default mapping is the ability to append a ? at the end of a variable to make it an optional token. In a further example this technique could be applied to the blog URL mapping to have more flexible linking:</div>
変数の最後に ? を付加することで、変数を省略可能にすることが可能です。この仕組みを使用して、前述した例のブログURLマッピングをもっと柔軟にしてみましょう:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/$blog/$year?/$month?/$day?/$id?"</span>(controller:<span class="java&#45;quote">"blog"</span>, action:<span class="java&#45;quote">"show"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With this mapping all of these URLs would match with only the relevant parameters being populated in the <a href="../ref/Controllers/params.html" class="controllers">params</a> object:</div>
この設定で以下のURL全てマッチします、そしてそれぞれの関係のあるパラメータのみを<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトに追加します:<p class="paragraph"/><pre class="bq"><code>
/graemerocher/2007/01/10/my_funky_blog_entry
/graemerocher/2007/01/10
/graemerocher/2007/01
/graemerocher/2007
/graemerocher</code></pre><p class="paragraph"/><h4>Optional File Extensions</h4><p class="paragraph"/>If you wish to capture the extension of a particular path, then a special case mapping exists:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/$controller/$action?/$id?(.$format)?"</span>()</pre></div><p class="paragraph"/>By adding the <code>(.$format)?</code> mapping you can access the file extension using the <code>response.format</code> property in a controller:<p class="paragraph"/><div class="code"><pre>def index() &#123;
    render <span class="java&#45;quote">"extension is $&#123;response.format&#125;"</span>
&#125;</pre></div><p class="paragraph"/><h4>任意変数 <div class="hidden-block">Arbitrary Variables </div></h4><p class="paragraph"/><div class="hidden-block">You can also pass arbitrary parameters from the URL mapping into the controller by just setting them in the block passed to the mapping:</div>
URLマッピングからコントローラへ、コードブロック内で設定した任意のパラメータを渡すことが可能です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/holiday/win"</span> &#123;
     id = <span class="java&#45;quote">"Marrakech"</span>
     year = 2007
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This variables will be available within the <a href="../ref/Controllers/params.html" class="controllers">params</a> object passed to the controller.</div>
変数は<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトから参照可能になります。<p class="paragraph"/><h4>動的解決変数 <div class="hidden-block">Dynamically Resolved Variables </div></h4><p class="paragraph"/><div class="hidden-block">The hard coded arbitrary variables are useful, but sometimes you need to calculate the name of the variable based on runtime factors. This is also possible by assigning a block to the variable name:</div>
任意の変数をURLマッピングに埋め込むのは便利ですが、時折状況に応じて変数の内容を演算したい場合があると思います。この場合コードブロックを変数に割り当てます。:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/holiday/win"</span> &#123;
     id = &#123; params.id &#125;
     isEligible = &#123; session.user != <span class="java&#45;keyword">null</span> &#125; // must be logged in
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the above case the code within the blocks is resolved when the URL is actually matched and hence can be used in combination with all sorts of logic.</div>
URLが実際にマッチした時にコードブロックのロジックが実行されて変数の内容が解決されます。


<a name="7.4.4 Mapping to Views"><!-- Legacy link --></a>
<h2 id="mappingToViews">7.4.4 ビューへマッピング</h2>
<div class="hidden-block">You can resolve a URL to a view without a controller or action involved. For example to map the root URL <code>/</code> to a GSP at the location <code>grails-app/views/index.gsp</code> you could use:</div>
コントローラまたはアクションを含まずにビューへURLをマップできます。例としてルートURL <code>/</code> を、<code>grails-app/views/index.gsp</code>にマッピングするには:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/"</span>(view: <span class="java&#45;quote">"/index"</span>)  // map the root URL
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Alternatively if you need a view that is specific to a given controller you could use:</div>
あるいは、特定のコントローラにあるビューを指定する場合は:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"/help"</span>(controller: <span class="java&#45;quote">"site"</span>, view: <span class="java&#45;quote">"help"</span>) // to a view <span class="java&#45;keyword">for</span> a controller
&#125;</pre></div>


<a name="7.4.5 Mapping to Response Codes"><!-- Legacy link --></a>
<h2 id="mappingToResponseCodes">7.4.5 レスポンスコードへマッピング</h2>
<div class="hidden-block">Grails also lets you map HTTP response codes to controllers, actions or views. Just use a method name that matches the response code you are interested in:</div>
GrailsではHTTPレスポンスコードをコントローラ、アクション、ビューにマッピングすることができます。使用したいレスポンスコードをメソッド名に指定するだけです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"403"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"forbidden"</span>)
   <span class="java&#45;quote">"404"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"notFound"</span>)
   <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"serverError"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Or you can specify custom error pages:</div>
カスタムエラーページを指定する場合は:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"403"</span>(view: <span class="java&#45;quote">"/errors/forbidden"</span>)
   <span class="java&#45;quote">"404"</span>(view: <span class="java&#45;quote">"/errors/notFound"</span>)
   <span class="java&#45;quote">"500"</span>(view: <span class="java&#45;quote">"/errors/serverError"</span>)
&#125;</pre></div><p class="paragraph"/><h4>エラーハンドリング宣言 <div class="hidden-block">Declarative Error Handling </div></h4><p class="paragraph"/><div class="hidden-block">In addition you can configure handlers for individual exceptions:</div>
特定の例外をのハンドラを定義することも可能です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"403"</span>(view: <span class="java&#45;quote">"/errors/forbidden"</span>)
   <span class="java&#45;quote">"404"</span>(view: <span class="java&#45;quote">"/errors/notFound"</span>)
   <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"illegalArgument"</span>,
         exception: IllegalArgumentException)
   <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"nullPointer"</span>,
         exception: NullPointerException)
   <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"customException"</span>,
         exception: MyException)
   <span class="java&#45;quote">"500"</span>(view: <span class="java&#45;quote">"/errors/serverError"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With this configuration, an <code>IllegalArgumentException</code> will be handled by the <code>illegalArgument</code> action in <code>ErrorsController</code>, a <code>NullPointerException</code> will be handled by the <code>nullPointer</code> action, and a <code>MyException</code> will be handled by the <code>customException</code> action. Other exceptions will be handled by the catch-all rule and use the <code>/errors/serverError</code> view.</div>
この設定では、<code>IllegalArgumentException</code>は<code>ErrorsControlle</code>rの<code>illegalArgument</code>、<code>NullPointerException</code>は<code>nullPointer</code>アクション、<code>MyException</code>は<code>customException</code>アクションでそれぞれ処理されます。その他の例外がcatch-allルールでハンドルされビューに<code>/errors/serverError</code>を使用します。<p class="paragraph"/><div class="hidden-block">You can access the exception from your custom error handing view or controller action using the request's <code>exception</code> attribute like so:</div>
カスタムエラーハンドリングで、ビューまたは、コントローラアクションから例外を参照するには、requestインスタンスの<code>exception</code>を使用します:<p class="paragraph"/><div class="code"><pre>class ErrorController &#123;
    def handleError() &#123;
        def exception = request.exception
        // perform desired processing to handle the exception
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">If your error-handling controller action throws an exception as well, you'll end up with a <code>StackOverflowException</code>.</div>
エラーハンドリング用のコントローラアクションが例外を出した場合は、最終的に<code>StackOverflowException</code>になります。
</blockquote>


<a name="7.4.6 Mapping to HTTP methods"><!-- Legacy link --></a>
<h2 id="mappingHTTP">7.4.6 HTTPメソッドへマッピング</h2>
<div class="hidden-block">URL mappings can also be configured to map based on the HTTP method (GET, POST, PUT or DELETE). This is very useful for RESTful APIs and for restricting mappings based on HTTP method.</div>
URLマッピングでは、HTTPメソッド(GET, POST, PUT, DELETE)へのマップを定義することができます。HTTPメソッドをベースに制限したり、RESTful API等に便利です。<p class="paragraph"/><div class="hidden-block">As an example the following mappings provide a RESTful API URL mappings for the <code>ProductController</code>:</div>
このマッピングの例では<code>ProductController</code>用にRESTful API URLマッピングを提供しています:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"/product/$id"</span>(controller:<span class="java&#45;quote">"product"</span>) &#123;
       action = &#91;GET:<span class="java&#45;quote">"show"</span>, PUT:<span class="java&#45;quote">"update"</span>, DELETE:<span class="java&#45;quote">"delete"</span>, POST:<span class="java&#45;quote">"save"</span>&#93;
   &#125;
&#125;</pre></div>

<a name="7.4.7 Mapping Wildcards"><!-- Legacy link --></a>
<h2 id="mappingWildcards">7.4.7 マッピングワイルドカード</h2>
<div class="hidden-block">Grails' URL mappings mechanism also supports wildcard mappings. For example consider the following mapping:</div>
GrailsのURLマッピング機能ではワイルドカードもサポートしています。例として次ぎのマッピングに注目してください:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/images/&#42;.jpg"</span>(controller: <span class="java&#45;quote">"image"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This mapping will match all paths to images such as <code>/image/logo.jpg</code>. Of course you can achieve the same effect with a variable:</div>
このマッピングが<code>/image/logo.jpg</code>のような画像パスにマッチします。変数も使用可能です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/images/$name.jpg"</span>(controller: <span class="java&#45;quote">"image"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">However, you can also use double wildcards to match more than one level below:</div>
ダブルワイルドカード使用すると1レベル下の階層までマッチします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/images/&#42;&#42;.jpg"</span>(controller: <span class="java&#45;quote">"image"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this cases the mapping will match <code>/image/logo.jpg</code> as well as <code>/image/other/logo.jpg</code>. Even better you can use a double wildcard variable:</div>
このマッピング例では、<code>/image/logo.jpg</code>や、<code>/image/other/logo.jpg</code>にマッチします。ダブルワイルドカード変数も使用できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    // will match /image/logo.jpg and /image/other/logo.jpg
    <span class="java&#45;quote">"/images/$name&#42;&#42;.jpg"</span>(controller: <span class="java&#45;quote">"image"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case it will store the path matched by the wildcard inside a <code>name</code> parameter obtainable from the <a href="../ref/Controllers/params.html" class="controllers">params</a> object:</div>
この例では、<code>name</code>パラメータにマッチしたパスを<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトから取得できます:<p class="paragraph"/><div class="code"><pre>def name = params.name
println name // prints <span class="java&#45;quote">"logo"</span> or <span class="java&#45;quote">"other/logo"</span></pre></div><p class="paragraph"/><div class="hidden-block">If you use wildcard URL mappings then you may want to exclude certain URIs from Grails' URL mapping process. To do this you can provide an <code>excludes</code> setting inside the <code>UrlMappings.groovy</code> class:</div>
ワイルドカードURLマッピングを使用すると、一定のURIをURLマッピングでの除外も必要となります。<code>UrlMappings.groovy</code>クラスで、<code>excludes</code>を指定することで可能です:<p class="paragraph"/><div class="code"><pre>class UrlMappings &#123;
    <span class="java&#45;keyword">static</span> excludes = &#91;<span class="java&#45;quote">"/images/&#42;"</span>, <span class="java&#45;quote">"/css/&#42;"</span>&#93;
    <span class="java&#45;keyword">static</span> mappings = &#123;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case Grails won't attempt to match any URIs that start with <code>/images</code> or <code>/css</code>.</div>
この例では、 <code>/images</code>また<code>/css</code>で始まるURIはURLマッピングから除外されます.


<a name="7.4.8 Automatic Link Re-Writing"><!-- Legacy link --></a>
<h2 id="automaticLinkRewriting">7.4.8 自動リンクリライト</h2>
<div class="hidden-block">Another great feature of URL mappings is that they automatically customize the behaviour of the <a href="../ref/Tags/link.html" class="tags">link</a> tag so that changing the mappings don't require you to go and change all of your links.</div>
URLマッピングには、<a href="../ref/Tags/link.html" class="tags">link</a>タグの振る舞いを自動的にカスタマイズ するという優れた機能が存在します。その機能のおかげでURLマッピングを変更しても、その都度リンクを変更しなくても良くなります。<p class="paragraph"/><div class="hidden-block">This is done through a URL re-writing technique that reverse engineers the links from the URL mappings. So given a mapping such as the blog one from an earlier section:</div>
URLマッピングからリバースエンジニアリングによってURLをリライトするという仕組みで実装されています。前のセクションからのブログマッピングを例があるとします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"/$blog/$year?/$month?/$day?/$id?"</span>(controller:<span class="java&#45;quote">"blog"</span>, action:<span class="java&#45;quote">"show"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you use the link tag as follows:</div>
以下のようにlinkタグを使用します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:link controller=<span class="xml&#45;quote">"blog"</span> action=<span class="xml&#45;quote">"show"</span>
        params=<span class="xml&#45;quote">"&#91;blog:'fred', year:2007&#93;"</span>&#62;</span>
    My Blog
<span class="xml&#45;tag">&#60;/g:link&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:link controller=<span class="xml&#45;quote">"blog"</span> action=<span class="xml&#45;quote">"show"</span>
        params=<span class="xml&#45;quote">"&#91;blog:'fred', year:2007, month:10&#93;"</span>&#62;</span>
    My Blog &#45; October 2007 Posts
<span class="xml&#45;tag">&#60;/g:link&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Grails will automatically re-write the URL in the correct format:</div>
GrailsがURLを自動的にリライトします:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/fred/2007"</span>&#62;</span>My Blog<span class="xml&#45;tag">&#60;/a&#62;</span>
<span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/fred/2007/10"</span>&#62;</span>My Blog &#45; October 2007 Posts<span class="xml&#45;tag">&#60;/a&#62;</span></pre></div>


<a name="7.4.9 Applying Constraints"><!-- Legacy link --></a>
<h2 id="applyingConstraints">7.4.9 制約の適用</h2>
<div class="hidden-block">URL Mappings also support Grails' unified <a href="../guide/single.html#constraints" class="guide">validation constraints</a> mechanism, which lets you further "constrain" how a URL is matched. For example, if we revisit the blog sample code from earlier, the mapping currently looks like this:</div>
URLマッピングでは、URLがマッチしてるか確認するために、<a href="../guide/single.html#constraints" class="guide">バリデーション制約</a>が使用できます。例として、前と同じブログのサンプルを使用します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"/$blog/$year?/$month?/$day?/$id?"</span>(controller:<span class="java&#45;quote">"blog"</span>, action:<span class="java&#45;quote">"show"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This allows URLs such as:</div>
以下のURLを許可します:<p class="paragraph"/><div class="code"><pre>/graemerocher/2007/01/10/my_funky_blog_entry</pre></div><p class="paragraph"/><div class="hidden-block">However, it would also allow:</div>
もちろんこのままでは、以下のようなURLも許可します:<p class="paragraph"/><div class="code"><pre>/graemerocher/not_a_year/not_a_month/not_a_day/my_funky_blog_entry</pre></div><p class="paragraph"/><div class="hidden-block">This is problematic as it forces you to do some clever parsing in the controller code. Luckily, URL Mappings can be constrained to further validate the URL tokens:</div>
これが許可されるといたずらされる危険性があります。ここで！URLマッピングに制約を定義してURLトークンをバリデートします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/$blog/$year?/$month?/$day?/$id?"</span> &#123;
     controller = <span class="java&#45;quote">"blog"</span>
     action = <span class="java&#45;quote">"show"</span>
     constraints &#123;
          year(matches:/&#92;d&#123;4&#125;/)
          month(matches:/&#92;d&#123;2&#125;/)
          day(matches:/&#92;d&#123;2&#125;/)
     &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the constraints ensure that the <code>year</code>, <code>month</code> and <code>day</code> parameters match a particular valid pattern thus relieving you of that burden later on.</div>
この例では、<code>year</code>,<code>month</code>,<code>day</code>パラメータが特定のパターンにマッチするように制約を定義しています。


<a name="7.4.10 Named URL Mappings"><!-- Legacy link --></a>
<h2 id="namedMappings">7.4.10 名前付きURLマッピング</h2>
<div class="hidden-block">URL Mappings also support named mappings, that is mappings which have a name associated with them. The name may be used to refer to a specific mapping when links are generated.</div>
URLマッピングでは、名前で連携ができるように、名前付きマッピングに対応しています。<p class="paragraph"/><div class="hidden-block">The syntax for defining a named mapping is as follows:</div>
名前付きマッピングの定義は以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   name &#60;mapping name&#62;: &#60;url pattern&#62; &#123;
      // &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">For example:</div>
例として:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    name personList: <span class="java&#45;quote">"/showPeople"</span> &#123;
        controller = 'person'
        action = 'list'
    &#125;
    name accountDetails: <span class="java&#45;quote">"/details/$acctNumber"</span> &#123;
        controller = 'product'
        action = 'accountDetails'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The mapping may be referenced in a link tag in a GSP.</div>
次のように、GSPでlinkタグからマッピングを参照します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:link mapping=<span class="xml&#45;quote">"personList"</span>&#62;</span>List People<span class="xml&#45;tag">&#60;/g:link&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">That would result in:</div>
この結果は以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/showPeople"</span>&#62;</span>List People<span class="xml&#45;tag">&#60;/a&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Parameters may be specified using the params attribute.</div>
params属性でパラメータを定義することができます.<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:link mapping=<span class="xml&#45;quote">"accountDetails"</span> params=<span class="xml&#45;quote">"&#91;acctNumber:'8675309'&#93;"</span>&#62;</span>
    Show Account
<span class="xml&#45;tag">&#60;/g:link&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">That would result in:</div>
この例の結果は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/details/8675309"</span>&#62;</span>Show Account<span class="xml&#45;tag">&#60;/a&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Alternatively you may reference a named mapping using the link namespace.</div>
名前付きマッピングでは、linkタグの代わりに、linkネームスペースのタグが使用できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;link:personList&#62;</span>List People<span class="xml&#45;tag">&#60;/link:personList&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">That would result in:</div>
この例の結果は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/showPeople"</span>&#62;</span>List People<span class="xml&#45;tag">&#60;/a&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The link namespace approach allows parameters to be specified as attributes.</div>
linkネームスペースタグでは、パラメータを属性で指定できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;link:accountDetails acctNumber=<span class="xml&#45;quote">"8675309"</span>&#62;</span>Show Account<span class="xml&#45;tag">&#60;/link:accountDetails&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">That would result in:</div>
この例の結果は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/details/8675309"</span>&#62;</span>Show Account<span class="xml&#45;tag">&#60;/a&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">To specify attributes that should be applied to the generated <code>href</code>, specify a <code>Map</code> value to the <code>attrs</code> attribute.  These attributes will be applied directly to the href, not passed through to be used as request parameters.</div>
属性に指定した全ての内容は生成された<code>href</code>に適用されてしまうので、他の属性は、<code>attrs</code>属性に<code>Map</code>で指定します。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;link:accountDetails attrs=<span class="xml&#45;quote">"&#91;class: 'fancy'&#93;"</span> acctNumber=<span class="xml&#45;quote">"8675309"</span>&#62;</span>
    Show Account
<span class="xml&#45;tag">&#60;/link:accountDetails&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">That would result in:</div>
この例の結果は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"/details/8675309"</span> class=<span class="xml&#45;quote">"fancy"</span>&#62;</span>Show Account<span class="xml&#45;tag">&#60;/a&#62;</span></pre></div>



<h2 id="customizingUrlFormat">7.4.11 URLフォーマットのカスタマイズ</h2>
<div class="hidden-block">The default URL Mapping mechanism supports camel case names in the URLs.  The default URL for accessing an action named <code>addNumbers</code> in a controller named <code>MathHelperController</code> would be something like <code>/mathHelper/addNumbers</code>.  Grails allows for the customization of this pattern and provides an implementation which replaces the camel case convention with a hyphenated convention that would support URLs like <code>/math-helper/add-numbers</code>.  To enable hyphenated URLs assign a value of "hyphenated" to the <code>grails.web.url.converter</code> property in <code>grails-app/conf/Config.groovy</code>.
</div>
URLでの
URLマッピングは、デフォルトでキャメルケースのURLになります。例えばコントローラ<code>MathHelperController</code>のアクション<code>addNumbers</code>の場合、デフォルトURLでのURLは、<code>/mathHelper/addNumbers</code>のようになります。Grailsでは、このパターンをカスタマイズして、<code>/math-helper/add-numbers</code>のようなハイフン形式にキャメルケース形式を入れ換える実装が可能です。ハイフンURLを可能にするには、<code>grails-app/conf/Config.groovy</code>の<code>grails.web.url.converter</code>を"hyphenated"にします。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/Config.groovy<p class="paragraph"/>grails.web.url.converter = 'hyphenated'</pre></div><p class="paragraph"/><div class="hidden-block">
Arbitrary strategies may be plugged in by providing a class which implements the <a href="http://grails.org/doc/latest/api/grails/web/UrlConverter.html" class="api">UrlConverter</a> interface and adding an instance of that class to the Spring application context with the bean name of <code>grails.web.UrlConverter.BEAN_NAME</code>.  If Grails finds a bean in the context with that name, it will be used as the default converter and there is no need to assign a value to the <code>grails.web.url.converter</code> config property.
</div>
任意の方法追加するには、インターフェイス<a href="http://grails.org/doc/latest/api/grails/web/UrlConverter.html" class="api">UrlConverter</a>を実装したクラスを、ビーン名称<code>grails.web.UrlConverter.BEAN_NAME</code>で追加します。Grailsがそのビーン名称をコンテキストに有ることを認識した場合、指定したクラスの実装がデフォルトとなります。この場合は、<code>grails.web.url.converter</code>プロパティは必要有りません。
<div class="hidden-block">
<div class="code"><pre>// src/groovy/com/myapplication/MyUrlConverterImpl.groovy<p class="paragraph"/><span class="java&#45;keyword">package</span> com.myapplication<p class="paragraph"/>class MyUrlConverterImpl <span class="java&#45;keyword">implements</span> grails.web.UrlConverter &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> toUrlElement(<span class="java&#45;object">String</span> propertyOrClassName) &#123;
        // <span class="java&#45;keyword">return</span> some representation of a property or class name that should be used in URLs&#8230;
    &#125;
&#125;</pre></div>
</div>
<div class="code"><pre>// src/groovy/com/myapplication/MyUrlConverterImpl.groovy<p class="paragraph"/><span class="java&#45;keyword">package</span> com.myapplication<p class="paragraph"/>class MyUrlConverterImpl <span class="java&#45;keyword">implements</span> grails.web.UrlConverter &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> toUrlElement(<span class="java&#45;object">String</span> propertyOrClassName) &#123;
        // URLで描写するプロパティ名またはクラス名を返す
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy<p class="paragraph"/>beans = &#123;
    <span class="java&#45;quote">"$&#123;grails.web.UrlConverter.BEAN_NAME&#125;"</span>(com.myapplication.MyUrlConverterImpl)
&#125;</pre></div>



<h2 id="namespacedControllers">7.4.12 コントローラネームスペース</h2>
If an application defines multiple controllers with the same name
in different packages, the controllers must be defined in a
namespace.  The way to define a namespace for a controller is to 
define a static property named <code>namespace</code> in the controller and 
assign a String to the property that represents the namespace.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/com/app/reporting/AdminController.groovy
<span class="java&#45;keyword">package</span> com.app.reporting<p class="paragraph"/>class AdminController &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> namespace = 'reports'<p class="paragraph"/>    // &#8230;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/com/app/security/AdminController.groovy
<span class="java&#45;keyword">package</span> com.app.security<p class="paragraph"/>class AdminController &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> namespace = 'users'<p class="paragraph"/>    // &#8230;
&#125;</pre></div><p class="paragraph"/>When defining url mappings which should be associated with a namespaced
controller, the <code>namespace</code> variable needs to be part of the URL mapping.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/UrlMappings.groovy
class UrlMappings &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mappings = &#123;
        '/userAdmin' &#123;
            controller = 'admin'
            namespace = 'users'
        &#125;<p class="paragraph"/>        '/reportAdmin' &#123;
            controller = 'admin'
            namespace = 'reports'
        &#125;<p class="paragraph"/>        <span class="java&#45;quote">"/$namespace/$controller/$action?"</span>()
    &#125;
&#125;</pre></div><p class="paragraph"/>Reverse URL mappings also require that the <code>namespace</code> be specified.<p class="paragraph"/><div class="code"><pre>&#60;g:link controller=<span class="java&#45;quote">"admin"</span> namespace=<span class="java&#45;quote">"reports"</span>&#62;Click For Report Admin&#60;/g:link&#62;
&#60;g:link controller=<span class="java&#45;quote">"admin"</span> namespace=<span class="java&#45;quote">"users"</span>&#62;Click For User Admin&#60;/g:link&#62;</pre></div><p class="paragraph"/>When resolving a URL mapping (forward or reverse) to a namespaced controller,
a mapping will only match if the <code>namespace</code> has been provided.  If
the application provides several controllers with the same name in different
packages, at most 1 of them may be defined without a <code>namespace</code> property.  If
there are multiple controllers with the same name that do not define a
<code>namespace</code> property, the framework will not know how to distinguish between
them for forward or reverse mapping resolutions.<p class="paragraph"/>It is allowed for an application to use a plugin which provides a controller
with the same name as a controller provided by the application and for neither
of the controllers to define a <code>namespace</code> property as long as the
controllers are in separate packages.  For example, an application
may include a controller named <code>com.accounting.ReportingController</code>
and the application may use a plugin which provides a controller
named <code>com.humanresources.ReportingController</code>.  The only issue
with that is the URL mapping for the controller provided by the
plugin needs to be explicit in specifying that the mapping applies
to the <code>ReportingController</code> which is provided by the plugin.<p class="paragraph"/>See the following example.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/accountingReports"</span> &#123;
        controller = <span class="java&#45;quote">"reporting"</span>
    &#125;
    <span class="java&#45;quote">"/humanResourceReports"</span> &#123;
        controller = <span class="java&#45;quote">"reporting"</span>
        plugin = <span class="java&#45;quote">"humanResources"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>With that mapping in place, a request to <code>/accountingReports</code> will
be handled by the <code>ReportingController</code> which is defined in the
application.  A request to <code>/humanResourceReports</code> will be handled
by the <code>ReportingController</code> which is provided by the <code>humanResources</code>
plugin.<p class="paragraph"/>There could be any number of <code>ReportingController</code> controllers provided
by any number of plugins but no plugin may provide more than one
<code>ReportingController</code> even if they are defined in separate packages.<p class="paragraph"/>Assigning a value to the <code>plugin</code> variable in the mapping is only
required if there are multiple controllers with the same name
available at runtime provided by the application and/or plugins.
If the <code>humanResources</code> plugin provides a <code>ReportingController</code> and
there is no other <code>ReportingController</code> available at runtime, the
following mapping would work.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/humanResourceReports"</span> &#123;
        controller = <span class="java&#45;quote">"reporting"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>It is best practice to be explicit about the fact that the controller
is being provided by a plugin.<p class="paragraph"/>


<a name="7.5 Web Flow"><!-- Legacy link --></a>
<h2 id="webflow">7.5 Webフロー</h2>
<h4>概要 <div class="hidden-block">Overview</div></h4><p class="paragraph"/><div class="hidden-block">Grails supports the creation of web flows built on the <a href="http://www.springsource.org/webflow" target="blank">Spring Web Flow</a> project. A web flow is a conversation that spans multiple requests and retains state for the scope of the flow. A web flow also has a defined start and end state.</div>
Grailsでは、<a href="http://www.springsource.org/webflow" target="blank">Spring Web Flow</a> をベースにしたWebフローをサポートしています。Webフローとは、処理範囲での複数のリクエストと保有するステート間の対話です。Webフローでは明示された開始と終了ステートも持っています。<p class="paragraph"/><div class="hidden-block">Web flows don't require an HTTP session, but instead store their state in a serialized form, which is then restored using a flow execution key that Grails passes around as a request parameter. This makes flows far more scalable than other forms of stateful application that use the HttpSession and its inherit memory and clustering concerns.</div>
WebフローにはHTTP sessionは必要有りません。代わりに、リクエストパラメータでGrailsが持ち回る、フローエクスキュージョンキーを使用した連載形式でステートを保持しています。この方式はメモリ継承やクラスタリング問題のあるHttpSessionを使用したステートフルアプリケーションの形式よりもフローをスケーラブルにします。<p class="paragraph"/><div class="hidden-block">Web flow is essentially an advanced state machine that manages the "flow" of execution from one state to the next. Since the state is managed for you, you don't have to be concerned with ensuring that users enter an action in the middle of some multi step flow, as web flow manages that for you. This makes web flow perfect for use cases such as shopping carts, hotel booking and any application that has multi page work flows.</div>
Webフローは本質的には、"フロー"の実行のステートの流れを管理する上級ステートマシーンです。
ステートが管理されると、Webフローが管理してくれるので、ユーザがフロー途中のアクションから入ってくる場合どうするか等を気にしなくても良くなります。これによりショッピングカート、ホテル予約などの複数ページにまたがるワークフローを持つアプリケーションにWebフローがよく合うと言う事です。<p class="paragraph"/>
<blockquote class="note">
<div class="hidden-block">From Grails 1.2 onwards Webflow is no longer in Grails core, so you must install the Webflow plugin to use this feature.</div>
Grails 1.2からWebフローはGrailsのコア機能では無くなりました。この機能を使用するには、Webフロープラグインをインストールする必要があります. 
</blockquote><p class="paragraph"/><h4>フローの作成 <div class="hidden-block">Creating a Flow</div></h4><p class="paragraph"/><div class="hidden-block">To create a flow create a regular Grails controller and add an action that ends with the convention <code>Flow</code>. For example:</div>
フローを作成するには、名称が<code>Flow</code>で終わるアクションをGrailsの通常にコントローラに作成します。例として:<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>   def index() &#123;
      redirect(action: <span class="java&#45;quote">"shoppingCart"</span>)
   &#125;<p class="paragraph"/>   def shoppingCartFlow = &#123;
        &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Notice when redirecting or referring to the flow as an action we omit the <code>Flow</code> suffix. In other words the name of the action of the above flow is <code>shoppingCart</code>. </div>
フローをアクションとしてリダイレクトまたは参照をするには、接尾辞の<code>Flow</code>を省略します。言い換えれば上記のフローのアクション名は<code>shoppingCart</code>となります。


<a name="7.5.1 Start and End States"><!-- Legacy link --></a>
<h2 id="startAndEndStates">7.5.1 開始と終了のステート</h2>
<div class="hidden-block">As mentioned before a flow has a defined start and end state. A start state is the state which is entered when a user first initiates a conversation (or flow). The start state of a Grails flow is the first method call that takes a block. For example: </div>
前述したように、Webフローでは明示された開始と終了ステートも持っています。開始ステートは、ユーザが最初に対話(またはフロー)を開始するステートです。最初のブロックのメソッドコールがGrailsフローの開始ステートです:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
   &#8230;
   def shoppingCartFlow =&#123;
       showCart &#123;
           on(<span class="java&#45;quote">"checkout"</span>).to <span class="java&#45;quote">"enterPersonalDetails"</span>
           on(<span class="java&#45;quote">"continueShopping"</span>).to <span class="java&#45;quote">"displayCatalogue"</span>
       &#125;
       &#8230;
       displayCatalogue &#123;
           redirect(controller: <span class="java&#45;quote">"catalogue"</span>, action: <span class="java&#45;quote">"show"</span>)
       &#125;
       displayInvoice()
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here the <code>showCart</code> node is the start state of the flow. Since the showCart state doesn't define an action or redirect it is assumed be a <a href="../guide/single.html#actionStatesAndViewStates" class="guide">view state</a> that, by convention, refers to the view  <code>grails-app/views/book/shoppingCart/showCart.gsp</code>.</div>
この例でのフローの開始ステートは<code>showCart</code>ノードになります。showCartがアクションまたリダイレクトを定義していない場合は、慣習により<code>grails-app/views/book/shoppingCart/showCart.gsp</code>を参照して表示する<a href="../guide/single.html#actionStatesAndViewStates" class="guide">ビューステート</a>として見なされます。<p class="paragraph"/>
<div class="hidden-block">Notice that unlike regular controller actions, the views are stored within a directory that matches the name of the flow: <code>grails-app/views/book/shoppingCart</code>.</div>
通常のコントローラアクションと違い、ビューファイルはフロー名称のディレクトリに配置された物にマッチします:<code>grails-app/views/book/shoppingCart</code><p class="paragraph"/><div class="hidden-block">The <code>shoppingCart</code> flow also has two possible end states. The first is <code>displayCatalogue</code> which performs an external redirect to another controller and action, thus exiting the flow. The second is <code>displayInvoice</code> which is an end state as it has no events at all and will simply render a view called <code>grails-app/views/book/shoppingCart/displayInvoice.gsp</code> whilst ending the flow at the same time. </div>
この<code>shoppingCart</code>フローには、２つの終了ステートがあります。一つ目のステートは、外部のコントローラアクションにリダイレクトしてフローから出る<code>displayCatalogue</code>。二つ目のステートは、何もイベント処理が無く単純に、ビューの<code>grails-app/views/book/shoppingCart/displayInvoice.gsp</code>を描写して同時にフローを終了する、<code>displayInvoice</code>です。<p class="paragraph"/><div class="hidden-block">Once a flow has ended it can only be resumed from the start state, in this case <code>showCart</code>, and not from any other state.</div>
フローが終了したら、開始フローのみから再開できます。この例では<code>showCart</code>になります。


<a name="7.5.2 Action States and View States"><!-- Legacy link --></a>
<h2 id="actionStatesAndViewStates">7.5.2 アクションステートとビューステート</h2>
<h4>ビューステート <div class="hidden-block">View states</div></h4><p class="paragraph"/><div class="hidden-block">A view state is a one that doesn't define an <code>action</code> or a <code>redirect</code>. So for example this is a view state:</div>
<code>action</code>また<code>ridairect</code>を定義していないものがビューステートです。この例がビューステートになります:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   on(<span class="java&#45;quote">"submit"</span>).to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">It will look for a view called <code>grails-app/views/book/shoppingCart/enterPersonalDetails.gsp</code> by default. Note that the <code>enterPersonalDetails</code> state defines two events: <code>submit</code> and <code>return</code>. The view is responsible for <a href="../guide/single.html#flowExecutionEvents" class="guide">triggering</a> these events. Use the <code>render</code> method to change the view to be rendered:
</div>
デフォルトでは、ビューファイル<code>grails-app/views/book/shoppingCart/enterPersonalDetails.gsp</code>を使用します。<code>enterPersonalDetails</code>ステートは、<code>submit</code>と<code>return</code>という２つのイベントを定義しています。これらのイベントはビューで<a href="../guide/single.html#flowExecutionEvents" class="guide">トリガー</a>する必要があります。<code>render</code>メソッドを使用して描写するビューを変更することが可能です:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   render(view: <span class="java&#45;quote">"enterDetailsView"</span>)
   on(<span class="java&#45;quote">"submit"</span>).to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Now it will look for <code>grails-app/views/book/shoppingCart/enterDetailsView.gsp</code>. Start the <code>view</code> parameter with a / to use a shared view:</div>
この例で<code>grails-app/views/book/shoppingCart/enterDetailsView.gsp</code>を参照するようになります。<code>view</code>のパラメータに / を使用して共有ビューを使用できます:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   render(view: <span class="java&#45;quote">"/shared/enterDetailsView"</span>)
   on(<span class="java&#45;quote">"submit"</span>).to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Now it will look for <code>grails-app/views/shared/enterDetailsView.gsp</code> </div>
この例で<code>grails-app/views/shared/enterDetailsView.gsp</code>を参照するようになります。<p class="paragraph"/><h4>アクションステート <div class="hidden-block">Action States</div></h4><p class="paragraph"/><div class="hidden-block">An action state is a state that executes code but does not render a view. The result of the action is used to dictate flow transition. To create an action state you define an action to to be executed. This is done by calling the <code>action</code> method and passing it a block of code to be executed:</div>
アクションステートはコードを実行してビューを描写しないステートです。アクションの結果は指示されたフロートランジションで使用されます。<code>action</code>メソッドに実行したいコードブロックを渡してアクションステートを実装します:<p class="paragraph"/><div class="code"><pre>listBooks &#123;
   action &#123;
      &#91;bookList: Book.list()&#93;
   &#125;
   on(<span class="java&#45;quote">"success"</span>).to <span class="java&#45;quote">"showCatalogue"</span>
   on(Exception).to <span class="java&#45;quote">"handleError"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">As you can see an action looks very similar to a controller action and in fact you can reuse controller actions if you want. If the action successfully returns with no errors the <code>success</code> event will be triggered. In this case since we return a Map, which is regarded as the "model" and is automatically placed in <a href="../guide/single.html#flowScopes" class="guide">flow scope</a>.</div>
ご覧の通りアクションはコントローラアクションに似ています。もちろん必要であればコントローラアクションを再利用することもできます。アクションが正常に終了したら<code>success</code>イベントがトリガーされます。この例では、モデルと見なしたMapを返して自動的に<a href="../guide/single.html#flowScopes" class="guide">flowスコープ</a>に配置されます。<p class="paragraph"/><div class="hidden-block">In addition, in the above example we also use an exception handler to deal with errors on the line:</div>
加えて、上記の例では、エラーを取り扱う例外ハンドラも使用しています:<p class="paragraph"/><div class="code"><pre>on(Exception).to <span class="java&#45;quote">"handleError"</span></pre></div><p class="paragraph"/><div class="hidden-block">This makes the flow transition to a state called <code>handleError</code> in the case of an exception.</div>
例外時に<code>handleError</code>というステートにフローが移行します。<p class="paragraph"/><div class="hidden-block">You can write more complex actions that interact with the flow request context:</div>
フローリクエストコンテキストとやりとりをする複雑なアクションを記述できます:<p class="paragraph"/><div class="code"><pre>processPurchaseOrder &#123;
    action &#123;
        def a =  flow.address
        def p = flow.person
        def pd = flow.paymentDetails
        def cartItems = flow.cartItems
        flow.clear()<p class="paragraph"/>        def o = <span class="java&#45;keyword">new</span> Order(person: p, shippingAddress: a, paymentDetails: pd)
        o.invoiceNumber = <span class="java&#45;keyword">new</span> Random().nextInt(9999999)
        <span class="java&#45;keyword">for</span> (item in cartItems) &#123; o.addToItems item &#125;
        o.save()
        &#91;order: o&#93;
    &#125;
    on(<span class="java&#45;quote">"error"</span>).to <span class="java&#45;quote">"confirmPurchase"</span>
    on(Exception).to <span class="java&#45;quote">"confirmPurchase"</span>
    on(<span class="java&#45;quote">"success"</span>).to <span class="java&#45;quote">"displayInvoice"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here is a more complex action that gathers all the information accumulated from the flow scope and creates an <code>Order</code> object. It then returns the order as the model. The important thing to note here is the interaction with the request context and "flow scope".</div>
この例では、アクションで、flowスコープから収集した情報から<code>Order</code>オブジェクトを生成しています。そして生成後オーダーをモデルで返しています。ここで重要なのはリクエストコンテキストと"flowスコープ"のやりとりです。<p class="paragraph"/><h4>アクションのトランジション <div class="hidden-block">Transition Actions</div></h4><p class="paragraph"/><div class="hidden-block">Another form of action is what is known as a  <em class="italic">transition</em>  action. A transition action is executed directly prior to state transition once an <a href="../guide/single.html#flowExecutionEvents" class="guide">event</a> has been triggered. A simple example of a transition action can be seen below:</div>
他の形式のアクションとしてトランジションアクションがあります。トランジションアクションは、<a href="../guide/single.html#flowExecutionEvents" class="guide">イベント</a>がトリガーされたら、トランジションステートで直接優先的に実行されます:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   on(<span class="java&#45;quote">"submit"</span>) &#123;
       log.trace <span class="java&#45;quote">"Going to enter shipping"</span>
   &#125;.to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Notice how we pass a block of the code to <code>submit</code> event that simply logs the transition. Transition states are very useful for <a href="../guide/single.html#dataBindingAndValidation" class="guide">data binding and validation</a>, which is covered in a later section.</div>
この例では、<code>submit</code>イベントにコードブロックを渡してトランジションのログを実行しています。この後に解説をする、<a href="../guide/single.html#dataBindingAndValidation" class="guide">データバインディングとバリデーション</a>で、このトランジションステートが便利に活用できます。


<a name="7.5.3 Flow Execution Events"><!-- Legacy link --></a>
<h2 id="flowExecutionEvents">7.5.3 フロー実行イベント</h2>
<div class="hidden-block">In order to  <em class="italic">transition</em>  execution of a flow from one state to the next you need some way of trigger an  <em class="italic">event</em>  that indicates what the flow should do next. Events can be triggered from either view states or action states.</div>
ステートから次のステートへのフローでの  <em class="italic">トランジション</em>  実行ができると、次のフローの  <em class="italic">イベントトリガー</em>  を指定する方法が必要になります。ビューステートまたはアクションステートからイベントをトリガーできます。<p class="paragraph"/><h4>ビューステートからのイベントトリガー <div class="hidden-block">Triggering Events from a View State</div></h4><p class="paragraph"/><div class="hidden-block">As discussed previously the start state of the flow in a previous code listing deals with two possible events. A <code>checkout</code> event and a <code>continueShopping</code> event:</div>
前のコードの例と同じく、フローの開始ステートには２つのイベントを与えます。<code>checkout</code>イベントと<code>continueShopping</code>イベントです:<p class="paragraph"/><div class="code"><pre>def shoppingCartFlow = &#123;
    showCart &#123;
        on(<span class="java&#45;quote">"checkout"</span>).to <span class="java&#45;quote">"enterPersonalDetails"</span>
        on(<span class="java&#45;quote">"continueShopping"</span>).to <span class="java&#45;quote">"displayCatalogue"</span>
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Since the <code>showCart</code> event is a view state it will render the view <code>grails-app/book/shoppingCart/showCart.gsp</code>. Within this view you need to have components that trigger flow execution. On a form this can be done use the <a href="../ref/Tags/submitButton.html" class="tags">submitButton</a> tag:</div>
<code>shopCart</code>イベントはビューステートなので、<code>grails-app/book/shoppingCart/showCart.gsp</code>を描写します。このビューの中に、フロートリガーを実行するコンポーネントを持つ必要があります。 <a href="../ref/Tags/submitButton.html" class="tags">submitButton</a>タグを使用したフォームを使います:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:form&#62;</span>
    <span class="xml&#45;tag">&#60;g:submitButton name=<span class="xml&#45;quote">"continueShopping"</span> value=<span class="xml&#45;quote">"Continue Shopping"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;g:submitButton name=<span class="xml&#45;quote">"checkout"</span> value=<span class="xml&#45;quote">"Checkout"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/g:form&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The form automatically submits back to the <code>shoppingCart</code> flow. The name attribute of each <a href="../ref/Tags/submitButton.html" class="tags">submitButton</a> tag signals which event will be triggered. If you don't have a form you can also trigger an event with the <a href="../ref/Tags/link.html" class="tags">link</a> tag as follows:</div>
フォームは自動的に<code>shoppingCart</code>フローへ送信します。それぞれの<a href="../ref/Tags/submitButton.html" class="tags">submitButton</a>タグのname属性にトリガーするイベントを指定します。フォームを使用しない場合は、次のように<a href="../ref/Tags/link.html" class="tags">link</a>タグをイベントトリガーに使用できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:link event=<span class="xml&#45;quote">"checkout"</span> /&#62;</span></pre></div><p class="paragraph"/><blockquote class="note">
Prior to 2.0.0, it was required to specify the controller and/or action in forms and links, which caused the url to change when entering a subflow state. When the controller and action are not specified,
all url's are relative to the main flow execution url, which makes your flows reusable as subflows and prevents issues with the browser's back button.
</blockquote><p class="paragraph"/><h4>アクションからのイベントトリガー <div class="hidden-block">Triggering Events from an Action</div></h4><p class="paragraph"/><div class="hidden-block">To trigger an event from an <code>action</code> you invoke a method. For example there is the built in <code>error()</code> and <code>success()</code> methods. The example below triggers the <code>error()</code> event on validation failure in a transition action:</div>
アクションからイベントをトリガーするには、メソッドを実行します。組込の<code>error()</code>と<code>success()</code>メソッド(トランジションアクション)が有るのでそれを例に使用します。次の例では、トランジションアクションでバリデーションが失敗したら<code>error()</code>イベントをトリガーしています:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   on(<span class="java&#45;quote">"submit"</span>) &#123;
         def p = <span class="java&#45;keyword">new</span> Person(params)
         flow.person = p
         <span class="java&#45;keyword">if</span> (!p.validate()) <span class="java&#45;keyword">return</span> error()
   &#125;.to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case because of the error the transition action will make the flow go back to the <code>enterPersonalDetails</code> state.</div>
このケースでは、errorトランジションアクションにより、フローは<code>enterPersonalDetails</code>ステートに戻ります。<p class="paragraph"/><div class="hidden-block">With an action state you can also trigger events to redirect flow:</div>
アクションステートでは、リダイレクトフローへイベントをトリガーできます:<p class="paragraph"/><div class="code"><pre>shippingNeeded &#123;
   action &#123;
       <span class="java&#45;keyword">if</span> (params.shippingRequired) yes()
       <span class="java&#45;keyword">else</span> no()
   &#125;
   on(<span class="java&#45;quote">"yes"</span>).to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"no"</span>).to <span class="java&#45;quote">"enterPayment"</span>
&#125;</pre></div><p class="paragraph"/>

<a name="7.5.4 Flow Scopes"><!-- Legacy link --></a>
<h2 id="flowScopes">7.5.4 フローのスコープ</h2>
<h4>スコープの基礎 <div class="hidden-block">Scope Basics</div></h4><p class="paragraph"/><div class="hidden-block">You'll notice from previous examples that we used a special object called <code>flow</code> to store objects within "flow scope". Grails flows have five different scopes you can utilize:</div>
先ほどの例で、"フロー範囲で有効な"オブジェクトを蓄積する、<code>flow</code>という特殊なオブジェクトを使用しました。Grailsフローでは５つのスコープが利用できます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>request</code> - Stores an object for the scope of the current request</li>
<li><code>flash</code> - Stores the object for the current and next request only</li>
<li><code>flow</code> - Stores objects for the scope of the flow, removing them when the flow reaches an end state</li>
<li><code>conversation</code> - Stores objects for the scope of the conversation including the root flow and nested subflows</li>
<li><code>session</code> - Stores objects in the user's session</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>request - 現在のリクエスト範囲のオブジェクトを蓄積</li>
<li>flash - 現在と次までが有効範囲のオブジェクトを蓄積</li>
<li>flow - フロー範囲で有効なオブジェクトを蓄積。フローが終了ステートに到達したら削除されます。</li>
<li>conversation - ルートフローやサブフローを含む範囲での対話でのオブジェクトを蓄積</li>
<li>session - ユーザのセッションへオブジェクトを蓄積</li>
</ul><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Grails service classes can be automatically scoped to a web flow scope. See the documentation on <a href="../guide/single.html#services" class="guide">Services</a> for more information.</div>
Grailsサービスクラスは自動的にflowスコープになります。詳しくは<a href="../guide/single.html#services" class="guide">サービス</a>を参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">Returning a model Map from an action will automatically result in the model being placed in flow scope. For example, using a transition action, you can place objects within <code>flow</code> scope as follows:</div>
アクションからモデルMapを返すと自動的に結果にあるモデルがflowスコープに配置されます。例としてトランジションアクションで次のように<code>flow</code>スコープにオブジェクトを配置できます:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
    on(<span class="java&#45;quote">"submit"</span>) &#123;
        &#91;person: <span class="java&#45;keyword">new</span> Person(params)&#93;
    &#125;.to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Be aware that a new request is always created for each state, so an object placed in request scope in an action state (for example) will not be available in a subsequent view state. Use one of the other scopes to pass objects from one state to another. Also note that Web Flow:</div>
それぞれのステートごとに新しいrequestスコープができます、(例えば)アクションステートのrequestスコープに配置したオブジェクトは次のビューステートでは使用できません。他のステートにオブジェクトを渡す場合は別のスコープを使いましょう。さらにWebフローでは:<p class="paragraph"/><div class="hidden-block">
<ol>
<li>Moves objects from flash scope to request scope upon transition between states;</li>
<li>Merges objects from the flow and conversation scopes into the view model before rendering (so you shouldn't include a scope prefix when referencing these objects within a view, e.g. GSP pages).</li>
</ol><p class="paragraph"/></div>
<ol>
<li>ステート間のトランジションでオブジェクトをflashスコープからrequestスコープへ移動します。</li>
<li>描写する前に、flowとconversationスコープのオブジェクトをビューモデルにマージします。(GSPページ等のビューでオブジェクトを参照する際はスコープ接頭辞を含まないでください)</li>
</ol><p class="paragraph"/><h4>フロースコープとシリアライズ <div class="hidden-block">Flow Scopes and Serialization</div></h4><p class="paragraph"/><div class="hidden-block">When placing objects in <code>flash</code>, <code>flow</code> or <code>conversation</code> scope they must implement <code>java.io.Serializable</code> or an exception will be thrown. This has an impact on <a href="../guide/single.html#GORM" class="guide">domain classes</a> in that domain classes are typically placed within a scope so that they can be rendered in a view. For example consider the following domain class:</div>
<code>flash</code>、<code>flow</code>また<code>conversation</code>スコープに配置するオブジェクトは、必ず<code>java.io.Serializable</code>を継承してください。継承しない場合は例外を投げます。<a href="../guide/single.html#GORM" class="guide">ドメインクラス</a>は通常スコープに配置されビューの描写に使用するので影響を受けます。例として次のようなドメインクラスがあるとします:<p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">To place an instance of the <code>Book</code> class in a flow scope you will need to modify it as follows:</div>
<code>Book</code>のインスタンスをflowスコープで使用する場合は次のようにします:<p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">implements</span> Serializable &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This also impacts associations and closures you declare within a domain class. For example consider this:</div>
ドメインクラスに関連するクラスやクロージャにも影響があります。次のようになっていたとします:<p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">implements</span> Serializable &#123;
    <span class="java&#45;object">String</span> title
    Author author
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here if the <code>Author</code> association is not <code>Serializable</code> you will also get an error. This also impacts closures used in <a href="../guide/single.html#eventsAutoTimestamping" class="guide">GORM events</a> such as <code>onLoad</code>, <code>onSave</code> and so on. The following domain class will cause an error if an instance is placed in a flow scope:</div>
関連する<code>Author</code>が<code>Serializable</code>では無い場合はエラーとなります。<code>onLoad</code>や<code>onSave</code>等の<a href="../guide/single.html#eventsAutoTimestamping" class="guide">GORMイベント</a>のクロージャにも影響があります。次のドメインクラスをflowスコープに配置するとエラーとなります:<p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title<p class="paragraph"/>    def onLoad = &#123;
        println <span class="java&#45;quote">"I'm loading"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The reason is that the assigned block on the <code>onLoad</code> event cannot be serialized. To get around this you should declare all events as <code>transient</code>:</div>
理由はアサインされた<code>onLoad</code>イベントのブロックがシリアライズされないからです。これを対応させるにはイベントに<code>transient</code>を指定します:<p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title<p class="paragraph"/>    <span class="java&#45;keyword">transient</span> onLoad = &#123;
        println <span class="java&#45;quote">"I'm loading"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">or as methods:</div>
またはメソッドにします:<p class="paragraph"/><div class="code"><pre>class Book <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title<p class="paragraph"/>    def onLoad() &#123;
        println <span class="java&#45;quote">"I'm loading"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
The flow scope contains a reference to the Hibernate session. As a result, any object loaded into the session through a GORM query will also be in the flow and will need to implement Serializable.<p class="paragraph"/>If you don't want your domain class to be Serializable or stored in the flow, then you will need to evict the entity manually before the end of the state:<p class="paragraph"/><div class="code"><pre>flow.persistenceContext.evict(it)</pre></div>
</blockquote>


<a name="7.5.5 Data Binding and Validation"><!-- Legacy link --></a>
<h2 id="dataBindingAndValidation">7.5.5 データバインディングとバリデーション</h2>
<div class="hidden-block">In the section on <a href="../guide/single.html#startAndEndStates" class="guide">start and end states</a>, the start state in the first example triggered a transition to the <code>enterPersonalDetails</code> state. This state renders a view and waits for the user to enter the required information:</div>
<a href="../guide/single.html#startAndEndStates" class="guide">開始と終了ステート</a>のセクションの中で、最初の例の開始ステートは<code>enterPersonalDetails</code>ステートへトリガーしています。このステートはビューを描写して、ユーザが必要な情報をエントリーするのを待ちます:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   on(<span class="java&#45;quote">"submit"</span>).to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The view contains a form with two submit buttons that either trigger the submit event or the return event:</div>
ビューは、submitイベントまたはreturnイベントをトリガーする、２つの送信ボタンを持つフォームを持っています:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:form&#62;</span>
    <span class="xml&#45;comment">&#60;!&#45;&#45; Other fields &#45;&#45;&#62;</span>
    <span class="xml&#45;tag">&#60;g:submitButton name=<span class="xml&#45;quote">"submit"</span> value=<span class="xml&#45;quote">"Continue"</span>&#62;</span><span class="xml&#45;tag">&#60;/g:submitButton&#62;</span>
    <span class="xml&#45;tag">&#60;g:submitButton name=<span class="xml&#45;quote">"return"</span> value=<span class="xml&#45;quote">"Back"</span>&#62;</span><span class="xml&#45;tag">&#60;/g:submitButton&#62;</span>
<span class="xml&#45;tag">&#60;/g:form&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">However, what about the capturing the information submitted by the form? To capture the form info we can use a flow transition action:</div>
フォームから送信された情報を取り込むには、トランジションアクションを使用します:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   on(<span class="java&#45;quote">"submit"</span>) &#123;
      flow.person = <span class="java&#45;keyword">new</span> Person(params)
      !flow.person.validate() ? error() : success()
   &#125;.to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Notice how we perform data binding from request parameters and place the <code>Person</code> instance within <code>flow</code> scope. Also interesting is that we perform <a href="../guide/single.html#validation" class="guide">validation</a> and invoke the <code>error()</code> method if validation fails. This signals to the flow that the transition should halt and return to the <code>enterPersonalDetails</code> view so valid entries can be entered by the user, otherwise the transition should continue and go to the <code>enterShipping</code> state.</div>
リクエストパラメータからデータバインディングを実行して、<code>flow</code>スコープの<code>Person</code>インスタンスに渡している部分を注目してください。さらに興味深い部分は、<a href="../guide/single.html#validation" class="guide">バリデーション</a>を実行して、失敗したら<code>error()</code>メソッドを実行している部分です。この結果を受け取るとトランジションは停止され<code>enterPersonalDetails</code>ビューへ戻りユーザが正当な内容をエントリできるようになります。あるいは内容が問題無ければ、トランジションが続行されて<code>enterShipping</code>ステートへ移動します。<p class="paragraph"/><div class="hidden-block">Like regular actions, flow actions also support the notion of <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> by defining the first argument of the closure:</div>
通常のアクションと同じく、フローアクションでは、クロージャの最初の引数を定義することで、<a href="../guide/single.html#commandObjects" class="guide">コマンドオブジェクト</a>にも対応できます:<p class="paragraph"/><div class="code"><pre>enterPersonalDetails &#123;
   on(<span class="java&#45;quote">"submit"</span>) &#123; PersonDetailsCommand cmd &#45;&#62;
       flow.personDetails = cmd
      !flow.personDetails.validate() ? error() : success()
   &#125;.to <span class="java&#45;quote">"enterShipping"</span>
   on(<span class="java&#45;quote">"<span class="java&#45;keyword">return</span>"</span>).to <span class="java&#45;quote">"showCart"</span>
&#125;</pre></div>


<a name="7.5.6 Subflows and Conversations"><!-- Legacy link --></a>
<h2 id="subflowsAndConversations">7.5.6 サブフローとの対話</h2>
<div class="hidden-block">Grails' Web Flow integration also supports subflows. A subflow is like a flow within a flow. For example take this search flow:</div>
GrailsのWebフローはサブフローにも対応しています。サブフローはフォローの中にあるフローです。この検索フローを例とします:<p class="paragraph"/><div class="code"><pre>def searchFlow = &#123;
    displaySearchForm &#123;
        on(<span class="java&#45;quote">"submit"</span>).to <span class="java&#45;quote">"executeSearch"</span>
    &#125;
    executeSearch &#123;
        action &#123;
            &#91;results:searchService.executeSearch(params.q)&#93;
        &#125;
        on(<span class="java&#45;quote">"success"</span>).to <span class="java&#45;quote">"displayResults"</span>
        on(<span class="java&#45;quote">"error"</span>).to <span class="java&#45;quote">"displaySearchForm"</span>
    &#125;
    displayResults &#123;
        on(<span class="java&#45;quote">"searchDeeper"</span>).to <span class="java&#45;quote">"extendedSearch"</span>
        on(<span class="java&#45;quote">"searchAgain"</span>).to <span class="java&#45;quote">"displaySearchForm"</span>
    &#125;
    extendedSearch &#123;
        // Extended search subflow
        subflow(controller: <span class="java&#45;quote">"searchExtensions"</span>, action: <span class="java&#45;quote">"extendedSearch"</span>)
        on(<span class="java&#45;quote">"moreResults"</span>).to <span class="java&#45;quote">"displayMoreResults"</span>
        on(<span class="java&#45;quote">"noResults"</span>).to <span class="java&#45;quote">"displayNoMoreResults"</span>
    &#125;
    displayMoreResults()
    displayNoMoreResults()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">It references a subflow in the <code>extendedSearch</code> state. The controller parameter is optional if the subflow is defined in the same controller as the calling flow.</div>
この例では<code>extendedSearch</code>ステートで中にサブフローを参照しています。サブフローが同じコントローラで呼ばれる場合は、コントローラを指定するパラメータは省略可能です。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Prior to 1.3.5, the previous subflow call would look like <code>subflow(new SearchExtensionsController().extendedSearchFlow)</code>, with the requirement that the name of the subflow state be the same as the called subflow (minus <code>Flow</code>). This way of calling a subflow is deprecated and only supported for backward compatibility.</div>
1.3.5以前、サブフローは、<code>subflow(new SearchExtensionsController().extendedSearchFlow)</code>のように呼び出しました。この方法は非推奨となっており、下位互換のために対応はしています。
</blockquote><p class="paragraph"/><div class="hidden-block">The subflow is another flow entirely:</div>
サブフローは完全に別のフローです:<p class="paragraph"/><div class="code"><pre>def extendedSearchFlow = &#123;
    startExtendedSearch &#123;
        on(<span class="java&#45;quote">"findMore"</span>).to <span class="java&#45;quote">"searchMore"</span>
        on(<span class="java&#45;quote">"searchAgain"</span>).to <span class="java&#45;quote">"noResults"</span>
    &#125;
    searchMore &#123;
        action &#123;
           def results = searchService.deepSearch(ctx.conversation.query)
           <span class="java&#45;keyword">if</span> (!results) <span class="java&#45;keyword">return</span> error()
           conversation.extendedResults = results
        &#125;
        on(<span class="java&#45;quote">"success"</span>).to <span class="java&#45;quote">"moreResults"</span>
        on(<span class="java&#45;quote">"error"</span>).to <span class="java&#45;quote">"noResults"</span>
    &#125;
    moreResults()
    noResults()
&#125;</pre></div><p class="paragraph"/>Notice how it places the <code>extendedResults</code> in conversation scope. This scope differs to flow scope as it lets you share state that spans the whole conversation, i.e. a flow execution including all subflows, not just the flow itself. Also notice that the end state (either <code>moreResults</code> or <code>noResults</code> of the subflow triggers the events in the main flow:<p class="paragraph"/><div class="code"><pre>extendedSearch &#123;
    // Extended search subflow
    subflow(controller: <span class="java&#45;quote">"searchExtensions"</span>, action: <span class="java&#45;quote">"extendedSearch"</span>)
    on(<span class="java&#45;quote">"moreResults"</span>).to <span class="java&#45;quote">"displayMoreResults"</span>
    on(<span class="java&#45;quote">"noResults"</span>).to <span class="java&#45;quote">"displayNoMoreResults"</span>
&#125;</pre></div><p class="paragraph"/><h4>Subflow input and output</h4>
Using conversation scope for passing input and output between flows can be compared with using global variables to pass information between methods.
While this is OK in certain situations, it is usually better to use method arguments and return values. In webflow speak, this means defining input and output arguments for flows.<p class="paragraph"/>Consider following flow for searching a person with a certain expertise:<p class="paragraph"/><div class="code"><pre>def searchFlow = &#123;
        input &#123;
            expertise(required: <span class="java&#45;keyword">true</span>)
            title(<span class="java&#45;quote">"Search person"</span>)
        &#125;<p class="paragraph"/>        search &#123;
            onEntry &#123;
                &#91;personInstanceList: Person.findAllByExpertise(flow.expertise)&#93;
            &#125;
            on(<span class="java&#45;quote">"select"</span>) &#123;
                flow.person = Person.get(params.id)
            &#125;.to(<span class="java&#45;quote">"selected"</span>)
            on(<span class="java&#45;quote">"cancel"</span>).to(<span class="java&#45;quote">"cancel"</span>)
        &#125;<p class="paragraph"/>        selected &#123;
            output &#123;
                person &#123;flow.person&#125;
            &#125;
        &#125;
        cancel()
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>This flow accepts two input parameters:
<ul class="star">
<li>a required expertise argument</li>
<li>an optional title argument with a default value</li>
</ul><p class="paragraph"/>All input arguments are stored in flow scope and are, just like local variables, only visible within this flow.<p class="paragraph"/>A flow that contains required input will throw an exception when an execution is started without providing the input. The consequence is that these flows can only be started as subflows.<p class="paragraph"/>Notice how an end state can define one or more named output values. If the value is a closure, this closure will be evaluated at the end of each flow execution.
If the value is not a closure, the value will be a constant that is only calculated once at flow definition time.<p class="paragraph"/>When a subflow is called, we can provide it a map with input values:<p class="paragraph"/><div class="code"><pre>def newProjectWizardFlow = &#123;
    ...<p class="paragraph"/>    managerSearch &#123;
        subflow(controller: <span class="java&#45;quote">"person"</span>, action: <span class="java&#45;quote">"search"</span>,
                input: &#91;expertise : <span class="java&#45;quote">"management"</span>, title: <span class="java&#45;quote">"Search project manager"</span>&#93;)
        on(<span class="java&#45;quote">"selected"</span>) &#123;
            flow.projectInstance.manager = currentEvent.attributes.person
        &#125;.to <span class="java&#45;quote">"techleadSearch"</span>
    &#125;<p class="paragraph"/>    techleadSearch &#123;
        subflow(controller: <span class="java&#45;quote">"person"</span>, action: <span class="java&#45;quote">"search"</span>,
                input: &#91;expertise : &#123; flow.technology &#125;, title: <span class="java&#45;quote">"Search technical lead"</span>&#93;)
        on(<span class="java&#45;quote">"selected"</span>) &#123;
            flow.projectInstance.techlead = currentEvent.attributes.person
        &#125;.to <span class="java&#45;quote">"projectDetails"</span>
    &#125;<p class="paragraph"/>    ...<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>Notice again the difference between constant values like <code>expertise : "management"</code> and dynamic values like <code>expertise : { flow.technology }</code><p class="paragraph"/>The subflow output is available via <code>currentEvent.attributes</code>


<a name="7.6 Filters"><!-- Legacy link --></a>
<h2 id="filters">7.6 フィルタ</h2>
<div class="hidden-block">
Although Grails <a href="../guide/single.html#controllers" class="guide">controllers</a> support fine grained interceptors, these are only really useful when applied to a few controllers and become difficult to manage with larger applications. Filters on the other hand can be applied across a whole group of controllers, a URI space or to a specific action. Filters are far easier to plugin and maintain completely separately to your main controller logic and are useful for all sorts of cross cutting concerns such as security, logging, and so on.
</div>
Grailsの<a href="../guide/single.html#controllers" class="guide">コントローラ</a>にはインターセプター機能に対応しています。これらは、少ないコントローラに対しては有用ですが、大きなアプリケーションだと管理が大変になります。その一方フィルタを使用すると、多くのコントローラ、URIスペースや指定したアクションに対して適用できます。フィルタはプラグインにすることも簡単で、コントローラロジックとも切り離されており、セキュリティ、ロギングなどの全体にわたる物として便利です。


<a name="6.6.1 Applying Filters"><!-- Legacy link --></a>
<h2 id="applyingFilters">7.6.1 フィルタの適用</h2>
<div class="hidden-block">To create a filter create a class that ends with the convention <code>Filters</code> in the <code>grails-app/conf</code> directory. Within this class define a code block called <code>filters</code> that contains the filter definitions:</div>
フィルタを作成するには、<code>grails-app/conf</code>ディレクトリに、名称が<code>Filters</code>で終わるクラスを作成します。このクラスにはフィルタを記述する、<code>filters</code>というコードブロックを定義します:<p class="paragraph"/><div class="code"><pre>class ExampleFilters &#123;
   def filters = &#123;
        // your filters here
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Each filter you define within the <code>filters</code> block has a name and a scope. The name is the method name and the scope is defined using named arguments. For example to define a filter that applies to all controllers and all actions you can use wildcards:</div>
<code>filters</code>ブロックに定義する各フィルタには、範囲と名称を持たせます。名称はメソッド名で、範囲は引数で定義します。例として、ワイルドカードを使用した全コントローラ・アクションに適用されるフィルタを定義します:<p class="paragraph"/><div class="code"><pre>sampleFilter(controller:'&#42;', action:'&#42;') &#123;
  // interceptor definitions
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The scope of the filter can be one of the following things:</div>
フィルタの範囲は次のように指定できます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>A controller and/or action name pairing with optional wildcards</li>
<li>A URI, with Ant path matching syntax</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>省略可能なワイルドカードを使用した、コントローラ名と(または)アクション名の組み合わせ。</li>
<li>Antパスマッチング書式のURI指定。</li>
</ul><p class="paragraph"/><div class="hidden-block">Filter rule attributes:</div>
フィルタルール属性:
<div class="hidden-block">
<ul class="star">
<li><code>controller</code> - controller matching pattern, by default &#42; is replaced with .&#42; and a regex is compiled</li>
<li><code>controllerExclude</code> - controller exclusion pattern, by default &#42; is replaced with .&#42; and a regex is compiled</li>
<li><code>action</code> - action matching pattern, by default &#42; is replaced with .&#42; and a regex is compiled</li>
<li><code>actionExclude</code> - action exclusion pattern, by default &#42; is replaced with .&#42; and a regex is compiled</li>
<li><code>regex</code> (<code>true</code>/<code>false</code>) - use regex syntax (don't replace '&#42;' with '.&#42;')</li>
<li><code>uri</code> - a uri to match, expressed with as Ant style path (e.g. /book/&#42;&#42;)</li>
<li><code>uriExclude</code> - a uri pattern to exclude, expressed with as Ant style path (e.g. /book/&#42;&#42;)</li>
<li><code>find</code> (<code>true</code>/<code>false</code>) - rule matches with partial match (see <code>java.util.regex.Matcher.find()</code>)</li>
<li><code>invert</code> (<code>true</code>/<code>false</code>) - invert the rule (NOT rule)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>controller</code> - コントローラ対象のパターンマッチング, 既存値 &#42; で正規表現コンパイル時には .&#42;に置換されます。</li>
<li><code>controllerExclude</code> - 除外するコントローラのパターン, 既存値 &#42; で正規表現コンパイル時には .&#42;に置換されます。</li>
<li><code>action</code> - アクション対象のパターンマッチング, 既存値 &#42; で正規表現コンパイル時には .&#42;に置換されます。</li>
<li><code>actionExclude</code> - 除外するアクションのパターン, 既存値 &#42; で正規表現コンパイル時には .&#42;に置換されます。</li>
<li><code>regex (true/false)</code> - 正規表現の使用 ('&#42;' を '.&#42;'に置換しない指定)</li>
<li><code>uri</code> - URIマッチ, Antスタイルパス (e.g. /book/&#42;&#42;)</li>
<li><code>uriExclude</code> - 除外するURIパターン, Antスタイルパス (e.g. /book/&#42;&#42;)</li>
<li><code>find (true/false)</code> - 部分マッチ (<code>java.util.regex.Matcher.find()</code>を参照)</li>
<li><code>invert (true/false)</code> - ルールを逆にする</li>
</ul><p class="paragraph"/><div class="hidden-block">Some examples of filters include:</div>
フィルタの例:
<div class="hidden-block">
<ul class="star">
<li>All controllers and actions</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>全てのコントローラとアクション</li>
</ul><p class="paragraph"/><div class="code"><pre>all(controller: '&#42;', action: '&#42;') &#123;<p class="paragraph"/>&#125;</pre></div>
<div class="hidden-block">
<ul class="star">
<li>Only for the <code>BookController</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>BookController</code>のみ</li>
</ul><p class="paragraph"/><div class="code"><pre>justBook(controller: 'book', action: '&#42;') &#123;<p class="paragraph"/>&#125;</pre></div>
<div class="hidden-block">
<ul class="star">
<li>All controllers except the <code>BookController</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>BookController</code>以外の全て</li>
</ul><p class="paragraph"/><div class="code"><pre>notBook(controller: 'book', invert: <span class="java&#45;keyword">true</span>) &#123;<p class="paragraph"/>&#125;</pre></div>
<div class="hidden-block">
<ul class="star">
<li>All actions containing 'save' in the action name</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>'save'を名称に含めたアクション全て</li>
</ul><p class="paragraph"/><div class="code"><pre>saveInActionName(action: '&#42;save&#42;', find: <span class="java&#45;keyword">true</span>) &#123;<p class="paragraph"/>&#125;</pre></div>
<div class="hidden-block">
<ul class="star">
<li>All actions starting with the letter 'b' except for actions beginning with the phrase 'bad*'</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>"bad&#42;"を除外した、'b'で始まるアクション全て</li>
</ul><p class="paragraph"/><div class="code"><pre>actionBeginningWithBButNotBad(action: 'b&#42;', actionExclude: 'bad&#42;', find: <span class="java&#45;keyword">true</span>) &#123;<p class="paragraph"/>&#125;</pre></div>
<div class="hidden-block">
<ul class="star">
<li>Applied to a URI space</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>URIへ適用</li>
</ul><p class="paragraph"/><div class="code"><pre>someURIs(uri: '/book/&#42;&#42;') &#123;<p class="paragraph"/>&#125;</pre></div>
<div class="hidden-block">
<ul class="star">
<li>Applied to all URIs</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>全てのURIに適用</li>
</ul><p class="paragraph"/><div class="code"><pre>allURIs(uri: '/&#42;&#42;') &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In addition, the order in which you define the filters within the <code>filters</code> code block dictates the order in which they are executed.  To control the order of execution between <code>Filters</code> classes, you can use the <code>dependsOn</code> property discussed in <a href="../guide/single.html#filterDependencies" class="guide">filter dependencies</a> section.</div>
<code>filters</code>コードブロックに定義した順序でフィルタは実行されます。<code>Filters</code>クラス間での実行を制御するには、<a href="../guide/single.html#filterDependencies" class="guide">フィルタ依存</a>セクションで記載されている<code>dependsOn</code>プロパティが使用できます。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">
Note: When exclude patterns are used they take precedence over the matching patterns.  For example, if action is 'b&#42;' and actionExclude is 'bad&#42;' then actions like 'best' and 'bien' will have that filter applied but actions like 'bad' and 'badlands' will not.
</div>
注意:除外パターンが使用された場合は除外マッチングパターンが優先されます。例として、アクションが'b&#42;' で、actionExcludeが'bad&#42;'の場合、'best','bien'等のアクションは適用されますが、'bad','badland'は適用されません。
</blockquote>


<a name="6.6.2 Filter Types"><!-- Legacy link --></a>
<h2 id="filterTypes">7.6.2 フィルタの種類</h2>
<div class="hidden-block">Within the body of the filter you can then define one or several of the following interceptor types for the filter:</div>
フィルタの中に、幾つかのインターセプタを定義することができます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>before</code> - Executed before the action. Return <code>false</code> to indicate that the response has been handled that that all future filters and the action should not execute</li>
<li><code>after</code> - Executed after an action. Takes a first argument as the view model to allow modification of the model before rendering the view</li>
<li><code>afterView</code> - Executed after view rendering.  Takes an Exception as an argument which will be non-<code>null</code> if an exception occurs during processing. Note: this Closure is called before the layout is applied.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>before</code> - アクションの前に実行されます。<code>false</code>を返す事で、その後に実行されるフィルタとアクションは実行されません。</li>
<li><code>after</code> - アクションの後に実行されます。最初の引数に、ビュー描写前に変更可能なビューモデルが渡されます。</li>
<li><code>afterView</code> - ビュー描写後に実行されます。実行時に例外が発生した場合は<code>non-null</code>なExceptionが引数として渡されます。このクロージャはレイアウトが適用される前に実行されます。</li>
</ul><p class="paragraph"/><div class="hidden-block">For example to fulfill the common simplistic authentication use case you could define a filter as follows:</div>
シンプルな認証の仕組みとしてフィルタを定義する例です:
<div class="code"><pre>class SecurityFilters &#123;
   def filters = &#123;
       loginCheck(controller: '&#42;', action: '&#42;') &#123;
           before = &#123;
              <span class="java&#45;keyword">if</span> (!session.user &#38;&#38; !actionName.equals('login')) &#123;
                  redirect(action: 'login')
                  <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
               &#125;
           &#125;
       &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here the <code>loginCheck</code> filter uses a <code>before</code> interceptor to execute a block of code that checks if a user is in the session and if not redirects to the login action. Note how returning false ensure that the action itself is not executed.</div>
この<code>loginCheck</code>フィルタは、<code>before</code>インターセプタのコードブロックを実行することで、ユーザがセッションに無い場合はloginアクションへリダイレクトしています。falseを返す事で対象のアクション自身が実行されないようにします。<p class="paragraph"/>
Here's a more involved example that demonstrates all three filter types:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> java.util.concurrent.atomic.AtomicLong<p class="paragraph"/>class LoggingFilters &#123;<p class="paragraph"/>   <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> AtomicLong REQUEST_NUMBER_COUNTER = <span class="java&#45;keyword">new</span> AtomicLong()
   <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> START_TIME_ATTRIBUTE = 'Controller__START_TIME__'
   <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> REQUEST_NUMBER_ATTRIBUTE = 'Controller__REQUEST_NUMBER__'<p class="paragraph"/>   def filters = &#123;<p class="paragraph"/>      logFilter(controller: '&#42;', action: '&#42;') &#123;<p class="paragraph"/>         before = &#123;
            <span class="java&#45;keyword">if</span> (!log.debugEnabled) <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span><p class="paragraph"/>            <span class="java&#45;object">long</span> start = <span class="java&#45;object">System</span>.currentTimeMillis()
            <span class="java&#45;object">long</span> currentRequestNumber = REQUEST_NUMBER_COUNTER.incrementAndGet()<p class="paragraph"/>            request&#91;START_TIME_ATTRIBUTE&#93; = start
            request&#91;REQUEST_NUMBER_ATTRIBUTE&#93; = currentRequestNumber<p class="paragraph"/>            log.debug <span class="java&#45;quote">"preHandle request &#35;&#36;currentRequestNumber : "</span> +
               <span class="java&#45;quote">"'&#36;request.servletPath'/'&#36;request.forwardURI', "</span> +
               <span class="java&#45;quote">"from &#36;request.remoteHost (&#36;request.remoteAddr) "</span> +
               <span class="java&#45;quote">" at &#36;&#123;<span class="java&#45;keyword">new</span> Date()&#125;, Ajax: &#36;request.xhr, controller: &#36;controllerName, "</span> +
               <span class="java&#45;quote">"action: &#36;actionName, params: &#36;&#123;<span class="java&#45;keyword">new</span> TreeMap(params)&#125;"</span><p class="paragraph"/>            <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span>
         &#125;<p class="paragraph"/>         after = &#123; Map model &#45;&#62;<p class="paragraph"/>            <span class="java&#45;keyword">if</span> (!log.debugEnabled) <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span><p class="paragraph"/>            <span class="java&#45;object">long</span> start = request&#91;START_TIME_ATTRIBUTE&#93;
            <span class="java&#45;object">long</span> end = <span class="java&#45;object">System</span>.currentTimeMillis()
            <span class="java&#45;object">long</span> requestNumber = request&#91;REQUEST_NUMBER_ATTRIBUTE&#93;<p class="paragraph"/>            def msg = <span class="java&#45;quote">"postHandle request &#35;&#36;requestNumber: end &#36;&#123;<span class="java&#45;keyword">new</span> Date()&#125;, "</span> +
                      <span class="java&#45;quote">"controller total time &#36;&#123;end &#45; start&#125;ms"</span>
            <span class="java&#45;keyword">if</span> (log.traceEnabled) &#123;
            	log.trace msg + <span class="java&#45;quote">"; model: &#36;model"</span>
            &#125;
            <span class="java&#45;keyword">else</span> &#123;
            	log.debug msg
            &#125;
         &#125;<p class="paragraph"/>         afterView = &#123; Exception e &#45;&#62;<p class="paragraph"/>            <span class="java&#45;keyword">if</span> (!log.debugEnabled) <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">true</span><p class="paragraph"/>            <span class="java&#45;object">long</span> start = request&#91;START_TIME_ATTRIBUTE&#93;
            <span class="java&#45;object">long</span> end = <span class="java&#45;object">System</span>.currentTimeMillis()
            <span class="java&#45;object">long</span> requestNumber = request&#91;REQUEST_NUMBER_ATTRIBUTE&#93;<p class="paragraph"/>            def msg = <span class="java&#45;quote">"afterCompletion request &#35;&#36;requestNumber: "</span> +
                      <span class="java&#45;quote">"end &#36;&#123;<span class="java&#45;keyword">new</span> Date()&#125;, total time &#36;&#123;end &#45; start&#125;ms"</span>
            <span class="java&#45;keyword">if</span> (e) &#123;
               log.debug <span class="java&#45;quote">"&#36;msg &#92;n&#92;texception: &#36;e.message"</span>, e
            &#125;
            <span class="java&#45;keyword">else</span> &#123;
               log.debug msg
            &#125;
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>In this logging example we just log various request information, but note that the <code>model</code> map in the <code>after</code> filter is mutable. If you need to add or remove items from the model map you can do that in the <code>after</code> filter.



<h2 id="filterVariablesAndScopes">7.6.3 変数とスコープ</h2>
<div class="hidden-block">Filters support all the common properties available to <a href="../guide/single.html#controllers" class="guide">controllers</a> and <a href="../guide/single.html#taglibs" class="guide">tag libraries</a>, plus the application context:</div>
フィルタでは、<a href="../guide/single.html#controllers" class="guide">コントローラ</a>や<a href="../guide/single.html#taglibs" class="guide">タグライブラリ</a>で利用できる共通のプロパティとアプリケーションコンテキストを参照できます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><a href="../ref/Controllers/request.html" class="controllers">request</a> - The HttpServletRequest object</li>
<li><a href="../ref/Controllers/response.html" class="controllers">response</a> - The HttpServletResponse object</li>
<li><a href="../ref/Controllers/session.html" class="controllers">session</a> - The HttpSession object</li>
<li><a href="../ref/Controllers/servletContext.html" class="controllers">servletContext</a> - The ServletContext object</li>
<li><a href="../ref/Controllers/flash.html" class="controllers">flash</a> - The flash object</li>
<li><a href="../ref/Controllers/params.html" class="controllers">params</a> - The request parameters object</li>
<li><a href="../ref/Controllers/actionName.html" class="controllers">actionName</a> - The action name that is being dispatched to</li>
<li><a href="../ref/Controllers/controllerName.html" class="controllers">controllerName</a> - The controller name that is being dispatched to</li>
<li><a href="../ref/Controllers/grailsApplication.html" class="controllers">grailsApplication</a> - The Grails application currently running</li>
<li><a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">applicationContext</a> - The ApplicationContext object</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="../ref/Controllers/request.html" class="controllers">request</a> - HttpServletRequestオブジェクト</li>
<li><a href="../ref/Controllers/response.html" class="controllers">response</a> - HttpServletResponseオブジェクト</li>
<li><a href="../ref/Controllers/session.html" class="controllers">session</a> - HttpSessionオブジェクト</li>
<li><a href="../ref/Controllers/servletContext.html" class="controllers">servletContext</a> - ServletContextオブジェクト</li>
<li><a href="../ref/Controllers/flash.html" class="controllers">flash</a> - flashオブジェクト</li>
<li><a href="../ref/Controllers/params.html" class="controllers">params</a> - リクエストパラメータオブジェクト</li>
<li><a href="../ref/Controllers/actionName.html" class="controllers">actionName</a> - ディスパッチ対象のアクション名</li>
<li><a href="../ref/Controllers/controllerName.html" class="controllers">controllerName</a> - ディスパッチ対象のコントローラ名</li>
<li><a href="../ref/Controllers/grailsApplication.html" class="controllers">grailsApplication</a> - 起動中のGrailsアプリケーション</li>
<li><a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">applicationContext</a> - ApplicationContextオブジェクト</li>
</ul><p class="paragraph"/><div class="hidden-block">However, filters only support a subset of the methods available to controllers and tag libraries. These include:</div>
フィルタではコントローラやタグライブラリで使用できる一部のメソッドが使用できます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> - For redirects to other controllers and actions</li>
<li><a href="../ref/Controllers/render.html" class="controllers">render</a> - For rendering custom responses</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> - 他のコントローラやアクションにリダイレクトを行う</li>
<li><a href="../ref/Controllers/render.html" class="controllers">render</a> - カスタムレスポンスを返す。</li>
</ul><p class="paragraph"/>

<a name="6.6.4 Filter Dependencies"><!-- Legacy link --></a>
<h2 id="filterDependencies">7.6.4 フィルタ依存関係</h2>
<div class="hidden-block">In a <code>Filters</code> class, you can specify any other <code>Filters</code> classes that should first be executed using the <code>dependsOn</code> property. This is used when a <code>Filters</code> class depends on the behavior of another <code>Filters</code> class (e.g. setting up the environment, modifying the request/session, etc.) and is defined as an array of <code>Filters</code> classes.</div>
<code>Filters</code>クラスでは、<code>dependsOn</code>プロパティに他の<code>Filters</code>クラスを定義して先に実行させることが可能です。この機能は<code>Filters</code>クラスが他の<code>Filters</code>クラスの振る舞いに依存する場合等に使用します。<p class="paragraph"/><div class="hidden-block">Take the following example <code>Filters</code> classes:</div>
<code>Filters</code>クラスの例を見ていきましょう:<p class="paragraph"/><div class="code"><pre>class MyFilters &#123;
    def dependsOn = &#91;MyOtherFilters&#93;<p class="paragraph"/>    def filters = &#123;
        checkAwesome(uri: <span class="java&#45;quote">"/&#42;"</span>) &#123;
            before = &#123;
                <span class="java&#45;keyword">if</span> (request.isAwesome) &#123; // <span class="java&#45;keyword">do</span> something awesome &#125;
            &#125;
        &#125;<p class="paragraph"/>        checkAwesome2(uri: <span class="java&#45;quote">"/&#42;"</span>) &#123;
            before = &#123;
                <span class="java&#45;keyword">if</span> (request.isAwesome) &#123; // <span class="java&#45;keyword">do</span> something <span class="java&#45;keyword">else</span> awesome &#125;
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class MyOtherFilters &#123;
    def filters = &#123;
        makeAwesome(uri: <span class="java&#45;quote">"/&#42;"</span>) &#123;
            before = &#123;
                request.isAwesome = <span class="java&#45;keyword">true</span>
            &#125;
        &#125;
        doNothing(uri: <span class="java&#45;quote">"/&#42;"</span>) &#123;
            before = &#123;
                // <span class="java&#45;keyword">do</span> nothing
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">MyFilters specifically <code>dependsOn</code> MyOtherFilters.  This will cause all the filters in MyOtherFilters whose scope matches the current request to be executed before those in MyFilters. For a request of "/test", which will match the scope of every filter in the example, the execution order would be as follows:</div>
MyFiltersには、<code>dependsOn</code>にMyOtherFiltersを指定しています。これにより、リクエストがフィルタ範囲にマッチしたMyOtherFiltersのフィルタがMyFiltersの前に実行されます。この例では"/test"とリクエストした場合全てのフィルタにマッチします。フィルタ実行順は次のようになります:
<ul class="star">
<li>MyOtherFilters - makeAwesome</li>
<li>MyOtherFilters - doNothing</li>
<li>MyFilters - checkAwesome</li>
<li>MyFilters - checkAwesome2</li>
</ul><p class="paragraph"/><div class="hidden-block">The filters within the MyOtherFilters class are processed in order first, followed by the filters in the MyFilters class.  Execution order between <code>Filters</code> classes are enabled and the execution order of filters within each <code>Filters</code> class are preserved.</div>
MyOtherFiltersクラスのフィルタが先に実行されて、MyFiltersクラスのフィルタへと続きます。<code>Filters</code>クラスの実行順が可能になり、各<code>Filters</code>クラスのフィルタ実行順も保っています。<p class="paragraph"/><div class="hidden-block">If any cyclical dependencies are detected, the filters with cyclical dependencies will be added to the end of the filter chain and processing will continue.  Information about any cyclical dependencies that are detected will be written to the logs.  Ensure that your root logging level is set to at least WARN or configure an appender for the Grails Filters Plugin (<code>org.codehaus.groovy.grails.plugins.web.filters.FiltersGrailsPlugin</code>) when debugging filter dependency issues.</div>
循環依存関係を検出したら、循環依存関係のあるフィルタをフィルタチェインの最後に追加して処理を続行します。その後、循環依存関係を検出した事をログへ出力します。ログを出力するには、ルートロガーレベルがWARNに設定されFilers用のログ定義をする必要があります。


<a name="7.7 Ajax"><!-- Legacy link --></a>
<h2 id="ajax">7.7 Ajax</h2>
<div class="hidden-block">Ajax is the driving force behind the shift to richer web applications. These types of applications in general are better suited to agile, dynamic frameworks written in languages like <a href="http://groovy.codehaus.org" target="blank">Groovy</a> and <a href="http://www.ruby-lang.org/." target="blank">Ruby</a> Grails provides support for building Ajax applications through its Ajax tag library. For a full list of these see the Tag Library Reference.</div>
AjaxはリッチWebアプリケーションでは欠かせない物となっています。この手のアプリケーションには通常、GroovyやRuby等で実装されたアジャイル、ダイナミックフレームワークがお似合いです。GrailsではAjaxアプリケーションを構築をサポートするためのAjaxタグライブラリを提供しています。Ajaxタグライブラリのリストはタグリファレンスを参照してください。<p class="paragraph"/><blockquote class="note">
Note: JavaScript examples use the jQuery library.
</blockquote>


<a name="7.7.1 Ajax Support"><!-- Legacy link --></a>
<h2 id="ajaxSupport">7.7.1 Ajax対応</h2>
<div class="hidden-block">
By default Grails ships with the <a href="http://jquery.com/" target="blank">jQuery</a> library, but through the <a href="../guide/single.html#plugins" class="guide">Plugin system</a> provides support for other frameworks such as <a href="http://www.prototypejs.org/" target="blank">Prototype</a>, Dojo:http://dojotoolkit.org/, Yahoo UI:http://developer.yahoo.com/yui/ and the <a href="http://code.google.com/webtoolkit/" target="blank">Google Web Toolkit</a>.
</div>
Grailsはデフォルトで <a href="http://jquery.com/" target="blank">jQuery</a> を使用しています。他のライブラリ、<a href="http://www.prototypejs.org/" target="blank">Prototype</a>、 <a href="http://dojotoolkit.org/" target="blank">Dojo</a>、 <a href="http://developer.yahoo.com/yui/" target="blank">Yahoo UI</a>、 <a href="http://code.google.com/webtoolkit/" target="blank">Google Web Toolkit</a>等もプラグインで提供しています。<p class="paragraph"/><div class="hidden-block">This section covers Grails' support for Ajax in general. To get started, add this line to the <code>&#60;head&#62;</code> tag of your page:</div>
このセクションでは全般的なAjax対応の説明をします。先ずはじめに、ページの<code>&#60;head&#62;</code>タグ内に以下を追加します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript library=<span class="xml&#45;quote">"jquery"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">You can replace <code>jQuery</code> with any other library supplied by a plugin you have installed. This works because of Grails' support for adaptive tag libraries. Thanks to Grails' plugin system there is support for a number of different Ajax libraries including (but not limited to):</div>
プラグインで提供された他のライブラリを使用する際は、<code>jquery</code>の部分を入れ換えます。これはGrailsの適用性のあるタグライブラリで可能にしています。Grailsのプラグインには、次の様々なAjaxライブラリが存在します(これは一部です):
<ul class="star">
<li>jQuery</li>
<li>Prototype</li>
<li>Dojo</li>
<li>YUI</li>
<li>MooTools</li>
</ul><p class="paragraph"/>

<a name="7.7.1.1 Remoting Linking"><!-- Legacy link --></a>
<h2 id="remotingLinking">7.7.1.1 リモートリンク</h2>
<div class="hidden-block">Remote content can be loaded in a number of ways, the most commons way is through the <a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a> tag. This tag allows the creation of HTML anchor tags that perform an asynchronous request and optionally set the response in an element. The simplest way to create a remote link is as follows:</div>
多くの方法でリモートコンテントをロードすることが可能ですが、一般的な方法として<a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>タグを使用します。
このタグは、非同期リクエストと結果をエレメントにセット(省略可能)するHTMLアンカータグを生成します。リモートリンクタグを作成する簡単な例は次のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"delete"</span> id=<span class="xml&#45;quote">"1"</span>&#62;</span>Delete Book<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The above link sends an asynchronous request to the <code>delete</code> action of the current controller with an id of <code>1</code>.</div>
上記の例で生成されたタグは、id:1をリクエストパラメータとして<code>delete</code>アクションに非同期リクエストを送信します。


<a name="7.7.1.2 Updating Content"><!-- Legacy link --></a>
<h2 id="updatingContent">7.7.1.2 コンテンツの更新</h2>
<div class="hidden-block">This is great, but usually you provide feedback to the user about what happened:</div>
先ほどの例で非同期送信を行いましたが、通常ユーザへ何が行われたかのフィードバックを提供する必要があります:<p class="paragraph"/><div class="code"><pre>def delete() &#123;
    def b = Book.get(params.id)
    b.delete()
    render <span class="java&#45;quote">"Book $&#123;b.id&#125; was deleted"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">GSP code:</div>
GSPコード:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"message"</span>&#62;</span><span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"delete"</span> id=<span class="xml&#45;quote">"1"</span> update=<span class="xml&#45;quote">"message"</span>&#62;</span>
Delete Book
<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The above example will call the action and set the contents of the <code>message</code> <code>div</code> to the response in this case <code>"Book 1 was deleted"</code>. This is done by the <code>update</code> attribute on the tag, which can also take a Map to indicate what should be updated on failure:</div>
この例では対象のアクションをコールしてレスポンスを<code>messege</code>のidをもった<code>div</code>エレメントの内容を<code>"Book 1 was deleted"</code>に更新します。この更新動作は、タグの<code>update</code>属性で対象を指定しています。さらにMapを使用して更新失敗時の表示先も指定できます:<p class="paragraph"/>
<div class="code"><pre><span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"message"</span>&#62;</span><span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"error"</span>&#62;</span><span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;g:remoteLink update=<span class="xml&#45;quote">"&#91;success: 'message', failure: 'error'&#93;"</span>
              action=<span class="xml&#45;quote">"delete"</span> id=<span class="xml&#45;quote">"1"</span>&#62;</span>
Delete Book
<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Here the <code>error</code> div will be updated if the request failed.</div>
この例ではリクエストに失敗すると、<code>error</code>のIDをもつdivタグ内が更新されます。


<a name="7.7.1.3 Remote Form Submission"><!-- Legacy link --></a>
<h2 id="remoteFormSubmission">7.7.1.3 リモートフォーム送信</h2>
<div class="hidden-block">An HTML form can also be submitted asynchronously in one of two ways. Firstly using the <a href="../ref/Tags/formRemote.html" class="tags">formRemote</a> tag which expects similar attributes to those for the <a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a> tag:</div>
HTMLフォームを非同期で送信することができます。<a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>タグと同じような属性を使用できる<a href="../ref/Tags/formRemote.html" class="tags">formRemote</a>タグを使用する例です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:formRemote url=<span class="xml&#45;quote">"&#91;controller: 'book', action: 'delete'&#93;"</span>
              update=<span class="xml&#45;quote">"&#91;success: 'message', failure: 'error'&#93;"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"hidden"</span> name=<span class="xml&#45;quote">"id"</span> value=<span class="xml&#45;quote">"1"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"submit"</span> value=<span class="xml&#45;quote">"Delete Book!"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/g:formRemote &#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Or alternatively you can use the <a href="../ref/Tags/submitToRemote.html" class="tags">submitToRemote</a> tag to create a submit button. This allows some buttons to submit remotely and some not depending on the action:</div>
他の方法として、<a href="../ref/Tags/submitToRemote.html" class="tags">submitToRemote</a>タグを使用して送信ボタンを作成します。このボタンで非同期送信ボタンを可能として、アクションに依存させなくできます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;form action=<span class="xml&#45;quote">"delete"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"hidden"</span> name=<span class="xml&#45;quote">"id"</span> value=<span class="xml&#45;quote">"1"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;g:submitToRemote action=<span class="xml&#45;quote">"delete"</span>
                      update=<span class="xml&#45;quote">"&#91;success: 'message', failure: 'error'&#93;"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/form&#62;</span></pre></div><p class="paragraph"/>

<a name="7.7.1.4 Ajax Events"><!-- Legacy link --></a>
<h2 id="ajaxEvents">7.7.1.4 Ajaxイベント</h2>
<div class="hidden-block">Specific JavaScript can be called if certain events occur, all the events start with the "on" prefix and let you give feedback to the user where appropriate, or take other action:</div>
指定したJavaScriptを、イベントが発生した際にコールすることができます。全てのイベントは接頭辞"on"で指定します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"show"</span>
              id=<span class="xml&#45;quote">"1"</span>
              update=<span class="xml&#45;quote">"success"</span>
              onLoading=<span class="xml&#45;quote">"showProgress()"</span>
              onComplete=<span class="xml&#45;quote">"hideProgress()"</span>&#62;</span>Show Book 1<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The above code will execute the "showProgress()" function which may show a progress bar or whatever is appropriate. Other events include:</div>
上記のコードでは、実行されると、ロード時に指定した"showProgress()"ファンクションがプログレスバーを表示する等ファンクションの実装に対応した動作を行います。他に以下のイベントが使用可能です:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>onSuccess</code>  - The JavaScript function to call if successful</li>
<li><code>onFailure</code>  - The JavaScript function to call if the call failed</li>
<li><code>on_ERROR_CODE</code>  - The JavaScript function to call to handle specified error codes (eg on404="alert('not found!')")</li>
<li><code>onUninitialized</code>  - The JavaScript function to call the a Ajax engine failed to initialise</li>
<li><code>onLoading</code>  - The JavaScript function to call when the remote function is loading the response</li>
<li><code>onLoaded</code>  - The JavaScript function to call when the remote function is completed loading the response</li>
<li><code>onComplete</code>  - The JavaScript function to call when the remote function is complete, including any updates</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>onSuccess</code> - 成功した時に呼び出すJavaScriptファンクション</li>
<li><code>onFailure</code> - 失敗した時に呼び出すJavaScriptファンクション</li>
<li><code>on_ERROR_CODE</code> - 指定したエラーコードを取得したら呼び出すJavaScriptファンクション (eg on404="alert('not found!')")</li>
<li><code>onUninitialized</code> - Ajaxエンジンの初期化に失敗したときに呼び出すJavaScriptファンクション</li>
<li><code>onLoading</code> - レスポンスを読み込み中に呼び出すJavaScriptファンクション</li>
<li><code>onLoaded</code> - レスポンスの読み込み完了時に呼び出すJavaScriptファンクション</li>
<li><code>onComplete</code> - リモートファンクションが完全に完了(更新を含む)したら呼び出すJavaScriptファンクション</li>
</ul><p class="paragraph"/><div class="hidden-block">You can simply refer to the <code>XMLHttpRequest</code> variable to obtain the request:</div>
リクエストを取得するには、単純に<code>XMLHttpRequest</code>変数で参照できます:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript&#62;</span>
    function fireMe(event) &#123;
        alert(<span class="xml&#45;quote">"XmlHttpRequest = "</span> + event)
    &#125;
&#125;
<span class="xml&#45;tag">&#60;/g:javascript&#62;</span>
<span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"example"</span>
              update=<span class="xml&#45;quote">"success"</span>
              onFailure=<span class="xml&#45;quote">"fireMe(XMLHttpRequest)"</span>&#62;</span>Ajax Link<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span></pre></div>


<a name="7.7.2 Ajax with Prototype"><!-- Legacy link --></a>
<h2 id="ajaxWithPrototype">7.7.2 Prototypeを使用したAjax</h2>
<div class="hidden-block">Grails features an external plugin to add <a href="http://www.prototypejs.org/" target="blank">Prototype</a> support to Grails. To install the plugin, list it in BuildConfig.groovy:</div>
<a href="http://www.prototypejs.org/" target="blank">Prototype</a> はプラグインで対応しています。インストールするにはBuildConfig.groovyにプラグインを定義します:<p class="paragraph"/><div class="code"><pre>runtime <span class="java&#45;quote">"&#58;prototype&#58;latest.release"</span></pre></div><p class="paragraph"/><div class="hidden-block">This will download the current supported version of the Prototype plugin and install it into your Grails project. With that done you can add the following reference to the top of your page:</div>
このコマンドでPrototypeプラグインがダウンロードされプロジェクトにインストールされます。そして次のようにページのトップに記述します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript library=<span class="xml&#45;quote">"prototype"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">If you require <a href="http://script.aculo.us/" target="blank">Scriptaculous</a> too you can do the following instead:</div>
<a href="http://script.aculo.us/" target="blank">Scriptaculous</a> も必要であれば、代わりに次のように指定します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript library=<span class="xml&#45;quote">"scriptaculous"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Now all of Grails tags such as <a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>, <a href="../ref/Tags/formRemote.html" class="tags">formRemote</a> and <a href="../ref/Tags/submitToRemote.html" class="tags">submitToRemote</a> work with Prototype remoting.</div>
この定義で他の<a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>,<a href="../ref/Tags/formRemote.html" class="tags">formRemote</a>や<a href="../ref/Tags/submitToRemote.html" class="tags">submitToRemote</a>等のGrailsタグを使用できます。


<a name="7.7.3 Ajax with Dojo"><!-- Legacy link --></a>
<h2 id="ajaxWithDojo">7.7.3 Dojoを使用したAjax</h2>
<div class="hidden-block">Grails features an external plugin to add <a href="http://dojotoolkit.org/" target="blank">Dojo</a> support to Grails. To install the plugin type the following command from the root of your project in a terminal window:</div>
<div class="hidden-block">Grails features an external plugin to add <a href="http://dojotoolkit.org/" target="blank">Dojo</a> support to Grails. To install the plugin, list it in BuildConfig.groovy:</div>
<a href="http://dojotoolkit.org/" target="blank">Dojo</a> はプラグインで対応しています。インストールするにはBuildConfig.groovyにプラグインを定義します:<p class="paragraph"/><div class="code"><pre>compile <span class="java&#45;quote">"&#58;dojo&#58;latest.release"</span></pre></div><p class="paragraph"/><div class="hidden-block">This will download the current supported version of Dojo and install it into your Grails project. With that done you can add the following reference to the top of your page:</div>
このコマンドでDojoプラグインがダウンロードされプロジェクトにインストールされます。そして次のようにページのトップに記述します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript library=<span class="xml&#45;quote">"dojo"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Now all of Grails tags such as <a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>, <a href="../ref/Tags/formRemote.html" class="tags">formRemote</a> and <a href="../ref/Tags/submitToRemote.html" class="tags">submitToRemote</a> work with Dojo remoting.</div>
この定義で他の<a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>,<a href="../ref/Tags/formRemote.html" class="tags">formRemote</a>や<a href="../ref/Tags/submitToRemote.html" class="tags">submitToRemote</a>等のGrailsタグを使用できます。


<a name="7.7.4 Ajax with GWT"><!-- Legacy link --></a>
<h2 id="ajaxWithGWT">7.7.4 GWTを使用したAjax</h2>
<div class="hidden-block">Grails also features support for the <a href="http://code.google.com/webtoolkit/" target="blank">Google Web Toolkit</a> through a plugin. There is comprehensive <a href="http://grails.org/plugin/gwt" target="blank">documentation</a> available on the Grails wiki.</div>
<a href="http://code.google.com/webtoolkit/" target="blank">Google Web Toolkit</a> をプラグインでサポートしています。詳しくは<a href="http://grails.org/plugin/gwt" target="blank">ドキュメント</a>を参照してください。


<a name="7.7.5 Ajax on the Server"><!-- Legacy link --></a>
<h2 id="ajaxOnTheServer">7.7.5 Ajax使用時のサーバサイド</h2>
<div class="hidden-block">There are a number of different ways to implement Ajax which are typically broken down into:</div>
Ajaxを実装するには幾つかの方法があります。通常次のように分類できます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Content Centric Ajax - Where you just use the HTML result of a remote call to update the page</li>
<li>Data Centric Ajax - Where you actually send an XML or JSON response from the server and programmatically update the page</li>
<li>Script Centric Ajax - Where the server sends down a stream of JavaScript to be evaluated on the fly</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>コンテント中心なAjax - リモートコールの結果HTMLページを更新する。</li>
<li>データ中心なAjax - XMLまたはJSONをサーバから送信してページをプログラムで更新する。</li>
<li>スクリプトを使用したAjax - サーバからJavascriptを送信して実行させる。</li>
</ul><p class="paragraph"/><div class="hidden-block">Most of the examples in the <a href="../guide/single.html#ajax" class="guide">Ajax</a> section cover Content Centric Ajax where you are updating the page, but you may also want to use Data Centric or Script Centric. This guide covers the different styles of Ajax.</div>
<a href="../guide/single.html#ajax" class="guide">Ajax</a>セクションでの例のほとんどは、ページの更新を行うコンテント中心なAjaxを説明しました。データ中心やスクリプトを使用したAjaxも使用すると思います。このガイドでは他のスタイル尾Ajaxを解説します。<p class="paragraph"/><h4>コンテント中心のAjax <div class="hidden-block">Content Centric Ajax </div></h4><p class="paragraph"/><div class="hidden-block">Just to re-cap, content centric Ajax involves sending some HTML back from the server and is typically done by rendering a template with the <a href="../ref/Controllers/render.html" class="controllers">render</a> method:</div>
同じ説明になりますが、コンテント中心のAjaxでの要件はHTMLをサーバから返す事です。通常この場合はテンプレートを<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドで描写して実装します:<p class="paragraph"/><div class="code"><pre>def showBook() &#123;
    def b = Book.get(params.id)<p class="paragraph"/>    render(template: <span class="java&#45;quote">"bookTemplate"</span>, model: &#91;book: b&#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Calling this on the client involves using the <a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a> tag:</div>
これをクライアント側で<a href="../ref/Tags/remoteLink.html" class="tags">remoteLink</a>タグを使用して呼び出します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"showBook"</span> id=<span class="xml&#45;quote">"$&#123;book.id&#125;"</span>
              update=<span class="xml&#45;quote">"book$&#123;book.id&#125;"</span>&#62;</span>Update Book<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"book$&#123;book.id&#125;"</span>&#62;</span>
   <span class="xml&#45;comment">&#60;!&#45;&#45;existing book mark&#45;up &#45;&#45;&#62;</span>
<span class="xml&#45;tag">&#60;/div&#62;</span></pre></div><p class="paragraph"/><h4>JSONを使用したデータ中心のAjax <div class="hidden-block">Data Centric Ajax with JSON </div></h4><p class="paragraph"/><div class="hidden-block">Data Centric Ajax typically involves evaluating the response on the client and updating programmatically. For a JSON response with Grails you would typically use Grails' <a href="../guide/single.html#xmlAndJSON" class="guide">JSON marshalling</a> capability:</div>
データ中心のAjaxでは、クライアントがレスポンスで取得した内容を評価してプログラムで更新をします。GrailsではJSONのレスポンスを返すには<a href="../guide/single.html#xmlAndJSON" class="guide">JSONマーシャリング</a>を使用します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.JSON<p class="paragraph"/>def showBook() &#123;
    def b = Book.get(params.id)<p class="paragraph"/>    render b as JSON
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">And then on the client parse the incoming JSON request using an Ajax event handler:</div>
クライアント側で取得したJSONをAjaxイベントハンドラを使って処理します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript&#62;</span>
function updateBook(data) &#123;
    $(<span class="xml&#45;quote">"&#35;book"</span> + data.id + <span class="xml&#45;quote">"_title"</span>).html( data.title );
&#125;
<span class="xml&#45;tag">&#60;/g:javascript&#62;</span>
<span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"showBook"</span> id=<span class="xml&#45;quote">"$&#123;book.id&#125;"</span> onSuccess=<span class="xml&#45;quote">"updateBook(data)"</span>&#62;</span>
    Update Book
<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span>
<span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"bookId"</span>&#62;</span>book$&#123;book.id&#125;<span class="xml&#45;tag">&#60;/g:set&#62;</span>
<span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"$&#123;bookId&#125;"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"$&#123;bookId&#125;_title"</span>&#62;</span>The Stand<span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;/div&#62;</span></pre></div><p class="paragraph"/><h4>XMLを使用したデータ中心のAjax <div class="hidden-block">Data Centric Ajax with XML </div></h4><p class="paragraph"/><div class="hidden-block">On the server side using XML is equally simple:</div>
サーバサイドでXMLをえお扱うのも簡単です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.XML<p class="paragraph"/>def showBook() &#123;
    def b = Book.get(params.id)<p class="paragraph"/>    render b as XML
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">However, since DOM is involved the client gets more complicated:</div>
しかしクライアント側でのDOM操作は複雑になります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:javascript&#62;</span>
function updateBook(data) &#123;
    var id = $(data).find(<span class="xml&#45;quote">"book"</span>).attr(<span class="xml&#45;quote">"id"</span>);
    $(<span class="xml&#45;quote">"&#35;book"</span> + id + <span class="xml&#45;quote">"_title"</span>).html( $(data).find(<span class="xml&#45;quote">"title"</span>).text() );
&#125;
<span class="xml&#45;tag">&#60;g:javascript&#62;</span>
<span class="xml&#45;tag">&#60;g:remoteLink action=<span class="xml&#45;quote">"test"</span> update=<span class="xml&#45;quote">"foo"</span> onSuccess=<span class="xml&#45;quote">"updateBook(e)"</span>&#62;</span>
    Update Book
<span class="xml&#45;tag">&#60;/g:remoteLink&#62;</span>
<span class="xml&#45;tag">&#60;g:set var=<span class="xml&#45;quote">"bookId"</span>&#62;</span>book$&#123;book.id&#125;<span class="xml&#45;tag">&#60;/g:set&#62;</span>
<span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"$&#123;bookId&#125;"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"$&#123;bookId&#125;_title"</span>&#62;</span>The Stand<span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;/div&#62;</span></pre></div><p class="paragraph"/><h4>スクリプトを使用したAjax <div class="hidden-block">Script Centric Ajax with JavaScript </div></h4><p class="paragraph"/><div class="hidden-block">Script centric Ajax involves actually sending JavaScript back that gets evaluated on the client. An example of this can be seen below:</div>
スクリプトを使用したAjaxは、Javascriptを返してクライアント側で動作(評価)させます。以下が例になります:<p class="paragraph"/><div class="code"><pre>def showBook() &#123;
    def b = Book.get(params.id)<p class="paragraph"/>    response.contentType = <span class="java&#45;quote">"text/javascript"</span>
    <span class="java&#45;object">String</span> title = b.title.encodeAsJavaScript()
    render <span class="java&#45;quote">"&#36;('&#35;book$&#123;b.id&#125;_title').html('$&#123;title&#125;');"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The important thing to remember is to set the <code>contentType</code> to <code>text/javascript</code>. If you use Prototype on the client the returned JavaScript will automatically be evaluated due to this <code>contentType</code> setting.</div>
重要な部分として<code>contentType</code>を<code>text/javascript</code>にすることを思えて起きましょう。Prototypeを使用した場合はこの<code>contentType</code>で自動的にJavaScriptを評価します。<p class="paragraph"/><div class="hidden-block">Obviously in this case it is critical that you have an agreed client-side API as you don't want changes on the client breaking the server. This is one of the reasons Rails has something like RJS. Although Grails does not currently have a feature such as RJS there is a <a href="http://grails.org/plugin/dynamic-javascript" target="blank">Dynamic JavaScript Plugin</a> that offers similar capabilities.</div>
当然このケースでは、クライアントがサーバを壊す事が無いと認めたクライアントサイトAPIでは無いと危険です。これがRailsではRJSを持っている理由です。Grailsには、RJSに相当する仕組みは存在しませんが、同じような内容の仕組みが <a href="http://grails.org/plugin/dynamic-javascript" target="blank">Dynamic JavaScript</a>プラグインで提供されています。<p class="paragraph"/><h4>AjaxとAjaxでない両方へのレスポンス <div class="hidden-block">Responding to both Ajax and non-Ajax requests </div></h4><p class="paragraph"/><div class="hidden-block">It's straightforward to have the same Grails controller action handle both Ajax and non-Ajax requests. Grails adds the <code>isXhr()</code> method to <code>HttpServletRequest</code> which can be used to identify Ajax requests. For example you could render a page fragment using a template for Ajax requests or the full page for regular HTTP requests:</div>
AjaxとAjaxではないリクエストを同じコントローラアクションで処理ができます。Grailsでは、Ajaxリクエスト判別用に、<code>HttpServletRequest</code>に<code>isXhr()</code>メソッドを追加しています。例として、Ajaxリクエストの場合はテンプレートでページの一部を描写し、それ以外は全ページ描写を行う場合:<p class="paragraph"/><div class="code"><pre>def listBooks() &#123;
    def books = Book.list(params)
    <span class="java&#45;keyword">if</span> (request.xhr) &#123;
        render template: <span class="java&#45;quote">"bookTable"</span>, model: &#91;books: books&#93;
    &#125; <span class="java&#45;keyword">else</span> &#123;
        render view: <span class="java&#45;quote">"list"</span>, model: &#91;books: books&#93;
    &#125;
&#125;</pre></div>


<a name="7.8 Content Negotiation"><!-- Legacy link --></a>
<h2 id="contentNegotiation">7.8 コンテントネゴシエーション</h2>
<div class="hidden-block">Grails has built in support for <a href="http://en.wikipedia.org/wiki/Content_negotiation" target="blank">Content negotiation</a> using either the HTTP <code>Accept</code> header, an explicit format request parameter or the extension of a mapped URI.</div>
Grailsには、明示的なフォーマットに対するリクエストのHTTP <code>Accept</code>ヘッダーまたはマップされたURIの拡張子での<a href="http://en.wikipedia.org/wiki/Content_negotiation" target="blank">コンテントネゴシエーション</a>に対応しています。<p class="paragraph"/><h4>Mimeタイプの定義 <div class="hidden-block">Configuring Mime Types</div></h4><p class="paragraph"/><div class="hidden-block">Before you can start dealing with content negotiation you need to tell Grails what content types you wish to support. By default Grails comes configured with a number of different content types within <code>grails-app/conf/Config.groovy</code> using the <code>grails.mime.types</code> setting: </div>
コンテントネゴシエーションの処理を行うには、どのコンテントタイプをサポートするかをGrailsに教える必要があります。<code>grails-app/conf/Config.groovy</code>の<code>grails.mime.types</code>設定に幾つかのコンテントタイプがデフォルトで定義されています:<p class="paragraph"/><div class="code"><pre>grails.mime.types = &#91; xml: &#91;'text/xml', 'application/xml'&#93;,
                      text: 'text&#45;plain',
                      js: 'text/javascript',
                      rss: 'application/rss+xml',
                      atom: 'application/atom+xml',
                      css: 'text/css',
                      csv: 'text/csv',
                      all: '&#42;/&#42;',
                      json: 'text/json',
                      html: &#91;'text/html','application/xhtml+xml'&#93;
                    &#93;</pre></div><p class="paragraph"/><div class="hidden-block">The above bit of configuration allows Grails to detect to format of a request containing either the 'text/xml' or 'application/xml' media types as simply 'xml'. You can add your own types by simply adding new entries into the map.</div>
この設定の一部を説明すると、'text/xml'または'application/xml'を含むリクエストは単純にコンテントタイプ'xml'としてGrailsが検出するのを可能にします。独自のタイプを追加するには単純にマップにタイプを追加するだけです。<p class="paragraph"/><h4>Content Negotiation using the format parameter</h4><p class="paragraph"/>Let's say a controller action can return a resource in a variety of formats: HTML, XML, and JSON. What format will the client get? The easiest and most reliable way for the client to control this is through a <code>format</code> URL parameter.<p class="paragraph"/>So if you, as a browser or some other client, want a resource as XML, you can use a URL like this:<p class="paragraph"/><div class="code"><pre>http://my.domain.org/books?format=xml</pre></div><p class="paragraph"/>The result of this on the server side is a <code>format</code> property on the <code>response</code> object with the value <code>xml</code> . You could code your controller action to return XML based on this property, but you can also make use of the controller-specific <code>withFormat()</code> method:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.JSON
<span class="java&#45;keyword">import</span> grails.converters.XML<p class="paragraph"/>class BookController &#123;<p class="paragraph"/>    def list() &#123;
        def books = Book.list()<p class="paragraph"/>        withFormat &#123;
            html bookList: books
            json &#123; render books as JSON &#125;
            xml &#123; render books as XML &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>In this example, Grails will only execute the block inside <code>withFormat()</code> that matches the requested content type. So if the preferred format is <code>html</code> then Grails will execute the <code>html()</code> call only. Each 'block' can either be a map model for the corresponding view (as we are doing for 'html' in the above example) or a closure. The closure can contain any standard action code, for example it can return a model or render content directly.<p class="paragraph"/>There is a special format, "all", that is handled differently from the explicit formats. If "all" is specified (normally this happens through the Accept header - see below), then the first block of <code>withFormat()</code> is executed. You should not add an explicit "all" block. In the above example, a format of "all" will trigger the <code>html</code> handler.<p class="paragraph"/><blockquote class="note">
When using <a href="../ref/Controllers/withFormat.html" class="controllers">withFormat</a> make sure it is the last call in your controller action as the return value of the <code>withFormat</code> method is used by the action to dictate what happens next.
</blockquote><p class="paragraph"/><h4>Acceptヘッダーを使用する <div class="hidden-block">Using the Accept header </div></h4><p class="paragraph"/>Every incoming HTTP request has a special <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html" target="blank">Accept</a> header that defines what media types (or mime types) a client can "accept". In older browsers this is typically:<p class="paragraph"/><div class="code"><pre>&#42;/&#42;</pre></div><p class="paragraph"/>which simply means anything. However, newer browsers send more interesting values such as this one sent by Firefox:<p class="paragraph"/><div class="code"><pre>text/xml, application/xml, application/xhtml+xml, text/html;q=0.9, &#10;    text/plain;q=0.8, image/png, &#42;/&#42;;q=0.5</pre></div><p class="paragraph"/>This particular accept header is unhelpful because it indicates that XML is the preferred response format whereas the user is really expecting HTML. That's why Grails ignores the accept header by default for browsers. However, non-browser clients are typically more specific in their requirements and can send accept headers such as<p class="paragraph"/><div class="code"><pre>application/json</pre></div><p class="paragraph"/>As mentioned the default configuration in Grails is to ignore the accept header for browsers. This is done by the configuration setting <code>grails.mime.disable.accept.header.userAgents</code>, which is configured to detect the major rendering engines and ignore their ACCEPT headers. This allows Grails' content negotiation to continue to work for non-browser clients:<p class="paragraph"/><div class="code"><pre>grails.mime.disable.accept.header.userAgents = &#91;'Gecko', 'WebKit', 'Presto', 'Trident'&#93;</pre></div><p class="paragraph"/>For example, if it sees the accept header above ('application/json') it will set <code>format</code> to <code>json</code> as you'd expect. And of course this works with the <code>withFormat()</code> method in just the same way as when the <code>format</code> URL parameter is set (although the URL parameter takes precedence).<p class="paragraph"/>An accept header of '&#42;/&#42;' results in a value of <code>all</code> for the <code>format</code> property.<p class="paragraph"/>
<h4>リクエストフォーマット vs レスポンスフォーマット <div class="hidden-block">Request format vs. Response format </div></h4><p class="paragraph"/><div class="hidden-block">As of Grails 2.0, there is a separate notion of the  <em class="italic">request</em>  format and the  <em class="italic">response</em>  format. The request format is dictated by the <code>CONTENT_TYPE</code> header and is typically used to detect if the incoming request can be parsed into XML or JSON, whilst the response format uses the file extension, format parameter or ACCEPT header to attempt to deliver an appropriate response to the client.</div>
Grails 2.0からの対応で、リクエストフォーマットとレスポンスフォーマットでは分離して認識するようになりました。リクエストフォーマットは、<code>CONTENT_TYPE</code>ヘッダの指定で入ってくるリクエストを認識してXMLまたJSON等に分類します。レスポンスフォーマットでは、ファイル拡張子、フォーマットパラメータまたはACCEPTヘッダを認識して適したレスポンスをクライアントに返します。<p class="paragraph"/><div class="hidden-block">The <a href="../ref/Controllers/withFormat.html" class="controllers">withFormat</a> available on controllers deals specifically with the response format. If you wish to add logic that deals with the request format then you can do so using a separate <code>withFormat</code> method available on the request:</div>
コントローラでの<a href="../ref/Controllers/withFormat.html" class="controllers">withFormat</a>はレスポンスフォーマット専用となります。リクエストフォーマットでロジックを記述する場合は、requestオブジェクトの<code>withFormat</code>メソッドを使用します:<p class="paragraph"/><div class="code"><pre>request.withFormat &#123;
    xml &#123;
        // read XML
    &#125;
    json &#123;
        // read JSON
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>リクエストパラメータformatでのコンテントネゴシエーション <div class="hidden-block">Content Negotiation with the format Request Parameter </div></h4><p class="paragraph"/><div class="hidden-block">If fiddling with request headers if not your favorite activity you can override the format used by specifying a <code>format</code> request parameter:</div>
リクエストヘッダを参照した方法を行いたく無い場合は、フォーマットを指定するために、リクエストパラメータの<code>format</code>が使用できます:<p class="paragraph"/><div class="code"><pre>/book/list?format=xml</pre></div><p class="paragraph"/><div class="hidden-block">You can also define this parameter in the <a href="../guide/single.html#urlmappings" class="guide">URL Mappings</a> definition:</div>
このパラメータは<a href="../guide/single.html#urlmappings" class="guide">URLマッピング</a>でも定義できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/book/list"</span>(controller:<span class="java&#45;quote">"book"</span>, action:<span class="java&#45;quote">"list"</span>) &#123;
    format = <span class="java&#45;quote">"xml"</span>
&#125;</pre></div><p class="paragraph"/><h4>URI拡張子でのコンテントネゴシエーション <div class="hidden-block">Content Negotiation with URI Extensions </div></h4><p class="paragraph"/><div class="hidden-block">Grails also supports content negotiation using URI extensions. For example given the following URI:</div>
URI拡張子でのコンテントネゴシエーションにも対応しています。例として次のようなURIがあるとします:<p class="paragraph"/><div class="code"><pre>/book/list.xml</pre></div><p class="paragraph"/>This works as a result of the default URL Mapping definition which is:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/$controller/$action?/$id?(.$&#123;format&#125;)?"</span>&#123;</pre></div><p class="paragraph"/>Note the inclusion of the <code>format</code> variable in the path. If you do not wish to use content negotiation via the file extension then simply remove this part of the URL mapping:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/$controller/$action?/$id?"</span>&#123;</pre></div><p class="paragraph"/>
<h4>コンテントネゴシエーションをテスト <div class="hidden-block">Testing Content Negotiation </div></h4><p class="paragraph"/><div class="hidden-block">To test content negotiation in a unit or integration test (see the section on <a href="../guide/single.html#testing" class="guide">Testing</a>) you can either manipulate the incoming request headers:</div>
ユニットテストまたは統合テスト(<a href="../guide/single.html#testing" class="guide">テスト</a>のセクションを参照)でコンテントネゴシエーションをテストする際に、入ってくるリクエストヘッダを操作することができます:<p class="paragraph"/><div class="code"><pre>void testJavascriptOutput() &#123;
    def controller = <span class="java&#45;keyword">new</span> TestController()
    controller.request.addHeader <span class="java&#45;quote">"Accept"</span>,
              <span class="java&#45;quote">"text/javascript, text/html, application/xml, text/xml, &#42;/&#42;"</span><p class="paragraph"/>    controller.testAction()
    assertEquals <span class="java&#45;quote">"alert('hello')"</span>, controller.response.contentAsString
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Or you can set the format parameter to achieve a similar effect:</div>
または、formatパラメータをセットすることが可能です:<p class="paragraph"/><div class="code"><pre>void testJavascriptOutput() &#123;
    def controller = <span class="java&#45;keyword">new</span> TestController()
    controller.params.format = 'js'<p class="paragraph"/>    controller.testAction()
    assertEquals <span class="java&#45;quote">"alert('hello')"</span>, controller.response.contentAsString
&#125;</pre></div>


<a name="8. Web Services"><!-- Legacy link --></a>
<h1 id="webServices">8 Webサービス</h1>
<div class="hidden-block">Web Services are all about providing a web API onto your web application and are typically implemented in either <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer" target="blank">REST</a> or <a href="http://en.wikipedia.org/wiki/SOAP." target="blank">SOAP</a>
</div>
WebサービスはWebアプリケーションにWeb APIを提供するものであり、通常は<a href="http://ja.wikipedia.org/wiki/SOAP_(プロトコル)" target="blank">SOAP</a>または<a href="http://ja.wikipedia.org/wiki/Representational_State_Transfer" target="blank">REST</a>で実装されています。


<a name="8.1 REST"><!-- Legacy link --></a>
<h2 id="REST">8.1 REST</h2>
<div class="hidden-block">REST is not really a technology in itself, but more an architectural pattern. REST is very simple and just involves using plain XML or JSON as a communication medium, combined with URL patterns that are "representational" of the underlying system, and HTTP methods such as GET, PUT, POST and DELETE.</div>
RESTは本来SOAPのようなプロトコルではなく、アーキテクチャスタイルです。RESTは非常に単純です。簡素なXMLやJSONを通信媒体に用いて、基本的なシステムとGET、PUT、POSTおよびDELETEといったHTTPメソッドを「表現する」URLパターンを組み合わせています。<p class="paragraph"/><div class="hidden-block">Each HTTP method maps to an action type. For example GET for retrieving data, POST for creating data, PUT for updating and so on.</div>
それぞれのHTTPメソッドは異なるアクションにマップします。例えば、GETはデータ検索、PUTはデータ作成、POSTは更新などとマップします。<p class="paragraph"/>Grails includes flexible features that make it easy to create RESTful APIs. Creating a RESTful resource can be as simple as one line of code, as demonstrated in the next section.<p class="paragraph"/>
<blockquote class="warning">
Grails 2.3で大幅な更新が行われるため、日本語版のみ旧仕様のドキュメントを一時的に残しておきます。
以下、Grails 2.2.x 以前の仕様になります。
</blockquote><p class="paragraph"/><h4>URLパターン <div class="hidden-block">URL patterns</div></h4><p class="paragraph"/><div class="hidden-block">The first step to implementing REST with Grails is to provide RESTful <a href="../guide/single.html#urlmappings" class="guide">URL mappings</a>:</div>
GrailsでRESTを実装する１つ目のやり方として、以下のようにRESTfulな<a href="../guide/single.html#urlmappings" class="guide">URLマッピング</a>を提供する方法があります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
   <span class="java&#45;quote">"/product/$id?"</span>(resource:<span class="java&#45;quote">"product"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This maps the URI <code>/product</code> onto a <code>ProductController</code>. Each HTTP method such as GET, PUT, POST and DELETE map to unique actions within the controller as outlined by the table below:</div>
この例では、<code>/product</code>というURIを<code>ProductController</code>に紐付けます。GET、PUT、POSTおよびDELETEといった各HTTPメソッドは、下表に示したようにコントローラ内の一意のアクションに紐付きます。<p class="paragraph"/><div class="hidden-block">
Method     | Action
</div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>メソッド</th><th>アクション</th></tr><tr class="table-odd"><td><code>GET</code></td><td><code>show</code></td></tr><tr class="table-even"><td><code>PUT</code></td><td><code>update</code></td></tr><tr class="table-odd"><td><code>POST</code></td><td><code>save</code></td></tr><tr class="table-even"><td><code>DELETE</code></td><td><code>delete</code></td></tr></table><p class="paragraph"/><div class="hidden-block">In addition, Grails provides automatic XML or JSON marshalling for you.</div>
さらにGrailsではXMLまたJSONでの自動マーシャリングも提供しています。<p class="paragraph"/><div class="hidden-block">You can alter how HTTP methods are handled by using URL Mappings to <a href="../guide/single.html#mappingHTTP" class="guide">map to HTTP methods</a>:</div>
<a href="../guide/single.html#mappingHTTP" class="guide">HTTPメソッドをマップ</a>する仕組みを使用して、URLマッピングをHTTPメソッドにハンドルすることが可能です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/product/$id"</span>(controller: <span class="java&#45;quote">"product"</span>) &#123;
    action = &#91;GET: <span class="java&#45;quote">"show"</span>, PUT: <span class="java&#45;quote">"update"</span>, DELETE: <span class="java&#45;quote">"delete"</span>, POST: <span class="java&#45;quote">"save"</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">However, unlike the <code>resource</code> argument used previously, in this case Grails will not provide automatic XML or JSON marshalling unless you specify the <code>parseRequest</code> argument:</div>
ただし、この場合は、先の<code>resource</code>と違い、<code>parseRequest</code>変数をURLマッピングに指定しないと、XMLやJSONのマーシャリングを自動的には行いません:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/product/$id"</span>(controller: <span class="java&#45;quote">"product"</span>, parseRequest: <span class="java&#45;keyword">true</span>) &#123;
    action = &#91;GET: <span class="java&#45;quote">"show"</span>, PUT: <span class="java&#45;quote">"update"</span>, DELETE: <span class="java&#45;quote">"delete"</span>, POST: <span class="java&#45;quote">"save"</span>&#93;
&#125;</pre></div><p class="paragraph"/><h4>HTTPメソッド <div class="hidden-block">HTTP Methods</div></h4><p class="paragraph"/><div class="hidden-block">In the previous section you saw how you can easily define URL mappings that map specific HTTP methods onto specific controller actions. Writing a REST client that then sends a specific HTTP method is then easy (example in Groovy's HTTPBuilder module):</div>
前のセクションでは、特定のHTTPメソッドを特定のコントローラのアクションにマップするURLマッピングが、どれほど簡単に定義できるかを見ました。特定のHTTPメソッドを送信するRESTクライアントを作成するのも簡単です。（GroovyのHTTPBuilderモジュールの例）:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> groovyx.net.http.&#42;
<span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> groovyx.net.http.ContentType.JSON<p class="paragraph"/>def http = <span class="java&#45;keyword">new</span> HTTPBuilder(<span class="java&#45;quote">"http://localhost:8080/amazon"</span>)<p class="paragraph"/> http.request(Method.GET, JSON) &#123;
     url.path = '/book/list'
     response.success = &#123; resp, json &#45;&#62;
         <span class="java&#45;keyword">for</span> (book in json.books) &#123;
             println book.title
         &#125;
     &#125;
 &#125;</pre></div><p class="paragraph"/><div class="hidden-block">Issuing a request with a method other than <code>GET</code> or <code>POST</code> from a regular browser is not possible without some help from Grails. When defining a <a href="../ref/Tags/form.html" class="tags">form</a> you can specify an alternative method such as <code>DELETE</code>:</div>
通常のブラウザから<code>GET</code>または<code>POST</code>以外のメソッドの要求を発行するためには、Grailsの援助が必要となります。フォーム(<a href="../ref/Tags/form.html" class="tags">form</a>)を定義する時に、<code>DELETE</code>のような別のメソッドを指定できます。<p class="paragraph"/><div class="code"><pre>&#60;g:form controller=<span class="java&#45;quote">"book"</span> method=<span class="java&#45;quote">"DELETE"</span>&#62;
    ..
&#60;/g:form&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Grails will send a hidden parameter called <code>_method</code>, which will be used as the request's HTTP method. Another alternative for changing the method for non-browser clients is to use the <code>X-HTTP-Method-Override</code> to specify the alternative method name.</div>
Grailsは<code>_method</code>というhiddenパラメータを送信し、これをHTTPメソッドの要求として使用します。ブラウザ以外のクライアントでメソッドを変更するためには、<code>X-HTTP-Method-Override</code>を使用して代替メソッド名を指定します。<p class="paragraph"/><h4>XMLマーシャリング - 読み取り <div class="hidden-block">XML Marshalling - Reading</div></h4><p class="paragraph"/><div class="hidden-block">The controller can use Grails' <a href="../guide/single.html#xmlAndJSON" class="guide">XML marshalling</a> support to implement the GET method:</div>
Grailsの<a href="../guide/single.html#xmlAndJSON" class="guide">XMLマーシャリングの機能</a>をコントローラで使用して、GETメソッドの実装できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.XML<p class="paragraph"/>class ProductController &#123;
    def show() &#123;
        <span class="java&#45;keyword">if</span> (params.id &#38;&#38; Product.exists(params.id)) &#123;
            def p = Product.findByName(params.id)
            render p as XML
        &#125;
        <span class="java&#45;keyword">else</span> &#123;
            def all = Product.list()
            render all as XML
        &#125;
    &#125;
    ..
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If there is an <code>id</code> we search for the <code>Product</code> by name and return it, otherwise we return all Products. This way if we go to <code>/products</code> we get all products, otherwise if we go to <code>/product/MacBook</code> we only get a MacBook.</div>
この例では、検索した内容が存在した場合はその<code>Product</code>を返し、無い場合は全てを返します。この方法で、<code>/product</code>にアクセスすると全リストが返り、<code>/product/MacBook</code>等指定して存在した場合は、その<code>Product</code>を返します。<p class="paragraph"/><h4>XMLマーシャリング - 更新 <div class="hidden-block">XML Marshalling - Updating</div></h4><p class="paragraph"/><div class="hidden-block">To support updates such as <code>PUT</code> and <code>POST</code> you can use the <a href="../ref/Controllers/params.html" class="controllers">params</a> object which Grails enhances with the ability to read an incoming XML packet. Given an incoming XML packet of:</div>
<code>PUT</code>および<code>POSTの</code>ような更新をサポートするには、Grailsの<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトを利用してXMLを読み取ることができます。次のようなXMLを受信したとします。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;?xml version=<span class="xml&#45;quote">"1.0"</span> encoding=<span class="xml&#45;quote">"ISO&#45;8859&#45;1"</span>?&#62;</span>
<span class="xml&#45;tag">&#60;product&#62;</span>
    <span class="xml&#45;tag">&#60;name&#62;</span>MacBook<span class="xml&#45;tag">&#60;/name&#62;</span>
    <span class="xml&#45;tag">&#60;vendor id=<span class="xml&#45;quote">"12"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;name&#62;</span>Apple<span class="xml&#45;tag">&#60;/name&#62;</span>
     <span class="xml&#45;tag">&#60;/vender&#62;</span>
<span class="xml&#45;tag">&#60;/product&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">you can read this XML packet using the same techniques described in the <a href="../guide/single.html#dataBinding" class="guide">Data Binding</a> section, using the <a href="../ref/Controllers/params.html" class="controllers">params</a> object:</div>
このXMLを読み込むには、<a href="../guide/single.html#dataBinding" class="guide">データバインディング</a>の章に記述された内容と同じく、<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトから取得することができます:<p class="paragraph"/><div class="code"><pre>def save() &#123;
    def p = <span class="java&#45;keyword">new</span> Product(params.product)<p class="paragraph"/>    <span class="java&#45;keyword">if</span> (p.save()) &#123;
        render p as XML
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
        render p.errors
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example by indexing into the <code>params</code> object using the <code>product</code> key we can automatically create and bind the XML using the <code>Product</code> constructor. An interesting aspect of the line:</div>
この例では、<code>params</code>オブジェクトから<code>product</code>キーを使用して取得し、<code>Product</code>クラスのコンストラクタに渡すことで自動的にバインドします:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Product(params.product)</pre></div><p class="paragraph"/><div class="hidden-block">is that it requires no code changes to deal with a form submission that submits form data, or an XML request, or a JSON request.</div>
興味深い点は、JSONリクエストまたはXMLリクエストの対応は、通常のフォーム送信の対応とそれほど変わりがないということです。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If you require different responses to different clients (REST, HTML etc.) you can use <a href="../guide/single.html#contentNegotiation" class="guide">content negotation</a></div>
異なったクライアント（REST、HTMLなど）に対する異なった応答が必要な場合は、<a href="../guide/single.html#contentNegotiation" class="guide">コンテントネゴシエーション</a>を使用することができます。
</blockquote><p class="paragraph"/><div class="hidden-block">The <code>Product</code> object is then saved and rendered as XML, otherwise an error message is produced using Grails' <a href="../guide/single.html#validation" class="guide">validation</a> capabilities in the form:</div>
<code>Product</code>オブジェクトが保存され、XMLとして描写されます。問題が起きた場合は、Grailsの<a href="../guide/single.html#validation" class="guide">バリデーション</a>機能によってエラーメッセージが返信されます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;error&#62;</span>
   <span class="xml&#45;tag">&#60;message&#62;</span>The property 'title' of class 'Person' must be specified<span class="xml&#45;tag">&#60;/message&#62;</span>
<span class="xml&#45;tag">&#60;/error&#62;</span></pre></div><p class="paragraph"/><h4>JAX-RSでのREST <div class="hidden-block">REST with JAX-RS</div></h4><p class="paragraph"/><div class="hidden-block">There also is a <a href="http://grails.org/plugin/jaxrs" target="blank">JAX-RS Plugin</a> which can be used to build web services based on the Java API for RESTful Web Services (<a href="http://jcp.org/en/jsr/summary?id=311" target="blank">JSR 311: JAX-RS</a>).</div>
RESTful Webサービス用のJava APIをベースとしたRESTを、<a href="http://grails.org/plugin/jaxrs" target="blank">JAX-RSプラグイン</a>構築することも可能です。  (<a href="http://jcp.org/en/jsr/summary?id=311" target="blank">JSR 311: JAX-RS</a>)



<h2 id="domainResources">8.1.1 RESTリソースとしてドメインクラスを使用する</h2>
<div class="hidden-block">
The easiest way to create a RESTful API in Grails is to expose a domain class as a REST resource. This can be done by adding the <code>grails.rest.Resource</code> transformation to any domain class:
</div>
GrailsでRESTFul APIを簡単に作成する方法は、ドメインクラスをRESTリソースとして公開することです。
これは、任意のドメインクラスに<code>grails.rest.Resource</code>変換を追加するだけです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.&#42;<p class="paragraph"/>@Resource(uri='/books')
class Book &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        title blank:<span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Simply by adding the <code>Resource</code> transformation and specifying a URI, your domain class will automatically be available as a REST resource in either XML or JSON formats. The transformation will automatically register the necessary <a href="../guide/single.html#restfulMappings" class="guide">RESTful URL mapping</a> and create a controller called <code>BookController</code>.
</div>
単に<code>Resource</code>変換を追加してURIを指定することで、ドメインクラスは自動的にXML、JSONフォーマットをサポートするRESTリソースとして使用可能になります。
この変換は、必要な<a href="../guide/single.html#restfulMappings" class="guide">RESTful URL マッピング</a>を自動的に登録し、<code>BookController</code>と呼ばれるコントローラを作成します。<p class="paragraph"/><div class="hidden-block">
You can try it out by adding some test data to <code>BootStrap.groovy</code>:
</div>
いくつかのテストデータを<code>BootStrap.groovy</code>に追加することで動作確認ができます。<p class="paragraph"/><div class="code"><pre>def init = &#123; servletContext &#45;&#62;<p class="paragraph"/>        <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Stand"</span>).save()
        <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Shining"</span>).save()
    &#125;</pre></div><p class="paragraph"/><div class="hidden-block">
And then hitting the URL http://localhost:8080/myapp/books/1, which will render response like:
</div>
そして、<code>http://localhost:8080/myapp/books/1</code>のURLをたたいてみると、以下のようなレスポンスが表示されます:<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"UTF&#45;8"</span>?&#62;
&#60;book id=<span class="java&#45;quote">"1"</span>&#62;
    &#60;title&#62;The Stand&#60;/title&#62;
&#60;/book&#62;</pre></div><p class="paragraph"/><div class="hidden-block">
If you change the URL to <code>http://localhost:8080/myapp/books/1.json</code> you will get a JSON response such as:
</div>
URLを<code>http://localhost:8080/myapp/books/1.json</code>に変更すると、以下のようなJSONレスポンスが得られます:<p class="paragraph"/>
<div class="code"><pre>&#123;<span class="java&#45;quote">"id"</span>:1,<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If you wish to change the default to return JSON instead of XML, you can do this by setting the <code>formats</code> attribute of the <code>Resource</code> transformation:
</div>
XMLの代わりにデフォルトでJSONを返したい場合は、<code>Resource</code>変換の<code>formats</code>属性を設定します。<p class="paragraph"/> <div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.&#42;<p class="paragraph"/>@Resource(uri='/books', formats=&#91;'json', 'xml'&#93;)
class Book &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
With the above example JSON will be prioritized. The list that is passed should contain the names of the formats that the resource should expose. The names of formats are defined in the <code>grails.mime.types</code> setting of <code>Config.groovy</code>:
</div>
上記の例ではJSONを優先するように設定しています。
この一覧には公開するフォーマットの名前を含む必要があります。
フォーマットの名前は<code>Config.groovy</code>の<code>grails.mime.types</code>設定の中で定義されます:<p class="paragraph"/><div class="code"><pre>grails.mime.types = &#91;
    &#8230;
    json:          &#91;'application/json', 'text/json'&#93;,
    &#8230;
    xml:           &#91;'text/xml', 'application/xml'&#93;
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">
See the section on <a href="../guide/single.html#contentNegotiation" class="guide">Configuring Mime Types</a> in the user guide for more information.
</div>
さらなる情報はユーザガイド内の<a href="../guide/single.html#contentNegotiation" class="guide">MIMEタイプの定義</a>を参照してください。<p class="paragraph"/><div class="hidden-block">
Instead of using the file extension in the URI, you can also obtain a JSON response using the ACCEPT header. Here's an example using the Unix <code>curl</code> tool:
</div>
URIでファイル拡張子を使う代わりに、ACCEPTヘッダを使ってJSONレスポンスを得ることもできます。
これはUnixの<code>curl</code>コマンドを使用した例です:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept: application/json"</span> localhost:8080/myapp/books/1
&#123;<span class="java&#45;quote">"id"</span>:1,<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This works thanks to Grails' <a href="../guide/single.html#contentNegotiation" class="guide">Content Negotiation</a> features.
</div>
これはGrailsの<a href="../guide/single.html#contentNegotiation" class="guide">コンテントネゴシエーション</a>機能のおかげで動作しています。<p class="paragraph"/><div class="hidden-block">
You can create a new resource by issuing a <code>POST</code> request:
</div>
<code>POST</code>リクエスを発行することで新たなリソースを作成できます:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;X POST &#45;H <span class="java&#45;quote">"Content&#45;Type: application/json"</span> &#45;d '&#123;<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"Along Came A Spider"</span>&#125;' localhost:8080/myapp/books
HTTP/1.1 201 Created
Server: Apache&#45;Coyote/1.1
...</pre></div><p class="paragraph"/><div class="hidden-block">
Updating can be done with a <code>PUT</code> request:
</div>
更新には<code>PUT</code>リクエストを使用します:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;X PUT &#45;H <span class="java&#45;quote">"Content&#45;Type: application/json"</span> &#45;d '&#123;<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"Along Came A Spider"</span>&#125;' localhost:8080/myapp/books/1
HTTP/1.1 200 OK
Server: Apache&#45;Coyote/1.1
...</pre></div><p class="paragraph"/><div class="hidden-block">
Finally a resource can be deleted with <code>DELETE</code> request:
</div>
最後に、<code>DELETE</code>リクエストでリソースが削除されます:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;X DELETE localhost:8080/myapp/books/1
HTTP/1.1 204 No Content
Server: Apache&#45;Coyote/1.1
...</pre></div><p class="paragraph"/><div class="hidden-block">
As you can see the <code>Resource</code> transformation enables all of the HTTP method verbs on the resource. You can enable only read-only capabilities by setting the <code>readOnly</code> attribute to true:
</div>
ここまで見てきたように、<code>Resource</code>変換はリソースに対してHTTPメソッドに対応する動作のすべてを有効にします。
<code>readOnly</code>属性をtrueに設定することで読み取り専用にできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.&#42;<p class="paragraph"/>@Resource(uri='/books', readOnly=<span class="java&#45;keyword">true</span>)
class Book &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this case POST, PUT and DELETE requests will be forbidden.
</div>
この場合は、POST、PUT、そしてDELETEリクエストを受付けません。



<h2 id="urlMappings">8.1.2 RESTリソースへのマッピング</h2>
<div class="hidden-block">
If you prefer to keep the declaration of the URL mapping in your <code>UrlMappings.groovy</code> file then simply removing the <code>uri</code> attribute of the <code>Resource</code> transformation and adding the following line to <code>UrlMappings.groovy</code> will suffice:
</div>
もし<code>UrlMappings.groovy</code>内にURLマッピングの宣言を保持したい場合は、単に<code>Resource</code>変換から<code>uri</code>属性を削除して、<code>UrlMappings.groovy</code>へ以下の行を追加するだけです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources:<span class="java&#45;quote">"book"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">
Extending your API to include more end points then becomes trivial:
</div>
APIを拡張して、さらにエンドポイントを追加したい場合は以下のようにします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(resources:<span class="java&#45;quote">"book"</span>) &#123;
    <span class="java&#45;quote">"/publisher"</span>(controller:<span class="java&#45;quote">"publisher"</span>, method:<span class="java&#45;quote">"GET"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The above example will expose the URI <code>/books/1/publisher</code>.
</div>
上記の例は<code>/books/1/publisher</code>というURIで公開されます。<p class="paragraph"/><div class="hidden-block">
A more detailed explanation on <a href="../guide/single.html#restfulMappings" class="guide">creating RESTful URL mappings</a> can be found in the <a href="../guide/single.html#urlMappings" class="guide">URL Mappings section</a> of the user guide.
</div>
<a href="../guide/single.html#restfulMappings" class="guide">RESTful URLマッピングの作成</a>についてのより詳細な説明は、ユーザガイドの<a href="../guide/single.html#urlMappings" class="guide">URLマッピング</a>内にあります。



<h2 id="linkingToResources">8.1.3 RESTリソースへのリンク</h2>
<div class="hidden-block">
Grails' <code>link</code> tag offers an easy way to link to any domain class resource:
</div>
Grailsの<code>link</code>タグは、任意のドメインクラスリソースへリンクする簡単な方法を提供します:<p class="paragraph"/><div class="code"><pre>&#60;g:link resource=<span class="java&#45;quote">"$&#123;book&#125;"</span>&#62;My Link&#60;/g:link&#62;</pre></div><p class="paragraph"/>


<h2 id="versioningResources">8.1.4 RESTリソースのバージョニング</h2>
<div class="hidden-block">A common requirement with a REST API is to expose different versions of the REST API. There are a few ways this can be achieved in Grails.</div>
REST APIの一般的な要件として、REST APIの異なるバージョンの公開があります。
Grailsでこれを実現するにはいくつかの方法があります。<p class="paragraph"/><div class="hidden-block">h4. Versioning using the URI</div>
<h4>URIを使ったバージョンニング</h4><p class="paragraph"/><div class="hidden-block">A common approach is to use the URI to version APIs (although this approach is discouraged in favour of Hypermedia). For example, you can define the following URL mappings:</div>
一般的な方法は、各バージョンのAPIへのURIを使うことです(しかし、この方法よりはハイパーメディアを使った方法をお勧めします)。
例えば、以下のようにURLマッピングを定義できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books/v1"</span>(resources:<span class="java&#45;quote">"book"</span>, namespace:'v1')
<span class="java&#45;quote">"/books/v2"</span>(resources:<span class="java&#45;quote">"book"</span>, namespace:'v2')</pre></div><p class="paragraph"/><div class="hidden-block">That will match the following controllers:</div>
これは以下のコントローラに対応付きます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> myapp.v1<p class="paragraph"/>class BookController &#123;
    <span class="java&#45;keyword">static</span> namespace = 'v1'
&#125;<p class="paragraph"/><span class="java&#45;keyword">package</span> myapp.v2<p class="paragraph"/>class BookController &#123;
    <span class="java&#45;keyword">static</span> namespace = 'v2'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This approach has the disadvantage of requiring two different URI namespaces for your API.</div>
この方法は、APIに対して異なる2つのURIのネームスペースが必要となるという欠点があります。<p class="paragraph"/><div class="hidden-block">h4. Versioning with the Accept-Version header</div>
<h4>Accept-Versionヘッダを使ったバージョンニング</h4><p class="paragraph"/><div class="hidden-block">As an alternative Grails supports the passing of an <code>Accept-Version</code> header from clients. For example you can define the following URL mappings:</div>
代わりに、Grailsはクライアントからの<code>Accept-Version</code>ヘッダによる制御をサポートしています。
例えば以下のようにURLマッピングを定義できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/books"</span>(version:'1.0', resources:<span class="java&#45;quote">"book"</span>, namespace:'v1')
<span class="java&#45;quote">"/books"</span>(version:'2.0', resources:<span class="java&#45;quote">"book"</span>, namespace:'v2')</pre></div><p class="paragraph"/><div class="hidden-block">Then in the client simply pass which version you need using the <code>Accept-Version</code> header:</div>
そして、クライアントからは<code>Accept-Version</code>ヘッダを使ってバージョンを渡すだけです:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept&#45;Version: 1.0"</span> &#45;X GET http://localhost:8080/myapp/books</pre></div><p class="paragraph"/><div class="hidden-block">h4. Versioning using Hypermedia / Mime Types</div>
<h4>ハイパーメディア/MIMEタイプを使ったバージョニング</h4><p class="paragraph"/><div class="hidden-block">Another approach to versioning is to use Mime Type definitions to declare the version of your custom media types (see the section on "Hypermedia as the Engine of Application State" for more information about Hypermedia concepts). For example in <code>Config.groovy</code> you can declare a custom Mime Type for your resource that includes a version parameter (the 'v' parameter):</div>
他のバージョニング方法は、MIMEタイプ定義を使い、カスタムメディアタイプとしてバージョンを宣言する方法です(ハイパーメディアのコンセプトについての、より詳しい情報は「アプリケーション状態エンジンとしてのハイパーメディア」を参照してください)。
例えば<code>Config.groovy</code>内に、リソースに対してバージョンパラメータ('v'のパラメータ)を含んだカスタムMIMEタイプを宣言できます:<p class="paragraph"/><div class="code"><pre>grails.mime.types = &#91;
    all: '&#42;/&#42;',
    book: <span class="java&#45;quote">"application/vnd.books.org.book+json;v=1.0"</span>,
    bookv2: <span class="java&#45;quote">"application/vnd.books.org.book+json;v=2.0"</span>,
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="warning">
It is critical that place your new mime types after the 'all' Mime Type because if the Content Type of the request cannot be established then the first entry in the map is used for the response. If you have your new Mime Type at the top then Grails will always try and send back your new Mime Type if the requested Mime Type cannot be established.
</blockquote></div>
<blockquote class="warning">
'all'のMIMEタイプの後に、新たなMIMEタイプを宣言しているのには重要な意味があります。
なぜなら、リクエストのコンテンツタイプが不明な場合は、マップ内の最初のエントリがレスポンスのコンテンツタイプとして使われるためです。
もし、新たなMIMEタイプが先頭にあるとすると、リクエストのコンテンツタイプが不明な場合に、Grailsは新たなMIMEタイプを常に送り返すことになります。
</blockquote><p class="paragraph"/><div class="hidden-block">Then override the renderer (see the section on "Customizing Response Rendering" for more information on custom renderers) to send back the custom Mime Type in <code>grails-app/conf/spring/resourses.groovy</code>:</div>
次に、<code>grails-app/conf/spring/resourses.groovy</code>内でカスタムMIMEタイプを返すようにレンダリング設定(カスタムレンダリングのより詳しい情報は「レスポンスレンダリングのカスタマイズ」を参照してください)を上書きします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.renderer.json.&#42;
<span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.mime.&#42;<p class="paragraph"/>beans = &#123;
    bookRendererV1(JsonRenderer, myapp.v1.Book, <span class="java&#45;keyword">new</span> MimeType(<span class="java&#45;quote">"application/vnd.books.org.book+json"</span>, &#91;v:<span class="java&#45;quote">"1.0"</span>&#93;)) 
    bookRendererV2(JsonRenderer, myapp.v2.Book, <span class="java&#45;keyword">new</span> MimeType(<span class="java&#45;quote">"application/vnd.books.org.book+json"</span>, &#91;v:<span class="java&#45;quote">"2.0"</span>&#93;)) 
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Then using the <code>Accept</code> header you can specify which version you need using the Mime Type:</div>
これで、<code>Accept</code>ヘッダでMIMEタイプを使いバージョンを指定できます。<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept: application/vnd.books.org.book+json;v=1.0"</span> &#45;X GET http://localhost:8080/myapp/books</pre></div><p class="paragraph"/><p class="paragraph"/>


<h2 id="restfulControllers">8.1.5 RESTコントローラの実装</h2>
<div class="hidden-block">The <code>Resource</code> transformation is a quick way to get started, but typically you'll want to customize the controller logic, the rendering of the response or extend the API to include additional actions.</div>
<code>Resource</code>変換はREST APIを構築する手っ取り早い方法です。
しかし大抵の場合、レスポンスのレンダリングを変更したり、APIを拡張するなど、コントローラのロジックをカスタマイズしたくなります。



<h2 id="extendingRestfulController">8.1.5.1 RestfulControllerスーパークラスの拡張</h2>
<div class="hidden-block">The easiest way to get started doing so is to create a new controller for your resource that extends the <code>grails.rest.RestfulController</code> super class. For example:</div>
まず始めの簡単な方法は、<code>grails.rest.RestfulController</code>をスーパークラスとして、リソースに対して新たなコントローラを作成する方法です。
例えば:<p class="paragraph"/><div class="code"><pre>class BookController <span class="java&#45;keyword">extends</span> RestfulController &#123;
    <span class="java&#45;keyword">static</span> responseFormats = &#91;'json', 'xml'&#93;
    BookController() &#123;
        <span class="java&#45;keyword">super</span>(Book)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">To customize any logic you can just override the appropriate action. The following table provides the names of the action names and the URIs they map to:</div>
ロジックをカスタマイズするには、カスタマイズが必要なアクションを上書きします。
以下のテーブルは、アクションの名前と、それに対応するURIです:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>HTTP Method</th><th>URI</th><th>Controller Action</th></tr><tr class="table-odd"><td>GET</td><td>/books</td><td>index</td></tr><tr class="table-even"><td>GET</td><td>/books/create</td><td>create</td></tr><tr class="table-odd"><td>POST</td><td>/books</td><td>save</td></tr><tr class="table-even"><td>GET</td><td>/books/${id}</td><td>show</td></tr><tr class="table-odd"><td>GET</td><td>/books/${id}/edit</td><td>edit</td></tr><tr class="table-even"><td>PUT</td><td>/books/${id}</td><td>update</td></tr><tr class="table-odd"><td>DELETE</td><td>/books/${id}</td><td>delete</td></tr></table><p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Note that the <code>create</code> and <code>edit</code> actions are only needed if the controller exposes an HTML interface. 
</blockquote></div>
<blockquote class="note">
<code>create</code>と<code>edit</code>アクションは、コントローラがHTMLインタフェースを公開する場合にのみ必要です。
</blockquote><p class="paragraph"/><div class="hidden-block">As an example if you have a <a href="../guide/single.html#restfulMappings" class="guide">nested resource</a> then you would typically want to query both the parent and the child identifiers. For example given the following URL mapping:</div>
例のように<a href="../guide/single.html#restfulMappings" class="guide">ネストしたリソース</a>の場合、大抵は親と子供の識別子が必要になります。
例えば以下のようなURLマッピングの場合:<p class="paragraph"/><div class="code"><pre><span class="java&#45;quote">"/authors"</span>(resources:'author') &#123;
    <span class="java&#45;quote">"/books"</span>(resources:'book')
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You could implement the nested controller as follows:</div>
次のように、ネストに対応したコントローラを実装できます:<p class="paragraph"/><div class="code"><pre>class BookController <span class="java&#45;keyword">extends</span> RestfulController &#123;
    <span class="java&#45;keyword">static</span> responseFormats = &#91;'json', 'xml'&#93;
    BookController() &#123;
        <span class="java&#45;keyword">super</span>(Book)
    &#125;<p class="paragraph"/>    @Override
    Book queryForResource(Serializable id) &#123;
        Book.where &#123;
            id == id &#38;&#38; author.id = params.authorId
        &#125;.find()
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The example above subclasses <code>RestfulController</code> and overrides the <code>queryForResource</code> method to customize the query for the resource to take into account the parent resource.</div>
上記の例では、<code>RestfulController</code>のサブクラスで親リソースに対応するため、<code>queryForResource</code>メソッドをオーバーライドしてリソースのクエリをカスタマイズしています。<p class="paragraph"/>



<h2 id="restControllersStepByStep">8.1.5.2 RESTコントローラの実装ステップバイステップ</h2>
<div class="hidden-block">If you don't want to take advantage of the features provided by the <code>RestfulController</code> super class, then you can implement each HTTP verb yourself manually. The first step is to create a controller:</div>
もし、スーパークラスの<code>RestfulController</code>から提供される機能を使用しない場合は、それぞれHTTPメソッドに対応するアクションを自身で実装できます。
最初のステップはコントローラの作成です:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;controller book</pre></div><p class="paragraph"/><div class="hidden-block">Then add some useful imports and enable readOnly by default:</div>
そして、いくつかの便利なインポートを追加し、デフォルトで読み取り専用にします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.transaction.&#42;
<span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> org.springframework.http.HttpStatus.&#42;
<span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> org.springframework.http.HttpMethod.&#42;<p class="paragraph"/>@Transactional(readOnly = <span class="java&#45;keyword">true</span>)
class BookController &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Recall that each HTTP verb matches a particular Grails action according to the following conventions:</div>
HTTPメソッドのアクションは、以下の規約に従って、それぞれGrailsのアクションに対応付くことを思い出してください:<p class="paragraph"/>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>HTTP Method</th><th>URI</th><th>Controller Action</th></tr><tr class="table-odd"><td>GET</td><td>/books</td><td>index</td></tr><tr class="table-even"><td>GET</td><td>/books/${id}</td><td>show</td></tr><tr class="table-odd"><td>GET</td><td>/books/create</td><td>create</td></tr><tr class="table-even"><td>GET</td><td>/books/${id}/edit</td><td>edit</td></tr><tr class="table-odd"><td>POST</td><td>/books</td><td>save</td></tr><tr class="table-even"><td>PUT</td><td>/books/${id}</td><td>update</td></tr><tr class="table-odd"><td>DELETE</td><td>/books/${id}</td><td>delete</td></tr></table><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The 'create' and 'edit' actions are already required if you plan to implement an HTML interface for the REST resource. They are there in order to render appropriate HTML forms to create and edit a resource. If this is not a requirement they can be discarded.
</blockquote>
</div>
<blockquote class="note">
'create'と'edit'アクションはRESTリソースに対して、HTMLインタフェースを実装する予定がある場合は必要です。
これらはリソースの追加、編集のHTMLフォームを表示するためにあります。
これが必要ない場合は無効にできます。
</blockquote><p class="paragraph"/><div class="hidden-block">The key to implementing REST actions is the <a href="../ref/Controllers/respond.html" class="controllers">respond</a> method introduced in Grails 2.3. The <code>respond</code> method tries to produce the most appropriate response for the requested content type (JSON, XML, HTML etc.)</div>
RESTアクションの実装の鍵は、Grails 2.3で導入された<a href="../ref/Controllers/respond.html" class="controllers">respond</a>メソッドです。
<code>respond</code>メソッドは、リクエストのCotent Type(JSON、XML、XMLなど)に対して、もっとも適切なレスポンスを生成しようとします。<p class="paragraph"/><div class="hidden-block">h4. Implementing the 'index' action</div>
<h4>'index'アクションの実装</h4><p class="paragraph"/><div class="hidden-block">For example to implement the <code>index</code> action, simply call the <code>respond</code> method passing the list of objects to respond with: </div>
例えば<code>index</code>アクションを実装するには、単にオブジェクトのリストと共に<code>respond</code>メソッドを呼びます:<p class="paragraph"/><div class="code"><pre>def index(<span class="java&#45;object">Integer</span> max) &#123;
    params.max = <span class="java&#45;object">Math</span>.min(max ?: 10, 100)
    respond Book.list(params), model:&#91;bookCount: Book.count()&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that in the above example we also use the <code>model</code> argument of the <code>respond</code> method to supply the total count. This is only required if you plan to support pagination via some user interface.</div>
上記の例では、オブジェクトのリストに加えて、合計値を設定するために<code>respond</code>メソッドに<code>model</code>引数を渡しています。
これは、ユーザインタフェースでページングをサポートする場合にのみ必要です。<p class="paragraph"/><div class="hidden-block">The <code>respond</code> method will, using <a href="../guide/single.html#contentNegotiation" class="guide">Content Negotiation</a>, attempt to reply with the most appropriate response given the content type requested by the client (via the ACCEPT header or file extension).</div>
<code>respond</code>メソッドは、<a href="../guide/single.html#contentNegotiation" class="guide">コンテントネゴシエーション</a>を使って、クライントからリクエストされたコンテンツタイプから(ACCEPTヘッダまたはファイル拡張子から)、もっとも適切なレスポンスを返そうとします。<p class="paragraph"/><div class="hidden-block">If the content type is established to be HTML then a model will be produced such that the action above would be the equivalent of writing:</div>
もしコンテンツタイプがHTMLである場合は、上記のアクションは次のように書いた場合と同じような<code>model</code>を生成します:<p class="paragraph"/><div class="code"><pre>def index(<span class="java&#45;object">Integer</span> max) &#123;
    params.max = <span class="java&#45;object">Math</span>.min(max ?: 10, 100)
    &#91;bookList: Book.list(params), bookCount: Book.count()&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">By providing an <code>index.gsp</code> file you can render an appropriate view for the given model. If the content type is something other than HTML then the <code>respond</code> method will attempt to lookup an appropriate <code>grails.rest.render.Renderer</code> instance that is capable of rendering the passed object. This is done by inspecting the <code>grails.rest.render.RendererRegistry</code>.</div>
そして、<code>index.gsp</code>ファイルを提供することで、与えられた<code>model</code>に対するビューが表示できます。
もし、コンテンツタイプがHTMLではない場合、<code>respond</code>メソッドは渡されたオブジェクトをレンダリングできる適切な<code>grails.rest.render.Renderer</code>のインスタンスを探します。
これは<code>grails.rest.render.RendererRegistry</code>から検索されます。<p class="paragraph"/><div class="hidden-block">By default there are already renderers configured for JSON and XML, to find out how to register a custom renderer see the section on "Customizing Response Rendering".</div>
デフォルトではJSONとXMLのレンダラーが設定されています。
カスタムレンダラーの登録の仕方は「レスポンスレンダリングのカスタマイズ」を参照してください。<p class="paragraph"/><div class="hidden-block">h4. Implementing the 'show' action</div>
<h4>'show'アクションの実装</h4><p class="paragraph"/><div class="hidden-block">The <code>show</code> action, which is used to display and individual resource by id, can be implemented in one line of Groovy code (excluding the method signature):</div>
<code>show</code>アクションはidによって個々のリソースを表示するためのものです。
これはGroovyコード1行で実装できます(メソッドのシグネチャを除く):<p class="paragraph"/><div class="code"><pre>def show(Book book) &#123;
    respond book
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">By specifying the domain instance as a parameter to the action Grails will automatically attempt to lookup the domain instance using the <code>id</code> parameter of the request. If domain instance doesn't exist then <code>null</code> will be passed into the action. The <code>respond</code> method will return a 404 error if null is passed otherwise once again it will attempt to render an appropriate response. If the format is HTML then an appropriate model will produced. The following action is functionally equivalent to the above action:</div>
アクションパラメータとして特定のドメインインスタンスを指定すると、Grailsは自動的にリクエストの<code>id</code>パラメータからドメインインスタンスを検索しようとします。
もし、ドメインインスタンスが存在しない場合は、アクションへ<code>null</code>が渡されます。
<code>respond</code>メソッドはnullが渡された場合は404エラーを返します。
nullではない場合は、前と同じように適切なレスポンスを表示しようとします。
もし、フォーマットがHTMLの場合は適切な<code>model</code>を生成します。
以下のアクションは、上記のアクションと機能的に同じです:<p class="paragraph"/><div class="code"><pre>def show(Book book) &#123;
    <span class="java&#45;keyword">if</span>(book == <span class="java&#45;keyword">null</span>) &#123;
        render status:404
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
        <span class="java&#45;keyword">return</span> &#91;book: book&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Implementing the 'save' action</div>
<h4>'save'アクションの実装</h4><p class="paragraph"/><div class="hidden-block">The <code>save</code> action saves new resource representations. To start off with simply define a an action that accepts a resource as the first argument and mark it as <code>Transactional</code> with the <code>grails.transaction.Transactional</code> transform:</div>
<code>save</code>アクションは新たなリソースを保存します。
<code>save</code>アクションを簡単に実装するには、最初の引数にリソースをとるアクションを定義し、そのアクションに<code>grails.transaction.Transactional</code>変換を使って<code>Transactional</code>としてマークします:<p class="paragraph"/><div class="code"><pre>@Transactional
def save(Book book) &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Then the first thing to do is check whether the resource has any <a href="../guide/single.html#validation" class="guide">validation errors</a> and if so respond with the errors:</div>
そして、最初にすべきことはリソースに<a href="../guide/single.html#validation" class="guide">バリデーションエラー</a>がないかチェックすることです。
エラーがある場合は<code>errors</code>を応答します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span>(book.hasErrors()) &#123;
    respond book.errors, view:'create' 
&#125;
<span class="java&#45;keyword">else</span> &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of HTML the 'create' view will be rendered again so the user can correct the invalid input. In the case of other formats (JSON, XML etc.) the errors object itself will be rendered in the appropriate format and a status code of 422 (UNPROCESSABLE_ENTITY) returned.</div>
HTMLの場合は'create'ビューが再度表示されます。
そして、ユーザは誤った入力を修正できます。
それ以外のフォーマット(JSON、XMLなど)の場合は、エラーオブジェクト自身が適切なフォーマットで表示され、422(UNPROCESSABLE_ENTITY)のステータスコードが返されます。<p class="paragraph"/><div class="hidden-block">If there are no errors then the resource can be saved and an appropriate response sent:</div>
もし、エラーがない場合は、リソースが保存され、適切なレスポンスが返されます:<p class="paragraph"/><div class="code"><pre>book.save flush:<span class="java&#45;keyword">true</span>
    withFormat &#123;
        html &#123; 
            flash.message = message(code: '<span class="java&#45;keyword">default</span>.created.message', args: &#91;message(code: 'book.label', <span class="java&#45;keyword">default</span>: 'Book'), book.id&#93;)
            redirect book 
        &#125;
        '&#42;' &#123; render status: CREATED &#125;
    &#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of HTML a redirect is issued to the originating resource and for other formats a status code of 201 (CREATED) is returned.</div>
HTMLの場合は、オリジナルのリソースへリダイレクトされます。
そして、他のフォーマットでは201(CREATED)のステータスコードが返されます。<p class="paragraph"/><div class="hidden-block">h4. Implementing the 'update' action</div>
<h4>'update'アクションの実装</h4><p class="paragraph"/>
<div class="hidden-block">The <code>update</code> action updates an existing resource representations and is largely similar to the <code>save</code> action, first define the method signature:</div>
<code>update</code>アクションは既存のリソースを更新します。
そして、<code>update</code>アクションは<code>save</code>アクションとほとんど同じです。
はじめにメソッドのシグネチャを定義します:<p class="paragraph"/><div class="code"><pre>@Transactional
def update(Book book) &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If the resource exists then Grails will load the resource, otherwise null we passed. In the case of null, you should return a 404:</div>
もしリソースが存在する場合は、Grailsはリソースを読み込み、そうでない場合はnullを渡します。
nullの場合は、404を返すべきです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span>(book == <span class="java&#45;keyword">null</span>) &#123;
        render status: NOT_FOUND
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
        &#8230;
    &#125;</pre></div><p class="paragraph"/><div class="hidden-block">Then once again check for errors <a href="../guide/single.html#validation" class="guide">validation errors</a> and if so respond with the errors:</div>
そして、前と同じようにerrorsに対して<a href="../guide/single.html#validation" class="guide">バリデーションエラー</a>をチェックして、エラーがある場合は<code>errors</code>を応答します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span>(book.hasErrors()) &#123;
    respond book.errors, view:'edit' 
&#125;
<span class="java&#45;keyword">else</span> &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of HTML the 'edit' view will be rendered again so the user can correct the invalid input. In the case of other formats (JSON, XML etc.) the errors object itself will be rendered in the appropriate format and a status code of 422 (UNPROCESSABLE_ENTITY) returned.</div>
HTMLの場合は'edit'ビューが再度表示されます。
そして、ユーザは誤った入力を修正できます。
それ以外のフォーマット(JSON、XMLなど)の場合は、エラーオブジェクト自身が適切なフォーマットで表示され、422(UNPROCESSABLE_ENTITY)のステータスコードが返されます。<p class="paragraph"/><div class="hidden-block">If there are no errors then the resource can be saved and an appropriate response sent:</div>
もし、エラーがない場合は、リソースが保存され、適切なレスポンスが返されます:<p class="paragraph"/><div class="code"><pre>book.save flush:<span class="java&#45;keyword">true</span>
withFormat &#123;
    html &#123; 
        flash.message = message(code: '<span class="java&#45;keyword">default</span>.updated.message', args: &#91;message(code: 'book.label', <span class="java&#45;keyword">default</span>: 'Book'), book.id&#93;)
        redirect book 
    &#125;
    '&#42;' &#123; render status: OK &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of HTML a redirect is issued to the originating resource and for other formats a status code of 200 (OK) is returned.</div>
HTMLの場合は、オリジナルのリソースへリダイレクトされ、他のフォーマットでは200(OK)のステータスコードが返されます。<p class="paragraph"/><div class="hidden-block">h4. Implementing the 'delete' action</div>
<h4>'delete'アクションの実装</h4><p class="paragraph"/><div class="hidden-block">The <code>delete</code> action deletes an existing resource. The implementation is largely similar to the <code>update</code> action, expect the <code>delete()</code> method is called instead:</div>
<code>delete</code>アクションは既存のリソースを削除します。
実装は、<code>update</code>アクションとほとんど同じで<code>delete()</code>メソッドを代わりに呼びます:<p class="paragraph"/><div class="code"><pre>book.delete flush:<span class="java&#45;keyword">true</span>
withFormat &#123;
    html &#123; 
        flash.message = message(code: '<span class="java&#45;keyword">default</span>.deleted.message', args: &#91;message(code: 'Book.label', <span class="java&#45;keyword">default</span>: 'Book'), book.id&#93;)
        redirect action:<span class="java&#45;quote">"index"</span>, method:<span class="java&#45;quote">"GET"</span> 
    &#125;
    '&#42;'&#123; render status: NO_CONTENT &#125; 
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Notice that for an HTML response a redirect is issued back to the <code>index</code> action, whilst for other content types a response code 204 (NO_CONTENT) is returned.</div>
HTMLレスポンスでは<code>index</code>アクションへリダイレクトされます。
他のコンテンツタイプに対しては、レスポンスコード204(NO_CONTENT)が返されます。<p class="paragraph"/>


<h2 id="generatingRestControllers">8.1.5.3 スカッフォルドを使用してRESTコントローラを生成</h2>
<div class="hidden-block">To see some of these concepts in action and help you get going the <a href="http://grails.org/plugin/scaffolding" target="blank">Scaffolding plugin</a>, version 2.0 and above, can generate a REST ready controller for you, simply run the command:</div>
アクション内でここまで見てきたコンセプトを得るには、バージョン2.0以上の<a href="http://grails.org/plugin/scaffolding" target="blank">スカッフォルドプラグイン</a>が役に立ちます。
このプラグインは、REST機能が組み込まれたコントローラを生成できます。
これは単にコマンドを実行するだけです:<p class="paragraph"/><div class="code"><pre>$ grails generate&#45;controller &#91;Domain <span class="java&#45;object">Class</span> Name&#93;</pre></div>



<h2 id="renderers">8.1.6 レスポンスレンダリングのカスタマイズ</h2>
<div class="hidden-block">There are several ways to customize response rendering in Grails</div>
Grailsではレスポンスのレンダリングをカスタマイズする方法がいくつかあります。



<h2 id="defaultRenderers">8.1.6.1 デフォルトレンダラーのカスタマイズ</h2>
<div class="hidden-block">The default renderers for XML and JSON can be found in the <code>grails.rest.renderer.xml</code> and <code>grails.rest.renderer.json</code> packages respectively. These use the Grails converters (<code>grails.converters.XML</code> and <code>grails.converters.JSON</code>) by default for response rendering. </div>
XMLとJSONに対するデフォルトのレンダラーは、それぞれ<code>grails.rest.renderer.xml</code>、<code>grails.rest.renderer.json</code>パッケージ内にあります。
これらはレスポンスのレンダリングにGrailsのコンバータ(<code>grails.converters.XML</code>と<code>grails.converters.JSON</code>)を使います。<p class="paragraph"/><div class="hidden-block">You can easily customize response rendering using this default renderers. A common change you may want to make is to include or exclude certain properties from rendering. </div>
このデフォルトレンダラーを使って簡単にレスポンスのレンダリングをカスタマイズできます。
よく必要となる変更は、レンダリング時に特定のプロパティをインクルード、またはエクスクルードすることです。<p class="paragraph"/><div class="hidden-block">h4. Including or Excluding Properties from Rendering</div>
<h4>レンダリング時のプロパティのインクルードとエクスクルード</h4><p class="paragraph"/><div class="hidden-block">As mentioned previously, Grails maintains a registry of <code>grails.rest.render.Renderer</code> instances. There are some default configured renderers and the ability to register or override renderers for a given domain class or even for a collection of domain classes. To include a particular property from rendering you need to register a custom renderer by defining a bean in <code>grails-app/conf/spring/resources.groovy</code>:</div>
前に説明したように、Grailsは<code>grails.rest.render.Renderer</code>インスタンスをレジストリで管理しています。
デフォルトで設定されているレンダラーがいくつかありますが、与えられたドメインクラス、またはドメインクラスのコレクションに対し、レンダラーの登録や上書きが可能です。
レンダリングで特定のプロパティをインクルードするには、<code>grails-app/conf/spring/resources.groovy</code>内のビーン定義によって、カスタムレンダラーを登録する必要があります:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.renderer.xml.&#42;<p class="paragraph"/>beans = &#123;
    bookRenderer(XmlRenderer, Book) &#123;
        includes = &#91;'title'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block"><blockquote class="note">
The bean name is not important (Grails will scan the application context for all registered renderer beans), but for organizational and readability purposes it is recommended you name it something meaningful.
</blockquote></div>
<blockquote class="note">
ビーンの名前は重要ではありません(Grailsは登録されたすべてのレンダラーのビーンを見つけるために、アプリケーションコンテキストをスキャンします)。
しかし、構造と可読性の理由から、分かりやすい名前を付けておくことをお勧めします。
</blockquote><p class="paragraph"/><div class="hidden-block">To exclude a property the <code>exclude</code> property of the <code>XmlRenderer</code> class can be used:</div>
プロパティをエクスクルードするには、<code>XmlRenderer</code>クラスの<code>exclude</code>プロパティを使います:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.renderer.xml.&#42;<p class="paragraph"/>beans = &#123;
    bookRenderer(XmlRenderer, Book) &#123;
        excludes = &#91;'isbn'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Customizing the Converters</div>
<h4>コンバーターのカスタマイズ</h4><p class="paragraph"/><div class="hidden-block">As mentioned previously, the default renders use the <code>grails.converters</code> package under the covers. In other word, under the covers they essentially do the following:</div>
前に説明したように、デフォルトのレンダラーは<code>grails.converters</code>パッケージ配下のクラスを使っています。
これは、パッケージ配下のクラスを使って以下のようにした場合と本質的には同じです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.&#42;<p class="paragraph"/>&#8230;
render book as XML<p class="paragraph"/>// or render book as JSON</pre></div><p class="paragraph"/><div class="hidden-block">Why the separation between converters and renderers? Well a renderer has more flexibility to use whatever rendering technology you chose. When implementing a custom renderer you could use <a href="http://wiki.fasterxml.com/JacksonHome" target="blank">Jackson</a>, <a href="http://code.google.com/p/google-gson/" target="blank">Gson</a> or any Java library to implement the renderer. Converters on the other hand are very much tied to Grails' own marshalling implementation.</div>
なぜコンバーターとレンダラーが分かれているのでしょうか？
これは、レンダラーにおいて任意のレンダリング技術を採用できるよう、より柔軟性を持たせるためです。
これにより、カスタムレンダラーを実装する際に、<a href="http://wiki.fasterxml.com/JacksonHome" target="blank">Jackson</a>や<a href="http://code.google.com/p/google-gson/" target="blank">Gson</a>、または他のJavaライブラリをレンダラーを実装するために使用できます。



<h2 id="objectMarshallers">8.1.6.2 カスタムオブジェクトマーシャラの登録</h2>
<div class="hidden-block">Grails' Converters feature the notion of an <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/converters/marshaller/ObjectMarshaller.html" class="api">ObjectMarshaller</a>, and each type can have a registered <code>ObjectMarshaller</code>. You can register custom <code>ObjectMarshaller</code> instances to completely customize response rendering. For example you can define the following in <code>BootStrap.init</code>:</div>
Grailsのコンバーターは、<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/converters/marshaller/ObjectMarshaller.html" class="api">オブジェクトマーシャラ</a>の概念を特徴としており、それぞれの型に対して<code>ObjectMarshaller</code>を登録できます。
そして、レスポンスのレンダリングをカスタマイズするためにカスタム<code>ObjectMarshaller</code>インタンスを登録できます。
例えば、<code>BootStrap.init</code>の中で以下のように定義できます:<p class="paragraph"/><div class="code"><pre>XML.registerObjectMarshaller Book, &#123; Book book, XML xml &#45;&#62;
  xml.attribute 'id', book.id
  xml.build &#123;
    title(book.title)
  &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can customize the formatting of an indvidual value this way too. For example the <a href="http://grails.org/plugin/jodatime" target="blank">JodaTime plugin</a> does the following to support rendering of JodaTime dates in JSON output:</div>
個々の値のフォーマットをカスタマイズする場合もこの方法で可能です。
例えば、<a href="http://grails.org/plugin/jodatime" target="blank">JodaTime plugin</a>は、JSON出力でJadaTime日付のレンダリングをサポートするために次のようにしています:<p class="paragraph"/><div class="code"><pre>JSON.registerObjectMarshaller(DateTime) &#123;
    <span class="java&#45;keyword">return</span> it?.toString(<span class="java&#45;quote">"yyyy&#45;MM&#45;dd'T'HH:mm:ss'Z'"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the case of JSON it often simple to use a map to customize output:</div>
JSONの場合は、マップを使って簡単に出力をカスタマイズできます:<p class="paragraph"/><div class="code"><pre>JSON.registerObjectMarshaller(Book) &#123;
  def map= &#91;:&#93;
  map&#91;'titl'&#93; = it.title
  map&#91;'auth'&#93; = it.author
  <span class="java&#45;keyword">return</span> map 
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Registering Custom Marshallers via Spring</div>
<h4>Spring経由でカスタムマーシャラを登録する</h4><p class="paragraph"/><div class="hidden-block">Note that if you have many custom marshallers it is recommended you split the registration of these into a separate class:</div>
もし多くのカスタムマーシャラがある場合は、マーシャラの登録をそれぞれ別々のクラスへ分けることがお勧めです:<p class="paragraph"/><div class="code"><pre>class CustomMarshallerRegistrar &#123;<p class="paragraph"/>    @javax.annotation.PostConstruct
    void registerMarshallers() &#123;
        JSON.registerObjectMarshaller(DateTime) &#123;
            <span class="java&#45;keyword">return</span> it?.toString(<span class="java&#45;quote">"yyyy&#45;MM&#45;dd'T'HH:mm:ss'Z'"</span>)
        &#125;        
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Then define this class as Spring bean in <code>grails-app/conf/spring/resources.groovy</code>:</div>
そして、このクラスを<code>grails-app/conf/spring/resources.groovy</code>内でSpringビーンとして定義します:<p class="paragraph"/><div class="code"><pre>beans = &#123;
    myCustomMarshallerRegistrar(CustomMarshallerRegistrar)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>PostConstruct</code> annotation will get triggered on startup of your application.</div>
<code>PostConstruct</code>アノテーションはアプリケーション起動時に処理を起動するトリガーになります。



<h2 id="namedObjectMarshallers">8.1.6.3 オブジェクト・マーシャラの名前付き定義</h2>
<div class="hidden-block">It is also possible to register named configurations. For example:</div>
名前付きの設定で登録することもできます。例えば:<p class="paragraph"/><div class="code"><pre>XML.createNamedConfig('publicApi') &#123;
  it.registerObjectMarshaller(Book) &#123; Book book, XML xml &#45;&#62;
    // <span class="java&#45;keyword">do</span> <span class="java&#45;keyword">public</span> API
  &#125;
&#125;
XML.createNamedConfig('adminApi') &#123;
  it.registerObjectMarshaller(Book) &#123; Book book, XML xml &#45;&#62;
    // <span class="java&#45;keyword">do</span> admin API
  &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Then when you use either the <code>render</code> or <code>respond</code> methods you can wrap the call in a named configuration if necessary to customize rendering per request:</div>
そして、もしリクエストごとのレンダリングのカスタマイズが必要な場合に、<code>render</code>または<code>respond</code>メソッドのどちらかを使い、名前付き設定でそのメソッド呼び出しをラップできます。<p class="paragraph"/><div class="code"><pre>XML.use( isAdmin ? 'adminApi' : 'publicApi') &#123;
    render book as XML
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">or</div>
または<p class="paragraph"/><div class="code"><pre>XML.use( isAdmin ? 'adminApi' : 'publicApi') &#123;
    respond book 
&#125;</pre></div>



<h2 id="objectMarshallerInterface">8.1.6.4 ObjectMarshallerインターフェイスへの実装</h2>
<div class="hidden-block">For more complex marshallers it is recommended you implement the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/converters/marshaller/ObjectMarshaller.html" class="api">ObjectMarshaller</a> interface. For example given a domain class:</div>
より複雑なマーシャラに対しては、<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/converters/marshaller/ObjectMarshaller.html" class="api">ObjectMarshaller</a>インタフェースの実装がお勧めです。<p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">By default the output when using:</div>
デフォルトのマーシャラを使ったときの出力は:<p class="paragraph"/><div class="code"><pre>render book as XML</pre></div><p class="paragraph"/><div class="hidden-block">Would look like:</div>
次のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;book id=<span class="xml&#45;quote">"1"</span>&#62;</span>
   <span class="xml&#45;tag">&#60;title&#62;</span>The Stand<span class="xml&#45;tag">&#60;/title&#62;</span>
<span class="xml&#45;tag">&#60;/book&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">To write a custom marshaller you can do the following:</div>
カスタムマーシャラを記述するには以下のようにします:<p class="paragraph"/><div class="code"><pre>class BookMarshaller <span class="java&#45;keyword">implements</span> ObjectMarshaller&#60;XML&#62; &#123;<p class="paragraph"/>  <span class="java&#45;keyword">public</span> <span class="java&#45;object">boolean</span> supports(<span class="java&#45;object">Object</span> object) &#123;
    <span class="java&#45;keyword">return</span> object <span class="java&#45;keyword">instanceof</span> Book
  &#125;<p class="paragraph"/>  <span class="java&#45;keyword">public</span> void marshalObject(<span class="java&#45;object">Object</span> object, XML converter) &#123;
    Book book  = (Book)object 
    converter.chars book.title
  &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">And then register the marshaller with:</div>
そして、そのマーシャラを登録します:<p class="paragraph"/><div class="code"><pre>XML.registerObjectMarshaller(<span class="java&#45;keyword">new</span> BookMarshaller())</pre></div><p class="paragraph"/><div class="hidden-block">With the custom <code>ObjectMarshaller</code> in place, the output is now:</div>
カスタム<code>ObjectMarshaller</code>を登録すると、出力は次のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;book&#62;</span>The Stand<span class="xml&#45;tag">&#60;/book&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">h4. Customizing the Name of the Root Element</div>
<h4>ルート要素の名前をカスタマイズする</h4><p class="paragraph"/><div class="hidden-block">If you wish the customize the name of the surrounding element, you can implement <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/converters/marshaller/NameAwareMarshaller.html" class="api">NameAwareMarshaller</a>:</div>
もし、囲う要素の名前をカスタマイズしたい場合は<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/converters/marshaller/NameAwareMarshaller.html" class="api">NameAwareMarshaller</a>を実装します。<p class="paragraph"/><div class="code"><pre>class BookMarshaller <span class="java&#45;keyword">implements</span> ObjectMarshaller&#60;XML&#62;,NameAwareMarshaller &#123;<p class="paragraph"/>  ...<p class="paragraph"/>  <span class="java&#45;object">String</span> getElementName(<span class="java&#45;object">Object</span> o) &#123;
    <span class="java&#45;keyword">return</span> 'custom&#45;book'
  &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With the above change the output would now be:</div>
上記の変更によって、出力は以下のように変わります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;custom&#45;book&#62;</span>The Stand<span class="xml&#45;tag">&#60;/custom&#45;book&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">h4. Outputing Markup Using the Converters API or Builder</div>
<h4>コンバータAPIまたはビルダーを使ってマークアップを出力する</h4><p class="paragraph"/><div class="hidden-block">With the passed Converter object you can explicitly code to the Converters API to stream markup to the response:</div>
渡されたコンバータオブジェクトのコンバータAPIを通じて、レスポンスへマークアップを出力するコードをわかりやすくコーディングできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> void marshalObject(<span class="java&#45;object">Object</span> object, XML converter) &#123;
  Book book = (Book)object<p class="paragraph"/>  converter.attribute 'id', book.id.toString()
  converter.attribute 'date&#45;released', book.dateReleased.toString()<p class="paragraph"/>  converter.startNode 'title'
  converter.chars book.title
  converter.end()<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above code results in:</div>
上記コードの結果は次のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;book id=<span class="xml&#45;quote">"1"</span> date&#45;released=<span class="xml&#45;quote">"..."</span>&#62;</span>
   <span class="xml&#45;tag">&#60;title&#62;</span>The Stand<span class="xml&#45;tag">&#60;/title&#62;</span>
<span class="xml&#45;tag">&#60;/book&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">You can also use a builder notation to achieve a similar result (although the builder notation does not work for <code>CompileStatic</code>):</div>
また、ビルダー記法を使って同じような結果を得ることもできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> void marshalObject(<span class="java&#45;object">Object</span> object, XML converter) &#123;
  Book b = (Book)object<p class="paragraph"/>  converter.build &#123;
     book(id: b.id) &#123;
        title b.title
     &#125;
  &#125; 
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Using the convertAnother Method to Recursively Convert Objects</div>
<h4>再帰的にオブジェクトをコンバートするためにconvertAnotherメソッドを使う</h4><p class="paragraph"/><div class="hidden-block">To create more complex responses you can use the <code>convertAnother</code> method to convert associations and other objects:</div>
より複雑なレスポンスを生成するには、関連など他のオブジェクトをコンバートする<code>convertAnother</code>メソッドを使います:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">public</span> void marshalObject(<span class="java&#45;object">Object</span> object, XML converter) &#123;
  Book book = (Book)object<p class="paragraph"/>  converter.startNode 'title'
  converter.chars book.title
  converter.end()<p class="paragraph"/>  <span class="java&#45;keyword">if</span> (book.authors) &#123;
    converter.startNode 'authors'
    <span class="java&#45;keyword">for</span>(author in book.authors) &#123;
      converter.convertAnother author
    &#125;    
    converter.end()
  &#125;
&#125;</pre></div>



<h2 id="customRenderers">8.1.6.5 カスタムレンダラーの実装</h2>
<div class="hidden-block">If you want even more control of the rendering or prefer to use your own marshalling techniques then you can implement your own <code>Renderer</code> instance. For example below is a simple implementation that customizes the rendering of the <code>Book</code> class:</div>
もし、さらにレンダリングをコントロールしたい、または独自のマーシャリング技術を使いたいといった場合、自身の<code>Renderer</code>インスタンスを実装できます。
例えば、以下は<code>Book</code>クラスのレンダリングをカスタマイズする簡単な実装例です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> myapp
<span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.render.&#42;
<span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.mime.MimeType<p class="paragraph"/>class BookXmlRenderer <span class="java&#45;keyword">extends</span> AbstractRenderer&#60;Book&#62; &#123;
    BookXmlRenderer() &#123;
        <span class="java&#45;keyword">super</span>(Book, &#91;MimeType.XML,MimeType.TEXT_XML&#93; as MimeType&#91;&#93;)
    &#125;<p class="paragraph"/>    void render(Book object, RenderContext context) &#123;
        context.contentType = MimeType.XML.name<p class="paragraph"/>        def xml = <span class="java&#45;keyword">new</span> groovy.xml.MarkupBuilder(context.writer)
        xml.book(id: object.id, title:object.title)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>AbstractRenderer</code> super class has a constructor that takes the class that it renders and the <code>MimeType</code>(s) that are accepted (via the ACCEPT header or file extension) for the renderer.</div>
スーパークラス<code>AbstractRenderer</code>は、表示するクラスと、レンダラーが受け入れる(<code>ACCEPT</code>ヘッダまたはファイル拡張子から取得した)<code>MimeType</code>を(複数)取るコンストラクタを持っています。<p class="paragraph"/><div class="hidden-block">To configure this renderer, simply add it is a bean to <code>grails-app/conf/spring/resources.groovy</code>:</div>
このレンダラーを設定するには、<code>grails-app/conf/spring/resources.groovy</code>へビーンを単に追加します:<p class="paragraph"/><div class="code"><pre>beans = &#123;
    bookRenderer(myapp.BookXmlRenderer)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The result will be that all <code>Book</code> instances will be rendered in the following format:</div>
その結果、すべての<code>Book</code>インスタンスは以下のフォーマットで表示されます:<p class="paragraph"/><div class="code"><pre>&#60;book id=<span class="java&#45;quote">"1"</span> title=<span class="java&#45;quote">"The Stand"</span>/&#62;</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Note that if you change the rendering to a completely different format like the above, then you also need to change the binding if you plan to support POST and PUT requests. Grails will not automatically know how to bind data from a custom XML format to a domain class otherwise. See the section on "Customizing Binding of Resources" for further information.
</blockquote></div>
<blockquote class="note">
もし、POST・PUTリクエストをサポートする予定があり、上記のように完全に異なるフォーマットへレンダリングを変えたい場合は、バインディングもあわせて変更する必要があります。
Grailsは、カスタムXMLフォーマットから他のドメインクラスへ、どうのようにデータをバインドるするかを自動的に知ることはできません。
さらなる情報は「リソースバインディングのカスタマイズ」を参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Container Renderers</div>
<h4>コンテナレンダラー</h4><p class="paragraph"/><div class="hidden-block">A <code>grails.rest.render.ContainerRenderer</code> is a renderer that renders responses for containers of objects (lists, maps, collections etc.). The interface is largely the same as the <code>Renderer</code> interface except for the addition of the <code>getComponentType()</code> method, which should return the "contained" type. For example:</div>
<code>grails.rest.render.ContainerRenderer</code>は、オブジェクトのコンテナ(リスト、マップ、コレクションなど)に対してレスポンスを表示するレンダラーです。
このインタフェースは、型パラメータが付与されたコンテナの型を返す<code>getComponentType()</code>メソッドが加えられている以外は<code>Renderer</code>インタフェースとほとんど同じです。
例えば:<p class="paragraph"/><div class="code"><pre>class BookListRenderer <span class="java&#45;keyword">implements</span> ContainerRenderer&#60;List, Book&#62; &#123;
    <span class="java&#45;object">Class</span>&#60;List&#62; getTargetType() &#123; List &#125;
    <span class="java&#45;object">Class</span>&#60;Book&#62; getComponentType() &#123; Book &#125;
    MimeType&#91;&#93; getMimeTypes() &#123; &#91; MimeType.XML&#93; as MimeType&#91;&#93; &#125;
    void render(List object, RenderContext context) &#123;
        ....
    &#125;
&#125;</pre></div><p class="paragraph"/>



<h2 id="gspRenderers">8.1.6.6 GSPを使用したカスタムレンダリング</h2>
<div class="hidden-block">You can also customize rendering on a per action basis using Groovy Server Pages (GSP). For example given the <code>show</code> action mentioned previously:</div>
Groovy Server Pages(GSP)を使ってアクションごとに、レンダリングをカスタマイズすることもできます:<p class="paragraph"/><div class="code"><pre>def show(Book book) &#123;
    respond book
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You could supply a <code>show.xml.gsp</code> file to customize the rendering of the XML:</div>
そして、XMLのレンダリングをカスタマイズするための<code>show.xml.gsp</code>ファイルを用意します:<p class="paragraph"/><div class="code"><pre>&#60;%@page contentType=<span class="java&#45;quote">"application/xml"</span>%&#62;
&#60;book id=<span class="java&#45;quote">"$&#123;book.id&#125;"</span> title=<span class="java&#45;quote">"$&#123;book.title&#125;"</span>/&#62;</pre></div><p class="paragraph"/>


<h2 id="hypermedia">8.1.7 アプリケーション状態エンジンとしてのハイパーメディア</h2>
<div class="hidden-block"><a href="http://en.wikipedia.org/wiki/HATEOAS" target="blank">HATEOS</a>, an abbreviation for Hypermedia as the Engine of Application State, is a common pattern applied to REST architectures that uses hypermedia and linking to define the REST API.</div>
<a href="http://en.wikipedia.org/wiki/HATEOAS" target="blank">HATEOS</a>は、アプリケーション状態エンジンとしてのハイパーメディア(Hypermedia as the Engine of Application State)の略称で、ハイパーメディアとリンク使うRESTアーキテクチャを適用した、REST APIを定義するための共通パターンです。<p class="paragraph"/><div class="hidden-block">Hypermedia (also called Mime or Media Types) are used to describe the state of a REST resource, and links tell clients how to transition to the next state. The format of the response is typically JSON or XML, although standard formats such as <a href="http://tools.ietf.org/html/rfc4287" target="blank">Atom</a> and/or <a href="http://stateless.co/hal_specification.html" target="blank">HAL</a> are frequently used.</div>
ハイパーメディア(MIMEタイプ、またはメディアタイプとも呼ばれる)は、RESTリソースの状態を記述するために使われます。
そして、リンクはどのように次の状態へ遷移すればよいかをクライアントに伝えます。
レスポンスのフォーマットは主にJSONやXMLが使われますが、その中でも<a href="http://tools.ietf.org/html/rfc4287" target="blank">Atom</a>や<a href="http://stateless.co/hal_specification.html" target="blank">HAL</a>のような標準的なフォーマットがよく使われます。<p class="paragraph"/>


<h2 id="hal">8.1.7.1 HALサポート</h2>
<div class="hidden-block"><a href="http://stateless.co/hal_specification.html" target="blank">HAL</a> is a standard exchange format commonly used when developing REST APIs that follow HATEOAS principals. An example HAL document representing a list of orders can be seen below:</div>
<a href="http://stateless.co/hal_specification.html" target="blank">HAL</a>は、HATEOASに沿ったREST APIを開発する際の標準な交換フォーマットとして知られています。
例えば、注文の一覧をHALを使って表現すると、以下のようになります:<p class="paragraph"/><div class="code"><pre>&#123;
    <span class="java&#45;quote">"_links"</span>: &#123;
        <span class="java&#45;quote">"self"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/orders"</span> &#125;,
        <span class="java&#45;quote">"next"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/orders?page=2"</span> &#125;,
        <span class="java&#45;quote">"find"</span>: &#123;
            <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/orders&#123;?id&#125;"</span>,
            <span class="java&#45;quote">"templated"</span>: <span class="java&#45;keyword">true</span>
        &#125;,
        <span class="java&#45;quote">"admin"</span>: &#91;&#123;
            <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/admins/2"</span>,
            <span class="java&#45;quote">"title"</span>: <span class="java&#45;quote">"Fred"</span>
        &#125;, &#123;
            <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/admins/5"</span>,
            <span class="java&#45;quote">"title"</span>: <span class="java&#45;quote">"Kate"</span>
        &#125;&#93;
    &#125;,
    <span class="java&#45;quote">"currentlyProcessing"</span>: 14,
    <span class="java&#45;quote">"shippedToday"</span>: 20,
    <span class="java&#45;quote">"_embedded"</span>: &#123;
        <span class="java&#45;quote">"order"</span>: &#91;&#123;
            <span class="java&#45;quote">"_links"</span>: &#123;
                <span class="java&#45;quote">"self"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/orders/123"</span> &#125;,
                <span class="java&#45;quote">"basket"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/baskets/98712"</span> &#125;,
                <span class="java&#45;quote">"customer"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/customers/7809"</span> &#125;
            &#125;,
            <span class="java&#45;quote">"total"</span>: 30.00,
            <span class="java&#45;quote">"currency"</span>: <span class="java&#45;quote">"USD"</span>,
            <span class="java&#45;quote">"status"</span>: <span class="java&#45;quote">"shipped"</span>
        &#125;, &#123;
            <span class="java&#45;quote">"_links"</span>: &#123;
                <span class="java&#45;quote">"self"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/orders/124"</span> &#125;,
                <span class="java&#45;quote">"basket"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/baskets/97213"</span> &#125;,
                <span class="java&#45;quote">"customer"</span>: &#123; <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"/customers/12369"</span> &#125;
            &#125;,
            <span class="java&#45;quote">"total"</span>: 20.00,
            <span class="java&#45;quote">"currency"</span>: <span class="java&#45;quote">"USD"</span>,
            <span class="java&#45;quote">"status"</span>: <span class="java&#45;quote">"processing"</span>
        &#125;&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Exposing Resources Using HAL </div>
<h4>HALを使ったリソースの公開</h4><p class="paragraph"/><div class="hidden-block">To return HAL instead of regular JSON for a resource you can simply override the renderer in <code>grails-app/conf/spring/resources.groovy</code> with an instance of <code>grails.rest.render.hal.HalJsonRenderer</code> (or <code>HalXmlRenderer</code> for the XML variation):</div>
リソースに対して、いつものJSONの代わりにHALを返すには、<code>grails.rest.render.hal.HalJsonRenderer</code>(XMLの場合は<code>HalXmlRenderer</code>)のインスタンスを使い、<code>grails-app/conf/spring/resources.groovy</code>の中でレンダラーを単に上書きします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.render.hal.&#42;
beans = &#123;
    halBookRenderer(HalJsonRenderer, <span class="java&#45;keyword">rest</span>.test.Book)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With the bean in place requesting the HAL content type will return HAL:</div>
コンテンツタイプがHALのリクエストでは、このビーンがHALを返します:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept: application/hal+json"</span> http://localhost:8080/myapp/books/1<p class="paragraph"/>HTTP/1.1 200 OK
Server: Apache&#45;Coyote/1.1
Content&#45;Type: application/hal+json;charset=ISO&#45;8859&#45;1<p class="paragraph"/>&#123;
  <span class="java&#45;quote">"_links"</span>: &#123;
    <span class="java&#45;quote">"self"</span>: &#123;
      <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"http://localhost:8080/myapp/books/1"</span>,
      <span class="java&#45;quote">"hreflang"</span>: <span class="java&#45;quote">"en"</span>,
      <span class="java&#45;quote">"type"</span>: <span class="java&#45;quote">"application/hal+json"</span>
    &#125;
  &#125;,
  <span class="java&#45;quote">"title"</span>: <span class="java&#45;quote">"&#34;The Stand&#34;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">To use HAL XML format simply change the renderer:</div>
XMLフォーマットのHALを使うには単にレンダラーを変更します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.render.hal.&#42;
beans = &#123;
    halBookRenderer(HalXmlRenderer, <span class="java&#45;keyword">rest</span>.test.Book)
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Using Custom Media / Mime Types</div>
<h4>カスタムMIME(メディア)タイプの使用</h4><p class="paragraph"/><div class="hidden-block">If you wish to use a custom Mime Type then you first need to declare the Mime Types in <code>grails-app/conf/Config.groovy</code>:</div>
もし、カスタムMIMEタイプを使いたい場合は、はじめに<code>grails-app/conf/Config.groovy</code>の中でMIMEタイプを宣言する必要があります:<p class="paragraph"/><div class="code"><pre>grails.mime.types = &#91;
    all:      <span class="java&#45;quote">"&#42;/&#42;"</span>,
    book:     <span class="java&#45;quote">"application/vnd.books.org.book+json"</span>,
    bookList: <span class="java&#45;quote">"application/vnd.books.org.booklist+json"</span>,
    &#8230;
&#93;</pre></div><p class="paragraph"/><div class="hidden-block"><blockquote class="warning">
It is critical that place your new mime types after the 'all' Mime Type because if the Content Type of the request cannot be established then the first entry in the map is used for the response. If you have your new Mime Type at the top then Grails will always try and send back your new Mime Type if the requested Mime Type cannot be established.
</blockquote></div>
<blockquote class="warning">
'all'のMIMEタイプの後に、新たなMIMEタイプを宣言しているのには重要な意味があります。
なぜなら、リクエストのコンテンツタイプが不明な場合は、マップ内の最初のエントリがレスポンスのコンテンツタイプとして使われるためです。
もし、新たなMIMEタイプが先頭にあるとすると、リクエストのコンテンツタイプが不明な場合に、Grailsは新たなMIMEタイプを常に送り返すことになります。
</blockquote><p class="paragraph"/><div class="hidden-block">Then override the renderer to return HAL using the custom Mime Types:</div>
そして、カスタムMIMEタイプを使ってHALを返すためにレンダラーを上書きします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.render.hal.&#42;
<span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.mime.&#42;<p class="paragraph"/>beans = &#123;
    halBookRenderer(HalJsonRenderer, <span class="java&#45;keyword">rest</span>.test.Book, <span class="java&#45;keyword">new</span> MimeType(<span class="java&#45;quote">"application/vnd.books.org.book+json"</span>, &#91;v:<span class="java&#45;quote">"1.0"</span>&#93;))
    halBookListRenderer(HalJsonCollectionRenderer, <span class="java&#45;keyword">rest</span>.test.Book, <span class="java&#45;keyword">new</span> MimeType(<span class="java&#45;quote">"application/vnd.books.org.booklist+json"</span>, &#91;v:<span class="java&#45;quote">"1.0"</span>&#93;))
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In the above example the first bean defines a HAL renderer for a single book instance that returns a Mime Type of <code>application/vnd.books.org.book+json</code>. The second bean defines the Mime Type used to render a collection of books (in this case <code>application/vnd.books.org.booklist+json</code>).</div>
上記の例で、初めのビーンは単一のbookインスタンスに対して、<code>application/vnd.books.org.book+json</code>のMIMEタイプを返すHALのレンダラーを定義しています。
2つ目のビーンはbookのコレクションを表示するために使われるMIMEタイプを定義しています(この場合は<code>application/vnd.books.org.booklist+json</code>)。<p class="paragraph"/><div class="hidden-block">With this in place issuing a request for the new Mime Type returns the necessary HAL:</div>
この新たなMIMEタイプに対してリクエストが投げられると必要なHALを返します:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept: application/vnd.books.org.book+json"</span> http://localhost:8080/myapp/books/1<p class="paragraph"/>HTTP/1.1 200 OK
Server: Apache&#45;Coyote/1.1
Content&#45;Type: application/vnd.books.org.book+json;charset=ISO&#45;8859&#45;1<p class="paragraph"/>
&#123;
  <span class="java&#45;quote">"_links"</span>: &#123;
    <span class="java&#45;quote">"self"</span>: &#123;
      <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"http://localhost:8080/myapp/books/1"</span>,
      <span class="java&#45;quote">"hreflang"</span>: <span class="java&#45;quote">"en"</span>,
      <span class="java&#45;quote">"type"</span>: <span class="java&#45;quote">"application/vnd.books.org.book+json"</span>
    &#125;
  &#125;,
  <span class="java&#45;quote">"title"</span>: <span class="java&#45;quote">"&#34;The Stand&#34;"</span>
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Customizing Link Rendering</div>
<h4>リンクレンダリングのカスタマイズ</h4><p class="paragraph"/><div class="hidden-block">An important aspect of HATEOAS is the usage of links that describe the transitions the client can use to interact with the REST API. By default the <code>HalJsonRenderer</code> will automatically create links for you for associations and to the resource itself (using the "self" relationship).</div>
HATEOASの重要な側面は、遷移を表現したリンクの使い方です。
クライアントはREST APIでのやり取りにこれを使えます。
デフォルトで<code>HalJsonRenderer</code>は、関連と("self"関連を使って)自身のリソースへのリンクを自動的に作成します。<p class="paragraph"/><div class="hidden-block">However you can customize link rendering using the <code>link</code> method that is added to all domain classes annotated with <code>grails.rest.Resource</code> or any class annotated with <code>grails.rest.Linkdable</code>. For example, the <code>show</code> action can be modified as follows to provide a new link in the resulting output:</div>
リンクのレンダリングを、<code>grails.rest.Resource</code>が付与されたドメインクラス、または<code>grails.rest.Linkdable</code>が付与されたクラスに追加された<code>link</code>メソッドを使って、カスタマイズすることもできます。
例えば、<code>show</code>アクションで結果を出力する際に新たなリンクを追加するには、以下のように変更します:<p class="paragraph"/><div class="code"><pre>def show(Book book) &#123;
    book.link rel:'publisher', href: g.link(resource:<span class="java&#45;quote">"publisher"</span>, params:&#91;bookId: book.id&#93;)
    respond book
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Which will result in output such as: </div>
この出力結果は次のようになります:<p class="paragraph"/><div class="code"><pre>&#123;
  <span class="java&#45;quote">"_links"</span>: &#123;
    <span class="java&#45;quote">"self"</span>: &#123;
      <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"http://localhost:8080/myapp/books/1"</span>,
      <span class="java&#45;quote">"hreflang"</span>: <span class="java&#45;quote">"en"</span>,
      <span class="java&#45;quote">"type"</span>: <span class="java&#45;quote">"application/vnd.books.org.book+json"</span>
    &#125;
    <span class="java&#45;quote">"publisher"</span>: &#123;
        <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"http://localhost:8080/myapp/books/1/publisher"</span>,
        <span class="java&#45;quote">"hreflang"</span>: <span class="java&#45;quote">"en"</span>
    &#125;
  &#125;,
  <span class="java&#45;quote">"title"</span>: <span class="java&#45;quote">"&#34;The Stand&#34;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>link</code> method can be passed named arguments that match the properties of the <code>grails.rest.Link</code> class.</div>
この<code>link</code>メソッドは<code>grails.rest.Link</code>クラスのプロパティに一致する名前付き引数を渡せます。



<h2 id="atom">8.1.7.2 Atomサポート</h2>
<div class="hidden-block"><a href="http://tools.ietf.org/html/rfc4287" target="blank">Atom</a> is another standard interchange format used to implement REST APIs. An example of Atom output can be seen below:</div>
<a href="http://tools.ietf.org/html/rfc4287" target="blank">Atom</a>はREST APIを実装するために使われる、もう1つの標準的な変換フォーマットです。
Atomの出力例は次のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;?xml version=<span class="xml&#45;quote">"1.0"</span> encoding=<span class="xml&#45;quote">"utf&#45;8"</span>?&#62;</span>
<span class="xml&#45;tag">&#60;feed xmlns=<span class="xml&#45;quote">"http://www.w3.org/2005/Atom"</span>&#62;</span><p class="paragraph"/> <span class="xml&#45;tag">&#60;title&#62;</span>Example Feed<span class="xml&#45;tag">&#60;/title&#62;</span>
 <span class="xml&#45;tag">&#60;link href=<span class="xml&#45;quote">"http://example.org/"</span>/&#62;</span>
 <span class="xml&#45;tag">&#60;updated&#62;</span>2003&#45;12&#45;13T18:30:02Z<span class="xml&#45;tag">&#60;/updated&#62;</span>
 <span class="xml&#45;tag">&#60;author&#62;</span>
   <span class="xml&#45;tag">&#60;name&#62;</span>John Doe<span class="xml&#45;tag">&#60;/name&#62;</span>
 <span class="xml&#45;tag">&#60;/author&#62;</span>
 <span class="xml&#45;tag">&#60;id&#62;</span>urn:uuid:60a76c80&#45;d399&#45;11d9&#45;b93C&#45;0003939e0af6<span class="xml&#45;tag">&#60;/id&#62;</span><p class="paragraph"/> <span class="xml&#45;tag">&#60;entry&#62;</span>
   <span class="xml&#45;tag">&#60;title&#62;</span>Atom&#45;Powered Robots Run Amok<span class="xml&#45;tag">&#60;/title&#62;</span>
   <span class="xml&#45;tag">&#60;link href=<span class="xml&#45;quote">"http://example.org/2003/12/13/atom03"</span>/&#62;</span>
   <span class="xml&#45;tag">&#60;id&#62;</span>urn:uuid:1225c695&#45;cfb8&#45;4ebb&#45;aaaa&#45;80da344efa6a<span class="xml&#45;tag">&#60;/id&#62;</span>
   <span class="xml&#45;tag">&#60;updated&#62;</span>2003&#45;12&#45;13T18:30:02Z<span class="xml&#45;tag">&#60;/updated&#62;</span>
   <span class="xml&#45;tag">&#60;summary&#62;</span>Some text.<span class="xml&#45;tag">&#60;/summary&#62;</span>
 <span class="xml&#45;tag">&#60;/entry&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;/feed&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">To use Atom rendering again simply define a custom renderer:</div>
Atomのレンダリングを使うには、これまでと同じようにカスタムレンダラーを登録します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.<span class="java&#45;keyword">rest</span>.render.atom.&#42;
beans = &#123;
    halBookRenderer(AtomRenderer, <span class="java&#45;keyword">rest</span>.test.Book)
    halBookListRenderer(AtomCollectionRenderer, <span class="java&#45;keyword">rest</span>.test.Book)
&#125;</pre></div>



<h2 id="vndError">8.1.7.3 Vnd.Errorサポート</h2>
<div class="hidden-block"><a href="https://github.com/blongden/vnd.error" target="blank">Vnd.Error</a> is a standardised way of expressing an error response. </div>
<a href="https://github.com/blongden/vnd.error" target="blank">Vnd.Error</a>はエラーレスポンスの表現方法を標準化したものです。<p class="paragraph"/><div class="hidden-block">By default when a validation error occurs when attempting to POST new resources then the errors object will be sent back allow with a 422 respond code:</div>
デフォルトでは、新しいリソースをPOSTする際にバリデーションエラーが発生した場合、エラーオブジェクトが422のレスポンスコードで送り返されます:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept: text/json"</span>  &#45;H <span class="java&#45;quote">"Content&#45;Type: text/json"</span> &#45;X POST &#45;d <span class="java&#45;quote">""</span> http://localhost:8080/myapp/books<p class="paragraph"/>HTTP/1.1 422 Unprocessable Entity
Server: Apache&#45;Coyote/1.1
Content&#45;Type: text/json;charset=ISO&#45;8859&#45;1<p class="paragraph"/>&#123;<span class="java&#45;quote">"errors"</span>:&#91;&#123;<span class="java&#45;quote">"object"</span>:<span class="java&#45;quote">"<span class="java&#45;keyword">rest</span>.test.Book"</span>,<span class="java&#45;quote">"field"</span>:<span class="java&#45;quote">"title"</span>,<span class="java&#45;quote">"rejected&#45;value"</span>:<span class="java&#45;keyword">null</span>,<span class="java&#45;quote">"message"</span>:<span class="java&#45;quote">"Property &#91;title&#93; of class &#91;class <span class="java&#45;keyword">rest</span>.test.Book&#93; cannot be <span class="java&#45;keyword">null</span>"</span>&#125;&#93;&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you wish to change the format to Vnd.Error then simply register <code>grails.rest.render.errors.VndErrorJsonRenderer</code> bean in <code>grails-app/conf/spring/resources.groovy</code>:</div>
もしフォーマットをVnd.Errorへ変更したい場合は、<code>grails-app/conf/spring/resources.groovy</code>の中に<code>grails.rest.render.errors.VndErrorJsonRenderer</code>ビーンを単に登録します:<p class="paragraph"/>
<div class="code"><pre>beans = &#123;
    vndJsonErrorRenderer(grails.<span class="java&#45;keyword">rest</span>.render.errors.VndErrorJsonRenderer)
    // <span class="java&#45;keyword">for</span> Vnd.Error XML format
    vndXmlErrorRenderer(grails.<span class="java&#45;keyword">rest</span>.render.errors.VndErrorXmlRenderer)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Then if you alter the client request to accept Vnd.Error you get an appropriate response:</div>
そして、Vnd.Errorを受け入れるようにクライアントのリクエストを変更すると、次のようにレスポンスを得られます:<p class="paragraph"/><div class="code"><pre>$ curl &#45;i &#45;H <span class="java&#45;quote">"Accept: application/vnd.error+json,text/json"</span> &#45;H <span class="java&#45;quote">"Content&#45;Type: text/json"</span> &#45;X POST &#45;d <span class="java&#45;quote">""</span> http://localhost:8080/myapp/books
HTTP/1.1 200 OK
Server: Apache&#45;Coyote/1.1
Content&#45;Type: application/vnd.error+json;charset=ISO&#45;8859&#45;1<p class="paragraph"/>&#91;
    &#123;
        <span class="java&#45;quote">"logref"</span>: <span class="java&#45;quote">"&#34;book.nullable&#34;"</span>,
        <span class="java&#45;quote">"message"</span>: <span class="java&#45;quote">"Property &#91;title&#93; of class &#91;class <span class="java&#45;keyword">rest</span>.test.Book&#93; cannot be <span class="java&#45;keyword">null</span>"</span>,
        <span class="java&#45;quote">"_links"</span>: &#123;
            <span class="java&#45;quote">"resource"</span>: &#123;
                <span class="java&#45;quote">"href"</span>: <span class="java&#45;quote">"http://localhost:8080/<span class="java&#45;keyword">rest</span>&#45;test/books"</span>
            &#125;
        &#125;
    &#125;
&#93;</pre></div>



<h2 id="binding">8.1.8 リソースバインディングのカスタマイズ</h2>
<div class="hidden-block">The framework provides a sophisticated but simple mechanism for binding REST requests to domain objects and command objects.  One way to take advantage of this is to bind the <code>request</code> property in a controller the <code>properties</code> of a domain class.  Given the following XML as the body of the request, the <code>createBook</code> action will create a new <code>Book</code> and assign "The Stand" to the <code>title</code> property and "Stephen King" to the <code>authorName</code> property.</div>
フレームワークは高機能ですが、ドメインオブジェクトとコマンドオブジェクトへのRESTリクエストのバインディングに関しては、シンプルな作りになっています。
効果的なやり方の1つは、コントローラの中で<code>request</code>プロパティをドメインクラスのプロパティへバインドすることです。
リクエストのボディとして以下のようなXMLを与えた場合、<code>createBook</code>アクションは新しい<code>Book</code>を作成し、"The Stand"を<code>title</code>プロパティへ、"Stephen King"を<code>authorName</code>プロパティへ代入します。<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"UTF&#45;8"</span>?&#62;
&#60;book&#62;
    &#60;title&#62;The Stand&#60;/title&#62;
    &#60;authorName&#62;Stephen King&#60;/authorName&#62;
&#60;/book&#62;</pre></div><p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    def createBook() &#123;
        def book = <span class="java&#45;keyword">new</span> Book()
        book.properties = request<p class="paragraph"/>        // &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If the root element of the XML document contains an <code>id</code> attribute, the <code>id</code> value will be used to retrieve the corresponding persistent instance from the database and then the rest of the document will be bound to the instance.  If no corresponding record is found in the database, the command object reference will be null.</div>
もしXMLドキュメントのルート要素が<code>id</code>属性を含む場合は、その<code>id</code>値はデータベースから対応する永続化インスタンスを検索するために使われます。
そして、ドキュメントの残りはインスタンスへバインドされます。
もし、一致するレコードがデータベース内に見つからない場合は、コマンドオブジェクトの参照はnullになります。<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"UTF&#45;8"</span>?&#62;
&#60;book&#62;
    &#60;title&#62;The Stand&#60;/title&#62;
    &#60;authorName&#62;Stephen King&#60;/authorName&#62;
&#60;/book&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Command objects will automatically be bound with the body of the request:</div>
コマンドオブジェクトにはリクエストのボディが自動的にバインドされます。<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def createBook(BookCommand book) &#123;<p class="paragraph"/>        // &#8230;
    &#125;
&#125;<p class="paragraph"/>class BookCommand &#123;
    <span class="java&#45;object">String</span> title
    <span class="java&#45;object">String</span> authorName
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If the command object type is a domain class and the root element of the XML document contains an <code>id</code> attribute, the <code>id</code> value will be used to retrieve the corresponding persistent instance from the database and then the rest of the document will be bound to the instance.  If no corresponding record is found in the database, the command object reference will be null.</div>
もし、コマンドオブジェクトの型がドメインクラスで、かつXMLドキュメントのルート要素が<code>id</code>属性を含んでいる場合は、その<code>id</code>値はデータベースから対応する永続化インスタンスを検索するために使われます。
そして、ドキュメントの残りはインスタンスへバインドされます。
もし、一致するレコードがデータベース内に見つからない場合は、コマンドオブジェクトの参照はnullになります。<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"UTF&#45;8"</span>?&#62;
&#60;book id=<span class="java&#45;quote">"42"</span>&#62;
    &#60;title&#62;Walden&#60;/title&#62;
    &#60;authorName&#62;Henry David Thoreau&#60;/authorName&#62;
&#60;/book&#62;</pre></div><p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def updateBook(Book book) &#123;
        // The book will have been retrieved from the database and updated
        // by doing something like <span class="java&#45;keyword">this</span>:
        //
        // book == Book.get('42')
        // <span class="java&#45;keyword">if</span>(book != <span class="java&#45;keyword">null</span>) &#123;
        //    book.properties = request
        // &#125;
        //
        // the code above represents what the framework will
        // have done. There is no need to write that code.<p class="paragraph"/>        // ...<p class="paragraph"/>    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The data binding depends on an instance of the <a href="http://grails.org/doc/latest/api/org/grails/databinding/DataBindingSource.html" class="api">DataBindingSource</a> interface created by an
instance of the <a href="http://grails.org/doc/latest/api/org/grails/databinding/bindingsource/DataBindingSourceCreator.html" class="api">DataBindingSourceCreator</a> interface.  The specific
implementation of <code>DataBindingSourceCreator</code> will be selected based on the <code>contentType</code> of the request.  Several implementations 
are provided to handle common content types.  The default implementations will be fine for most use cases.  The following table 
lists the content types which are supported by the core framework and which <code>DataBindingSourceCreator</code> implementations are used for each.</div>
データバインディングは<a href="http://grails.org/doc/latest/api/org/grails/databinding/bindingsource/DataBindingSourceCreator.html" class="api">DataBindingSourceCreator</a>インタフェースのインスタンスによって作られる<a href="http://grails.org/doc/latest/api/org/grails/databinding/DataBindingSource.html" class="api">DataBindingSource</a>インタフェースのインスタンスに依存しています。
<code>DataBindingSourceCreator</code>の具体的な実装はリクエストの<code>contentType</code>を元に選択されます。
主要なコンテンツタイプをハンドリングするためにいくつかの実装が提供されています。
大抵の場合にこのデフォルト実装で十分なはずです。
以下のテーブルのコンテンツタイプ一覧がコアフレームワークによってサポートされており、それぞれ対応する<code>DataBindingSourceCreator</code>の実装が使われます。<p class="paragraph"/><div class="hidden-block"><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>Content Type(s)</th><th>Bean Name</th><th>DataBindingSourceCreator Impl.</th></tr><tr class="table-odd"><td>application/xml, text/xml</td><td>xmlDataBindingSourceCreator</td><td>org.codehaus.groovy.grails.web.binding.bindingsource.XmlDataBindingSourceCreator</td></tr><tr class="table-even"><td>application/json, text/json</td><td>jsonDataBindingSourceCreator</td><td>org.codehaus.groovy.grails.web.binding.bindingsource.JsonDataBindingSourceCreator</td></tr><tr class="table-odd"><td>application/hal+json</td><td>halJsonDataBindingSourceCreator</td><td>org.codehaus.groovy.grails.web.binding.bindingsource.HalJsonDataBindingSourceCreator</td></tr></table></div>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>コンテンツタイプ</th><th>ビーン名</th><th>DataBindingSourceCreator実装</th></tr><tr class="table-odd"><td>application/xml, text/xml</td><td>xmlDataBindingSourceCreator</td><td>org.codehaus.groovy.grails.web.binding.bindingsource.XmlDataBindingSourceCreator</td></tr><tr class="table-even"><td>application/json, text/json</td><td>jsonDataBindingSourceCreator</td><td>org.codehaus.groovy.grails.web.binding.bindingsource.JsonDataBindingSourceCreator</td></tr><tr class="table-odd"><td>application/hal+json</td><td>halJsonDataBindingSourceCreator</td><td>org.codehaus.groovy.grails.web.binding.bindingsource.HalJsonDataBindingSourceCreator</td></tr></table><p class="paragraph"/><div class="hidden-block">In order provide your own <code>DataBindingSourceCreator</code> for any of those content types, write a class which implements
<code>DataBindingSourceCreator</code> and register an instance of that class in the Spring application context.  If you
are replacing one of the existing helpers, use the corresponding bean name from above.  If you are providing a
helper for a content type other than those accounted for by the core framework, the bean name may be anything that
you like but you should take care not to conflict with one of the bean names above.</div>
これらのコンテンツタイプに対して、独自の<code>DataBindingSourceCreator</code>を提供するには、<code>DataBindingSourceCreator</code>の実装クラスを書き、Springのアプリケーションコンテキスト内にそのクラスのインスタンスを登録します。
既存のヘルパーを置き換える場合は、上記のビーン名に対応する名前を使います。
もし、これらコアフレームによって提供される以外のコンテンツタイプのヘルパーを提供する場合、ビーンの名前は何でも好きに設定可能ですが、上記のビーン名と競合しないように注意してください。<p class="paragraph"/><div class="hidden-block">The <code>DataBindingSourceCreator</code> interface defines just 2 methods:</div>
<code>DataBindingSourceCreator</code>インタフェースは2つのメソッドを定義しています:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> org.grails.databinding.bindingsource<p class="paragraph"/><span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.mime.MimeType
<span class="java&#45;keyword">import</span> org.grails.databinding.DataBindingSource<p class="paragraph"/>/&#42;&#42;
 &#42; A factory <span class="java&#45;keyword">for</span> DataBindingSource instances
 &#42; 
 &#42; @since 2.3
 &#42; @see DataBindingSourceRegistry
 &#42; @see DataBindingSource
 &#42;
 &#42;/
<span class="java&#45;keyword">interface</span> DataBindingSourceCreator &#123;<p class="paragraph"/>    /&#42;&#42;
     &#42; <code><span class="java&#45;keyword">return</span> All of the &#123;</code>link MimeType&#125; supported by <span class="java&#45;keyword">this</span> helper
     &#42;/
    MimeType&#91;&#93; getMimeTypes()<p class="paragraph"/>    /&#42;&#42;
     &#42; Creates a DataBindingSource suitable <span class="java&#45;keyword">for</span> binding bindingSource to bindingTarget
     &#42; 
     &#42; @param mimeType a mime type
     &#42; @param bindingTarget the target of the data binding
     &#42; @param bindingSource the value being bound
     &#42; @<span class="java&#45;keyword">return</span> a DataBindingSource
     &#42;/
    DataBindingSource createDataBindingSource(MimeType mimeType, <span class="java&#45;object">Object</span> bindingTarget, <span class="java&#45;object">Object</span> bindingSource)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><a href="http://grails.org/doc/latest/api/org/grails/databinding/bindingsource/AbstractRequestbodyDataBindingSourceCreator.html" class="api">AbstractRequestBodyDataBindingSourceCreator</a>
is an abstract class designed to be extended to simplify writing custom <code>DataBindingSourceCreator</code> classes.  Classes which
extend <code>AbstractRequestbodyDatabindingSourceCreator</code> need to implement a method named <code>createBindingSource</code>
which accepts an <code>InputStream</code> as an argument and returns a <code>DataBindingSource</code> as well as implementing the <code>getMimeTypes</code>
method described in the <code>DataBindingSourceCreator</code> interface above.  The <code>InputStream</code> argument to <code>createBindingSource</code>
provides access to the body of the request.</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/bindingsource/AbstractRequestbodyDataBindingSourceCreator.html" class="api">AbstractRequestBodyDataBindingSourceCreator</a>はこのクラスを拡張することで、簡単に独自の<code>DataBindingSourceCreator</code>クラスを書けるよう設計された抽象クラスです。
<code>AbstractRequestbodyDatabindingSourceCreator</code>を継承したクラスは、引数として<code>InputStream</code>を受け取り<code>DataBindingSource</code>を返す、<code>createBindingSource</code>という名前のメソッドを実装する必要があります。
また、上記の<code>DataBindingSourceCreator</code>インタフェース内で宣言された<code>getMimeTypes</code>メソッドの実装が必要です。
<code>createBindingSource</code>への<code>InputStream</code>の引数は、リクエストボディへのアクセスを提供します。<p class="paragraph"/><div class="hidden-block">The code below shows a simple implementation.</div>
次のコードに簡単な実装例を示します。<p class="paragraph"/>
<div class="code"><pre>// src/groovy/com/demo/myapp/databinding/MyCustomDataBindingSourceCreator.groovy
<span class="java&#45;keyword">package</span> com.demo.myapp.databinding<p class="paragraph"/><span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.mime.MimeType
<span class="java&#45;keyword">import</span> org.grails.databinding.DataBindingSource
<span class="java&#45;keyword">import</span> org.grails.databinding.SimpleMapDataBindingSource
<span class="java&#45;keyword">import</span> org.grails.databinding.bindingsource.AbstractRequestBodyDataBindingSourceCreator<p class="paragraph"/>/&#42;&#42;
 &#42; A custom DataBindingSourceCreator capable of parsing key value pairs out of
 &#42; a request body containing a comma separated list of key:value pairs like:
 &#42;
 &#42; name:Herman,age:99,town:STL
 &#42;
 &#42;/
class MyCustomDataBindingSourceCreator <span class="java&#45;keyword">extends</span> AbstractRequestBodyDataBindingSourceCreator &#123;<p class="paragraph"/>    @Override
    <span class="java&#45;keyword">public</span> MimeType&#91;&#93; getMimeTypes() &#123;
        &#91;<span class="java&#45;keyword">new</span> MimeType('text/custom+demo+csv')&#93; as MimeType&#91;&#93;
    &#125;<p class="paragraph"/>    @Override
    <span class="java&#45;keyword">protected</span> DataBindingSource createBindingSource(InputStream inputStream) &#123;
        def map = &#91;:&#93;<p class="paragraph"/>        def reader = <span class="java&#45;keyword">new</span> InputStreamReader(inputStream)<p class="paragraph"/>        // <span class="java&#45;keyword">this</span> is an obviously naive parser and is intended
        // <span class="java&#45;keyword">for</span> demonstration purposes only.<p class="paragraph"/>        reader.eachLine &#123; line &#45;&#62;
            def keyValuePairs = line.split(',')
            keyValuePairs.each &#123; keyValuePair &#45;&#62;
                <span class="java&#45;keyword">if</span>(keyValuePair?.trim()) &#123;
                    def keyValuePieces = keyValuePair.split(':')
                    def key = keyValuePieces&#91;0&#93;.trim()
                    def value = keyValuePieces&#91;1&#93;.trim()
                    map&#91;key&#93; = value
                &#125;
            &#125;
        &#125;<p class="paragraph"/>        // create and <span class="java&#45;keyword">return</span> a DataBindingSource which contains the parsed data
        <span class="java&#45;keyword">new</span> SimpleMapDataBindingSource(map)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">An instance of <code>MyCustomDataSourceCreator</code> needs to be registered in the spring application context.</div>
<code>MyCustomDataSourceCreator</code>のインスタンスはSpringのアプリケーションコンテキスト内に登録が必要です。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy
beans = &#123;<p class="paragraph"/>    myCustomCreator com.demo.myapp.databinding.MyCustomDataBindingSourceCreator<p class="paragraph"/>    // &#8230;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">With that in place the framework will use the <code>myCustomCreator</code> bean any time a <code>DataBindingSourceCreator</code> is needed
to deal with a request which has a <code>contentType</code> of "text/custom+demo+csv".</div>
上記のようにすることで、フレームワークは"text/custom+demo+csv"の<code>contentType</code>を持ったリクエストを処理する<code>DataBindingSourceCreator</code>が必要な場合に、<code>myCustomCreator</code>ビーンを使います。


<a name="8.2 SOAP"><!-- Legacy link --></a>
<h2 id="SOAP">8.2 SOAP</h2>
Grails does not feature SOAP support out-of-the-box, but there are several plugins that can help for both producing SOAP servers and calling SOAP web services.<p class="paragraph"/><h4>SOAP Clients</h4><p class="paragraph"/>To call SOAP web services there are generally 2 approaches taken, one is to use a tool to generate client stubs, the other is to manually construct the SOAP calls. The former can be easier to use, but the latter provides more flexibility / control.<p class="paragraph"/>The <a href="http://grails.org/plugin/cxf-client" target="blank">CXF client plugin</a> uses the CXF framework, which includes a <code>wsdl2java</code> tool for generating a client. There is nothing Groovy/Grails specific here in the generated code as it simply provides a Java API which you can invoke to call SOAP web services.<p class="paragraph"/>See the documentation on the <a href="https://github.com/ctoestreich/cxf-client" target="blank">CXF client plugin</a> for further information.<p class="paragraph"/>Alternatively, if you prefer more control over your SOAP calls the <a href="https://github.com/jwagenleitner/groovy-wslite" target="blank">WS-Lite library</a> is an excellent choice and features a <a href="http://grails.org/plugin/wslite" target="blank">Grails plugin</a>. You have more control over the SOAP requests sent, and since Groovy has fantastic support for building and parsing XML it can be very productive approach.<p class="paragraph"/>Below is an example of a SOAP call with wslite:<p class="paragraph"/><div class="code"><pre>withSoap(serviceURL: 'http://www.holidaywebservice.com/Holidays/US/Dates/USHolidayDates.asmx') &#123;
    def response = send &#123;
        body &#123;
            GetMothersDay(xmlns: 'http://www.27seconds.com/Holidays/US/Dates/') &#123;
                year(2011)
            &#125;
        &#125;
    &#125;
    println response.GetMothersDayResponse.GetMothersDayResult.text()
&#125;</pre></div><p class="paragraph"/>It is not recommended that you use the <a href="http://groovy.codehaus.org/GroovyWS" target="blank">GroovyWS</a> library, it pulls in many dependencies which increases the likelihood of conflicts. The WSlite library provides a far simpler and easier to use solution.<p class="paragraph"/><h4>SOAP Servers</h4><p class="paragraph"/>Again, Grails does not have direct support for exposing SOAP web services, however if you wish to expose a SOAP service from your application then the <a href="http://grails.org/plugin/cxf" target="blank">CXF plugin</a> (not to be confused with the cxf-client plugin), provides an easy way to do so.<p class="paragraph"/>Typically it involves taking a Grails service and adding 'expose'-style configuration, such as the below:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> expose = EndpointType.JAX_WS_WSDL
  //your path (preferred) or url to wsdl
  <span class="java&#45;keyword">static</span> wsdl = 'org/grails/cxf/test/soap/CustomerService.wsdl'</pre></div><p class="paragraph"/>Please refer to the <a href="https://github.com/thorstadt/grails-cxf#soap" target="blank">documentation of the plugin</a> for more information.

<a name="8.3 RSS and Atom"><!-- Legacy link --></a>
<h2 id="RSSAndAtom">8.3 RSSとAtom</h2>
<div class="hidden-block">No direct support is provided for RSS or Atom within Grails. You could construct RSS or ATOM feeds with the <a href="../ref/Controllers/render.html" class="controllers">render</a> method's XML capability. There is however a <a href="http://grails.org/plugin/feeds" target="blank">Feeds plugin</a> available for Grails that provides a RSS and Atom builder using the popular <a href="https://rome.dev.java.net/" target="blank">ROME</a> library. An example of its usage can be seen below:</div>
RSSやAtomについては、Grailsへの直接的な機能は提供されていません。<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドのXML機能を使用して、RSSやATOMのフィードを構築することができます。他に、<a href="https://rome.dev.java.net/" target="blank">ROME</a> ライブラリを使用してRSSとAtomビルダを提供した<a href="http://grails.org/plugin/feeds" target="blank">Feedsプラグイン</a> もあります。その使用例を以下に示します。<p class="paragraph"/><div class="code"><pre>def feed() &#123;
    render(feedType: <span class="java&#45;quote">"rss"</span>, feedVersion: <span class="java&#45;quote">"2.0"</span>) &#123;
        title = <span class="java&#45;quote">"My test feed"</span>
        link = <span class="java&#45;quote">"http://your.test.server/yourController/feed"</span><p class="paragraph"/>        <span class="java&#45;keyword">for</span> (article in Article.list()) &#123;
            entry(article.title) &#123;
                link = <span class="java&#45;quote">"http://your.test.server/article/&#36;&#123;article.id&#125;"</span>
                article.content // <span class="java&#45;keyword">return</span> the content
            &#125;
        &#125;
    &#125;
&#125;</pre></div>


<a name="8 Asynchronous Programming"><!-- Legacy link --></a>
<h1 id="async">9 非同期プログラミング</h1>
<div class="hidden-block">
With modern hardware featuring multiple cores, many programming languages have been adding asynchronous, parallel programming APIs, Groovy being no exception.
</div>
近年マルチコアを搭載したハードウェアの登場により、さまざまなプログラミング言語で非同期処理、並列プログラミングのAPIが追加されてきました。Groovyもまた例外ではありません。<p class="paragraph"/><div class="hidden-block">
The excellent <a href="http://gpars.codehaus.org" target="blank">GPars</a> project features a whole range of different APIs for asynchronous programming techniques including actors, promises, STM and data flow concurrency.
</div>
<a href="http://gpars.codehaus.org" target="blank">GPars</a>ではActor、Promise、STM、そしてDataflow Concurrencyといった、非同期プログラミングで必要となるさまざまなAPIを提供しています。<p class="paragraph"/><div class="hidden-block">
Added Grails 2.3, the Async features of Grails aim to simplify concurrent programming within the framework and include the concept of Promises and a unified event model.
</div>
Grails 2.3では、Promiseの概念と統一されたイベントモデルを取り入れることで、フレームワーク内での並行プログラミングを簡単にする非同期機能を追加しました。



<h2 id="promises">9.1 Promises</h2>
<div class="hidden-block">
A Promise is a concept being embraced by many concurrency frameworks. They are similar to <code>java.util.concurrent.Future</code> instances, but include a more user friendly exception handling model, useful features like chaining and the ability to attach listeners.
</div>
Promiseはさまざまな並行フレームワークで取り入れられている概念です。この概念は<code>java.util.concurrent.Future</code>によく似ていますが、より使いやすい例外ハンドリングモデルや、非同期処理の連鎖、リスナーの追加といったさまざまな便利な機能を備えています。<p class="paragraph"/><div class="hidden-block">
<h3>Promise Basics</h3>
</div>
<h3>Promiseの基本</h3><p class="paragraph"/><div class="hidden-block">
In Grails the <code>grails.async.Promises</code> class provides the entry point to the Promise API:
</div>
GrailsではPromise APIの入り口として<code>grails.async.Promises</code>クラスを提供しています。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;</pre></div><p class="paragraph"/><div class="hidden-block">
To create promises you can use the <code>task</code> method, which returns an instance of the <code>grails.async.Promise</code> interface:
</div>
promiseを作成するには<code>task</code>メソッドを使用します。これは<code>grails.async.Promise</code>インタフェースのインタンスを返します。<p class="paragraph"/><div class="code"><pre>def p1 = task &#123; 2 &#42; 2 &#125;
def p2 = task &#123; 4 &#42; 4 &#125;
def p3 = task &#123; 8 &#42; 8 &#125;
assert &#91;4,16,64&#93; == waitAll(p1, p2, p3)</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>waitAll</code> method waits synchronously, blocking the current thread, for all of the concurrent tasks to complete and returns the results.
</div>
<code>waitAll</code>メソッドは現在のスレッドをブロックした状態で処理を待ち合わせ、すべての並行タスクが完了した時点で結果を返します。<p class="paragraph"/><div class="hidden-block">
If you prefer not to block the current thread you can use the <code>onComplete</code> method:
</div>
もし現在のスレッドをブロックしたくない場合は<code>onComplete</code>メソッドを使用します。<p class="paragraph"/><div class="code"><pre>onComplete(&#91;p1,p2,p3&#93;) &#123; List results &#45;&#62;
   assert &#91;4,16,64&#93; == results
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>waitAll</code> method will throw an exception if an error occurs executing one of the promises. The originating exception will be thrown. The <code>onComplete</code> method, however, will simply not execute the passed closure if an exception occurs. You can register an <code>onError</code> listener if you wish to handle exceptions without blocking:
</div>
<code>waitAll</code>メソッドはpromiseのいずれかでエラーが発生した場合に例外をスローします。これは発信元の例外がスローされます。<code>onComplete</code>メソッドを使用した場合は、単にクロージャが実行されないだけです。もしブロッキングせずに例外を処理したい場合は<code>onError</code>メソッドを使用してリスナーを登録できます。<p class="paragraph"/><div class="code"><pre>onError(&#91;p1,p2,p3&#93;) &#123; Throwable t &#45;&#62;
   println <span class="java&#45;quote">"An error occured $&#123;t.message&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If you have just a single long running promise then the <code>grails.async.Promise</code> interface provides a similar API on the promise itself. For example:
</div>
もし単一で処理に長い時間が必要となるpromiseがある場合は、<code>grails.async.Promise</code>インターフェース自身で同様のAPIを提供しています。例えば以下のように使用します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> java.util.concurrent.TimeUnit.&#42;
<span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;<p class="paragraph"/>Promise p = task &#123;
	// <span class="java&#45;object">Long</span> running task
&#125;
p.onError &#123; Throwable err &#45;&#62;
	println <span class="java&#45;quote">"An error occured $&#123;err.message&#125;"</span>
&#125;
p.onComplete &#123; result &#45;&#62;
    println <span class="java&#45;quote">"Promise returned $result"</span>
&#125;
// block until result is called
def result = p.get()
// block <span class="java&#45;keyword">for</span> the specified time
def result = p.get(1,MINUTES)</pre></div><p class="paragraph"/><div class="hidden-block">
<h3>Promise Chaining</h3>
</div>
<h3>Promiseのチェーン</h3><p class="paragraph"/><div class="hidden-block">
It is possible to chain several promises and wait for the chain to complete using the <code>then</code> method:
</div>
<code>then</code>メソッドを使用してpromiseをチェーンすることで、チェーンの完了を待ち合わせることができます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">final</span> polish = &#123; &#8230; &#125;
<span class="java&#45;keyword">final</span> transform = &#123; &#8230; &#125;
<span class="java&#45;keyword">final</span> save = &#123; &#8230; &#125;
<span class="java&#45;keyword">final</span> notify = &#123; &#8230; &#125;<p class="paragraph"/>Promise promise = task &#123;
    // <span class="java&#45;object">long</span> running task
&#125;
promise.then polish then transform then save then &#123;
	// notify end result
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If an exception occurs at any point in the chain it will be propagated back to the caller and the next step in the chain will not be called.
</div>
もし途中のチェーンで例外が発生した場合は、呼び出し元に例外がスローされ、次のチェーンが呼ばれることはありません。<p class="paragraph"/><div class="hidden-block">
<h3>Promise Lists and Maps</h3>
</div>
<h3>Promiseのリストとマップ</h3><p class="paragraph"/><div class="hidden-block">
Grails' async API also features the concept of a promise lists and maps. These are represented by the <code>grails.async.PromiseList</code> and <code>grails.async.PromiseMap</code> classes respectively.
</div>
Grailsの非同期APIはpromiseのリストとマップの概念を備えています。これらはぞれぞれ<code>grails.async.PromiseList</code>、<code>grails.async.PromiseMap</code>のクラスとして実装されています。<p class="paragraph"/><div class="hidden-block">
The easiest way to create a promise list or map is via the <code>tasks</code> method of the <code>Promises</code> class:
</div>
promiseのリストやマップを作成する簡単な方法は、<code>Promises</code>クラスの<code>tasks</code>メソッドを使用することです。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;<p class="paragraph"/>def promiseList = tasks &#123; 2 &#42; 2 &#125;, &#123; 4 &#42; 4&#125;, &#123; 8 &#42; 8 &#125;<p class="paragraph"/>assert &#91;4,16,64&#93; == promiseList.get()</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>tasks</code> method, when passed a list of closures, returns a <code>PromiseList</code>. You can also construct a <code>PromiseList</code> manually:
</div>
<code>tasks</code>メソッドはクロージャのリストを引数に取り<code>PromiseList</code>を返します。または手動で<code>PromiseList</code>を構築することもできます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.async.&#42;<p class="paragraph"/>def list = <span class="java&#45;keyword">new</span> PromiseList()
list &#60;&#60; &#123; 2 &#42; 2 &#125;
list &#60;&#60; &#123; 4 &#42; 4 &#125;
list &#60;&#60; &#123; 8 &#42; 8 &#125;
list.onComplete &#123; List results &#45;&#62;
  assert &#91;4,16,64&#93; == results
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The <code>PromiseList</code> class does not implement the java.util.List interface, but instead returns a java.util.List from the get() method 
</blockquote>
</div>
<blockquote class="note">
<code>PromiseList</code>クラスはjava.util.Listのインタフェースを実装していません。代わりにget()メソッドを使用することでjava.util.Listとして取得できます。
</blockquote><p class="paragraph"/><div class="hidden-block">
Working with <code>PromiseMap</code> instances is largely similar. Again you can either use the <code>tasks</code> method:
</div>
<code>PromiseMap</code>を扱う場合もほとんど同じです。<code>tasks</code>メソッドを使用する場合は以下のようにします。<p class="paragraph"/>
<div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;<p class="paragraph"/>def promiseList = tasks one:&#123; 2 &#42; 2 &#125;, 
                        two:&#123; 4 &#42; 4&#125;, 
                        three:&#123; 8 &#42; 8 &#125;<p class="paragraph"/>assert &#91;one:4,two:16,three:64&#93; == promiseList.get()</pre></div><p class="paragraph"/><div class="hidden-block">
Or construct a <code>PromiseMap</code> manually:
</div>
手動で<code>PromiseMap</code>を使用して構築する場合は以下のようにします。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.async.&#42;<p class="paragraph"/>def list = <span class="java&#45;keyword">new</span> PromiseMap()
map&#91;'one'&#93; = &#123; 2 &#42; 2 &#125;
map&#91;'two'&#93; = &#123; 4 &#42; 4 &#125;
map&#91;'three'&#93; = &#123; 8 &#42; 8 &#125;
map.onComplete &#123; Map results &#45;&#62;
  assert &#91;one:4,two:16,three:64&#93; == results
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h3>Promise Factories</h3>
</div>
<h3>Promiseファクトリ</h3><p class="paragraph"/><div class="hidden-block">
The <code>Promises</code> class uses a <code>grails.async.PromiseFactory</code> instance to create <code>Promise</code> instances.
</div>
<code>Promises</code>クラスは<code>Promise</code>インスタンスを生成するために<code>grails.async.PromiseFactory</code>インスタンスを使用しています。<p class="paragraph"/><div class="hidden-block">
The default implementation uses the GPars concurrency library and is called <code>org.grails.async.factory.gpars.GparsPromiseFactory</code>, however it is possible to swap implementations by setting the <code>Promises.promiseFactory</code> variable.
</div>
デフォルトの実装ではGParsの並行ライブリである<code>org.grails.async.factory.gpars.GparsPromiseFactory</code>が使用されていますが、<code>Promises.promiseFactory</code>の値を変更することで実装を差し替えることができます。<p class="paragraph"/><div class="hidden-block">
One common use case for this is unit testing, typically you do not want promises to execute asynchronously during unit tests, as this makes tests harder to write. For this purpose Grails ships with a <code>org.grails.async.factory.SynchronousPromiseFactory</code> instance that makes it easier to test promises:
</div>
よくある使用例はユニットテストです。たいていの場合にpromiseを非同期に実行して、ユニットテストを行うことは非常に困難になります。Grailsでは、このような目的のために<code>org.grails.async.factory.SynchronousPromiseFactory</code>を提供しており、これを使用することで簡単にpromiseのテストが行えます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.async.factory.&#42;
<span class="java&#45;keyword">import</span> grails.async.&#42;<p class="paragraph"/>Promises.promiseFactory = <span class="java&#45;keyword">new</span> SynchronousPromiseFactory()</pre></div><p class="paragraph"/><div class="hidden-block">
Using the <code>PromiseFactory</code> mechanism is theoritically possible to plug in other concurrency libraries into the Grails framework.
</div>
また、<code>PromiseFactory</code>の仕組みを使用することで、Grailsに他の並行ライブラリを組み込みということも論理的には可能です。<p class="paragraph"/><div class="hidden-block">
<h3>DelegateAsync Transformation</h3>
</div>
<h3>DelegateAsync変換</h3><p class="paragraph"/><div class="hidden-block">
It is quite common to require both synchronous and asynchronous versions of the same API. Developing both can result in a maintenance problem as typically the asynchronous API would simply delegate to the synchronous version.
</div>
同じAPIにおいて、同期API/非同期APIの両方が必要となることがよくあります。このような場合に、非同期APIは単に同期APIに処理を委譲させるといった方法では、保守上問題を引き起こすことがあります。<p class="paragraph"/><div class="hidden-block">
The <code>DelegateAsync</code> transformation is designed to mitigate this problem by transforming any synchronous API into an asynchronous one.
</div>
<code>DelegateAsync</code>変換は、同期APIを非同期APIに変換することで、この問題を軽減できるように設計しています。<p class="paragraph"/><div class="hidden-block">
For example, consider the following service:
</div>
例えば次のようなサービスについて考えてみます。<p class="paragraph"/><div class="code"><pre>class BookService &#123;	
    List&#60;Book&#62; findBooks(<span class="java&#45;object">String</span> title) &#123;
      // implementation
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>findBooks</code> method executes synchronously in the same thread as the caller. To make an asynchronous version of this API you can define another class as follows:
</div>
<code>findBooks</code>メソッドは呼び出し元と同じスレッドで同期的に実行されます。ここで次のような別クラスを定義することで、このAPIの非同期バージョンを作成できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.async.&#42;<p class="paragraph"/>class AsyncBookService &#123;
   @DelegateAsync BookService bookService	
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>DelegateAsync</code> transformation will automatically add a new method that looks like the following to the <code>AsyncBookService</code> class:
</div>
<code>DelegateAsync</code>変換は、自動的に<code>AsyncBookService</code>クラスに次のようなメソッドを追加します。<p class="paragraph"/><div class="code"><pre>Promise&#60;List&#60;Book&#62;&#62; findBooks(<span class="java&#45;object">String</span> title) &#123;
    Promises.task &#123;
       bookService.findBooks(title)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
As you see the transform adds equivalent methods that return a Promise and execute asynchronously.
</div>
上記のように<code>DelegateAsync</code>変換は非同期に処理を行い、Promiseを返すメソッドを追加します。<p class="paragraph"/><div class="hidden-block">
The <code>AsyncBookService</code> can then be injected into other controllers and services and used as follows:
</div>
この<code>AsyncBookService</code>は、他のコントローラやサービスに注入され、次のように使用できます。<p class="paragraph"/><div class="code"><pre>AsyncBookService asyncBookService
def findBooks(<span class="java&#45;object">String</span> title) &#123;
    asyncBookService.findBooks(title)
       .onComplete &#123; List results &#45;&#62;
          println <span class="java&#45;quote">"Books = $&#123;results&#125;"</span>				
       &#125;
&#125;</pre></div>



<h2 id="asyncGorm">9.2 非同期GORM</h2>
<div class="hidden-block">
Since Grails 2.3, GORM features an asynchronous programming model that works across all supported datastores (Hibernate, MongoDB etc.).
</div>
Grails 2.3から、GORMでサポートされているすべてのデータストア(Hibernate、MongoDBなど)に対して、横断的に動作する非同期プログラミングモデルを提供しています。<p class="paragraph"/><div class="hidden-block">
<h3>Async Namespace</h3>
</div>
<h3>Asyncネームスペース</h3><p class="paragraph"/><div class="hidden-block">
The Asynchronous GORM API is available on every domain class via the <code>async</code> namespace.
</div>
非同期GROM APIは、すべてのドメインクラスに対し<code>async</code>ネームスペースを通じて提供されます。<p class="paragraph"/><div class="hidden-block">
For example, the following code listing reads 3 objects from the database asynchronously:
</div>
例えば次のコードはデータベースから非同期に3つのオブジェクトを読み込みます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;<p class="paragraph"/>def p1 = Person.async.get(1L)
def p2 = Person.async.get(2L)
def p3 = Person.async.get(3L)
def results = waitAll(p1, p2, p3)</pre></div><p class="paragraph"/><div class="hidden-block">
Using the <code>async</code> namespace, all the regular GORM methods are available (even dynamic finders), but instead of executing synchronously, the query is run in the background and a <code>Promise</code> instance is returned.
</div>
<code>async</code>ネームスペースでは、通常使用可能なすべてのGORMメソッドが使用できます(ダイナミックファインダーのような)。ただし同期的に実行されるのではなく、バックグラウンドでクエリーが実行され、<code>Promise</code>インスタンスを返します。<p class="paragraph"/><div class="hidden-block">
The following code listing shows a few common examples of GORM queries executed asynchronously:
</div>
次のコードは、GORMのクエリーを非同期に実行します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;<p class="paragraph"/>Person.async.list().onComplete &#123; List results &#45;&#62;
  println <span class="java&#45;quote">"Got people = $&#123;results&#125;"</span>
&#125;
def p = Person.async.getAll(1L, 2L, 3L)
List results = p.get()<p class="paragraph"/>def p1 = Person.async.findByFirstName(<span class="java&#45;quote">"Homer"</span>)
def p2 = Person.async.findByFirstName(<span class="java&#45;quote">"Bart"</span>)
def p3 = Person.async.findByFirstName(<span class="java&#45;quote">"Barney"</span>)
results = waitAll(p1, p2, p3)</pre></div><p class="paragraph"/><div class="hidden-block">
<h3>Async and the Session</h3>
</div>
<h3>非同期とセッション</h3><p class="paragraph"/><div class="hidden-block">
When using GORM async each promise is executed in a different thread. Since the Hibernate session is not concurrency safe, a new session is bound per thread.
</div>
GORMを非同期に使用する場合、promiseはそれぞれ別々のスレッドで実行されます。またHibernateのセッションはスレッドセーフではないため、スレッドごとに新しいセッションをバインドします。<p class="paragraph"/><div class="hidden-block">
This is an important consideration when using GORM async (particularly with Hibernate as the persistence engine). The objects returned from asynchronous queries will be detached entities.
</div>
非同期にGORMを使用する場合は、この点に十分考慮する必要があります(特に永続化エンジンにHibernateを使用する場合)。特に非同期クエリから返されるオブジェクトは、デタッチされたエンティティであることに注意をしてください。<p class="paragraph"/><div class="hidden-block">
This means you cannot save objects returned from asynchronous queries without first merging them back into session. For example the following will not work:
</div>
これは非同期クエリから返されたオブジェクトは、初めに起動したセッションにはマージされず、保存できないことを意味しています。例えば次のようなコードは正しく動作しません。<p class="paragraph"/><div class="code"><pre>def promise = Person.async.findByFirstName(<span class="java&#45;quote">"Homer"</span>)
def person = promise.get()
person.firstName = <span class="java&#45;quote">"Bart"</span>
person.save()</pre></div><p class="paragraph"/><div class="hidden-block">
Instead you need to merge the object with the session bound to the calling thread. The above code needs to be written as:
</div>
正しく動作させるには、呼び出し元のスレッドにバインドされているセッションにオブジェクトをマージする必要があります。<p class="paragraph"/><div class="code"><pre>def promise = Person.async.findByFirstName(<span class="java&#45;quote">"Homer"</span>)
def person = promise.get()
person.merge()
person.firstName = <span class="java&#45;quote">"Bart"</span></pre></div><p class="paragraph"/><div class="hidden-block">
Note that <code>merge()</code> is called first because it may refresh the object from the cache or database, which would result in the change being lost. In general it is not recommended to read and write objects in different threads and you should avoid this technique unless absolutely necessary.
</div>
まず始めに<code>merge()</code>を呼びだしています。これはキャッシュまたはデータベースのデータが再読み込みされ、それまでに行った変更が失われてしまうためです。また一般的に異なるスレッド間でオブジェクトを読み書きすることは推奨されません。もし必要がない限り、この方法は絶対に避けるべきです。<p class="paragraph"/><div class="hidden-block">
Finally, another issue with detached objects is that association lazy loading <strong class="bold">will not</strong> work and you will encounter <code>LazyInitializationException</code> errors if you do so. If you plan to access the associated objects of those returned from asynchronous queries you should use eager queries (which is recommended anyway to avoid N+1 problems).
</div>
最後に、デタッチされたオブジェクトの別の問題として、関連をlazyローディングしようとすると<code>LazyInitializationException</code>を引き起こすという問題があります。もし非同期クエリから取得したオブジェクトの関連にアクセスする場合は、eagerクエリとして実行してください(N+1問題を避けるために、強くお勧めします)。<p class="paragraph"/><div class="hidden-block">
<h3>Multiple Asynchronous GORM calls</h3>
</div>
<h3>複数の非同期GORMの呼び出し</h3><p class="paragraph"/><div class="hidden-block">
As discussed in the previous section you should avoid reading and writing objects in different threads as merging tends to be inefficient.
</div>
上記で説明したように、マージは問題を引き起こす可能性が高いため、異なるスレッド間でのオブジェクトの読み書きは避けるべきです。<p class="paragraph"/><div class="hidden-block">
However, if you wish to do more complex GORM work asynchronously then the GORM async namespace provides a <code>task</code> method that makes this possible. For example:
</div>
しかし、GROMのasyncネームスペースが提供している<code>task</code>メソッドを使用することで、より複雑なGORMの非同期処理が可能になります。例えば以下のように使用します。<p class="paragraph"/><div class="code"><pre>def promise = Person.async.task &#123;
    withTransaction &#123;
       def person = findByFirstName(<span class="java&#45;quote">"Homer"</span>)
       person.firstName = <span class="java&#45;quote">"Bart"</span>
       person.save(flush:<span class="java&#45;keyword">true</span>)    
    &#125;
&#125;<p class="paragraph"/>Person updatedPerson = promise.get()</pre></div><p class="paragraph"/><div class="hidden-block">
Note that the GORM <code>task</code> method differs from the static <code>Promises.task</code> method in that it deals with binding a new session to the asynchronous thread for you. If you do not use the GORM version and do asynchronous work with GORM then you need to do this manually. Example:
</div>
GORMの<code>task</code>メソッドは静的な<code>Promises.task</code>メソッドとは異なり、非同期処理のスレッドに対して自動的に新いセッションをバインドします。もしGROMの<code>task</code>メソッドを使用せず非同期にGORMの処理を行う場合は、これを手動で行う必要があります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;<p class="paragraph"/>def promise = task &#123;
    Person.withNewSession &#123;
    	// your logic here
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h3>Async DetachedCriteria</h3>
</div>
<h3>非同期DetachedCriteria</h3><p class="paragraph"/><div class="hidden-block">
The <code>DetachedCriteria</code> class also supports the <code>async</code> namespace. For example you can do the following:
</div>
DetachedCriteriaクラスも<code>async</code>ネームスペースをサポートしています。例えば次のように使用できます。<p class="paragraph"/><div class="code"><pre>DetachedCriteria query = Person.where &#123;
    lastName == <span class="java&#45;quote">"Simpson"</span>
&#125;<p class="paragraph"/>def promise = query.async.list()</pre></div><p class="paragraph"/><p class="paragraph"/>


<h2 id="asyncRequests">9.3 非同期リクエストハンドリング</h2>
<div class="hidden-block">
If you are deploying to a Servlet 3.0 container such as Tomcat 7 and above then it is possible to deal with responses asynchronously.
</div>
もしアプリケーションをTomcat 7のようなServlet 3.0対応のコンテナにデプロイしている場合は、非同期にレスポンスを返すことが可能です。<p class="paragraph"/><div class="hidden-block">
In general for controller actions that execute quickly there is little benefit in handling requests asynchronously. However, for long running controller actions it is extremely beneficial.
</div>
一般的にコントローラのアクションがすぐに完了するような場合は、非同期にリクエストを処理してもほとんど効果はありません。しかし、アクションに長い時間がかかる場合は、非常に効果があります。<p class="paragraph"/><div class="hidden-block">
The reason being that with an asynchronous / non-blocking response, the one thread == one request == one response relationship is broken. The container can keep a client response open and active, and at the same time return the thread back to the container to deal with another request, improving scalability.
</div>
非同期/ノンブロッキングのレスポンスでは、1スレッド == 1リクエスト == 1レンスポンスの関係が成りたたなくなります。これはクライアントとの接続を保ちつつ、他のリクエストを処理するためにスレッドをコンテナに返すことで、スケーラビリティを向上させるためです。<p class="paragraph"/><div class="hidden-block">
For example, if you have 70 available container threads and an action takes a minute to complete, if the actions are not executed in a non-blocking fashion the likelihood of all 70 threads being occupied and the container not being able to respond is quite high and you should consider asynchronous request processing.
</div>
例えば、もしコンテナが70のスレッドを使用可能で、アクションを処理するのに1分かかるとします。もしこのアクションをノンブロッキングで実行しない場合は、70のスレッドすべてを占有し、レスポンスを返せない状態になる可能性が非常に高くなります。このような場合は、非同期にリクエストを処理することを考える必要があります。<p class="paragraph"/><div class="hidden-block">
Since Grails 2.3, Grails features a simplified API for creating asynchronous responses built on the <code>Promise</code> mechism discussed previously.
</div>
Grails 2.3からは、これまでに説明してきた<code>Promise</code>の仕組みを使い、簡単に非同期レスポンスが作成できるAPIを提供しています。<p class="paragraph"/><div class="hidden-block">
The implementation is based on Servlet 3.0 async so to enable the async features you need to set your servlet target version to 3.0 in BuildConfig.groovy: 
</div>
実装はServlet 3.0の非同期処理をベースにしており、この非同期機能を有効にするにはBuildConfig.groovyでサーブレットの対象バージョンを3.0に設定する必要があります。<p class="paragraph"/><div class="code"><pre>grails.servlet.version = <span class="java&#45;quote">"3.0"</span></pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Async Models</h4>
</div>
<h4>非同期モデル</h4><p class="paragraph"/><div class="hidden-block">
A typical activity in a Grails controller is to produce a model (a map of key/value pairs) that can be rendered by a view.
</div>
Grailsのコントローラにおける役割の一つは、ビューに表示するモデル(キーと値のマップ)を生成することです。<p class="paragraph"/><div class="hidden-block">
If the model takes a while to produce then the server could arrive at a blocking state, impacting scalability. You tell Grails to build the model asynchronously by returning a <code>grails.async.PromiseMap</code> via the <code>Promises.tasks</code> method:
</div>
もしこのモデルの生成に時間がかかる場合は、サーバが他のリクエスト処理をブロックする状態となり、スケーラビリティに影響を与えます。このような場合は、<code>Promises.tasks</code>メソッドを使用し<code>grails.async.PromiseMap</code>を返すことで非同期にモデルを生成できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;
&#8230;
def index() &#123;
   tasks books: Book.async.list(),
         totalBooks: Book.async.count(),
         otherValue: &#123;
           // <span class="java&#45;keyword">do</span> hard work
         &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Grails will handle the response asynchronously, waiting for the promises to complete before rendering the view. The equivalent synchronous action of the above is:
</div>
Grailsはビューをレンダリングする前にpromiseの処理を待ち合わせることで、非同期にレスポンスを処理します。もし、これを同期的に処理した場合は以下のようになります。<p class="paragraph"/><div class="code"><pre>def index() &#123;
    def otherValue = &#8230;
	&#91; books: Book.list() , 
	  totalBooks: Book.count(),
	  otherValue: otherValue  &#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can even render different view by passing the <code>PromiseMap</code> to the <code>model</code> attribute of the <code>render</code> method:
</div>
また異なるビューを使用してリンダリングを行いたい場合は、<code>render</code>メソッドの<code>model</code>属性に<code>PromiseMap</code>を設定します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;
&#8230;
def index() &#123;
   render view:<span class="java&#45;quote">"myView"</span>, model: tasks( one:&#123; 2 &#42; 2 &#125;,
                                       two:&#123; 3 &#42; 3 &#125; )
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Async Response Rendering</h4>
</div>
<h4>非同期レスポンスのレンダリング</h4><p class="paragraph"/><div class="hidden-block">
You can also write to the response asynchronously using promises in Grails 2.3 and above:
</div>
Grails 2.3ではpromiseを使用して、非同期にレスポンスを書くこともできます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> <span class="java&#45;keyword">static</span> grails.async.Promises.&#42;
class StockController &#123;<p class="paragraph"/>    def stock(<span class="java&#45;object">String</span> ticker) &#123;
       task &#123;
           ticker = ticker ?: 'GOOG'
           def url = <span class="java&#45;keyword">new</span> URL(<span class="java&#45;quote">"http://download.finance.yahoo.com/d/quotes.csv?s=$&#123;ticker&#125;&#38;f=nsl1op&#38;e=.csv"</span>)
           <span class="java&#45;object">Double</span> price = url.text.split(',')&#91;&#45;1&#93; as <span class="java&#45;object">Double</span>
           render <span class="java&#45;quote">"ticker: $ticker, price: $price"</span>
       &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The above example using Yahoo Finance to query stock prices, executing asynchronously and only rendering the response once the result has been obtained. This is done by returning a <code>Promise</code> instance from the controller action.
</div>
上記の例では、株価を参照するためにYahoo Financeを使用して、非同期に処理を実行しつつ結果が得られた時点でレスポンスをレンダリングしています。このように動作させるには、コントローラのアクションから<code>Promise</code>インスタンスを返します。<p class="paragraph"/><div class="hidden-block">
If the Yahoo URL is unresponsive the original request thread will not be blocked and the container will not become unresponsive.
</div>
このようにすることで、YahooのURLがレスポンスを返さない場合にも、元のスレッドがブロッキングされず、またコンテナが応答しないということもなく処理できます。



<h2 id="grailsEvents">9.4 GrailsイベントAPI</h2>
TODO: Coming in Grails 2.3 M2


<h2 id="asyncServletApi">9.5 Servlet 3.0 Async</h2>
<div class="hidden-block">
In addition to the higher level async features discussed earlier in the section, you can access the raw Servlet 3.0 asynchronous API from a Grails application.
</div>
これまでに説明してきた、より高レベルな非同期機能に加えて、GrailsのアプリケーションからServlet 3.0の非同期APIに直接アクセスすることもできます。<p class="paragraph"/><div class="hidden-block">
<h4>Servlet 3.0 Asynchronous Rendering</h4>
</div>
<h4>Servlet 3.0の非同期レンダリング</h4><p class="paragraph"/><div class="hidden-block">
You can render content (templates, binary data etc.) in an asynchronous manner by calling the <code>startAsync</code> method which returns an instance of the Servlet 3.0 <code>AsyncContext</code>. Once you have a reference to the <code>AsyncContext</code> you can use Grails' regular render method to render content:
</div>
非同期にコンテンツ(テンプレートやバイナリなど)のレンダリングには、Servlet 3.0の<code>AsyncContext</code>インスタンスを返す、<code>startAsync</code>を使用します。このメソッドを使用して<code>AsyncContext</code>への参照を取得したら、あとは通常のrenderメソッドを使用してコンテンツをレンダリングするだけです。<p class="paragraph"/><div class="code"><pre>def index() &#123;
    def ctx = startAsync()
    ctx.start &#123;
        <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Stand"</span>).save()
        render template:<span class="java&#45;quote">"books"</span>, model:&#91;books:Book.list()&#93;
        ctx.complete()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Note that you must call the <code>complete()</code> method to terminate the connection. 
</div>
接続を終了するには、<code>complete</code>メソッドを呼び出す必要があることに注意してください。<p class="paragraph"/><div class="hidden-block">
<h4>Resuming an Async Request</h4>
</div>
<h4>非同期リクエストの再開</h4><p class="paragraph"/><div class="hidden-block">
You resume processing of an async request (for example to delegate to view rendering) by using the <code>dispatch</code> method of the <code>AsyncContext</code> class:
</div>
非同期リクエストの処理(例えばビューをレンダリングするために処理を委譲する)を再開するには、<code>AsyncContext</code>クラスの<code>dispatch</code>メソッドを使用します。<p class="paragraph"/><div class="code"><pre>def index() &#123;
    def ctx = startAsync()
    ctx.start &#123;
        // <span class="java&#45;keyword">do</span> working
        &#8230;
        // render view
        ctx.dispatch()
    &#125;
&#125;</pre></div>


<a name="10. Validation"><!-- Legacy link --></a>
<h1 id="validation">10 バリデーション</h1>
<div class="hidden-block">Grails validation capability is built on <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/package-summary.html" target="blank">Spring&#39;s Validator API</a> and data binding capabilities. However Grails takes this further and provides a unified way to define validation "constraints" with its constraints mechanism.</div>
Grailsのバリデーションは、<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/package-summary.html" target="blank">SpringのバリデーションAPI</a>とデータバインディングに基づいて実装されています。Grailsではこれらを発展させ、制約(<code>constraints</code>)によってバリデーションを定義するすてきな仕組みを持っています。<p class="paragraph"/><div class="hidden-block">Constraints in Grails are a way to declaratively specify validation rules. Most commonly they are applied to <a href="../guide/single.html#GORM" class="guide">domain classes</a>, however <a href="../guide/single.html#urlmappings" class="guide">URL Mappings</a> and <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> also support constraints.</div>
Grailsにおける制約は、バリデーションのルールを宣言的に定義する手段です。多くの場合<a href="../guide/single.html#GORM" class="guide">ドメインクラス</a>で利用されますが、<a href="../guide/single.html#urlmappings" class="guide">URLマッピング</a>や<a href="../guide/single.html#commandObjects" class="guide">コマンドオブジェクト</a>でも制約をサポートしています。


<a name="10.1 Declaring Constraints"><!-- Legacy link --></a>
<h2 id="constraints">10.1 制約を宣言</h2>
<div class="hidden-block">Within a domain class <a href="../ref/Domain Classes/constraints.html" class="domainClasses">constraints</a> are defined with the constraints property that is assigned a code block:</div>
ドメインクラスの制約は、次のような<a href="../ref/Domain Classes/constraints.html" class="domainClasses">constraints</a>プロパティによって指定します。<p class="paragraph"/><div class="code"><pre>class User &#123;
    <span class="java&#45;object">String</span> login
    <span class="java&#45;object">String</span> password
    <span class="java&#45;object">String</span> email
    <span class="java&#45;object">Integer</span> age<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
      &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You then use method calls that match the property name for which the constraint applies in combination with named parameters to specify constraints:</div>
次に、プロパティ名と同じ名前のメソッド呼び出しで、適用したい制約とパラメータの組み合わせを与えます。<p class="paragraph"/><div class="code"><pre>class User &#123;
    ...<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        login size: 5..15, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        password size: 5..15, blank: <span class="java&#45;keyword">false</span>
        email email: <span class="java&#45;keyword">true</span>, blank: <span class="java&#45;keyword">false</span>
        age min: 18
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example we've declared that the <code>login</code> property must be between 5 and 15 characters long, it cannot be blank and must be unique. We've also applied other constraints to the <code>password</code>, <code>email</code> and <code>age</code> properties.</div>
この例では、<code>login</code>プロパティに対して5～15文字の長さとし(<code>size</code>)、空白(<code>blank</code>)を許可せず、一意となる(<code>unique</code>)よう制約を与えています。<code>password</code>、<code>email</code>、<code>age</code>の各プロパティについても同様に制約を宣言しています。<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
By default, all domain class properties are not nullable (i.e. they have an implicit <code>nullable: false</code> constraint).
</blockquote></div><p class="paragraph"/><blockquote class="note">
デフォルトでは、すべてのドメインクラスのプロパティはnull値を許容しません(暗黙に<code>nullable: false</code>制約を持っています)。
</blockquote><p class="paragraph"/><div class="hidden-block">A complete reference for the available constraints can be found in the Quick Reference section under the Constraints heading.</div>
利用可能な制約のリファレンスは、クイックリファレンスの見出し constraints で見ることができます。<p class="paragraph"/><div class="hidden-block">Note that constraints are only evaluated once which may be relevant for a constraint that relies on a value like an instance of <code>java.util.Date</code>.</div>
<code>java.util.Date</code>のインスタンスのような値を必要とするかもしれないため、制約が評価されるのは一度だけであることに注意してください。<p class="paragraph"/><div class="hidden-block"><div class="code"><pre>class User &#123;
    ...<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        // <span class="java&#45;keyword">this</span> Date object is created when the constraints are evaluated, not
        // each time an instance of the User class is validated.
        birthDate max: <span class="java&#45;keyword">new</span> Date()
    &#125;
&#125;</pre></div></div><p class="paragraph"/><div class="code"><pre>class User &#123;
    ...<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        // この Date 型オブジェクトは制約が評価されるときに作られます。
        // User クラスのインスタンスがバリデーションされる度に作られるわけではありません。
        birthDate max: <span class="java&#45;keyword">new</span> Date()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h3. A word of warning - referencing domain class properties from constraints</div>
<h3>忠告 - 制約からドメインクラスのプロパティを参照するとき</h3><p class="paragraph"/><div class="hidden-block">It's very easy to attempt to reference instance variables from the static constraints block, but this isn't legal in Groovy (or Java). If you do so, you will get a <code>MissingPropertyException</code> for your trouble. For example, you may try</div>
静的な制約の宣言からインスタンス変数を参照するのは非常に簡単ですが、これはGroovy(やJava)において適切ではありません。この場合、困ったことに<code>MissingPropertyException</code>が発生します。たとえば、以下のようなコードを試してみると…<p class="paragraph"/><div class="code"><pre>class Response &#123;
    Survey survey
    Answer answer<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        survey blank: <span class="java&#45;keyword">false</span>
        answer blank: <span class="java&#45;keyword">false</span>, inList: survey.answers
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">See how the <code>inList</code> constraint references the instance property <code>survey</code>? That won't work. Instead, use a custom <a href="../ref/Constraints/validator.html" class="constraints">validator</a>:</div>
このように、<code>inList</code>制約においてインスタンスプロパティである<code>survey</code>を参照すると、これは動作しません。代わりに、カスタム<a href="../ref/Constraints/validator.html" class="constraints">validator</a>を使いましょう:<p class="paragraph"/><div class="code"><pre>class Response &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> constraints = &#123;
        survey blank: <span class="java&#45;keyword">false</span>
        answer blank: <span class="java&#45;keyword">false</span>, validator: &#123; val, obj &#45;&#62; val in obj.survey.answers &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example, the <code>obj</code> argument to the custom validator is the domain  <em class="italic">instance</em>  that is being validated, so we can access its <code>survey</code> property and return a boolean to indicate whether the new value for the <code>answer</code> property, <code>val</code>, is valid.</div>
この例では、カスタムバリデータの引数<code>obj</code>は、バリデーションされるドメインクラスの  <em class="italic">インスタンス</em>  です。こうすることで<code>survey</code>プロパティにアクセスし、<code>answer</code>プロパティの新しい値として<code>val</code>が<code>survey.answers</code>に含まれるかどうかを示す真偽値を得ることができます。


<a name="10.2 Validating Constraints"><!-- Legacy link --></a>
<h2 id="validatingConstraints">10.2 制約をバリデートする</h2>
<div class="hidden-block">h4. Validation Basics</div>
<h4>バリデーションの基礎</h4><p class="paragraph"/><div class="hidden-block">Call the <a href="../ref/Domain Classes/validate.html" class="domainClasses">validate</a> method to validate a domain class instance:</div>
ドメインクラスのインスタンスをバリデーションするには、<a href="../ref/Domain Classes/validate.html" class="domainClasses">validate</a>メソッドを呼び出します:<p class="paragraph"/><div class="code"><pre>def user = <span class="java&#45;keyword">new</span> User(params)<p class="paragraph"/><span class="java&#45;keyword">if</span> (user.validate()) &#123;
    // <span class="java&#45;keyword">do</span> something with user
&#125;
<span class="java&#45;keyword">else</span> &#123;
    user.errors.allErrors.each &#123;
        println it
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>errors</code> property on domain classes is an instance of the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/Errors.html" class="api">Errors</a> interface. The <code>Errors</code> interface provides methods to navigate the validation errors and also retrieve the original values.</div>
ドメインクラスの<code>errors</code>プロパティは、Springの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/Errors.html" class="api">Errors</a>インターフェイスのインスタンスです。<code>Errors</code>インターフェイスは、バリデーションエラーの参照や元の値の取得などのメソッドを提供します。<p class="paragraph"/><div class="hidden-block">h4. Validation Phases</div>
<h4>バリデーションのフェーズ</h4><p class="paragraph"/><div class="hidden-block">Within Grails there are two phases of validation, the first one being <a href="../guide/single.html#dataBinding" class="guide">data binding</a> which occurs when you bind request parameters onto an instance such as:</div>
Grailsではバリデーションに2つのフェーズがあります。1つ目は<a href="../guide/single.html#dataBinding" class="guide">data binding</a>であり、インスタンスにリクエストパラメータをバインドするときに発生します:<p class="paragraph"/><div class="code"><pre>def user = <span class="java&#45;keyword">new</span> User(params)</pre></div><p class="paragraph"/><div class="hidden-block">At this point you may already have errors in the <code>errors</code> property due to type conversion (such as converting Strings to Dates). You can check these and obtain the original input value using the <code>Errors</code> API:</div>
この時点で既に型変換に起因する<code>errors</code>プロパティが存在する場合があります(文字列を日付に変換しようとするなど)。<code>Errors</code> APIを使用することで、エラーの有無や元の入力値を取得することができます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (user.hasErrors()) &#123;
    <span class="java&#45;keyword">if</span> (user.errors.hasFieldErrors(<span class="java&#45;quote">"login"</span>)) &#123;
        println user.errors.getFieldError(<span class="java&#45;quote">"login"</span>).rejectedValue
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The second phase of validation happens when you call <a href="../ref/Domain Classes/validate.html" class="domainClasses">validate</a> or <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>. This is when Grails will validate the bound values againts the <a href="../ref/Domain Classes/constraints.html" class="domainClasses">constraints</a> you defined. For example, by default the <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> method calls <code>validate</code> before executing, allowing you to write code like:</div>
バリデーションの2つ目のフェーズが発生するのは、<a href="../ref/Domain Classes/validate.html" class="domainClasses">validate</a>や<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>が呼び出されたときです。
ここでは、バインドされた値を<a href="../ref/Domain Classes/constraints.html" class="domainClasses">constraints</a>の定義によってGrailsがバリデーションします。
たとえば、デフォルトで<a href="../ref/Domain Classes/save.html" class="domainClasses">save</a>メソッドは<code>validate</code>を呼び出すので、次のようなコードが書けます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (user.save()) &#123;
    <span class="java&#45;keyword">return</span> user
&#125;
<span class="java&#45;keyword">else</span> &#123;
    user.errors.allErrors.each &#123;
        println it
    &#125;
&#125;</pre></div>



<h2 id="sharingConstraints">10.3 制約をクラス間で共有する</h2>
A common pattern in Grails is to use <a href="../guide/single.html#commandObjects" class="guide">command objects</a> for validating user-submitted data and then copy the properties of the command object to the relevant domain classes. This often means that your command objects and domain classes share properties and their constraints. You could manually copy and paste the constraints between the two, but that's a very error-prone approach. Instead, make use of Grails' global constraints and import mechanism.<p class="paragraph"/><h3>Global Constraints</h3><p class="paragraph"/>In addition to defining constraints in domain classes, command objects and <a href="../guide/single.html#validationNonDomainAndCommandObjectClasses" class="guide">other validateable classes</a>, you can also define them in <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.gorm.<span class="java&#45;keyword">default</span>.constraints = &#123;
    '&#42;'(nullable: <span class="java&#45;keyword">true</span>, size: 1..20)
    myShared(nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>)
&#125;</pre></div><p class="paragraph"/>These constraints are not attached to any particular classes, but they can be easily referenced from any validateable class:<p class="paragraph"/><div class="code"><pre>class User &#123;
    ...<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        login shared: <span class="java&#45;quote">"myShared"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>Note the use of the <code>shared</code> argument, whose value is the name of one of the constraints defined in <code>grails.gorm.default.constraints</code>. Despite the name of the configuration setting, you can reference these shared constraints from any validateable class, such as command objects.<p class="paragraph"/>The '*' constraint is a special case: it means that the associated constraints ('nullable' and 'size' in the above example) will be applied to all properties in all validateable classes. These defaults can be overridden by the constraints declared in a validateable class.<p class="paragraph"/><h3>Importing Constraints</h3><p class="paragraph"/>Grails 2 introduced an alternative approach to sharing constraints that allows you to import a set of constraints from one class into another.<p class="paragraph"/>Let's say you have a domain class like so:<p class="paragraph"/><div class="code"><pre>class User &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">String</span> passwordHash<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        firstName blank: <span class="java&#45;keyword">false</span>, nullable: <span class="java&#45;keyword">false</span>
        lastName blank: <span class="java&#45;keyword">false</span>, nullable: <span class="java&#45;keyword">false</span>
        passwordHash blank: <span class="java&#45;keyword">false</span>, nullable: <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>You then want to create a command object, <code>UserCommand</code>, that shares some of the properties of the domain class and the corresponding constraints. You do this with the <code>importFrom()</code> method:<p class="paragraph"/><div class="code"><pre>class UserCommand &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">String</span> password
    <span class="java&#45;object">String</span> confirmPassword<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        importFrom User<p class="paragraph"/>        password blank: <span class="java&#45;keyword">false</span>, nullable: <span class="java&#45;keyword">false</span>
        confirmPassword blank: <span class="java&#45;keyword">false</span>, nullable: <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>This will import all the constraints from the <code>User</code> domain class and apply them to <code>UserCommand</code>. The import will ignore any constraints in the source class (<code>User</code>) that don't have corresponding properties in the importing class (<code>UserCommand</code>). In the above example, only the 'firstName' and 'lastName' constraints will be imported into <code>UserCommand</code> because those are the only properties shared by the two classes.<p class="paragraph"/>If you want more control over which constraints are imported, use the <code>include</code> and <code>exclude</code> arguments. Both of these accept a list of simple or regular expression strings that are matched against the property names in the source constraints. So for example, if you only wanted to import the 'lastName' constraint you would use:<p class="paragraph"/><div class="code"><pre>&#8230;
<span class="java&#45;keyword">static</span> constraints = &#123;
    importFrom User, include: &#91;<span class="java&#45;quote">"lastName"</span>&#93;
    &#8230;
&#125;</pre></div><p class="paragraph"/>or if you wanted all constraints that ended with 'Name':<p class="paragraph"/><div class="code"><pre>&#8230;
<span class="java&#45;keyword">static</span> constraints = &#123;
    importFrom User, include: &#91;/.&#42;Name/&#93;
    &#8230;
&#125;</pre></div><p class="paragraph"/>Of course, <code>exclude</code> does the reverse, specifying which constraints should  <em class="italic">not</em>  be imported.


<a name="10.3 Validation on the Client"><!-- Legacy link --></a>
<h2 id="validationOnTheClient">10.4 クライアントサイドバリデーション</h2>
<h4>Displaying Errors</h4><p class="paragraph"/>Typically if you get a validation error you redirect back to the view for rendering. Once there you need some way of displaying errors. Grails supports a rich set of tags for dealing with errors. To render the errors as a list you can use <a href="../ref/Tags/renderErrors.html" class="tags">renderErrors</a>:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:renderErrors bean=<span class="xml&#45;quote">"$&#123;user&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/>If you need more control you can use <a href="../ref/Tags/hasErrors.html" class="tags">hasErrors</a> and <a href="../ref/Tags/eachError.html" class="tags">eachError</a>:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:hasErrors bean=<span class="xml&#45;quote">"$&#123;user&#125;"</span>&#62;</span>
  <span class="xml&#45;tag">&#60;ul&#62;</span>
   <span class="xml&#45;tag">&#60;g:eachError var=<span class="xml&#45;quote">"err"</span> bean=<span class="xml&#45;quote">"$&#123;user&#125;"</span>&#62;</span>
       <span class="xml&#45;tag">&#60;li&#62;</span>$&#123;err&#125;<span class="xml&#45;tag">&#60;/li&#62;</span>
   <span class="xml&#45;tag">&#60;/g:eachError&#62;</span>
  <span class="xml&#45;tag">&#60;/ul&#62;</span>
<span class="xml&#45;tag">&#60;/g:hasErrors&#62;</span></pre></div><p class="paragraph"/><h4>Highlighting Errors</h4><p class="paragraph"/>It is often useful to highlight using a red box or some indicator when a field has been incorrectly input. This can also be done with the <a href="../ref/Tags/hasErrors.html" class="tags">hasErrors</a> by invoking it as a method. For example:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;div class='value $&#123;hasErrors(bean:user,field:'login','errors')&#125;'&#62;</span>
   <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"text"</span> name=<span class="xml&#45;quote">"login"</span> value=<span class="xml&#45;quote">"$&#123;fieldValue(bean:user,field:'login')&#125;"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/div&#62;</span></pre></div><p class="paragraph"/>This code checks if the <code>login</code> field of the <code>user</code> bean has any errors and if so it adds an <code>errors</code> CSS class to the <code>div</code>, allowing you to use CSS rules to highlight the <code>div</code>.<p class="paragraph"/><h4>Retrieving Input Values</h4><p class="paragraph"/>Each error is actually an instance of the <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/FieldError.html" class="api">FieldError</a> class in Spring, which retains the original input value within it. This is useful as you can use the error object to restore the value input by the user using the <a href="../ref/Tags/fieldValue.html" class="tags">fieldValue</a> tag:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"text"</span> name=<span class="xml&#45;quote">"login"</span> value=<span class="xml&#45;quote">"$&#123;fieldValue(bean:user,field:'login')&#125;"</span>/&#62;</span></pre></div><p class="paragraph"/>This code will check for an existing <code>FieldError</code> in the <code>User</code> bean and if there is obtain the originally input value for the <code>login</code> field.


<a name="10.4 Validation and Internationalization"><!-- Legacy link --></a>
<h2 id="validationAndInternationalization">10.5 バリデーションの国際化</h2>
Another important thing to note about errors in Grails is that error messages are not hard coded anywhere. The <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/validation/FieldError.html" class="api">FieldError</a> class in Spring resolves messages from message bundles using Grails' <a href="../guide/single.html#i18n" class="guide">i18n</a> support.<p class="paragraph"/><h4>Constraints and Message Codes</h4><p class="paragraph"/>The codes themselves are dictated by a convention. For example consider the constraints we looked at earlier:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/>class User &#123;
    ...<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        login size: 5..15, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        password size: 5..15, blank: <span class="java&#45;keyword">false</span>
        email email: <span class="java&#45;keyword">true</span>, blank: <span class="java&#45;keyword">false</span>
        age min: 18
    &#125;
&#125;</pre></div><p class="paragraph"/>If a constraint is violated Grails will by convention look for a message code of the form:<p class="paragraph"/><div class="code"><pre>&#91;<span class="java&#45;object">Class</span> Name&#93;.&#91;Property Name&#93;.&#91;Constraint Code&#93;</pre></div><p class="paragraph"/>In the case of the <code>blank</code> constraint this would be <code>user.login.blank</code> so you would need a message such as the following in your <code>grails-app/i18n/messages.properties</code> file:<p class="paragraph"/><div class="code"><pre>user.login.blank=Your login name must be specified!</pre></div><p class="paragraph"/>The class name is looked for both with and without a package, with the packaged version taking precedence. So for example, com.mycompany.myapp.User.login.blank will be used before user.login.blank. This allows for cases where your domain class message codes clash with a plugin's.<p class="paragraph"/>For a reference on what codes are for which constraints refer to the reference guide for each constraint.<p class="paragraph"/><h4>Displaying Messages</h4><p class="paragraph"/>The <a href="../ref/Tags/renderErrors.html" class="tags">renderErrors</a> tag will automatically look up messages for you using the <a href="../ref/Tags/message.html" class="tags">message</a> tag. If you need more control of rendering you can handle this yourself:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:hasErrors bean=<span class="xml&#45;quote">"$&#123;user&#125;"</span>&#62;</span>
  <span class="xml&#45;tag">&#60;ul&#62;</span>
   <span class="xml&#45;tag">&#60;g:eachError var=<span class="xml&#45;quote">"err"</span> bean=<span class="xml&#45;quote">"$&#123;user&#125;"</span>&#62;</span>
       <span class="xml&#45;tag">&#60;li&#62;</span><span class="xml&#45;tag">&#60;g:message error=<span class="xml&#45;quote">"$&#123;err&#125;"</span> /&#62;</span><span class="xml&#45;tag">&#60;/li&#62;</span>
   <span class="xml&#45;tag">&#60;/g:eachError&#62;</span>
  <span class="xml&#45;tag">&#60;/ul&#62;</span>
<span class="xml&#45;tag">&#60;/g:hasErrors&#62;</span></pre></div><p class="paragraph"/>In this example within the body of the <a href="../ref/Tags/eachError.html" class="tags">eachError</a> tag we use the <a href="../ref/Tags/message.html" class="tags">message</a> tag in combination with its <code>error</code> argument to read the message for the given error.<p class="paragraph"/>

<a name="10.5 Validation Non Domain and Command Object Classes"><!-- Legacy link --></a>
<h2 id="validationNonDomainAndCommandObjectClasses">10.6 コマンドオブジェクト、ドメインクラス以外のバリデーション</h2>
<a href="../guide/single.html#domainClasses" class="guide">Domain classes</a> and <a href="../guide/single.html#commandObjects" class="guide">command objects</a> support validation by default.  Other classes may be made validateable by defining the static <code>constraints</code> property in the class (as described above) and then telling the framework about them.  It is important that the application register the validateable classes with the framework.  Simply defining the <code>constraints</code> property is not sufficient.<p class="paragraph"/><h4>The Validateable Annotation</h4><p class="paragraph"/>Classes which define the static <code>constraints</code> property and are annotated with @Validateable can be made validateable by the framework. Consider this example:<p class="paragraph"/><div class="code"><pre>// src/groovy/com/mycompany/myapp/User.groovy
<span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.validation.Validateable<p class="paragraph"/>@Validateable
class User &#123;
    ...<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        login size: 5..15, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        password size: 5..15, blank: <span class="java&#45;keyword">false</span>
        email email: <span class="java&#45;keyword">true</span>, blank: <span class="java&#45;keyword">false</span>
        age min: 18
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Registering Validateable Classes</h4><p class="paragraph"/>If a class is not marked with <code>Validateable, it may still be made validateable by the framework. The steps required to do this are to define the static </code>constraints<code> property in the class (as described above) and then telling the framework about the class by assigning a value to the </code>grails.validateable.classes<code> property in </code>Config.groovy@:<p class="paragraph"/><div class="code"><pre>grails.validateable.classes = &#91;com.mycompany.myapp.User, com.mycompany.dto.Account&#93;</pre></div>


<a name="11. The Service Layer"><!-- Legacy link --></a>
<h1 id="services">11 サービスレイヤー</h1>
<div class="hidden-block">Grails defines the notion of a service layer. The Grails team discourages the embedding of core application logic inside controllers, as it does not promote reuse and a clean separation of concerns.</div>
Grailsではサービスレイヤの概念を持っています。再利用や関心事の明確な分離を妨げるといった理由から、Grailsチームは、コントローラ内にアプリケーションのコアロジックを持ち込まないことを推奨します。<p class="paragraph"/><div class="hidden-block">Services in Grails are the place to put the majority of the logic in your application, leaving controllers responsible for handling request flow with redirects and so on.</div>
Grailsのサービスは、アプリケーション・ロジックの大部分を置く場所と考えられます。コントローラには、リダイレクトなどを介してリクエストの流れを処理する、といった責務が残ります。<p class="paragraph"/><h4>サービスを作成する <div class="hidden-block">Creating a Service </div></h4><p class="paragraph"/><div class="hidden-block">You can create a Grails service by running the <a href="../ref/Command Line/create-service.html" class="commandLine">create-service</a> command from the root of your project in a terminal window:</div>
ターミナルウィンドウで、プロジェクトのルートから<a href="../ref/Command Line/create-service.html" class="commandLine">create-service</a>コマンドを実行すると、Grailsのサービスを作成することができます:<p class="paragraph"/><div class="code"><pre>grails create&#45;service helloworld.simple</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If no package is specified with the create-service script, Grails automatically uses the application name as the package name.</div>
create-serviceスクリプト実行した際にパッケージ名を指定しなかった場合は、アプリケーション名をパッケージ名として使用します。
</blockquote><p class="paragraph"/><div class="hidden-block">The above example will create a service at the location <code>grails-app/services/helloworld/SimpleService.groovy</code>. A service's name ends with the convention <code>Service</code>, other than that a service is a plain Groovy class:</div>
上記の例では、<code>grails-app/services/helloworld/SimpleService.groovy</code>というサービスが作成されます。サービスの名前は、規約で<code>Service</code>で終わることになっており、作成されるサービスは、普通のGroovyクラスです<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> helloworld<p class="paragraph"/>class SimpleService &#123;
&#125;</pre></div>


<a name="11.1 Declarative Transactions"><!-- Legacy link --></a>
<h2 id="declarativeTransactions">11.1 断定的なトランザクション</h2>
<h3>デフォルトの宣言的トランザクション <div class="hidden-block">Default Declarative Transactions </div></h3><p class="paragraph"/><div class="hidden-block">Services are typically involved with coordinating logic between <a href="../guide/single.html#GORM" class="guide">domain classes</a>, and hence often involved with persistence that spans large operations. Given the nature of services, they frequently require transactional behaviour. You can use programmatic transactions with the <a href="../ref/Domain Classes/withTransaction.html" class="domainClasses">withTransaction</a> method, however this is repetitive and doesn't fully leverage the power of Spring's underlying transaction abstraction.</div>
サービスは、典型的には<a href="../guide/single.html#GORM" class="guide">ドメインクラス</a>間の調整的なロジックに関わりますが、それゆえしばしば大規模な操作に渡る永続性に関わります。頻繁にトランザクションの振る舞いを必要とするサービスの性質を考えてください。もちろん<a href="../ref/Domain Classes/withTransaction.html" class="domainClasses">withTransaction</a>メソッドを使ってプログラム的なトランザクションを行うことができますが、これは同じことを何度も繰り返すことになり、Springが持つ基本的なトランザクション抽象化の恩恵を十分活用することができません。<p class="paragraph"/><div class="hidden-block">Services enable transaction demarcation, which is a declarative way of defining which methods are to be made transactional. All services are transactional by default. To disable this set the <code>transactional</code> property to <code>false</code>:</div>
サービスは、トランザクション境界を使用することができ、サービス内のすべてのメソッドをトランザクションにすると宣言する宣言方法です。すべてのサービスは、デフォルトでトランザクション境界が可能です、不可にするには<code>transactional</code>プロパティに<code>false</code>を設定します:<p class="paragraph"/><div class="code"><pre>class CountryService &#123;
    <span class="java&#45;keyword">static</span> transactional = <span class="java&#45;keyword">false</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You may also set this property to <code>true</code> to make it clear that the service is intentionally transactional.</div>
サービスが意図的にトランザクションであるということを明確にするために、このプロパティにtrueを設定することもできます。<p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">Warning: <a href="../guide/single.html#dependencyInjectionServices" class="guide">dependency injection</a> is the <strong class="bold">only</strong> way that declarative transactions work. You will not get a transactional service if you use the <code>new</code> operator such as <code>new BookService()</code></div>
警告：<a href="../guide/single.html#dependencyInjectionServices" class="guide">依存性の注入</a>は、宣言的トランザクションが機能する唯一の方法です。<code>new BookService()</code>のように<code>new</code>演算子を使用した場合、トランザクションなサービスを取得するできません。
</blockquote><p class="paragraph"/><div class="hidden-block">The result is that all methods are wrapped in a transaction and automatic rollback occurs if a method throws a runtime exception (i.e. one that extends <code>RuntimeException</code>) or an <code>Error</code>. The propagation level of the transaction is by default set to <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/transaction/TransactionDefinition.html#PROPAGATION_REQUIRED" target="blank">PROPAGATION_REQUIRED</a>.</div>
その結果、すべてのメソッドがトランザクションでラップされ、例外がメソッドからスローされると、トランザクションは自動的にロールバックされます。トランザクションの伝播レベルは、デフォルトで<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/transaction/TransactionDefinition.html#PROPAGATION_REQUIRED" target="blank">PROPAGATION_REQUIRED</a>が設定されます。<p class="paragraph"/><blockquote class="warning">
Checked exceptions do <strong class="bold">not</strong> roll back transactions. Even though Groovy blurs the distinction between checked and unchecked exceptions, Spring isn't aware of this and its default behaviour is used, so it's important to understand the distinction between checked and unchecked exceptions.
</blockquote><p class="paragraph"/><h3>カスタムトランザクションの設定 <div class="hidden-block">Custom Transaction Configuration </div></h3><p class="paragraph"/><div class="hidden-block">Grails also fully supports Spring's <code>Transactional</code> annotation for cases where you need more fine-grained control over transactions at a per-method level or need specify an alternative propagation level.</div>
メソッド単位のレベルでトランザクションのよりきめの細かいコントロールを必要とする場合や、別のトランザクション伝播レベルを指定する必要がある場合、GrailsはSpringの<code>Transactional</code>アノテーションもフルサポートしています:<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Annotating a service method with <code>Transactional</code> disables the default Grails transactional behavior for that service (in the same way that adding <code>transactional=false</code> does) so if you use any annotations you must annotate all methods that require transactions.</div>
<code>Transactional</code>アノテーションをメソッドに指定すると、デフォルトの書式(<code>transactional=false</code>での定義)でのトランザクションは無効になります。アノテーションを使用する場合は、トランザクションが必要な全てのメソッドに定義する必要があります。
</blockquote><p class="paragraph"/><div class="hidden-block">In this example <code>listBooks</code> uses a read-only transaction, <code>updateBook</code> uses a default read-write transaction, and <code>deleteBook</code> is not transactional (probably not a good idea given its name).</div>
この例では<code>listBooks</code>がread-onlyトランザクションを使用、<code>updateBook</code>がデフォルトのread-writeトランザクションを使用、<code>deleteBook</code>にはトランザクションは指定されていません(このメソッドの名前的に良くはありませんが)。
<div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.transaction.annotation.Transactional<p class="paragraph"/>class BookService &#123;<p class="paragraph"/>    @Transactional(readOnly = <span class="java&#45;keyword">true</span>)
    def listBooks() &#123;
        Book.list()
    &#125;<p class="paragraph"/>    @Transactional
    def updateBook() &#123;
        // …
    &#125;<p class="paragraph"/>    def deleteBook() &#123;
        // …
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also annotate the class to define the default transaction behavior for the whole service, and then override that default per-method. For example, this service is equivalent to one that has no annotations (since the default is implicitly <code>transactional=true</code>):</div>
クラスにアノテーションを指定することで、サービス全体にデフォルトトランザクションを指定して、さらにそれぞれのメソッドでオーバーライドすることができます。例として、このサービスはアノテーションを使用していない物と同等になります(<code>transactional=true</code>がデフォルトなので):<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.transaction.annotation.Transactional<p class="paragraph"/>@Transactional
class BookService &#123;<p class="paragraph"/>    def listBooks() &#123;
        Book.list()
    &#125;<p class="paragraph"/>    def updateBook() &#123;
        // …
    &#125;<p class="paragraph"/>    def deleteBook() &#123;
        // …
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This version defaults to all methods being read-write transactional (due to the class-level annotation), but the <code>listBooks</code> method overrides this to use a read-only transaction:</div>
オーバーライドした、read-onlyトランザクションの<code>listBooks</code>メソッド以外の、全メソッドがread-writeトランザクションになります(クラスレベルのアノテーションの定義によって)。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.transaction.annotation.Transactional<p class="paragraph"/>@Transactional
class BookService &#123;<p class="paragraph"/>    @Transactional(readOnly = <span class="java&#45;keyword">true</span>)
    def listBooks() &#123;
        Book.list()
    &#125;<p class="paragraph"/>    def updateBook() &#123;
        // …
    &#125;<p class="paragraph"/>    def deleteBook() &#123;
        // …
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Although <code>updateBook</code> and <code>deleteBook</code> aren't annotated in this example, they inherit the configuration from the class-level annotation.</div>
<code>updateBook</code>と<code>deleteBook</code>はアノテーション指定されていませんが、クラスレベルアノテーションの定義が受け継がれます。<p class="paragraph"/><div class="hidden-block">For more information refer to the section of the Spring user guide on <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/transaction.html#transaction-declarative-annotations" target="blank">Using @Transactional</a>. </div>
さらなる情報はSpringユーザガイドの<a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/transaction.html#transaction-declarative-annotations" target="blank">トランザクション</a>セクションを参照してください。<p class="paragraph"/><div class="hidden-block">Unlike Spring you do not need any prior configuration to use <code>Transactional</code>; just specify the annotation as needed and Grails will detect them up automatically.</div>
Springと違い<code>Transactional</code>を使用するための特別な定義は必要有りません。必要なアノテーションを記述すればGrailsが自動的に認識します。


<a name="11.1.1 Transactions Rollback and the Session"><!-- Legacy link --></a>
<h2 id="transactionsRollbackAndTheSession">11.1.1 トランザクションロールバックとセッション</h2>
<h3>Understanding Transactions and the Hibernate Session</h3><p class="paragraph"/>When using transactions there are important considerations you must take into account with regards to how the underlying persistence session is handled by Hibernate. When a transaction is rolled back the Hibernate session used by GORM is cleared. This means any objects within the session become detached and accessing uninitialized lazy-loaded collections will lead to <code>LazyInitializationException</code>s.<p class="paragraph"/>To understand why it is important that the Hibernate session is cleared. Consider the following example:<p class="paragraph"/><div class="code"><pre>class Author &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">Integer</span> age<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
&#125;</pre></div><p class="paragraph"/>If you were to save two authors using consecutive transactions as follows:<p class="paragraph"/><div class="code"><pre>Author.withTransaction &#123; status &#45;&#62;
    <span class="java&#45;keyword">new</span> Author(name: <span class="java&#45;quote">"Stephen King"</span>, age: 40).save()
    status.setRollbackOnly()
&#125;<p class="paragraph"/>Author.withTransaction &#123; status &#45;&#62;
    <span class="java&#45;keyword">new</span> Author(name: <span class="java&#45;quote">"Stephen King"</span>, age: 40).save()
&#125;</pre></div><p class="paragraph"/>Only the second author would be saved since the first transaction rolls back the author <code>save()</code> by clearing the Hibernate session. If the Hibernate session were not cleared then both author instances would be persisted and it would lead to very unexpected results.<p class="paragraph"/>It can, however, be frustrating to get <code>LazyInitializationException</code>s due to the session being cleared.<p class="paragraph"/>For example, consider the following example:<p class="paragraph"/><div class="code"><pre>class AuthorService &#123;<p class="paragraph"/>    void updateAge(id, <span class="java&#45;object">int</span> age) &#123;
        def author = Author.get(id)
        author.age = age
        <span class="java&#45;keyword">if</span> (author.isTooOld()) &#123;
            <span class="java&#45;keyword">throw</span> <span class="java&#45;keyword">new</span> AuthorException(<span class="java&#45;quote">"too old"</span>, author)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class AuthorController &#123;<p class="paragraph"/>    def authorService<p class="paragraph"/>    def updateAge() &#123;
        <span class="java&#45;keyword">try</span> &#123;
            authorService.updateAge(params.id, params.<span class="java&#45;object">int</span>(<span class="java&#45;quote">"age"</span>))
        &#125;
        <span class="java&#45;keyword">catch</span>(e) &#123;
            render <span class="java&#45;quote">"Author books $&#123;e.author.books&#125;"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>In the above example the transaction will be rolled back if the <code>Author</code>'s age exceeds the maximum value defined in the <code>isTooOld()</code> method by throwing an <code>AuthorException</code>. The <code>AuthorException</code> references the author but when the <code>books</code> association is accessed a <code>LazyInitializationException</code> will be thrown because the underlying Hibernate session has been cleared.<p class="paragraph"/>To solve this problem you have a number of options. One is to ensure you query eagerly to get the data you will need:<p class="paragraph"/><div class="code"><pre>class AuthorService &#123;
    &#8230;
    void updateAge(id, <span class="java&#45;object">int</span> age) &#123;
        def author = Author.findById(id, &#91;fetch:&#91;books:<span class="java&#45;quote">"eager"</span>&#93;&#93;)
        ...</pre></div><p class="paragraph"/>In this example the <code>books</code> association will be queried when retrieving the <code>Author</code>.<p class="paragraph"/><blockquote class="note">
This is the optimal solution as it requires fewer queries then the following suggested solutions.
</blockquote><p class="paragraph"/>Another solution is to redirect the request after a transaction rollback:<p class="paragraph"/><div class="code"><pre>class AuthorController &#123;<p class="paragraph"/>    AuthorService authorService<p class="paragraph"/>    def updateAge() &#123;
        <span class="java&#45;keyword">try</span> &#123;
            authorService.updateAge(params.id, params.<span class="java&#45;object">int</span>(<span class="java&#45;quote">"age"</span>))
        &#125;
        <span class="java&#45;keyword">catch</span>(e) &#123;
            flash.message <span class="java&#45;quote">"Can't update age"</span>
            redirect action:<span class="java&#45;quote">"show"</span>, id:params.id
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>In this case a new request will deal with retrieving the <code>Author</code> again. And, finally a third solution is to retrieve the data for the <code>Author</code> again to make sure the session remains in the correct state:<p class="paragraph"/><div class="code"><pre>class AuthorController &#123;<p class="paragraph"/>    def authorService<p class="paragraph"/>    def updateAge() &#123;
        <span class="java&#45;keyword">try</span> &#123;
            authorService.updateAge(params.id, params.<span class="java&#45;object">int</span>(<span class="java&#45;quote">"age"</span>))
        &#125;
        <span class="java&#45;keyword">catch</span>(e) &#123;
            def author = Author.read(params.id)
            render <span class="java&#45;quote">"Author books $&#123;author.books&#125;"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Validation Errors and Rollback</h3><p class="paragraph"/>A common use case is to rollback a transaction if there are validation errors. For example consider this service:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.validation.ValidationException<p class="paragraph"/>class AuthorService &#123;<p class="paragraph"/>    void updateAge(id, <span class="java&#45;object">int</span> age) &#123;
        def author = Author.get(id)
        author.age = age
        <span class="java&#45;keyword">if</span> (!author.validate()) &#123;
            <span class="java&#45;keyword">throw</span> <span class="java&#45;keyword">new</span> ValidationException(<span class="java&#45;quote">"Author is not valid"</span>, author.errors)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>To re-render the same view that a transaction was rolled back in you can re-associate the errors with a refreshed instance before rendering:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.validation.ValidationException<p class="paragraph"/>class AuthorController &#123;<p class="paragraph"/>    def authorService<p class="paragraph"/>    def updateAge() &#123;
        <span class="java&#45;keyword">try</span> &#123;
            authorService.updateAge(params.id, params.<span class="java&#45;object">int</span>(<span class="java&#45;quote">"age"</span>))
        &#125;
        <span class="java&#45;keyword">catch</span> (ValidationException e) &#123;
            def author = Author.read(params.id)
            author.errors = e.errors
            render view: <span class="java&#45;quote">"edit"</span>, model: &#91;author:author&#93;
        &#125;
    &#125;
&#125;</pre></div>


<a name="11.2 Scoped Services"><!-- Legacy link --></a>
<h2 id="scopedServices">11.2 サービスのスコープ</h2>
<div class="hidden-block">By default, access to service methods is not synchronised, so nothing prevents concurrent execution of those methods. In fact, because the service is a singleton and may be used concurrently, you should be very careful about storing state in a service. Or take the easy (and better) road and never store state in a service.</div>
デフォルトでは、サービスが持つメソッドへのアクセスは同期されないので、サービスが持つメソッドの同時実行を防ぐことはできません。実際には、サービスはシングルトンで同時に使用することが出来るため、サービスに状態を格納する場合は注意が必要です。簡単な(そしてより良い)方法は、サービスに状態を決して格納しないことです。<p class="paragraph"/><div class="hidden-block">You can change this behaviour by placing a service in a particular scope. The supported scopes are:</div>
特定のスコープにサービスを置くことで、この振る舞いを変えることができます。サポートされているスコープは次のとおりです：<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>prototype</code> - A new service is created every time it is injected into another class</li>
<li><code>request</code> - A new service will be created per request</li>
<li><code>flash</code> - A new service will be created for the current and next request only</li>
<li><code>flow</code> - In web flows the service will exist for the scope of the flow</li>
<li><code>conversation</code> - In web flows the service will exist for the scope of the conversation. ie a root flow and its sub flows</li>
<li><code>session</code> - A service is created for the scope of a user session</li>
<li><code>singleton</code> (default) - Only one instance of the service ever exists</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>prototype</code> - クラスへの注入時にサービスが生成される</li>
<li><code>request</code> - リクエスト毎にサービスが生成される</li>
<li><code>flash</code> - 現在とその次のリクエスト用にサービスが生成される</li>
<li><code>flow</code> - フローの開始から終了まてのサービス(サブフロー含まず)</li>
<li><code>conversation</code> - フローの開始から終了まてのサービス(サブフロー含む)</li>
<li><code>session</code> - ユーザセッション毎にサービスが生成される</li>
<li><code>singleton</code> (デフォルト) - サービスが1つのみ生成される</li>
</ul><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If your service is <code>flash</code>, <code>flow</code> or <code>conversation</code> scoped it must implement <code>java.io.Serializable</code> and can only be used in the context of a <a href="../guide/single.html#webflow" class="guide">Web Flow</a></div>
サービスのスコープが<code>flash</code>、<code>flow</code>あるいは<code>conversation</code>の場合、java.io.Serializableを実装する必要があり、<a href="../guide/single.html#webflow" class="guide">Webフロー</a>のコンテキストの中でだけ使うことができます。
</blockquote><p class="paragraph"/><div class="hidden-block">To enable one of the scopes, add a static scope property to your class whose value is one of the above, for example </div>
スコープのいずれかを有効にするには、クラスにstaticのscopeプロパティを追加し、プロパティの値を上記のいずれかにします:
<div class="code"><pre><span class="java&#45;keyword">static</span> scope = <span class="java&#45;quote">"flow"</span></pre></div>


<a name="11.3 Dependency Injection and Services"><!-- Legacy link --></a>
<h2 id="dependencyInjectionServices">11.3 依存注入とサービス</h2>
<h4>依存性の注入の基本 <div class="hidden-block">Dependency Injection Basics </div></h4><p class="paragraph"/><div class="hidden-block">A key aspect of Grails services is the ability to use <a href="http://www.springframework.org/" target="blank">Spring Framework</a>'s dependency injection features. Grails supports "dependency injection by convention". In other words, you can use the property name representation of the class name of a service to automatically inject them into controllers, tag libraries, and so on.</div>
Grailsのサービスの重要な側面は、<a href="http://www.springframework.org/" target="blank">Springフレームワーク</a>が持つ依存性注入機能を活用するための能力です。Grailsは、「規約による依存性の注入」をサポートしています。言い換えれば、サービスのクラス名のプロパティ名表現を使用することで、自動的にコントローラ、タグライブラリなどにサービスが注入されます。<p class="paragraph"/><div class="hidden-block">As an example, given a service called <code>BookService</code>, if you define a property called <code>bookService</code> in a controller as follows:</div>
例として、<code>BookService</code>というサービスが与えられた場合、次のようにコントローラの中に<code>bookService</code>という名前のプロパティを配置します:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def bookService
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case, the Spring container will automatically inject an instance of that service based on its configured scope. All dependency injection is done by name. You can also specify the type as follows:</div>
この場合、Springコンテナが設定されたスコープに基づいてサービスのインスタンスを自動的に注入します。すべての依存性の注入は、名前によって行われます。次のように型を指定することもできます:<p class="paragraph"/><div class="code"><pre>class AuthorService &#123;
    BookService bookService
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">NOTE: Normally the property name is generated by lower casing the first letter of the type.  For example, an instance of the <code>BookService</code> class would map to a property named <code>bookService</code>.</div>
注:通常、プロパティ名は、型の最初の文字を小文字のにして生成します。たとえば、<code>BookService</code>クラスのインスタンスは、<code>bookService</code>という名前のプロパティにマップされます。<p class="paragraph"/><div class="hidden-block">To be consistent with standard JavaBean conventions, if the first 2 letters of the class name are upper case, the property name is the same as the class name.  For example, the property name of the <code>JDBCHelperService</code> class would be <code>JDBCHelperService</code>, not <code>jDBCHelperService</code> or <code>jdbcHelperService</code>.</div>
標準のJavaBean規約と整合をとるため、クラス名の最初の2文字が大文字の場合、プロパティ名はクラス名と同じになります。たとえば<code>JDBCHelperService</code>クラスは、<code>jDBCHelperService</code>また<code>jdbcHelperService</code>では無く、<code>JDBCHelperService</code>という名前のプロパティにマップされます。<p class="paragraph"/><div class="hidden-block">See section 8.8 of the JavaBean specification for more information on de-capitalization rules.</div>
小文字への変換規則の詳細については、JavaBeanの仕様のセクション8.8を参照してください。
</blockquote><p class="paragraph"/><h4>依存性注入とサービス <div class="hidden-block">Dependency Injection and Services </div></h4><p class="paragraph"/><div class="hidden-block">You can inject services in other services with the same technique. If you had an <code>AuthorService</code> that needed to use the <code>BookService</code>, declaring the <code>AuthorService</code> as follows would allow that:</div>
同じ方法で他のサービスにサービスを注入することができます。たとえば、<code>AuthorService</code>が<code>BookService</code>使用する場合、 次のように<code>AuthorService</code>を宣言することで使用することができます:<p class="paragraph"/><div class="code"><pre>class AuthorService &#123;
    def bookService
&#125;</pre></div><p class="paragraph"/><h4>依存性注入とドメインクラス/タグライブラリ <div class="hidden-block">Dependency Injection and Domain Classes / Tag Libraries </div></h4><p class="paragraph"/><div class="hidden-block">You can even inject services into domain classes and tag libraries, which can aid in the development of rich domain models and views:</div>
ドメインクラスとタグライブラリにもサービスを注入することでき、豊富なドメインモデルやビューの開発を支援することができます:<p class="paragraph"/><div class="code"><pre>class Book &#123;
    &#8230;
    def bookService<p class="paragraph"/>    def buyBook() &#123;
        bookService.buyBook(<span class="java&#45;keyword">this</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Service Bean Names</h4><p class="paragraph"/>The default bean name which is associated with a service can be problematic if there are multiple services with the same name defined in different packages.  For example consider the situation where an application defines a service class named <code>com.demo.ReportingService</code> and the application uses a plugin named <code>ReportingUtilities</code> and that plugin provides a service class named <code>com.reporting.util.ReportingService</code>.  The default bean name for each of those would be <code>reportingService</code> so they would conflict with each other.  Grails manages this by changing the default bean name for services provided by plugins by prefixing the bean name with the plugin name.  In the scenario described above the <code>reportingService</code> bean would be an instance of the <code>com.demo.ReportingService</code> class defined in the application and the <code>reportingUtilitiesReportingService</code> bean would be an instance of the <code>com.reporting.util.ReportingService</code> class provided by the <code>ReportingUtilities</code> plugin.  For all service beans provided by plugins, if there are no other services with the same name within the application or other plugins in the application then a bean alias will be created which does not include the plugin name and that alias points to the bean referred to by the name that does include the plugin name prefix.  For example, if the <code>ReportingUtilities</code> plugin provides a service named <code>com.reporting.util.AuthorService</code> and there is no other <code>AuthorService</code> in the application or in any of the plugins that the application is using then there will be a bean named <code>reportingUtilitiesAuthorService</code> which is an instance of this <code>com.reporting.util.AuthorService</code> class and there will be a bean alias defined in the context named <code>authorService</code> which points to that same bean.


<a name="11.4 Using Services from Java"><!-- Legacy link --></a>
<h2 id="usingServicesFromJava">11.4 Javaからサービスを使う</h2>
<div class="hidden-block">One of the powerful things about services is that since they encapsulate re-usable logic, you can use them from other classes, including Java classes. There are a couple of ways you can reuse a service from Java. The simplest way is to move your service into a package within the <code>grails-app/services</code> directory. The reason this is important is that it is not possible to import classes into Java from the default package (the package used when no package declaration is present). So for example the <code>BookService</code> below cannot be used from Java as it stands:</div>
サービスについての強力な事の一つは、サービスは再利用可能なロジックをカプセル化するため、Javaのクラスを含む他のクラスからサービスを使用することができるということです。Javaからサービスを再利用する方法はいくつかあります。最も簡単な方法は、<code>grails-app/services</code>ディレクトリ下で、パッケージの中にサービスを移動することです。これが重要な手順である理由は、デフォルトパッケージ(パッケージの宣言がない場合に使用されるパッケージ)からJavaにクラスをインポートできないからです。したがって、たとえば以下の<code>BookService</code>は、そのままではJavaから使用できません:<p class="paragraph"/><div class="code"><pre>class BookService &#123;
    void buyBook(Book book) &#123;
        // logic
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">However, this can be rectified by placing this class in a package, by moving the class into a sub directory such as <code>grails-app/services/bookstore</code> and then modifying the package declaration:</div>
しかし、このクラスをパッケージの中に置き、<code>grails-app/services/bookstore</code>といったサブディレクトリの中にクラスを移動し、パッケージ宣言を修正することで、是正できます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> bookstore<p class="paragraph"/>class BookService &#123;
    void buyBook(Book book) &#123;
        // logic
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">An alternative to packages is to instead have an interface within a package that the service implements:</div>
パッケージに代わる別の方法として、パッケージ内のインターフェイスをサービスが実装することです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> bookstore<p class="paragraph"/><span class="java&#45;keyword">interface</span> BookStore &#123;
    void buyBook(Book book)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">And then the service:</div>
そしてサービスは:<p class="paragraph"/><div class="code"><pre>class BookService <span class="java&#45;keyword">implements</span> bookstore.BookStore &#123;
    void buyBook(Book b) &#123;
        // logic
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This latter technique is arguably cleaner, as the Java side only has a reference to the interface and not to the implementation class (although it's always a good idea to use packages). Either way, the goal of this exercise to enable Java to statically resolve the class (or interface) to use, at compile time.</div>
この後者の方法の方が、間違いなくクリーンです。Java側は、実装クラスではなくインタフェースへの参照を持てばよいからです。いずれにせよ、この実行の目的は、Javaがコンパイル時に使用するクラス(またはインターフェイス)を静的に解決できるようにすることです。<p class="paragraph"/><div class="hidden-block">Now that this is done you can create a Java class within the <code>src/java</code> directory and add a setter that uses the type and the name of the bean in Spring:</div>
これで、<code>src/java</code>ディレクトリのパッケージにJavaクラスを作ることができ、Springビーンの型と名前を使うセッターを提供することができます:<p class="paragraph"/><div class="code"><pre>// src/java/bookstore/BookConsumer.java
<span class="java&#45;keyword">package</span> bookstore;<p class="paragraph"/><span class="java&#45;keyword">public</span> class BookConsumer &#123;<p class="paragraph"/>    <span class="java&#45;keyword">private</span> BookStore store;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setBookStore(BookStore storeInstance) &#123;
        <span class="java&#45;keyword">this</span>.store = storeInstance;
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Once this is done you can configure the Java class as a Spring bean in <code>grails-app/conf/spring/resources.xml</code> (for more information see the section on <a href="../guide/single.html#spring" class="guide">Grails and Spring</a>):</div>
一度こうすることで、<code>grails-app/conf/spring/resources.xml</code>の中にSpringビーンとしてJavaクラスを設定することができます(詳細は、<a href="../guide/single.html#spring" class="guide">GrailsとSpring</a>セクションを参照してください)<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;bean id=<span class="xml&#45;quote">"bookConsumer"</span> class=<span class="xml&#45;quote">"bookstore.BookConsumer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"bookStore"</span> ref=<span class="xml&#45;quote">"bookService"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/bean&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">or in <code>grails-app/conf/spring/resources.groovy</code>:</div>
または、 <code>grails-app/conf/spring/resources.groovy</code>に:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> bookstore.BookConsumer<p class="paragraph"/>beans = &#123;
    bookConsumer(BookConsumer) &#123;
        bookStore = ref(<span class="java&#45;quote">"bookService"</span>)
    &#125;
&#125;</pre></div>


<a name="12. Testing"><!-- Legacy link --></a>
<h1 id="testing">12 テスト</h1>
<div class="hidden-block">Automated testing is a key part of Grails. Hence, Grails provides many ways to making testing easier from low level unit testing to high level functional tests. This section details the different capabilities that Grails offers for testing.</div>
自動化テストはGrailsにおいて重要な機能です。Grailsではユニットテストからファンクショナルテストまで、簡単にテスト生成できる様々な方法を提供しています。この章ではGrailsがテストのために提供している機能について詳しく説明します。<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Grails 1.3.x and below used the <code>grails.test.GrailsUnitTestCase</code> class hierarchy for testing in a JUnit 3 style. Grails 2.0.x and above deprecates these test harnesses in favour of mixins that can be applied to a range of different kinds of tests (JUnit 3, Junit 4, Spock etc.) without subclassing
</blockquote></div>
<blockquote class="note">
Grails 1.3.X以下のバージョンでは、JUnit 3スタイルのテストのために<code>grails.test.GrailsUnitTestCase</code>のクラスを継承するようになっていましたが、Grails 2.0.X 以上のバージョンではサブクラスを作ることなく異なる種類のテスト(Junit 3, Junit4, Spock など)を実施可能なMixinsベースのテストを推奨しています。
</blockquote><p class="paragraph"/><div class="hidden-block">The first thing to be aware of is that all of the <code>create-&#42;</code> and <code>generate-&#42;</code> commands create <code>unit</code> or <code>integration</code> tests automatically. For example if you run the <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a> command as follows:</div>
まずはじめに全ての<code>create-&#42;</code>や<code>generate-&#42;</code>のコマンドは<code>unit</code>もしくは<code>integration</code>テストを自動的に生成します。例えば、<a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a>コマンドを以下のように実行したとします。:<p class="paragraph"/><div class="code"><pre>grails create&#45;controller com.acme.app.simple</pre></div><p class="paragraph"/><div class="hidden-block">Grails will create a controller at <code>grails-app/controllers/com/acme/app/SimpleController.groovy</code>, and also a unit test at <code>test/unit/com/acme/app/SimpleControllerTests.groovy</code>. What Grails won't do however is populate the logic inside the test! That is left up to you.</div>
Grailsは<code>grails-app/controllers/com/acme/app/SimpleController.groovy</code>にコントローラを、<code>test/unit/com/acme/app/SimpleControllerTests.groovy</code>にユニットテストを作ります。しかしながら、Grailsはテストの中のロジックは作成しません！それはあなたに任されています。<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
The default class name suffix is <code>Tests</code> but as of Grails 1.2.2, the suffix of <code>Test</code> is also supported.
</blockquote></div>
<blockquote class="note">
デフォルトのクラス名の最後には<code>Tests</code>を付けます。しかし、Grails 1.2.2からは<code>Test</code>のサフィックスもサポートしています。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Running Tests</div>
<h4>テストの実行</h4><p class="paragraph"/><div class="hidden-block">Tests are run with the <a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a> command:</div>
テストは<a href="../ref/Command Line/test-app.html" class="commandLine">test-app</a>コマンドにより実行されます。:<p class="paragraph"/><div class="code"><pre>grails test&#45;app</pre></div><p class="paragraph"/><div class="hidden-block">The command will produce output such as:</div>
このコマンドは以下のような出力を行います。:<p class="paragraph"/><div class="code"><pre>&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
Running Unit Tests&#8230;
Running test FooTests...FAILURE
Unit Tests Completed in 464ms &#8230;
&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;<p class="paragraph"/>Tests failed: 0 errors, 1 failures</pre></div><p class="paragraph"/><div class="hidden-block">whilst showing the reason for each test failure.</div>
それぞれのテストの失敗理由が表示されます。<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
You can force a clean before running tests by passing <code>-clean</code> to the <code>test-app</code> command.
</blockquote></div>
<blockquote class="note">
<code>test-app</code>コマンドに<code>-clean</code>を付与することにより、テスト実行前に強制的にテスト実行環境をクリーンにすることができます。
</blockquote><p class="paragraph"/><div class="hidden-block">Grails writes both plain text and HTML test reports to the <code>target/test-reports</code> directory, along with the original XML files. The HTML reports are generally the best ones to look at.</div>
Grailsは<code>target/test-reports</code>ディレクトリにオリジナルのXMLファイルとともにプレインテキストとHTMLのテストレポートの両方を出力します。最も見栄えがよいのはHTMLレポートです。<p class="paragraph"/><div class="hidden-block">Using Grails' <a href="../guide/single.html#interactiveMode" class="guide">interactive mode</a> confers some distinct advantages when executing tests. First, the tests will execute significantly faster on the second and subsequent runs. Second, a shortcut is available to open the HTML reports in your browser:</div>
Grailsの<a href="../guide/single.html#interactiveMode" class="guide">対話モード</a>をテスト実行時に使うことにはいくつかのメリットがあります。まず2回目以降のテスト実行が大幅に高速化されます。次にHTMLレポートをブラウザで開くショートカットが利用可能になります。:<p class="paragraph"/><div class="code"><pre>open test&#45;report</pre></div><p class="paragraph"/><div class="hidden-block">You can also run your unit tests from within most IDEs.</div>
またほとんどのIDEで<code>unit</code>テストを実行できます。<p class="paragraph"/><div class="hidden-block">h4. Targeting Tests</div>
<h4>テストを指定する</h4><p class="paragraph"/><div class="hidden-block">You can selectively target the test(s) to be run in different ways. To run all tests for a controller named <code>SimpleController</code> you would run:</div>
いくつかのやり方でテストを指定することができます。<code>SimpleController</code>と名付けられたコントローラの全てのテストを実行したい場合には以下のように指定します。:<p class="paragraph"/><div class="code"><pre>grails test&#45;app SimpleController</pre></div><p class="paragraph"/><div class="hidden-block">This will run any tests for the class named <code>SimpleController</code>. Wildcards can be used...</div>
以下のコマンドは<code>SimpleController</code>という名前に対応する全てのテストを実行します。ワイルドカードを利用することも可能です。:<p class="paragraph"/><div class="code"><pre>grails test&#45;app &#42;Controller</pre></div><p class="paragraph"/><div class="hidden-block">This will test all classes ending in <code>Controller</code>. Package names can optionally be specified...</div>
以下は<code>Controller</code>でクラス名が終わる全てのクラスのテストを実行します。パッケージ名も指定可能です。<p class="paragraph"/><div class="code"><pre>grails test&#45;app some.org.&#42;Controller</pre></div><p class="paragraph"/><div class="hidden-block">or to run all tests in a package...</div>
この例では、パッケージ内の全てのテストを実行します。<p class="paragraph"/><div class="code"><pre>grails test&#45;app some.org.&#42;</pre></div><p class="paragraph"/><div class="hidden-block">or to run all tests in a package including subpackages...</div>
この例では、あるサブパッケージを含むパッケージの全てのテストを実行します。<p class="paragraph"/><div class="code"><pre>grails test&#45;app some.org.&#42;&#42;.&#42;</pre></div><p class="paragraph"/><div class="hidden-block">You can also target particular test methods...</div>
特定のテストメソッドだけを指定することもできます。<p class="paragraph"/><div class="code"><pre>grails test&#45;app SimpleController.testLogin</pre></div><p class="paragraph"/><div class="hidden-block">This will run the <code>testLogin</code> test in the <code>SimpleController</code> tests. You can specify as many patterns in combination as you like...</div>
以下のコマンドは<code>SimpleController</code>テストの中にある<code>testLogin</code>テストを実行します。いくつかのパターンを組合せて好きなように指定できます。<p class="paragraph"/><div class="code"><pre>grails test&#45;app some.org.&#42; SimpleController.testLogin BookController</pre></div><p class="paragraph"/><div class="hidden-block">h4. Targeting Test Types and/or Phases</div>
<h4>テスト種別とテストフェーズの条件によるテストの指定</h4><p class="paragraph"/><div class="hidden-block">In addition to targeting certain tests, you can also target test  <em class="italic">types</em>  and/or  <em class="italic">phases</em>  by using the <code>phase:type</code> syntax.</div>
あるテストを指定するのに加えて、<code>テストフェーズ:テスト種別</code>の記法により  <em class="italic">テスト種別</em>  と  <em class="italic">テストフェーズ</em>  を条件として指定できます。<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
Grails organises tests by phase and by type. A test phase relates to the state of the Grails application during the tests, and the type relates to the testing mechanism.<p class="paragraph"/>Grails comes with support for 4 test phases (<code>unit</code>, <code>integration</code>, <code>functional</code> and <code>other</code>) and JUnit test types for the <code>unit</code> and <code>integration</code> phases. These test types have the same name as the phase.<p class="paragraph"/>Testing plugins may provide new test phases or new test types for existing phases. Refer to the plugin documentation.
</blockquote></div>
<blockquote class="note">
Grailsはテストフェーズとテスト種別によりテストを体系化しています。テストフェーズはGrailsアプリケーションにおけるどの状態のテストを行っているかを表しており、テスト種別はテストを行う機構に関連しています。<p class="paragraph"/>Grailsは4つのテストフェーズ(<code>unit</code>, <code>integration</code>, <code>functional</code>そして<code>other</code>)と<code>unit</code>と<code>integration</code>の各テストフェーズに対応したJUnitのテスト種別をサポートしています。これらのテスト種別はそのテストフェーズと同じ名前になっています。<p class="paragraph"/>テストプラグインにより既存のテストフェーズに新しいテストフェーズもしくはテスト種別を追加することができます。詳しくはプラグインのドキュメントを参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">To execute the JUnit <code>integration</code> tests you can run:</div>
JUnitの<code>integration</code>テストを実行するには以下のように実行します:<p class="paragraph"/><div class="code"><pre>grails test&#45;app integration:integration</pre></div><p class="paragraph"/><div class="hidden-block">Both <code>phase</code> and <code>type</code> are optional. Their absence acts as a wildcard. The following command will run all test types in the <code>unit</code> phase:</div>
<code>テストフェーズ</code>と<code>テスト種別</code>の指定は任意です。もし指定をしなかった場合には全てが該当します。以下のコマンドでは<code>unit</code>テストフェーズの全てのテスト種別のテストを実行します。:<p class="paragraph"/><div class="code"><pre>grails test&#45;app unit:</pre></div><p class="paragraph"/><div class="hidden-block">The Grails <a href="http://grails.org/plugin/spock" target="blank">Spock Plugin</a> is one plugin that adds new test types to Grails. It adds a <code>spock</code> test type to the <code>unit</code>, <code>integration</code> and <code>functional</code> phases. To run all spock tests in all phases you would run the following:</div>
Grails <a href="http://grails.org/plugin/spock" target="blank">Spockプラグイン</a>プラグインを用いることでGrailsで新しいテスト種別が使えるようになります。<code>spock</code>テスト種別が<code>unit</code>、<code>integration</code>そして<code>functional</code>テストフェーズで使えるようになります。全てのテストフェーズで全ての<code>spock</code>テストを実行するには次のように実行します。:<p class="paragraph"/><div class="code"><pre>grails test&#45;app :spock</pre></div><p class="paragraph"/><div class="hidden-block">To run the all of the spock tests in the <code>functional</code> phase you would run...</div>
<code>functional</code>フェーズの全ての<code>spock</code>テストを実行するには次のように実行します。<p class="paragraph"/><div class="code"><pre>grails test&#45;app functional:spock</pre></div><p class="paragraph"/><div class="hidden-block">More than one pattern can be specified...</div>
1つ以上のテストパターンを指定できます。<p class="paragraph"/><div class="code"><pre>grails test&#45;app unit:spock integration:spock</pre></div><p class="paragraph"/><div class="hidden-block">h4. Targeting Tests in Types and/or Phases</div>
<h4>テスト種別とテストフェーズを用いたテストの指定</h4><p class="paragraph"/><div class="hidden-block">Test and type/phase targetting can be applied at the same time:</div>
名前によるテスト指定と、テスト種別やテストフェーズによるテスト指定は同時に適応可能です。:<p class="paragraph"/><div class="code"><pre>grails test&#45;app integration: unit: some.org.&#42;&#42;.&#42;</pre></div><p class="paragraph"/><div class="hidden-block">This would run all tests in the <code>integration</code> and <code>unit</code> phases that are in the package <code>some.org</code> or a subpackage.</div>
この例では、<code>some.org</code>のパッケージかサブパッケージの中で<code>integration</code>と<code>unit</code>フェーズの全てのテストが実行されるでしょう。

<a name="12.1 Unit Testing"><!-- Legacy link --></a>
<h2 id="unitTesting">12.1 ユニットテスト</h2>
<div class="hidden-block">
Unit testing are tests at the "unit" level. In other words you are testing individual methods or blocks of code without consideration for surrounding infrastructure. Unit tests are typically run without the presence of physical resources that involve I/O such databases, socket connections or files. This is to ensure they run as quick as possible since quick feedback is important.
</div><p class="paragraph"/>Unitテストは"単体"レベルのテストです。具体的には、環境周りを考慮せずに個々のメソッドやブロック単位で行うテストのことです。Unitテストは基本的にデータベース、ネットワーク接続、ファイルなどのI/Oを必要とする物理リソースを必要としません。素早いフィードバックを得られるように、Unitテストの実行時間はできる限り短くしてください。<p class="paragraph"/><div class="hidden-block">
<h4>The Test Mixins</h4>
</div><p class="paragraph"/><h4>テストMixin</h4><p class="paragraph"/><div class="hidden-block">
Since Grails 2.0, a collection of unit testing mixins is provided by Grails that lets you enhance the behavior of a typical JUnit 3, JUnit 4 or Spock test. The following sections cover the usage of these mixins.
</div><p class="paragraph"/>Grails 2.0以降、MixinのUnitテストライブラリがGrailsによって提供されており、代表的なJUnit 3、JUnit 4、Spockを使用したテストの実行をサポートします。以下の節では、Mixinの使い方について記載しています。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The previous JUnit 3-style <code>GrailsUnitTestCase</code> class hierarchy is still present in Grails for backwards compatibility, but is now deprecated. The previous documentation on the subject can be found in the <a href="http://grails.org/doc/1.3.x/guide/9.%20Testing.html" target="blank">Grails 1.3.x documentation</a>
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
以前の<code>GrailsUnitTestCase</code>クラスを継承するJUnit 3スタイルは、下位バージョンとの互換性のためにGrailsにまだ存在しています。しかし今は非推奨です。過去のドキュメントは<a href="http://grails.org/doc/1.3.x/guide/9.%20Testing.html" target="blank">Grails 1.3.x ドキュメンテーション</a>で見つけることができます。
</blockquote><p class="paragraph"/><div class="hidden-block">
You won't normally have to import any of the testing classes because Grails does that for you. But if you find that your IDE for example can't find the classes, here they all are:
</div><p class="paragraph"/>Grailsは自動でテストクラスをインポートするため、全てのテストクラスをインポートしなくても問題ありません。しかし、IDEでテストクラスを探せないことがあるかもしれないので、下記にそれらすべてのテストクラスを列挙します。
<ul class="star">
<li><code>grails.test.mixin.TestFor</code></li>
<li><code>grails.test.mixin.TestMixin</code></li>
<li><code>grails.test.mixin.Mock</code></li>
<li><code>grails.test.mixin.support.GrailsUnitTestMixin</code></li>
<li><code>grails.test.mixin.domain.DomainClassUnitTestMixin</code></li>
<li><code>grails.test.mixin.services.ServiceUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.ControllerUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.FiltersUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.GroovyPageUnitTestMixin</code></li>
<li><code>grails.test.mixin.web.UrlMappingsUnitTestMixin</code></li>
<li><code>grails.test.mixin.webflow/WebFlowUnitTestMixin</code></li>
</ul><p class="paragraph"/><div class="hidden-block">
Note that you're only ever likely to use the first two explicitly. The rest are there for reference. 
</div>
常に明示的に使うのは最初の２つのクラスだけであることに注意してください。残りはリファレンスのために列挙しています。<p class="paragraph"/><div class="hidden-block">
<h4>Test Mixin Basics</h4>
</div><p class="paragraph"/><h4>テストMixinの基本</h4><p class="paragraph"/><div class="hidden-block">
Most testing can be achieved via the <code>TestFor</code> annotation in combination with the <code>Mock</code> annotation for mocking collaborators. For example, to test a controller and associated domains you would define the following:
</div><p class="paragraph"/>ほとんどのテストは、モックを使用するため<code>Mock</code>アノテーションと<code>TestFor</code>アノテーションを組み合わせて使用します。例えば、コントローラーとドメインをテストするためには次のように定義します。<p class="paragraph"/><div class="code"><pre>&#64;TestFor(BookController)
&#64;Mock(&#91;Book, Author, BookService&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>TestFor</code> annotation defines the class under test and will automatically create a field for the type of class under test. For example in the above case a "controller" field will be present, however if <code>TestFor</code> was defined for a service a "service" field would be created and so on.
</div><p class="paragraph"/><code>TestFor</code>アノテーションは、テスト対象のクラスを定義することで自動的にクラスタイプのフィールドを生成します。例えば、上記の場合、"controller"フィールドを生成します。また、もし<code>TestFor</code>にサービスが定義されている場合、"service"フィールドが生成されます。<p class="paragraph"/><div class="hidden-block">
The <code>Mock</code> annotation creates mock version of any collaborators. There is an in-memory implementation of GORM that will simulate most interactions with the GORM API. For those interactions that are not automatically mocked you can use the built in support for defining mocks and stubs programmatically. For example:
</div><p class="paragraph"/><code>Mock</code>アノテーションは複数の種類のモックを生成します。ほとんどのGORM APIの振る舞いをシミュレートするインメモリのGORM実装があります。自動でモック化されない振る舞いに対しては、ビルトインされているモック、スタブの作成機能が使用できます。例えば、次の通りです。<p class="paragraph"/>
<div class="code"><pre>void testSearch() &#123;
      def control = mockFor(SearchService)
      control.demand.searchWeb &#123; <span class="java&#45;object">String</span> q &#45;&#62; &#91;'mock results'&#93; &#125;
      control.demand.<span class="java&#45;keyword">static</span>.logResults &#123; List results &#45;&#62;  &#125;
      controller.searchService = control.createMock()
      controller.search()<p class="paragraph"/>      assert controller.response.text.contains <span class="java&#45;quote">"Found 1 results"</span>
&#125;</pre></div>


<a name="12.1.1 Unit Testing Controllers"><!-- Legacy link --></a>
<h2 id="unitTestingControllers">12.1.1 コントローラのユニットテスト</h2>
<div class="hidden-block">
<h4>The Basics</h4>
</div><p class="paragraph"/><h4>基本</h4><p class="paragraph"/><div class="hidden-block">
You use the <code>grails.test.mixin.TestFor</code> annotation to unit test controllers. Using <code>TestFor</code> in this manner activates the <code>grails.test.mixin.web.ControllerUnitTestMixin</code> and its associated API. For example:
</div><p class="paragraph"/>コントローラUnitテストには、<code>grails.test.mixin.TestFor</code>アノテーションを使用します。このように<code>TestFor</code>を使用することで、<code>grails.test.mixin.web.ControllerUnitTestMixin</code>とその関連APIが有効になります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.TestFor<p class="paragraph"/>@TestFor(SimpleController)
class SimpleControllerTests &#123;
    void testSomething() &#123;<p class="paragraph"/>    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Adding the <code>TestFor</code> annotation to a controller causes a new <code>controller</code> field to be automatically created for the controller under test.
</div><p class="paragraph"/><code>TestFor</code>アノテーションにコントローラを追加することにより、<code>controller</code>フィールドにテスト対象のコントローラが自動的に生成されます。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The <code>TestFor</code> annotation will also automatically annotate any public methods starting with "test" with JUnit 4's @Test annotation. If any of your test method don't start with "test" just add this manually
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
<code>TestFor</code>アノテーションは"test"から始まるパブリックなメソッドに自動的にJUnit4の<code>Testアノテーションを付与します。もしテストメソッドが"test"で始まらない場合は</code>Testアノテーションを手動で付与してください。
</blockquote><p class="paragraph"/><div class="hidden-block">
To test the simplest "Hello World"-style example you can do the following:
</div><p class="paragraph"/>最もシンプルなHello World形式のテストは次の通りです。<p class="paragraph"/><div class="code"><pre>// Test class
class SimpleController &#123;
    def hello() &#123;
        render <span class="java&#45;quote">"hello"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>void testHello() &#123;
    controller.hello()<p class="paragraph"/>    assert response.text == 'hello'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>response</code> object is an instance of <code>GrailsMockHttpServletResponse</code> (from the package <code>org.codehaus.groovy.grails.plugins.testing</code>) which extends Spring's <code>MockHttpServletResponse</code> class and has a number of useful methods for inspecting the state of the response.
</div><p class="paragraph"/><code>response</code>オブジェクトは、<code>GrailsMockHttpServletResponse</code>（<code>org.codehaus.groovy.grails.plugins.testing</code>パッケージに含まれている）のインスタンスです。Springの<code>MockHttpServletResponse</code>クラスを継承しており、レスポンスの状態を調べる便利なメソッドを定義しています。<p class="paragraph"/><div class="hidden-block">
For example to test a redirect you can use the <code>redirectedUrl</code> property:
</div><p class="paragraph"/>例えば、リダイレクトをテストするには<code>redirectedUrl</code>プロパティを使用できます。<p class="paragraph"/><div class="code"><pre>// Test class
class SimpleController &#123;
    def index() &#123;
        redirect action: 'hello'
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>void testIndex() &#123;
    controller.index()<p class="paragraph"/>    assert response.redirectedUrl == '/simple/hello'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Many actions make use of the parameter data associated with the request. For example, the 'sort', 'max', and 'offset' parameters are quite common. Providing these in the test is as simple as adding appropriate values to a special <code>params</code> variable:
</div><p class="paragraph"/>ほとんどのアクションはリクエストに設定されたパラメータを使用します。例えば、'sort'、'max'、'offset'といったパラメータが一般的です。これらのパラメータをテストで利用するには<code>params</code>変数に値を代入するだけで簡単に設定できます。<p class="paragraph"/><div class="code"><pre>void testList() &#123;
    params.sort = <span class="java&#45;quote">"name"</span>
    params.max = 20
    params.offset = 0<p class="paragraph"/>    controller.list()
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can even control what type of request the controller action sees by setting the <code>method</code> property of the mock request:
</div><p class="paragraph"/>リクエストの<code>method</code>プロパティにリクエストタイプを設定することにより、リクエストタイプ毎のコントローラのアクションを確認できます。<p class="paragraph"/><div class="code"><pre>void testSave() &#123;
    request.method = <span class="java&#45;quote">"POST"</span>
    controller.save()
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This is particularly important if your actions do different things depending on the type of the request. Finally, you can mark a request as AJAX like so:
</div><p class="paragraph"/>リクエストタイプに応じてアクションが違った挙動をする場合、これは非常に重要です。さらに、次のようにAjaxとしてリクエストを作ることもできます。<p class="paragraph"/><div class="code"><pre>void testGetPage() &#123;
    request.method = <span class="java&#45;quote">"POST"</span>
    request.makeAjaxRequest()
    controller.getPage()
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You only need to do this though if the code under test uses the <code>xhr</code> property on the request.
</div><p class="paragraph"/>テスト対象コードのリクエストで<code>xhr</code>プロパティを使用してたとしても、これを実行するだけです。<p class="paragraph"/><div class="hidden-block">
<h4>Testing View Rendering</h4>
</div><p class="paragraph"/><h4>ビューのレンダリングテスト</h4><p class="paragraph"/><div class="hidden-block">
To test view rendering you can inspect the state of the controller's <code>modelAndView</code> property (an instance of <code>org.springframework.web.servlet.ModelAndView</code>) or you can use the <code>view</code> and <code>model</code> properties provided by the mixin:
</div><p class="paragraph"/>コントローラの<code>modelAndView</code>プロパティ（<code>org.springframework.web.servlet.ModelAndView</code>のインスタンス）、または、Mixinで提供されている<code>view</code>と<code>model</code>プロパティを使用することにより、ビューのレンダリングをテストすることができます。<p class="paragraph"/><div class="code"><pre>// Test class
class SimpleController &#123;
    def home() &#123;
        render view: <span class="java&#45;quote">"homePage"</span>, model: &#91;title: <span class="java&#45;quote">"Hello World"</span>&#93;
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>void testIndex() &#123;
    controller.home()<p class="paragraph"/>    assert view == <span class="java&#45;quote">"/simple/homePage"</span>
    assert model.title == <span class="java&#45;quote">"Hello World"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Note that the view string is the absolute view path, so it starts with a '/' and will include path elements, such as the directory named after the action's controller.
</div><p class="paragraph"/>viewの文字列は絶対パスであることに注意してください。これは、'/'から始まり、動作するコントローラの名前から決まるディレクトリ名などがパスとして含まれます。<p class="paragraph"/><div class="hidden-block">
<h4>Testing Template Rendering</h4>
</div><p class="paragraph"/><h4>テンプレートレンダリングテスト</h4><p class="paragraph"/><div class="hidden-block">
Unlike view rendering, template rendering will actually attempt to write the template directly to the response rather than returning a <code>ModelAndView</code> hence it requires a different approach to testing.
</div><p class="paragraph"/>テンプレートのレンダリングは<code>ModelAndView</code>を返すのではなく、レスポンスにテンプレートの内容を直接書き込みます。そのため、ビューのレンダリングとは異なるテストのアプローチが必要になります。<p class="paragraph"/><div class="hidden-block">
Consider the following controller action:
</div><p class="paragraph"/>次のコントローラアクションを見てください。<p class="paragraph"/><div class="code"><pre>class SimpleController &#123;
    def display() &#123;
        render template:<span class="java&#45;quote">"snippet"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this example the controller will look for a template in <code>grails-app/views/simple/_snippet.gsp</code>. You can test this as follows:
</div><p class="paragraph"/>この例では、コントローラは<code>grails-app/views/simple/_snippet.gsp</code>にあるテンプレートを探します。そして、次のようにテストをします。<p class="paragraph"/><div class="code"><pre>void testDisplay() &#123;
    controller.display()
    assert response.text == 'contents of template'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
However, you may not want to render the real template, but just test that is was rendered. In this case you can provide mock Groovy Pages:
</div><p class="paragraph"/>テンプレートをレンダリングしたくない場合にも、テストでは実際にテンプレートがレンダリングされます。このような場合はGroovy Pagesのモックが使用できます。<p class="paragraph"/><div class="code"><pre>void testDisplay() &#123;
    views&#91;'/simple/_snippet.gsp'&#93; = 'mock contents'
    controller.display()
    assert response.text == 'mock contents'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Actions Which Return A Map</h4>
</div><p class="paragraph"/><h4>マップを返すアクションをテスト</h4><p class="paragraph"/><div class="hidden-block">
When a controller action returns a <code>java.util.Map</code> that <code>Map</code> may be inspected directly to assert that it contains the expected data:
</div><p class="paragraph"/>コントローラアクションが<code>java.util.Map</code>を返す場合は、<code>Map</code>に期待したデータが含まれているか直接検証できます。<p class="paragraph"/><div class="code"><pre>class SimpleController &#123;
    def showBookDetails() &#123;
        &#91;title: 'The Nature Of Necessity', author: 'Alvin Plantinga'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.&#42;<p class="paragraph"/>@TestFor(SimpleController)
class SimpleControllerTests &#123;<p class="paragraph"/>    void testShowBookDetails() &#123;
        def model = controller.showBookDetails()<p class="paragraph"/>        assert model.author == 'Alvin Plantinga'
    &#125;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">
<h4>Testing XML and JSON Responses</h4>
</div><p class="paragraph"/><h4>XMLとJSONレスポンスのテスト</h4><p class="paragraph"/><div class="hidden-block">
XML and JSON response are also written directly to the response. Grails' mocking capabilities provide some conveniences for testing XML and JSON response. For example consider the following action:
</div><p class="paragraph"/>XMLとJSONのレスポンスもまた、直接レスポンスに書き込まれます。Grailsのモック機構は、XMLとJSONのレスポンスをテストするために便利な機能をいくつか提供しています。<p class="paragraph"/><div class="code"><pre>def renderXml() &#123;
    render(contentType:<span class="java&#45;quote">"text/xml"</span>) &#123;
        book(title:<span class="java&#45;quote">"Great"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This can be tested using the <code>xml</code> property of the response:
</div><p class="paragraph"/>次の例は、レスポンスの<code>xml</code>プロパティを使ってテストしています。<p class="paragraph"/><div class="code"><pre>void testRenderXml() &#123;
    controller.renderXml()
    assert <span class="java&#45;quote">"&#60;book title='Great'/&#62;"</span> == response.text
    assert <span class="java&#45;quote">"Great"</span> == response.xml.@title.text()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>xml</code> property is a parsed result from Groovy's <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy's+XmlSlurper" target="blank">XmlSlurper</a> class which is very convenient for parsing XML.
</div><p class="paragraph"/><code>xml</code>プロパティは、XMLをパースするためにとても便利なGroovyの<a href="http://groovy.codehaus.org/Reading+XML+using+Groovys+XmlSlurper" target="blank">XmlSlurper</a> でパースされた結果です。<p class="paragraph"/><div class="hidden-block">
Testing JSON responses is pretty similar, instead you use the <code>json</code> property:
</div><p class="paragraph"/><code>json</code>プロパティを使うだけで、JSONレスポンスのテストもかなり似ています。<p class="paragraph"/><div class="code"><pre>// controller action
def renderJson() &#123;
    render(contentType:<span class="java&#45;quote">"text/json"</span>) &#123;
        book = <span class="java&#45;quote">"Great"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// test
void testRenderJson() &#123;<p class="paragraph"/>    controller.renderJson()<p class="paragraph"/>    assert '&#123;<span class="java&#45;quote">"book"</span>:<span class="java&#45;quote">"Great"</span>&#125;' == response.text
    assert <span class="java&#45;quote">"Great"</span> == response.json.book
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>json</code> property is an instance of <code>org.codehaus.groovy.grails.web.json.JSONElement</code> which is a map-like structure that is useful for parsing JSON responses.
</div><p class="paragraph"/><code>json</code>プロパティは、JSONレスポンスをパースするために便利な<code>org.codehaus.groovy.grails.web.json.JSONElement</code>のインスタンスでマップライクな構造をもっています。<p class="paragraph"/><div class="hidden-block">
<h4>Testing XML and JSON Requests</h4>
</div><p class="paragraph"/><h4>XMLとJSONリクエストのテスト</h4><p class="paragraph"/><div class="hidden-block">
Grails provides various convenient ways to automatically parse incoming XML and JSON packets. For example you can bind incoming JSON or XML requests using Grails' data binding:
</div><p class="paragraph"/>Grailsは、入力されるXMLとJSONパケットを自動的にパースするためのいろいろな便利な方法を提供しています。例えば、入力されるJSONかXMLリクエストをGrailsのデータバインディングを使ってバインドできます。<p class="paragraph"/><div class="code"><pre>def consumeBook() &#123;
    def b = <span class="java&#45;keyword">new</span> Book(params&#91;'book'&#93;)<p class="paragraph"/>    render b.title
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
To test this Grails provides an easy way to specify an XML or JSON packet via the <code>xml</code> or <code>json</code> properties. For example the above action can be tested by specifying a String containing the XML:
</div><p class="paragraph"/>次のテストでは、<code>xml</code>や<code>json</code>プロパティを用いてXMLやJSONリクエストを設定しています。例えば、上記のアクションはXMLの文字列を設定することによってテストができます。<p class="paragraph"/><div class="code"><pre>void testConsumeBookXml() &#123;
    request.xml = '&#60;book&#62;&#60;title&#62;The Shining&#60;/title&#62;&#60;/book&#62;'
    controller.consumeBook()<p class="paragraph"/>    assert response.text == 'The Shining'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Or alternatively a domain instance can be specified and it will be auto-converted into the appropriate XML request:
</div><p class="paragraph"/>もしくは、ドメインインスタンスを設定することで、適切なXMLリクエストに自動変換してテストをします。<p class="paragraph"/><div class="code"><pre>void testConsumeBookXml() &#123;
    request.xml = <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Shining"</span>)
    controller.consumeBook()<p class="paragraph"/>    assert response.text == 'The Shining'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The same can be done for JSON requests:
</div><p class="paragraph"/>JSONリクエストでも同じようにテストできます。<p class="paragraph"/><div class="code"><pre>void testConsumeBookJson() &#123;
    request.json = <span class="java&#45;keyword">new</span> Book(title:<span class="java&#45;quote">"The Shining"</span>)
    controller.consumeBook()<p class="paragraph"/>    assert response.text == 'The Shining'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If you prefer not to use Grails' data binding but instead manually parse the incoming XML or JSON that can be tested too. For example consider the controller action below:
</div><p class="paragraph"/>もし、Grailsのデータバインディングを使用したくない場合は、入力されるXMLまたはJSONを手動でパースする必要がありますが、このような場合も同じようにテストできます。次のコントローラアクションを見てください。<p class="paragraph"/><div class="code"><pre>def consume() &#123;
    request.withFormat &#123;
        xml &#123;
            render request.XML.@title
        &#125;
        json &#123;
            render request.JSON.title
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
To test the XML request you can specify the XML as a string:
</div><p class="paragraph"/>XMLリクエストをテストするためには、XMLの文字列を設定します。<p class="paragraph"/><div class="code"><pre>void testConsumeXml() &#123;
    request.xml = '&#60;book title=<span class="java&#45;quote">"The Stand"</span> /&#62;'<p class="paragraph"/>    controller.consume()<p class="paragraph"/>    assert response.text == 'The Stand'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
And, of course, the same can be done for JSON:
</div><p class="paragraph"/>もちろん、同じことがJSONでもできます。<p class="paragraph"/><div class="code"><pre>void testConsumeJson() &#123;
    request.json = '&#123;title:<span class="java&#45;quote">"The Stand"</span>&#125;'
    controller.consume()<p class="paragraph"/>    assert response.text == 'The Stand'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Spring Beans</h4>
</div><p class="paragraph"/><h4>Springビーンのテスト</h4><p class="paragraph"/><div class="hidden-block">
When using <code>TestFor</code> only a subset of the Spring beans available to a running Grails application are available. If you wish to make additional beans available you can do so with the <code>defineBeans</code> method of <code>GrailsUnitTestMixin</code>:
</div><p class="paragraph"/><code>TestFor</code>を使用した場合は、Grailsアプリケーションを実行するのに必要なSpringビーンのサブセットだけが利用できます。もし、利用できるビーンを追加したい場合は、<code>GrailsUnitTestMixin</code>の<code>defineBeans</code>メソッドを使うことにより、ビーンを追加できます。<p class="paragraph"/><div class="code"><pre>class SimpleController &#123;
    SimpleService simpleService
    def hello() &#123;
        render simpleService.sayHello()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>void testBeanWiring() &#123;
    defineBeans &#123;
        simpleService(SimpleService)
    &#125;<p class="paragraph"/>    controller.hello()<p class="paragraph"/>    assert response.text == <span class="java&#45;quote">"Hello World"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The controller is auto-wired by Spring just like in a running Grails application. Autowiring even occurs if you instantiate subsequent instances of the controller:
</div><p class="paragraph"/>コントローラは実行中のGrailsアプリケーションのように、Springによって自動的にビーンが注入されます。もしコントローラを後でインスタンス化した場合も自動的に注入されます。<p class="paragraph"/><div class="code"><pre>void testAutowiringViaNew() &#123;
    defineBeans &#123;
        simpleService(SimpleService)
    &#125;<p class="paragraph"/>    def controller1 = <span class="java&#45;keyword">new</span> SimpleController()
    def controller2 = <span class="java&#45;keyword">new</span> SimpleController()<p class="paragraph"/>    assert controller1.simpleService != <span class="java&#45;keyword">null</span>
    assert controller2.simpleService != <span class="java&#45;keyword">null</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Mime Type Handling</h4>
</div><p class="paragraph"/><h4>MIME Typeの制御のテスト</h4><p class="paragraph"/><div class="hidden-block">
You can test mime type handling and the <code>withFormat</code> method quite simply by setting the response's <code>format</code> attribute:
</div><p class="paragraph"/>MIME Typeの制御と<code>withFormat</code>メソッドは、レスポンスの<code>format</code>属性を設定することにより簡単にテストができます。<p class="paragraph"/><div class="code"><pre>// controller action
def sayHello() &#123;
    def data = &#91;Hello:<span class="java&#45;quote">"World"</span>&#93;
    withFormat &#123;
        xml &#123; render data as XML &#125;
        html data
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// test
void testSayHello() &#123;
    response.format = 'xml'
    controller.sayHello()<p class="paragraph"/>    <span class="java&#45;object">String</span> expected = '&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"UTF&#45;8"</span>?&#62;' +
                      '&#60;map&#62;&#60;entry key=<span class="java&#45;quote">"Hello"</span>&#62;World&#60;/entry&#62;&#60;/map&#62;'<p class="paragraph"/>    assert expected == response.text
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Duplicate Form Submissions</h4>
</div><p class="paragraph"/><h4>フォームの２重送信テスト</h4><p class="paragraph"/><div class="hidden-block">
Testing duplicate form submissions is a little bit more involved. For example if you have an action that handles a form such as:
</div><p class="paragraph"/>フォームの２重送信のテストは少し複雑になります。例えば、次のようなフォームを処理するアクションがあるとします。<p class="paragraph"/><div class="code"><pre>def handleForm() &#123;
    withForm &#123;
        render <span class="java&#45;quote">"Good"</span>
    &#125;.invalidToken &#123;
        render <span class="java&#45;quote">"Bad"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
you want to verify the logic that is executed on a good form submission and the logic that is executed on a duplicate submission. Testing the bad submission is simple. Just invoke the controller:
</div><p class="paragraph"/>ここでフォームの送信が成功する場合と、２重送信となる場合のロジックを検証したいとします。２重送信となる場合のテストは、単にコントローラをすることで簡単に実行できます。<p class="paragraph"/><div class="code"><pre>void testDuplicateFormSubmission() &#123;
    controller.handleForm()
    assert <span class="java&#45;quote">"Bad"</span> == response.text
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Testing the successful submission requires providing an appropriate <code>SynchronizerToken</code>:
</div><p class="paragraph"/>フォームの送信が成功する場合のテストは適切な<code>SynchronizerToken</code>が必要となります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.web.servlet.mvc.SynchronizerToken
...<p class="paragraph"/>void testValidFormSubmission() &#123;
    def tokenHolder = SynchronizerTokensHolder.store(session)<p class="paragraph"/>    params&#91;SynchronizerTokensHolder.TOKEN_URI&#93; = '/controller/handleForm'
    params&#91;SynchronizerTokensHolder.TOKEN_KEY&#93; = tokenHolder.generateToken(params&#91;SynchronizerTokensHolder.TOKEN_URI&#93;)<p class="paragraph"/>    controller.handleForm()
    assert <span class="java&#45;quote">"Good"</span> == response.text
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
If you test both the valid and the invalid request in the same test be sure to reset the response between executions of the controller:
</div><p class="paragraph"/>もし、有効/無効のリクエストを両方ともテストしたい場合、コントローラのメソッド実行の間で、レスポンスをリセットしてください。<p class="paragraph"/><div class="code"><pre>controller.handleForm() // first execution
&#8230;
response.reset()
&#8230;
controller.handleForm() // second execution</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing File Upload</h4>
</div><p class="paragraph"/><h4>ファイルアップロードのテスト</h4><p class="paragraph"/><div class="hidden-block">
You use the <code>GrailsMockMultipartFile</code> class to test file uploads. For example consider the following controller action:
</div><p class="paragraph"/>ファイルアップロードをテストするためには、<code>GrailsMockMultipartFile</code>クラスを使います。例えば、次のコントローラアクションを見てください。<p class="paragraph"/><div class="code"><pre>def uploadFile() &#123;
    MultipartFile file = request.getFile(<span class="java&#45;quote">"myFile"</span>)
    file.transferTo(<span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/local/disk/myFile"</span>))
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
To test this action you can register a <code>GrailsMockMultipartFile</code> with the request:
</div><p class="paragraph"/>このアクションをテストするには、リクエストに<code>GrailsMockMultipartFile</code>を設定してください。<p class="paragraph"/><div class="code"><pre>void testFileUpload() &#123;
    <span class="java&#45;keyword">final</span> file = <span class="java&#45;keyword">new</span> GrailsMockMultipartFile(<span class="java&#45;quote">"myFile"</span>, <span class="java&#45;quote">"foo"</span>.bytes)
    request.addFile(file)
    controller.uploadFile()<p class="paragraph"/>    assert file.targetFileLocation.path == <span class="java&#45;quote">"/local/disk/myFile"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>GrailsMockMultipartFile</code> constructor arguments are the name and contents of the file. It has a mock implementation of the <code>transferTo</code> method that simply records the <code>targetFileLocation</code> and doesn't write to disk.
</div><p class="paragraph"/><code>GrailsMockMultipartFile</code>のコンストラクタの引数はファイル名とファイルの内容です。これは<code>transferTo</code>のモック実装をもっており、ファイルには書き込まずに<code>targetFileLocation</code>として値を保持します。<p class="paragraph"/><div class="hidden-block">
<h4>Testing Command Objects</h4>
</div><p class="paragraph"/><h4>Commnadオブジェクトのテスト</h4><p class="paragraph"/><div class="hidden-block">
Special support exists for testing command object handling with the <code>mockCommandObject</code> method. For example consider the following action:
</div><p class="paragraph"/><code>mockCommandObject</code>メソッドにはCommandオブジェクトの処理をテストするための特別な機能があります。例えば、次のアクションを見てください。<p class="paragraph"/><div class="code"><pre>def handleCommand(SimpleCommand simple) &#123;
    <span class="java&#45;keyword">if</span> (simple.hasErrors()) &#123;
        render <span class="java&#45;quote">"Bad"</span>
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
        render <span class="java&#45;quote">"Good"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
To test this you mock the command object, populate it and then validate it as follows:
</div><p class="paragraph"/>これをテストするために、次のようにCommandオブジェクトをモック化した上で、データを投入して検証してください。<p class="paragraph"/><div class="code"><pre>void testInvalidCommand() &#123;
    def cmd = mockCommandObject(SimpleCommand)
    cmd.name = '' // doesn't allow blank names<p class="paragraph"/>    cmd.validate()
    controller.handleCommand(cmd)<p class="paragraph"/>    assert response.text == 'Bad'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Calling Tag Libraries</h4>
</div><p class="paragraph"/><h4>タグライブラリの呼び出しテスト</h4><p class="paragraph"/><div class="hidden-block">
You can test calling tag libraries using <code>ControllerUnitTestMixin</code>, although the mechanism for testing the tag called varies from tag to tag. For example to test a call to the <code>message</code> tag, add a message to the <code>messageSource</code>. Consider the following action:
</div><p class="paragraph"/>タグごとに必要となるテストの方法は異なりますが、タグライブラリの呼びしは<code>ControllerUnitTestMixin</code>を使用することでテストできます。例えば、<code>message</code>タグを呼び出すテストでは、<code>messageSource</code>にメッセージを加えます。次のアクションを見てください。<p class="paragraph"/><div class="code"><pre>def showMessage() &#123;
    render g.message(code: <span class="java&#45;quote">"foo.bar"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This can be tested as follows:
</div><p class="paragraph"/>これは次のようにテストをします。<p class="paragraph"/><div class="code"><pre>void testRenderBasicTemplateWithTags() &#123;
    messageSource.addMessage(<span class="java&#45;quote">"foo.bar"</span>, request.locale, <span class="java&#45;quote">"Hello World"</span>)<p class="paragraph"/>    controller.showMessage()<p class="paragraph"/>    assert response.text == <span class="java&#45;quote">"Hello World"</span>
&#125;</pre></div>


<a name="12.1.2 Unit Testing Tag Libraries"><!-- Legacy link --></a>
<h2 id="unitTestingTagLibraries">12.1.2 タグライブラリのユニットテスト</h2>
<div class="hidden-block">
<h4>The Basics</h4>
</div><p class="paragraph"/><h4>基本</h4><p class="paragraph"/><div class="hidden-block">
Tag libraries and GSP pages can be tested with the <code>grails.test.mixin.web.GroovyPageUnitTestMixin</code> mixin. To use the mixin declare which tag library is under test with the <code>TestFor</code> annotation:
</div><p class="paragraph"/>タグライブラリとGSPは、<code>grails.test.mixin.web.GroovyPageUnitTestMixin</code>のMixinでテストできます。Mixinを使用するために、タグライブラリを<code>TestFor</code>アノテーションの中に宣言します。<p class="paragraph"/><div class="code"><pre>@TestFor(SimpleTagLib)
class SimpleTagLibTests &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Note that if you are testing invocation of a custom tag from a controller you can combine the <code>ControllerUnitTestMixin</code> and the <code>GroovyPageUnitTestMixin</code> using the <code>Mock</code> annotation:
</div><p class="paragraph"/>もし、コントローラからカスタムタグの呼び出しをテストする場合、<code>Mock</code>アノテーションを使用して<code>ControllerUnitTestMixin</code>と<code>GroovyPageUnitTestMixin</code>を組み合わせることができます。<p class="paragraph"/><div class="code"><pre>@TestFor(SimpleController)
@Mock(SimpleTagLib)
class GroovyPageUnitTestMixinTests &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Custom Tags</h4>
</div><p class="paragraph"/><h4>カスタムタグのテスト</h4><p class="paragraph"/><div class="hidden-block">
The core Grails tags don't need to be enabled during testing, however custom tag libraries do. The <code>GroovyPageUnitTestMixin</code> class provides a <code>mockTagLib()</code> method that you can use to mock a custom tag library. For example consider the following tag library:
</div><p class="paragraph"/>Grailsコアのタグはテスト中に有効にする必要はありませんが、カスタムタグライブラリは有効にする必要があります。<code>GroovyPageUnitTestMixin</code>クラスは、カスタムタグライブラリをモック化するために使える<code>mockTagLib()</code>メソッドを提供しています。<p class="paragraph"/><div class="code"><pre>class SimpleTagLib &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> namespace = 's'<p class="paragraph"/>    def hello = &#123; attrs, body &#45;&#62;
        out &#60;&#60; <span class="java&#45;quote">"Hello $&#123;attrs.name ?: 'World'&#125;"</span>
    &#125;<p class="paragraph"/>    def bye = &#123; attrs, body &#45;&#62;
        out &#60;&#60; <span class="java&#45;quote">"Bye $&#123;attrs.author.name ?: 'World'&#125;"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can test this tag library by using <code>TestFor</code> and supplying the name of the tag library:
</div><p class="paragraph"/><code>TestFor</code>を使用し、タグライブラリの名前を記載することによって、上記のタグライブラリをテストできます。<p class="paragraph"/><div class="code"><pre>@TestFor(SimpleTagLib)
class SimpleTagLibTests &#123;
    void testHelloTag() &#123;
        assert applyTemplate('&#60;s:hello /&#62;') == 'Hello World'
        assert applyTemplate('&#60;s:hello name=<span class="java&#45;quote">"Fred"</span> /&#62;') == 'Hello Fred'
        assert applyTemplate('&#60;s:bye author=<span class="java&#45;quote">"&#36;&#123;author&#125;"</span> /&#62;', &#91;author: <span class="java&#45;keyword">new</span> Author(name: 'Fred')&#93;) == 'Bye Fred'
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Alternatively, you can use the <code>TestMixin</code> annotation and mock multiple tag libraries using the <code>mockTagLib()</code> method:
</div><p class="paragraph"/>代わりに、<code>TestMixin</code>アノテーションと<code>mockTagLib()</code>メソッドにより、複数のタグライブラリをモック化することができます。<p class="paragraph"/><div class="code"><pre>@grails.test.mixin.TestMixin(GroovyPageUnitTestMixin)
class MultipleTagLibraryTests &#123;<p class="paragraph"/>    @Test
    void testMuliple() &#123;
        mockTagLib(FirstTagLib)
        mockTagLib(SecondTagLib)<p class="paragraph"/>        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>GroovyPageUnitTestMixin</code> provides convenience methods for asserting that the template output equals or matches an expected value.
</div><p class="paragraph"/><code>GroovyPageUnitTestMixin</code>はテンプレート出力が期待した値と同じであることを検証するために便利なメソッドを提供しています。<p class="paragraph"/><div class="code"><pre>@grails.test.mixin.TestMixin(GroovyPageUnitTestMixin)
class MultipleTagLibraryTests &#123;<p class="paragraph"/>    @Test
    void testMuliple() &#123;
        mockTagLib(FirstTagLib)
        mockTagLib(SecondTagLib)
        assertOutputEquals ('Hello World', '&#60;s:hello /&#62;')
        assertOutputMatches (/.&#42;Fred.&#42;/, '&#60;s:hello name=<span class="java&#45;quote">"Fred"</span> /&#62;')
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing View and Template Rendering</h4>
</div><p class="paragraph"/><h4>表示とテンプレートのレンダリングテスト</h4><p class="paragraph"/><div class="hidden-block">
You can test rendering of views and templates in <code>grails-app/views</code> via the <code>render(Map)</code> method provided by <code>GroovyPageUnitTestMixin</code> :
</div><p class="paragraph"/><code>GroovyPageUnitTestMixin</code>で提供されている<code>render(Map)</code>メソッドを使って<code>grails-app/views</code>内にあるビューとテンプレートのレンダリングをテストできます。<p class="paragraph"/><div class="code"><pre>def result = render(template: <span class="java&#45;quote">"/simple/hello"</span>)
assert result == <span class="java&#45;quote">"Hello World"</span></pre></div><p class="paragraph"/><div class="hidden-block">
This will attempt to render a template found at the location <code>grails-app/views/simple/_hello.gsp</code>. Note that if the template depends on any custom tag libraries you need to call <code>mockTagLib</code> as described in the previous section.
</div><p class="paragraph"/>これは、<code>grails-app/views/simple/_hello.gsp</code>に配置されているテンプレートをレンダリングします。もしテンプレートがいくつかのカスタムタグライブラリに依存している場合、前の節で記載した<code>mockTagLib</code>を呼び出す必要があります。


<a name="12.1.3 Unit Testing Domains"><!-- Legacy link --></a>
<h2 id="unitTestingDomains">12.1.3 ドメインのユニットテスト</h2>
<div class="hidden-block">
<h4>Overview</h4>
</div>
<h4>概要</h4><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
The mocking support described here is best used when testing non-domain artifacts that use domain classes, to let you focus on testing the artifact without needing a database. But when testing persistence it's best to use integration tests which configure Hibernate and use a database.
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
モック機能のサポートは、非ドメインクラスがドメインクラスを使用している場合に、データベースを必要とせず、テストに集中できるという意味では最適な方法です。しかし、ドメインの永続化のテストを行いたい場合はHibernateとデータベースを使用するIntegrationテストが最適な方法です。
</blockquote><p class="paragraph"/><div class="hidden-block">
Domain class interaction can be tested without involving a database connection using <code>DomainClassUnitTestMixin</code>. This implementation mimics the behavior of GORM against an in-memory <code>ConcurrentHashMap</code> implementation. Note that this has limitations compared to a real GORM implementation. The following features of GORM for Hibernate can only be tested within an integration test:
</div><p class="paragraph"/>ドメインクラスとしての振る舞いは<code>DomainClassUnitTestMixin</code>を使用することで、データベースを必要とせずにテストを行うことができます。この実装はGORMの振る舞いを擬似した、メモリ上の<code>ConcurrentHashMap</code>です。この実装は実際のGORMの動作と比べて制限があることに注意してください。以下のHibernateに対するGORMの機能はIntegrationテストでのみテストできます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>String-based HQL queries</li>
<li>composite identifiers</li>
<li>dirty checking methods</li>
<li>any direct interaction with Hibernate</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>文字列ベースのHQLクエリ</li>
<li>複合主キー</li>
<li>dirtyチェックメソッド</li>
<li>Hibernateの直接操作</li>
</ul><p class="paragraph"/><div class="hidden-block">
However a large, commonly-used portion of the GORM API can be mocked using <code>DomainClassUnitTestMixin</code> including:
</div><p class="paragraph"/>上記以外の、よく使用されるGORM APIの大部分は<code>DomainClassUnitTestMixin</code>を使用することでモック化することができます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Simple persistence methods like <code>save()</code>, <code>delete()</code> etc.</li>
<li>Dynamic Finders</li>
<li>Named Queries</li>
<li>Query-by-example</li>
<li>GORM Events</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>save()</code>や<code>delete()</code>といった永続化メソッド</li>
<li>ダイナミックファインダー</li>
<li>名前付きクエリ</li>
<li>Exampleによるクエリ</li>
<li>GORMのイベント</li>
</ul><p class="paragraph"/><div class="hidden-block">
If something isn't supported then <code>GrailsUnitTestMixin</code>'s <code>mockFor</code> method can come in handy to mock the missing pieces. Alternatively you can write an integration test which bootstraps the complete Grails environment at a cost of test execution time.
</div><p class="paragraph"/>もしサポートされてない部分があった場合でも、<code>GrailsUnitTestMixin</code>の<code>mockFor</code>メソッドを使用することで足りない部分をモック化することができます。または、テストの実行時間はかかりますが、完全にGrails環境が立ち上がるIntegrationテストを使用することもできます。<p class="paragraph"/><div class="hidden-block">
<h4>The Basics</h4>
</div><p class="paragraph"/><h4>基本</h4><p class="paragraph"/><div class="hidden-block">
<code>DomainClassUnitTestMixin</code> is typically used in combination with testing either a controller, service or tag library where the domain is a mock collaborator defined by the <code>Mock</code> annotation:
</div><p class="paragraph"/><code>DomainClassUnitTestMixin</code>は、通常コントローラやサービス、またはタグライブラリといった、<code>Mock</code>アノテーションでドメインがモックとして協調動作する必要がある場所で使用されます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.&#42;<p class="paragraph"/>@TestFor(SimpleController)
@Mock(Simple)
class SimpleControllerTests &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The example above tests the <code>SimpleController</code> class and mocks the behavior of the <code>Simple</code> domain class as well. For example consider a typical scaffolded <code>save</code> controller action:
</div><p class="paragraph"/>上記の例では<code>SimpleController</code>のテストで<code>Simple</code>ドメインクラスとして振る舞うモックを宣言しています。例えば典型的なスキャフォルドで生成されたコントローラの<code>save</code>アクションについて考えてみます。<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def save() &#123;
        def book = <span class="java&#45;keyword">new</span> Book(params)
        <span class="java&#45;keyword">if</span> (book.save(flush: <span class="java&#45;keyword">true</span>)) &#123;
            flash.message = message(
                    code: '<span class="java&#45;keyword">default</span>.created.message',
                    args: &#91;message(code: 'book.label',
                                   <span class="java&#45;keyword">default</span>: 'Book'), book.id&#93;)&#125;<span class="java&#45;quote">"
            redirect(action: "</span>show<span class="java&#45;quote">", id: book.id)
        &#125;
        <span class="java&#45;keyword">else</span> &#123;
            render(view: "</span>create", model: &#91;bookInstance: book&#93;)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Tests for this action can be written as follows:
</div><p class="paragraph"/>このアクションに対するテストは次のように書けます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.&#42;<p class="paragraph"/>@TestFor(BookController)
@Mock(Book)
class BookControllerTests &#123;<p class="paragraph"/>    void testSaveInvalidBook() &#123;
        controller.save()<p class="paragraph"/>        assert model.bookInstance != <span class="java&#45;keyword">null</span>
        assert view == '/book/create'
    &#125;<p class="paragraph"/>    void testSaveValidBook() &#123;
        params.title = <span class="java&#45;quote">"The Stand"</span>
        params.pages = <span class="java&#45;quote">"500"</span><p class="paragraph"/>        controller.save()<p class="paragraph"/>        assert response.redirectedUrl == '/book/show/1'
        assert flash.message != <span class="java&#45;keyword">null</span>
        assert Book.count() == 1
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<code>Mock</code> annotation also supports a list of mock collaborators if you have more than one domain to mock:
</div><p class="paragraph"/>複数のドメインのモックが必要な場合は<code>Mock</code>アノテーションにリストで指定することができます。<p class="paragraph"/><div class="code"><pre>@TestFor(BookController)
@Mock(&#91;Book, Author&#93;)
class BookControllerTests &#123;
   &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Alternatively you can also use the <code>DomainClassUnitTestMixin</code> directly with the <code>TestMixin</code> annotation:
</div><p class="paragraph"/>別の方法として<code>TestMixin</code>アノテーションに直接<code>DomainClassUnitTestMixin</code>を指定する方法もあります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.domain.DomainClassUnitTestMixin<p class="paragraph"/>@TestFor(BookController)
@TestMixin(DomainClassUnitTestMixin)
class BookControllerTests &#123;
   &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
And then call the <code>mockDomain</code> method to mock domains during your test:
</div><p class="paragraph"/>そしてテストの中でドメインをモック化する<code>mockDomain</code>メソッドを呼び出します。<p class="paragraph"/><div class="code"><pre>void testSave() &#123;
    mockDomain(Author)
    mockDomain(Book)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>mockDomain</code> method also includes an additional parameter that lets you pass a Map of Maps to configure a domain, which is useful for fixture-like data:
</div><p class="paragraph"/><code>mockDomain</code>メソッドは、ドメインを構築するマップの一覧を与えることで、データのフィクスチャを生成するような使い方もできます。<p class="paragraph"/><div class="code"><pre>void testSave() &#123;
    mockDomain(Book, &#91;
            &#91;title: <span class="java&#45;quote">"The Stand"</span>, pages: 1000&#93;,
            &#91;title: <span class="java&#45;quote">"The Shining"</span>, pages: 400&#93;,
            &#91;title: <span class="java&#45;quote">"Along Came a Spider"</span>, pages: 300&#93; &#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Testing Constraints</h4>
</div><p class="paragraph"/><h4>制約のテスト</h4><p class="paragraph"/><div class="hidden-block">
Your constraints contain logic and that logic is highly susceptible to bugs - the kind of bugs that can be tricky to track down (particularly as by default <code>save()</code> doesn't throw an exception when it fails). If your answer is that it's too hard or fiddly, that is no longer an excuse. Enter the <code>mockForConstraintsTests()</code> method.
</div><p class="paragraph"/>制約にロジックが含まれている場合は、そのロジックは非常にバグを生みやすく、またそのバグの追跡は簡単なものではありません(特にデフォルトで<code>save()</code>が処理が失敗した場合でも例外をスローしないということもあります)。もしそのような面倒な解析に時間を取られたくない場合は、<code>mockForConstraintsTests()</code>メソッドを使用してください。<p class="paragraph"/><div class="hidden-block">
This method is like a much reduced version of the <code>mockDomain()</code> method that simply adds a <code>validate()</code> method to a given domain class. All you have to do is mock the class, create an instance with populated data, and then call <code>validate()</code>. You can then access the <code>errors</code> property to determine if validation failed. So if all we are doing is mocking the <code>validate()</code> method, why the optional list of test instances? That is so that we can test the <code>unique</code> constraint as you will soon see.
</div><p class="paragraph"/>このメソッドは<code>mockDoman()</code>メソッドの縮小版のようなもので、単に与えられたドメインクラスに対して<code>validate()</code>メソッドを追加します。やるべきことはクラスをモック化し、必要なデータと共にインスタンスを生成して、<code>validate()</code>を呼び出すだけです。<code>errors</code>プロパティを参照することで、検証が失敗したかどうかを確かめられます。<p class="paragraph"/>また、なぜ<code>mockForConstraintsTests()</code>に追加でテスト用のインスタンスが指定できるようになっているのでしょうか？モック化された<code>validate</code>メソッドを呼ぶだけならば必要なさそうですが、これは<code>unique</code>制約のテストを行えるようにするためです。<p class="paragraph"/><div class="hidden-block">
So, suppose we have a simple domain class:
</div><p class="paragraph"/>次のようなドメインクラスがあったとします。<p class="paragraph"/><div class="code"><pre>class Book &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> title
    <span class="java&#45;object">String</span> author<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        title blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        author blank: <span class="java&#45;keyword">false</span>, minSize: 5
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Don't worry about whether the constraints are sensible (they're not!), they are for demonstration only. To test these constraints we can do the following:
</div><p class="paragraph"/>この制約は単なる例で、本来この制約が正しいかどうかは気にしないでください。この制約のテストは次のように行えます。<p class="paragraph"/><div class="code"><pre>@TestFor(Book)
class BookTests &#123;
    void testConstraints() &#123;<p class="paragraph"/>        def existingBook = <span class="java&#45;keyword">new</span> Book(
                title: <span class="java&#45;quote">"Misery"</span>,
                author: <span class="java&#45;quote">"Stephen King"</span>)<p class="paragraph"/>        mockForConstraintsTests(Book, &#91;existingBook&#93;)<p class="paragraph"/>        // validation should fail <span class="java&#45;keyword">if</span> both properties are <span class="java&#45;keyword">null</span>
        def book = <span class="java&#45;keyword">new</span> Book()<p class="paragraph"/>        assert !book.validate()
        assert <span class="java&#45;quote">"nullable"</span> == book.errors&#91;<span class="java&#45;quote">"title"</span>&#93;.code
        assert <span class="java&#45;quote">"nullable"</span> == book.errors&#91;<span class="java&#45;quote">"author"</span>&#93;.code<p class="paragraph"/>        // So let's demonstrate the unique and minSize constraints<p class="paragraph"/>        book = <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"Misery"</span>, author: <span class="java&#45;quote">"JK"</span>)
        assert !book.validate()
        assert <span class="java&#45;quote">"unique"</span> == book.errors&#91;<span class="java&#45;quote">"title"</span>&#93;.code
        assert <span class="java&#45;quote">"minSize"</span> == book.errors&#91;<span class="java&#45;quote">"author"</span>&#93;.code<p class="paragraph"/>        // Validation should pass!
        book = <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"The Shining"</span>, author: <span class="java&#45;quote">"Stephen King"</span>)
        assert book.validate()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can probably look at that code and work out what's happening without any further explanation. The one thing we will explain is the way the <code>errors</code> property is used. First, is a real Spring <code>Errors</code> instance, so you can access all the properties and methods you would normally expect. Second, this particular <code>Errors</code> object also has map/property access as shown. Simply specify the name of the field you are interested in and the map/property access will return the name of the constraint that was violated. Note that it is the constraint name, not the message code (as you might expect).
</div><p class="paragraph"/>おそらくコードを見れば、特に説明しなくても何が起きているのが想像できると思います。そのひとつは<code>errors</code>プロパティの使用方法です。これは本物のSpringの<code>Errors</code>インスタンスで、既存のプロパティとメソッドにアクセス可能かつ、マップ/プロパティ形式でアクセスすることができる特別な<code>Errors</code>オブジェクトです。この機能は単に確認したいフィールドの名前をマップ/プロパティ形式で指定すると制約違反のあった名前を返します。返す値は制約の名前で、メッセージコードの値ではないことに注意してください。<p class="paragraph"/><div class="hidden-block">
That's it for testing constraints. One final thing we would like to say is that testing the constraints in this way catches a common error: typos in the "constraints" property name! It is currently one of the hardest bugs to track down normally, and yet a unit test for your constraints will highlight the problem straight away.
</div><p class="paragraph"/>制約に関してはここまでです。最後に言いたいことは"constraints"という名前のタイプミスを見つけられるということです！これは通常発見するのが非常に難しいバグですが、制約のテストを行うことですぐに問題を明らかにできます。


<a name="12.1.4 Unit Testing Filters"><!-- Legacy link --></a>
<h2 id="unitTestingFilters">12.1.4 フィルタのユニットテスト</h2>
<div class="hidden-block">Unit testing filters is typically a matter of testing a controller where a filter is a mock collaborator. For example consider the following filters class:</div>
フィルタをユニットテストするには、一般的に、フィルタがモックコラボレータであるようなコントローラをテストすることになります。
例えば、次のフィルタクラスを考えてみましょう:<p class="paragraph"/><div class="code"><pre>class CancellingFilters &#123;
    def filters = &#123;
        all(controller:<span class="java&#45;quote">"simple"</span>, action:<span class="java&#45;quote">"list"</span>) &#123;
            before = &#123;
                redirect(controller:<span class="java&#45;quote">"book"</span>)
                <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This filter interceptors the <code>list</code> action of the <code>simple</code> controller and redirects to the <code>book</code> controller. To test this filter you start off with a test that targets the <code>SimpleController</code> class and add the <code>CancellingFilters</code> as a mock collaborator:</div>
このフィルタは<code>simple</code>コントローラの<code>list</code>アクションをインターセプトし、<code>book</code>コントローラにリダイレクトします。このフィルタをテストするには、まず<code>SimpleController</code>クラスを対象としたテストを作り、<code>CancellingFilters</code>をモックコラボレータとして設定します:<p class="paragraph"/><div class="code"><pre>@TestFor(SimpleController)
@Mock(CancellingFilters)
class SimpleControllerTests &#123;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can then implement a test that uses the <code>withFilters</code> method to wrap the call to an action in filter execution:</div>
次に、フィルタを通して実行されるアクションの呼び出しを<code>withFilters</code>メソッドで囲むようにテストを実装します:<p class="paragraph"/><div class="code"><pre>void testInvocationOfListActionIsFiltered() &#123;
    withFilters(action:<span class="java&#45;quote">"list"</span>) &#123;
        controller.list()
    &#125;
    assert response.redirectedUrl == '/book'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Note that the <code>action</code> parameter is required because it is unknown what the action to invoke is until the action is actually called. The <code>controller</code> parameter is optional and taken from the controller under test. If it is another controller you are testing then you can specify it:</div>
実際にアクションが呼び出されるまで、どのアクションが実行されるか不明なため、<code>action</code>パラメータが必須であることに注意してください。
<code>controller</code>パラメータは省略可能です。省略時はテスト対象のコントローラが適用されます。
もしテストしているのが別のコントローラである場合はそれを指定します。<p class="paragraph"/><div class="code"><pre>withFilters(controller:<span class="java&#45;quote">"book"</span>,action:<span class="java&#45;quote">"list"</span>) &#123;
    controller.list()
&#125;</pre></div>


<a name="12.1.5 Unit Testing URL Mappings"><!-- Legacy link --></a>
<h2 id="unitTestingURLMappings">12.1.5 URLマッピングのユニットテスト</h2>
<div class="hidden-block">
<h4>The Basics</h4>
</div><p class="paragraph"/><h4>基本</h4><p class="paragraph"/><div class="hidden-block">
Testing URL mappings can be done with the <code>TestFor</code> annotation testing a particular URL mappings class. For example to test the default URL mappings you can do the following:
</div><p class="paragraph"/>URLマッピングをテストするには、<code>TestFor</code>アノテーションを使用します。例えば、デフォルトのURLマッピングをテストするためには次のように使用します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.example.AuthorController
<span class="java&#45;keyword">import</span> org.example.SimpleController<p class="paragraph"/>@TestFor(UrlMappings)
@Mock(&#91;AuthorController, SimpleController&#93;)
class UrlMappingsTests &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
As you can see, any controller that is the target of a URL mapping that you're testing  <em class="italic">must</em>  be added to the <code>&#64;Mock</code> annotation.
</div><p class="paragraph"/>上記のように、テストを実施するURLマッピングの対象となるコントローラには<code>Mock</code>アノテーションを追加しなければなりません。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
Note that since the default <code>UrlMappings</code> class is in the default package your test must also be in the default package
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
<code>UrlMappings</code>クラスがデフォルトパッケージの中にあるので、あなたが実行するテストもデフォルトパッケージの中になければいけません。
</blockquote><p class="paragraph"/><div class="hidden-block">
With that done there are a number of useful methods that are defined by the <code>grails.test.mixin.web.UrlMappingsUnitTestMixin</code> for testing URL mappings. These include:
</div><p class="paragraph"/>URLマッピングをテストするために<code>grails.test.mixin.web.UrlMappingsUnitTestMixin</code>には以下のような便利なメソッドが定義されています。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>assertForwardUrlMapping</code> - Asserts a URL mapping is forwarded for the given controller class (note that controller will need to be defined as a mock collaborate for this to work)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>assertForwardUrlMapping</code> - 指定したコントローラクラスにフォワードするURLマッピングを検証する（コントローラはモックコラボレータとして定義される必要があることに注意してください）</li>
</ul><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>assertReverseUrlMapping</code> - Asserts that the given URL is produced when reverse mapping a link to a given controller and action</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>assertReverseUrlMapping</code> - 指定したURLが、与えられたコントローラとアクションからリバースマッピングしたリンクとして生成されるか検証する</li>
</ul><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>assertUrlMapping</code> - Asserts a URL mapping is valid for the given URL. This combines the <code>assertForwardUrlMapping</code> and <code>assertReverseUrlMapping</code> assertions</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>assertUrlMapping</code> - 指定したURLに対応するURLマッピングの妥当性を検証する。これは、<code>assertForwardUrlMapping</code>と<code>assertReverseUrlMapping</code>を組み合わせたものです。</li>
</ul><p class="paragraph"/><div class="hidden-block">
<h4>Asserting Forward URL Mappings</h4>
</div><p class="paragraph"/><h4>URLマッピングの転送の検証</h4><p class="paragraph"/><div class="hidden-block">
You use <code>assertForwardUrlMapping</code> to assert that a given URL maps to a given controller. For example, consider the following URL mappings:
</div><p class="paragraph"/>指定したURLが、期待したコントローラにマップされるか検証するために<code>assertForwardUrlMapping</code>が使用できます。例えば、以下のようなURLマッピングについて考えてみます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mappings = &#123;
    <span class="java&#45;quote">"/action1"</span>(controller: <span class="java&#45;quote">"simple"</span>, action: <span class="java&#45;quote">"action1"</span>)
    <span class="java&#45;quote">"/action2"</span>(controller: <span class="java&#45;quote">"simple"</span>, action: <span class="java&#45;quote">"action2"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The following test can be written to assert these URL mappings:
</div><p class="paragraph"/>このようなURLマッピングのテストは次のように書けます。<p class="paragraph"/><div class="code"><pre>void testUrlMappings() &#123;<p class="paragraph"/>    assertForwardUrlMapping(<span class="java&#45;quote">"/action1"</span>, controller: 'simple',
                                        action: <span class="java&#45;quote">"action1"</span>)<p class="paragraph"/>    assertForwardUrlMapping(<span class="java&#45;quote">"/action2"</span>, controller: 'simple',
                                        action: <span class="java&#45;quote">"action2"</span>)<p class="paragraph"/>    shouldFail &#123;
        assertForwardUrlMapping(<span class="java&#45;quote">"/action2"</span>, controller: 'simple',
                                            action: <span class="java&#45;quote">"action1"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Assert Reverse URL Mappings</h4>
</div><p class="paragraph"/><h4>URLマッピングのリバース検証</h4><p class="paragraph"/><div class="hidden-block">
You use <code>assertReverseUrlMapping</code> to check that correct links are produced for your URL mapping when using the <code>link</code> tag in GSP views. An example test is largely identical to the previous listing except you use <code>assertReverseUrlMapping</code> instead of <code>assertForwardUrlMapping</code>. Note that you can combine these 2 assertions with <code>assertUrlMapping</code>.
</div><p class="paragraph"/>GSPのビューで<code>link</code>タグを使用した場合に、URLマッピングから生成されるリンクを確認(チェック)するために<code>assertReverseUrlMapping</code>を使用できます。
<code>assertReverseUrlMapping</code>の代わりに<code>assertForwardUrlMapping</code>を使用する以外は上記の例とほとんど同じです。
<code>assertUrlMapping</code>はこれら2つのアサーションを組み合わせた検証が出来ます。<p class="paragraph"/><div class="hidden-block">
<h4>Simulating Controller Mapping</h4>
</div><p class="paragraph"/><h4>コントローラのマッピングをシミュレート</h4><p class="paragraph"/><div class="hidden-block">
In addition to the assertions to check the validity of URL mappings you can also simulate mapping to a controller by using your <code>UrlMappings</code> as a mock collaborator and the <code>mapURI</code> method. For example:
</div><p class="paragraph"/>URLマッピングの妥当性をチェックするためのアサーションに加えて、<code>UrlMappings</code>をモックとして指定し<code>mapURI</code>メソッドを使用することで、コントローラへのマッピングをシミュレートすることができます。<p class="paragraph"/><div class="code"><pre>@TestFor(SimpleController)
@Mock(UrlMappings)
class SimpleControllerTests &#123;<p class="paragraph"/>    void testControllerMapping() &#123;<p class="paragraph"/>        SimpleController controller = mapURI('/simple/list')
        assert controller != <span class="java&#45;keyword">null</span><p class="paragraph"/>        def model = controller.list()
        assert model != <span class="java&#45;keyword">null</span>
    &#125;
&#125;</pre></div>


<a name="12.1.6 Mocking Collaborators"><!-- Legacy link --></a>
<h2 id="mockingCollaborators">12.1.6 コラボレータのモック化</h2>
<div class="hidden-block">
Beyond the specific targeted mocking APIs there is also an all-purpose <code>mockFor()</code> method that is available when using the <code>TestFor</code> annotation. The signature of <code>mockFor</code> is:
</div>
ドメインをモックするなど特定の目的をもったモックAPIの他に、汎用的に使える<code>mockFor()</code>メソッドがあります。これは<code>TestFor</code>アノテーションを使用している場合にも使用できます。<code>mockFor</code>は以下のように使用します。<p class="paragraph"/><div class="code"><pre>mockFor(class, loose = <span class="java&#45;keyword">false</span>)</pre></div><p class="paragraph"/><div class="hidden-block">
This is general-purpose mocking that lets you set up either strict or loose demands on a class.
</div>
<code>mockFor</code>を使用したモックでは、demand(要求)がstrict(厳密)、またはloose(緩やか)のどちらであるかを指定する必要があります。<p class="paragraph"/><div class="hidden-block">
This method is surprisingly intuitive to use. By default it will create a strict mock control object (one for which the order in which methods are called is important) that you can use to specify demands:
</div>
デフォルトではstrictなモック制御オブジェクト(メソッドの呼び出し順序をチェックする)として生成し、demandを次のように指定します。<p class="paragraph"/><div class="code"><pre>def strictControl = mockFor(MyService)
strictControl.demand.someMethod(0..2) &#123; <span class="java&#45;object">String</span> arg1, <span class="java&#45;object">int</span> arg2 &#45;&#62; &#8230; &#125;
strictControl.demand.<span class="java&#45;keyword">static</span>.aStaticMethod &#123;&#45;&#62; &#8230; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Notice that you can mock static as well as instance methods by using the "static" property. You then specify the name of the method to mock, with an optional range argument. This range determines how many times you expect the method to be called, and if the number of invocations falls outside of that range (either too few or too many) then an assertion error will be thrown. If no range is specified, a default of "1..1" is assumed, i.e. that the method must be called exactly once.
</div>
"static"プロパティを使用することで、インスタンスメソッド同様にstaticなメソッドをモックすることができます。また、モックするメソッドには、必要に応じてrange(範囲)を引数に指定できます。このrangeは期待するメソッドの呼び出し回数を表しており、もし呼び出し回数がこの範囲を外れた場合(多すぎたり、少なすぎたりした場合)は、アサーションエラーがスローされます。rangeを指定しなかった場合は、デフォルトで"1..1"が指定され、メソッドが1度だけ呼び出されること意味しています。<p class="paragraph"/><div class="hidden-block">
The last part of a demand is a closure representing the implementation of the mock method. The closure arguments must match the number and types of the mocked method, but otherwise you are free to add whatever you want in the body.
</div>
demandの最後の引数は、モックの実装を表すクロージャです。クロージャの引数は、モックするメソッドの引数の数と型が一致している必要がありますが、それ以外は自由に中身を実装できます。<p class="paragraph"/><div class="hidden-block">
Call <code>mockControl.createMock()</code> to get an actual mock instance of the class that you are mocking. You can call this multiple times to create as many mock instances as you need. And once you have executed the test method, call <code>mockControl.verify()</code> to check that the expected methods were called.
</div>
モッククラスの定義が完了した後に、<code>mockControl.createMock()</code>メソッドを呼ぶことで、モックインスタンスを作成します。複数のモックインスタンスが必要な場合は、必要なだけこのメソッドを呼び出すことで、複数のモックインスタンスが作成できます。また期待するメソッドの呼び出しを検証するには<code>mockControl.verify()</code>を呼び出してください。<p class="paragraph"/><div class="hidden-block">
Grails mocks also provide a <code>demandExplicit</code> method that can be used in place of demand.  This will check the mocked class's metaClass and throw an ExplicitDemandException if a method with that name and signature doesn't exist. For example, given the service:
</div>
Grailsのモックは、demandの代わりに<code>demandExplicit</code>メソッドも提供しています。これはモックするクラスのmetaClassをチェックし、もしそのメソッドの名前、シグネチャが存在しない場合に、ExplicitDemandExceptionをスローします。例えば次のようなサービスがあるとします。<p class="paragraph"/><div class="code"><pre>class MyService &#123;
    def someMethod(<span class="java&#45;object">String</span> s) &#123; &#8230; &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The following mocking works the same as demand
</div>
demandと同じようにモックできます。<p class="paragraph"/><div class="code"><pre>def strictControl = mockFor(MyService)
//Works just like the demand method since method signature exists on the class
strictControl.demandExplicit.someMethod(1) &#123; <span class="java&#45;object">String</span> arg1  &#125;</pre></div><p class="paragraph"/><div class="hidden-block">
While this mocking throws an ExplicitDemandException when the test is run.
</div>
以下はメソッドのシグネイチャが存在しないため、テストを実行した際にExplicitDemandExceptionをスローします。
<div class="code"><pre>def strictControl = mockFor(MyService)
//Throws ExplicitDemandException because method signature doesn't exist
strictControl.demandExplicit.someMethod(1) &#123; <span class="java&#45;object">String</span> arg1, <span class="java&#45;object">String</span> arg2  &#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Using demandExplicit should be the preferred method for mocking as it is more likely to catch issues when changing method signatures.  Use demand when the method to be mocked is added dynamically, otherwise use demandExplicit.
</div>
demandExplicitを使用することで、メソッドのシグネチャを変更した際に、問題を検出しやすくなります。このため、動的に追加されるメソッドに対してはdemandを使用し、そうでなければdemandExplicitを使用してください。<p class="paragraph"/><div class="hidden-block">
Lastly, the call:
</div>
最後に以下のコードを見てください。<p class="paragraph"/><div class="code"><pre>def looseControl = mockFor(MyService, <span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/><div class="hidden-block">
will create a mock control object that has only loose expectations, i.e. the order that methods are invoked does not matter.
</div>
これはlooseなモック制御オブジェクトを作成します。別の言い方をすると、これにより呼び出し順序をチェックしなくなります。


<a name="12.1.7 Mocking Codecs"><!-- Legacy link --></a>
<h2 id="mockingCodecs">12.1.7 コーデックのモック化</h2>
<div class="hidden-block">
The <code>GrailsUnitTestMixin</code> provides a <code>mockCodec</code> method for mocking <a href="../guide/single.html#codecs" class="guide">custom codecs</a> which may be invoked while a unit test is running.
</div><p class="paragraph"/><code>GrailsUnitTestMixin</code>は<a href="../guide/single.html#codecs" class="guide">カスタムコーデック</a>のモックを生成するための<code>mockCodec</code>メソッドを提供しています。このメソッドはユニットテストの実施中に呼び出される可能性があります。<p class="paragraph"/><div class="code"><pre>mockCodec(MyCustomCodec)</pre></div><p class="paragraph"/><div class="hidden-block">
Failing to mock a codec which is invoked while a unit test is running may result in a MissingMethodException.
</div><p class="paragraph"/>コーデックのモック生成に失敗している場合は、ユニットテストが<code>MissingMethodException</code>で終了する可能性があります。


<a name="12.2 Integration Testing"><!-- Legacy link --></a>
<h2 id="integrationTesting">12.2 インテグレーションテスト</h2>
Integration tests differ from unit tests in that you have full access to the Grails environment within the test. Grails uses an in-memory H2 database for integration tests and clears out all the data from the database between tests.<p class="paragraph"/>One thing to bear in mind is that logging is enabled for your application classes, but it is different from logging in tests. So if you have something like this:<p class="paragraph"/><div class="code"><pre>class MyServiceTests <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;
    void testSomething() &#123;
        log.info <span class="java&#45;quote">"Starting tests"</span>
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>the "starting tests" message is logged using a different system than the one used by the application. The <code>log</code> property in the example above is an instance of <code>java.util.logging.Logger</code> (inherited from the base class, not injected by Grails), which doesn't have the same methods as the <code>log</code> property injected into your application artifacts. For example, it doesn't have <code>debug()</code> or <code>trace()</code> methods, and the equivalent of <code>warn()</code> is in fact <code>warning()</code>.<p class="paragraph"/><h4>Transactions</h4><p class="paragraph"/>Integration tests run inside a database transaction by default, which is rolled back at the end of the each test. This means that data saved during a test is not persisted to the database. Add a <code>transactional</code> property to your test class to check transactional behaviour:<p class="paragraph"/><div class="code"><pre>class MyServiceTests <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;
    <span class="java&#45;keyword">static</span> transactional = <span class="java&#45;keyword">false</span><p class="paragraph"/>    void testMyTransactionalServiceMethod() &#123;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>Be sure to remove any persisted data from a non-transactional test, for example in the <code>tearDown</code> method, so these tests don't interfere with standard transactional tests that expect a clean database.<p class="paragraph"/><h4>Testing Controllers</h4><p class="paragraph"/>To test controllers you first have to understand the Spring Mock Library.<p class="paragraph"/>Grails automatically configures each test with a <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/mock/web/MockHttpServletRequest.html" class="api">MockHttpServletRequest</a>, <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/mock/web/MockHttpServletResponse.html" class="api">MockHttpServletResponse</a>, and <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/mock/web/MockHttpSession.html" class="api">MockHttpSession</a> that you can use in your tests. For example consider the following controller:<p class="paragraph"/><div class="code"><pre>class FooController &#123;<p class="paragraph"/>    def text() &#123;
        render <span class="java&#45;quote">"bar"</span>
    &#125;<p class="paragraph"/>    def someRedirect() &#123;
        redirect(action:<span class="java&#45;quote">"bar"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>The tests for this would be:<p class="paragraph"/><div class="code"><pre>class FooControllerTests <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;<p class="paragraph"/>    void testText() &#123;
        def fc = <span class="java&#45;keyword">new</span> FooController()
        fc.text()
        assertEquals <span class="java&#45;quote">"bar"</span>, fc.response.contentAsString
    &#125;<p class="paragraph"/>    void testSomeRedirect() &#123;
        def fc = <span class="java&#45;keyword">new</span> FooController()
        fc.someRedirect()
        assertEquals <span class="java&#45;quote">"/foo/bar"</span>, fc.response.redirectedUrl
    &#125;
&#125;</pre></div><p class="paragraph"/>In the above case <code>response</code> is an instance of <code>MockHttpServletResponse</code> which we can use to obtain the generated content with <code>contentAsString</code> (when writing to the response) or the redirected URL. These mocked versions of the Servlet API are completely mutable (unlike the real versions) and hence you can set properties on the request such as the <code>contextPath</code> and so on.<p class="paragraph"/>Grails <strong class="bold">does not</strong> invoke <a href="../guide/single.html#interceptors" class="guide">interceptors</a> or servlet filters when calling actions during integration testing. You should test interceptors and filters in isolation, using <a href="../guide/single.html#functionalTesting" class="guide">functional testing</a> if necessary.<p class="paragraph"/><h4>Testing Controllers with Services</h4><p class="paragraph"/>If your controller references a service (or other Spring beans), you have to explicitly initialise the service from your test.<p class="paragraph"/>Given a controller using a service:<p class="paragraph"/><div class="code"><pre>class FilmStarsController &#123;
    def popularityService<p class="paragraph"/>    def update() &#123;
        // <span class="java&#45;keyword">do</span> something with popularityService
    &#125;
&#125;</pre></div><p class="paragraph"/>The test for this would be:<p class="paragraph"/><div class="code"><pre>class FilmStarsTests <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;
    def popularityService<p class="paragraph"/>    void testInjectedServiceInController () &#123;
        def fsc = <span class="java&#45;keyword">new</span> FilmStarsController()
        fsc.popularityService = popularityService
        fsc.update()
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Testing Controller Command Objects</h4><p class="paragraph"/>With command objects you just supply parameters to the request and it will automatically do the command object work for you when you call your action with no parameters:<p class="paragraph"/>Given a controller using a command object:<p class="paragraph"/><div class="code"><pre>class AuthenticationController &#123;
    def signup(SignupForm form) &#123;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>You can then test it like this:<p class="paragraph"/><div class="code"><pre>def controller = <span class="java&#45;keyword">new</span> AuthenticationController()
controller.params.login = <span class="java&#45;quote">"marcpalmer"</span>
controller.params.password = <span class="java&#45;quote">"secret"</span>
controller.params.passwordConfirm = <span class="java&#45;quote">"secret"</span>
controller.signup()</pre></div><p class="paragraph"/>Grails auto-magically sees your call to <code>signup()</code> as a call to the action and populates the command object from the mocked request parameters. During controller testing, the <code>params</code> are mutable with a mocked request supplied by Grails.<p class="paragraph"/><h4>Testing Controllers and the render Method</h4><p class="paragraph"/>The <a href="../ref/Controllers/render.html" class="controllers">render</a> method lets you render a custom view at any point within the body of an action. For instance, consider the example below:<p class="paragraph"/><div class="code"><pre>def save() &#123;
    def book = Book(params)
    <span class="java&#45;keyword">if</span> (book.save()) &#123;
        // handle
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
        render(view:<span class="java&#45;quote">"create"</span>, model:&#91;book:book&#93;)
    &#125;
&#125;</pre></div><p class="paragraph"/>In the above example the result of the model of the action is not available as the return value, but instead is stored within the <code>modelAndView</code> property of the controller. The <code>modelAndView</code> property is an instance of Spring MVC's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" target="blank">ModelAndView</a> class and you can use it to the test the result of an action:<p class="paragraph"/><div class="code"><pre>def bookController = <span class="java&#45;keyword">new</span> BookController()
bookController.save()
def model = bookController.modelAndView.model.book</pre></div><p class="paragraph"/><h4>Simulating Request Data</h4><p class="paragraph"/>You can use the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/mock/web/MockHttpServletRequest.html" class="api">MockHttpServletRequest</a> to test an action that requires request data, for example a REST web service. For example consider this action which performs data binding from an incoming request:<p class="paragraph"/><div class="code"><pre>def create() &#123;
    &#91;book: <span class="java&#45;keyword">new</span> Book(params.book)&#93;
&#125;</pre></div><p class="paragraph"/>To simulate the 'book' parameter as an XML request you could do something like the following:<p class="paragraph"/><div class="code"><pre>void testCreateWithXML() &#123;<p class="paragraph"/>    def controller = <span class="java&#45;keyword">new</span> BookController()<p class="paragraph"/>    controller.request.contentType = 'text/xml'
    controller.request.content = '''&#92;&#10;            &#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"ISO&#45;8859&#45;1"</span>?&#62;
            &#60;book&#62;
                &#60;title&#62;The Stand&#60;/title&#62;
                &#8230;
            &#60;/book&#62;
            '''.stripIndent().getBytes() // note we need the bytes<p class="paragraph"/>    def model = controller.create()
    assert model.book
    assertEquals <span class="java&#45;quote">"The Stand"</span>, model.book.title
&#125;</pre></div><p class="paragraph"/>The same can be achieved with a JSON request:<p class="paragraph"/><div class="code"><pre>void testCreateWithJSON() &#123;<p class="paragraph"/>    def controller = <span class="java&#45;keyword">new</span> BookController()<p class="paragraph"/>    controller.request.contentType = <span class="java&#45;quote">"text/json"</span>
    controller.request.content =
            '&#123;<span class="java&#45;quote">"id"</span>:1,<span class="java&#45;quote">"class"</span>:<span class="java&#45;quote">"Book"</span>,<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;'.getBytes()<p class="paragraph"/>    def model = controller.create()
    assert model.book
    assertEquals <span class="java&#45;quote">"The Stand"</span>, model.book.title
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
With JSON don't forget the <code>class</code> property to specify the name the target type to bind to. In XML this is implicit within the name of the <code>&#60;book&#62;</code> node, but this property is required as part of the JSON packet.
</blockquote><p class="paragraph"/>For more information on the subject of REST web services see the section on <a href="../guide/single.html#REST" class="guide">REST</a>.<p class="paragraph"/><h4>Testing Web Flows</h4><p class="paragraph"/>Testing <a href="../guide/single.html#webflow" class="guide">Web Flows</a> requires a special test harness called <code>grails.test.WebFlowTestCase</code> which subclasses Spring Web Flow's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/webflow/test/execution/AbstractFlowExecutionTests.html" class="api">AbstractFlowExecutionTests</a> class.<p class="paragraph"/><blockquote class="note">
Subclasses of <code>WebFlowTestCase</code> <strong class="bold">must</strong> be integration tests
</blockquote><p class="paragraph"/>For example given this simple flow:<p class="paragraph"/><div class="code"><pre>class ExampleController &#123;<p class="paragraph"/>    def exampleFlow() &#123;
        start &#123;
            on(<span class="java&#45;quote">"go"</span>) &#123;
                flow.hello = <span class="java&#45;quote">"world"</span>
            &#125;.to <span class="java&#45;quote">"next"</span>
        &#125;
        next &#123;
            on(<span class="java&#45;quote">"back"</span>).to <span class="java&#45;quote">"start"</span>
            on(<span class="java&#45;quote">"go"</span>).to <span class="java&#45;quote">"subber"</span>
        &#125;
        subber &#123;
            subflow(action: <span class="java&#45;quote">"sub"</span>)
            on(<span class="java&#45;quote">"end"</span>).to(<span class="java&#45;quote">"end"</span>)
        &#125;
        end()
    &#125;<p class="paragraph"/>    def subFlow() &#123;
        subSubflowState &#123;
            subflow(controller: <span class="java&#45;quote">"other"</span>, action: <span class="java&#45;quote">"otherSub"</span>)
            on(<span class="java&#45;quote">"next"</span>).to(<span class="java&#45;quote">"next"</span>)
        &#125;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>You need to tell the test harness what to use for the "flow definition". This is done via overriding the abstract <code>getFlow</code>
 method:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.WebFlowTestCase<p class="paragraph"/>class ExampleFlowTests <span class="java&#45;keyword">extends</span> WebFlowTestCase &#123;
    def getFlow() &#123; <span class="java&#45;keyword">new</span> ExampleController().exampleFlow &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/>You can specify the flow id by overriding the <code>getFlowId</code> method, otherwise the default is <code>test</code>:
<div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.WebFlowTestCase<p class="paragraph"/>class ExampleFlowTests <span class="java&#45;keyword">extends</span> WebFlowTestCase &#123;
    <span class="java&#45;object">String</span> getFlowId() &#123; <span class="java&#45;quote">"example"</span> &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/>If the flow under test calls any subflows, these (or mocks) must be registered before the calling the flow:
<div class="code"><pre><span class="java&#45;keyword">protected</span> void setUp() &#123;
    <span class="java&#45;keyword">super</span>.setUp()<p class="paragraph"/>    registerFlow(<span class="java&#45;quote">"other/otherSub"</span>) &#123; // register a simplified mock
        start &#123;
            on(<span class="java&#45;quote">"next"</span>).to(<span class="java&#45;quote">"end"</span>)
        &#125;
        end()
    &#125;<p class="paragraph"/>    // register the original subflow
    registerFlow(<span class="java&#45;quote">"example/sub"</span>, <span class="java&#45;keyword">new</span> ExampleController().subFlow)
&#125;</pre></div><p class="paragraph"/>Then you kick off the flow with the <code>startFlow</code> method:<p class="paragraph"/><div class="code"><pre>void testExampleFlow() &#123;
    def viewSelection = startFlow()
    &#8230;
&#125;</pre></div><p class="paragraph"/>Use the <code>signalEvent</code> method to trigger an event:<p class="paragraph"/><div class="code"><pre>void testExampleFlow() &#123;
    &#8230;
    signalEvent(<span class="java&#45;quote">"go"</span>)
    assert <span class="java&#45;quote">"next"</span> == flowExecution.activeSession.state.id
    assert <span class="java&#45;quote">"world"</span> == flowScope.hello
&#125;</pre></div><p class="paragraph"/>Here we have signaled to the flow to execute the event "go" which causes a transition to the "next" state. In the example a transition action placed a <code>hello</code> variable into the flow scope.<p class="paragraph"/><h4>Testing Tag Libraries</h4><p class="paragraph"/>Testing tag libraries is simple because when a tag is invoked as a method it returns its result as a string (technically a <code>StreamCharBuffer</code> but this class implements all of the methods of <code>String</code>). So for example if you have a tag library like this:<p class="paragraph"/><div class="code"><pre>class FooTagLib &#123;<p class="paragraph"/>    def bar = &#123; attrs, body &#45;&#62;
        out &#60;&#60; <span class="java&#45;quote">"&#60;p&#62;Hello World!&#60;/p&#62;"</span>
    &#125;<p class="paragraph"/>    def bodyTag = &#123; attrs, body &#45;&#62;
        out &#60;&#60; <span class="java&#45;quote">"&#60;&#36;&#123;attrs.name&#125;&#62;"</span>
        out &#60;&#60; body()
        out &#60;&#60; <span class="java&#45;quote">"&#60;/&#36;&#123;attrs.name&#125;&#62;"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The tests would look like:<p class="paragraph"/><div class="code"><pre>class FooTagLibTests <span class="java&#45;keyword">extends</span> GroovyTestCase &#123;<p class="paragraph"/>    void testBarTag() &#123;
        assertEquals <span class="java&#45;quote">"&#60;p&#62;Hello World!&#60;/p&#62;"</span>,
                     <span class="java&#45;keyword">new</span> FooTagLib().bar(<span class="java&#45;keyword">null</span>, <span class="java&#45;keyword">null</span>).toString()
    &#125;<p class="paragraph"/>    void testBodyTag() &#123;
        assertEquals <span class="java&#45;quote">"&#60;p&#62;Hello World!&#60;/p&#62;"</span>,
                     <span class="java&#45;keyword">new</span> FooTagLib().bodyTag(name: <span class="java&#45;quote">"p"</span>) &#123;
                         <span class="java&#45;quote">"Hello World!"</span>
                     &#125;.toString()
    &#125;
&#125;</pre></div><p class="paragraph"/>Notice that for the second example, <code>testBodyTag</code>, we pass a block that returns the body of the tag. This is convenient to representing the body as a String.<p class="paragraph"/><h4>Testing Tag Libraries with GroovyPagesTestCase</h4><p class="paragraph"/>In addition to doing simple testing of tag libraries like in the above examples, you can also use the <code>grails.test.GroovyPagesTestCase</code> class to test tag libraries with integration tests.<p class="paragraph"/>The <code>GroovyPagesTestCase</code> class is a subclass of the standard <code>GroovyTestCase</code> class and adds utility methods for testing the output of GSP rendering.<p class="paragraph"/><blockquote class="note">
<code>GroovyPagesTestCase</code> can only be used in an integration test.
</blockquote><p class="paragraph"/>For example, consider this date formatting tag library:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> java.text.SimpleDateFormat<p class="paragraph"/>class FormatTagLib &#123;
    def dateFormat = &#123; attrs, body &#45;&#62;
        out &#60;&#60; <span class="java&#45;keyword">new</span> SimpleDateFormat(attrs.format) &#60;&#60; attrs.date
    &#125;
&#125;</pre></div><p class="paragraph"/>This can be easily tested as follows:<p class="paragraph"/><div class="code"><pre>class FormatTagLibTests <span class="java&#45;keyword">extends</span> GroovyPagesTestCase &#123;
    void testDateFormat() &#123;
        def template =
                '&#60;g:dateFormat format=<span class="java&#45;quote">"dd&#45;MM&#45;yyyy"</span> date=<span class="java&#45;quote">"&#36;&#123;myDate&#125;"</span> /&#62;'<p class="paragraph"/>        def testDate = &#8230; // create the date
        assertOutputEquals('01&#45;01&#45;2008', template, &#91;myDate:testDate&#93;)
    &#125;
&#125;</pre></div><p class="paragraph"/>You can also obtain the result of a GSP using the <code>applyTemplate</code> method of the <code>GroovyPagesTestCase</code> class:<p class="paragraph"/><div class="code"><pre>class FormatTagLibTests <span class="java&#45;keyword">extends</span> GroovyPagesTestCase &#123;
    void testDateFormat() &#123;
        def template =
                '&#60;g:dateFormat format=<span class="java&#45;quote">"dd&#45;MM&#45;yyyy"</span> date=<span class="java&#45;quote">"&#36;&#123;myDate&#125;"</span> /&#62;'<p class="paragraph"/>        def testDate = &#8230; // create the date
        def result = applyTemplate(template, &#91;myDate:testDate&#93;)<p class="paragraph"/>        assertEquals '01&#45;01&#45;2008', result
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Testing Domain Classes</h4><p class="paragraph"/>Testing domain classes is typically a simple matter of using the <a href="../guide/single.html#GORM" class="guide">GORM API</a>, but there are a few things to be aware of. Firstly, when testing queries you often need to "flush" to ensure the correct state has been persisted to the database. For example take the following example:<p class="paragraph"/><div class="code"><pre>void testQuery() &#123;
    def books = &#91;
            <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"The Stand"</span>),
            <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"The Shining"</span>)&#93;
    books&#42;.save()<p class="paragraph"/>    assertEquals 2, Book.list().size()
&#125;</pre></div><p class="paragraph"/>This test will fail because calling <a href="../ref/Domain Classes/save.html" class="domainClasses">save</a> does not actually persist the <code>Book</code> instances when called. Calling <code>save</code> only indicates to Hibernate that at some point in the future these instances should be persisted. To commit changes immediately you "flush" them:<p class="paragraph"/><div class="code"><pre>void testQuery() &#123;
    def books = &#91;
            <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"The Stand"</span>),
            <span class="java&#45;keyword">new</span> Book(title: <span class="java&#45;quote">"The Shining"</span>)&#93;
    books&#42;.save(flush: <span class="java&#45;keyword">true</span>)<p class="paragraph"/>    assertEquals 2, Book.list().size()
&#125;</pre></div><p class="paragraph"/>In this case since we're passing the argument <code>flush</code> with a value of <code>true</code> the updates will be persisted immediately and hence will be available to the query later on.


<a name="12.3 Functional Testing"><!-- Legacy link --></a>
<h2 id="functionalTesting">12.3 ファンクショナルテスト</h2>
Functional tests involve making HTTP requests against the running application and verifying the resultant behaviour. The functional testing phase differs from the integration phase in that the Grails application is now listening and responding to actual HTTP requests. This is useful for end-to-end testing scenarios, such as making REST calls against a JSON API.<p class="paragraph"/><div class="hidden-block">Grails does not ship with any support for writing functional tests directly, but there are several plugins available for this.</div>
Grailsはファンクショナルテストを書くための直接的なサポートは提供しませんが、ファンクショナルテストのためのいくつかのプラグインが利用可能です。
<ul class="star">
<li><code>Canoo Webtest</code> - <a href="http://grails.org/plugin/webtest" target="blank">http://grails.org/plugin/webtest</a></li>
<li><code>G-Func</code> - <a href="http://grails.org/plugin/functional-test" target="blank">http://grails.org/plugin/functional-test</a></li>
<li><code>Geb</code> - <a href="http://grails.org/plugin/geb" target="blank">http://grails.org/plugin/geb</a></li>
<li><code>Selenium-RC</code> - <a href="http://grails.org/plugin/selenium-rc" target="blank">http://grails.org/plugin/selenium-rc</a></li>
<li><code>WebDriver</code> - <a href="http://grails.org/plugin/webdriver" target="blank">http://grails.org/plugin/webdriver</a></li>
</ul><p class="paragraph"/><div class="hidden-block">Consult the documentation for each plugin for its capabilities.</div>
それぞれのプラグインでできることはドキュメントを参照してください。<p class="paragraph"/><div class="hidden-block">h4. Common Options</div>
<h4>共通オプション</h4><p class="paragraph"/><div class="hidden-block">There are options that are common to all plugins that control how the Grails application is launched, if at all.</div>
全てのプラグインに共通のGrailsアプリケーションの起動を制御するオプションがあります。<p class="paragraph"/><div class="hidden-block">h5. inline</div>
<h5>inlineオプション</h5><p class="paragraph"/><div class="hidden-block">The <code>-inline</code> option specifies that the grails application should be started inline (i.e. like <code>run-app</code>).</div>
<code>-inline</code>オプションが指定されるとGrailsアプリケーションがインライン起動されます(例えば<code>run-app</code>のような)。<p class="paragraph"/><div class="hidden-block"><strong class="bold">This option is implicitly set unless the <code>baseUrl</code> or <code>war</code> options are set</strong></div>
<strong class="bold"><code>-inline</code>オプションは<code>-baseUrl</code>か<code>-war</code>のどちらかが設定されていないと、暗黙的に有効になります</strong><p class="paragraph"/><div class="hidden-block">h5. war</div>
<h5>warオプション</h5><p class="paragraph"/><div class="hidden-block">The <code>-war</code> option specifies that the grails application should be packaged as a war and started. This is useful as it tests your application in a production-like state, but it has a longer startup time than the <code>-inline</code> option. It also runs the war in a forked JVM, meaning that you cannot access any internal application objects.</div>
<code>-war</code>オプションを指定すると、Grailsアプリケーションはwarファイルにパッケージ化した後に起動されます。このオプションはアプリケーションを実際にプロダクトと同じ状態でテストすることができるので便利です。しかし、<code>-inline</code>オプションよりも起動に時間がかかります。また、warで起動するとフォークされたJVM上で実行されます。これは内部のオブジェクトにアクセスできないことを意味しています。<p class="paragraph"/><div class="code"><pre>grails test&#45;app functional: &#45;war</pre></div><p class="paragraph"/><div class="hidden-block">Note that the same build/config options for the <a href="../ref/Command Line/run-war.html" class="commandLine">run-war</a> command apply to functional testing against the WAR.</div>
<a href="../ref/Command Line/run-war.html" class="commandLine">run-war</a>コマンドで利用可能なビルドまたは設定オプションが、warファイルに対するファンクショナルテストでも使用できます。<p class="paragraph"/><div class="hidden-block">h5. https</div>
<h5>httpsオプション</h5><p class="paragraph"/><div class="hidden-block">The <code>-https</code> option results in the application being able to receive https requests as well as http requests. It is compatible with both the <code>-inline</code> and <code>-war</code> options.</div>
<code>-https</code>オプションはhttpリクエストと同様にアプリケーションがhttpsリクエストを受け付けられるようにします。このオプションは<code>-inline</code>と<code>-war</code>の両方のオプションと一緒に使うことができます。<p class="paragraph"/><div class="code"><pre>grails test&#45;app functional: &#45;https</pre></div><p class="paragraph"/><div class="hidden-block">Note that this does not change the test  <em class="italic">base url</em>  to be https, it will still be http unless the <code>-httpsBaseUrl</code> option is also given.</div>
<code>-https</code>オプションを使っていてもテストで使われる  <em class="italic">base url</em>  はhttpsにはなりません。<code>-httpsBaseUrl</code>をあわせて指定しない限り、httpのままとなります。<p class="paragraph"/><div class="hidden-block">h5. httpsBaseUrl</div>
<h5>httpsBaseUrlオプション</h5><p class="paragraph"/><div class="hidden-block">The <code>-httpsBaseUrl</code> causes the implicit base url to be used for tests to be a https url.</div>
<code>-httpsBaseUrl</code>オプションを使えば暗黙的に設定されている  <em class="italic">base url</em>  がテスト時にhttpsのURLとして使われます。<p class="paragraph"/><div class="code"><pre>grails test&#45;app functional: &#45;httpsBaseUrl</pre></div><p class="paragraph"/><div class="hidden-block">This option is ignored if the <code>-baseUrl</code> option is specified.</div>
<code>-httpsBaseUrl</code>オプションは<code>-baseUrl</code>オプションが指定されると無視されます。<p class="paragraph"/><div class="hidden-block">h5. baseUrl</div>
<h5>baseUrlオプション</h5><p class="paragraph"/><div class="hidden-block">The <code>baseUrl</code> option allows the base url for tests to be specified.</div>
<code>-baseUrl</code>オプションによりテスト実施時の  <em class="italic">base url</em>  を指定することができます。<p class="paragraph"/><div class="code"><pre>grails test&#45;app functional: &#45;baseUrl=http://mycompany.com/grailsapp</pre></div><p class="paragraph"/><div class="hidden-block">This option will prevent the local grails application being started unless <code>-inline</code> or <code>-war</code> are given as well. To use a custom base url but still test against the local Grails application you <strong class="bold">must</strong> specify one of either the <code>-inline</code> or <code>-war</code> options.</div>
<code>-baseUrl</code>オプションが指定されていると、ローカル環境でのGrailsアプリケーションを<code>-inline</code>や<code>-war</code>を指定しないで起動することができなくなります。ローカル環境でのGrailsアプリケーションで  <em class="italic">base url</em>  を指定するには、<strong class="bold">必ず</strong><code>-inline</code>か<code>-war</code>のどちらかのオプションを指定する必要があります。


<a name="13. Internationalization"><!-- Legacy link --></a>
<h1 id="i18n">13 国際化</h1>
<div class="hidden-block">
Grails supports Internationalization (i18n) out of the box by leveraging the underlying Spring MVC internationalization support. With Grails you are able to customize the text that appears in a view based on the user's Locale. To quote the javadoc for the <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/Locale.html" class="api">Locale</a> class:</div>
Grailsの国際化対応(i18n)は、Spring MVC 国際化対応を通して実現しています。 ユーザ指定のロケール別にビューで表示されるテキストをカスタマイズできます。<a href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/Locale.html" class="api">Locale</a>クラスについてJavadocから以下に引用します:<p class="paragraph"/><blockquote class="quote">
<div class="hidden-block">A Locale object represents a specific geographical, political, or cultural region. An operation that requires a Locale to perform its task is called locale-sensitive and uses the Locale  to tailor information for the user. For example, displaying a number is a locale-sensitive operation--the number should be formatted according to the customs/conventions of the user's native country, region, or culture.</div>
Locale オブジェクトは、特定の地理的、国家的、または文化的地域を表すためのものです。ある操作で Locale を必要とするタスクがある場合、その操作をロケールに依存する操作といいます。この場合、情報は Locale によりユーザに合わせて調整されます。たとえば、数値を表示するのは、ロケールに依存する操作です。この数値は、ユーザの国や地域、文化の習慣や規則に従ってフォーマットする必要があります。
</blockquote><p class="paragraph"/><div class="hidden-block">A Locale is made up of a <a href="http://www.loc.gov/standards/iso639-2/php/English_list.php" target="blank">language code</a> and a <a href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements.htm" target="blank">country code</a>. For example "en_US" is the code for US english, whilst "en_GB" is the code for British English.</div>
ロケールは<a href="http://www.loc.gov/standards/iso639-2/php/English_list.php" target="blank">言語コード</a>と<a href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements.htm" target="blank">国コード</a>で構成されます。例えば、"en_US"はアメリカ+英語、"en_GB"は英国+英語です。


<a name="13.1 Understanding Message Bundles"><!-- Legacy link --></a>
<h2 id="understandingMessageBundles">13.1 メッセージバンドルを理解する</h2>
<div class="hidden-block">Now that you have an idea of locales, to use them in Grails you create message bundle file containing the different languages that you wish to render. Message bundles in Grails are located inside the <code>grails-app/i18n</code> directory and are simple Java properties files.</div>
複数ロケールの表示に対応するには、それぞれの言語ごと複数のメッセージバンドルを用意します。メッセージバンドルはシンプルなJavaのプロパティファイルとして<code>grails-app/i18n</code>ディレクトリに配置します。<p class="paragraph"/><div class="hidden-block">Each bundle starts with the name <code>messages</code> by convention and ends with the locale. Grails ships with several message bundles for a whole range of languages within the <code>grails-app/i18n</code> directory. For example:</div>
各メッセージバンドルファイル名は<code>messages</code>からはじまり、ロケール名称で終わります。Grailsでは幾つかの言語のメッセージバンドルを<code>grails-app/i18n</code>ディレクトリに同梱しています。例として:
<ul class="star">
<li>messages.properties</li>
<li>messages_da.properties</li>
<li>messages_de.properties</li>
<li>messages_es.properties</li>
<li>messages_fr.properties</li>
<li>...</li>
</ul><p class="paragraph"/><div class="hidden-block">By default Grails looks in <code>messages.properties</code> for messages unless the user has specified a locale. You can create your own message bundle by simply creating a new properties file that ends with the locale you are interested. For example <code>messages_en_GB.properties</code> for British English.</div>
ユーザがロケールを指定していない場合、デフォルトで<code>messages.properties</code>を参照します。
独自のメッセージバンドルを作成するには、末尾がロケールのプロパティファイルを新規に作成します。たとえば、<code>messages_ja_JP.properties</code>とすれば日本国+日本語になります。

<a name="13.2 Changing Locales"><!-- Legacy link --></a>
<h2 id="changingLocales">13.2 ロケールの変更</h2>
<div class="hidden-block">By default the user locale is detected from the incoming <code>Accept-Language</code> header. However, you can provide users the capability to switch locales by simply passing a parameter called <code>lang</code> to Grails as a request parameter:</div>
デフォルトで<code>Accept-Languag</code>ヘッダーによりロケールが決まります。リクエストパラメータに<code>lang</code>を指定することでロケールを変更できます。<p class="paragraph"/><div class="code"><pre>/book/list?lang=es</pre></div><p class="paragraph"/><div class="hidden-block">Grails will automatically switch the user's locale and store it in a cookie so subsequent requests will have the new header.</div>
この指定でGrailsがユーザのロケールを変更して、後のリクエストでも使用できるようにクッキーに保存します。<p class="paragraph"/>

<a name="13.3 Reading Messages"><!-- Legacy link --></a>
<h2 id="readingMessages">13.3 メッセージ読込</h2>
<h4>ビュー内でのメッセージ読み込み <div class="hidden-block">Reading Messages in the View </div></h4><p class="paragraph"/><div class="hidden-block">The most common place that you need messages is inside the view. Use the <a href="../ref/Tags/message.html" class="tags">message</a> tag for this:</div>
メッセージを使うもっとも一般的な場所はビューの中です。ビューでメッセージを取得するには単に<a href="../ref/Tags/message.html" class="tags">message</a>タグを使います。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:message code=<span class="xml&#45;quote">"my.localized.content"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">As long as you have a key in your <code>messages.properties</code> (with appropriate locale suffix) such as the one below then Grails will look up the message:</div>
以下のようなキーが<code>messages.properties</code>(妥当なロケール接尾辞が付いている)に有る場合、Grailsがメッセージを取得できます:<p class="paragraph"/><div class="code"><pre>my.localized.content=Hola, Me llamo John. Hoy es domingo.</pre></div><p class="paragraph"/><div class="hidden-block">Messages can also include arguments, for example:</div>
メッセージは引数を含めることも可能です。例として:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:message code=<span class="xml&#45;quote">"my.localized.content"</span> args=<span class="xml&#45;quote">"$&#123; &#91;'Juan', 'lunes'&#93; &#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The message declaration specifies positional parameters which are dynamically specified:</div>
位置パラメータがメッセージに指定されていると動的に設定されます:<p class="paragraph"/><div class="code"><pre>my.localized.content=Hola, Me llamo &#123;0&#125;. Hoy es &#123;1&#125;.</pre></div><p class="paragraph"/><h4>コントローラとタグライブラリ内でのメッセージ読み込み <div class="hidden-block">Reading Messages in Controllers and Tag Libraries </div></h4><p class="paragraph"/><div class="hidden-block">It's simple to read messages in a controller since you can invoke tags as methods:</div>
コントローラでメッセージを読み込む場合はタグをメソッドとして実行します:<p class="paragraph"/><div class="code"><pre>def show() &#123;
    def msg = message(code: <span class="java&#45;quote">"my.localized.content"</span>, args: &#91;'Juan', 'lunes'&#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The same technique can be used in <a href="../guide/single.html#taglibs" class="guide">tag libraries</a>, but if your tag library uses a custom <a href="../guide/single.html#namespaces" class="guide">namespace</a> then you must prefix the call with <code>g.</code>:</div>
<a href="../guide/single.html#taglibs" class="guide">タグライブラリ</a>でも同じ方法が使用できます。タグライブラリがカスタム<a href="../guide/single.html#namespaces" class="guide">ネームスペース</a>を使用している場合は必ず接頭辞<code>g.</code>を使用します:<p class="paragraph"/><div class="code"><pre>def myTag = &#123; attrs, body &#45;&#62;
    def msg = g.message(code: <span class="java&#45;quote">"my.localized.content"</span>, args: &#91;'Juan', 'lunes'&#93;)
&#125;</pre></div>


<a name="13.4 Scaffolding and i18n"><!-- Legacy link --></a>
<h2 id="scaffoldingAndI18n">13.4 スカッフォルドとi18n</h2>
<div class="hidden-block">Grails <a href="../guide/single.html#scaffolding" class="guide">scaffolding</a> templates for controllers and views are fully i18n-aware. The GSPs use the <a href="../ref/Tags/message.html" class="tags">message</a> tag for labels, buttons etc. and controller <code>flash</code> messages use i18n to resolve locale-specific messages.</div>
Grailsの<a href="../guide/single.html#scaffolding" class="guide">スカッフォルド</a>テンプレートでのコントローラとビューはi18nに完全対応しています。GSPはラベルやボタンなどに<a href="../ref/Tags/message.html" class="tags">message</a>タグを使用し、コントローラは<code>flash</code>メッセージを使用して国際化にロケール対応メッセージを使用しています。

<a name="14. Security"><!-- Legacy link --></a>
<h1 id="security">14 セキュリティ</h1>
<div class="hidden-block">Grails is no more or less secure than Java Servlets. However, Java servlets (and hence Grails) are extremely secure and largely immune to common buffer overrun and malformed URL exploits due to the nature of the Java Virtual Machine underpinning the code.</div>
Grailsは、Javaサーブレットと同等にセキュアであり、Javaサーブレットと比べてどちらが安全、というものではありません。とは言え、Javaサーブレット(そしてGrails)は、コードを支えるJava仮想マシンの性質によって極めて安全で、一般的なバッファオーバーランや不正な形式のURLエクスプロイトに対して、多くの場合影響を受けません。<p class="paragraph"/><div class="hidden-block">Web security problems typically occur due to developer naivety or mistakes, and there is a little Grails can do to avoid common mistakes and make writing secure applications easier to write.</div>
Web上でのセキュリティ問題は、開発者の知識の無さやうっかりミスにより起こることが多いでしょう。そこで、よくあるミスを防ぎ、安全なアプリケーションとしてよりコーディングしやすくするために、Grailsでは次のようなちょっとした機能を提供します。<p class="paragraph"/><div class="hidden-block">h4. What Grails Automatically Does</div>
<h4>Grailsが自動的に行うこと</h4><p class="paragraph"/><div class="hidden-block">Grails has a few built in safety mechanisms by default.</div>
Grailsには、安全性を保つためデフォルトでいくつかのメカニズムが内蔵されています。<p class="paragraph"/><div class="hidden-block">
<ol>
<li>All standard database access via <a href="../guide/single.html#GORM" class="guide">GORM</a> domain objects is automatically SQL escaped to prevent SQL injection attacks</li>
<li>The default <a href="../guide/single.html#scaffolding" class="guide">scaffolding</a> templates HTML escape all data fields when displayed</li>
<li>Grails link creating tags (<a href="../ref/Tags/link.html" class="tags">link</a>, <a href="../ref/Tags/form.html" class="tags">form</a>, <a href="../ref/Tags/createLink.html" class="tags">createLink</a>, <a href="../ref/Tags/createLinkTo.html" class="tags">createLinkTo</a> and others) all use appropriate escaping mechanisms to prevent code injection</li>
<li>Grails provides <a href="../guide/single.html#codecs" class="guide">codecs</a> to let you trivially escape data when rendered as HTML, JavaScript and URLs to prevent injection attacks here.</li>
</ol><p class="paragraph"/></div>
<ol>
<li><a href="../guide/single.html#GORM" class="guide">GORM</a>経由でのすべての標準的なデータベースアクセスにおける、SQLインジェクション攻撃を防ぐための自動的なエスケープ処理</li>
<li>デフォルトの<a href="../guide/single.html#scaffolding" class="guide">スカッフォルド</a>テンプレートのHTMLにおける、すべてのデータフィールドに対する表示時のエスケープ処理</li>
<li>Grailsのリンク作成タグ(<a href="../ref/Tags/link.html" class="tags">link</a>、<a href="../ref/Tags/form.html" class="tags">form</a>、<a href="../ref/Tags/createLink.html" class="tags">createLink</a>、<a href="../ref/Tags/createLinkTo.html" class="tags">createLinkTo</a>他)における、コードインジェクションを防ぐための適切なエスケープ機構</li>
<li>GrailsでHTML、JavaScript、URLをレンダリングする際の、データを手軽にエスケープ処理しインジェクション攻撃を防ぐ<a href="../guide/single.html#codecs" class="guide">コーデック</a>の提供</li>
</ol><p class="paragraph"/>

<a name="14.1 Securing Against Attacks"><!-- Legacy link --></a>
<h2 id="securingAgainstAttacks">14.1 攻撃からの防御</h2>
<div class="hidden-block">h4. SQL injection</div>
<h4>SQLインジェクション</h4><p class="paragraph"/><div class="hidden-block">Hibernate, which is the technology underlying GORM domain classes, automatically escapes data when committing to database so this is not an issue. However it is still possible to write bad dynamic HQL code that uses unchecked request parameters. For example doing the following is vulnerable to HQL injection attacks:</div>
GORMドメインクラスの基盤であるHibernateは、データベースにコミットする際に自動的にデータをエスケープ処理するので、これは問題にはならないでしょう。しかしながら、未チェックなリクエストパラメータを用いた、よくない動的HQLコードを書いてしまうこともできてしまいます。例えば、以下のようなコードはHQLインジェクション攻撃に対して脆弱です:<p class="paragraph"/><div class="code"><pre>def vulnerable() &#123;
    def books = Book.find(<span class="java&#45;quote">"from Book as b where b.title ='"</span> + params.title + <span class="java&#45;quote">"'"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">or the analagous call using a GString:</div>
また、GStringを使用した以下のような呼び出しも同様です:<p class="paragraph"/><div class="code"><pre>def vulnerable() &#123;
    def books = Book.find(<span class="java&#45;quote">"from Book as b where b.title ='$&#123;params.title&#125;'"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Do <strong class="bold">not</strong> do this. Use named or positional parameters instead to pass in parameters:</div>
パラメータをそのまま渡すのではなく、必ず位置パラメータまたは名前付きパラメータを使うようにしましょう:<p class="paragraph"/><div class="code"><pre>def safe() &#123;
    def books = Book.find(<span class="java&#45;quote">"from Book as b where b.title = ?"</span>,
                          &#91;params.title&#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">or</div>
または、次のように書くこともできます:<p class="paragraph"/><div class="code"><pre>def safe() &#123;
    def books = Book.find(<span class="java&#45;quote">"from Book as b where b.title = :title"</span>,
                          &#91;title: params.title&#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Phishing</div>
<h4>フィッシング</h4><p class="paragraph"/><div class="hidden-block">This really a public relations issue in terms of avoiding hijacking of your branding and a declared communication policy with your customers. Customers need to know how to identify valid emails.</div>
あなたとお客様との間で交わされたコミュニケーションポリシーのもと、あなたのブランドのハイジャックを防ぐという観点から、これはまさしく広報の問題です。顧客には、(不正な発信元でない)真正なEメールであることをどう見分けるか、知らせておく必要があります。<p class="paragraph"/><div class="hidden-block">h4. XSS - cross-site scripting injection</div>
<h4>XSS - クロスサイトスクリプティングインジェクション</h4><p class="paragraph"/>
<div class="hidden-block">It is important that your application verifies as much as possible that incoming requests were originated from your application and not from another site. It is also important to ensure that all data values rendered into views are escaped correctly. For example when rendering to HTML or XHTML you must ensure that people cannot maliciously inject JavaScript or other HTML into data or tags viewed by others. </div>
要求されたリクエストがあなたのアプリケーションのものであり、他のサイトからではないということを、できる限り検証することが重要です。ビューにレンダリングされる全てのデータが、確実に、正しくエスケープ処理されることもまた重要です。例えば、HTMLまたはXHTMLをレンダリングする際、他人が見ることができるデータやタグに対して、JavaScriptや他のHTMLを悪意を持って挿入することができないようにする必要があります。<p class="paragraph"/><div class="hidden-block">Grails 2.3 and above include special support for automatically encoded data placed into GSP pages. See the documentation on <a href="../guide/single.html#xssPrevention" class="guide">Cross Site Scripting (XSS) prevention</a> for further information.</div>
Grails 2.3以降では、自動的にエンコードしたデータをGSPに配置する仕組みが実装されています。詳しくは <a href="../guide/single.html#xssPrevention" class="guide">クロスサイトスクリプティング(XSS)防御</a> のドキュメントを参照してください。<p class="paragraph"/><div class="hidden-block">You must also avoid the use of request parameters or data fields for determining the next URL to redirect the user to. If you use a <code>successURL</code> parameter for example to determine where to redirect a user to after a successful login, attackers can imitate your login procedure using your own site, and then redirect the user back to their own site once logged in, potentially allowing JavaScript code to then exploit the logged-in account on the site.</div>
ユーザのリダイレクト先URLを決めるためにリクエストパラメータやデータフィールドを使うこともまた、避けなければなりません。ログイン成功後、ユーザをどこへリダイレクトするか決定するために、例えば、あなたが<code>successURL</code>パラメータを使うような場合、攻撃者は、あなた自身のサイトを利用してログイン手順を偽装し、ユーザがログインしようとしたときに攻撃者自身のサイトにリダイレクトさせることができてしまいます。これは、潜在的に、サイト上のログインアカウントを悪用するJavaScriptコードを許していることになります。<p class="paragraph"/><div class="hidden-block">h4. Cross-site request forgery</div>
<h4>クロスサイトリクエストフォージェリ</h4><p class="paragraph"/><div class="hidden-block">CSRF involves unauthorized commands being transmitted from a user that a website trusts. A typical example would be another website embedding a link to perform an action on your website if the user is still authenticated.</div>
CSRFは、ウェブサイト上の正規ユーザから、承認されていないコマンド送信を引き起こします。認証されている状態のユーザが、別のウェブサイト内に埋め込まれたリンクによって、あなたのウェブサイト上で意図しないアクションを引き起こすようなものが典型的な例です。<p class="paragraph"/><div class="hidden-block">The best way to decrease risk against these types of attacks is to use the <code>useToken</code> attribute on your forms. See <a href="../guide/single.html#formtokens" class="guide">Handling Duplicate Form Submissions</a> for more information on how to use it. An additional measure would be to not use remember-me cookies.</div>
こうした攻撃のリスクを軽減する最良の方法は、フォームに<code>useToken</code>属性を使うことです。使い方についての詳細は、<a href="../guide/single.html#formtokens" class="guide">フォーム二重送信のハンドリング</a>を参照してください。加えて、「次回からパスワードの入力を省略する」というような機能を提供するクッキーを使わないことも対策の一つです。<p class="paragraph"/><div class="hidden-block">h4. HTML/URL injection</div>
<h4>HTML/URLインジェクション</h4><p class="paragraph"/><div class="hidden-block">This is where bad data is supplied such that when it is later used to create a link in a page, clicking it will not cause the expected behaviour, and may redirect to another site or alter request parameters.</div>
これは、悪意のあるデータが与えられ、後にあるページにおいてリンクの生成に使用されると、クリックしても期待するような動作にならない事象を指します。そして、別のサイトにリダイレクトされたり、要求パラメータを改ざんされたりする可能性もあります。<p class="paragraph"/><div class="hidden-block">HTML/URL injection is easily handled with the <a href="../guide/single.html#codecs" class="guide">codecs</a> supplied by Grails, and the tag libraries supplied by Grails all use <a href="../guide/single.html#codecs" class="guide">encodeAsURL</a> where appropriate. If you create your own tags that generate URLs you will need to be mindful of doing this too.</div>
HTML/URLインジェクションは、Grailsが提供する<a href="../guide/single.html#codecs" class="guide">コーデック</a>により、容易に対処できます。また、Grailsが提供しているタグライブラリは、全て適切なところで<a href="../guide/single.html#codecs" class="guide">encodeAsURL</a>を使います。もし、URLを生成するようなタグを自分で作成するのなら、この対処も意識しておく必要があるでしょう。<p class="paragraph"/><div class="hidden-block">h4. Denial of service</div>
<h4>サービス妨害</h4><p class="paragraph"/><div class="hidden-block">Load balancers and other appliances are more likely to be useful here, but there are also issues relating to excessive queries for example where a link is created by an attacker to set the maximum value of a result set so that a query could exceed the memory limits of the server or slow the system down. The solution here is to always sanitize request parameters before passing them to dynamic finders or other GORM query methods:</div>
ここでは、負荷分散装置やその他のアプライアンスが、より有用でしょう。ですが、サーバのメモリ容量を超えること、あるいはシステムを遅くさせることを目的に、結果の最大値を書き換えた超過クエリを発行するようなリンクを攻撃者が作成する、といった課題もあります。これに対する解決法は、ダイナミックファインダーやその他のGROMクエリメソッドにリクエストパラメータを渡す前に、常にサニタイズすることです:<p class="paragraph"/><div class="hidden-block">
<div class="code"><pre>def safeMax = <span class="java&#45;object">Math</span>.max(params.max?.toInteger(), 100) // limit to 100 results
<span class="java&#45;keyword">return</span> Book.list(max:safeMax)</pre></div>
</div>
<div class="code"><pre>def safeMax = <span class="java&#45;object">Math</span>.max(params.max?.toInteger(), 100) // 結果を100件に制限する
<span class="java&#45;keyword">return</span> Book.list(max:safeMax)</pre></div><p class="paragraph"/><div class="hidden-block">h4. Guessable IDs</div>
<h4>推測可能なID</h4><p class="paragraph"/><div class="hidden-block">Many applications use the last part of the URL as an "id" of some object to retrieve from GORM or elsewhere. Especially in the case of GORM these are easily guessable as they are typically sequential integers.</div>
多くのアプリケーションで、URLの最後の部分を、GORMや他のところから取り出す何らかのオブジェクトのIDとして利用するでしょう。特にGORMの場合、これらは容易に推測可能です。なぜならそれは、一般的にシーケンシャルな整数だからです。<p class="paragraph"/><div class="hidden-block">Therefore you must assert that the requesting user is allowed to view the object with the requested id before returning the response to the user.</div>
それゆえ、ユーザにレスポンスを返す前に、要求しているユーザが、要求されているIDのオブジェクトを見ることができるか必ず検証するべきです。<p class="paragraph"/><div class="hidden-block">Not doing this is "security through obscurity" which is inevitably breached, just like having a default password of "letmein" and so on.</div>
これをしないということは "security through obscurity(※脆弱性をユーザーから隠せば、悪用は防げるという考え)" であり、すなわち "letmein" のようなデフォルトパスワードを使うのと同様、そのうち破られることになるでしょう。<p class="paragraph"/><div class="hidden-block">You must assume that every unprotected URL is publicly accessible one way or another.</div>
いずれにせよ、全ての保護されていないURLは、当然誰からもアクセス可能であると考えなければなりません。


<a name="13.2 Cross Site Scripting (XSS) Prevention"><!-- Legacy link --></a>
<h2 id="xssPrevention">14.2 クロスサイトスクリプティング(XSS)防御</h2>
Cross Site Scripting (XSS) attacks are a common attack vector for web applications. They typically involve submitting HTML or Javascript code in a form such that when that code is displayed, the browser does something nasty. It could be as simple as popping up an alert box, or it could be much worse. The solution is to escape all untrusted user input when it is displayed in a page. For example,<p class="paragraph"/><div class="code"><pre>&#60;script&#62;alert('Got ya!');&#60;/script&#62;</pre></div><p class="paragraph"/>will become<p class="paragraph"/><div class="code"><pre>&#38;lt;script&#38;gt;alert('Got ya!');&#38;lt;/script&#38;gt;</pre></div><p class="paragraph"/>when rendered, nullifying the effects of the malicious input.<p class="paragraph"/>By default, Grails plays it safe and escapes all content in <code>${}</code> expressions in GSPs. All the standard GSP tags are also safe by default, escaping any relevant attribute values.<p class="paragraph"/>So what happens when you want to stop Grails from escaping some content? There are valid use cases for putting HTML into the database and rendering it as-is, as long as that content is <strong class="bold">trusted</strong>. In such cases, you can tell Grails that the content is safe as should be rendered raw, i.e. without any escaping:<p class="paragraph"/><div class="code"><pre>&#60;section&#62;$&#123;raw(page.content)&#125;&#60;/section&#62;</pre></div><p class="paragraph"/>The <code>raw()</code> method you see here is available from controllers, tag libraries and GSP pages.<p class="paragraph"/><blockquote class="warning">Although Grails plays it safe by default, that is no guarantee that your application will be invulnerable to an XSS-style attack. Such an attack is less likely to succeed than would otherwise be the case, but developers should always be conscious of potential attack vectors and attempt to uncover vulnerabilities in the application during testing. It's also easy to switch to an unsafe default, thereby increasing the risk of a vulnerability being introduced.</blockquote><p class="paragraph"/>It's difficult to make a solution that works for everyone, and so Grails provides a lot of flexibility with regard to fine-tuning how escaping works, allowing you to keep most of your application safe while switching off default escaping or changing the codec used for pages, tags, page fragments, and more.<p class="paragraph"/><h4>Configuration</h4><p class="paragraph"/>It is recommended that you review the configuration of a newly created Grails application to garner an understanding of XSS prevention works in Grails.<p class="paragraph"/>GSP features the ability to automatically HTML encode GSP expressions, and as of Grails 2.3 this is the default configuration.  The default configuration (found in <code>Config.groovy</code>) for a newly created Grails application can be seen below:<p class="paragraph"/><div class="code"><pre>grails &#123;
        views &#123;
            gsp &#123;
                encoding = 'UTF&#45;8'
                htmlcodec = 'xml' // use xml escaping instead of HTML4 escaping
                codecs &#123;
                    expression = 'html' // escapes values inside $&#123;&#125;
                    scriptlet = 'html' // escapes output from scriptlets in GSPs
                    taglib = 'none' // escapes output from taglibs
                    staticparts = 'none' // escapes output from <span class="java&#45;keyword">static</span> template parts
                &#125;
            &#125;
            // escapes all not&#45;encoded output at <span class="java&#45;keyword">final</span> stage of outputting
            filteringCodecForContentType &#123;
                //'text/html' = 'html'
            &#125;
        &#125;
    &#125;</pre></div><p class="paragraph"/>GSP features several codecs that it uses when writing the page to the response. The codecs are configured in the <code>codecs</code> block and are described below:
<ul class="star">
<li><code>expression</code> - The expression codec is used to encode any code found within ${..} expressions. The default for newly created application is <code>html</code> encoding.</li>
<li><code>scriptlet</code> - Used for output from GSP scriplets (&#60;% %&#62;, &#60;%= %&#62; blocks). The default for newly created applications is <code>html</code> encoding</li>
<li><code>taglib</code> - Used to encode output from GSP tag libraries. The default is <code>none</code> for new applications, as typically it is the responsibility of the tag author to define the encoding of a given tag and by specifying <code>none</code> Grails remains backwards compatible with older tag libraries.</li>
<li><code>staticparts</code> - Used to encode the raw markup output by a GSP page. The default is <code>none</code>.</li>
</ul><p class="paragraph"/><h4>Double Encoding Prevention</h4><p class="paragraph"/>Versions of Grails prior to 2.3, included the ability to set the default codec to <code>html</code>, however enabling this setting sometimes proved problematic when using existing plugins due to encoding being applied twice (once by the <code>html</code> codec and then again if the plugin manually called <code>encodeAsHTML</code>).<p class="paragraph"/>Grails 2.3 includes double encoding prevention so that when an expression is evaluated, it will not encode if the data has already been encoded (Example <code>${foo.encodeAsHTML()}</code>).<p class="paragraph"/><h4>Raw Output</h4><p class="paragraph"/>If you are 100% sure that the value you wish to present on the page has not been received from user input, and you do not wish the value to be encoded then you can use the <code>raw</code> method:<p class="paragraph"/><div class="code"><pre>$&#123;raw(book.title)&#125;</pre></div><p class="paragraph"/>The 'raw' method is available in tag libraries, controllers and GSP pages.<p class="paragraph"/><h4>Per Plugin Encoding</h4><p class="paragraph"/>Grails also features the ability to control the codecs used on a per plugin basis. For example if you have a plugin named <code>foo</code> installed, then placing the following configuration in your application's <code>Config.groovy</code> will disable encoding for only the <code>foo</code> plugin<p class="paragraph"/><div class="code"><pre>foo.grails.views.gsp.codecs.expression = <span class="java&#45;quote">"none"</span></pre></div><p class="paragraph"/><h4>Per Page Encoding</h4><p class="paragraph"/>You can also control the various codecs used to render a GSP page on a per page basis, using a page directive:<p class="paragraph"/><div class="code"><pre>&#60;%@page expressionCodec=<span class="java&#45;quote">"none"</span> %&#62;</pre></div><p class="paragraph"/><h4>Per Tag Library Encoding</h4><p class="paragraph"/>Each tag library created has the opportunity to specify a default codec used to encode output from the tag library using the "defaultEncodeAs" property:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> defaultEncodeAs = 'html'</pre></div><p class="paragraph"/>Encoding can also be specified on a per tag basis using "encodeAsForTags":<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> encodeAsForTags = &#91;tagName: 'raw'&#93;</pre></div><p class="paragraph"/><h4>Context Sensitive Encoding Switching</h4><p class="paragraph"/>Certain tags require certain encodings and Grails features the ability to enable a codec only a certain part of a tag's execution using the "withCodec" method. Consider for example the "&#60;g:javascript&#62;"" tag which allows you to embed JavaScript code in the page. This tag requires JavaScript encoding, not HTML coding for the execution of the body of the tag (but not for the markup that is output):<p class="paragraph"/><div class="code"><pre>out.println '&#60;script type=<span class="java&#45;quote">"text/javascript"</span>&#62;'
    withCodec(<span class="java&#45;quote">"JavaScript"</span>) &#123;
        out &#60;&#60; body()
    &#125;
    out.println()
    out.println '&#60;/script&#62;'</pre></div><p class="paragraph"/><h4>Forced Encoding for Tags</h4><p class="paragraph"/>If a tag specifies a default encoding that differs from your requirements you can force the encoding for any tag by passing the optional 'encodeAs' attribute:<p class="paragraph"/><div class="code"><pre>&#60;g:message code=<span class="java&#45;quote">"foo.bar"</span> encodeAs=<span class="java&#45;quote">"JavaScript"</span> /&#62;</pre></div><p class="paragraph"/><h4>Default Encoding for All Output</h4><p class="paragraph"/>The default configuration for new applications is fine for most use cases, and backwards compatible with existing plugins and tag libraries. However, you can also make your application even more secure by configuring Grails to always encode all output at the end of a response. This is done using the <code>filteringCodecForContentType</code> configuration in <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.views.gsp.filteringCodecForContentType.'text/html' = 'html'</pre></div><p class="paragraph"/>Note that, if activated, the <code>staticparts</code> codec typically needs to be set to <code>raw</code> so that static markup is not encoded:<p class="paragraph"/><div class="code"><pre>codecs &#123;
        expression = 'html' // escapes values inside $&#123;&#125;
        scriptlet = 'html' // escapes output from scriptlets in GSPs
        taglib = 'none' // escapes output from taglibs
        staticparts = 'raw' // escapes output from <span class="java&#45;keyword">static</span> template parts
    &#125;</pre></div><p class="paragraph"/>

<a name="14.2 Encoding and Decoding Objects"><!-- Legacy link --></a>
<h2 id="codecs">14.3 エンコード・デコードオブジェクト</h2>
<div class="hidden-block">Grails supports the concept of dynamic encode/decode methods.  A set of standard codecs are bundled with Grails.  Grails also supports a simple mechanism for developers to contribute their own codecs that will be recognized at runtime.</div>
Grailsは動的なエンコード/デコードメソッドという考え方をサポートしています。標準的なコーデックはGrailsにバンドルされているほか、開発者が独自のコーデックを簡単に定義することのできるメカニズムも備えています。<p class="paragraph"/><div class="hidden-block">h4. Codec Classes</div>
<h4>コーデッククラス</h4><p class="paragraph"/><div class="hidden-block">A Grails codec class is one that may contain an encode closure, a decode closure or both.  When a Grails application starts up the Grails framework dynamically loads codecs from the <code>grails-app/utils/</code> directory.</div>
Grailsのコーデッククラスは、encodeクロージャとdecodeクロージャのいずれか、または両方を実装したものです。Grailsフレームワークは、Grailsアプリケーションが起動するときに、<code>grails-app/utils/</code>ディレクトリ以下にあるコーデックを動的にロードします。<p class="paragraph"/><div class="hidden-block">The framework looks under <code>grails-app/utils/</code> for class names that end with the convention <code>Codec</code>.  For example one of the standard codecs that ships with Grails is <code>HTMLCodec</code>.</div>
Grailsフレームワークは<code>grails-app/utils/</code>ディレクトリ以下にある、<code>Codec</code>という名前で終わるクラスを探します。例えば、Grailsに標準で実装されているコーデックの一つに<code>HTMLCodec</code>があります。<p class="paragraph"/><div class="hidden-block">If a codec contains an <code>encode</code> closure Grails will create a dynamic <code>encode</code> method and add that method to the <code>Object</code> class with a name representing the codec that defined the encode closure. For example, the <code>HTMLCodec</code> class defines an <code>encode</code> closure, so Grails attaches it with the name <code>encodeAsHTML</code>.</div>
コーデックに<code>encode</code>クロージャが定義されている場合、Grailsは動的な<code>encode</code>メソッドを作成し、そのクロージャを定義しているコーデックの名前でそのメソッドを<code>Object</code>クラスに追加します。例えば、<code>HTMLCodec</code>クラスでは<code>encode</code>クロージャが定義されているため、Grailsは<code>encodeAsHTML</code>という名前でメソッドを追加します。<p class="paragraph"/><div class="hidden-block">The <code>HTMLCodec</code> and <code>URLCodec</code> classes also define a <code>decode</code> closure, so Grails attaches those with the names <code>decodeHTML</code> and <code>decodeURL</code> respectively. Dynamic codec methods may be invoked from anywhere in a Grails application. For example, consider a case where a report contains a property called 'description' which may contain special characters that must be escaped to be presented in an HTML document.  One way to deal with that in a GSP is to encode the description property using the dynamic encode method as shown below:</div>
さらに、<code>HTMLCodec</code>クラスと<code>URLCodec</code>クラスでは<code>decode</code>クロージャも定義されているので、Grailsはこれらをそれぞれ<code>decodeHTML</code>, <code>decodeURL</code>という名前で追加します。動的なコーデックメソッドはGrailsアプリケーションのどこからでも呼び出すことができます。例えば、<code>report</code>が<code>description</code>という名前のプロパティを持っているケースを想定します。<code>description</code>は特殊文字を文字を含んでいる可能性があるため、HTMLドキュメントとして表示させる前にエスケープする必要があるとします。GSPでこれを実現する一つの方法は、以下のように、動的なエンコードメソッドを使用して<code>description</code>プロパティをエンコードすることです:<p class="paragraph"/><div class="code"><pre>$&#123;report.description.encodeAsHTML()&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Decoding is performed using <code>value.decodeHTML()</code> syntax.</div>
同様に、デコードは<code>value.decodeHTML()</code>というような形で行うことができます。<p class="paragraph"/><div class="hidden-block">h4. Standard Codecs</div>
<h4>標準コーデック</h4><p class="paragraph"/><div class="hidden-block"><strong class="bold">HTMLCodec</strong></div>
<strong class="bold">HTMLCodec</strong><p class="paragraph"/><div class="hidden-block">This codec performs HTML escaping and unescaping, so that values can be rendered safely in an HTML page without creating any HTML tags or damaging the page layout. For example, given a value "Don't you know that 2 &#62; 1?" you wouldn't be able to show this safely within an HTML page because the &#62; will look like it closes a tag, which is especially bad if you render this data within an attribute, such as the value attribute of an input field.</div>
このコーデックはHTMLのエスケープ/アンエスケープ処理を行います。これにより、HTMLタグが挿入されたりレイアウトを破壊される恐れなく、安全にHTMLページで値を表示することができます。例えば、"Don't you know that 2 &#62; 1?" という文章を表示することを考えてみます。&#62; が閉じタグのように扱われてしまうため、この値をエスケープ処理なしで安全にHTMLページに表示させることはできません。このようなデータを属性 (例えばinputフィールドのvalue属性) の中に表示させる場合はさらに大変です。<p class="paragraph"/><div class="hidden-block">Example of usage:</div>
使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>&#60;input name=<span class="java&#45;quote">"comment.message"</span> value=<span class="java&#45;quote">"$&#123;comment.message.encodeAsHTML()&#125;"</span>/&#62;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Note that the HTML encoding does not re-encode apostrophe/single quote so you must use double quotes on attribute values to avoid text with apostrophes affecting your page.</div>
HTMLエンコードでは、アポストロフィ/シングルクォートを再エンコードしないことに注意してください。エンコードする文字列にアポストロフィが入っている場合に備えて、属性の値はダブルクォートで括ってください。
</blockquote><p class="paragraph"/><div class="hidden-block"><strong class="bold">URLCodec</strong></div>
<strong class="bold">URLCodec</strong><p class="paragraph"/><div class="hidden-block">URL encoding is required when creating URLs in links or form actions, or any time data is used to create a URL. It prevents illegal characters from getting into the URL and changing its meaning, for example "Apple &#38; Blackberry" is not going to work well as a parameter in a GET request as the ampersand will break parameter parsing.</div>
URLエンコードは、リンクやフォームのアクション用にURLを生成する場合や、データを使ってURLを作成するあらゆる場合に必要です。エンコードすることによって、URLに不正な文字列が混入して意味を変えてしまうことを防ぐことができます。例えば、"Apple &#38; Blackberry" という文字列には &#38; 記号が含まれているため、そのままGETリクエストのパラメタとして使用することができません。<p class="paragraph"/><div class="hidden-block">Example of usage:</div>
使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>&#60;a href=<span class="java&#45;quote">"/mycontroller/find?searchKey=$&#123;lastSearch.encodeAsURL()&#125;"</span>&#62;
Repeat last search
&#60;/a&#62;</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">Base64Codec</strong></div>
<strong class="bold">Base64Codec</strong><p class="paragraph"/><div class="hidden-block">Performs Base64 encode/decode functions. Example of usage:</div>
Base64エンコード/デコードを行います。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>Your registration code is: $&#123;user.registrationCode.encodeAsBase64()&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">JavaScriptCodec</strong></div>
<strong class="bold">JavaScriptCodec</strong><p class="paragraph"/><div class="hidden-block">Escapes Strings so they can be used as valid JavaScript strings. For example:</div>
JavaScriptの文字列として正しい形式になるように、文字列をエスケープします。例えば次のように使用します:<p class="paragraph"/><div class="code"><pre>Element.update('$&#123;elementId&#125;',
    '$&#123;render(template: <span class="java&#45;quote">"/common/message"</span>).encodeAsJavaScript()&#125;')</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">HexCodec</strong></div>
<strong class="bold">HexCodec</strong><p class="paragraph"/><div class="hidden-block">Encodes byte arrays or lists of integers to lowercase hexadecimal strings, and can decode hexadecimal strings into byte arrays. For example:</div>
byte配列または整数のリストを小文字16進数表記の文字列にエンコードしたり、逆に16進数表記の文字列をbyte配列にデコードすることができます。例えば次のように使用します:<p class="paragraph"/><div class="code"><pre>Selected colour: &#35;$&#123;&#91;255,127,255&#93;.encodeAsHex()&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">MD5Codec</strong></div>
<strong class="bold">MD5Codec</strong><p class="paragraph"/><div class="hidden-block">Uses the MD5 algorithm to digest byte arrays or lists of integers, or the bytes of a string (in default system encoding), as a lowercase hexadecimal string. Example of usage:</div>
MD5アルゴリズムを使用してbyte配列や整数のリスト、文字列 (システムのデフォルトエンコーディング) のダイジェスト値を計算し、小文字16進数表記の文字列にエンコードします。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>Your API Key: $&#123;user.uniqueID.encodeAsMD5()&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">MD5BytesCodec</strong></div>
<strong class="bold">MD5BytesCodec</strong><p class="paragraph"/><div class="hidden-block">Uses the MD5 algorithm to digest byte arrays or lists of integers, or the bytes of a string (in default system encoding), as a byte array. Example of usage:</div>
MD5アルゴリズムを使用してbyte配列や整数のリスト、文字列 (システムのデフォルトエンコーディング) のダイジェスト値を計算し、byte配列にエンコードします。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;object">byte</span>&#91;&#93; passwordHash = params.password.encodeAsMD5Bytes()</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">SHA1Codec</strong></div>
<strong class="bold">SHA1Codec</strong><p class="paragraph"/><div class="hidden-block">Uses the SHA1 algorithm to digest byte arrays or lists of integers, or the bytes of a string (in default system encoding), as a lowercase hexadecimal string. Example of usage:</div>
SHA1アルゴリズムを使用してbyte配列や整数のリスト、文字列 (システムのデフォルトエンコーディング) のダイジェスト値を計算し、小文字16進数表記の文字列にエンコードします。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>Your API Key: $&#123;user.uniqueID.encodeAsSHA1()&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">SHA1BytesCodec</strong></div>
<strong class="bold">SHA1BytesCodec</strong><p class="paragraph"/><div class="hidden-block">Uses the SHA1 algorithm to digest byte arrays or lists of integers, or the bytes of a string (in default system encoding), as a byte array. Example of usage:</div>
SHA1アルゴリズムを使用してbyte配列や整数のリスト、文字列 (システムのデフォルトエンコーディング) のダイジェスト値を計算し、byte配列にエンコードします。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;object">byte</span>&#91;&#93; passwordHash = params.password.encodeAsSHA1Bytes()</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">SHA256Codec</strong></div>
<strong class="bold">SHA256Codec</strong><p class="paragraph"/><div class="hidden-block">Uses the SHA256 algorithm to digest byte arrays or lists of integers, or the bytes of a string (in default system encoding), as a lowercase hexadecimal string. Example of usage:</div>
SHA256アルゴリズムを使用してbyte配列や整数のリスト、文字列 (システムのデフォルトエンコーディング) のダイジェスト値を計算し、小文字16進数表記の文字列にエンコードします。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre>Your API Key: $&#123;user.uniqueID.encodeAsSHA256()&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><strong class="bold">SHA256BytesCodec</strong></div>
<strong class="bold">SHA256BytesCodec</strong><p class="paragraph"/><div class="hidden-block">Uses the SHA256 algorithm to digest byte arrays or lists of integers, or the bytes of a string (in default system encoding), as a byte array. Example of usage:</div>
SHA256アルゴリズムを使用してbyte配列や整数のリスト、文字列 (システムのデフォルトエンコーディング) のダイジェスト値を計算し、byte配列にエンコードします。使用例を以下に示します:<p class="paragraph"/><div class="code"><pre><span class="java&#45;object">byte</span>&#91;&#93; passwordHash = params.password.encodeAsSHA256Bytes()</pre></div><p class="paragraph"/><div class="hidden-block">h4. Custom Codecs</div>
<h4>カスタムコーデック</h4><p class="paragraph"/><div class="hidden-block">Applications may define their own codecs and Grails will load them along with the standard codecs. A custom codec class must be defined in the <code>grails-app/utils/</code> directory and the class name must end with <code>Codec</code>. The codec may contain a <code>static</code> <code>encode</code> closure, a <code>static</code> <code>decode</code> closure or both. The closure must accept a single argument which will be the object that the dynamic method was invoked on. For Example:</div>
アプリケーションで必要なコーデックを定義しておくと、Grailsは標準コーデックと同様にロードします。カスタムコーデックのクラスは<code>grails-app/utils/</code>ディレクトリ以下に配置され、かつ、クラス名は<code>Codec</code>で終わる必要があります。コーデックには<code>static</code> <code>encode</code>クロージャと<code>static</code> <code>decode</code>クロージャのいずれかまたは両方を定義することができます。これらのクロージャは、1引数 (動的なメソッドとして実行された際にエンコード/デコード対象のオブジェクトになります) を受け付ける必要があります。例えば、以下のように記述します:<p class="paragraph"/><div class="code"><pre>class PigLatinCodec &#123;
  <span class="java&#45;keyword">static</span> encode = &#123; str &#45;&#62;
    // convert the string to pig latin and <span class="java&#45;keyword">return</span> the result
  &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With the above codec in place an application could do something like this:</div>
上の例のようなコーデックが定義されているとき、アプリケーションから以下のように使用することができます:<p class="paragraph"/><div class="code"><pre>$&#123;lastName.encodeAsPigLatin()&#125;</pre></div>


<a name="14.3 Authentication"><!-- Legacy link --></a>
<h2 id="authentication">14.4 認証</h2>
<div class="hidden-block">Grails has no default mechanism for authentication as it is possible to implement authentication in many different ways. It is however, easy to implement a simple authentication mechanism using either <a href="../guide/single.html#interceptors" class="guide">interceptors</a> or <a href="../guide/single.html#filters" class="guide">filters</a>. This is sufficient for simple use cases but it's highly preferable to use an established security framework, for example by using the <a href="../guide/single.html#springSecurity" class="guide">Spring Security</a> or the <a href="../guide/single.html#shiro" class="guide">Shiro</a> plugin.</div>
認証は様々な方法で実装することができるため、Grailsではデフォルトの認証メカニズムを提供していません。<a href="../guide/single.html#interceptors" class="guide">インターセプター</a>や<a href="../guide/single.html#filters" class="guide">フィルタ</a>を使用することで、単純な認証であれば簡単に実装することができます。これらの機能は多くのユースケースにおいて十分ですが、実績のあるセキュリティフレームワークを使用することがより望ましいでしょう。セキュリティフレームワークには、例えば<a href="../guide/single.html#springSecurity" class="guide">Spring Security</a>や<a href="../guide/single.html#shiro" class="guide">Shiro</a>プラグインなどがあります。<p class="paragraph"/><div class="hidden-block">Filters let you apply authentication across all controllers or across a URI space. For example you can create a new set of filters in a class called <code>grails-app/conf/SecurityFilters.groovy</code> by running:</div>
フィルタを使うと、すべてのコントローラやURI空間に対して認証を適用できます。例えば、以下のコマンドを実行することで、<code>grails-app/conf/SecurityFilters.groovy</code>というクラスに新しいフィルタセットが生成されます:<p class="paragraph"/><div class="code"><pre>grails create&#45;filters security</pre></div><p class="paragraph"/><div class="hidden-block">and implement your interception logic there:</div>
このクラスに、インターセプターのロジックを実装します:<p class="paragraph"/><div class="code"><pre>class SecurityFilters &#123;
    def filters = &#123;
        loginCheck(controller: '&#42;', action: '&#42;') &#123;
            before = &#123;
                <span class="java&#45;keyword">if</span> (!session.user &#38;&#38; actionName != <span class="java&#45;quote">"login"</span>) &#123;
                    redirect(controller: <span class="java&#45;quote">"user"</span>, action: <span class="java&#45;quote">"login"</span>)
                    <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
                &#125;
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here the <code>loginCheck</code> filter intercepts execution  <em class="italic">before</em>  all actions except <code>login</code> are executed, and if there is no user in the session then redirect to the <code>login</code> action.</div>
この例では、<code>loginCheck</code>フィルタがすべてのアクションの実行前にインターセプトされます。ただし、セッションにユーザが存在しない状態で<code>login</code>以外のアクションが呼び出された場合は、<code>login</code>アクションにリダイレクトされます。<p class="paragraph"/><div class="hidden-block">The <code>login</code> action itself is simple too:</div>
<code>login</code>アクションの実装も簡単です:<p class="paragraph"/><div class="code"><pre>def login() &#123;
    <span class="java&#45;keyword">if</span> (request.get) &#123;
        <span class="java&#45;keyword">return</span> // render the login view
    &#125;<p class="paragraph"/>    def u = User.findByLogin(params.login)
    <span class="java&#45;keyword">if</span> (u) &#123;
        <span class="java&#45;keyword">if</span> (u.password == params.password) &#123;
            session.user = u
            redirect(action: <span class="java&#45;quote">"home"</span>)
        &#125;
        <span class="java&#45;keyword">else</span> &#123;
            render(view: <span class="java&#45;quote">"login"</span>, model: &#91;message: <span class="java&#45;quote">"Password incorrect"</span>&#93;)
        &#125;
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
        render(view: <span class="java&#45;quote">"login"</span>, model: &#91;message: <span class="java&#45;quote">"User not found"</span>&#93;)
    &#125;
&#125;</pre></div>


<a name="14.4 Security Plug-ins"><!-- Legacy link --></a>
<h2 id="securityPlugins">14.5 セキュリティプラグイン</h2>
<div class="hidden-block">If you need more advanced functionality beyond simple authentication such as authorization, roles etc. then you should consider using one of the available security plugins.</div>
認可やロールなど、単純な認証以上の機能が必要な場合、以下のようなセキュリティプラグインの利用を検討してください。


<a name="14.4.1 Spring Security"><!-- Legacy link --></a>
<h2 id="springSecurity">14.5.1 Spring Security</h2>
<div class="hidden-block">The Spring Security plugins are built on the <a href="http://static.springsource.org/spring-security/site/" target="blank">Spring Security</a> project which provides a flexible, extensible framework for building all sorts of authentication and authorization schemes. The plugins are modular so you can install just the functionality that you need for your application. The Spring Security plugins are the official security plugins for Grails and are actively maintained and supported.</div>
Spring Securityプラグインは、<a href="http://static.springsource.org/spring-security/site/" target="blank">Spring Security</a>プロジェクトをGrailsで利用可能にします。Spring Securityプロジェクトでは、様々な種類の認証/認可スキームを実装するための柔軟で拡張可能なフレームワークを提供しています。このプラグインはモジュール化されているため、アプリケーションに必要な機能だけをインストールすることができます。Spring SecurityプラグインはGrailsの公式セキュリティプラグインで、活発にメンテナンスとサポートが行われています。<p class="paragraph"/><div class="hidden-block">There is a <a href="http://grails.org/plugin/spring-security-core" target="blank">Core plugin</a> which supports form-based authentication, encrypted/salted passwords, HTTP Basic authentication, etc. and secondary dependent plugins provide alternate functionality such as <a href="http://grails.org/plugin/spring-security-openid" target="blank">OpenID authentication</a>, <a href="http://grails.org/plugin/spring-security-acl" target="blank">ACL support</a>, <a href="http://grails.org/plugin/spring-security-cas" target="blank">single sign-on with Jasig CAS</a>, <a href="http://grails.org/plugin/spring-security-ldap" target="blank">LDAP authentication</a>, <a href="http://grails.org/plugin/spring-security-kerberos" target="blank">Kerberos authentication</a>, and a plugin providing <a href="http://grails.org/plugin/spring-security-ui" target="blank">user interface extensions</a> and security workflows.</div>
<a href="http://grails.org/plugin/spring-security-core" target="blank">Coreプラグイン</a>では、フォームベースの認証、パスワードの暗号化(ソルトを加えることもできる)、HTTP Basic認証などをサポートしています。Coreプラグインに依存するプラグインを利用することで、例えば<a href="http://grails.org/plugin/spring-security-openid" target="blank">OpenID認証</a>、<a href="http://grails.org/plugin/spring-security-acl" target="blank">ACL</a>、<a href="http://grails.org/plugin/spring-security-cas" target="blank">Jasig CASを利用したシングルサインオン</a>、<a href="http://grails.org/plugin/spring-security-ldap" target="blank">LDAP認証</a>、<a href="http://grails.org/plugin/spring-security-kerberos" target="blank">Kerberos認証</a>などの機能を利用できるほか、<a href="http://grails.org/plugin/spring-security-ui" target="blank">ユーザインタフェース拡張</a>やセキュリティワークフローを提供するプラグインもあります。<p class="paragraph"/><div class="hidden-block">See the <a href="http://grails.org/plugin/spring-security-core" target="blank">Core plugin page</a> for basic information and the <a href="http://burtbeckwith.github.com/grails-spring-security-core/" target="blank">user guide</a> for detailed information.</div>
基本的な情報については<a href="http://grails.org/plugin/spring-security-core" target="blank">Coreプラグインのページ</a>を、詳細な情報については<a href="http://burtbeckwith.github.com/grails-spring-security-core/" target="blank">ユーザガイド</a>をご覧ください。


<a name="14.4.2 Shiro"><!-- Legacy link --></a>
<h2 id="shiro">14.5.2 Shiro</h2>
<div class="hidden-block"><a href="http://shiro.apache.org/" target="blank">Shiro</a> is a Java POJO-oriented security framework that provides a default domain model that models realms, users, roles and permissions. With Shiro you extend a controller base class called <code>JsecAuthBase</code> in each controller you want secured and then provide an <code>accessControl</code> block to setup the roles. An example below:</div>
<a href="http://shiro.apache.org/" target="blank">Shiro</a>はJava POJO指向のセキュリティフレームワークで、レルム/ユーザ/ロール/権限に対するデフォルトのドメインモデルを提供します。Shiroを利用するには、セキュリティ機能が必要な各コントローラで<code>JsecAuthBase</code>という基底クラスを継承し、<code>accessControl</code>ブロックを使用してロールを設定します。以下に例を示します:<p class="paragraph"/><div class="code"><pre>class ExampleController <span class="java&#45;keyword">extends</span> JsecAuthBase &#123;
    <span class="java&#45;keyword">static</span> accessControl = &#123;
        // All actions require the 'Observer' role.
        role(name: 'Observer')<p class="paragraph"/>        // The 'edit' action requires the 'Administrator' role.
        role(name: 'Administrator', action: 'edit')<p class="paragraph"/>        // Alternatively, several actions can be specified.
        role(name: 'Administrator', only: &#91; 'create', 'edit', 'save', 'update' &#93;)
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">For more information on the Shiro plugin refer to the <a href="http://grails.org/plugin/shiro" target="blank">documentation</a>.</div>
Shiroプラグインについてのより詳しい情報は、<a href="http://grails.org/plugin/shiro" target="blank">ドキュメント</a>を参照してください。


<a name="15. Plug-ins"><!-- Legacy link --></a>
<h1 id="plugins">15 プラグイン</h1>
<div class="hidden-block">
Grails is first and foremost a web application framework, but it is also a platform. By exposing a number of extension points that let you extend anything from the command line interface to the runtime configuration engine, Grails can be customised to suit almost any needs. To hook into this platform, all you need to do is create a plugin.
</div>
Grailsは、第一義にはWebアプリケーションフレームワークです。しかし、それだけに留まらず、プラットフォームでもあります。
Grailsプラットフォームには、コマンドラインのコマンドを追加することから始まって、実行時設定のエンジンまで、何でも拡張できるような多くの拡張ポイントが準備されており、ほとんど全てのニーズに適合するようにカスタマイズすることができます。
このプラットフォームを拡張するためにしなければならないのは、プラグインを作成することだけです。<p class="paragraph"/><div class="hidden-block">
Extending the platform may sound complicated, but plugins can range from trivially simple to incredibly powerful. If you know how to build a Grails application, you'll know how to create a plugin for <a href="../guide/single.html#providingBasicArtefacts" class="guide">sharing a data model</a> or some static resources.
</div>
「プラットフォームを拡張する」というと難しいことのように思うかもしれませんが、プラグインの機能範囲は、単純極まりない簡単なことに始まって、とてつもなく強力なことまで、幅広く対応できます。Grailsアプリケーション開発を知っていれば、<a href="../guide/single.html#providingBasicArtefacts" class="guide">データモデル</a>や静的リソースを共有したりするためのプラグインの作成方法がわかってくるでしょう。


<a name="15.1 Creating and Installing Plug-ins"><!-- Legacy link --></a>
<h2 id="creatingAndInstallingPlugins">15.1 プラグインの作成とインストール</h2>
<div class="hidden-block">
<h4>Creating Plugins</h4>
</div>
<h4>プラグインの作成</h4><p class="paragraph"/><div class="hidden-block">
Creating a Grails plugin is a simple matter of running the command:
</div><p class="paragraph"/>Grailsプラグインの新規作成は、以下のコマンドを実行するだけであり、とても簡単です:<p class="paragraph"/><div class="code"><pre>grails create&#45;plugin &#91;PLUGIN NAME&#93;</pre></div><p class="paragraph"/><div class="hidden-block">
This will create a plugin project for the name you specify. For example running <code>grails create-plugin example</code> would create a new plugin project called <code>example</code>.</div>
こうすることで指定した名前のプラグインプロジェクトが作成されます。例えば、<code>grails create-plugin example</code>を実行すると、<code>example</code>という新規プラグインプロジェクトが作成されます。<p class="paragraph"/>Make sure the plugin name does not contain more than one capital in a row, or it won't work. Camel case is fine, though.<p class="paragraph"/><div class="hidden-block">The structure of a Grails plugin is very nearly the same as a Grails application project's except that in the root of the plugin directory you will find a plugin Groovy file called the "plugin descriptor".
</div>
Grailsプラグインの構造は、プラグインのルートディレクトリに「プラグインディスクリプタ」と呼ばれるGroovyファイルがあることを除き、Grailsアプリケーションプロジェクトの構造とほとんど同じです。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">
The only plugins included in a new plugin project are Tomcat and Release. Hibernate is not included by default.
</div>
新規プラグインプロジェクトには、TomcatプラグインとReleaseプラグインが含められています。Hibernateプラグインはデフォルトの状態では含められていません。
</blockquote><p class="paragraph"/>
<div class="hidden-block">
Being a regular Grails project has a number of benefits in that you can immediately test your plugin by running:
</div><p class="paragraph"/>Grailsプラグインの構成が「通常のGrailsプロジェクト」と同じであることには利点が多くあります。例えば、以下を実行することでテストが実行できます。<p class="paragraph"/><div class="code"><pre>grails run&#45;app</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">
Plugin projects don't provide an index.gsp by default since most plugins don't need it. So, if you try to view the plugin running in a browser right after creating it, you will receive a page not found error. You can easily create a <code>grails-app/views/index.gsp</code> for your plugin if you'd like.
</div><p class="paragraph"/>プラグインプロジェクトは、index.gspをデフォルトでは提供しません。なぜならほとんどのプラグインでは必要ないからです。なので、プラグイン起動後にブラウザで確認しようとすると「ページが見つかりません」というエラーになるでしょう。もちろん、もしそうしたければプラグインプロジェクト中に<code>grails-app/views/index.gsp</code>を作成しても全く問題ありません。<p class="paragraph"/></blockquote><p class="paragraph"/><div class="hidden-block">
The plugin descriptor name ends with the convention <code>GrailsPlugin</code> and is found in the root of the plugin project. For example:
</div>
プラグインディスクリプタ名の末尾は、規約上「<code>GrailsPlugin</code>」であり、プラグインプロジェクトのルートディレクトリに配置されます。例えば:<p class="paragraph"/><div class="code"><pre>class ExampleGrailsPlugin &#123;
   def version = <span class="java&#45;quote">"0.1"</span><p class="paragraph"/>   &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
All plugins must have this class in the root of their directory structure. The plugin class defines the version of the plugin and other metadata, and optionally various hooks into plugin extension points (covered shortly).
</div><p class="paragraph"/>このようなクラスがプラグインディレクトリのルートに存在しなければなりません。このプラグインクラスは、プラグインのバージョン情報や他のメタデータを定義しています。さらに、プラグイン拡張ポイントへの様々なフックを定義することができます(簡易にカバー)。<p class="paragraph"/><div class="hidden-block">
You can also provide additional information about your plugin using several special properties:
</div><p class="paragraph"/>さらに、いくつかの特別なプロパティを使って、プラグインの追加情報を提供することもできます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>title</code> - short one-sentence description of your plugin</li>
<li><code>version</code> - The version of your plugin. Valid values include example "0.1", "0.2-SNAPSHOT", "1.1.4" etc.</li>
<li><code>grailsVersion</code> - The version of version range of Grails that the plugin supports. eg. "1.2 &#62; *" (indicating 1.2 or higher)</li>
<li><code>author</code> - plugin author's name</li>
<li><code>authorEmail</code> - plugin author's contact e-mail</li>
<li><code>description</code> - full multi-line description of plugin's features</li>
<li><code>documentation</code> - URL of the plugin's documentation</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>title</code> - このプラグインを説明する短い一文。</li>
<li><code>version</code> - このプラグインのバージョン。例えば「0.1」「0.2-SNAPSHOT」「1.1.4」などの有効な値。</li>
<li><code>grailsVersion</code> - プラグインがサポートするGrailsのバージョンを、バージョン範囲で指定する。例えば「1.2 &#62; *」(これは「1.2以上」であることを示す)</li>
<li><code>author</code> - プラグインの開発者名</li>
<li><code>authorEmail</code> - プラグイン開発者に連絡するためのe-mailアドレス</li>
<li><code>description</code> - 複数行に渡るプラグイン機能のフル説明</li>
<li><code>documentation</code> - プラグインのドキュメントへのURL</li>
</ul><p class="paragraph"/><div class="hidden-block">
Here is an example from the <a href="http://grails.org/plugin/quartz" target="blank">Quartz Grails plugin</a>:
</div>
以下は、<a href="http://grails.org/plugin/quartz" target="blank">Quartz Grailsプラグイン</a>からの例です:<p class="paragraph"/><div class="code"><pre>class QuartzGrailsPlugin &#123;
    def version = <span class="java&#45;quote">"0.1"</span>
    def grailsVersion = <span class="java&#45;quote">"1.1 &#62; &#42;"</span>
    def author = <span class="java&#45;quote">"Sergey Nebolsin"</span>
    def authorEmail = <span class="java&#45;quote">"nebolsin@gmail.com"</span>
    def title = <span class="java&#45;quote">"Quartz Plugin"</span>
    def description = '''&#92;
The Quartz plugin allows your Grails application to schedule jobs&#92;
to be executed using a specified interval or cron expression. The&#92;
underlying system uses the Quartz Enterprise Job Scheduler configured&#92;
via Spring, but is made simpler by the coding by convention paradigm.&#92;
'''
    def documentation = <span class="java&#45;quote">"http://grails.org/plugin/quartz"</span><p class="paragraph"/>   &#8230;
&#125;</pre></div><p class="paragraph"/><h4>Installing Local Plugins</h4><p class="paragraph"/>To make your plugin available for use in a Grails application run the <code>maven-install</code> command:<p class="paragraph"/><div class="code"><pre>grails maven&#45;install</pre></div><p class="paragraph"/>This will install the plugin into your local Maven cache. Then to use the plugin within an application declare a dependency on the plugin in your <code>grails-app/conf/BuildConfig.groovy</code> file:<p class="paragraph"/><div class="code"><pre>compile <span class="java&#45;quote<a href="quartz:0.1"</span></pre></div>">></a><p class="paragraph"/>
<div class="hidden-block">
<h4>Notes on excluded Artefacts</h4>
</div><p class="paragraph"/><h4>アーテファクト除外についての留意事項</h4><p class="paragraph"/><div class="hidden-block">
Although the <a href="../ref/Command Line/create-plugin.html" class="commandLine">create-plugin</a> command creates certain files for you so that the plugin can be run as a Grails application, not all of these files are included when packaging a plugin. The following is a list of artefacts created, but not included by <a href="../ref/Command Line/package-plugin.html" class="commandLine">package-plugin</a>:
</div><p class="paragraph"/>前述のように、<a href="../ref/Command Line/create-plugin.html" class="commandLine">create-plugin</a>コマンドはプラグインプロジェクトとして一連のファイルを作成し、Grailsアプリケーションとして実行することもできますが、パッケージ化したときにこれら全てのファイルが含められるわけではありません。以下は、生成されるけれども、<a href="../ref/Command Line/package-plugin.html" class="commandLine">package-plugin</a>コマンドで生成されるzipファイルには含まれないアーテファクトのリストです。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>grails-app/conf/BootStrap.groovy</code></li>
<li><code>grails-app/conf/BuildConfig.groovy</code> (although it is used to generate <code>dependencies.groovy</code>)</li>
<li><code>grails-app/conf/Config.groovy</code></li>
<li><code>grails-app/conf/DataSource.groovy</code> (and any other <code>*DataSource.groovy</code>)</li>
<li><code>grails-app/conf/UrlMappings.groovy</code></li>
<li><code>grails-app/conf/spring/resources.groovy</code></li>
<li>Everything within <code>/web-app/WEB-INF</code></li>
<li>Everything within <code>/web-app/plugins/&#42;&#42;</code></li>
<li>Everything within <code>/test/&#42;&#42;</code></li>
<li>SCM management files within <code>&#42;&#42;/.svn/&#42;&#42;</code> and <code>&#42;&#42;/CVS/&#42;&#42;</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>grails-app/conf/BootStrap.groovy</code></li>
<li><code>grails-app/conf/BuildConfig.groovy</code> (<code>dependencies.groovy</code>の生成には使用される)</li>
<li><code>grails-app/conf/Config.groovy</code></li>
<li><code>grails-app/conf/DataSource.groovy</code> (これと他の任意の<code>*DataSource.groovy</code>)</li>
<li><code>grails-app/conf/UrlMappings.groovy</code></li>
<li><code>grails-app/conf/spring/resources.groovy</code></li>
<li><code>/web-app/WEB-INF</code>配下のすべて</li>
<li><code>/web-app/plugins/&#42;&#42;</code>配下のすべて</li>
<li><code>/test/&#42;&#42;</code> 配下のすべて</li>
<li><code>&#42;&#42;/.svn/&#42;&#42;</code> と <code>&#42;&#42;/CVS/&#42;&#42;</code>配下のSCM管理ファイル</li>
</ul><p class="paragraph"/><div class="hidden-block">
If you need artefacts within <code>WEB-INF</code> it is recommended you use the <code>_Install.groovy</code> script (covered later), which is executed when a plugin is installed, to provide such artefacts. In addition, although <code>UrlMappings.groovy</code> is excluded you are allowed to include a <code>UrlMappings</code> definition with a different name, such as <code>MyPluginUrlMappings.groovy</code>.
</div><p class="paragraph"/>アーテファクトを<code>WEB-INF</code>に含める必要がある場合には、プラグインインストール時に実行されるスクリプトである<code>_Install.groovy</code>スクリプト(後述)を使用することがお勧めです。なお、除外対象アーティファクトである<code>UrlMappings.groovy</code>は除外されますが、<code>UrlMappings</code>情報は「<code>MyPluginUrlMappings.groovy</code>」などの異なる名前にしておけば、含めることができます。<p class="paragraph"/><h4>Customizing the plugin contents</h4><p class="paragraph"/>You can specify what to exclude in addition to the default excludes by adding elements to the <code>pluginExcludes</code> descriptor property (described below). In addition, there are two ways to configure the contents of the plugin ZIP or JAR file.<p class="paragraph"/>One is to create an event handler for the <code>CreatePluginArchiveStart</code> event, which is fired after all of the plugin files have been copied to the staging directory. By adding an event handler you can add, modify, or delete files as needed. Add the handler to <code>_Events.groovy</code> in the <code>scripts</code> directory, for example<p class="paragraph"/><div class="code"><pre>eventCreatePluginArchiveStart = &#123; stagingDir &#45;&#62;
   // update staging directory contents here
&#125;</pre></div><p class="paragraph"/>You can customize the location of the staging directory with the <code>grails.project.plugin.staging.dir</code> attribute in <code>BuildConfig.groovy</code> or as  as system property.<p class="paragraph"/>Note that there is also a <code>CreatePluginArchiveEnd</code> event which is fired after the ZIP or JAR is packaged.<p class="paragraph"/>You can also do this work in a Closure in <code>BuildConfig.groovy</code> with the property <code>grails.plugin.resources</code> which is analogous to the <code>grails.war.resources</code> property, e.g.<p class="paragraph"/><div class="code"><pre>grails.plugin.resources = &#123; stagingDir &#45;&#62;
   // update staging directory contents here
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">
<h4>Specifying Plugin Locations</h4>
</div><p class="paragraph"/><h4>プラグイン位置の指定</h4><p class="paragraph"/><div class="hidden-block">
An application can load plugins from anywhere on the file system, even if they have not been installed. Specify the location of the (unpacked) plugin in the application's <code>grails-app/conf/BuildConfig.groovy</code> file:
</div><p class="paragraph"/>アプリケーションは、ファイルシステム上の任意の場所にあるプラグインをロードできますし、インストールしていないプラグインをロードすることさえも可能です。そのためには、アプリケーションの<code>grails-app/conf/BuildConfig.groovy</code>設定ファイルに、パッケージされていないプラグインのディレクトリを以下のように指定します:<p class="paragraph"/><div class="hidden-block">
<div class="code"><pre>// Useful to test plugins you are developing.
grails.plugin.location.shiro =
        <span class="java&#45;quote">"/home/dilbert/dev/plugins/grails&#45;shiro"</span><p class="paragraph"/>// Useful <span class="java&#45;keyword">for</span> modular applications where all plugins and
// applications are in the same directory.
grails.plugin.location.'grails&#45;ui' = <span class="java&#45;quote">"../grails&#45;grails&#45;ui"</span></pre></div>
</div><p class="paragraph"/><div class="code"><pre>// 開発中のプラグインをテストするのに便利。
grails.plugin.location.shiro =
        <span class="java&#45;quote">"/home/dilbert/dev/plugins/grails&#45;shiro"</span><p class="paragraph"/>// すべてのプラグインとアプリケーションを同じディレクトリに置き、
// モジュール化するのに便利。
grails.plugin.location.'grails&#45;ui' = <span class="java&#45;quote">"../grails&#45;grails&#45;ui"</span></pre></div><p class="paragraph"/><div class="hidden-block">
This is particularly useful in two cases:
<ul class="star">
<li>You are developing a plugin and want to test it in a real application without packaging and installing it first.</li>
<li>You have split an application into a set of plugins and an application, all in the same "super-project" directory.</li>
</ul><p class="paragraph"/></div><p class="paragraph"/>これが特に便利なのは、以下の2つの場合です:
<ul class="star">
<li>開発中のプラグインを、パッケージ化とインストールをスキップして、実アプリケーションにすぐに組み込んでテストしたいとき。</li>
<li>アプリケーションが複数のプラグイン群に分割されており、それらすべてが同じ「スーパープロジェクト」ディレクトリ配下にある場合。</li>
</ul><p class="paragraph"/><blockquote class="note">
The Artifactory repository for Grails now includes all the dependencies for published plugins. So, if you are using inline plugins that have dependencies, it is necessary to do a secondary resolve because these dependencies might not be in the repository. Therefore, you should set <code>legacyResolve</code> to <code>true</code> in your <code>BuildConfig.groovy</code> if you are using inline plugins with dependencies.
</blockquote><p class="paragraph"/>

<a name="15.2 Plugin Repositories"><!-- Legacy link --></a>
<h2 id="repositories">15.2 プラグインリポジトリ</h2>
<div class="hidden-block">h4. Distributing Plugins in the Grails Central Plugin Repository</div>
<h4>プラグインをGrailsセントラルリポジトリに公開する</h4><p class="paragraph"/><div class="hidden-block">The preferred way to distribute plugin is to publish to the official Grails Central Plugin Repository. This will make your plugin visible to the <a href="../ref/Command Line/list-plugins.html" class="commandLine">list-plugins</a> command:</div>
プラグインを配布するための良い方法は、公式Grailsセントラルリポジトリに公開することです。こうすることで、あなたのプラグインを<a href="../ref/Command Line/list-plugins.html" class="commandLine">list-plugins</a>コマンドで表示させることができます:<p class="paragraph"/><div class="code"><pre>grails list&#45;plugins</pre></div><p class="paragraph"/><div class="hidden-block">which lists all plugins that are in the central repository. Your plugin will also be available to the <a href="../ref/Command Line/plugin-info.html" class="commandLine">plugin-info</a> command:</div><p class="paragraph"/>このコマンドはセントラルリポジトリのすべてのプラグインを一覧表示します。あなたのプラグインを<a href="../ref/Command Line/plugin-info.html" class="commandLine">plugin-info</a>コマンドで表示することもできます:<p class="paragraph"/><div class="code"><pre>grails plugin&#45;info &#91;plugin&#45;name&#93;</pre></div><p class="paragraph"/><div class="hidden-block">which prints extra information about it, such as its description, who wrote, etc.</div><p class="paragraph"/>これで説明や著者名、その他のプラグイン情報などを表示させることができます。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
If you have created a Grails plugin and want it to be hosted in the central repository, you'll find instructions for getting an account on <a href="http://grails.org/Creating+Plugins" target="blank">this wiki page</a>.
</blockquote>
</div><p class="paragraph"/><blockquote class="note">
もしGrailsプラグインを開発して、セントラルリポジトリでホスティングしたい場合、アカウント入手の手順は<a href="http://grails.org/Creating+Plugins" target="blank">このWikiページ</a>にあります。
</blockquote><p class="paragraph"/><div class="hidden-block">When you have access to the Grails Plugin repository, install the <a href="http://grails-plugins.github.com/grails-release/docs/index.html" target="blank">Release Plugin</a> by declaring it as a 'build' scoped dependency in <code>grails-app/conf/BuildConfig.groovy</code> file:</div><p class="paragraph"/>Grailsプラグインリポジトリにアクセス権を持っていれば、<a href="http://grails-plugins.github.com/grails-release/docs/index.html" target="blank">リリースプラグイン</a>を <code>grails-app/conf/BuildConfig.groovy</code> ファイルの依存管理'build'スコープに定義してインストールします。<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
    &#8230;
    plugins &#123;
        build <span class="java&#45;quote<a href="release:3.0.0"</span>">></a>
    &#125;
&#125;</pre></div><p class="paragraph"/>And execute the <code>publish-plugin</code> command to release your plugin:<p class="paragraph"/><div class="code"><pre>grails publish&#45;plugin</pre></div><p class="paragraph"/>This will automatically publish the plugin to the central repository. If the command is successful, it will immediately be available on the plugin portal at http://grails.org/plugin/&#60;pluginName&#62;. You can find out more about the Release plugin and its other features in <a href="http://grails-plugins.github.com/grails-release/docs/index.html" target="blank">its user guide</a>.<p class="paragraph"/><div class="hidden-block">h4. Configuring Additional Repositories</div><p class="paragraph"/><h4>追加リポジトリの設定</h4><p class="paragraph"/><div class="hidden-block">The process for configuring repositories in Grails differs between versions. For version of Grails 1.2 and earlier please refer to the <a href="http://grails.org/doc/1.2.x/guide/12.%20Plug-ins.html#12.2%20Plugin%20Repositories" target="blank">Grails 1.2 documentation</a> on the subject. The following sections cover Grails 1.3 and above.</div><p class="paragraph"/>Grailsにおけるリポジトリの設定手順は、Grailsのバージョンによって異なっています。Grails 1.2以前の情報については<a href="http://grails.org/doc/1.2.x/guide/12.%20Plug-ins.html#12.2%20Plugin%20Repositories" target="blank">Grails 1.2のドキュメンテーション</a>を参照ください。以降の節は、Grails 1.3以降について記述しています。<p class="paragraph"/><div class="hidden-block">Grails 1.3 and above use Ivy under the hood to resolve plugin dependencies. The mechanism for defining additional plugin repositories is largely the same as <a href="../guide/single.html#dependencyResolution" class="guide">defining repositories for JAR dependencies</a>. For example you can define a remote Maven repository that contains Grails plugins using the following syntax in <code>grails-app/conf/BuildConfig.groovy</code>:</div><p class="paragraph"/>Grails 1.3以上では、下位層に隠されているIvyがプラグインの依存性を解決します。プラグインリポジトリを追加定義する仕組みは、 <a href="../guide/single.html#dependencyResolution" class="guide">JAR依存性を定義</a>する方法とほぼ同じです。例えば、Grailsプラグインを含むリモートMavenリポジトリを定義するには、 <code>grails-app/conf/BuildConfig.groovy</code>中で以下のように記述します:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    mavenRepo <span class="java&#45;quote">"http://repository.codehaus.org"</span><p class="paragraph"/>    // ...or with a name
    mavenRepo name: <span class="java&#45;quote">"myRepo"</span>,
              root: <span class="java&#45;quote">"http://myserver:8081/artifactory/plugins&#45;snapshots&#45;local"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also define a SVN-based Grails repository (such as the one hosted at <a href="http://plugins.grails.org/" target="blank">http://plugins.grails.org</a>) using the <code>grailsRepo</code> method:</div><p class="paragraph"/><code>grailsRepo</code>メソッドを使ってSVNベースのGrailsリポジトリ(例えば<a href="http://plugins.grails.org/" target="blank">http://plugins.grails.org</a>でホストされているリポジトリ)を定義することもできます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    grailsRepo <span class="java&#45;quote">"http://myserver/mygrailsrepo"</span><p class="paragraph"/>    // ...or with a name
    grailsRepo <span class="java&#45;quote">"http://myserver/svn/grails&#45;plugins"</span>, <span class="java&#45;quote">"mySvnRepo"</span> 
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">There is a shortcut to setup the Grails central repository:</div>
Grailsセントラルリポジトリは以下の短縮記法で指定することもできます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    grailsCentral()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The order in which plugins are resolved is based on the ordering of the repositories. So in this case the Grails central repository will be searched last:</div><p class="paragraph"/>repositoriesの項目で列挙した順にプラグインは解決されます。なので以下ではGrailsセントラルリポジトリが最後に検索されます:<p class="paragraph"/><div class="code"><pre>repositories &#123;
    grailsRepo <span class="java&#45;quote">"http://myserver/mygrailsrepo"</span>
    grailsCentral()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">All of the above examples use HTTP; however you can specify any <a href="http://ant.apache.org/ivy/history/latest-milestone/settings/resolvers.html" target="blank">Ivy resolver</a> to resolve plugins with. Below is an example that uses an SSH resolver:</div><p class="paragraph"/>前述の例ではHTTPを使用していましたが、プラグイン解決に任意の<a href="http://ant.apache.org/ivy/history/latest-milestone/settings/resolvers.html" target="blank">Ivyリゾルバ</a>を使用することもできます。以下はSSHリゾルバを使用する例です:<p class="paragraph"/><div class="code"><pre>def sshResolver = <span class="java&#45;keyword">new</span> SshResolver(user:<span class="java&#45;quote">"myuser"</span>, host:<span class="java&#45;quote">"myhost.com"</span>)
sshResolver.addArtifactPattern(
        <span class="java&#45;quote">"/path/to/repo/grails&#45;&#91;artifact&#93;/tags/"</span> +
        <span class="java&#45;quote">"LATEST_RELEASE/grails&#45;&#91;artifact&#93;&#45;&#91;revision&#93;.&#91;ext&#93;"</span>)
sshResolver.latestStrategy =
        <span class="java&#45;keyword">new</span> org.apache.ivy.plugins.latest.LatestTimeStrategy()<p class="paragraph"/>sshResolver.changingPattern = <span class="java&#45;quote">".&#42;SNAPSHOT"</span>
sshResolver.setCheckmodified(<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/><div class="hidden-block">The above example defines an artifact pattern which tells Ivy how to resolve a plugin zip file. For a more detailed explanation on Ivy patterns see the <a href="http://ant.apache.org/ivy/history/2.1.0/concept.html#patterns" target="blank">relevant section</a> in the Ivy user guide.</div><p class="paragraph"/>上記の例では、プラグインZIPファイルを解決する方法をIvyに伝えるため、アーテファクトのパターンを指定しています。Ivyパターンのより詳しい説明は、Ivyユーザガイドの<a href="http://ant.apache.org/ivy/history/2.1.0/concept.html#patterns" target="blank">関連するセクション</a>を参照下さい。<p class="paragraph"/>
<div class="hidden-block">h4. Publishing to Maven Compatible Repositories </div>
<h4>Maven互換リポジトリへの公開</h4><p class="paragraph"/>In general it is recommended for Grails 1.3 and above to use standard Maven-style repositories to self host plugins. The benefits of doing so include the ability for existing tooling and repository managers to interpret the structure of a Maven repository.<p class="paragraph"/>You use the Release plugin to publish a plugin to a Maven repository. Please refer to the section of the <a href="../guide/single.html#mavendeploy" class="guide">Maven deployment</a> user guide on the subject.


<a name="15.3 Understanding a Plug-ins Structure"><!-- Legacy link --></a>
<h2 id="understandingPluginStructure">15.3 プラグイン構造を理解する</h2>
<div class="hidden-block">As as mentioned previously, a plugin is basically a regular Grails application with a plugin descriptor. However when installed, the structure of a plugin differs slightly. For example, take a look at this plugin directory structure:</div><p class="paragraph"/>すでに述べてきているように、プラグインは基本的にはプラグインディスクリプタが付随した通常のGrailsアプリケーションです。しかしながら、インストールされるときにはプラグインの構造は少し異なってきます。例えば、以下のプラグイン構造を見てみましょう:<p class="paragraph"/><div class="code"><pre>+ grails&#45;app
     + controllers
     + domain
     + taglib
     etc.
 + lib
 + src
     + java
     + groovy
 + web&#45;app
     + js
     + css</pre></div><p class="paragraph"/><div class="hidden-block">When a plugin is installed the contents of the <code>grails-app</code> directory will go into a directory such as <code>plugins/example-1.0/grails-app</code>. They <strong class="bold">will not</strong> be copied into the main source tree. A plugin never interferes with a project's primary source tree.</div><p class="paragraph"/>プラグインがインストールされたときには、<code>grails-app</code>ディレクトリの内容は<code>plugins/example-1.0/grails-app</code>に入ります。これらはメインアプリのソースツリーにはインストールされ<strong class="bold">ません</strong>。プラグインはプロジェクト本体側のソースツリーには決して干渉しないのです。<p class="paragraph"/><div class="hidden-block">Dealing with static resources is slightly different. When developing a plugin, just like an application, all static resources go in the <code>web-app</code> directory. You can then link to static resources just like in an application. This example links to a JavaScript source:</div><p class="paragraph"/>静的リソースの処理は、少しだけ異なってきます。プラグインをあたかもアプケーションのように開発する際、すべての静的リソースは<code>web-app</code>ディレクトリに入ります。静的リソースをアプリケーションからリンクすることもできます。以下の例ではJavaScriptソースをリンクしています:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:resource dir=<span class="xml&#45;quote">"js"</span> file=<span class="xml&#45;quote">"mycode.js"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">When you run the plugin in development mode the link to the resource will resolve to something like <code>/js/mycode.js</code>. However, when the plugin is installed into an application the path will automatically change to something like <code>/plugin/example-0.1/js/mycode.js</code> and Grails will deal with making sure the resources are in the right place.</div><p class="paragraph"/>プラグインを開発モード(development mode)で実行するときは、このようなリソースへのリンクは<code>/js/mycode.js</code>などに解決されます。しかし、プラグインがアプリケーションにインストールされたときは、パスは自動的に<code>/plugin/example-0.1/js/mycode.js</code>のように自動的に変換され、Grailsはリソースを正しく扱うことができます。<p class="paragraph"/><div class="hidden-block">There is a special <code>pluginContextPath</code> variable that can be used whilst both developing the plugin and when in the plugin is installed into the application to find out what the correct path to the plugin is.</div><p class="paragraph"/>プラグイン開発モードと、プラグインがアプリケーションにインストールされている場合のいずれにおいても、plugin.jsの正しいパスを見付けるのに、そのための<code>pluginContextPath</code>変数を使用できます。<p class="paragraph"/><div class="hidden-block">At runtime the <code>pluginContextPath</code> variable will either evaluate to an empty string or <code>/plugins/example</code> depending on whether the plugin is running standalone or has been installed in an application</div><p class="paragraph"/>スタンドアローン実行中かアプリケーションにインストールされているかによって、<code>pluginContextPath</code>変数は空文字列もしくは<code>/plugins/example</code>のいずれかに実行時に評価されます。<p class="paragraph"/><div class="hidden-block">Java and Groovy code that the plugin provides within the lib and <code>src/java</code> and <code>src/groovy</code> directories will be compiled into the main project's <code>web-app/WEB-INF/classes</code> directory so that they are made available at runtime.</div><p class="paragraph"/>プラグインが提供する、libや<code>src/java</code>や<code>src/groovy</code>ディレクトリ配下にあるJavaやGroovyコードは、実行時に利用できるようにメインプロジェクトの<code>web-app/WEB-INF/classes</code>ディレクトリ配下にコンパイルされます。


<a name="15.4 Providing Basic Artefacts"><!-- Legacy link --></a>
<h2 id="providingBasicArtefacts">15.4 基本アーティファクトの提供</h2>
<div class="hidden-block">h4. Adding a new Script</div><p class="paragraph"/><div class="hidden-block">A plugin can add a new script simply by providing the relevant Gant script in its scripts directory:</div><p class="paragraph"/>プラグインのscriptディレクトリ配下に関連するGantスクリプトを置くことで、プラグインは新しいスクリプトを追加することができます:
<div class="hidden-block">   + scripts     &#60;<strike class="strike"> additional scripts here</div>
<div class="code"><pre>+ MyPlugin.groovy
   + scripts     &#60;&#45;&#45; ここにスクリプトを追加する
   + grails&#45;app
        + controllers
        + services
        + etc.
    + lib</pre></div><p class="paragraph"/><div class="hidden-block">h4. Adding a new grails-app artifact (Controller, Tag Library, Service, etc.)</div><p class="paragraph"/><h4>Grails-appアーテファクト(Controller, Tag Library, Service, 他)の追加</h4><p class="paragraph"/>
<div class="hidden-block">A plugin can add new artifacts by creating the relevant file within the <code>grails-app</code> tree. Note that the plugin is loaded from where it is installed and not copied into the main application tree.</div><p class="paragraph"/><code>grails-app</code>配下のツリーに関連するファイルを置いておくことで、プラグインは新しいアーテファクトを追加することができます。プラグインはインストールされた場所から読み込まれるのであって、メインアプリのツリー中にコピーされるわけではないことに留意して下さい。<p class="paragraph"/><div class="hidden-block">
        + controllers  &#60;</strike> additional controllers here
        + services &#60;<strike class="strike"> additional services here
        + etc.  &#60;</strike> additional XXX here
</div>
<div class="code"><pre>+ ExamplePlugin.groovy
   + scripts
   + grails&#45;app
        + controllers  &#60;&#45;&#45; コントローラを追加するのはここ。
        + services &#60;&#45;&#45; サービスを追加するのはここ。
        + etc.  &#60;&#45;&#45; 他も同様。
    + lib</pre></div><p class="paragraph"/><div class="hidden-block">h4. Providing Views, Templates and View resolution</div>
<h4>ビューとテンプレートの提供、そしてビューの解決</h4><p class="paragraph"/><div class="hidden-block">When a plugin provides a controller it may also provide default views to be rendered. This is an excellent way to modularize your application through plugins. Grails' view resolution mechanism will first look for the view in the application it is installed into and if that fails will attempt to look for the view within the plugin. This means that you can override views provided by a plugin by creating corresponding GSPs in the application's <code>grails-app/views</code> directory.</div><p class="paragraph"/>プラグインがコントローラを提供するときは、レンダリングされるデフォルトのビューを提供しても構いません。これはアプリケーションをプラグインに分割するのに優れた方法です。<p class="paragraph"/>Grailsのビュー解決機構は、最初にプラグインがインストールされた親アプリケーション中のビューを探し、見付からなければプラグイン自身のビューを探してみます。これが意味するのは、アプリケーションの<code>grails-app/views</code>ディレクトリ中に対応するGSPを定義しておくことで、プラグインが提供するビューを上書きすることができるということです。<p class="paragraph"/><div class="hidden-block">For example, consider a controller called <code>BookController</code> that's provided by an 'amazon' plugin. If the action being executed is <code>list</code>, Grails will first look for a view called <code>grails-app/views/book/list.gsp</code> then if that fails it will look for the same view relative to the plugin.</div><p class="paragraph"/>例えば、「アマゾン」プラグインが提供する<code>BookController</code>を考えてみて下さい。もし<code>list</code>アクションが実行されたなら、Grailsは最初に<code>grails-app/views/book/list.gsp</code>を検索し、それに失敗した場合にプラグインディレクトリから相対的に同じ位置にあるビューを検索します。<p class="paragraph"/><div class="hidden-block">However if the view uses templates that are also provided by the plugin then the following syntax may be necessary:</div><p class="paragraph"/>しかしながら、同じくプラグインが提供するテンプレートをビューが使用しているときには、以下の構文が必要になります:<p class="paragraph"/><div class="code"><pre>&#60;g:render template=<span class="java&#45;quote">"fooTemplate"</span> plugin=<span class="java&#45;quote">"amazon"</span>/&#62;</pre></div><p class="paragraph"/><div class="hidden-block">Note the usage of the <code>plugin</code> attribute, which contains the name of the plugin where the template resides. If this is not specified then Grails will look for the template relative to the application.</div><p class="paragraph"/><code>plugin</code>属性でテンプレートがあるプラグインの名前を指定することに注意下さい。もしこれがなければ、Grailsはアプリケーション相対でテンプレートを探します。<p class="paragraph"/><div class="hidden-block">h4. Excluded Artefacts</div>
<h4>アーテファクトを除外する</h4><p class="paragraph"/><div class="hidden-block">By default Grails excludes the following files during the packaging process:</div><p class="paragraph"/>デフォルトでは、Grailsはプラグインのパッケージングの過程で以下のファイルを除外します:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>grails-app/conf/BootStrap.groovy</code></li>
<li><code>grails-app/conf/BuildConfig.groovy</code> (although it is used to generate <code>dependencies.groovy</code>)</li>
<li><code>grails-app/conf/Config.groovy</code></li>
<li><code>grails-app/conf/DataSource.groovy</code> (and any other <code>*DataSource.groovy</code>)</li>
<li><code>grails-app/conf/UrlMappings.groovy</code></li>
<li><code>grails-app/conf/spring/resources.groovy</code></li>
<li>Everything within <code>/web-app/WEB-INF</code></li>
<li>Everything within <code>/web-app/plugins/&#42;&#42;</code></li>
<li>Everything within <code>/test/&#42;&#42;</code></li>
<li>SCM management files within <code>&#42;&#42;/.svn/&#42;&#42;</code> and <code>&#42;&#42;/CVS/&#42;&#42;</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>grails-app/conf/BootStrap.groovy</code></li>
<li><code>grails-app/conf/BuildConfig.groovy</code> (この情報は<code>dependencies.groovy</code>の生成に用いられるが、BuildConfig自体は含められない)</li>
<li><code>grails-app/conf/Config.groovy</code></li>
<li><code>grails-app/conf/DataSource.groovy</code> (その他の<code>*DataSource.groovy</code>も同様)</li>
<li><code>grails-app/conf/UrlMappings.groovy</code></li>
<li><code>grails-app/conf/spring/resources.groovy</code></li>
<li><code>/web-app/WEB-INF</code>中のすべて</li>
<li><code>/web-app/plugins/&#42;&#42;</code>中のすべて</li>
<li><code>/test/&#42;&#42;</code>中のすべて</li>
<li><code>&#42;&#42;/.svn/&#42;&#42;</code>と<code>&#42;&#42;/CVS/&#42;&#42;</code>中のSCMが管理するファイル</li>
</ul><p class="paragraph"/><div class="hidden-block">If your plugin requires files under the <code>web-app/WEB-INF</code> directory it is recommended that you modify the plugin's <code>scripts/_Install.groovy</code> Gant script to install these artefacts into the target project's directory tree.</div><p class="paragraph"/>もしプラグインが<code>web-app/WEB-INF</code>ディレクトリ配下のファイルを必要とするなら、プラグインディレクトリの<code>scripts/_Install.groovy</code>Gantスクリプトを修正し、それらのアーテファクトをターゲットのプロジェクトのディレクトリツリーにコピーするようにすることをお勧めします。<p class="paragraph"/><div class="hidden-block">In addition, the default <code>UrlMappings.groovy</code> file is excluded to avoid naming conflicts, however you are free to add a UrlMappings definition under a different name which <strong class="bold">will</strong> be included. For example a file called <code>grails-app/conf/BlogUrlMappings.groovy</code> is fine.</div><p class="paragraph"/>加えて、名前衝突を避けるため、デフォルトでは<code>UrlMappings.groovy</code>ファイルは除外されていますが、「UrlMapping」が含まれる異なる名前のUrlMappings定義を追加するのは構いません。例えば、<code>grails-app/conf/BlogUrlMappings.groovy</code>などの名前にしておくと良いでしょう。<p class="paragraph"/><div class="hidden-block">The list of excludes is extensible with the <code>pluginExcludes</code> property:</div><p class="paragraph"/>除外リストは<code>pluginExcludes</code>プロパティで拡張することができます:<p class="paragraph"/><div class="hidden-block">
<div class="code"><pre>// resources that are excluded from plugin packaging
def pluginExcludes = &#91;
    <span class="java&#45;quote">"grails&#45;app/views/error.gsp"</span>
&#93;</pre></div>
</div><p class="paragraph"/><div class="code"><pre>// プラグインのパッケージングからは除外するリソース
def pluginExcludes = &#91;
    <span class="java&#45;quote">"grails&#45;app/views/error.gsp"</span>
&#93;</pre></div><p class="paragraph"/>
<div class="hidden-block">This is useful for example to include demo or test resources in the plugin repository, but not include them in the final distribution.</div><p class="paragraph"/>この指定は、デモやテスト用リソースとしてプラグインのソースリポジトリには含めたいが、プラグインとしての最終配布物には含めたくない、という場合に有用でしょう。


<a name="15.5 Evaluating Conventions"><!-- Legacy link --></a>
<h2 id="evaluatingConventions">15.5 規約の評価</h2>
<div class="hidden-block">Before looking at providing runtime configuration based on conventions you first need to understand how to evaluate those conventions from a plugin. Every plugin has an implicit <code>application</code> variable which is an instance of the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> interface.</div><p class="paragraph"/>Grailsが提供する、規約ベースのランタイム設定を見ていく前に、あなたが理解しておくべきことは、これらのプラグインの規約がどう評価されるか、ということです。どのプラグインも、暗黙の<code>application</code>変数を持っていて、これは<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a>のインスタンスです。<p class="paragraph"/><div class="hidden-block">The <code>GrailsApplication</code> interface provides methods to evaluate the conventions within the project and internally stores references to all artifact classes within your application.</div><p class="paragraph"/>この<code>GrailsApplication</code>インターフェースは、プロジェクト中の規約を評価するためのメソッドを提供します。また、内部的にあなたのアプリのすべてのアーテファクトクラスへの参照を保存します。<p class="paragraph"/><div class="hidden-block">Artifacts implement the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">GrailsClass</a> interface, which represents a Grails resource such as a controller or a tag library. For example to get all <code>GrailsClass</code> instances you can do:</div><p class="paragraph"/>アーテファクトは<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">GrailsClass</a>インターフェースを実装し、コントローラやタグライブラリのようなGrailsのリソースを表現します。例えばすべての<code>GrailsClass</code>インスタンスを取得するには以下のようにします:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (grailsClass in application.allClasses) &#123;
    println grailsClass.name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block"><code>GrailsApplication</code> has a few "magic" properties to narrow the type of artefact you are interested in. For example to access controllers you can use:</div><p class="paragraph"/><code>GrailsApplication</code>はいくつかの「マジック」プロパティを持っていて、あなたの興味があるアーテファクトの型を狭めることができます。例えば、コントローラにアクセスするには以下のようにできます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (controllerClass in application.controllerClasses) &#123;
    println controllerClass.name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The dynamic method conventions are as follows:</div>
ダイナミックメソッドの規約は以下のとおりです:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>*Classes</code> - Retrieves all the classes for a particular artefact name. For example <code>application.controllerClasses</code>.</li>
<li><code>get*Class</code> - Retrieves a named class for a particular artefact. For example <code>application.getControllerClass("PersonController")</code></li>
<li><code>is*Class</code> - Returns <code>true</code> if the given class is of the given artefact type. For example <code>application.isControllerClass(PersonController)</code></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>*Classes</code> - 特定のアーテファクト名のすべてのクラスを取り出す。 例えば<code>application.controllerClasses</code>。</li>
<li><code>get*Class</code> - 特定のアーテファクトの、指定した名前のクラスを取り出す。 例えば<code>application.getControllerClass("PersonController")</code>。</li>
<li><code>is*Class</code> - もし指定したクラスが指定したアーテファクトタイプであれば<code>true</code>を返す。 例えば、<code>application.isControllerClass(PersonController)</code>。</li>
</ul><p class="paragraph"/><div class="hidden-block">The <code>GrailsClass</code> interface has a number of useful methods that let you further evaluate and work with the conventions. These include:</div><p class="paragraph"/><code>GrailsClass</code>インターフェースは、規約に関する評価や処理をさらに容易にするための、以下のような便利なメソッド群を持っています:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>getPropertyValue</code> - Gets the initial value of the given property on the class</li>
<li><code>hasProperty</code> - Returns <code>true</code> if the class has the specified property</li>
<li><code>newInstance</code> - Creates a new instance of this class.</li>
<li><code>getName</code> -  Returns the logical name of the class in the application without the trailing convention part if applicable</li>
<li><code>getShortName</code> - Returns the short name of the class without package prefix</li>
<li><code>getFullName</code> - Returns the full name of the class in the application with the trailing convention part and with the package name</li>
<li><code>getPropertyName</code> - Returns the name of the class as a property name</li>
<li><code>getLogicalPropertyName</code> - Returns the logical property name of the class in the application without the trailing convention part if applicable</li>
<li><code>getNaturalName</code> - Returns the name of the property in natural terms (eg. 'lastName' becomes 'Last Name')</li>
<li><code>getPackageName</code> - Returns the package name</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>getPropertyValue</code> - そのクラスの指定したプロパティの初期値を取得する。</li>
<li><code>hasProperty</code> - もしクラスが指定したプロパティを持っていたら<code>true</code>を返す。</li>
<li><code>newInstance</code> - このクラスの新しいインスタンスを返す。</li>
<li><code>getName</code> -  取得可能であれば、末尾の規約部分を除いた、アプリケーションにおける論理名を返す。</li>
<li><code>getShortName</code> - そのクラスのパッケージ接頭辞を除いた短縮名を返す。</li>
<li><code>getFullName</code> - 末尾の規約部分と先頭のパッケージ部分を含むクラスのフルネームを返す。</li>
<li><code>getPropertyName</code> - クラス名をプロパティ名として返す。</li>
<li><code>getLogicalPropertyName</code> - 末尾の規約部分を除き、アプリケーションにおけるクラスの論理プロパティ名を返す。</li>
<li><code>getNaturalName</code> - 自然な語句としてのプロパティ名を返す。(例: 'lastName'は'Last Name'になる)</li>
<li><code>getPackageName</code> - パッケージ名を返す。</li>
</ul><p class="paragraph"/><div class="hidden-block">For a full reference refer to the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">javadoc API</a>.</div><p class="paragraph"/>全体のリファレンスについては、<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">javadoc API</a>を参照してください。


<a name="15.6 Hooking into Build Events"><!-- Legacy link --></a>
<h2 id="hookingIntoBuildEvents">15.6 ビルドイベントのフック</h2>
<div class="hidden-block">h4. Post-Install Configuration and Participating in Upgrades</div><p class="paragraph"/><h4>Post-Install設定とアップグレード</h4><p class="paragraph"/><div class="hidden-block">Grails plugins can do post-install configuration and participate in application upgrade process (the <a href="../ref/Command Line/upgrade.html" class="commandLine">upgrade</a> command). This is achieved using two specially named scripts under the <code>scripts</code> directory of the plugin - <code>_Install.groovy</code> and <code>_Upgrade.groovy</code>.</div><p class="paragraph"/>Grailsプラグインはpost-install設定を行なったり、アプリケーションの更新プロセス(<a href="../ref/Command Line/upgrade.html" class="commandLine">upgrade</a>コマンドで実行する)に介在することができます。これは2つの特別な名前のスクリプト、<code>_Install.groovy</code>と<code>_Upgrade.groovy</code>スクリプトを、プラグインの<code>scripts</code>ディレクトリ配下に置くことで可能になります。<p class="paragraph"/><div class="hidden-block"><code>_Install.groovy</code> is executed after the plugin has been installed and <code>_Upgrade.groovy</code> is executed each time the user upgrades the application (but not the plugin) with <a href="../ref/Command Line/upgrade.html" class="commandLine">upgrade</a> command.</div><p class="paragraph"/><code>_Install.groovy</code>はプラグインがインストールされた後に実行され、<code>_Upgrade.groovy</code>コマンドはアプリケーションが <a href="../ref/Command Line/upgrade.html" class="commandLine">upgrade</a>コマンドで更新されるたびに実行されます(プラグインをupgradeコマンドで更新した時ではありません)。<p class="paragraph"/><div class="hidden-block">These scripts are <a href="../guide/single.html#commandLine" class="guide">Gant</a> scripts, so you can use the full power of Gant. An addition to the standard Gant variables there is also a <code>pluginBasedir</code> variable which points at the plugin installation basedir.</div><p class="paragraph"/>これらのスクリプトは、<a href="../guide/single.html#commandLine" class="guide">Gant</a>スクリプトであり、Gantの全機能を使用することができます。標準Gant変数に加えて、<code>pluginBasedir</code>変数があり、プラグインがインストールされているベースディレクトリを指定しています。<p class="paragraph"/><div class="hidden-block">As an example this <code>_Install.groovy</code> script will create a new directory type under the <code>grails-app</code> directory and install a configuration template:</div><p class="paragraph"/>例えば、以下の<code>_Install.groovy</code>スクリプトは<code>grails-app</code>ディレクトリ配下に新しいディレクトリを作成し、設定テンプレートをインストールします:<p class="paragraph"/><div class="code"><pre>ant.mkdir(dir: <span class="java&#45;quote">"$&#123;basedir&#125;/grails&#45;app/jobs"</span>)<p class="paragraph"/>ant.copy(file: <span class="java&#45;quote">"$&#123;pluginBasedir&#125;/src/samples/SamplePluginConfig.groovy"</span>,
         todir: <span class="java&#45;quote">"$&#123;basedir&#125;/grails&#45;app/conf"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">The <code>pluginBasedir</code> variable is not available in custom scripts, but you can use <code>fooPluginDir</code>, where <code>foo</code> is the name of your plugin.</div><p class="paragraph"/><code>pluginBasedir</code>変数はカスタムスクリプト中では利用できませんが、<code>foo</code>がプラグイン名であるとき、<code>fooPluginDir</code>を使うことができます。<p class="paragraph"/><div class="hidden-block">h4. Scripting events</div>
<h4>イベントをスクリプトで処理する</h4><p class="paragraph"/><div class="hidden-block">It is also possible to hook into command line scripting events. These are events triggered during execution of Grails target and plugin scripts.</div><p class="paragraph"/>コマンドラインスクリプトを実行中のイベントをフックすることもできます。Grailsターゲットとプラグインスクリプトの実行中に発生するイベントがあります。<p class="paragraph"/><div class="hidden-block">For example, you can hook into status update output (i.e. "Tests passed", "Server running") and the creation of files or artefacts.</div><p class="paragraph"/>例えば、状態の変更イベント(「テストがパスしたとき」や「サーバが実行開始」など)や、ファイルやアーテファクトの生成イベントなどにもフックすることができます。<p class="paragraph"/><div class="hidden-block">A plugin just has to provide an <code>_Events.groovy</code> script to listen to the required events. Refer the documentation on <a href="../guide/single.html#events" class="guide">Hooking into Events</a> for further information.</div><p class="paragraph"/>プラグインが必要なイベントをlistenするために必要なのは、<code>_Events.groovy</code>スクリプトを提供することだけです。より詳しい情報については、<a href="../guide/single.html#events" class="guide">イベントをフックする</a>を参照してください。


<a name="15.7 Hooking into Runtime Configuration"><!-- Legacy link --></a>
<h2 id="hookingIntoRuntimeConfiguration">15.7 ランタイム設定へのフック</h2>
<div class="hidden-block">Grails provides a number of hooks to leverage the different parts of the system and perform runtime configuration by convention.</div><p class="paragraph"/>Grailsはシステムの異なる部分を利用するために、多くのフックを提供し、規約によって実行時設定を行います。<p class="paragraph"/><div class="hidden-block">h4. Hooking into the Grails Spring configuration</div><p class="paragraph"/><h4>GrailsのSpring設定にフックする</h4><p class="paragraph"/><div class="hidden-block">First, you can hook in Grails runtime configuration by providing a property called <code>doWithSpring</code> which is assigned a block of code. For example the following snippet is from one of the core Grails plugins that provides <a href="../guide/single.html#i18n" class="guide">i18n</a> support:</div><p class="paragraph"/>まず、<code>doWithSpring</code>という名前の、クロージャブロックが代入されたプロパティを提供することで、Grails実行時設定にフックすることができます。例えば以下のコード断片は、 <a href="../guide/single.html#i18n" class="guide">i18n</a>サポートを提供するコアGrailsプラグインに含まれているものです:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.web.servlet.i18n.CookieLocaleResolver
<span class="java&#45;keyword">import</span> org.springframework.web.servlet.i18n.LocaleChangeInterceptor
<span class="java&#45;keyword">import</span> org.springframework.context.support.ReloadableResourceBundleMessageSource<p class="paragraph"/>class I18nGrailsPlugin &#123;<p class="paragraph"/>    def version = <span class="java&#45;quote">"0.1"</span><p class="paragraph"/>    def doWithSpring = &#123;
        messageSource(ReloadableResourceBundleMessageSource) &#123;
            basename = <span class="java&#45;quote">"WEB&#45;INF/grails&#45;app/i18n/messages"</span>
        &#125;
        localeChangeInterceptor(LocaleChangeInterceptor) &#123;
            paramName = <span class="java&#45;quote">"lang"</span>
        &#125;
        localeResolver(CookieLocaleResolver)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This plugin configures the Grails <code>messageSource</code> bean and a couple of other beans to manage Locale resolution and switching. It using the <a href="../guide/single.html#spring" class="guide">Spring Bean Builder</a> syntax to do so.</div><p class="paragraph"/>このプラグインは、Grailsの<code>messageSource</code>ビーンと、Locale解決と切り替えを行う他のいくつかのビーンを設定します。これは<a href="../guide/single.html#spring" class="guide">Springビーンビルダ</a>のシンタックスを使用します。<p class="paragraph"/><div class="hidden-block">h4. Participating in web.xml Generation</div><p class="paragraph"/><h4>web.xml生成への参加</h4><p class="paragraph"/><div class="hidden-block">Grails generates the <code>WEB-INF/web.xml</code> file at load time, and although plugins cannot change this file directly, they can participate in the generation of the file. A plugin can provide a <code>doWithWebDescriptor</code> property that is assigned a block of code that gets passed the <code>web.xml</code> as an <code>XmlSlurper</code> <code>GPathResult</code>.</div><p class="paragraph"/>Grailsは<code>WEB-INF/web.xml</code>ファイルをロード時に生成し、プラグインはこのファイルを直接変更することはできませんが、このファイルの生成過程に参加することができます。プラグインはクロージャコードブロックが代入された<code>doWithWebDescriptor</code>プロパティを提供することができ、そのコードには<code>XmlSlurper</code>の<code>GPathResult</code>として<code>web.xml</code>が渡されます。<p class="paragraph"/><div class="hidden-block">h5. Add <code>servlet</code> and <code>servlet-mapping</code></div><p class="paragraph"/><h5><code>servlet</code>と<code>servlet-mapping</code>の追加</h5><p class="paragraph"/><div class="hidden-block">Consider this example from the <code>ControllersPlugin</code>:</div><p class="paragraph"/><code>ControllersPlugin</code>にある、以下の例を考えてみてください:<p class="paragraph"/><div class="code"><pre>def doWithWebDescriptor = &#123; webXml &#45;&#62;<p class="paragraph"/>    def mappingElement = webXml.'servlet&#45;mapping'<p class="paragraph"/>    def lastMapping = mappingElement&#91;mappingElement.size() &#45; 1&#93;
    lastMapping + &#123;
        'servlet&#45;mapping' &#123;
            'servlet&#45;name'(<span class="java&#45;quote">"grails"</span>)
            'url&#45;pattern'(<span class="java&#45;quote">"&#42;.dispatch"</span>)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here the plugin gets a reference to the last <code>&#60;servlet-mapping&#62;</code> element and appends Grails' servlet after it using XmlSlurper's ability to programmatically modify XML using closures and blocks.</div><p class="paragraph"/>XmlSlurperの「クロージャとブロックを使ってプログラム的にXMLを修正できる」という機能を使って、ここではプラグインは<code>&#60;servlet-mapping&#62;</code>への参照を取得し、Grailsのサーブレットを追加しています。<p class="paragraph"/><div class="hidden-block">h5. Add <code>filter</code> and <code>filter-mapping</code></div><p class="paragraph"/><h5><code>filter</code>と<code>filter-mapping</code>の追加</h5><p class="paragraph"/><div class="hidden-block">Adding a filter with its mapping works a little differently. The location of the <code>&#60;filter&#62;</code> element doesn't matter since order is not important, so it's simplest to insert your custom filter definition immediately after the last <code>&#60;context-param&#62;</code> element. Order  <em class="italic">is</em>  important for mappings, but the usual approach is to add it immediately after the last <code>&#60;filter&#62;</code> element like so:</div><p class="paragraph"/>マッピングを伴うフィルターの追加は少し異なります。順序は重要ではないので、<code>&#60;filter&#62;</code>要素の場所は問題になりません。なのでカスタムフィルタ定義を最後の<code>&#60;context-param&#62;</code>要素のすぐ後に挿入するのが最も簡単です。マッピングに関しては  <em class="italic">順序は重要</em>  です。しかし通常の場合、<code>&#60;filter&#62;</code>要素の直後に追加してしまいます:<p class="paragraph"/><div class="code"><pre>def doWithWebDescriptor = &#123; webXml &#45;&#62;<p class="paragraph"/>    def contextParam = webXml.'context&#45;param'<p class="paragraph"/>    contextParam&#91;contextParam.size() &#45; 1&#93; + &#123;
        'filter' &#123;
            'filter&#45;name'('springSecurityFilterChain')
            'filter&#45;class'(DelegatingFilterProxy.name)
        &#125;
    &#125;<p class="paragraph"/>    def filter = webXml.'filter'
    filter&#91;filter.size() &#45; 1&#93; + &#123;
        'filter&#45;mapping'&#123;
            'filter&#45;name'('springSecurityFilterChain')
            'url&#45;pattern'('/&#42;')
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In some cases you need to ensure that your filter comes after one of the standard Grails filters, such as the Spring character encoding filter or the SiteMesh filter. Fortunately you can insert filter mappings immediately after the standard ones (more accurately, any that are in the template web.xml file) like so:</div><p class="paragraph"/>フィルターは、例えばSpringの文字エンコーディングフィルタやSiteMeshフィルタなどの標準Grailsフィルターの後に実行されなければならない場合があります。この場合、以下のようにすることで、フィルタマッピングを標準のフィルタ(正確に言えば、テンプレートのweb.xmlファイルに含まれている任意のもの)のすぐ後に挿入することができます:<p class="paragraph"/><div class="code"><pre>def doWithWebDescriptor = &#123; webXml &#45;&#62;
    ...<p class="paragraph"/>    // Insert the Spring Security filter after the Spring
    // character encoding filter.
    def filter = webXml.'filter&#45;mapping'.find &#123;
        it.'filter&#45;name'.text() == <span class="java&#45;quote">"charEncodingFilter"</span>
    &#125;<p class="paragraph"/>    filter + &#123;
        'filter&#45;mapping'&#123;
            'filter&#45;name'('springSecurityFilterChain')
            'url&#45;pattern'('/&#42;')
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Doing Post Initialisation Configuration</div>
<h4>初期化設定後の実行</h4><p class="paragraph"/><div class="hidden-block">Sometimes it is useful to be able do some runtime configuration after the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a> has been built. In this case you can define a <code>doWithApplicationContext</code> closure property.</div><p class="paragraph"/><a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a>が構築された後で実行時設定を行うことが有用な場合があります。そのためには<code>doWithApplicationContext</code>クロージャプロパティを定義します。<p class="paragraph"/><div class="code"><pre>class SimplePlugin &#123;<p class="paragraph"/>    def name = <span class="java&#45;quote">"simple"</span>
    def version = <span class="java&#45;quote">"1.1"</span><p class="paragraph"/>    def doWithApplicationContext = &#123; appCtx &#45;&#62;
        def sessionFactory = appCtx.sessionFactory
        // <span class="java&#45;keyword">do</span> something here with session factory
    &#125;
&#125;</pre></div>


<a name="15.8 Adding Dynamic Methods at Runtime"><!-- Legacy link --></a>
<h2 id="addingDynamicMethodsAtRuntime">15.8 実行時のダイナミックメソッド追加</h2>
<div class="hidden-block">h4. The Basics</div>
<h4>基本的な考え方</h4><p class="paragraph"/><div class="hidden-block">Grails plugins let you register dynamic methods with any Grails-managed or other class at runtime. This work is done in a <code>doWithDynamicMethods</code> closure.</div><p class="paragraph"/>Grailsプラグインでは、Grails管理下および他のクラスに対して、実行時にダイナミックメソッドを登録することができます。これは<code>doWithDynamicMethods</code>クロージャで行ないます。<p class="paragraph"/><div class="hidden-block">For Grails-managed classes like controllers, tag libraries and so forth you can add methods, constructors etc. using the <a href="http://groovy.codehaus.org/ExpandoMetaClass" target="blank">ExpandoMetaClass</a> mechanism by accessing each controller's <a href="http://groovy.codehaus.org/api/groovy/lang/MetaClass.html" class="api">MetaClass</a>:</div><p class="paragraph"/>コントローラやタグライブラリなどのようなGrails管理下のクラスについては、それぞれのコントローラの<a href="http://groovy.codehaus.org/api/groovy/lang/MetaClass.html" class="api">MetaClass</a>を <a href="http://groovy.codehaus.org/ExpandoMetaClass" target="blank">ExpandoMetaClass</a> の機構でアクセスすることによって、メソッドやコンストラクタなどを追加できます:<p class="paragraph"/><div class="code"><pre>class ExamplePlugin &#123;
    def doWithDynamicMethods = &#123; applicationContext &#45;&#62;
        <span class="java&#45;keyword">for</span> (controllerClass in application.controllerClasses) &#123;
             controllerClass.metaClass.myNewMethod = &#123;&#45;&#62; println <span class="java&#45;quote">"hello world"</span> &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case we use the implicit application object to get a reference to all of the controller classes' MetaClass instances and add a new method called <code>myNewMethod</code> to each controller. If you know beforehand the class you wish the add a method to you can simply reference its <code>metaClass</code> property.</div><p class="paragraph"/>この場合、暗黙のapplicationオブジェクトを使い、すべてのコントローラクラスのMetaClassの参照を取得し、それぞれのコントローラに<code>myNewMethod</code>という新規メソッドを追加しています。メソッドを追加したいクラスが予め判っていれば、その<code>metaClass</code>プロパティを単純に参照できます。<p class="paragraph"/><div class="hidden-block">For example we can add a new method <code>swapCase</code> to <code>java.lang.String</code>:</div><p class="paragraph"/>例えば、<code>swapCase</code>メソッドを<code>java.lang.String</code>クラスに追加できます:<p class="paragraph"/><div class="code"><pre>class ExamplePlugin &#123;<p class="paragraph"/>    def doWithDynamicMethods = &#123; applicationContext &#45;&#62;
        <span class="java&#45;object">String</span>.metaClass.swapCase = &#123;&#45;&#62;
             def sb = <span class="java&#45;keyword">new</span> StringBuilder()
             delegate.each &#123;
                 sb &#60;&#60; (<span class="java&#45;object">Character</span>.isUpperCase(it as <span class="java&#45;object">char</span>) ?
                        <span class="java&#45;object">Character</span>.toLowerCase(it as <span class="java&#45;object">char</span>) :
                        <span class="java&#45;object">Character</span>.toUpperCase(it as <span class="java&#45;object">char</span>))
             &#125;
             sb.toString()
        &#125;<p class="paragraph"/>        assert <span class="java&#45;quote">"UpAndDown"</span> == <span class="java&#45;quote">"uPaNDdOWN"</span>.swapCase()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Interacting with the ApplicationContext</div><p class="paragraph"/><h4>アプリケーションコンテキストとの相互作用</h4><p class="paragraph"/><div class="hidden-block">The <code>doWithDynamicMethods</code> closure gets passed the Spring <code>ApplicationContext</code> instance. This is useful as it lets you interact with objects within it. For example if you were implementing a method to interact with Hibernate you could use the <code>SessionFactory</code> instance in combination with a <code>HibernateTemplate</code>:</div><p class="paragraph"/><code>doWithDynamicMethods</code>クロージャにはSpringの<code>ApplicationContext</code>インスタンスが渡されます。これはその中のオブジェクトとやりとりできるので便利です。例えば、Hibernateと相互作用するメソッドを定義しているなら、<code>SessionFactory</code>インスタンスと<code>HibernateTemplate</code>を組合せて使うことができます:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.orm.hibernate3.HibernateTemplate<p class="paragraph"/>class ExampleHibernatePlugin &#123;<p class="paragraph"/>   def doWithDynamicMethods = &#123; applicationContext &#45;&#62;<p class="paragraph"/>       <span class="java&#45;keyword">for</span> (domainClass in application.domainClasses) &#123;<p class="paragraph"/>           domainClass.metaClass.<span class="java&#45;keyword">static</span>.load = &#123; <span class="java&#45;object">Long</span> id&#45;&#62;
                def sf = applicationContext.sessionFactory
                def template = <span class="java&#45;keyword">new</span> HibernateTemplate(sf)
                template.load(delegate, id)
           &#125;
       &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Also because of the autowiring and dependency injection capability of the Spring container you can implement more powerful dynamic constructors that use the application context to wire dependencies into your object at runtime:</div><p class="paragraph"/>Springコンテナにはオートワイアリング(autowiring)と依存性注入(DI)機能があるので、依存性を実行時に解決するのにアプリケーションコンテキストを使用する、より強力なダイナミックコンストラクタをあなたのオブジェクトに実装することもできます:<p class="paragraph"/><div class="code"><pre>class MyConstructorPlugin &#123;<p class="paragraph"/>    def doWithDynamicMethods = &#123; applicationContext &#45;&#62;
         <span class="java&#45;keyword">for</span> (domainClass in application.domainClasses) &#123;
              domainClass.metaClass.constructor = &#123;&#45;&#62;
                  <span class="java&#45;keyword">return</span> applicationContext.getBean(domainClass.name)
              &#125;
         &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we actually replace the default constructor with one that looks up prototyped Spring beans instead!</div><p class="paragraph"/>ここでは、デフォルトコンストラクタを、prototypeのSpringビーンをルックアップするようなコンストラクタに実際に置き換えています。


<a name="15.9 Participating in Auto Reload Events"><!-- Legacy link --></a>
<h2 id="participatingInAutoReloadEvents">15.9 自動リロードイベントへの参加</h2>
<div class="hidden-block">h4. Monitoring Resources for Changes</div>
<h4>リソース変更の監視</h4><p class="paragraph"/><div class="hidden-block">Often it is valuable to monitor resources for changes and perform some action when they occur. This is how Grails implements advanced reloading of application state at runtime. For example, consider this simplified snippet from the Grails <code>ServicesPlugin</code>:</div><p class="paragraph"/>リソース変更を監視し、変更された場合に何らかのアクションを実行することが便利なときがあります。この方法を用いて、Grailsではアプリケーションの状態が実行時に変化したときに高度なリローディングを行っています。例えば、<code>ServicesPlugin</code>のにあるものを単純化した以下のコード断片を見てください:<p class="paragraph"/><div class="code"><pre>class ServicesGrailsPlugin &#123;
    &#8230;
    def watchedResources = <span class="java&#45;quote">"file:./grails&#45;app/services/&#42;Service.groovy"</span><p class="paragraph"/>    &#8230;
    def onChange = &#123; event &#45;&#62;
        <span class="java&#45;keyword">if</span> (event.source) &#123;
            def serviceClass = application.addServiceClass(event.source)
            def serviceName = <span class="java&#45;quote">"&#36;&#123;serviceClass.propertyName&#125;"</span>
            def beans = beans &#123;
                <span class="java&#45;quote">"$serviceName"</span>(serviceClass.getClazz()) &#123; bean &#45;&#62;
                    bean.autowire =  <span class="java&#45;keyword">true</span>
                &#125;
            &#125;
            <span class="java&#45;keyword">if</span> (event.ctx) &#123;
                event.ctx.registerBeanDefinition(
                        serviceName,
                        beans.getBeanDefinition(serviceName))
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">First it defines <code>watchedResources</code> as either a String or a List of strings that contain either the references or patterns of the resources to watch. If the watched resources specify a Groovy file, when it is changed it will automatically be reloaded and passed into the <code>onChange</code> closure in the <code>event</code> object.</div><p class="paragraph"/>最初に<code>watchedResources</code>変数を定義していますが、これは監視対象としたいリソースへの参照もしくはパターンを含む、文字列もしくは文字列のリストです。もし監視されるリソースがGroovyファイルを指定しているのであれば、それが変更されたときには自動的にリロードが実行されます。そして、<code>onChange</code>クロージャが呼び出され、Groovyファイルはその引数である<code>event</code>オブジェクト中に設定されます:<p class="paragraph"/><div class="hidden-block">The <code>event</code> object defines a number of useful properties:</div><p class="paragraph"/><code>event</code>オブジェクトは多数の有用なプロパティを含んでいます:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>event.source</code> - The source of the event, either the reloaded <code>Class</code> or a Spring <code>Resource</code></li>
<li><code>event.ctx</code> - The Spring <code>ApplicationContext</code> instance</li>
<li><code>event.plugin</code> - The plugin object that manages the resource (usually <code>this</code>)</li>
<li><code>event.application</code> - The <code>GrailsApplication</code> instance</li>
<li><code>event.manager</code> - The <code>GrailsPluginManager</code> instance</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>event.source</code> - イベントの発生元。リロードされた<code>Class</code>もしくはSpring <code>Resource</code>。</li>
<li><code>event.ctx</code> - Spring <code>ApplicationContext</code>インスタンス</li>
<li><code>event.plugin</code> - このリソースを管理しているプラグインオブジェクト(通常<code>this</code>)。</li>
<li><code>event.application</code> - <code>GrailsApplication</code>インスタンス</li>
<li><code>event.manager</code> - <code>GrailsPluginManager</code>インスタンス</li>
</ul><p class="paragraph"/><div class="hidden-block">These objects are available to help you apply the appropriate changes based on what changed. In the "Services" example above, a new service bean is re-registered with the <code>ApplicationContext</code> when one of the service classes changes.</div><p class="paragraph"/>何が変更されたかによって異なる適切な変更をするためには、これらのオブジェクトが利用可能です。前述のサービスの例においては、サービスクラスが変更されたとき、新しいサービスビーンが<code>ApplicationContext</code>において再登録されます。<p class="paragraph"/><div class="hidden-block">h4. Influencing Other Plugins</div><p class="paragraph"/><h4>他のプラグインに影響を及ぼす</h4><p class="paragraph"/><div class="hidden-block">In addition to reacting to changes, sometimes a plugin needs to "influence" another.</div><p class="paragraph"/>変更に対してリアクションするのに加え、プラグインは他のプラグインに「影響を及ぼす」必要があるときがあります。<p class="paragraph"/><div class="hidden-block">Take for example the Services and Controllers plugins. When a service is reloaded, unless you reload the controllers too, problems will occur when you try to auto-wire the reloaded service into an older controller Class.</div><p class="paragraph"/>サービスとコントローラのプラグインを例にとりましょう。サービスがリロードされた場合、コントローラもリロードしなければ、リロードされたサービスを古いコントローラクラスにオートワイヤ(auto-wire)するときに問題が発生するでしょう。<p class="paragraph"/><div class="hidden-block">To get around this, you can specify which plugins another plugin "influences". This means that when one plugin detects a change, it will reload itself and then reload its influenced plugins. For example consider this snippet from the <code>ServicesGrailsPlugin</code>:</div><p class="paragraph"/>この問題を回避するために、どのプラグインが他のプラグインに「影響を及ぼす」のかを指定することができます。これが意味するのは、あるプラグインが変更を検出したとき、そのプラグイン自身がリロードされた後に、それが「影響を及ぼしている」プラグインもリロードされるということです。例えば、<code>ServicesGrailsPlugin</code>にある以下のコード断片を考えてみましょう:<p class="paragraph"/><div class="code"><pre>def influences = &#91;'controllers'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Observing other plugins</div><p class="paragraph"/><h4>他のプラグインを観察する</h4><p class="paragraph"/><div class="hidden-block">If there is a particular plugin that you would like to observe for changes but not necessary watch the resources that it monitors you can use the "observe" property:</div><p class="paragraph"/>変更を観察したい特定のプラグインがあり、そのプラグインが監視するリソースを監視する必要がないなら、「observe」プロパティを使うことができます:<p class="paragraph"/><div class="code"><pre>def observe = &#91;<span class="java&#45;quote">"controllers"</span>&#93;</pre></div><p class="paragraph"/><div class="hidden-block">In this case when a controller is changed you will also receive the event chained from the controllers plugin.</div><p class="paragraph"/>この場合、コントローラが変更されたとき、あなたのプラグインもコントローラプラグインから連鎖したイベントを受け取ります。<p class="paragraph"/><div class="hidden-block">It is also possible for a plugin to observe all loaded plugins by using a wildcard:</div><p class="paragraph"/>ワイルドカードを使えば、すべてのプラグインの変更を監視することも可能です:<p class="paragraph"/><div class="code"><pre>def observe = &#91;<span class="java&#45;quote">"&#42;"</span>&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The Logging plugin does exactly this so that it can add the <code>log</code> property back to  <em class="italic">any</em>  artefact that changes while the application is running.</div><p class="paragraph"/>ロギングプラグインはちょうどこのようなことを行なっており、アプリの実行中に変更があった  <em class="italic">任意の</em>  アーティファクトに<code>log</code>プロパティを設定し直しています。


<a name="15.10 Understanding Plug-in Load Order"><!-- Legacy link --></a>
<h2 id="understandingPluginLoadOrder">15.10 プラグインのロード順を理解する</h2>
<div class="hidden-block">h4. Controlling Plugin Dependencies</div><p class="paragraph"/><h4>プラグインの依存性制御</h4><p class="paragraph"/><div class="hidden-block">Plugins often depend on the presence of other plugins and can adapt depending on the presence of others. This is implemented with two properties. The first is called <code>dependsOn</code>. For example, take a look at this snippet from the Hibernate plugin:</div><p class="paragraph"/>プラグインはしばしば他のプラグインの存在に依存しますが、他のプラグインの存在についての依存性に適応することができます。これは2つのプロパティで行うことができます。1つ目は<code>dependsOn</code>というプロパティですが、Hibernateプラグインにある以下のコード断片を見て下さい:<p class="paragraph"/><div class="code"><pre>class HibernateGrailsPlugin &#123;<p class="paragraph"/>    def version = <span class="java&#45;quote">"1.0"</span><p class="paragraph"/>    def dependsOn = &#91;dataSource: <span class="java&#45;quote">"1.0"</span>,
                     domainClass: <span class="java&#45;quote">"1.0"</span>,
                     i18n: <span class="java&#45;quote">"1.0"</span>,
                     core: <span class="java&#45;quote">"1.0"</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The Hibernate plugin is dependent on the presence of four plugins: the <code>dataSource</code>, <code>domainClass</code>, <code>i18n</code> and <code>core</code> plugins.</div><p class="paragraph"/>Hibernateプラグインは4つのプラグインに依存しています: <code>dataSource</code>、<code>domainClass</code>、<code>i18n</code>そして<code>core</code>プラグインです。<p class="paragraph"/><div class="hidden-block">The dependencies will be loaded before the Hibernate plugin and if all dependencies do not load, then the plugin will not load.</div><p class="paragraph"/>依存しているプラグインは、Hibernateプラグインの前に読み込まれます。すべての依存プラグインがロードされなければ、プラグインはロードされません。<p class="paragraph"/><div class="hidden-block">The <code>dependsOn</code> property also supports a mini expression language for specifying version ranges. A few examples of the syntax can be seen below:</div><p class="paragraph"/><code>dependsOn</code>プロパティはバージョン範囲を指定するためのミニ式言語をサポートしています。以下は例です：<p class="paragraph"/><div class="code"><pre>def dependsOn = &#91;foo: <span class="java&#45;quote">"&#42; &#62; 1.0"</span>&#93;
def dependsOn = &#91;foo: <span class="java&#45;quote">"1.0 &#62; 1.1"</span>&#93;
def dependsOn = &#91;foo: <span class="java&#45;quote">"1.0 &#62; &#42;"</span>&#93;</pre></div><p class="paragraph"/><div class="hidden-block">When the wildcard <strong class="bold"> character is used it denotes "any" version. The expression syntax also excludes any suffixes such as -BETA, -ALPHA etc. so for example the expression "1.0 &#62; 1.1" would match any of the following versions:</div><p class="paragraph"/>ワイルドカード文字</strong>が任意のバージョンを表わすために使われます。また、この式のシンタックスは、「-BETA」や「-ALPHA」といった接尾辞を除外します。なので例えば「1.0 &#62; 1.1」は以下のバージョンにマッチします。
<ul class="star">
<li>1.1</li>
<li>1.0</li>
<li>1.0.1</li>
<li>1.0.3-SNAPSHOT</li>
<li>1.1-BETA2</li>
</ul><p class="paragraph"/><div class="hidden-block">h4. Controlling Load Order</div><p class="paragraph"/><h4>ロード順序の制御</h4><p class="paragraph"/><div class="hidden-block">Using <code>dependsOn</code> establishes a "hard" dependency in that if the dependency is not resolved, the plugin will give up and won't load.  It is possible though to have a weaker dependency using the <code>loadAfter</code> and <code>loadBefore</code> properties:</div><p class="paragraph"/><code>dependsOn</code>は、依存性が解決されなければプラグインのロードをあきらめるような「ハード依存性」を確立します。<code>loadAfter</code>と<code>loadBefore</code>プロパティを使うことで「より弱い依存性」を使うこともできます。<p class="paragraph"/><div class="code"><pre>def loadAfter = &#91;'controllers'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">Here the plugin will be loaded after the <code>controllers</code> plugin if it exists, otherwise it will just be loaded. The plugin can then adapt to the presence of the other plugin, for example the Hibernate plugin has this code in its <code>doWithSpring</code> closure:</div><p class="paragraph"/>ここでは、もし<code>controllers</code>プラグインが存在すれば、それがロードされた後に、このプラグインがロードされます。 さもなければ(<code>controllers</code>プラグインが存在しなければ)、このプラグインは単にロードされます。プラグインは他のプラグインの存在に適応します。たとえば、Hibernateプラグインは<code>doWithSpring</code>クロージャで以下を行っています:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (manager?.hasGrailsPlugin(<span class="java&#45;quote">"controllers"</span>)) &#123;
    openSessionInViewInterceptor(OpenSessionInViewInterceptor) &#123;
        flushMode = HibernateAccessor.FLUSH_MANUAL
        sessionFactory = sessionFactory
    &#125;
    grailsUrlHandlerMapping.interceptors &#60;&#60; openSessionInViewInterceptor
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here the Hibernate plugin will only register an <code>OpenSessionInViewInterceptor</code> if the <code>controllers</code> plugin has been loaded. The <code>manager</code> variable is an instance of the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/plugins/GrailsPluginManager.html" class="api">GrailsPluginManager</a> interface and it provides methods to interact with other plugins.</div><p class="paragraph"/>ここではHibernateプラグインは、<code>controllers</code>プラグインがロードされてれば、<code>OpenSessionInViewInterceptor</code>だけを登録します。<code>manager</code>変数は<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/plugins/GrailsPluginManager.html" class="api">GrailsPluginManager</a>インターフェースのインスタンスであり、他のプラグインと相互作用するためのメソッドを提供しています。<p class="paragraph"/><div class="hidden-block">You can also use the <code>loadBefore</code> property to specify one or more plugins that your plugin should load before:</div><p class="paragraph"/><code>loadBefore</code>プロパティには、あなたのプラグインの前にロードしておかなければならない1個以上のプラグインを指定します。<p class="paragraph"/><div class="code"><pre>def loadBefore = &#91;'rabbitmq'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Scopes and Environments</div><p class="paragraph"/><h4>スコープと環境</h4><p class="paragraph"/><div class="hidden-block">It's not only plugin load order that you can control. You can also specify which environments your plugin should be loaded in and which scopes (stages of a build). Simply declare one or both of these properties in your plugin descriptor:</div><p class="paragraph"/>制御できるのはプラグインのロード順だけではありません。プラグインがどの環境にロードされるか、あるいはどのスコープ(ビルドの各段階)でロードされるかを指定することもできます。やり方は、それぞれのプロパティをプラグインディスクリプタ中に宣言するだけです。<p class="paragraph"/><div class="code"><pre>def environments = &#91;'development', 'test', 'myCustomEnv'&#93;
def scopes = &#91;excludes:'war'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">In this example, the plugin will only load in the 'development' and 'test' environments. Nor will it be packaged into the WAR file, because it's excluded from the 'war' phase. This allows <code>development-only</code> plugins to not be packaged for production use.</div><p class="paragraph"/>この例では、プラグインは「development」と「test」環境のときだけロードされます。また、warフェイズからは除外設定されているので、WARファイル中にはパッケージされません。こうすることで、<code>development-only</code>のプラグインは、実運用時にはパッケージされないようにできます。<p class="paragraph"/><div class="hidden-block">The full list of available scopes are defined by the enum <a href="http://grails.org/doc/latest/api/grails/util/BuildScope.html" class="api">BuildScope</a>, but here's a summary:</div><p class="paragraph"/>利用可能なスコープの全てのリストはenum <a href="http://grails.org/doc/latest/api/grails/util/BuildScope.html" class="api">BuildScope</a>で定義されていますが、以下はその抜粋です:<p class="paragraph"/><div class="code"><pre>&#42; <code>test</code> &#45; when running tests
&#42; <code>functional&#45;test</code> &#45; when running functional tests
&#42; <code>run</code> &#45; <span class="java&#45;keyword">for</span> run&#45;app and run&#45;war
&#42; <code>war</code> &#45; when packaging the application as a WAR file
&#42; <code>all</code> &#45; plugin applies to all scopes (<span class="java&#45;keyword">default</span>)</pre></div>
<ul class="star">
<li><code>test</code> - テスト実行時</li>
<li><code>functional-test</code> - ファンクショナルテスト実行時</li>
<li><code>run</code> - run-appもしくはrun-war時</li>
<li><code>war</code> - アプリケーションがWARファイルにパッケージ化されたとき</li>
<li><code>all</code> - 全てのスコープに適用されるプラグイン(デフォルト)</li>
</ul><p class="paragraph"/><div class="hidden-block">Both properties can be one of:</div><p class="paragraph"/>いずれのプロパティにも以下のうち1つを設定することができます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>a string - a sole inclusion</li>
<li>a list - a list of environments or scopes to include</li>
<li>a map - for full control, with 'includes' and/or 'excludes' keys that can have string or list values</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>a string - 1つ含む</li>
<li>a list - 含められるべき環境もしくはスコープのリスト</li>
<li>a map - 全ての制御。キーは'includes'か'excludes'で、バリューは文字列もしくはリスト</li>
</ul><p class="paragraph"/><div class="hidden-block">For example,</div><p class="paragraph"/>例えば、<p class="paragraph"/><div class="code"><pre>def environments = <span class="java&#45;quote">"test"</span></pre></div><p class="paragraph"/><div class="hidden-block">will only include the plugin in the test environment, whereas</div><p class="paragraph"/>という指定の場合、テスト環境のみでプラグインが含められます。これに対して<p class="paragraph"/><div class="code"><pre>def environments = &#91;<span class="java&#45;quote">"development"</span>, <span class="java&#45;quote">"test"</span>&#93;</pre></div><p class="paragraph"/><div class="hidden-block">will include it in both the development  <em class="italic">and</em>  test environments. Finally,</div><p class="paragraph"/>はdevelopment  <em class="italic">と</em>  test環境の両方を含みます。最後に<p class="paragraph"/><div class="code"><pre>def environments = &#91;includes: &#91;<span class="java&#45;quote">"development"</span>, <span class="java&#45;quote">"test"</span>&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">will do the same thing.</div><p class="paragraph"/>も同様の意味です。



<h2 id="artefactApi">15.11 アーテファクトAPI</h2>
<div class="hidden-block">You should by now understand that Grails has the concept of artefacts: special types of classes that it knows about and can treat differently from normal Groovy and Java classes, for example by enhancing them with extra properties and methods. Examples of artefacts include domain classes and controllers. What you may not be aware of is that Grails allows application and plugin developers access to the underlying infrastructure for artefacts, which means you can find out what artefacts are available and even enhance them yourself. You can even provide your own custom artefact types.</div><p class="paragraph"/>これまでの説明で、Grailsにはアーテファクトという概念があることが理解できたと思います。アーテファクトは特別なクラス型であり、通常のGroovyやJavaクラスとは異なるやり方で処理されます。例えば、プロパティやメソッドを追加することで拡張できます。アーテファクトの例は、ドメインクラスやコントローラです。気づいていなかったかもしれませんが、Grailsはアプリケーションやプラグイン開発者が、アーテファクトのための下位層のインフラストラクチャにアクセスすることを許しています。これが意味するのは、どんなアーテファクトが利用可能であるかを調べたり、あるいはそれらを拡張したりすることができるということです。また、あなた独自のカスタムアーテファクト型を追加することさえも可能です。



<h2 id="queryingArtefacts">15.11.1 使用可能なアーテファクトの検索</h2>
<div class="hidden-block">As a plugin developer, it can be important for you to find out about what domain classes, controllers, or other types of artefact are available in an application. For example, the <a href="http://grails.org/plugin/searchable" target="blank">Searchable plugin</a> needs to know what domain classes exist so it can check them for any <code>searchable</code> properties and index the appropriate ones. So how does it do it? The answer lies with the <code>grailsApplication</code> object, and instance of <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> that's available automatically in controllers and GSPs and can be <a href="../guide/single.html#dependencyInjectionServices" class="guide">injected</a> everywhere else.</div><p class="paragraph"/>プラグイン開発者からすると、アプリケーションにおいて、どのドメインクラス・コントローラや他のアーテファクトが利用可能かが分かる、ということが重要かもしれません。
例えば、<a href="http://grails.org/plugin/searchable" target="blank">Searchableプラグイン</a>は、インデックス化すべきであることを指定する<code>searchable</code>プロパティをチェックするために、どんなドメインクラスが存在しているかをまず知る必要があります。では、どんなふうにチェックできるのでしょう？ 答えは<code>grailsApplication</code>オブジェクトと<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a>のインスタンスにあります。これらはコントローラとGSP中では自動的に利用可能となり、他の任意の場所で<a href="../guide/single.html#dependencyInjectionServices" class="guide">注入</a>しておくことができます。<p class="paragraph"/><div class="hidden-block">The <code>grailsApplication</code> object has several important properties and methods for querying artefacts. Probably the most common is the one that gives you all the classes of a particular artefact type:</div><p class="paragraph"/><code>grailsApplication</code>オブジェクトは、アーテファクトを検索するためのいくつかの重要なプロパティとメソッドを保持しています。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (cls in grailsApplication.&#60;artefactType&#62;Classes) &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case, <code>artefactType</code> is the property name form of the artefact type. With core Grails you have:</div><p class="paragraph"/>この場合、<code>artefactType</code>は、プロパティ名中でアーテファクト型を指定する形式であり、Grailsコアでは以下が指定できます:
<ul class="star">
<li>domain</li>
<li>controller</li>
<li>tagLib</li>
<li>service</li>
<li>codec</li>
<li>bootstrap</li>
<li>urlMappings</li>
</ul><p class="paragraph"/><div class="hidden-block">So for example, if you want to iterate over all the domain classes, you use:</div><p class="paragraph"/>例えば、繰り返し処理をすべてのドメインクラスについてしたいならば、以下を使います:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (cls in grailsApplication.domainClasses) &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">and for URL mappings:</div><p class="paragraph"/>URLマッピングの場合なら以下です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (cls in grailsApplication.urlMappingsClasses) &#123;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You need to be aware that the objects returned by these properties are not instances of <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/Class.html" class="api">Class</a>. Instead, they are instances of <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">GrailsClass</a> that has some particularly useful properties and methods, including one for the underlying <code>Class</code>:</div><p class="paragraph"/>これらのプロパティが返すのは<a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/Class.html" class="api">クラス(java.lang.Class)</a>のインスタンスではないことに留意する必要があります。そうではなく、これらは<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">GrailsClass</a>のインスタンスであり、下位の<code>Class</code>型用のものも含め、以下のような便利なプロパティやメソッドが利用可能です。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li><code>shortName</code> - the class name of the artefact without the package (equivalent of <code>Class.simpleName</code>).</li>
<li><code>logicalPropertyName</code> - the artefact name in property form without the 'type' suffix. So <code>MyGreatController</code> becomes 'myGreat'.</li>
<li><code>isAbstract()</code> - a boolean indicating whether the artefact class is abstract or not.</li>
<li><code>getPropertyValue(name)</code> - returns the value of the given property, whether it's a static or an instance one. This works best if the property is initialised on declaration, e.g. <code>static transactional = true</code>.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>shortName</code> - パッケージ部分を除いたアーテファクトのクラス名(<code>Class.simpleName</code>と等価)</li>
<li><code>logicalPropertyName</code> - プロパティ中で用いられる名アーテファクトの名前から型接尾辞を除いたもの。<code>MyGreatController</code>は「myGreat」になる。</li>
<li><code>isAbstract()</code> - アーテファクトクラスがabstractかどうかを表すブーリアン値</li>
<li><code>getPropertyValue(name)</code> - 指定したプロパティ値を、staticか非staticかどうかに関わらず返す。もしプロパティが「<code>static transactional = true</code>」のように初期化されて宣言されていたときにも動作する。</li>
</ul><p class="paragraph"/><div class="hidden-block">The artefact API also allows you to fetch classes by name and check whether a class is an artefact:</div><p class="paragraph"/>アーテファクトAPIで、クラスを名前で取得したり、指定したクラスがアーテファクトかどうかを判断したりすることができます:
<ul class="star">
<li>get&#60;type&#62;Class(String name)</li>
<li>is&#60;type&#62;Class(Class clazz)</li>
</ul><p class="paragraph"/><div class="hidden-block">The first method will retrieve the <code>GrailsClass</code> instance for the given name, e.g. 'MyGreatController'. The second will check whether a class is a particular type of artefact. For example, you can use <code>grailsApplication.isControllerClass(org.example.MyGreatController)</code> to check whether <code>MyGreatController</code> is in fact a controller.</div><p class="paragraph"/>最初のメソッドは、指定した名前、たとえば「MyGreatController」から<code>GrailsClass</code>インスタンスを取得します。二番目のメソッドは、クラスが特定のアーテファクトの型かどうかを判断します。例えば、<code>grailsApplication.isControllerClass(org.example.MyGreatController)</code>とすることで、<code>MyGreatController</code>がコントローラかどうかをチェックすることができます。<p class="paragraph"/>


<h2 id="customArtefacts">15.11.2 アーテファクト型の追加</h2>
<div class="hidden-block">Plugins can easily provide their own artefacts so that they can easily find out what implementations are available and take part in reloading. All you need to do is create an <code>ArtefactHandler</code> implementation and register it in your main plugin class:</div><p class="paragraph"/>プラグインでは、どんな実装が利用できるかわかり、自動リロードの過程に組込むことができるような、自分自身のアーテファクトを簡単に提供することができます。そのためにやるべきことは、<code>ArtefactHandler</code>の実装を生成し、メインのプラグインクラス中に登録しておくことだけです:<p class="paragraph"/><div class="code"><pre>class MyGrailsPlugin &#123;
    def artefacts = &#91; org.somewhere.MyArtefactHandler &#93;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The <code>artefacts</code> list can contain either handler classes (as above) or instances of handlers.</div><p class="paragraph"/>リスト<code>artefacts</code>は、ハンドラクラス(上述)もしくはハンドラの一連のインスタンスを保持することができます。<p class="paragraph"/><div class="hidden-block">So, what does an artefact handler look like? Well, put simply it is an implementation of the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/ArtefactHandler.html" class="api">ArtefactHandler</a> interface. To make life a bit easier, there is a skeleton implementation that can readily be extended: <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/ArtefactHandlerAdapter.html" class="api">ArtefactHandlerAdapter</a>.</div><p class="paragraph"/>それでは、アーテファクトハンドラは、どのようなものでしょうか？ここでは単に<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/ArtefactHandler.html" class="api">ArtefactHandler</a>インターフェースを実装するものということにしておきます。利便のため、extendsすればすぐ使えるスケルトン実装<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/ArtefactHandlerAdapter.html" class="api">ArtefactHandlerAdapter</a>も用意されています。<p class="paragraph"/><div class="hidden-block">In addition to the handler itself, every new artefact needs a corresponding wrapper class that implements <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">GrailsClass</a>. Again, skeleton implementations are available such as <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/AbstractInjectableGrailsClass.html" class="api">AbstractInjectableGrailsClass</a>, which is particularly useful as it turns your artefact into a Spring bean that is auto-wired, just like controllers and services.</div><p class="paragraph"/>ハンドラそれ自身に加えて、新しいアーテファクトは、<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsClass.html" class="api">GrailsClass</a>をimplementsする対応するラッパークラスを必要とします。こちらも<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/AbstractInjectableGrailsClass.html" class="api">AbstractInjectableGrailsClass</a>などのスケルトン実装が利用可能です。これはあなたのアーテファクトを、コントローラやサービスのようにオートワイヤ可能なSpringビーンにしてくれるので特に便利でしょう。<p class="paragraph"/><div class="hidden-block">The best way to understand how both the handler and wrapper classes work is to look at the Quartz plugin:</div><p class="paragraph"/>ハンドラとラッパーの動作を理解するのにベストなやり方は、Quartz pluginのコードを読んでみることです:
<ul class="star">
<li><a href="http://github.com/nebolsin/grails-quartz/blob/master/src/java/grails/plugins/quartz/GrailsJobClass.java" target="blank">GrailsJobClass</a></li>
<li><a href="http://github.com/nebolsin/grails-quartz/blob/master/src/java/grails/plugins/quartz/DefaultGrailsJobClass.java" target="blank">DefaultGrailsJobClass</a></li>
<li><a href="http://github.com/nebolsin/grails-quartz/blob/master/src/java/grails/plugins/quartz/JobArtefactHandler.java" target="blank">JobArtefactHandler</a></li>
</ul><p class="paragraph"/><div class="hidden-block">Another example is the <a href="http://github.com/pledbrook/grails-shiro" target="blank">Shiro plugin</a> which adds a realm artefact.</div><p class="paragraph"/>他の例としては、<a href="http://github.com/pledbrook/grails-shiro" target="blank">Shiroプラグイン</a>があり、こちらはrealmアーテファクトを追加します。


<a name="15.11 Binary Plugins"><!-- Legacy link --></a>
<h2 id="binaryPlugins">15.12 バイナリープラグイン</h2>
<div class="hidden-block">Regular Grails plugins are packaged as zip files containing the full source of the plugin. This has some advantages in terms of being an open distribution system (anyone can see the source), in addition to avoiding problems with the source compatibility level used for compilation.</div>
通常のGrailsプラグインはソースコードがzipされたパッケージです。これはオープンソース配布してコンパイル時に互換性を調整したり、様々な問題を解決するには有利です。<p class="paragraph"/><div class="hidden-block">As of Grails 2.0 you can pre-compile Grails plugins into regular JAR files known as "binary plugins". This has several advantages (and some disadvantages as discussed in the advantages of source plugins above) including:</div>
Grails 2.0から、プラグインを通常のJARファイルとしてプリコンパイルパッケージした、バイナリプラグインを生成配布することが可能になります。バイナリプラグインにすることで以下の利点があります。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Binary plugins can be published as standard JAR files to a Maven repository</li>
<li>Binary plugins can be declared like any other JAR dependency</li>
<li>Commercial plugins are more viable since the source isn't published</li>
<li>IDEs have a better understanding since binary plugins are regular JAR files containing classes</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>Mavenリポジトリで通常のJARファイルで配布可能。</li>
<li>バイナリプラグインは他のJARと同じように依存管理が行える。</li>
<li>ソースコードを公開しない商用プラグインが可能</li>
<li>通常のJARになることによって、IDE等の環境で扱いやすくなる</li>
</ul><p class="paragraph"/><h4>パッケージング <div class="hidden-block">Packaging </div></h4><p class="paragraph"/><div class="hidden-block">To package a plugin in binary form you can use the package-plugin command and the <code>--binary</code> flag:</div>
バイナリープラグインをパッケージする際には、package-pluginコマンドに<code>&#45;&#45;binary</code>フラグを使用します<p class="paragraph"/>
<div class="code"><pre>grails <span class="java&#45;keyword">package</span>&#45;plugin &#45;&#45;binary</pre></div><p class="paragraph"/><div class="hidden-block">Supported artefacts include:</div>
含まれる成果物は:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Grails artifact classes such as controllers, domain classes and so on</li>
<li>I18n Message bundles</li>
<li>GSP Views, layouts and templates</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>コントローラ、ドメイン等のGrailsのアーテファクトクラス</li>
<li>I18nメッセージファイル</li>
<li>GSPビュー、レイアウト、テンプレート</li>
</ul><p class="paragraph"/><div class="hidden-block">You can also specify the packaging in the plugin descriptor:</div>
プラグインディスクリプタにフラグを記述することで、パッケージ時のコマンドフラグを省略できます。<p class="paragraph"/>
<div class="code"><pre>def packaging = <span class="java&#45;quote">"binary"</span></pre></div><p class="paragraph"/><div class="hidden-block">in which case the packaging will default to binary.</div>
上記例では、デフォルトでバイナリプラグインになります。<p class="paragraph"/>
<h4>バイナリプラグイン使用方法 <div class="hidden-block">Using Binary Plugins </div></h4><p class="paragraph"/><div class="hidden-block">The packaging process creates a JAR file in the <code>target</code> directory of the plugin, for example <code>target/foo-plugin-0.1.jar</code>. There are two ways to incorporate a binary plugin into an application.</div>
パッケージを実行するとJARファイルはプラグインプロジェクトの<code>targrt</code>ディレクトリに生成されます。例として<code>target/foo-plugin-0.1.jar</code> 。 バイナリプラグインを使用するには２つの方法があります。<p class="paragraph"/>
<div class="hidden-block">One is simply placing the plugin JAR file in your application's <code>lib</code> directory. The other is to publish the plugin JAR to a compatible Maven repository and declare it as a dependency in <code>grails-app/conf/BuildConfig.groovy</code>:</div>
一つ目は単純に使用するアプリケーションの<code>lib</code>ディレクトリに配置。もう一つの方法は、Mavenリポジトリに配備して、<code>grails-app/conf/BuildConfig.groovy</code>に依存定義を行います。<p class="paragraph"/>
<div class="code"><pre>dependencies &#123;
    compile <span class="java&#45;quote">"mycompany:myplugin:0.1"</span>
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Since binary plugins are packaged as JAR files, they are declared as dependencies in the <code>dependencies</code> block,  <em class="italic">not</em>  in the <code>plugins</code> block as you may be naturally inclined to do. The <code>plugins</code> block is used for declaring traditional source plugins packaged as zip files </div>
バイナリプラグインは依存定義を<code>dependencies</code>ブロックに記述します。<code>plugins</code>ブロックは今までのソースコードがzipされたプラグインで使用します。
</blockquote>


<a name="16. Grails and Spring"><!-- Legacy link --></a>
<h1 id="spring">16 GrailsとSpring</h1>
<div class="hidden-block">
This section is for advanced users and those who are interested in how Grails integrates with and builds on the <a href="http://www.springframework.org/." target="blank">Spring Framework</a> It is also useful for <a href="../guide/single.html#plugins" class="guide">plugin developers</a> considering doing runtime configuration Grails.
</div>
このセクションでは、Grailsが <a href="http://www.springframework.org/" target="blank">Spring Framework</a> とどのように統合され、構築されるかに興味がある上級者向けの内容を扱います。
この内容は<a href="../guide/single.html#plugins" class="guide">プラグイン開発者</a>にとっても、Grails実行時の構成を検討する上で有用な情報です。


<a name="16.1 The Underpinnings of Grails"><!-- Legacy link --></a>
<h2 id="theUnderpinningsOfGrails">16.1 Grailsの土台</h2>
<div class="hidden-block">
Grails is actually a <a href="http://www.springframework.org/docs/MVC-step-by-step/Spring-MVC-step-by-step.html" target="blank">Spring MVC</a> application in disguise. Spring MVC is the Spring framework's built-in MVC web application framework. Although Spring MVC suffers from some of the same difficulties as frameworks like Struts in terms of its ease of use, it is superbly designed and architected and was, for Grails, the perfect framework to build another framework on top of.
</div>
Grailsは、実はGrailsという皮を被った<a href="http://www.springframework.org/docs/MVC-step-by-step/Spring-MVC-step-by-step.html" target="blank">Spring MVC</a>アプリケーションです。
Spring MVCはSpring frameworkに含まれているMVCウェブアプリケーションフレームワークです。
Spring MVCはStrutsのようなフレームワークと同様に、使いやすさの面においては多少難があるため悩まされますが、その上に他のフレームワークを構築するには申し分ないフレームワークであり、Grailsにとってはすばらしい設計とアーキテクチャであるといえます。<p class="paragraph"/><div class="hidden-block">
Grails leverages Spring MVC in the following areas:
</div>
GrailsはSpring MVCを次の領域で活用しています:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Basic controller logic - Grails subclasses Spring's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html" class="api">DispatcherServlet</a> and uses it to delegate to Grails <a href="../guide/single.html#controllers" class="guide">controllers</a></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>基本的なコントローラのロジック - GrailsのサーブレットはSpringの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html" class="api">DispatcherServlet</a>のサブクラスであり、それを用いてGrailsの<a href="../guide/single.html#controllers" class="guide">コントローラ</a>にディスパッチを行います</li>
</ul><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Data Binding and Validation - Grails' <a href="../guide/single.html#validation" class="guide">validation</a> and <a href="../guide/single.html#dataBinding" class="guide">data binding</a> capabilities are built on those provided by Spring</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>データバインディングとバリデーション - Grailsの<a href="../guide/single.html#validation" class="guide">バリデーション</a>と<a href="../guide/single.html#dataBinding" class="guide">データバインディング</a>の機能は、Springで提供されているものを用いています</li>
</ul><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Runtime configuration - Grails' entire runtime convention based system is wired together by a Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>ランタイム設定 - Grailsランタイム全体の規約に基づくシステムはSpringの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/context/ApplicationContext.html" class="api">ApplicationContext</a>と結びついています</li>
</ul><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Transactions - Grails uses Spring's transaction management in <a href="../guide/single.html#GORM" class="guide">GORM</a></li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>トランザクション - GrailsはSpringのトランザクション管理を<a href="../guide/single.html#GORM" class="guide">GORM</a>で利用しています</li>
</ul><p class="paragraph"/><div class="hidden-block">
In other words Grails has Spring embedded running all the way through it.
</div>
言い換えれば、Grailsはすべての機能を組み込まれたSpringを介して実行しているということになります。<p class="paragraph"/><div class="hidden-block">
<h4>The Grails ApplicationContext</h4>
</div>
<h4>Grailsアプリケーションコンテキスト</h4><p class="paragraph"/><div class="hidden-block">
Spring developers are often keen to understand how the Grails <code>ApplicationContext</code> instance is constructed. The basics of it are as follows.
</div>
Spring開発者は、どのようにGrailsの<code>ApplicationContext</code>インスタンスが組み立てられるのか理解したい、と熱心に望んでいます。
基本的には次のようになります:<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Grails constructs a parent <code>ApplicationContext</code> from the <code>web-app/WEB-INF/applicationContext.xml</code> file. This <code>ApplicationContext</code> configures the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" class="api">GrailsApplication</a> instance and the <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/plugins/GrailsPluginManager.html" class="api">GrailsPluginManager</a>.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>Grailsが<code>web-app/WEB-INF/applicationContext.xml</code>ファイルから親となる<code>ApplicationContext</code>を組み立てます。この<code>ApplicationContext</code>は<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/commons/GrailsApplication.html" target="blank">GrailsApplication</a>インスタンスと<a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/plugins/GrailsPluginManager.html" target="blank">GrailsPluginManager</a>を設定します。</li>
</ul><p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>Using this <code>ApplicationContext</code> as a parent Grails' analyses the conventions with the <code>GrailsApplication</code> instance and constructs a child <code>ApplicationContext</code> that is used as the root <code>ApplicationContext</code> of the web application</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>この親となる<code>ApplicationContext</code>を用いて、<code>GrailsApplication</code>インスタンスと共にGrailsの規約を解析し、Webアプリケーションのルートとして利用される子<code>ApplicationContext</code>を組み立てます。</li>
</ul><p class="paragraph"/><div class="hidden-block">
<h4>Configured Spring Beans</h4>
</div>
<h4>構成されたSpringビーン</h4><p class="paragraph"/><div class="hidden-block">
Most of Grails' configuration happens at runtime. Each <a href="../guide/single.html#plugins" class="guide">plugin</a> may configure Spring beans that are registered in the <code>ApplicationContext</code>. For a reference as to which beans are configured, refer to the reference guide which describes each of the Grails plugins and which beans they configure.
</div>
Grailsの設定のほとんどは実行時に行われます。
各<a href="../guide/single.html#plugins" class="guide">plugin</a>は<code>ApplicationContext</code>に登録されているSpringビーンを構成することができます。
構成されるビーンの詳細については各プラグインのリファレンスガイドを参照してください。


<a name="16.2 Configuring Additional Beans"><!-- Legacy link --></a>
<h2 id="springdslAdditional">16.2 追加ビーンを定義する</h2>
<div class="hidden-block">
<h4>Using the Spring Bean DSL</h4>
</div>
<h4>SpringビーンDSLの使用</h4><p class="paragraph"/><div class="hidden-block">
You can easily register new (or override existing) beans by configuring them in <code>grails-app/conf/spring/resources.groovy</code> which uses the Grails <a href="../guide/single.html#springdsl" class="guide">Spring DSL</a>. Beans are defined inside a <code>beans</code> property (a Closure):
</div>
Grails <a href="../guide/single.html#springdsl" class="guide">Spring DSL</a>を使い、<code>grails-app/conf/spring/resources.groovy</code>に設定することで、簡単に新しいビーンが登録(または上書き)できます。
ビーンは<code>beans</code>プロパティ(クロージャ)の内部に設定します。<p class="paragraph"/><div class="code"><pre>beans = &#123;
    // beans here
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
As a simple example you can configure a bean with the following syntax:
</div>
簡単な例として、以下のようなシンタックスでビーンを設定できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> my.company.MyBeanImpl<p class="paragraph"/>beans = &#123;
    myBean(MyBeanImpl) &#123;
        someProperty = 42
        otherProperty = <span class="java&#45;quote">"blue"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Once configured, the bean can be auto-wired into Grails artifacts and other classes that support dependency injection (for example <code>BootStrap.groovy</code> and integration tests) by declaring a public field whose name is your bean's name (in this case <code>myBean</code>):
</div>
一度設定をすれば、パブリックフィールドをビーンの名前(この場合は<code>myBean</code>)で宣言することで、Grailsのアーティファクトや、他の依存性の注入がサポートされているクラス(例えば、<code>BootStrap.groovy</code>やインテグレーションテスト)にビーンが自動注入されます。<p class="paragraph"/><div class="code"><pre>class ExampleController &#123;<p class="paragraph"/>     def myBean
     &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Using the DSL has the advantage that you can mix bean declarations and logic, for example based on the <a href="../guide/single.html#environments" class="guide">environment</a>:
</div>
DSLを使用することで、ビーンの定義にロジックを混ぜることができる利点があります。
例えば<a href="../guide/single.html#environments" class="guide">環境</a>を基にビーンを定義する場合です。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.util.Environment
<span class="java&#45;keyword">import</span> my.company.mock.MockImpl
<span class="java&#45;keyword">import</span> my.company.MyBeanImpl<p class="paragraph"/>beans = &#123;
    <span class="java&#45;keyword">switch</span>(Environment.current) &#123;
        <span class="java&#45;keyword">case</span> Environment.PRODUCTION:
            myBean(MyBeanImpl) &#123;
                someProperty = 42
                otherProperty = <span class="java&#45;quote">"blue"</span>
            &#125;
            <span class="java&#45;keyword">break</span><p class="paragraph"/>        <span class="java&#45;keyword">case</span> Environment.DEVELOPMENT:
            myBean(MockImpl) &#123;
                someProperty = 42
                otherProperty = <span class="java&#45;quote">"blue"</span>
            &#125;
            <span class="java&#45;keyword">break</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <code>GrailsApplication</code> object can be accessed with the <code>application</code> variable and can be used to access the Grails configuration (amongst other things):
</div>
<code>GrailsApplication</code>オブジェクトは<code>application</code>変数で参照でき、Grailsの設定などにアクセスできます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.util.Environment
<span class="java&#45;keyword">import</span> my.company.mock.MockImpl
<span class="java&#45;keyword">import</span> my.company.MyBeanImpl<p class="paragraph"/>beans = &#123;
    <span class="java&#45;keyword">if</span> (application.config.my.company.mockService) &#123;
        myBean(MockImpl) &#123;
            someProperty = 42
            otherProperty = <span class="java&#45;quote">"blue"</span>
        &#125;
    &#125; <span class="java&#45;keyword">else</span> &#123;
        myBean(MyBeanImpl) &#123;
            someProperty = 42
            otherProperty = <span class="java&#45;quote">"blue"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
If you define a bean in <code>resources.groovy</code> with the same name as one previously registered by Grails or an installed plugin, your bean will replace the previous registration. This is a convenient way to customize behavior without resorting to editing plugin code or other approaches that would affect maintainability.
</blockquote>
</div>
<blockquote class="note">
もし、Grailsやインストールしたプラグインによって登録された名前のビーンを<code>resources.groovy</code>に定義した場合は、既存で登録されいているビーンが自分で登録したビーンに置き換えられます。
これは、既存の振る舞いをカスタマイズする便利な方法です。
既存のプラグインのコードを変更することなく、またメンテンナンスに影響を与えることもありません。
</blockquote><p class="paragraph"/><div class="hidden-block">
<h4>Using XML</h4>
</div>
<h4>XMLの使用</h4><p class="paragraph"/><div class="hidden-block">
Beans can also be configured using a <code>grails-app/conf/spring/resources.xml</code>. In earlier versions of Grails this file was automatically generated for you by the <code>run-app</code> script, but the DSL in <code>resources.groovy</code> is the preferred approach now so it isn't automatically generated now. But it is still supported - you just need to create it yourself.
</div>
ビーンは<code>grails-app/conf/spring/resources.xml</code>を使用して定義することもできます。
このXMLファイルは、以前のGrailsのバージョンでは<code>run-app</code>を実行したタイミングで自動的に生成されていました。
しかし、現在は<code>resources.groovy</code>でDSLを使用した方法が推奨のため、このXMLファイルが自動的に生成されることはありません。
自動的に生成はされませんが、まだサポートはされています。もし使用したい場合は、手動でこのファイルを作成します。<p class="paragraph"/><div class="hidden-block">
This file is typical Spring XML file and the Spring documentation has an <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-basics" target="blank">excellent reference</a> on how to configure Spring beans.
</div>
このXMLファイルは、典型的なSpringのXMLファイルです。
このXMLファイルで、どのようにSpringビーンの設定をするかは、Springのドキュメンテーションに<a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-basics" target="blank">素晴らしい記述</a>があります。<p class="paragraph"/><div class="hidden-block">
The <code>myBean</code> bean that we configured using the DSL would be configured with this syntax in the XML file:
</div>
さきほどDSLで定義した<code>myBean</code>は、XMLファイルでは以下のように定義できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;bean id=<span class="xml&#45;quote">"myBean"</span> class=<span class="xml&#45;quote">"my.company.MyBeanImpl"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"someProperty"</span> value=<span class="xml&#45;quote">"42"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"otherProperty"</span> value=<span class="xml&#45;quote">"blue"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/bean&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">
Like the other bean it can be auto-wired into any class that supports dependency injection:
</div>
これは、他のビーンと同じように、依存性の注入がサポートされているクラスで、ビーンが自動注入されます。<p class="paragraph"/><div class="code"><pre>class ExampleController &#123;<p class="paragraph"/>     def myBean
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Referencing Existing Beans</h4>
</div>
<h4>既存ビーンの参照</h4><p class="paragraph"/><div class="hidden-block">
Beans declared in <code>resources.groovy</code> or <code>resources.xml</code> can reference other beans by convention. For example if you had a <code>BookService</code> class its Spring bean name would be <code>bookService</code>, so your bean would reference it like this in the DSL:
</div>
<code>resources.groovy</code>、または<code>resources.xml</code>に定義したビーンは、規約によって登録された他のビーンを参照できます。例えば、<code>BookService</code>クラスがあったとすると、Springのビーンの名前は<code>bookService</code>になります。
これを、DSL内で参照するには以下のようにします。<p class="paragraph"/><div class="code"><pre>beans = &#123;
    myBean(MyBeanImpl) &#123;
        someProperty = 42
        otherProperty = <span class="java&#45;quote">"blue"</span>
        bookService = ref(<span class="java&#45;quote">"bookService"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
or like this in XML:
</div>
XMLを使用した場合は以下のようになります。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;bean id=<span class="xml&#45;quote">"myBean"</span> class=<span class="xml&#45;quote">"my.company.MyBeanImpl"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"someProperty"</span> value=<span class="xml&#45;quote">"42"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"otherProperty"</span> value=<span class="xml&#45;quote">"blue"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"bookService"</span> ref=<span class="xml&#45;quote">"bookService"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/bean&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">
The bean needs a public setter for the bean reference (and also the two simple properties), which in Groovy would be defined like this:
</div>
このビーンには参照するビーン(とシンプルな2つのプロパティ)を設定するパブリックなセッターが必要です。
Groovyでは以下のように定義できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> my.company<p class="paragraph"/>class MyBeanImpl &#123;
    <span class="java&#45;object">Integer</span> someProperty
    <span class="java&#45;object">String</span> otherProperty
    BookService bookService // or just <span class="java&#45;quote">"def bookService"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
or in Java like this:
</div>
Javaの場合は以下のようになります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> my.company;<p class="paragraph"/>class MyBeanImpl &#123;<p class="paragraph"/>    <span class="java&#45;keyword">private</span> BookService bookService;
    <span class="java&#45;keyword">private</span> <span class="java&#45;object">Integer</span> someProperty;
    <span class="java&#45;keyword">private</span> <span class="java&#45;object">String</span> otherProperty;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setBookService(BookService theBookService) &#123;
        <span class="java&#45;keyword">this</span>.bookService = theBookService;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setSomeProperty(<span class="java&#45;object">Integer</span> someProperty) &#123;
        <span class="java&#45;keyword">this</span>.someProperty = someProperty;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setOtherProperty(<span class="java&#45;object">String</span> otherProperty) &#123;
        <span class="java&#45;keyword">this</span>.otherProperty = otherProperty;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Using <code>ref</code> (in XML or the DSL) is very powerful since it configures a runtime reference, so the referenced bean doesn't have to exist yet. As long as it's in place when the final application context configuration occurs, everything will be resolved correctly.
</div>
<code>ref</code>は実行時の参照を設定するため非常に強力です。これは定義時に参照するビーンが存在している必要がありません。最終的にアプリケーションコンテキストの設定が完了した時点で、そのビーンが存在していれば正しく参照が解決されます。<p class="paragraph"/><div class="hidden-block">
For a full reference of the available beans see the plugin reference in the reference guide.
</div>
参照が可能なビーンの情報は、リファレンス内のプラグインの章を参照してください。


<a name="16.3 Runtime Spring with the Beans DSL"><!-- Legacy link --></a>
<h2 id="springdsl">16.3 ビーンDSLでSpringランタイム</h2>
<div class="hidden-block">
This Bean builder in Grails aims to provide a simplified way of wiring together dependencies that uses Spring at its core.
</div>
ビーンビルダーの目的は、Grails内でSpringの依存関係を容易に構築するための手段を提供することです。<p class="paragraph"/><div class="hidden-block">
In addition, Spring's regular way of configuration (via XML and annotations) is static and difficult to modify and configure at runtime, other than programmatic XML creation which is both error prone and verbose. Grails' <a href="http://grails.org/doc/latest/api/grails/spring/BeanBuilder.html" class="api">BeanBuilder</a> changes all that by making it possible to programmatically wire together components at runtime, allowing you to adapt the logic based on system properties or environment variables.
</div>
通常のSpringの設定方法(XMLやアノテーションを使用した方法)は、静的に設定を行い、実行時にこれらを変更することは容易ではありません。
また、XMLを使用した設定方法は設定ミスを起こしやすく、設定が冗長になりがちです。
Grailsの<a href="http://grails.org/doc/latest/api/grails/spring/BeanBuilder.html" class="api">BeanBuilder</a>は、実行時にコンポーネントの構築が行えるようにし、システムプロパティや環境変数を使用したロジックも使用可能にすることで、これらの問題を解決します。<p class="paragraph"/><div class="hidden-block">
This enables the code to adapt to its environment and avoids unnecessary duplication of code (having different Spring configs for test, development and production environments)
</div>
これにより環境毎に実行するコードを切り替え、不要な重複コードを取り除くことも可能になります(テスト環境と、開発環境/本番環境で異なるSpringの設定を持つといったように)。<p class="paragraph"/><div class="hidden-block">
<h4>The BeanBuilder class</h4>
</div>
<h4>BeanBuilderクラス</h4><p class="paragraph"/><div class="hidden-block">
Grails provides a <a href="http://grails.org/doc/latest/api/grails/spring/BeanBuilder.html" class="api">grails.spring.BeanBuilder</a> class that uses dynamic Groovy to construct bean definitions. The basics are as follows:
</div>
Grailsは、Groovyの動的な性質を利用してビーンを構築できる<a href="http://grails.org/doc/latest/api/grails/spring/BeanBuilder.html" class="api">grails.spring.BeanBuilder</a>クラスを提供しています。以下のように使用します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.commons.dbcp.BasicDataSource
<span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.orm.hibernate.ConfigurableLocalSessionFactoryBean
<span class="java&#45;keyword">import</span> org.springframework.context.ApplicationContext
<span class="java&#45;keyword">import</span> grails.spring.BeanBuilder<p class="paragraph"/>def bb = <span class="java&#45;keyword">new</span> BeanBuilder()<p class="paragraph"/>bb.beans &#123;<p class="paragraph"/>    dataSource(BasicDataSource) &#123;
        driverClassName = <span class="java&#45;quote">"org.h2.Driver"</span>
        url = <span class="java&#45;quote">"jdbc:h2:mem:grailsDB"</span>
        username = <span class="java&#45;quote">"sa"</span>
        password = <span class="java&#45;quote">""</span>
    &#125;<p class="paragraph"/>    sessionFactory(ConfigurableLocalSessionFactoryBean) &#123;
        dataSource = ref('dataSource')
        hibernateProperties = &#91;<span class="java&#45;quote">"hibernate.hbm2ddl.auto"</span>: <span class="java&#45;quote">"create&#45;drop"</span>,
                               <span class="java&#45;quote">"hibernate.show_sql"</span>:     <span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span>&#93;
    &#125;
&#125;<p class="paragraph"/>ApplicationContext appContext = bb.createApplicationContext()</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
Within <a href="../guide/single.html#plugins" class="guide">plugins</a> and the <a href="../guide/single.html#springdslAdditional" class="guide">grails-app/conf/spring/resources.groovy</a> file you don't need to create a new instance of <code>BeanBuilder</code>. Instead the DSL is implicitly available inside the <code>doWithSpring</code> and <code>beans</code> blocks respectively.
</blockquote>
</div>
<blockquote class="note">
<a href="../guide/single.html#plugins" class="guide">plugins</a>と<a href="../guide/single.html#springdslAdditional" class="guide">grails-app/conf/spring/resources.groovy</a>ファイルでは<code>BeanBuilder</code>のインスタンスを新たに作成する必要はありません。
これらは、暗黙的にぞれぞれ<code>doWithSpring</code>、<code>beans</code>ブロック内でDSLが使用可能です。
</blockquote><p class="paragraph"/><div class="hidden-block">
This example shows how you would configure Hibernate with a data source with the <code>BeanBuilder</code> class.
</div>
この例では、<code>BeanBuilder</code>クラスを使用して、データソースとHibernateの設定を行なっています。<p class="paragraph"/><div class="hidden-block">
Each method call (in this case <code>dataSource</code> and <code>sessionFactory</code> calls) maps to the name of the bean in Spring. The first argument to the method is the bean's class, whilst the last argument is a block. Within the body of the block you can set properties on the bean using standard Groovy syntax.
</div>
それぞれのメソッド呼び出しは(この例では<code>dataSource</code>と<code>sessionFactory</code>)、Springのビーン名にマッピングされます。
そして、1つ目のメソッドの引数にはビーンのクラスを指定し、2つ目の引数にはブロックを指定します。
このブロックの内部では、一般的なGroovyのシンタックスを使用してBeanのプロパティを設定することが可能です。<p class="paragraph"/><div class="hidden-block">
Bean references are resolved automatically using the name of the bean. This can be seen in the example above with the way the <code>sessionFactory</code> bean resolves the <code>dataSource</code> reference.
</div>
ビーンの参照は、ビーンの名前によって自動的に解決されます。上記の例はでは<code>sessionFactory</code>ビーンで、<code>dataSource</code>への参照を解決しています。<p class="paragraph"/><div class="hidden-block">
Certain special properties related to bean management can also be set by the builder, as seen in the following code:
</div>
以下のように、ビーン管理に関連した特殊なプロパティをビルダー内で設定することもできます。<p class="paragraph"/><div class="code"><pre>sessionFactory(ConfigurableLocalSessionFactoryBean) &#123; bean &#45;&#62;
    // Autowiring behaviour. The other option is 'byType'. &#91;autowire&#93;
    bean.autowire = 'byName'
    // Sets the initialisation method to 'init'. &#91;init&#45;method&#93;
    bean.initMethod = 'init'
    // Sets the destruction method to 'destroy'. &#91;destroy&#45;method&#93;
    bean.destroyMethod = 'destroy'
    // Sets the scope of the bean. &#91;scope&#93;
    bean.scope = 'request'
    dataSource = ref('dataSource')
    hibernateProperties = &#91;<span class="java&#45;quote">"hibernate.hbm2ddl.auto"</span>: <span class="java&#45;quote">"create&#45;drop"</span>,
                           <span class="java&#45;quote">"hibernate.show_sql"</span>:     <span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The strings in square brackets are the names of the equivalent bean attributes in Spring's XML definition.
</div>
角括弧内の文字列は、XMLでSpringの設定を行う場合のbeanの属性です。<p class="paragraph"/><div class="hidden-block">
<h4>Using BeanBuilder with Spring MVC</h4>
</div>
<h4>Spring MVCでBeanBuilderを使用する</h4><p class="paragraph"/><div class="hidden-block">
Include the <code>grails-spring-&#60;version&#62;.jar</code> file in your classpath to use BeanBuilder in a regular Spring MVC application. Then add the following <code>&#60;context-param&#62;</code> values to your <code>/WEB-INF/web.xml</code> file:
</div>
通常のSpring MVCアプリケーションでBeanBuilderを使用するには、クラスパスに<code>grails-spring-&#60;version&#62;.jar</code>を追加します。
そして<code>WEB-INF/web.xml</code>ファイルに<code>&#60;context-param&#62;</code>の値を追加します。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;context&#45;param&#62;</span>
    <span class="xml&#45;tag">&#60;param&#45;name&#62;</span>contextConfigLocation<span class="xml&#45;tag">&#60;/param&#45;name&#62;</span>
    <span class="xml&#45;tag">&#60;param&#45;value&#62;</span>/WEB&#45;INF/applicationContext.groovy<span class="xml&#45;tag">&#60;/param&#45;value&#62;</span>
<span class="xml&#45;tag">&#60;/context&#45;param&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;context&#45;param&#62;</span>
    <span class="xml&#45;tag">&#60;param&#45;name&#62;</span>contextClass<span class="xml&#45;tag">&#60;/param&#45;name&#62;</span>
    <span class="xml&#45;tag">&#60;param&#45;value&#62;</span>
      org.codehaus.groovy.grails.commons.spring.GrailsWebApplicationContext
    <span class="xml&#45;tag">&#60;/param&#45;value&#62;</span>
<span class="xml&#45;tag">&#60;/context&#45;param&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">
Then create a <code>/WEB-INF/applicationContext.groovy</code> file that does the rest:
</div>
あとは<code>/WEB-INF/applicationContext.groovy</code>ファイルを作成するだけです。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.commons.dbcp.BasicDataSource<p class="paragraph"/>beans &#123;
    dataSource(BasicDataSource) &#123;
        driverClassName = <span class="java&#45;quote">"org.h2.Driver"</span>
        url = <span class="java&#45;quote">"jdbc:h2:mem:grailsDB"</span>
        username = <span class="java&#45;quote">"sa"</span>
        password = <span class="java&#45;quote">""</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Loading Bean Definitions from the File System</h4>
</div>
<h4>ファイルシステムからBean定義を読み込む</h4><p class="paragraph"/><div class="hidden-block">
You can use the <code>BeanBuilder</code> class to load external Groovy scripts that define beans using the same path matching syntax defined here. For example:
</div>
<code>BeanBuilder</code>クラスを使用して外部のGroovyスクリプトを読み込むには、パスマッチングのシンタックスを使用します。以下に例を示します。<p class="paragraph"/><div class="code"><pre>def bb = <span class="java&#45;keyword">new</span> BeanBuilder()
bb.loadBeans(<span class="java&#45;quote">"classpath:&#42;SpringBeans.groovy"</span>)<p class="paragraph"/>def applicationContext = bb.createApplicationContext()</pre></div><p class="paragraph"/><div class="hidden-block">
Here the <code>BeanBuilder</code> loads all Groovy files on the classpath ending with <code>SpringBeans.groovy</code> and parses them into bean definitions. An example script can be seen below:
</div>
このようにすることで、<code>BeanBuilder</code>はクラスパス内の<code>SpringBeans.groovy</code>という名前で終わる、全てのGroovyファイルをビーンの定義として読み込みます。
スクリプトの中身は以下のように定義できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.commons.dbcp.BasicDataSource
<span class="java&#45;keyword">import</span> org.codehaus.groovy.grails.orm.hibernate.ConfigurableLocalSessionFactoryBean<p class="paragraph"/>beans &#123;<p class="paragraph"/>    dataSource(BasicDataSource) &#123;
        driverClassName = <span class="java&#45;quote">"org.h2.Driver"</span>
        url = <span class="java&#45;quote">"jdbc:h2:mem:grailsDB"</span>
        username = <span class="java&#45;quote">"sa"</span>
        password = <span class="java&#45;quote">""</span>
    &#125;<p class="paragraph"/>    sessionFactory(ConfigurableLocalSessionFactoryBean) &#123;
        dataSource = dataSource
        hibernateProperties = &#91;<span class="java&#45;quote">"hibernate.hbm2ddl.auto"</span>: <span class="java&#45;quote">"create&#45;drop"</span>,
                               <span class="java&#45;quote">"hibernate.show_sql"</span>:     <span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Adding Variables to the Binding (Context)</h4>
</div>
<h4>バインディング(コンテキスト)に変数を追加する</h4><p class="paragraph"/><div class="hidden-block">
If you're loading beans from a script you can set the binding to use by creating a Groovy <code>Binding</code>:
</div>
もしスクリプトを使用してビーンの定義を読み込んでいる場合は、Groovyの<code>Binding</code>インスタンスを作成してバインドが行えます。<p class="paragraph"/><div class="code"><pre>def binding = <span class="java&#45;keyword">new</span> Binding()
binding.maxSize = 10000
binding.productGroup = 'finance'<p class="paragraph"/>def bb = <span class="java&#45;keyword">new</span> BeanBuilder()
bb.binding = binding
bb.loadBeans(<span class="java&#45;quote">"classpath:&#42;SpringBeans.groovy"</span>)<p class="paragraph"/>def ctx = bb.createApplicationContext()</pre></div><p class="paragraph"/><div class="hidden-block">
Then you can access the <code>maxSize</code> and <code>productGroup</code> properties in your DSL files.
</div>
このようにすることで、DSLファイル内から<code>maxSize</code>、<code>productGroup</code>プロパティにアクセスすることが可能になります。


<a name="16.4 The BeanBuilder DSL Explained"><!-- Legacy link --></a>
<h2 id="theBeanBuilderDSLExplained">16.4 ビーンビルダーDSLの解説</h2>
<div class="hidden-block">
<h4>Using Constructor Arguments</h4>
</div>
<h4>コンストラクタ引数の使い方</h4><p class="paragraph"/><div class="hidden-block">
Constructor arguments can be defined using parameters to each bean-defining method. Put them after the first argument (the Class):
</div>
コンストラクタ引数は、各ビーン定義のメソッドにパラメータを使うことで定義できます。
パラメータはビーン定義の最初の引数(クラス)に続けて渡します。
<div class="code"><pre>bb.beans &#123;
    exampleBean(MyExampleBean, <span class="java&#45;quote">"firstArgument"</span>, 2) &#123;
        someProperty = &#91;1, 2, 3&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This configuration corresponds to a <code>MyExampleBean</code> with a constructor that looks like this:
</div>
この設定は、次のように定義されている<code>MyExampleBean</code>のコンストラクタに対応付けされます。<p class="paragraph"/><div class="code"><pre>MyExampleBean(<span class="java&#45;object">String</span> foo, <span class="java&#45;object">int</span> bar) &#123;
   &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Configuring the BeanDefinition (Using factory methods)</h4>
</div>
<h4>ビーン定義の設定 (ファクトリメソッドの利用)</h4><p class="paragraph"/><div class="hidden-block">
The first argument to the closure is a reference to the bean configuration instance, which you can use to configure factory methods and invoke any method on the <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/support/AbstractBeanDefinition.html" class="api">AbstractBeanDefinition</a> class:
</div>
クロージャに渡される最初の引数は、対象となるビーンのインスタンスへの参照であり、ファクトリメソッドの設定や<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/support/AbstractBeanDefinition.html" class="api">AbstractBeanDefinition</a>クラス上のメソッドの呼び出しに用いることができます。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;
    exampleBean(MyExampleBean) &#123; bean &#45;&#62;
        bean.factoryMethod = <span class="java&#45;quote">"getInstance"</span>
        bean.singleton = <span class="java&#45;keyword">false</span>
        someProperty = &#91;1, 2, 3&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
As an alternative you can also use the return value of the bean defining method to configure the bean:
</div>
代わりにビーン定義のメソッドの返り値を使って設定することもできます。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;
    def example = exampleBean(MyExampleBean) &#123;
        someProperty = &#91;1, 2, 3&#93;
    &#125;
    example.factoryMethod = <span class="java&#45;quote">"getInstance"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Using Factory beans</h4>
</div>
<h4>ファクトリビーンの利用</h4><p class="paragraph"/><div class="hidden-block">
Spring defines the concept of factory beans and often a bean is created not directly from a new instance of a Class, but from one of these factories. In this case the bean has no Class argument and instead you must pass the name of the factory bean to the bean defining method:
</div>
Springはファクトリビーンの概念を定義しており、ビーンはクラスの新しいインスタンスから直接作成されないことが多く、いずれかのファクトリが用いられます。
この場合、ビーン定義のメソッドの引数にクラスを渡さず、代わりにファクトリビーン名を渡す必要があります。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;<p class="paragraph"/>    myFactory(ExampleFactoryBean) &#123;
        someProperty = &#91;1, 2, 3&#93;
    &#125;<p class="paragraph"/>    myBean(myFactory) &#123;
        name = <span class="java&#45;quote">"blah"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Another common approach is provide the name of the factory method to call on the factory bean. This can be done using Groovy's named parameter syntax:
</div>
別のアプローチとして、ファクトリビーンで呼び出すファクトリメソッドの名前を渡すことができます。
これにはGroovyの名前付き引数の構文を用います。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;<p class="paragraph"/>    myFactory(ExampleFactoryBean) &#123;
        someProperty = &#91;1, 2, 3&#93;
    &#125;<p class="paragraph"/>    myBean(myFactory: <span class="java&#45;quote">"getInstance"</span>) &#123;
        name = <span class="java&#45;quote">"blah"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Here the <code>getInstance</code> method on the <code>ExampleFactoryBean</code> bean will be called to create the <code>myBean</code> bean.
</div>
この例では<code>ExampleFactoryBean</code>ビーン上の<code>getInstance</code>メソッドが<code>myBean</code>ビーンの生成時に呼び出されます。<p class="paragraph"/><div class="hidden-block">
<h4>Creating Bean References at Runtime</h4>
</div>
<h4>ビーンへの参照を実行時に生成する</h4><p class="paragraph"/><div class="hidden-block">
Sometimes you don't know the name of the bean to be created until runtime. In this case you can use a string interpolation to invoke a bean defining method dynamically:
</div>
生成するビーンの名前を実行時に決めたい場合があります。
そういったときは、動的にビーン定義メソッドを実行するために文字列の置き換えが使えます。<p class="paragraph"/><div class="code"><pre>def beanName = <span class="java&#45;quote">"example"</span>
bb.beans &#123;
    <span class="java&#45;quote">"$&#123;beanName&#125;Bean"</span>(MyExampleBean) &#123;
        someProperty = &#91;1, 2, 3&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this case the <code>beanName</code> variable defined earlier is used when invoking a bean defining method. The example has a hard-coded value but would work just as well with a name that is generated programmatically based on configuration, system properties, etc.
</div>
この場合、前もって定義された<code>beanName</code>変数を用いてビーン定義メソッドを呼び出しています。
この例では値をハードコードしていますが、設定やシステムプロパティ等に基づいて生成された名前でも同様に動作します。<p class="paragraph"/><div class="hidden-block">
Furthermore, because sometimes bean names are not known until runtime you may need to reference them by name when wiring together other beans, in this case using the <code>ref</code> method:
</div>
さらに、そういった実行時まで名前の分からないビーンへの紐付けを、<code>ref</code>メソッドを用いて他のビーンから名前で参照する必要が生じることがあります。<p class="paragraph"/><div class="code"><pre>def beanName = <span class="java&#45;quote">"example"</span>
bb.beans &#123;<p class="paragraph"/>    <span class="java&#45;quote">"$&#123;beanName&#125;Bean"</span>(MyExampleBean) &#123;
        someProperty = &#91;1, 2, 3&#93;
    &#125;<p class="paragraph"/>    anotherBean(AnotherBean) &#123;
        example = ref(<span class="java&#45;quote">"$&#123;beanName&#125;Bean"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Here the example property of <code>AnotherBean</code> is set using a runtime reference to the <code>exampleBean</code>. The <code>ref</code> method can also be used to refer to beans from a parent <code>ApplicationContext</code> that is provided in the constructor of the <code>BeanBuilder</code>:
</div>
この例では<code>exampleBean</code>への実行時参照を用いて<code>AnotherBean</code>のプロパティに設定しています。
<code>BeanBuilder</code>のコンストラクタで提供される親<code>ApplicationContext</code>からビーンを参照するためにも、<code>ref</code>メソッドを使うことができます。<p class="paragraph"/><div class="code"><pre>ApplicationContext parent = ...//
der bb = <span class="java&#45;keyword">new</span> BeanBuilder(parent)
bb.beans &#123;
    anotherBean(AnotherBean) &#123;
        example = ref(<span class="java&#45;quote">"$&#123;beanName&#125;Bean"</span>, <span class="java&#45;keyword">true</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Here the second parameter <code>true</code> specifies that the reference will look for the bean in the parent context.
</div>
ここでは<code>ref</code>メソッドの第2引数に<code>true</code>を渡すことで、親となるコンテキストからビーンを探すことを指定しています。<p class="paragraph"/><div class="hidden-block">
<h4>Using Anonymous (Inner) Beans</h4>
</div>
<h4>匿名(内部)ビーンを使う</h4><p class="paragraph"/><div class="hidden-block">
You can use anonymous inner beans by setting a property of the bean to a block that takes an argument that is the bean type:
</div>
ビーンの型を引数に取るブロックで、ビーンのプロパティを設定することにより匿名内部ビーンが使えます。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;<p class="paragraph"/>    marge(Person) &#123;
        name = <span class="java&#45;quote">"Marge"</span>
        husband = &#123; Person p &#45;&#62;
            name = <span class="java&#45;quote">"Homer"</span>
            age = 45
            props = &#91;overweight: <span class="java&#45;keyword">true</span>, height: <span class="java&#45;quote">"1.8m"</span>&#93;
        &#125;
        children = &#91;bart, lisa&#93;
    &#125;<p class="paragraph"/>    bart(Person) &#123;
        name = <span class="java&#45;quote">"Bart"</span>
        age = 11
    &#125;<p class="paragraph"/>    lisa(Person) &#123;
        name = <span class="java&#45;quote">"Lisa"</span>
        age = 9
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In the above example we set the <code>marge</code> bean's husband property to a block that creates an inner bean reference. Alternatively if you have a factory bean you can omit the type and just use the specified bean definition instead to setup the factory:
</div>
上記の例では<code>merge</code>ビーンの<code>husband</code>プロパティに、内部ビーンの参照を作成したブロックを渡しています。
ファクトリを持つビーンは型を省略でき、ファクトリをセットアップする代わりに指定されたビーンの定義を利用するだけで済みます。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;<p class="paragraph"/>    personFactory(PersonFactory)<p class="paragraph"/>    marge(Person) &#123;
        name = <span class="java&#45;quote">"Marge"</span>
        husband = &#123; bean &#45;&#62;
            bean.factoryBean = <span class="java&#45;quote">"personFactory"</span>
            bean.factoryMethod = <span class="java&#45;quote">"newInstance"</span>
            name = <span class="java&#45;quote">"Homer"</span>
            age = 45
            props = &#91;overweight: <span class="java&#45;keyword">true</span>, height: <span class="java&#45;quote">"1.8m"</span>&#93;
        &#125;
        children = &#91;bart, lisa&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Abstract Beans and Parent Bean Definitions</h4>
</div>
<h4>抽象ビーンと親ビーンの定義</h4><p class="paragraph"/><div class="hidden-block">
To create an abstract bean definition define a bean without a <code>Class</code> parameter:
</div>
抽象ビーン定義を作成するには、パラメータに<code>Class</code>を渡さずに定義します。<p class="paragraph"/><div class="code"><pre>class HolyGrailQuest &#123;
    def start() &#123; println <span class="java&#45;quote">"lets begin"</span> &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class KnightOfTheRoundTable &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">String</span> leader
    HolyGrailQuest quest<p class="paragraph"/>    KnightOfTheRoundTable(<span class="java&#45;object">String</span> name) &#123;
        <span class="java&#45;keyword">this</span>.name = name
    &#125;<p class="paragraph"/>    def embarkOnQuest() &#123;
        quest.start()
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.spring.BeanBuilder<p class="paragraph"/>def bb = <span class="java&#45;keyword">new</span> BeanBuilder()
bb.beans &#123;
    abstractBean &#123;
        leader = <span class="java&#45;quote">"Lancelot"</span>
    &#125;
    &#8230;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Here we define an abstract bean that has a <code>leader</code> property with the value of <code>"Lancelot"</code>. To use the abstract bean set it as the parent of the child bean:
</div>
ここでは、値に<code>"Lancelot"</code>が入っている<code>leader</code>プロパティを持つ抽象ビーンを定義しています。
子ビーンの親として抽象ビーンを使うには、次のように設定します。<p class="paragraph"/><div class="code"><pre>bb.beans &#123;
    &#8230;
    quest(HolyGrailQuest)<p class="paragraph"/>    knights(KnightOfTheRoundTable, <span class="java&#45;quote">"Camelot"</span>) &#123; bean &#45;&#62;
        bean.parent = abstractBean
        quest = ref('quest')
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
When using a parent bean you must set the parent property of the bean before setting any other properties on the bean!
</blockquote>
</div>
<blockquote class="note">
親ビーンを利用するときは、ビーン上の他のプロパティを設定する前に、ビーンの<code>parent</code>プロパティへ設定する必要があります。
</blockquote><p class="paragraph"/><div class="hidden-block">
If you want an abstract bean that has a <code>Class</code> specified you can do it this way:
</div>
<code>Class</code>を明示して抽象ビーンを利用したい場合は、次に示す方法で可能です。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.spring.BeanBuilder<p class="paragraph"/>def bb = <span class="java&#45;keyword">new</span> BeanBuilder()
bb.beans &#123;<p class="paragraph"/>    abstractBean(KnightOfTheRoundTable) &#123; bean &#45;&#62;
        bean.'<span class="java&#45;keyword">abstract</span>' = <span class="java&#45;keyword">true</span>
        leader = <span class="java&#45;quote">"Lancelot"</span>
    &#125;<p class="paragraph"/>    quest(HolyGrailQuest)<p class="paragraph"/>    knights(<span class="java&#45;quote">"Camelot"</span>) &#123; bean &#45;&#62;
        bean.parent = abstractBean
        quest = quest
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
In this example we create an abstract bean of type <code>KnightOfTheRoundTable</code> and use the bean argument to set it to abstract. Later we define a knights bean that has no <code>Class</code> defined, but inherits the <code>Class</code> from the parent bean.
</div>
この例では、ビーンの<code>abstract</code>プロパティを利用して<code>KnightOfTheRoundTable</code>型の抽象ビーンを作成しています。
その後、<code>Class</code>の指定のない<code>knights</code>ビーンを定義していますが、<code>Class</code>は親ビーンから継承されます。<p class="paragraph"/><div class="hidden-block">
<h4>Using Spring Namespaces</h4>
</div>
<h4>Springの名前空間を使う</h4><p class="paragraph"/><div class="hidden-block">
Since Spring 2.0, users of Spring have had easier access to key features via XML namespaces. You can use a Spring namespace in BeanBuilder by declaring it with this syntax:
</div>
Spring 2.0から、XML名前空間を経由して主要な機能へ簡単にアクセスすることができるようになりました。
次の構文で宣言することにより、<code>BeanBuilder</code>でSpringの名前空間を使うことができます。<p class="paragraph"/><div class="code"><pre>xmlns context:<span class="java&#45;quote">"http://www.springframework.org/schema/context"</span></pre></div><p class="paragraph"/><div class="hidden-block">
and then invoking a method that matches the names of the Spring namespace tag and its associated attributes:
</div>
そしてSpring名前空間のタグと、それに紐付いた属性の名前に一致するメソッドを呼び出します。<p class="paragraph"/><div class="code"><pre>context.'component&#45;scan'('base&#45;<span class="java&#45;keyword">package</span>': <span class="java&#45;quote">"my.company.domain"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">
You can do some useful things with Spring namespaces, such as looking up a JNDI resource:
</div>
JNDIリソースを解決するといったような、Spring名前空間にある有用なものを利用できます。<p class="paragraph"/><div class="code"><pre>xmlns jee:<span class="java&#45;quote">"http://www.springframework.org/schema/jee"</span><p class="paragraph"/>jee.'jndi&#45;lookup'(id: <span class="java&#45;quote">"dataSource"</span>, 'jndi&#45;name': <span class="java&#45;quote">"java:comp/env/myDataSource"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">
This example will create a Spring bean with the identifier <code>dataSource</code> by performing a JNDI lookup on the given JNDI name. With Spring namespaces you also get full access to all of the powerful AOP support in Spring from BeanBuilder. For example given these two classes:
</div>
この例では<code>dataSource</code>という識別子で、与えられたJNDI名でJNDIを解決するSpringビーンを作成します。
また、Spring名前空間によって<code>BeanBuilder</code>から強力なSpringのAOPサポートにフルアクセスできます。
2つのクラスを使って例を示します。<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">int</span> age
    <span class="java&#45;object">String</span> name<p class="paragraph"/>    void birthday() &#123;
        ++age;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class BirthdayCardSender &#123;<p class="paragraph"/>    List peopleSentCards = &#91;&#93;<p class="paragraph"/>    void onBirthday(Person person) &#123;
        peopleSentCards &#60;&#60; person
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can define an aspect that uses a pointcut to detect whenever the <code>birthday()</code> method is called:
</div>
<code>birthday()</code>メソッドの呼び出しを検出するポイントカットを使用して、アスペクトを次のように定義できます。<p class="paragraph"/><div class="code"><pre>xmlns aop:<span class="java&#45;quote">"http://www.springframework.org/schema/aop"</span><p class="paragraph"/>fred(Person) &#123;
    name = <span class="java&#45;quote">"Fred"</span>
    age = 45
&#125;<p class="paragraph"/>birthdayCardSenderAspect(BirthdayCardSender)<p class="paragraph"/>aop &#123;
    config(<span class="java&#45;quote">"proxy&#45;target&#45;class"</span>: <span class="java&#45;keyword">true</span>) &#123;
        aspect(id: <span class="java&#45;quote">"sendBirthdayCard"</span>, ref: <span class="java&#45;quote">"birthdayCardSenderAspect"</span>) &#123;
            after method: <span class="java&#45;quote">"onBirthday"</span>,
            pointcut: <span class="java&#45;quote">"execution(void ..Person.birthday()) and <span class="java&#45;keyword">this</span>(person)"</span>
        &#125;
    &#125;
&#125;</pre></div>


<a name="16.5 Property Placeholder Configuration"><!-- Legacy link --></a>
<h2 id="propertyPlaceholderConfiguration">16.5 プロパティプレースホルダ設定</h2>
<div class="hidden-block">
Grails supports the notion of property placeholder configuration through an extended version of Spring's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html" class="api">PropertyPlaceholderConfigurer</a>, which is typically useful in combination with <a href="../guide/single.html#configExternalized" class="guide">externalized configuration</a>.
</div>
Grailsは、Springの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html" class="api">PropertyPlaceholderConfigurer</a>を拡張することでプロパティプレースホルダの概念をサポートしています。
特に<a href="../guide/single.html#configExternalized" class="guide">設定の外部化</a>と組み合わせた場合に有用です。<p class="paragraph"/><div class="hidden-block">
Settings defined in either <a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a> scripts or Java properties files can be used as placeholder values for Spring configuration in <code>grails-app/conf/spring/resources.xml</code> and <code>grails-app/conf/spring/resources.groovy</code>. For example given the following entries in <code>grails-app/conf/Config.groovy</code> (or an externalized config):
</div>
プレースホルダの値は <a href="http://groovy.codehaus.org/ConfigSlurper" target="blank">ConfigSlurper</a> またはJavaプロパティファイルで定義を行い、<code>grails-app/conf/spring/resources.xml</code>と<code>grails-app/conf/spring/resources.groovy</code>のSpringの設定ファイル内で使用できます。
例えば、<code>grails-app/conf/Config.groovy</code>(または外部設定)で以下の設定があるとします。<p class="paragraph"/><div class="code"><pre>database.driver=<span class="java&#45;quote">"com.mysql.jdbc.Driver"</span>
database.dbname=<span class="java&#45;quote">"mysql:mydb"</span></pre></div><p class="paragraph"/><div class="hidden-block">
You can then specify placeholders in <code>resources.xml</code> as follows using the familiar ${..} syntax:
</div>
<code>resources.xml</code>内では、使い慣れた${..}のシンタックスを使用してプレースホルダを指定できます。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;bean id=<span class="xml&#45;quote">"dataSource"</span>
      class=<span class="xml&#45;quote">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"driverClassName"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;value&#62;</span>$&#123;database.driver&#125;<span class="xml&#45;tag">&#60;/value&#62;</span>
    <span class="xml&#45;tag">&#60;/property&#62;</span>
    <span class="xml&#45;tag">&#60;property name=<span class="xml&#45;quote">"url"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;value&#62;</span>jdbc:$&#123;database.dbname&#125;<span class="xml&#45;tag">&#60;/value&#62;</span>
    <span class="xml&#45;tag">&#60;/property&#62;</span>
 <span class="xml&#45;tag">&#60;/bean&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">
To specify placeholders in <code>resources.groovy</code> you need to use single quotes:
</div>
<code>resources.groovy</code>内でプレースホルダを指定するには、シングルクォートを使用する必要があります。<p class="paragraph"/><div class="code"><pre>dataSource(org.springframework.jdbc.datasource.DriverManagerDataSource) &#123;
    driverClassName = '$&#123;database.driver&#125;'
    url = 'jdbc:$&#123;database.dbname&#125;'
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This sets the property value to a literal string which is later resolved against the config by Spring's PropertyPlaceholderConfigurer.
</div>
このプロパティの値は、後でSpringのPropertyPlaceholderConfigurerによって文字列が置換されます。<p class="paragraph"/><div class="hidden-block">
A better option for <code>resources.groovy</code> is to access properties through the <code>grailsApplication</code> variable:
</div>
また、<code>resources.groovy</code>では<code>grailsApplication</code>にアクセスすることが可能です。<p class="paragraph"/><div class="code"><pre>dataSource(org.springframework.jdbc.datasource.DriverManagerDataSource) &#123;
    driverClassName = grailsApplication.config.database.driver
    url = <span class="java&#45;quote">"jdbc&#58;$&#123;grailsApplication.config.database.dbname&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Using this approach will keep the types as defined in your config.
</div>
これにより、設定ファイル内で定義した型をそのまま使用することができます。


<a name="16.6 Property Override Configuration"><!-- Legacy link --></a>
<h2 id="propertyOverrideConfiguration">16.6 プロパティオーバーライド設定</h2>
<div class="hidden-block">
Grails supports setting of bean properties via <a href="../guide/single.html#conf" class="guide">configuration</a>. This is often useful when used in combination with <a href="../guide/single.html#configExternalized" class="guide">externalized configuration</a>.
</div>
Grailsでは<a href="../guide/single.html#conf" class="guide">設定</a>を通じてビーンのプロパティ設定が行えます。
これは<a href="../guide/single.html#configExternalized" class="guide">設定の外部化</a>と組み合わせて使用した場合にも便利です。<p class="paragraph"/><div class="hidden-block">
You define a <code>beans</code> block with the names of beans and their values:
</div>
設定は<code>beans</code>ブロックにビーンの名前と値を定義して行います。<p class="paragraph"/><div class="code"><pre>beans &#123;
    bookService &#123;
        webServiceURL = <span class="java&#45;quote">"http://www.amazon.com"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The general format is:
</div>
この設定の一般的なフォーマットは以下になります。<p class="paragraph"/><div class="code"><pre>&#91;bean name&#93;.&#91;property name&#93; = &#91;value&#93;</pre></div><p class="paragraph"/><div class="hidden-block">
The same configuration in a Java properties file would be:
</div>
これはJavaのプロパティファイルと同じように設定が行えます。<p class="paragraph"/><div class="code"><pre>beans.bookService.webServiceURL=http://www.amazon.com</pre></div>


<a name="17. Grails and Hibernate"><!-- Legacy link --></a>
<h1 id="hibernate">17 GrailsとHibernate</h1>
<div class="hidden-block">
If <a href="../guide/single.html#GORM" class="guide">GORM</a> (Grails Object Relational Mapping) is not flexible enough for your liking you can alternatively map your domain classes using Hibernate, either with XML mapping files or JPA annotations. You will be able to map Grails domain classes onto a wider range of legacy systems and have more flexibility in the creation of your database schema. Best of all, you will still be able to call all of the dynamic persistent and query methods provided by GORM!
</div>
もし<a href="../guide/single.html#GORM" class="guide">GORM</a>（Grailsオブジェクトリレーショナルマッピング）に好みの設定をする十分な柔軟性がない場合は、XMLマッピングファイル、またはJPAアノテーションを使用して、ドメインクラスに対するHibernateのマッピングができます。
これにより、レガシーシステムといった広い範囲でドメインクラスのマッピングが可能になり、 また柔軟なデータベースのスキーマ作成が可能にもなります。
そして、このXMLマッピングファイル、JPAアノテーションを使用した場合も、GORMが提供するダイナミックな永続化メソッド、クエリメソッドをすべて呼び出せます！


<a name="17.1 Using Hibernate XML Mapping Files"><!-- Legacy link --></a>
<h2 id="usingHibernateXMLMappingFiles">17.1 Hibernate XMLマッピングの使用</h2>
<div class="hidden-block">
Mapping your domain classes with XML is pretty straightforward. Simply create a <code>hibernate.cfg.xml</code> file in your project's <code>grails-app/conf/hibernate</code> directory, either manually or with the <a href="../ref/Command Line/create-hibernate-cfg-xml.html" class="commandLine">create-hibernate-cfg-xml</a> command, that contains the following:
</div>
XMLを使用したドメインクラスのマッピングは非常に簡単です。
手動、または<a href="../ref/Command Line/create-hibernate-cfg-xml.html" class="commandLine">create-hibernate-cfg-xml</a>コマンドを使用して、単に<code>grails-app/conf/hibernate</code>ディレクトリに<code>hibernate.cfg.xml</code>ファイルを作成します。
ファイルの内容は以下のようになります。<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;?xml version='1.0' encoding='UTF&#45;8'?&#62;</span>
&#60;!DOCTYPE hibernate&#45;configuration PUBLIC
        <span class="xml&#45;quote">"&#45;//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="xml&#45;quote">"http://hibernate.sourceforge.net/hibernate&#45;configuration&#45;3.0.dtd"</span>&#62;
<span class="xml&#45;tag">&#60;hibernate&#45;configuration&#62;</span>
    <span class="xml&#45;tag">&#60;session&#45;factory&#62;</span>
        <span class="xml&#45;comment">&#60;!&#45;&#45; Example mapping file inclusion &#45;&#45;&#62;</span>
        <span class="xml&#45;tag">&#60;mapping resource=<span class="xml&#45;quote">"org.example.Book.hbm.xml"</span>/&#62;</span>
        &#8230;
    <span class="xml&#45;tag">&#60;/session&#45;factory&#62;</span>
<span class="xml&#45;tag">&#60;/hibernate&#45;configuration&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">
The individual mapping files, like 'org.example.Book.hbm.xml' in the above example, also go into the <code>grails-app/conf/hibernate</code> directory. To find out how to map domain classes with XML, check out the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html" target="blank">Hibernate manual</a>.
</div>
上記の例のように'org.example.Book.hbm.xml'といった個々のマッピングファイルも、<code>grails-app/conf/hibernate</code>ディレクトリに格納します。
XMLを使用して、どうのようにドメインクラスをマッピングするかは<a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html" target="blank">Hibernateのマニュアル</a>を確認してください。<p class="paragraph"/><div class="hidden-block">
If the default location of the <code>hibernate.cfg.xml</code> file doesn't suit you, you can change it by specifying an alternative location in <code>grails-app/conf/DataSource.groovy</code>:
</div>
もし<code>hibernate.cfg.xml</code>ファイルのデフォルトの格納場所を変更したい場合は、<code>grails-app/conf/DataSource.groovy</code>に別の場所を指定することで変更できます。<p class="paragraph"/><div class="code"><pre>hibernate &#123;
    config.location = <span class="java&#45;quote">"file:/path/to/my/hibernate.cfg.xml"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
or even a list of locations:
</div>
または、場所の一覧を指定します。<p class="paragraph"/><div class="code"><pre>hibernate &#123;
    config.location = &#91;<span class="java&#45;quote">"file:/path/to/one/hibernate.cfg.xml"</span>,
                       <span class="java&#45;quote">"file:/path/to/two/hibernate.cfg.xml"</span>&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Grails also lets you write your domain model in Java or reuse an existing one that already has Hibernate mapping files. Simply place the mapping files into <code>grails-app/conf/hibernate</code> and either put the Java files in <code>src/java</code> or the classes in the project's <code>lib</code> directory if the domain model is packaged as a JAR. You still need the <code>hibernate.cfg.xml</code> though!
</div>
GrailsではJavaでドメインモデルを書くことも、すでにHibernateのマッピングファイルを持っている既存のJavaクラスをそのまま流用することもできます。
マッピングファイルは単に<code>grails-app/conf/hibernate</code>に格納し、Javaファイルは<code>src/java</code>に格納するか、ドメインモデルがJARファイルでパッケージングされている場合は、<code>lib</code>ディレクトリにそのクラスのJARファイルを格納します。
その場合でも<code>hibernate.cfg.xml</code>は必要です。


<a name="17.2 Mapping with Hibernate Annotations"><!-- Legacy link --></a>
<h2 id="mappingWithHibernateAnnotations">17.2 Hibernateアノテーションでのマッピング</h2>
<div class="hidden-block">
To map a domain class with annotations, create a new class in <code>src/java</code> and use the annotations defined as part of the EJB 3.0 spec (for more info on this see the <a href="http://annotations.hibernate.org/" target="blank">Hibernate Annotations Docs</a>):
</div>
アノテーションを使用してドメインクラスをマッピングするには、<code>src/java</code>に新たなクラスを作成し、EJB 3.0の仕様として定義されているアノテーションを使用します（より詳細な情報は<a href="http://annotations.hibernate.org/" target="blank">Hibernateのアノテーションに関するドキュメント</a>を参照してください）。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.books;<p class="paragraph"/><span class="java&#45;keyword">import</span> javax.persistence.Entity;
<span class="java&#45;keyword">import</span> javax.persistence.GeneratedValue;
<span class="java&#45;keyword">import</span> javax.persistence.Id;<p class="paragraph"/>@Entity
<span class="java&#45;keyword">public</span> class Book &#123;
    <span class="java&#45;keyword">private</span> <span class="java&#45;object">Long</span> id;
    <span class="java&#45;keyword">private</span> <span class="java&#45;object">String</span> title;
    <span class="java&#45;keyword">private</span> <span class="java&#45;object">String</span> description;
    <span class="java&#45;keyword">private</span> Date date;<p class="paragraph"/>    @Id
    @GeneratedValue
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">Long</span> getId() &#123;
        <span class="java&#45;keyword">return</span> id;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setId(<span class="java&#45;object">Long</span> id) &#123;
        <span class="java&#45;keyword">this</span>.id = id;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getTitle() &#123;
        <span class="java&#45;keyword">return</span> title;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setTitle(<span class="java&#45;object">String</span> title) &#123;
        <span class="java&#45;keyword">this</span>.title = title;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getDescription() &#123;
        <span class="java&#45;keyword">return</span> description;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> void setDescription(<span class="java&#45;object">String</span> description) &#123;
        <span class="java&#45;keyword">this</span>.description = description;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Then register the class with the Hibernate <code>sessionFactory</code> by adding relevant entries to the <code>grails-app/conf/hibernate/hibernate.cfg.xml</code> file as follows:
</div>
次に、<code>grails-app/conf/hibernate/hibernate.cfg.xml</code>ファイルに関連エントリを以下のように追加することで、Hibernateの<code>sessionFactory</code>にクラスを登録します。<p class="paragraph"/><div class="code"><pre>&#60;!DOCTYPE hibernate&#45;configuration SYSTEM
  <span class="xml&#45;quote">"http://hibernate.sourceforge.net/hibernate&#45;configuration&#45;3.0.dtd"</span>&#62;
<span class="xml&#45;tag">&#60;hibernate&#45;configuration&#62;</span>
    <span class="xml&#45;tag">&#60;session&#45;factory&#62;</span>
        <span class="xml&#45;tag">&#60;mapping package=<span class="xml&#45;quote">"com.books"</span> /&#62;</span>
        <span class="xml&#45;tag">&#60;mapping class=<span class="xml&#45;quote">"com.books.Book"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;/session&#45;factory&#62;</span>
<span class="xml&#45;tag">&#60;/hibernate&#45;configuration&#62;</span></pre></div>
<div class="hidden-block">
See the previous section for more information on the <code>hibernate.cfg.xml</code> file.
</div>
<code>hibernate.cfg.xml</code>ファイルの詳細は、前のセクションを参照してください。<p class="paragraph"/><div class="hidden-block">
When Grails loads it will register the necessary dynamic methods with the class. To see what else you can do with a Hibernate domain class see the section on <a href="../guide/single.html#scaffolding" class="guide">Scaffolding</a>.
</div>
先程のドメインクラスをGrailsがロードするときに、クラスに対し必要なダイナミックメソッドを追加します。
ダイナミックメソッド以外に、Hibernateのドメインクラスで何ができるかについては、<a href="../guide/single.html#scaffolding" class="guide">スカッフォルディング</a>のセクションを参照してください。


<a name="17.3 Adding Constraints"><!-- Legacy link --></a>
<h2 id="addingConstraints">17.3 制約の追加</h2>
<div class="hidden-block">
You can still use GORM validation even if you use a Java domain model. Grails lets you define constraints through separate scripts in the <code>src/java</code> directory. The script must be in a directory that matches the package of the corresponding domain class and its name must have a  <em class="italic">Constraints</em>  suffix. For example, if you had a domain class <code>org.example.Book</code>, then you would create the script <code>src/java/org/example/BookConstraints.groovy</code>&#46;
</div>
Javaのドメインモデルを使用する場合でも、GORMのバリデーションを使用できます。
Grailsでは<code>src/java</code>ディレクトリ内の、別個のスクリプトを通じて制約を定義します。
このスクリプトは、対応するドメインクラスのパッケージと同じディレクトリ内に格納し、ファイル名のサフィックスは  <em class="italic">Constraints</em>  でなければなりません。
たとえば、<code>org.example.Book</code>というドメインクラスの場合は、<code>src/java/org/example/BookConstraints.groovy</code>というスクリプトを作成します。<p class="paragraph"/><div class="hidden-block">
Add a standard GORM <code>constraints</code> block to the script:
</div>
そして、このスクリプトに通常のGORMの<code>constraints</code>ブロックを追加してください。<p class="paragraph"/><div class="code"><pre>constraints = &#123;
    title blank: <span class="java&#45;keyword">false</span>
    author blank: <span class="java&#45;keyword">false</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Once this is in place you can validate instances of your domain class!
</div>
正しく設定できていれば、ドメインクラスのインスタンスに対してバリデーションが可能になります。


<a name="18. Scaffolding"><!-- Legacy link --></a>
<h1 id="scaffolding">18 スカッフォルド</h1>
<div class="hidden-block">
Scaffolding lets you generate some basic CRUD interfaces for a domain class, including:
</div>
スカッフォルドは以下を含むドメインクラスの基礎的なCRUDインターフェイスを自動生成します。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>The necessary <a href="../guide/single.html#gsp" class="guide">views</a></li>
<li>Controller actions for create/read/update/delete (CRUD) operations</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>必要な<a href="../guide/single.html#gsp" class="guide">ビュー</a></li>
<li>作成/参照/更新/削除(CRUD)処理のコントローラアクション</li>
</ul><p class="paragraph"/>As of Grails 2.3, the scaffolding feature has been moved to a plugin. By default this is configured for installation in new applications, but if you are upgrading from a previous version of Grails you will need to add the following configuration to your <code>BuildConfig.groovy</code> file:<p class="paragraph"/><div class="code"><pre>plugins &#123;
        &#8230;
        compile <span class="java&#45;quote<a href="scaffolding:2.0.0"</span>">></a>
        &#8230;
    &#125;</pre></div><p class="paragraph"/>Version 1.0.0 of the plugin provides the same scaffolding seen in Grails 2.2.x and below. Version 2.0.x of the scaffolding plugin includes different scaffolding templates that are aligned with the new REST APIs introcued in Grails 2.3 and above.<p class="paragraph"/><div class="hidden-block">
<h4>Dynamic Scaffolding</h4>
</div>
<h4>動的スカッフォルド</h4><p class="paragraph"/><div class="hidden-block">
The simplest way to get started with scaffolding is to enable it with the <code>scaffold</code> property. Set the <code>scaffold</code> property in the controller to <code>true</code> for the <code>Book</code> domain class:
</div>
スカッフォルドを利用する一番シンプルな方法は<code>scaffold</code>プロパティを設定することです。以下は<code>Book</code>ドメインクラスのコントローラにて<code>scaffold</code>プロパティを<code>true</code>に設定しています。<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    <span class="java&#45;keyword">static</span> scaffold = <span class="java&#45;keyword">true</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
This works because the <code>BookController</code> follows the same naming convention as the <code>Book</code> domain class. To scaffold a specific domain class we could reference the class directly in the scaffold property:
</div>
これが動作するのは<code>BookController</code>が<code>Book</code>ドメインクラスと同じ命名規則に従っているためです。特定のドメインクラスに対してスカッフォルドを利用する場合、以下の様に<code>scaffold</code>プロパティからそのクラスを直接参照できます。<p class="paragraph"/><div class="code"><pre>class SomeController &#123;
    <span class="java&#45;keyword">static</span> scaffold = Author
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
With this configured, when you start your application the actions and views will be auto-generated at runtime. The following actions are dynamically implemented by default by the runtime scaffolding mechanism:
</div>
この設定により、アプリケーション実行時にアクションとビューが自動生成されます。以下のアクションはデフォルトで実行時に動的生成されます。<p class="paragraph"/><div class="hidden-block">
<ul class="star">
<li>index</li>
<li>show</li>
<li>edit</li>
<li>delete</li>
<li>create</li>
<li>save</li>
<li>update</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>index</li>
<li>show</li>
<li>edit</li>
<li>delete</li>
<li>create</li>
<li>save</li>
<li>update</li>
</ul><p class="paragraph"/><div class="hidden-block">
A CRUD interface will also be generated. To access this open <code>http://localhost:8080/app/book</code> in a browser.
</div>
CRUDインターフェイスもまた生成されます。これらにアクセスするにはブラウザから<code>http://localhost:8080/app/book</code>を開いてください。<p class="paragraph"/><div class="hidden-block">
If you prefer to keep your domain model in Java and <a href="../guide/single.html#hibernate" class="guide">mapped with Hibernate</a> you can still use scaffolding, simply import the domain class and set its name as the <code>scaffold</code> argument.
</div>
Javaと<a href="../guide/single.html#hibernate" class="guide">Hibernateマップ</a>のドメインモデルを保ったままスカッフォルドを使いたい場合は、そのドメインクラスをインポートしその名前を<code>scaffold</code>の引数に設定してください。<p class="paragraph"/><div class="hidden-block">
You can add new actions to a scaffolded controller, for example:
</div>
以下例のように、スカッフォルドのコントローラに新たなアクションを追加することができます。<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> scaffold = Book<p class="paragraph"/>    def changeAuthor() &#123;
        def b = Book.get(params.id)
        b.author = Author.get(params&#91;<span class="java&#45;quote">"author.id"</span>&#93;)
        b.save()<p class="paragraph"/>        // redirect to a scaffolded action
        redirect(action:show)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can also override the scaffolded actions:
</div>
スカッフォルドのアクションを上書きすることもできます。<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> scaffold = Book<p class="paragraph"/>    // overrides scaffolded action to <span class="java&#45;keyword">return</span> both authors and books
    def index() &#123;
        &#91;bookInstanceList: Book.list(),
         bookInstanceTotal: Book.count(),
         authorInstanceList: Author.list()&#93;
    &#125;<p class="paragraph"/>    def show() &#123;
        def book = Book.get(params.id)
        log.error(book)
        &#91;bookInstance : book&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
All of this is what is known as "dynamic scaffolding" where the CRUD interface is generated dynamically at runtime.
</div>
これらはCRUDインターフェイスが実行時に動的に生成される"動的スカッフォルド"として知られています。<p class="paragraph"/><div class="hidden-block">
<blockquote class="note">
By default, the size of text areas in scaffolded views is defined in the CSS, so adding 'rows' and 'cols' attributes will have no effect.<p class="paragraph"/>Also, the standard scaffold views expect model variables of the form <code>&#60;propertyName&#62;InstanceList</code> for collections and <code>&#60;propertyName&#62;Instance</code> for single instances. It's tempting to use properties like 'books' and 'book', but those won't work.
</blockquote>
</div>
<blockquote class="note">
デフォルトではスカッフォルドで生成されるビューのテキストエリアのサイズはCSSで定義されているため、'rows'や'cols'属性追加は無効です。
また標準的なスカッフォルドのビューはコレクションには<code>&#60;propertyName&#62;InstanceList</code>書式の変数モデルを期待し、シングルインスタンスには<code>&#60;propertyName&#62;Instance</code>を期待します。'books'や'book'といったプロパティを使ってみたくなるかもしれませんが、うまく機能しません。
</blockquote><p class="paragraph"/><div class="hidden-block">
<h4>Customizing the Generated Views</h4>
</div>
<h4>生成されるビューのカスタマイズ</h4><p class="paragraph"/><div class="hidden-block">
The views adapt to <a href="../guide/single.html#constraints" class="guide">Validation constraints</a>. For example you can change the order that fields appear in the views simply by re-ordering the constraints in the builder:
</div>
ビューは<a href="../guide/single.html#constraints" class="guide">バリデーション制約</a>に従います。例えばビルダー内の制約順序を入れ替えるだけで、簡単にビュー上のフィールド表示順序を入れ替えることができます。<p class="paragraph"/><div class="code"><pre>def constraints = &#123;
    title()
    releaseDate()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
You can also get the generator to generate lists instead of text inputs if you use the <code>inList</code> constraint:
</div>
また<code>inList</code>制約を使うとテキスト入力の代わりにリストを生成することができます。<p class="paragraph"/><div class="code"><pre>def constraints = &#123;
    title()
    category(inList: &#91;<span class="java&#45;quote">"Fiction"</span>, <span class="java&#45;quote">"Non&#45;fiction"</span>, <span class="java&#45;quote">"Biography"</span>&#93;)
    releaseDate()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Or if you use the <code>range</code> constraint on a number:
</div>
あるいは以下のように数字と共に<code>range</code>制約を使用することもできます。<p class="paragraph"/><div class="code"><pre>def constraints = &#123;
    age(range:18..65)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
Restricting the size with a constraint also effects how many characters can be entered in the generated view:
</div>
以下のような制約によるサイズ制限は、生成されたビュー内で何文字入力できるかに影響します。<p class="paragraph"/><div class="code"><pre>def constraints = &#123;
    name(size:0..30)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Static Scaffolding</h4>
</div>
<h4>静的スカッフォルド</h4><p class="paragraph"/><div class="hidden-block">
Grails also supports "static" scaffolding.
</div>
Grailsは"静的な"スカッフォルドもサポートします。<p class="paragraph"/><div class="hidden-block">
The above scaffolding features are useful but in real world situations it's likely that you will want to customize the logic and views. Grails lets you generate a controller and the views used to create the above interface from the command line. To generate a controller type:
</div>
前述したスカッフォルドの機能は便利ですが、現実的にはそのロジックとビューをカスタマイズしたくなることでしょう。Grailsでは、前述のCRUDインターフェースを表示するためのコントローラとビューを、静的なファイルとしてコマンドラインから生成することができます。<p class="paragraph"/><div class="code"><pre>grails generate&#45;controller Book</pre></div><p class="paragraph"/><div class="hidden-block">
or to generate the views:
</div>
ビューを生成するには以下の通りです。<p class="paragraph"/><div class="code"><pre>grails generate&#45;views Book</pre></div><p class="paragraph"/><div class="hidden-block">
or to generate everything:
</div>
すべて生成するには以下の通りです。<p class="paragraph"/><div class="code"><pre>grails generate&#45;all Book</pre></div><p class="paragraph"/><div class="hidden-block">
If you have a domain class in a package or are generating from a <a href="../guide/single.html#hibernate" class="guide">Hibernate mapped class</a> remember to include the fully qualified package name:
</div>
パッケージ内にドメインクラスがある場合、または<a href="../guide/single.html#hibernate" class="guide">Hibernateマップクラス</a>から生成する場合は完全修飾パッケージ名で指定することを忘れないでください。<p class="paragraph"/><div class="code"><pre>grails generate&#45;all com.bookstore.Book</pre></div><p class="paragraph"/><div class="hidden-block">
<h4>Customizing the Scaffolding templates</h4>
</div>
<h4>スカッフォルドテンプレートのカスタマイズ</h4><p class="paragraph"/><div class="hidden-block">
The templates used by Grails to generate the controller and views can be customized by installing the templates with the <a href="../ref/Command Line/install-templates.html" class="commandLine">install-templates</a> command.
</div>
Grailsでコントローラやビューを生成するのに使用されているテンプレートはテンプレートをインストールすることによりカスタマイズできます。テンプレートのインストールは<a href="../ref/Command Line/install-templates.html" class="commandLine">install-templates</a>コマンドを使用してください。


<a name="19. Deployment"><!-- Legacy link --></a>
<h1 id="deployment">19 デプロイ</h1>
<div class="hidden-block">Grails applications can be deployed in a number of ways, each of which has its pros and cons.</div>
Grailsアプリケーションはいくつかの方法でデプロイが可能です。
なお、それぞれのデプロイ方法には利点、欠点があります。<p class="paragraph"/><h3>"grails run-app"</h3><p class="paragraph"/><div class="hidden-block">You should be very familiar with this approach by now, since it is the most common method of running an application during the development phase. An embedded Tomcat server is launched that loads the web application from the development sources, thus allowing it to pick up an changes to application files.</div>
開発中の間は上記コマンドによってアプリケーションを起動させる事が一般的な手法となります。
コマンド実行により、Grailsに同梱されているTomcatサーバが起動され、ソースコードが読み込まれます。ファイル変更時も再起動を実施せず、内容が反映されます。<p class="paragraph"/><div class="hidden-block">This approach is not recommended at all for production deployment because the performance is poor. Checking for and loading changes places a sizable overhead on the server. Having said that, <code>grails prod run-app</code> removes the per-request overhead and lets you fine tune how frequently the regular check takes place.</div>
なお、本コマンドでのデプロイはパフォーマンスが悪いため、本番環境での導入は推奨しておりません。Grailsアーテファクト(GSPやコントローラ)のソースファイルの変更を監視していて、変更されたらリコンパイル・リロードが行われる為です。<code>grails prod run-app</code>コマンドを利用することで上記処理を実施しないようにする事ができ、更新検出のオーバーヘッドをなくす事が出来ます。<p class="paragraph"/><div class="hidden-block">Setting the system property "disable.auto.recompile" to <code>true</code> disables this regular check completely, while the property "recompile.frequency" controls the frequency. This latter property should be set to the number of seconds you want between each check. The default is currently 3.</div>
また、起動オプションで<code>disable.auto.recompile=true</code>を指定する事で再コンパイルを無効にする事ができます。
また、<code>recompile.frequency</code>という起動オプションで構文のチェック頻度を指定できます。チェック頻度は数字(秒)で指定します。なお、本値のデフォルト値は3秒です。<p class="paragraph"/><h3>"grails run-war"</h3><p class="paragraph"/><div class="hidden-block">This is very similar to the previous option, but Tomcat runs against the packaged WAR file rather than the development sources. Hot-reloading is disabled, so you get good performance without the hassle of having to deploy the WAR file elsewhere.</div>
先ほどのコマンドと似ていますが、<code>grails run-app</code>ではTomcatサーバがソースコードを読み込んで動作するのに対して、<code>grails run-war</code>ではWARファイルを利用して動作します。
このコマンドによる起動では自動再読み込みが実施されず、WARファイルの面倒なデプロイをする必要もなく、高いパフォーマンスでの実行が可能です。<p class="paragraph"/><div class="hidden-block">h3. WAR file</div>
<h3>WARファイル</h3><p class="paragraph"/><div class="hidden-block">When it comes down to it, current java infrastructures almost mandate that web applications are deployed as WAR files, so this is by far the most common approach to Grails application deployment in production. Creating a WAR file is as simple as executing the <a href="../ref/Command Line/war.html" class="commandLine">war</a> command:</div>
現在のJavaによって動作するWebアプリケーションの大半はWARファイルによってデプロイされており、Grailsにおいても最も一般的な方法となります。
WARファイルの作成はシンプルな <a href="../ref/Command Line/war.html" class="commandLine">war</a> コマンドの実行で可能です。<p class="paragraph"/><div class="code"><pre>grails war</pre></div><p class="paragraph"/><div class="hidden-block">There are also many ways in which you can customise the WAR file that is created. For example, you can specify a path (either absolute or relative) to the command that instructs it where to place the file and what name to give it:</div>
WARファイル作成時にいくつかの条件指定が可能です。
例えば、ファイル名称及びファイル出力先を相対パスもしくは絶対パスで指定する事が可能です。<p class="paragraph"/><div class="code"><pre>grails war /opt/java/tomcat&#45;5.5.24/foobar.war</pre></div><p class="paragraph"/><div class="hidden-block">Alternatively, you can add a line to <code>grails-app/conf/BuildConfig.groovy</code> that changes the default location and filename:</div>
また、<code>grails-app/conf/BuildConfig.groovy</code>に以下の行を追加する事でデフォルトのファイル名称及びファイル出力先を指定する事が出来ます。<p class="paragraph"/><div class="code"><pre>grails.project.war.file = <span class="java&#45;quote">"foobar&#45;prod.war"</span></pre></div><p class="paragraph"/><div class="hidden-block">Any command line argument that you provide overrides this setting.</div>
設定はコマンドライン引数によって上書きを行う事が出来ます。<p class="paragraph"/><div class="hidden-block">It is also possible to control what libraries are included in the WAR file, for example to avoid conflicts with libraries in a shared directory. The default behavior is to include in the WAR file all libraries required by Grails, plus any libraries contained in plugin "lib" directories, plus any libraries contained in the application's "lib" directory. As an alternative to the default behavior you can explicitly specify the complete list of libraries to include in the WAR file by setting the property <code>grails.war.dependencies</code> in BuildConfig.groovy to either lists of Ant include patterns or closures containing AntBuilder syntax. Closures are invoked from within an Ant "copy" step, so only elements like "fileset" can be included, whereas each item in a pattern list is included. Any closure or pattern assigned to the latter property will be included in addition to <code>grails.war.dependencies</code>.</div>
WARファイルにどのライブラリを含めるかを指定する事ができ、ライブラリの競合を避ける事などができます。 デフォルトの状態では、Grailsに必要な全てのライブラリ、プラグインの "lib" ディレクトリに含まれるライブラリ、アプリケーションの "lib" ディレクトリに含まれるライブラリがWARファイルに含まれます。 デフォルトの動作を変更する場合は、BuildConfigで<code>grails.war.dependencies</code>プロパティにAntでインクルードするパターンのリストを設定するか、またはAntBuilder構文で記述したクロージャを設定することで、明示的にWARファイルに含めるライブラリを指定することができます。クロージャはAntの"copy"の処理の中から実行され、インクルードするパターンのリストを指定する"fileset"のみを含むことができます。なお、複数のクロージャ、パターンが指定された場合には末尾に指定されたものが有効化の対象となります。<p class="paragraph"/><div class="hidden-block">Be careful with these properties: if any of the libraries Grails depends on are missing, the application will almost certainly fail. Here is an example that includes a small subset of the standard Grails dependencies:</div>
<code>grails.war.dependencies</code>を指定する場合、Grailsの動作に必要なライブラリ群がない場合にはアプリケーションの起動に失敗するので注意して下さい。
以下にGrailsに最低限必要なライブラリ群を含める場合の記述例について示します。<p class="paragraph"/><div class="code"><pre>def deps = &#91;
    <span class="java&#45;quote">"hibernate3.jar"</span>,
    <span class="java&#45;quote">"groovy&#45;all&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"standard&#45;&#36;&#123;servletVersion&#125;.jar"</span>,
    <span class="java&#45;quote">"jstl&#45;&#36;&#123;servletVersion&#125;.jar"</span>,
    <span class="java&#45;quote">"oscache&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"commons&#45;logging&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"sitemesh&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"spring&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"log4j&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"ognl&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"commons&#45;&#42;.jar"</span>,
    <span class="java&#45;quote">"xstream&#45;1.2.1.jar"</span>,
    <span class="java&#45;quote">"xpp3_min&#45;1.1.3.4.O.jar"</span> &#93;<p class="paragraph"/>grails.war.dependencies = &#123;
    fileset(dir: <span class="java&#45;quote">"libs"</span>) &#123;
        <span class="java&#45;keyword">for</span> (pattern in deps) &#123;
            include(name: pattern)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This example only exists to demonstrate the syntax for the properties. If you attempt to use it as is in your own application, the application will probably not work. You can find a list of dependencies required by Grails in the "dependencies.txt" file in the root directory of the unpacked distribution. You can also find a list of the default dependencies included in WAR generation in the "War.groovy" script - see the <code>DEFAULT_DEPS</code> and <code>DEFAULT_J5_DEPS</code> variables.</div>
上記記述例はデモ用となっており、あなたが作成したアプリケーションに適用すると起動ができなくなると思われます。
Grailsの動作に必要なライブラリ群については、Grails本体のルートディレクトリ配下に存在する "dependecies.txt" で確認できます。
<blockquote class="note">Grails2.2.0ではdependencies.txtが無くなっています。</blockquote>
<blockquote class="note"><a href="http://jira.grails.org/browse/GRAILS-5971" target="blank">JIRA</a>に記載の通り、War.groovyには「DEFAULT_DEPS」及び「DEFAULT_J5_DEPS」の値が存在しません。本家英語ドキュメントの更新が行われていないため、上記内容に該当する箇所は未翻訳としております。</blockquote><p class="paragraph"/><div class="hidden-block">The remaining two configuration options available to you are <code>grails.war.copyToWebApp</code> and <code>grails.war.resources</code>. The first of these lets you customise what files are included in the WAR file from the "web-app" directory. The second lets you do any extra processing you want before the WAR file is finally created.</div>
<code>grails.war.copyToWebApp</code>、<code>grails.war.resources</code>のプロパティに関する説明が残っています。<code>grails.war.copyToWebApp</code>ではWARファイル作成時に "web-app" ディレクトリ配下のどのファイルを含めるかを指定する事が出来ます。<code>grails.war.resources</code>ではWARファイル作成前に実施したい追加処理を記述する事が出来ます。<p class="paragraph"/><div class="hidden-block"><div class="code"><pre>// This closure is passed the command line arguments used to start the
// war process.<p class="paragraph"/>grails.war.copyToWebApp = &#123; args &#45;&#62;
    fileset(dir:<span class="java&#45;quote">"web&#45;app"</span>) &#123;
        include(name: <span class="java&#45;quote">"js/&#42;&#42;"</span>)
        include(name: <span class="java&#45;quote">"css/&#42;&#42;"</span>)
        include(name: <span class="java&#45;quote">"WEB&#45;INF/&#42;&#42;"</span>)
    &#125;
&#125;<p class="paragraph"/>// This closure is passed the location of the staging directory that
// is zipped up to make the WAR file, and the command line arguments.
// Here we override the standard web.xml with our own.
grails.war.resources = &#123; stagingDir, args &#45;&#62;
    copy(file: <span class="java&#45;quote">"grails&#45;app/conf/custom&#45;web.xml"</span>,
         tofile: <span class="java&#45;quote">"&#36;&#123;stagingDir&#125;/WEB&#45;INF/web.xml"</span>)
&#125;</pre></div></div><p class="paragraph"/><div class="code"><pre>// このクロージャにはWARファイル作成時のコマンドライン引数が渡されます。
grails.war.copyToWebApp = &#123; args &#45;&#62;
    fileset(dir:<span class="java&#45;quote">"web&#45;app"</span>) &#123;
        include(name: <span class="java&#45;quote">"js/&#42;&#42;"</span>)
        include(name: <span class="java&#45;quote">"css/&#42;&#42;"</span>)
        include(name: <span class="java&#45;quote">"WEB&#45;INF/&#42;&#42;"</span>)
    &#125;
&#125;<p class="paragraph"/>// このクロージャにはWARファイルがZIP圧縮されるステージング環境のパスとコマンドライン引数が渡されます。
// 本例では標準のweb.xmlをあなたの作成したファイルで上書きします。
grails.war.resources = &#123; stagingDir, args &#45;&#62;
    copy(file: <span class="java&#45;quote">"grails&#45;app/conf/custom&#45;web.xml"</span>,
         tofile: <span class="java&#45;quote">"&#36;&#123;stagingDir&#125;/WEB&#45;INF/web.xml"</span>)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h2. Application servers</div>
<h2>アプリケーションサーバ</h2><p class="paragraph"/><div class="hidden-block">Ideally you should be able to simply drop a WAR file created by Grails into any application server and it should work straight away. However, things are rarely ever this simple. The <a href="http://grails.org/Deployment" target="blank">Grails website</a> contains an up-to-date list of application servers that Grails has been tested with, along with any additional steps required to get a Grails WAR file working.</div>
通常では作成したWARファイルは各アプリケーションサーバに配置するというシンプルな操作のみで動作可能となります。
なお、各アプリケーションサーバの最新確認状況及び、WARファイルを動作させるための詳細な手順については<a href="http://grails.org/Deployment" target="blank">Grails website</a> を参照下さい。



<h1 id="contributing">20 Grailsに貢献する</h1>
Grails is an open source project with an active community and we rely heavily on that community to help make Grails better. As such, there are various ways in which people can contribute to Grails. One of these is by <a href="../guide/single.html#plugins" class="guide">writing useful plugins</a> and making them publicly available. In this chapter, we'll look at some fo the other options.



<h2 id="issues">20.1 JIRAに課題をリポート(バグ報告)</h2>
Grails uses <a href="http://jira.grails.org" target="blank">JIRA</a> to track issues in the core framework, its documentation, its website, and many of the public plugins. If you've found a bug or wish to see a particular feature added, this is the place to start. You'll need to create a (free) JIRA account in order to either submit an issue or comment on an existing one.<p class="paragraph"/>When submitting issues, please provide as much information as possible and in the case of bugs, make sure you explain which versions of Grails and various plugins you are using. Also, an issue is much more likely to be dealt with if you attach a reproducible sample application (which can be packaged up using the <code>grails bug-report</code> command).<p class="paragraph"/><h3>Reviewing issues</h3><p class="paragraph"/>There are quite a few old issues in JIRA, some of which may no longer be valid. The core team can't track down these alone, so a very simple contribution that you can make is to verify one or two issues occasionally.<p class="paragraph"/>Which issues need verification? A shared <a href="http://jira.grails.org/secure/IssueNavigator.jspa?reset=true&amp;jqlQuery=project+%3D+GRAILS+AND+resolution+%3D+Unresolved+AND+%28cf%5B10310%5D+%3C%3D+%27-180d%27+OR+cf%5B10310%5D+is+EMPTY%29+AND+createdDate+%3C%3D+%27-180d%27" target="blank">JIRA filter</a> will display all issues that haven't been resolved and haven't been reviewed by someone else in the last 6 months. Just pick one or two of them and check whether they are still relevant.<p class="paragraph"/>Once you've verified an issue, simply edit it and set the "Last Reviewed" field to today. If you think the issue can be closed, then also check the "Flagged" field and add a short comment explaining why. Once those changes are saved, the issue will disappear from the results of the above filter. If you've flagged it, the core team will review and close if it really is no longer relevant.<p class="paragraph"/>One last thing: you can easily set the above filter as a favourite on <a href="http://jira.grails.org/secure/ManageFilters.jspa#filterView=popular" target="blank">this JIRA screen</a> so that it appears in the "Issues" drop down. Just click on the star next to a filter to make it a favourite.



<h2 id="build">20.2 ソースからビルドしてテストを走らせる</h2>
If you're interested in contributing fixes and features to the core framework, you will have to learn how to get hold of the project's source, build it and test it with your own applications. Before you start, make sure you have:
<ul class="star">
<li>A JDK (1.6 or above)</li>
<li>A git client</li>
</ul><p class="paragraph"/>Once you have all the pre-requisite packages installed, the next step is to download the Grails source code, which is hosted at <a href="http://github.com" target="blank">GitHub</a> in several repositories owned by the <a href="http://github.com/grails" target="blank">&#34;grails&#34; GitHub user</a>. This is a simple case of cloning the repository you're interested in. For example, to getthe core framework run:<p class="paragraph"/><div class="code"><pre>git clone http://github.com/grails/grails&#45;core.git</pre></div><p class="paragraph"/>This will create a "grails-core" directory in your current working directory containing all the project source files. The next step is to get a Grails installation from the source.<p class="paragraph"/><h3>Creating a Grails installation</h3><p class="paragraph"/>If you look at the project structure, you'll see that it doesn't look much like a standard <code>GRAILS_HOME</code> installation. But, it's very simple to turn it into one. Just run this from the root directory of the project:<p class="paragraph"/><div class="code"><pre>./gradlew install</pre></div><p class="paragraph"/>This will fetch all the standard dependencies required by Grails and then build a <code>GRAILS_HOME</code> installation. Note that this target skips the extensive collection of Grails test classes, which can take some time to complete.<p class="paragraph"/>Once the above command has finished, simply set the <code>GRAILS_HOME</code> environment variable to the checkout directory and add the "bin" directory to your path. When you next type run the <code>grails</code> command, you'll be using the version you just built.<p class="paragraph"/><h3>Running the test suite</h3><p class="paragraph"/>All you have to do to run the full suite of tests is:<p class="paragraph"/><div class="code"><pre>./gradlew test</pre></div><p class="paragraph"/>These will take a while (15-30 mins), so consider running individual tests using the command line. For example, to run the test case <code>MappingDslTests</code> simply execute the following command:
<div class="code"><pre>./gradlew &#45;Dtest.single=MappingDslTest :grails&#45;test&#45;suite&#45;persistence:test</pre></div><p class="paragraph"/>Note that you need to specify the sub-project that the test case resides in, because the top-level "test" target won't work....<p class="paragraph"/><h3>Developing in IntelliJ IDEA</h3><p class="paragraph"/>You need to run the following gradle task:
<div class="code"><pre>./gradlew idea</pre></div><p class="paragraph"/>Then open the project file which is generated in IDEA. Simple!<p class="paragraph"/><h3>Developing in STS / Eclipse</h3><p class="paragraph"/>You need to run the following gradle task:
<div class="code"><pre>./gradlew cleanEclipse eclipse</pre></div><p class="paragraph"/>Before importing projects to STS do the following action:
<ul class="star">
<li>Edit grails-scripts/.classpath and remove the line "&#60;classpathentry kind="src" path="../scripts"/&#62;".</li>
</ul><p class="paragraph"/>Use "Import-&#62;General-&#62;Existing Projects into Workspace" to import all projects to STS. There will be a few build errors. To fix them do the following:
<ul class="star">
<li>Add the springloaded-core JAR file in $GRAILS_HOME/lib/com.springsource.springloaded/springloaded-core/jars to grails-core's classpath.</li>
<li>Remove "src/test/groovy" from grails-plugin-testing's source path GRECLIPSE-1067</li>
<li>Add the jsp-api JAR file in $GRAILS_HOME/lib/javax.servlet.jsp/jsp-api/jars to the classpath of grails-web</li>
<li>Fix the source path of grails-scripts. Add linked source folder linking to "../scripts". If you get build errors in grails-scripts, do "../gradlew cleanEclipse eclipse" in that directory and edit the .classpath file again (remove the line "&#60;classpathentry kind="src" path="../scripts"/&#62;"). Remove possible empty "scripts" directory under grails-scripts if you are not able to add the linked folder.</li>
<li>Do a clean build for the whole workspace.</li>
<li>To use Eclipse GIT scm team provider: Select all projects (except "Servers") in the navigation and right click -&#62; Team -&#62; Share project (not "Share projects"). Choose "Git". Then check "Use or create repository in parent folder of project" and click "Finish".</li>
<li>Get the recommended code style settings from the <a href="http://grails.1312388.n4.nabble.com/Grails-development-code-style-IDE-formatting-settings-tp3854216p3854216.html" target="blank">mailing list thread</a> (final style not decided yet, currently <a href="http://grails.1312388.n4.nabble.com/attachment/3854262/0/profile.xml" target="blank">profile.xml</a>). Import the code style xml file to STS in Window-&#62;Preferences-&#62;Java-&#62;Code Style-&#62;Formatter-&#62;Import . Grails code uses spaces instead of tabs for indenting.</li>
</ul><p class="paragraph"/><h3>Debugging Grails or a Grails application</h3><p class="paragraph"/>To enable debugging, run:
<div class="code"><pre>grails &#45;debug &#60;command&#62;</pre></div><p class="paragraph"/>and then connect to the JVM remotely via the IDE ("remote debugging") using the port 5005. Of course, if you have modified the <code>startGrails</code> script to use a different port number, connect using that one.<p class="paragraph"/><blockquote class="note">
In previous versions of Grails there was a <code>grails-debug</code> command.  The command is still included in the distribution and is deprecated in favor of the <code>-debug</code> switch to the standard <code>grails</code> command.
</blockquote><p class="paragraph"/>If you need to debug stuff that happens during application startup, then you should modify the "grails-debug" script and change the "suspend" option from 'n' to 'y'. You can read more about the JPDA connection settings TODO here: <a href="http://java.sun.com/j2se/1.5.0/docs/guide/jpda/conninv.html#Invocation" target="blank">http://java.sun.com/j2se/1.5.0/docs/guide/jpda/conninv.html#Invocation</a>.<p class="paragraph"/>It's also possible to get Eclipse to wait for incoming debugger connections and instead of using "-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005" you could use this "-Xrunjdwp:transport=dt_socket,server=n,address=8000" (which assumes the Eclipse default port for remote java applications) Inside eclipse you create a new "Remote Java Application" launch configuration and change the connection type to "Standard (Socket Listen)" and click debug. This allows you to start a debugger session in eclipse and just leave it running and you're free to debug anything without having to keep remembering to relaunch a "Socket Attach" launch configuration. You might find it handy to have 2 scripts, one called "grails-debug", and another called "grails-debug-attach"



<h2 id="patchesCore">20.3 Grailsコアにパッチを送る</h2>
If you want to submit patches to the project, you simply need to fork the repository on GitHub rather than clone it directly. Then you will commit your changes to your fork and send a pull request for a core team member to review.<p class="paragraph"/><h3>Forking and Pull Requests</h3>
One of the benefits of <a href="http://github.com" target="blank">GitHub</a> is the way that you can easily contribute to a project by <a href="http://help.github.com/fork-a-repo/" target="blank">forking the repository</a> and <a href="http://help.github.com/send-pull-requests/" target="blank">sending pull requests</a> with your changes.<p class="paragraph"/>What follows are some guidelines to help ensure that your pull requests are speedily dealt with and provide the information we need. They will also make your life easier!<p class="paragraph"/><h4>Create a local branch for your changes</h4><p class="paragraph"/>Your life will be greatly simplified if you create a local branch to make your changes on. For example, as soon as you fork a repository and clone the fork locally, execute
<div class="code"><pre>git checkout &#45;b mine</pre></div><p class="paragraph"/>This will create a new local branch called "mine" based off the "master" branch. Of course, you can name the branch whatever you like - you don't have to use "mine".<p class="paragraph"/><h4>Create JIRAs for non-trivial changes</h4><p class="paragraph"/>For any non-trivial changes, raise a JIRA issue if one doesn't already exist. That helps us keep track of what changes go into each new version of Grails.<p class="paragraph"/><h4>Include JIRA issue ID in commit messages</h4><p class="paragraph"/>This may not seem particularly important, but having a JIRA issue ID in a commit message means that we can find out at a later date why a change was made. Include the ID in any and all commits that relate to that issue. If a commit isn't related to an issue, then there's no need to include an issue ID.<p class="paragraph"/><h4>Make sure your fork is up to date</h4><p class="paragraph"/>Since the core developers must merge your commits into the main repository, it makes life much easier if your fork on GitHub is up to date before you send a pull request.<p class="paragraph"/>Let's say you have the main repository set up as a remote called "upstream" and you want to submit a pull request. Also, all your changes are currently on the local "mine" branch but not on "master". The first step involves pulling any changes from the main repository that have been added since you last fetched and merged:
<div class="code"><pre>git checkout master
git pull upstream</pre></div><p class="paragraph"/>This should complete without any problems or conflicts. Next, rebase your local branch against the now up-to-date master:
<div class="code"><pre>git checkout mine
git rebase master</pre></div><p class="paragraph"/>What this does is rearrange the commits such that all of your changes come after the most recent one in master. Think adding some cards to the top of a deck rather than shuffling them into the pack.<p class="paragraph"/>You'll now be able to do a clean merge from your local branch to master:
<div class="code"><pre>git checkout master
git merge mine</pre></div><p class="paragraph"/>Finally, you must push your changes to your remote repository on GitHub, otherwise the core developers won't be able to pick them up:
<div class="code"><pre>git push</pre></div><p class="paragraph"/>You're now ready to send the pull request from the GitHub user interface.<p class="paragraph"/><h4>Say what your pull request is for</h4><p class="paragraph"/>A pull request can contain any number of commits and it may be related to any number of issues. In the pull request message, please specify the IDs of all issues that the request relates to. Also give a brief description of the work you have done, such as: "I refactored the data binder and added support for custom number editors (GRAILS-xxxx)".


<h2 id="patchesDoc">20.4 Grailsドキュメントにパッチを送る</h2>
Contributing to the documentation is simpler for the core framework because there is a public fork of the <a href="http://github.com/grails/grails-doc" target="blank">http://github.com/grails/grails-doc</a> project that anyone can request commit access to. So, if you want to submit patches to the documentation, simply request commit access to the following repository <a href="http://github.com/pledbrook/grails-doc" target="blank">http://github.com/pledbrook/grails-doc</a> by sending a GitHub message to 'pledbrook' and then commit your patches just as you would to any other GitHub repository.<p class="paragraph"/><h3>Building the Guide</h3><p class="paragraph"/>To build the documentation, simply type:
<div class="code"><pre>./gradlew docs</pre></div><p class="paragraph"/>Be warned: this command can take a while to complete and you should probably increase your Gradle memory settings by giving the <code>GRADLE_OPTS</code> environment variable a value like
<div class="code"><pre>export GRADLE_OPTS=<span class="java&#45;quote">"&#45;Xmx512m &#45;XX:MaxPermSize=384m"</span></pre></div><p class="paragraph"/>Fortunately, you can reduce the overall build time with a couple of useful options. The first allows you to specify the location of the Grails source to use:<p class="paragraph"/><div class="code"><pre>./gradlew &#45;Dgrails.home=/home/user/projects/grails&#45;core docs</pre></div><p class="paragraph"/>The Grails source is required because the guide links to its API documentation and the build needs to ensure it's generated. If you don't specify a <code>grails.home</code> property, then the build will fetch the Grails source - a download of 10s of megabytes. It must then compile the Grails source which can take a while too.<p class="paragraph"/>Additionally you can create a local.properties file with this variable set:
<div class="code"><pre>grails.home=/home/user/projects/grails&#45;core</pre></div>
or
<div class="code"><pre>grails.home=../grails&#45;core</pre></div><p class="paragraph"/>The other useful option allows you to disable the generation of the API documentation, since you only need to do it once:
<div class="code"><pre>./gradlew &#45;Ddisable.groovydocs=<span class="java&#45;keyword">true</span> docs</pre></div><p class="paragraph"/>Again, this can save a significant amount of time and memory.<p class="paragraph"/>The main English user guide is generated in the <code>build/docs</code> directory, with the <code>guide</code> sub-directory containing the user guide part and the <code>ref</code> folder containing the reference material. To view the user guide, simply open <code>build/docs/index.html</code>.<p class="paragraph"/><h3>Publishing</h3><p class="paragraph"/>The publishing system for the user guide is the same as <a href="http://grails.org/doc/2.0.0.M1/guide/conf.html#docengine" target="blank">the one for Grails projects</a>. You write your chapters and sections in the gdoc wiki format which is then converted to HTML for the final guide. Each chapter is a top-level gdoc file in the <code>src/&#60;lang&#62;/guide</code> directory. Sections and sub-sections then go into directories with the same name as the chapter gdoc but without the suffix.<p class="paragraph"/>The structure of the user guide is defined in the <code>src/&#60;lang&#62;/guide/toc.yml</code> file, which is a YAML file. This file also defines the (language-specific) section titles. If you add or remove a gdoc file, you must update the TOC as well!<p class="paragraph"/>The <code>src/&#60;lang&#62;/ref</code> directory contains the source for the reference sidebar. Each directory is the name of a category, which also appears in the docs. Hence the directories need different names for the different languages. Inside the directories go the gdoc files, whose names match the names of the methods, commands, properties or whatever that the files describe.<p class="paragraph"/><h3>Translations</h3><p class="paragraph"/>This project can host multiple translations of the user guide, with <code>src/en</code> being the main one. To add another one, simply create a new language directory under <code>src</code> and copy into it all the files under <code>src/en</code>. The build will take care of the rest.<p class="paragraph"/>Once you have a copy of the original guide, you can use the <code>&#123;hidden&#125;</code> macro to wrap the English text that you have replaced, rather than remove it. This makes it easier to compare changes to the English guide against your translation. For example:
<div class="code"><pre>&#123;hidden&#125;
When you create a Grails application with the &#91;create&#45;app|commandLine&#93; command,
Grails doesn't automatically create an Ant <code>build.xml</code> file but you can generate
one with the &#91;integrate&#45;with|commandLine&#93; command:
&#123;hidden&#125;<p class="paragraph"/>Quando crias uma aplicação Grails com o comando &#91;create&#45;app|commandLine&#93;, Grails
não cria automaticamente um ficheiro de construção Ant <code>build.xml</code> mas podes gerar
um com o comando &#91;integrate&#45;with|commandLine&#93;:</pre></div><p class="paragraph"/>Because the English text remains in your gdoc files, <code>diff</code> will show differences on the English lines. You can then use the output of <code>diff</code> to see which bits of your translation need updating. On top of that, the <code>&#123;hidden&#125;</code> macro ensures that the text inside it is not displayed in the browser, although you can display it by adding this URL as a bookmark: <code>javascript:toggleHidden();</code> (requires you to build the user guide with Grails 2.0 M2 or later).<p class="paragraph"/>Even better, you can use the <code>left_to_do.groovy</code> script in the root of the project to see what still needs translating. You run it like so:
<div class="code"><pre>./left_to_do.groovy es</pre></div><p class="paragraph"/>This will then print out a recursive diff of the given translation against the reference English user guide. Anything in <code>&#123;hidden&#125;</code> blocks that hasn't changed since being translated will  <em class="italic">not</em>  appear in the diff output. In other words, all you will see is content that hasn't been translated yet and content that has changed since it was translated. Note that <code>&#123;code&#125;</code> blocks are ignored, so you  <em class="italic">don't</em>  need to include them inside <code>&#123;hidden&#125;</code> macros.<p class="paragraph"/>To provide translations for the headers, such as the user guide title and subtitle, just add language specific entries in the 'resources/doc.properties' file like so:
<div class="code"><pre>es.title=El Grails Framework
es.subtitle=...</pre></div><p class="paragraph"/>For each language translation, properties beginning <code>&#60;lang&#62;</code>. will override the standard ones. In the above example, the user guide title will be El Grails Framework for the Spanish translation. Also, translators can be credited by adding a '&#60;lang&#62;.translators' property:
<div class="code"><pre>fr.translators=Stéphane Maldini</pre></div><p class="paragraph"/>This should be a comma-separated list of names (or the native language equivalent) and it will be displayed as a "Translated by" header in the user guide itself.<p class="paragraph"/>You can build specific translations very easily using the <code>publishGuide_&#42;</code> and <code>publishPdf_&#42;</code> tasks. For example, to build both the French HTML and PDF user guides, simply execute
<div class="code"><pre>./gradlew publishPdf_fr</pre></div><p class="paragraph"/>Each translation is generated in its own directory, so for example the French guide will end up in <code>build/docs/fr</code>. You can then view the translated guide by opening <code>build/docs/&#60;lang&#62;/index.html</code>.<p class="paragraph"/>All translations are created as part of the <a href="http://hudson.grails.org/job/grails_docs_2.0.x/lastSuccessfulBuild/artifact/build/docs/" target="blank">Hudson CI build for the grails-doc</a> project, so you can easily see what the current state is without having to build the docs yourself.



<h1 id="traslateReport">21 翻訳レポート</h1>

<h1>Document Translation Report.</h1>
<ul class="star">
<li><strong class="bold">File Count</strong> - 294</li>
<li><strong class="bold">Done</strong> - 231</li>
<li><strong class="bold">TODO</strong> - 61</li>
<li><strong class="bold">Not found or new</strong> - 2</li>
</ul><p class="paragraph"/><h2>Original document updated after translation.:</h2><p class="paragraph"/><strong class="bold">./guide/theWebLayer/controllers/dataBinding.gdoc</strong><p class="paragraph"/><div class="code"><pre>85 : def bindingMap = &#91;name: 'Genesis', 
86 :                   'albums&#91;0&#93;': &#91;title: 'Foxtrot', numberOfTracks: 6&#93;, 
118:  &#42; an id of 4 and set its title to 'Selling England By The Pound'.  In both 
120:  &#42; from the database by id, the Album will be added to albums and will be updated 
222: When binding an empty <span class="java&#45;object">String</span> (a <span class="java&#45;object">String</span> with no characters in it, not even spaces), the data binder will convert the empty <span class="java&#45;object">String</span> to <span class="java&#45;keyword">null</span>.  This simplifies the most common <span class="java&#45;keyword">case</span> where the intent is to treat an empty form field as having the value <span class="java&#45;keyword">null</span> since there isn't a way to actually submit a <span class="java&#45;keyword">null</span> as a request parameter.  When <span class="java&#45;keyword">this</span> behavior is not desireable the application may assign the value directly.
479: The &#91;BindUsing|api:org.grails.databinding.BindUsing&#93; annotation may be used to define a custom binding mechanism <span class="java&#45;keyword">for</span> all of the fields on a particular class. When the annotation is applied to a class, the value assigned to the annotation should be a class which <span class="java&#45;keyword">implements</span> the &#91;BindingHelper|api:org.grails.databinding.BindingHelper&#93; <span class="java&#45;keyword">interface</span>.  An instance of that class will be used any time a value is bound to a property in the class that <span class="java&#45;keyword">this</span> annotation has been applied to. 
564: A global setting may be configured in <code>Config.groovy</code> to define date formats which will be used application wide when binding to Date.
569: grails.databinding.dateFormats = &#91;'MMddyyyy', 'yyyy&#45;MM&#45;dd HH:mm:ss.S', <span class="java&#45;quote">"yyyy&#45;MM&#45;dd'T'hh:mm:ss'Z'"</span>&#93;
573: The formats specified in <code>grails.databinding.dateFormats</code> will be attempted in the order in which they are included in the List.  If a property is marked with &#64;BindingFormat, the &#64;BindingFormat will take precedence over the values specified in <code>grails.databinding.dateFormats</code>.
575: The <span class="java&#45;keyword">default</span> formats that are used are <span class="java&#45;quote">"yyyy&#45;MM&#45;dd HH:mm:ss.S"</span> and <span class="java&#45;quote">"yyyy&#45;MM&#45;dd'T'hh:mm:ss'Z'"</span>.</pre></div><p class="paragraph"/><strong class="bold">./guide/introduction/whatsNew23.gdoc</strong><p class="paragraph"/><div class="code"><pre>158: The <code>create&#45;app</code> command will now by <span class="java&#45;keyword">default</span> generate the command line grailsw wrapper <span class="java&#45;keyword">for</span> newly created applications.  The <code>&#45;&#45;skip&#45;wrapper</code> <span class="java&#45;keyword">switch</span> may be used to prevent the wrapper from being generated.</pre></div><p class="paragraph"/><strong class="bold">./guide/commandLine/forkedMode.gdoc</strong><p class="paragraph"/><div class="code"><pre>9  :    test: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256, daemon:<span class="java&#45;keyword">true</span>&#93;, // configure settings <span class="java&#45;keyword">for</span> the test&#45;app JVM
10 :    run: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;, // configure settings <span class="java&#45;keyword">for</span> the run&#45;app JVM
11 :    war: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;, // configure settings <span class="java&#45;keyword">for</span> the run&#45;war JVM
12 :    console: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256&#93;// configure settings <span class="java&#45;keyword">for</span> the Console UI JVM
45 : The defaut configuration <span class="java&#45;keyword">for</span> the testing is to activate a daemon to run tests using the <code>daemon</code> argument:
49 :    test: &#91;maxMemory: 768, minMemory: 64, debug: <span class="java&#45;keyword">false</span>, maxPerm: 256, daemon:<span class="java&#45;keyword">true</span>&#93;, // configure settings <span class="java&#45;keyword">for</span> the test&#45;app JVM
53 : This only works in interactive mode, so <span class="java&#45;keyword">if</span> you start Grails with the 'grails' command and then using <code>test&#45;app</code> the daemon will be used:
60 : This has the effect of speeding&#45;up test executions times. You can disable the daemon by setting <code>daemon</code> to <code><span class="java&#45;keyword">false</span></code>. If the <code>daemon</code> becomes unresponsive you can restart it with <code>restart&#45;daemon</code>:
63 : $ grails&#62; restart&#45;daemon
69 : An important consideration when using forked execution is that the <code>debug</code> argument will allow a remote debugger to be attached to the build JVM but not the JVM that your application is running in. To debug your application you should use the <code>debug&#45;fork</code> argument:
72 : grails test&#45;app &#45;&#45;debug&#45;fork
75 : Or <span class="java&#45;keyword">for</span> run&#45;app:
78 : grails run&#45;app &#45;&#45;debug&#45;fork</pre></div><p class="paragraph"/><h2>Not done.</h2>
<ul class="star">
<li>../en/guide/GORM/advancedGORMFeatures/defaultSortOrder.gdoc</li>
<li>../en/guide/GORM/advancedGORMFeatures/eventsAutoTimestamping.gdoc</li>
<li>../en/guide/GORM/advancedGORMFeatures/ormdsl/customHibernateTypes.gdoc</li>
<li>../en/guide/GORM/advancedGORMFeatures/ormdsl/customNamingStrategy.gdoc</li>
<li>../en/guide/GORM/advancedGORMFeatures/ormdsl/derivedProperties.gdoc</li>
<li>../en/guide/GORM/domainClasses/gormAssociation/manyToOneAndOneToOne.gdoc</li>
<li>../en/guide/GORM/domainClasses/inheritanceInGORM.gdoc</li>
<li>../en/guide/GORM/persistenceBasics/modificationChecking.gdoc</li>
<li>../en/guide/GORM/querying/criteria.gdoc</li>
<li>../en/guide/GORM/querying/detachedCriteria.gdoc</li>
<li>../en/guide/GORM/querying/hql.gdoc</li>
<li>../en/guide/async/grailsEvents.gdoc</li>
<li>../en/guide/commandLine/interactiveMode.gdoc</li>
<li>../en/guide/commandLine/wrapper.gdoc</li>
<li>../en/guide/conf.gdoc</li>
<li>../en/guide/conf/config.gdoc</li>
<li>../en/guide/conf/config/builtInOptions.gdoc</li>
<li>../en/guide/conf/config/configGORM.gdoc</li>
<li>../en/guide/conf/config/logging.gdoc</li>
<li>../en/guide/contributing.gdoc</li>
<li>../en/guide/contributing/build.gdoc</li>
<li>../en/guide/contributing/issues.gdoc</li>
<li>../en/guide/contributing/patchesCore.gdoc</li>
<li>../en/guide/contributing/patchesDoc.gdoc</li>
<li>../en/guide/gettingStarted/aHelloWorldExample.gdoc</li>
<li>../en/guide/links.yml</li>
<li>../en/guide/rewriteRules.txt</li>
<li>../en/guide/security/xssPrevention.gdoc</li>
<li>../en/guide/services/declarativeTransactions/transactionsRollbackAndTheSession.gdoc</li>
<li>../en/guide/testing/integrationTesting.gdoc</li>
<li>../en/guide/theWebLayer/urlmappings/namespacedControllers.gdoc</li>
<li>../en/guide/theWebLayer/urlmappings/restfulMappings.gdoc</li>
<li> <strong class="bold">(original file updated)</strong> ../en/guide/toc.yml</li>
<li>../en/guide/validation.gdoc</li>
<li>../en/guide/validation/constraints.gdoc</li>
<li>../en/guide/validation/sharingConstraints.gdoc</li>
<li>../en/guide/validation/validatingConstraints.gdoc</li>
<li>../en/guide/validation/validationAndInternationalization.gdoc</li>
<li>../en/guide/validation/validationNonDomainAndCommandObjectClasses.gdoc</li>
<li>../en/guide/validation/validationOnTheClient.gdoc</li>
<li>../en/guide/webServices/REST/binding.gdoc</li>
<li>../en/guide/webServices/REST/domainResources.gdoc</li>
<li>../en/guide/webServices/REST/hypermedia.gdoc</li>
<li>../en/guide/webServices/REST/hypermedia/atom.gdoc</li>
<li>../en/guide/webServices/REST/hypermedia/hal.gdoc</li>
<li>../en/guide/webServices/REST/hypermedia/vndError.gdoc</li>
<li>../en/guide/webServices/REST/linkingToResources.gdoc</li>
<li>../en/guide/webServices/REST/renderers.gdoc</li>
<li>../en/guide/webServices/REST/renderers/customRenderers.gdoc</li>
<li>../en/guide/webServices/REST/renderers/defaultRenderers.gdoc</li>
<li>../en/guide/webServices/REST/renderers/gspRenderers.gdoc</li>
<li>../en/guide/webServices/REST/renderers/namedObjectMarshallers.gdoc</li>
<li>../en/guide/webServices/REST/renderers/objectMarshallerInterface.gdoc</li>
<li>../en/guide/webServices/REST/renderers/objectMarshallers.gdoc</li>
<li>../en/guide/webServices/REST/restfulControllers.gdoc</li>
<li>../en/guide/webServices/REST/restfulControllers/extendingRestfulController.gdoc</li>
<li>../en/guide/webServices/REST/restfulControllers/generatingRestControllers.gdoc</li>
<li>../en/guide/webServices/REST/restfulControllers/restControllersStepByStep.gdoc</li>
<li>../en/guide/webServices/REST/urlMappings.gdoc</li>
<li>../en/guide/webServices/REST/versioningResources.gdoc</li>
<li>../en/guide/webServices/SOAP.gdoc</li>
</ul><p class="paragraph"/><h2>File not found (new file added) or empty file</h2>
<ul class="star">
<li>../en/guide/gettingStarted.gdoc</li>
<li>../en/guide/theWebLayer.gdoc</li>
</ul><p class="paragraph"/>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/add-proxy.html">add-proxy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/alias.html">alias</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/bootstrap.html">bootstrap</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/bug-report.html">bug-report</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/clean.html">clean</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/clear-proxy.html">clear-proxy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/compile.html">compile</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/console.html">console</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-app.html">create-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-controller.html">create-controller</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-filters.html">create-filters</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-hibernate-cfg-xml.html">create-hibernate-cfg-xml</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-integration-test.html">create-integration-test</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-multi-project-build.html">create-multi-project-build</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-plugin.html">create-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-pom.html">create-pom</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-scaffold-controller.html">create-scaffold-controller</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-script.html">create-script</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-service.html">create-service</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-tag-lib.html">create-tag-lib</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-unit-test.html">create-unit-test</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/dependency-report.html">dependency-report</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/doc.html">doc</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/generate-all.html">generate-all</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/generate-controller.html">generate-controller</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/generate-views.html">generate-views</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/help.html">help</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/init.html">init</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/install-dependency.html">install-dependency</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/install-plugin.html">install-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/install-templates.html">install-templates</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/integrate-with.html">integrate-with</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/interactive.html">interactive</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/list-plugin-updates.html">list-plugin-updates</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/list-plugins.html">list-plugins</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/migrate-docs.html">migrate-docs</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/package-plugin.html">package-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/package.html">package</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/plugin-info.html">plugin-info</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/refresh-dependencies.html">refresh-dependencies</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/remove-proxy.html">remove-proxy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/run-app.html">run-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/run-script.html">run-script</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/run-war.html">run-war</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/schema-export.html">schema-export</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/set-proxy.html">set-proxy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/set-version.html">set-version</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/shell.html">shell</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/stats.html">stats</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/stop-app.html">stop-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/test-app.html">test-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/uninstall-plugin.html">uninstall-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/upgrade.html">upgrade</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/war.html">war</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/wrapper.html">wrapper</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Constraints</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Constraints/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Constraints/attributes.html">attributes</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/bindable.html">bindable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/blank.html">blank</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/creditCard.html">creditCard</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/email.html">email</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/inList.html">inList</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/matches.html">matches</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/max.html">max</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/maxSize.html">maxSize</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/min.html">min</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/minSize.html">minSize</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/notEqual.html">notEqual</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/nullable.html">nullable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/range.html">range</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/scale.html">scale</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/size.html">size</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/unique.html">unique</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/url.html">url</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/validator.html">validator</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/widget.html">widget</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controllers</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Controllers/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Controllers/actionName.html">actionName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/afterInterceptor.html">afterInterceptor</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/allowedMethods.html">allowedMethods</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/beforeInterceptor.html">beforeInterceptor</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/bindData.html">bindData</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/chain.html">chain</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/controllerName.html">controllerName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/defaultAction.html">defaultAction</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/flash.html">flash</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/forward.html">forward</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/grailsApplication.html">grailsApplication</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/namespace.html">namespace</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/params.html">params</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/redirect.html">redirect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/render.html">render</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/request.html">request</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/respond.html">respond</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/response.html">response</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/responseFormats.html">responseFormats</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/servletContext.html">servletContext</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/session.html">session</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/withForm.html">withForm</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/withFormat.html">withFormat</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Database Mapping</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/autoImport.html">autoImport</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/autoTimestamp.html">autoTimestamp</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/batchSize.html">batchSize</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/cache.html">cache</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/cascade.html">cascade</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/column.html">column</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/comment.html">comment</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/discriminator.html">discriminator</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/dynamicInsert.html">dynamicInsert</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/dynamicUpdate.html">dynamicUpdate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/fetch.html">fetch</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/id.html">id</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/ignoreNotFound.html">ignoreNotFound</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/indexColumn.html">indexColumn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/insertable.html">insertable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/joinTable.html">joinTable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/lazy.html">lazy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/order.html">order</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/sort.html">sort</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/table.html">table</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/type.html">type</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/updateable.html">updateable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/version.html">version</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/addTo.html">addTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/attach.html">attach</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/belongsTo.html">belongsTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/clearErrors.html">clearErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/constraints.html">constraints</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/count.html">count</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/countBy.html">countBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/createCriteria.html">createCriteria</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/delete.html">delete</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/discard.html">discard</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/embedded.html">embedded</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/errors.html">errors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/executeQuery.html">executeQuery</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/exists.html">exists</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/fetchMode.html">fetchMode</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/find.html">find</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findAll.html">findAll</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findAllBy.html">findAllBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findAllWhere.html">findAllWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findBy.html">findBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrCreateBy.html">findOrCreateBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrCreateWhere.html">findOrCreateWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrSaveBy.html">findOrSaveBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrSaveWhere.html">findOrSaveWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findWhere.html">findWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/first.html">first</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/get.html">get</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/getAll.html">getAll</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/hasErrors.html">hasErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/hasMany.html">hasMany</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/hasOne.html">hasOne</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/ident.html">ident</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/instanceOf.html">instanceOf</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/isAttached.html">isAttached</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/isDirty.html">isDirty</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/last.html">last</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/list.html">list</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/listOrderBy.html">listOrderBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/load.html">load</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/lock.html">lock</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/mapWith.html">mapWith</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/mappedBy.html">mappedBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/mapping.html">mapping</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/merge.html">merge</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/namedQueries.html">namedQueries</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/properties.html">properties</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/read.html">read</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/refresh.html">refresh</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/removeFrom.html">removeFrom</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/save.html">save</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/transients.html">transients</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/validate.html">validate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/where.html">where</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/whereAny.html">whereAny</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withCriteria.html">withCriteria</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withNewSession.html">withNewSession</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withSession.html">withSession</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withTransaction.html">withTransaction</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plug-ins</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/URL%20mappings.html">URL mappings</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/codecs.html">codecs</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/controllers.html">controllers</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/core.html">core</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/dataSource.html">dataSource</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/domainClasses.html">domainClasses</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/filters.html">filters</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/hibernate.html">hibernate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/i18n.html">i18n</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/logging.html">logging</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/scaffolding.html">scaffolding</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/services.html">services</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/servlets.html">servlets</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/web%20flow.html">web flow</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Services</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Services/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Services/scope.html">scope</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Services/transactional.html">transactional</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Servlet API</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/request.html">request</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/response.html">response</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/servletContext.html">servletContext</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/session.html">session</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tag Libraries</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/actionName.html">actionName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/controllerName.html">controllerName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/flash.html">flash</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/pageScope.html">pageScope</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/params.html">params</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/request.html">request</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/response.html">response</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/servletContext.html">servletContext</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tag%20Libraries/session.html">session</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags/actionSubmit.html">actionSubmit</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/actionSubmitImage.html">actionSubmitImage</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/applyLayout.html">applyLayout</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/checkBox.html">checkBox</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/collect.html">collect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/cookie.html">cookie</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/country.html">country</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/countrySelect.html">countrySelect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/createLink.html">createLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/createLinkTo.html">createLinkTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/currencySelect.html">currencySelect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/datePicker.html">datePicker</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/each.html">each</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/eachError.html">eachError</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/else.html">else</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/elseif.html">elseif</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/external.html">external</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/field.html">field</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/fieldValue.html">fieldValue</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/findAll.html">findAll</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/form.html">form</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/formRemote.html">formRemote</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/formatBoolean.html">formatBoolean</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/formatDate.html">formatDate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/formatNumber.html">formatNumber</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/grep.html">grep</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/hasErrors.html">hasErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/header.html">header</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/hiddenField.html">hiddenField</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/if.html">if</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/img.html">img</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/include.html">include</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/isAvailable.html">isAvailable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/isNotAvailable.html">isNotAvailable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/javascript.html">javascript</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/join.html">join</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/layoutBody.html">layoutBody</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/layoutHead.html">layoutHead</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/layoutTitle.html">layoutTitle</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/link.html">link</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/localeSelect.html">localeSelect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/message.html">message</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/meta.html">meta</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/pageProperty.html">pageProperty</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/paginate.html">paginate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/passwordField.html">passwordField</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/radio.html">radio</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/radioGroup.html">radioGroup</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/remoteField.html">remoteField</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/remoteFunction.html">remoteFunction</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/remoteLink.html">remoteLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/render.html">render</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/renderErrors.html">renderErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/resource.html">resource</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/select.html">select</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/set.html">set</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/setProvider.html">setProvider</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/sortableColumn.html">sortableColumn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/submitButton.html">submitButton</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/submitToRemote.html">submitToRemote</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/textArea.html">textArea</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/textField.html">textField</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/timeZoneSelect.html">timeZoneSelect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/unless.html">unless</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/uploadForm.html">uploadForm</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/while.html">while</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. <br/>[注意]このGrails日本語ドキュメントは、有志による翻訳というよりは意訳なドキュメントです。 Grails日本語ドキュメントに関するお問い合わせ、ドキュメントプロジェクトに参加したい等の問い合わせは。 twitter: @tyama 迄<br/>
            Sponsored by <a href="http://springsource.com">SpringSource</a> 
        </div>



<script type="text/javascript" src="../../js/docs.js"></script>

    </body>
</html>
