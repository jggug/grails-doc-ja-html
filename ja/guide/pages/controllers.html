<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>7.1 &#12467;&#12531;&#12488;&#12525;&#12540;&#12521; 2.3.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>&#12452;&#12531;&#12488;&#12525;&#12480;&#12463;&#12471;&#12519;&#12531;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>2</strong><span>&#12473;&#12479;&#12540;&#12488;&#12460;&#12452;&#12489;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/upgradingFromPreviousVersionsOfGrails.html"><strong>3</strong><span>Grails&#19979;&#20301;&#12496;&#12540;&#12472;&#12519;&#12531;&#12363;&#12425;&#12398;&#26356;&#26032;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/conf.html"><strong>4</strong><span>&#35373;&#23450;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/commandLine.html"><strong>5</strong><span>&#12467;&#12510;&#12531;&#12489;&#12521;&#12452;&#12531;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/GORM.html"><strong>6</strong><span>O/R&#12510;&#12483;&#12500;&#12531;&#12464; (GORM)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/theWebLayer.html"><strong>7</strong><span>Web&#12524;&#12452;&#12516;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/webServices.html"><strong>8</strong><span>Web&#12469;&#12540;&#12499;&#12473;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/async.html"><strong>9</strong><span>&#38750;&#21516;&#26399;&#12503;&#12525;&#12464;&#12521;&#12511;&#12531;&#12464;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/validation.html"><strong>10</strong><span>&#12496;&#12522;&#12487;&#12540;&#12471;&#12519;&#12531;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/services.html"><strong>11</strong><span>&#12469;&#12540;&#12499;&#12473;&#12524;&#12452;&#12516;&#12540;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/testing.html"><strong>12</strong><span>&#12486;&#12473;&#12488;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/i18n.html"><strong>13</strong><span>&#22269;&#38555;&#21270;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>14</strong><span>&#12475;&#12461;&#12517;&#12522;&#12486;&#12451;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/plugins.html"><strong>15</strong><span>&#12503;&#12521;&#12464;&#12452;&#12531;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/spring.html"><strong>16</strong><span>Grails&#12392;Spring</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/hibernate.html"><strong>17</strong><span>Grails&#12392;Hibernate</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/scaffolding.html"><strong>18</strong><span>&#12473;&#12459;&#12483;&#12501;&#12457;&#12523;&#12489;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/deployment.html"><strong>19</strong><span>&#12487;&#12503;&#12525;&#12452;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/contributing.html"><strong>20</strong><span>Grails&#12395;&#36002;&#29486;&#12377;&#12427;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/traslateReport.html"><strong>21</strong><span>&#32763;&#35379;&#12524;&#12509;&#12540;&#12488;</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        <span id="logo"><a href="http://grails.org" target="_blank"><img alt="Grails Logo" title="The Grails Framework" src="../../../img/grails.png" border="0"/></a></span>
        
        
        <span id="sponsor"><a href="http://springsource.com" target="_blank"><img alt="SpringSource Logo" title="SpringSource - Weapons for the War on Java Complexity" src="../../../img/springsource-logo.png" border="0"/></a></span>
        
    </div>
    <p>See the light - agile, industrial strength, rapid web application development made easy</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/GORM.html">&lt;&lt; <strong>6</strong><span>O/R&#12510;&#12483;&#12500;&#12531;&#12464; (GORM)</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/webServices.html"><strong>8</strong><span>Web&#12469;&#12540;&#12499;&#12473;</span> >></a></div>
                


                <div class="project">
                    <h1>7.1 &#12467;&#12531;&#12488;&#12525;&#12540;&#12521; - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Graeme Rocher, Peter Ledbrook, Marc Palmer, Jeff Brown, Luke Daley, Burt Beckwith</p>

                    <p><strong>Version:</strong> 2.3.0.BUILD-SNAPSHOT</p>

                    
                    <p><strong>Translated by:</strong> T.Yamamoto, Japanese Grails Doc Translating Team. Special thanks to NTT Software. <br/>【注意】このドキュメントの内容はスナップショットバージョンを元に*意訳*されているため、一部現行バージョンでは未対応の機能もあります。</p>
                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#understandingControllersAndActions"><strong>7.1</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12392;&#12450;&#12463;&#12471;&#12519;&#12531;&#12398;&#29702;&#35299;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#controllersAndScopes"><strong>7.2</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12392;&#12473;&#12467;&#12540;&#12503;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#modelsAndViews"><strong>7.3</strong><span>&#12514;&#12487;&#12523;&#12392;&#12499;&#12517;&#12540;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#redirectsAndChaining"><strong>7.4</strong><span>&#12522;&#12480;&#12452;&#12524;&#12463;&#12488;&#12392;&#12481;&#12455;&#12452;&#12531;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#interceptors"><strong>7.5</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12539;&#12452;&#12531;&#12479;&#12540;&#12475;&#12503;&#12479;&#12540;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#dataBinding"><strong>7.6</strong><span>&#12487;&#12540;&#12479;&#12496;&#12452;&#12531;&#12487;&#12451;&#12531;&#12464;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#xmlAndJSON"><strong>7.7</strong><span>XML&#12392;JSON&#12398;&#12524;&#12473;&#12509;&#12531;&#12473;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#moreOnJSONBuilder"><strong>7.8</strong><span>JSONBuilder (JSON&#12499;&#12523;&#12480;&#12540;)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#uploadingFiles"><strong>7.9</strong><span>&#12501;&#12449;&#12452;&#12523;&#12450;&#12483;&#12503;&#12525;&#12540;&#12489;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#commandObjects"><strong>7.10</strong><span>&#12467;&#12510;&#12531;&#12489;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#formtokens"><strong>7.11</strong><span>&#12501;&#12457;&#12540;&#12512;&#20108;&#37325;&#36865;&#20449;&#12398;&#12495;&#12531;&#12489;&#12522;&#12531;&#12464;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#typeConverters"><strong>7.12</strong><span>&#12471;&#12531;&#12503;&#12523;&#12479;&#12452;&#12503;&#12467;&#12531;&#12496;&#12540;&#12479;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#controllerExceptionHandling"><strong>7.13</strong><span>&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#20363;&#22806;&#12495;&#12531;&#12489;&#12522;&#12531;&#12464;&#23459;&#35328;</span></a>
                    </div>
                    
                </div>
                

                
<a name="7.1 Controllers"><!-- Legacy link --></a>
<h2 id="controllers">7.1 コントローラ</h2>
<div class="hidden-block">A controller handles requests and creates or prepares the response. A controller can generate the response directly or delegate to a view. To create a controller, simply create a class whose name ends with <code>Controller</code> in the <code>grails-app/controllers</code> directory (in a subdirectory if it's in a package).</div>
コントローラはリクエストを処理してレスポンスの準備・作成を行います。コントローラはレスポンスをビューに委譲したり、直接返す事ができます。単純に<code>grails-app/controlers</code>ディレクトリに、クラス名称の最後を<code>Controller</code>にしたクラスを作成することで、コントローラを追加できます。(パッケージに入れる場合は、パッケージ名のサブディレクトリに作成します。)<p class="paragraph"/><div class="hidden-block">The default <a href="../guide/single.html#urlmappings" class="guide">URL Mapping</a> configuration ensures that the first part of your controller name is mapped to a URI and each action defined within your controller maps to URIs within the controller name URI.</div>
<a href="../guide/single.html#urlmappings" class="guide">URL マッピング</a>のデフォルト設定では、Controllerの前に付けた名称がベースのURIにマップされ、コントローラに定義したそれぞれのアクション名称がコントローラ名称と繫がれてURIをマップします。


<a name="7.1.1 Understanding Controllers and Actions"><!-- Legacy link --></a>
<h2 id="understandingControllersAndActions">7.1.1 コントローラとアクションの理解</h2>
<h4>コントローラを作成する</h4><p class="paragraph"/><div class="hidden-block">Controllers can be created with the <a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a> or <a href="../ref/Command Line/generate-controller.html" class="commandLine">generate-controller</a> command. For example try running the following command from the root of a Grails project:</div>
<a href="../ref/Command Line/create-controller.html" class="commandLine">create-controller</a>または<a href="../ref/Command Line/generate-controller.html" class="commandLine">generate-controller</a>コマンドでコントローラが作成できます。Grailsプロジェクトのルートで以下のようにコマンドを実行します。<p class="paragraph"/><div class="code"><pre>grails create&#45;controller book</pre></div><p class="paragraph"/><div class="hidden-block">The command will create a controller at the location <code>grails-app/controllers/myapp/BookController.groovy</code>:</div>
コマンドを実行すると<code>grails-app/controllers/myapp/BookController.groovy</code>にコントローラを生成します。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> myapp<p class="paragraph"/>class BookController &#123;<p class="paragraph"/>    def index() &#123; &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">where "myapp" will be the name of your application, the default package name if one isn't specified.</div>
パッケージ名を指定しない場合は、"myapp"というアプリケーション名であれば、自動的にデフォルトパッケージとして生成されます。<p class="paragraph"/><div class="hidden-block"><code>BookController</code> by default maps to the /book URI (relative to your application root).</div>
デフォルトでは、<code>BookController</code>は、URIが /bookとなります。(アプリケーションのコンテキストルートからの相対パス)<p class="paragraph"/><div class="hidden-block"><blockquote class="note">
The <code>create-controller</code> and <code>generate-controller</code> commands are just for convenience and you can just as easily create controllers using your favorite text editor or IDE
<code>create-controller</code>と<code>generate-controller</code>コマンドは、簡単にコントローラを生成する便利なコマンドですが、IDEやテキストエディタの機能でクラスを作成してもかまいません。
</blockquote></div>
<blockquote class="note">
<code>create-controller</code>と<code>generate-controller</code>コマンドは、簡単にコントローラを生成する便利なコマンドですが、IDEやテキストエディタの機能でクラスを作成してもかまいません。
</blockquote><p class="paragraph"/><h4>アクションの作成</h4><p class="paragraph"/><div class="hidden-block">A controller can have multiple public action methods; each one maps to a URI:</div>
コントローラは複数のアクションメソッドを持つことができます。それぞれURIにマップされます:<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    def list() &#123;<p class="paragraph"/>        // <span class="java&#45;keyword">do</span> controller logic
        // create model<p class="paragraph"/>        <span class="java&#45;keyword">return</span> model
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This example maps to the <code>/book/list</code> URI by default thanks to the property being named <code>list</code>.</div>
この例では、アクションメソッド名が<code>list</code>なので、URIは<code>/book/list</code>にマップされます。<p class="paragraph"/><h4>パブリックメソッドをアクションとする</h4><p class="paragraph"/><div class="hidden-block">In earlier versions of Grails actions were implemented with Closures. This is still supported, but the preferred approach is to use methods.</div>
以前のバージョンまでは、アクションがクロージャで実装されてました。この方式はまだサポートされています。ただし今後のアクションの実装はメソッドを使用することを推奨します。<p class="paragraph"/><div class="hidden-block">Leveraging methods instead of Closure properties has some advantages:</div>
クロージャではなく、メソッドにすることによって以下の利点があります:
<div class="hidden-block">
<ul class="star">
<li>Memory efficient</li>
<li>Allow use of stateless controllers (<code>singleton</code> scope)</li>
<li>You can override actions from subclasses and call the overridden superclass method with <code>super.actionName()</code></li>
<li>Methods can be intercepted with standard proxying mechanisms, something that is complicated to do with Closures since they're fields.</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>メモリ効率</li>
<li>ステートレスコントローラの使用 (<code>シングルトンスコープ</code>指定)</li>
<li>サブクラスでのアクションのオーバーライドが可能。スーパークラスのアクションメソッド呼び出しが可能。<code>super.actionName()</code></li>
<li>クロージャはフィールドのため複雑だった、スタンダードなプロキシを使用したメソッドのインターセプトが可能。</li>
</ul><p class="paragraph"/><div class="hidden-block">If you prefer the Closure syntax or have older controller classes created in earlier versions of Grails and still want the advantages of using methods, you can set the <code>grails.compile.artefacts.closures.convert</code> property to true in <code>BuildConfig.groovy</code>:</div>
クロージャを使用したい場合や、旧バージョンで作られたコントローラを使用しながら、メソッドの利点も欲しい場合は、<code>BuildConfig.groovy</code>に、 <code>grails.compile.artefacts.closures.convert</code>を定義します:
<div class="code"><pre>grails.compile.artefacts.closures.convert = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/><div class="hidden-block">and a compile-time AST transformation will convert your Closures to methods in the generated bytecode.</div>
この定義をすることで、AST変換を使用してクロージャをメソッドに変換したバイトコードを生成します。<p class="paragraph"/><blockquote class="note">
If a controller class extends some other class which is not defined under the <code>grails-app/controllers/</code> directory, methods inherited from that class are not converted to controller actions.  If the intent is to expose those inherited methods as controller actions the methods may be overridden in the subclass and the subclass method may invoke the method in the super class.
</blockquote><p class="paragraph"/><h4>デフォルトアクション</h4><p class="paragraph"/><div class="hidden-block">A controller has the concept of a default URI that maps to the root URI of the controller, for example <code>/book</code> for <code>BookController</code>. The action that is called when the default URI is requested is dictated by the following rules:</div>
コントローラのルートURIににデフォルトURIをマップする概念をもっています。例として<code>BookController</code>の場合は <code>/book</code>になります。デフォルトURIが呼ばれたときに呼ばれるアクションは以下のルールになっています:
<div class="hidden-block">
<ul class="star">
<li>If there is only one action, it's the default</li>
<li>If you have an action named <code>index</code>, it's the default</li>
<li>Alternatively you can set it explicitly with the <code>defaultAction</code> property:</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li>アクションが１つの場合は、それがデフォルトになります。</li>
<li><code>index</code>という名称のアクションがある場合は、それがデフォルトになります。</li>
<li><code>defaultAction</code>を定義して指定できます。</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> defaultAction = <span class="java&#45;quote">"list"</span></pre></div>


<a name="7.1.2 Controllers and Scopes"><!-- Legacy link --></a>
<h2 id="controllersAndScopes">7.1.2 コントローラとスコープ</h2>
<h4>使用可能なスコープ</h4><p class="paragraph"/><div class="hidden-block">Scopes are hash-like objects where you can store variables. The following scopes are available to controllers:</div>
スコープは、変数を収納可能なハッシュのようなオブジェクトです。コントローラでは、次のスコープが使用可能です。
<div class="hidden-block">
<ul class="star">
<li><a href="../ref/Controllers/servletContext.html" class="controllers">servletContext</a> - Also known as application scope, this scope lets you share state across the entire web application. The servletContext is an instance of <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">ServletContext</a></li>
<li><a href="../ref/Controllers/session.html" class="controllers">session</a> - The session allows associating state with a given user and typically uses cookies to associate a session with a client. The session object is an instance of <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a></li>
<li><a href="../ref/Controllers/request.html" class="controllers">request</a> - The request object allows the storage of objects for the current request only. The request object is an instance of <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a></li>
<li><a href="../ref/Controllers/params.html" class="controllers">params</a> - Mutable map of incoming request query string or POST parameters</li>
<li><a href="../ref/Controllers/flash.html" class="controllers">flash</a> - See below</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><a href="../ref/Controllers/servletContext.html" class="controllers">servletContext</a> - webアプリケーションの全体にわたってスコープを共有するアプリケーションスコープです。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/ServletContext.html" class="api">ServletContext</a>のインスタンスです。</li>
<li><a href="../ref/Controllers/session.html" class="controllers">session</a> - セッションは、通常クッキーを使用してリクエストを行ったクライアントとの連携をして、ステートを保持します。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpSession.html" class="api">HttpSession</a>のインスタンスです。</li>
<li><a href="../ref/Controllers/request.html" class="controllers">request</a> - リクエストオブジェクトはリクエスト時のみオブジェクトを保持するオブジェクトです。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>のインスタンスです。</li>
<li><a href="../ref/Controllers/params.html" class="controllers">params</a> - 受け取ったリクエストクエリー文字列または、POSTパラメータを保持するミュータブルマップです。</li>
<li><a href="../ref/Controllers/flash.html" class="controllers">flash</a> - 以下を参照</li>
</ul><p class="paragraph"/><h4>スコープへのアクセス</h4><p class="paragraph"/><div class="hidden-block">Scopes can be accessed using the variable names above in combination with Groovy's array index operator, even on classes provided by the Servlet API such as the <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>:</div>
以下のようにスコープはGroovyの配列インデクスオペレータで、変数の名称を指定して参照することができます。<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletRequest.html" class="api">HttpServletRequest</a>にあるような、Servlet APIの提供する変数に関しても同じようにアクセスできます<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def find() &#123;
        def findBy = params&#91;<span class="java&#45;quote">"findBy"</span>&#93;
        def appContext = request&#91;<span class="java&#45;quote">"foo"</span>&#93;
        def loggedUser = session&#91;<span class="java&#45;quote">"logged_user"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also access values within scopes using the de-reference operator, making the syntax even more clear:</div>
フィールド参照オペレータを使用してスコープの変数を参照すれば、シンタックスもっと簡潔にすることもできます:<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def find() &#123;
        def findBy = params.findBy
        def appContext = request.foo
        def loggedUser = session.logged_user
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is one of the ways that Grails unifies access to the different scopes.</div>
これはGrailsでの、様々なスコープにアクセスする一例です。<p class="paragraph"/><h4>フラッシュスコープを使用する</h4><p class="paragraph"/><div class="hidden-block">Grails supports the concept of <a href="../ref/Controllers/flash.html" class="controllers">flash</a> scope as a temporary store to make attributes available for this request and the next request only. Afterwards the attributes are cleared. This is useful for setting a message directly before redirecting, for example:</div>
Grailsは、今回のリクエストと次のリクエストのみで値を一時的に保持する <a href="../ref/Controllers/flash.html" class="controllers">flash</a>スコープをサポートしています。保持された内容は自動的に削除されます。リダイレクト等を行う前にメッセージを残す時などに使用できます。以下が例です。<p class="paragraph"/><div class="code"><pre>def delete() &#123;
    def b = Book.get(params.id)
    <span class="java&#45;keyword">if</span> (!b) &#123;
        flash.message = <span class="java&#45;quote">"User not found <span class="java&#45;keyword">for</span> id $&#123;params.id&#125;"</span>
        redirect(action:list)
    &#125;
    &#8230; // remaining code
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">When the <code>list</code> action is requested, the <code>message</code> value will be in scope and can be used to display an information message. It will be removed from the <code>flash</code> scope after this second request.</div>
この例では、<code>delete</code>アクションに対してリクエストをすると、リダイレクトされて<code>list</code>アクションが実行された際に、flashスコープの<code>message</code>に代入した内容がメッセージ表示等に使用可能になります。このリダイレクトされた<code>list</code>アクション(<code>delete</code>の次のアクション)の処理が終了したら、<code>flash</code>スコープの内容が削除されます。<p class="paragraph"/><div class="hidden-block">Note that the attribute name can be anything you want, and the values are often strings used to display messages, but can be any object type.</div>
メッセージ表示などで文字列型が頻繁に使用されますが、flashスコープに一時的に保持する値は、どのようなオブジェクトでもかまいません。<p class="paragraph"/><div class="hidden-block">h4. Scoped Controllers</div>
<h4>コントローラのスコープ</h4><p class="paragraph"/><div class="hidden-block">Supported controller scopes are:</div>
サポートされているコントローラスコープは:
<div class="hidden-block">
<ul class="star">
<li><code>prototype</code> (default) - A new controller will be created for each request (recommended for actions as Closure properties)</li>
<li><code>session</code> - One controller is created for the scope of a user session</li>
<li><code>singleton</code> - Only one instance of the controller ever exists (recommended for actions as methods)</li>
</ul><p class="paragraph"/></div>
<ul class="star">
<li><code>prototype</code> (デフォルト) - リクエスト毎にコントローラが生成されます。(クロージャでアクションを推奨)</li>
<li><code>session</code> - ユーザのセッションを通して1個のコントローラが生成されます。</li>
<li><code>singleton</code> -  1個のコントローラのみが存在する状態です。(メソッドでのアクションをお勧めします)</li>
</ul><p class="paragraph"/><div class="hidden-block">To enable one of the scopes, add a static <code>scope</code> property to your class with one of the valid scope values listed above, for example</div>
スコープを定義するには、コントローラクラスに、static scope 変数で指定したいスコープを定義します。以下が例になります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> scope = <span class="java&#45;quote">"singleton"</span></pre></div><p class="paragraph"/><div class="hidden-block">You can define the default strategy under in <code>Config.groovy</code> with the <code>grails.controllers.defaultScope</code> key, for example:</div>
デフォルトスコープは、<code>Config.groovy</code>に<code>grails.controllers.defaultScope</code>を指定する事で変更できます。<p class="paragraph"/><div class="code"><pre>grails.controllers.defaultScope = <span class="java&#45;quote">"singleton"</span></pre></div><p class="paragraph"/>Newly created applications have the <code>grails.controllers.defaultScope</code> property set in <code>grails-app/conf/Config.groovy</code> with a value of "singleton".  You may change this value to any
of the supported scopes listed above.  If the property is not assigned a value at all, controllers will default to "prototype" scope.<p class="paragraph"/>
<div class="hidden-block">
<blockquote class="note">
Use scoped controllers wisely. For instance, we don't recommend having any properties in a singleton-scoped controller since they will be shared for  <em class="italic">all</em>  requests. Setting a default scope other than <code>prototype</code> may also lead to unexpected behaviors if you have controllers provided by installed plugins that expect that the scope is <code>prototype</code>.
</blockquote>
</div>
<blockquote class="note">
コントローラのスコープは使用状況を考えてお使いください。例えば、シングルトンのコントローラは、_全ての_リクエストで共有されるためプロパティを持つべきではありません。デフォルトで定義されているスコープの<code>prototype</code> を変更することで、プラグインなどで提供されたコントローラが<code>protopype</code>を前提で実装されている場合があるので注意しましょう
</blockquote>


<a name="7.1.3 Models and Views"><!-- Legacy link --></a>
<h2 id="modelsAndViews">7.1.3 モデルとビュー</h2>
<h4>モデルを返す</h4><p class="paragraph"/><div class="hidden-block">A model is a Map that the view uses when rendering. The keys within that Map correspond to variable names accessible by the view. There are a couple of ways to return a model. First, you can explicitly return a Map instance:</div>
モデルはビューを描写する際に使用するMapインスタンスです。ビュー内でMapのキーに一致する変数名が使用できます。モデルを返すには、数種類の方法があります。先ずはじめにMapインスタンスを明示的に返す方法です。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    &#91;book: Book.get(params.id)&#93;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">The above does  <em class="italic">not</em>  reflect what you should use with the scaffolding views - see the <a href="../guide/single.html#scaffolding" class="guide">scaffolding section</a> for more details.</div>
上記の例はスカッフォルドのビューで使用する例ではありません。スカッフォルドに関しては、スカッフォルドのセクションを参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">If no explicit model is returned the controller's properties will be used as the model, thus allowing you to write code like this:</div>
以下の例のように、明示的にモデルを返さない場合は、コントローラのプロパティがモデルとして使用されます。<p class="paragraph"/><div class="code"><pre>class BookController &#123;<p class="paragraph"/>    List books
    List authors<p class="paragraph"/>    def list() &#123;
        books = Book.list()
        authors = Author.list()
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">This is possible due to the fact that controllers are prototype scoped. In other words a new controller is created for each request. Otherwise code such as the above would not be thread-safe, and all users would share the same data.</div>
これはコントローラのスコープがprototype(リクエスト毎にコントローラが生成される)の場合に可能な方法です。他の場合はスレッドセーフではありません。
</blockquote><p class="paragraph"/><div class="hidden-block">In the above example the <code>books</code> and <code>authors</code> properties will be available in the view.</div>
上記の例では、 プロパティの<code>book</code>と<code>authors</code>がビューで参照できます。<p class="paragraph"/><div class="hidden-block">A more advanced approach is to return an instance of the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a> class:</div>
上級者向けのアプローチとしては、Springの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a>インスタンスを返す方法があります。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.web.servlet.ModelAndView<p class="paragraph"/>def index() &#123;
    // get some books just <span class="java&#45;keyword">for</span> the index page, perhaps your favorites
    def favoriteBooks = ...<p class="paragraph"/>    // forward to the list view to show them
    <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">new</span> ModelAndView(<span class="java&#45;quote">"/book/list"</span>, &#91; bookList : favoriteBooks &#93;)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">One thing to bear in mind is that certain variable names can not be used in your model:</div>
一つ覚えておいて欲しいのが、一定の変数名が、モデル使用できないという事です。
<ul class="star">
<li><code>attributes</code></li>
<li><code>application</code></li>
</ul><p class="paragraph"/><div class="hidden-block">Currently, no error will be reported if you do use them, but this will hopefully change in a future version of Grails.</div>
現状では使用したとしてもエラーが出ることはありませんが、将来的には変わるかもしれません。<p class="paragraph"/><h4>ビューの選択<div class="hidden-block">Selecting the View </div></h4><p class="paragraph"/><div class="hidden-block">In both of the previous two examples there was no code that specified which <a href="../guide/single.html#gsp" class="guide">view</a> to render. So how does Grails know which one to pick? The answer lies in the conventions. Grails will look for a view at the location <code>grails-app/views/book/show.gsp</code> for this <code>show</code> action:</div>
これまでの例ではビューがどのように設定されるのかを説明しませんでたが、Grailsではどのようにビューを選択しているのでしょうか？答えは慣習にあります。何も指定しなければ、以下のアクションでは、Grailsが自動的に、<code>grails-app/views/book/show.gsp</code>をビューとして使用します。<p class="paragraph"/><div class="code"><pre>class BookController &#123;
    def show() &#123;
         &#91;book: Book.get(params.id)&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">To render a different view, use the <a href="../ref/Controllers/render.html" class="controllers">render</a> method:</div>
別のビューを描写する場合は、<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッドで指定します。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    def map = &#91;book: Book.get(params.id)&#93;
    render(view: <span class="java&#45;quote">"display"</span>, model: map)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case Grails will attempt to render a view at the location <code>grails-app/views/book/display.gsp</code>. Notice that Grails automatically qualifies the view location with the <code>book</code> directory of the <code>grails-app/views</code> directory. This is convenient, but to access shared views you need instead you can use an absolute path instead of a relative one:</div>
上記の例では、<code>grails-app/views/book/display.gsp</code>の描写を試みます。注目する場所はGrailsは自動的にコントローラが<code>book</code>であれば、<code>grails-app/views</code>ディレクトリの<code>book</code>ディレクトリを、指定しなくても取得する所です。これは便利なのですが、ビューを共有する場合は、パスを指定する必要があります。<p class="paragraph"/><div class="code"><pre>def show() &#123;
    def map = &#91;book: Book.get(params.id)&#93;
    render(view: <span class="java&#45;quote">"/shared/display"</span>, model: map)
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case Grails will attempt to render a view at the location <code>grails-app/views/shared/display.gsp</code>.</div>
上記の例では、<code>grails-app/views/shared/display.gsp</code>の描写を試みます。<p class="paragraph"/><div class="hidden-block">Grails also supports JSPs as views, so if a GSP isn't found in the expected location but a JSP is, it will be used instead.</div>
Grailsでは、ビューにJSPもサポートしています。これによって、参照したパスにGSPが存在しない場合は、JSPが代わりに使用されます。<p class="paragraph"/><h4>レスポンスの描写</h4><p class="paragraph"/><div class="hidden-block">Sometimes it's easier (for example with Ajax applications) to render snippets of text or code to the response directly from the controller. For this, the highly flexible <code>render</code> method can be used:</div>
直接文字列をコントローラからレスポンス(例としてAjaxアプリケーションなど)したい場合、とてもフレキシブルな<code>render</code>メソッドを使うと簡単にできます。<p class="paragraph"/><div class="code"><pre>render <span class="java&#45;quote">"Hello World!"</span></pre></div><p class="paragraph"/><div class="hidden-block">The above code writes the text "Hello World!" to the response. Other examples include:</div>
上記の例ではレスポンスに"Hello World!"を返します。他の例として:<p class="paragraph"/><div class="hidden-block">
// write some markup
// render a specific view
// render a template for each item in a collection
// render some text with encoding and content type
</div><p class="paragraph"/><div class="code"><pre>// マークアップを返す
render &#123;
   <span class="java&#45;keyword">for</span> (b in books) &#123;
      div(id: b.id, b.title)
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// 指定したビューを描写
render(view: 'show')</pre></div><p class="paragraph"/><div class="code"><pre>// コレクションの中身をそれぞれ指定したテンプレートを適応して描写
render(template: 'book_template', collection: Book.list())</pre></div><p class="paragraph"/><div class="code"><pre>// 文字列を指定したエンコーディングとコンテントタイプで描写
render(text: <span class="java&#45;quote">"&#60;xml&#62;some xml&#60;/xml&#62;"</span>, contentType: <span class="java&#45;quote">"text/xml"</span>, encoding: <span class="java&#45;quote">"UTF&#45;8"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">If you plan on using Groovy's <code>MarkupBuilder</code> to generate HTML for use with the <code>render</code> method be careful of naming clashes between HTML elements and Grails tags, for example:</div>
<code>render</code>メソッドでGroovyの<code>MarkupBuilder</code>を使用してHTMLを生成する場合は、HTMLエレメント名とGrailsタグとの名称衝突を気をつけましょう。(Grailsのタグはアクション内部でメソッドとして使用できるため)<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> groovy.xml.MarkupBuilder
&#8230;
def login() &#123;
    def writer = <span class="java&#45;keyword">new</span> StringWriter()
    def builder = <span class="java&#45;keyword">new</span> MarkupBuilder(writer)
    builder.html &#123;
        head &#123;
            title 'Log in'
        &#125;
        body &#123;
            h1 'Hello'
            form &#123;
            &#125;
        &#125;
    &#125;<p class="paragraph"/>    def html = writer.toString()
    render html
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will actually <a href="../guide/single.html#tagsAsMethodCalls" class="guide">call the form tag</a> (which will return some text that will be ignored by the <code>MarkupBuilder</code>). To correctly output a <code>&#60;form&#62;</code> element, use the following:</div>
上記の例ではformの場所にform<a href="../guide/single.html#tagsAsMethodCalls" class="guide">タグが呼ばれて</a>しまいます。これを回避して<code>&#60;form&#62;</code>タグを正常に生成するには、以下のように<code>builder.form</code>とします。<p class="paragraph"/><div class="code"><pre>def login() &#123;
    // &#8230;
    body &#123;
        h1 'Hello'
        builder.form &#123;
        &#125;
    &#125;
    // &#8230;
&#125;</pre></div>


<a name="7.1.4 Redirects and Chaining"><!-- Legacy link --></a>
<h2 id="redirectsAndChaining">7.1.4 リダイレクトとチェイン</h2>
<h4>リダイレクト<div class="hidden-block">Redirects</div></h4><p class="paragraph"/><div class="hidden-block">Actions can be redirected using the <a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> controller method:</div>
コントローラのメソッド、<a href="../ref/Controllers/redirect.html" class="controllers">redirect</a>を使用して、アクションをリダイレクトすることができます:<p class="paragraph"/><div class="code"><pre>class OverviewController &#123;<p class="paragraph"/>    def login() &#123;&#125;<p class="paragraph"/>    def find() &#123;
        <span class="java&#45;keyword">if</span> (!session.user)
            redirect(action: 'login')
            <span class="java&#45;keyword">return</span>
        &#125;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Internally the <a href="../ref/Controllers/redirect.html" class="controllers">redirect</a> method uses the <a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a> object's <code>sendRedirect</code> method.</div>
<a href="../ref/Controllers/redirect.html" class="controllers">redirect</a>メソッドは内部的に<a href="http://download.oracle.com/javaee/1.4/api/javax/servlet/http/HttpServletResponse.html" class="api">HttpServletResponse</a>オブジェクトの<code>sendRedirect</code>メソッドを使用しています。<p class="paragraph"/><div class="hidden-block">The <code>redirect</code> method expects one of:</div>
<code>redirect</code>メソッドでは以下のいずれかのように使用します:<p class="paragraph"/><div class="hidden-block">* Another closure within the same controller class:</div>
*同じコントローラ内のアクションクロージャ(プロパティで)の指定:<p class="paragraph"/><div class="code"><pre>// Call the login action within the same class
redirect(action: login)</pre></div><p class="paragraph"/><div class="hidden-block">* The name of an action (and controller name if the redirect isn't to an action in the current controller):</div>
<ul class="star">
<li>アクション名称でのしていと、別のコントローラのアクションの場合はコントローラの指定:</li>
</ul><p class="paragraph"/><div class="code"><pre>// Also redirects to the index action in the home controller
redirect(controller: 'home', action: 'index')</pre></div><p class="paragraph"/><div class="hidden-block">*  A URI for a resource relative the application context path:</div>
<ul class="star">
<li>アプリケーションコンテキストパス内のリソースのURI:</li>
</ul><p class="paragraph"/><div class="code"><pre>// Redirect to an explicit URI
redirect(uri: <span class="java&#45;quote">"/login.html"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">* Or a full URL:</div>
<ul class="star">
<li>URLを全指定:</li>
</ul><p class="paragraph"/><div class="code"><pre>// Redirect to a URL
redirect(url: <span class="java&#45;quote">"http://grails.org"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">Parameters can optionally be passed from one action to the next using the <code>params</code> argument of the method:</div>
メソッドのparams引数をにパラメータを指定することで、アクションへのパラメータを渡せます:<p class="paragraph"/><div class="code"><pre>redirect(action: 'myaction', params: &#91;myparam: <span class="java&#45;quote">"myvalue"</span>&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">These parameters are made available through the <a href="../ref/Controllers/params.html" class="controllers">params</a> dynamic property that accesses request parameters. If a parameter is specified with the same name as a request parameter, the request parameter is overridden and the controller parameter is used.</div>
これらのパラメータは、アクセス時のリクエストパラメータの<a href="../ref/Controllers/params.html" class="controllers">params</a>プロパティから参照できるようになります。もしリクエストと同じパラメータを指定した場合は、パラメータは上書きされます。<p class="paragraph"/><div class="hidden-block">Since the <code>params</code> object is a Map, you can use it to pass the current request parameters from one action to the next:</div>
<code>params</code>オブジェクトはMapなので、以下のように、そのまま全てのリクエストパラメータを次のアクションに渡すことができます:<p class="paragraph"/><div class="code"><pre>redirect(action: <span class="java&#45;quote">"next"</span>, params: params)</pre></div><p class="paragraph"/><div class="hidden-block">Finally, you can also include a fragment in the target URI:</div>
ターゲットURIに、フラグメントを含めることもできます:<p class="paragraph"/><div class="code"><pre>redirect(controller: <span class="java&#45;quote">"test"</span>, action: <span class="java&#45;quote">"show"</span>, fragment: <span class="java&#45;quote">"profile"</span>)</pre></div><p class="paragraph"/><div class="hidden-block">which will (depending on the URL mappings) redirect to something like "/myapp/test/show#profile".</div>
この例では(URLマッピング定義によりますが)、リダイレクトは"/myapp/test/show#profile"になります。<p class="paragraph"/><h4>チェイニング <div class="hidden-block">Chaining </div></h4><p class="paragraph"/><div class="hidden-block">Actions can also be chained. Chaining allows the model to be retained from one action to the next. For example calling the <code>first</code> action in this action:</div>
アクションのチェインが可能です。チェインではアクションからアクションへのモデル参照が可能です。以下の例でアクション<code>first</code>を呼び出します:<p class="paragraph"/><div class="code"><pre>class ExampleChainController &#123;<p class="paragraph"/>    def first() &#123;
        chain(action: second, model: &#91;one: 1&#93;)
    &#125;<p class="paragraph"/>    def second () &#123;
        chain(action: third, model: &#91;two: 2&#93;)
    &#125;<p class="paragraph"/>    def third() &#123;
        &#91;three: 3&#93;)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">results in the model:</div>
結果モデルは以下のようになります:<p class="paragraph"/><div class="code"><pre>&#91;one: 1, two: 2, three: 3&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The model can be accessed in subsequent controller actions in the chain using the <code>chainModel</code> map. This dynamic property only exists in actions following the call to the <code>chain</code> method:</div>
途中でコントローラアクションからモデルにアクセスするには、chainModelマップを使用します。この動的プロパティはchainメソッドから呼ばれた時のみに存在します。<p class="paragraph"/><div class="code"><pre>class ChainController &#123;<p class="paragraph"/>    def nextInChain() &#123;
        def model = chainModel.myModel
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Like the <code>redirect</code> method you can also pass parameters to the <code>chain</code> method:</div>
<code>redirect</code>メソッドと同じように、<code>chain</code>メソッドにパラメータを渡すこともできます:<p class="paragraph"/><div class="code"><pre>chain(action: <span class="java&#45;quote">"action1"</span>, model: &#91;one: 1&#93;, params: &#91;myparam: <span class="java&#45;quote">"param1"</span>&#93;)</pre></div>


<a name="7.1.5 Controller Interceptors"><!-- Legacy link --></a>
<h2 id="interceptors">7.1.5 コントローラ・インターセプター</h2>
<div class="hidden-block">Often it is useful to intercept processing based on either request, session or application state. This can be achieved with action interceptors. There are currently two types of interceptors: before and after.</div>
リクエスト、セッションまたはアプリケーションで処理のインターセプトができると、たいへん役に立ちます。これはアクションインターセプターで達成できます。現在2種類のインターセプターbeforeとafterがあります。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">If your interceptor is likely to apply to more than one controller, you are almost certainly better off writing a <a href="../guide/single.html#filters" class="guide">Filter</a>. Filters can be applied to multiple controllers or URIs without the need to change the logic of each controller </div>
複数のコントローラにインターセプターを反映させたい場合は、<a href="../guide/single.html#filters" class="guide">Filter</a>を使用することをお勧めします。Filterは多数のコントローラまたはURIに、ロジックを追加すること無く反映できます。
</blockquote><p class="paragraph"/><h4>ビフォア・インターセプション<div class="hidden-block">Before Interception </div></h4><p class="paragraph"/><div class="hidden-block">The <code>beforeInterceptor</code> intercepts processing before the action is executed. If it returns <code>false</code> then the intercepted action will not be executed. The interceptor can be defined for all actions in a controller as follows:</div>
<code>beforeInterceptor</code>は、アクションが実行される前に処理の追加を行うことができます。<code>beforeInterceptor</code>で、<code>false</code>を返すとアクションは実行されません。コントローラ内の全てのアクションにインターセプターを定義するには以下のようにします。<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#123;
    println <span class="java&#45;quote">"Tracing action $&#123;actionUri&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above is declared inside the body of the controller definition.  It will be executed before all actions and does not interfere with processing. A common use case is very simplistic authentication:</div>
上記はコントローラ内部に設定します。全てのアクションの前に実行され処理を干渉することはありません。
他によくある実装例としては簡単な認証などです:<p class="paragraph"/>
<div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, except: 'login'&#93;<p class="paragraph"/>// defined with <span class="java&#45;keyword">private</span> scope, so it's not considered an action
<span class="java&#45;keyword">private</span> auth() &#123;
    <span class="java&#45;keyword">if</span> (!session.user) &#123;
        redirect(action: 'login')
        <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
    &#125;
&#125;<p class="paragraph"/>def login() &#123;
    // display login page
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above code defines a method called <code>auth</code>. A private method is used so that it is not exposed as an action to the outside world. The <code>beforeInterceptor</code> then defines an interceptor that is used on all actions  <em class="italic">except</em>  the login action and it executes the <code>auth</code> method. The <code>auth</code> method is referenced using Groovy's method pointer syntax. Within the method it detects whether there is a user in the session, and if not it redirects to the <code>login</code> action and returns <code>false</code>, causing the intercepted action to not be processed.</div>
上記の例では先ず、<code>auth</code>メソッドを定義します。外部にアクションとして認識されないように<code>private</code>メソッドにします。
今回は、アクション名が<code>login</code>以外の全てのアクションで実行されるように、実行するメソッドをaction:に指定し、除外するアクション'login'を except:に指定して、<code>beforeInterceptor</code>を定義します。<code>auth</code>メソッドはGroovyのメソッドポインターシンタックスで指定します。これで、<code>auth</code>の処理によって、sessionにuser変数が見つからなかった場合は'login'アクションへリダイレクトして<code>false</code>を返しアクションを実行しないインターセプターが行えます。<p class="paragraph"/>
<h4>アフター・インターセプション <div class="hidden-block">After Interception </div></h4><p class="paragraph"/><div class="hidden-block">Use the <code>afterInterceptor</code> property to define an interceptor that is executed after an action:</div>
<code>afterInterceptor</code>は、アクションが実行される後に処理の追加を行うことができます:<p class="paragraph"/><div class="code"><pre>def afterInterceptor = &#123; model &#45;&#62;
    println <span class="java&#45;quote">"Tracing action $&#123;actionUri&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The after interceptor takes the resulting model as an argument and can hence manipulate the model or response.</div>
アフター・インターセプターでは、処理結果のモデルを引数として取得して、モデルやレスポンスを操作することができます。<p class="paragraph"/><div class="hidden-block">An after interceptor may also modify the Spring MVC <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a> object prior to rendering. In this case, the above example becomes:</div>
描写直前のSpring MVCの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/servlet/ModelAndView.html" class="api">ModelAndView</a>も取得して変更することも可能です。以下のケースでは、前の例に追記すると:<p class="paragraph"/><div class="code"><pre>def afterInterceptor = &#123; model, modelAndView &#45;&#62;
    println <span class="java&#45;quote">"Current view is $&#123;modelAndView.viewName&#125;"</span>
    <span class="java&#45;keyword">if</span> (model.someVar) modelAndView.viewName = <span class="java&#45;quote">"/mycontroller/someotherview"</span>
    println <span class="java&#45;quote">"View is now $&#123;modelAndView.viewName&#125;"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This allows the view to be changed based on the model returned by the current action. Note that the <code>modelAndView</code> may be <code>null</code> if the action being intercepted called <code>redirect</code> or <code>render</code>.</div>
この例では返されたモデルの内容を元にビューを変更しています。インターセプトされた、アクションが<code>redirect</code>や<code>render</code>を呼び出している場合は、<code>modelANdView</code>は<code>null</code>になります。<p class="paragraph"/><h4>インターセプションの条件指定 <div class="hidden-block">Interception Conditions </div></h4><p class="paragraph"/><div class="hidden-block">Rails users will be familiar with the authentication example and how the 'except' condition was used when executing the interceptor (interceptors are called 'filters' in Rails; this terminology conflicts with Servlet filter terminology in Java):</div>
'excepr'条件は、Railsユーザにとってインターセプターを使う時はお馴染みだと思います。(Railsではインターセプターはフィルターと呼ばれています。Javaでは用語的にサーブレットフィルターと衝突するのでインターセプターとしています)<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, except: 'login'&#93;</pre></div><p class="paragraph"/><div class="hidden-block">This executes the interceptor for all actions except the specified action. A list of actions can also be defined as follows:</div>
上記の例では、exceptで指定したアクション以外でインターセプターを実行します。次のように、複数指定する場合はリストで指定します:<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, except: &#91;'login', 'register'&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The other supported condition is 'only', this executes the interceptor for only the specified action(s):</div>
指定したアクションのみでインターセプターを実行する場合は、'only'を使用します:<p class="paragraph"/><div class="code"><pre>def beforeInterceptor = &#91;action: <span class="java&#45;keyword">this</span>.&#38;auth, only: &#91;'secure'&#93;&#93;</pre></div>


<a name="7.1.6 Data Binding"><!-- Legacy link --></a>
<h2 id="dataBinding">7.1.6 データバインディング</h2>
<div class="hidden-block">Data binding is the act of "binding" incoming request parameters onto the properties of an object or an entire graph of objects. Data binding should deal with all necessary type conversion since request parameters, which are typically delivered by a form submission, are always strings whilst the properties of a Groovy or Java object may well not be.</div>
データバインディングとは、受信したリクエストパラメータを、オブジェクトのプロパティやオブジェクト構造へ結合させる機能です。データバインディングでは、フォームから送信された文字列のリクエストパラメータを必要な型へに変換します。<p class="paragraph"/><div class="hidden-block">h4. Map Based Binding</div>
<h4>マップを用いたバインディング</h4><p class="paragraph"/><div class="hidden-block">The data binder is capable of converting and assigning values in a Map to properties of an object.  The binder will associate entries in the Map to properties of the object using the keys in the Map that have values which correspond to property names on the object.  The following code demonstrates the basics:</div>
データバインダは、マップの値を変換してオブジェクトのプロパティに代入します。
バインダは、オブジェクトのプロパティ名に一致するマップのキーを使って、マップのエントリをオブジェクトのプロパティに結びつけます。
以下のコードはその基本形を示します:<p class="paragraph"/><div class="code"><pre>// grails&#45;app/domain/Person.groovy
class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">Integer</span> age
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;firstName: 'Peter', lastName: 'Gabriel', age: 63&#93;<p class="paragraph"/>def person = <span class="java&#45;keyword">new</span> Person(bindingMap)<p class="paragraph"/>assert person.firstName == 'Peter'
assert person.lastNaem == 'Gabriel'
assert person.age == 63</pre></div><p class="paragraph"/><div class="hidden-block">To update properties of a domain object you may assign a Map to the <code>properties</code> property of the domain class:</div>
ドメインオブジェクトのプロパティを更新するために、そのドメインクラスの<code>properties</code>プロパティにマップを代入できます。<p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;firstName: 'Peter', lastName: 'Gabriel', age: 63&#93;<p class="paragraph"/>def person = Person.get(someId)
person.properties = bindingMap<p class="paragraph"/>assert person.firstName == 'Peter'
assert person.lastNaem == 'Gabriel'
assert person.age == 63</pre></div><p class="paragraph"/><div class="hidden-block">The binder can populate a full graph of objects using Maps of Maps.</div>
バインダはオブジェクトの完全なデータ構造をマップのマップを使って表現できます。<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">Integer</span> age
    Address homeAddress
&#125;<p class="paragraph"/>class Address &#123;
    <span class="java&#45;object">String</span> county
    <span class="java&#45;object">String</span> country
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;firstName: 'Peter', lastName: 'Gabriel', age: 63, homeAddress: &#91;county: 'Surrey', country: 'England'&#93; &#93;<p class="paragraph"/>def person = <span class="java&#45;keyword">new</span> Person(bindingMap)<p class="paragraph"/>assert person.firstName == 'Peter'
assert person.lastNaem == 'Gabriel'
assert person.age == 63
assert person.homeAddress.county == 'Surrey'
assert person.homeAddress.country == 'England'</pre></div><p class="paragraph"/><div class="hidden-block">h4. Binding To Collections And Maps</div>
<h4>コレクションとマップへのバインディング</h4><p class="paragraph"/><div class="hidden-block">The data binder can populate and update Collections and Maps.  The following code shows a simple example of populating a <code>List</code> of objects in a domain class:</div>
データバインダは、コレクションとマップへの格納と更新ができます。
以下のコードはドメインクラス上の<code>List</code>への格納の単純な例を示します。<p class="paragraph"/><div class="code"><pre>class Band &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> hasMany = &#91;albums: Album&#93;
    List albums
&#125;<p class="paragraph"/>class Album &#123;
    <span class="java&#45;object">String</span> title
    <span class="java&#45;object">Integer</span> numberOfTracks
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;name: 'Genesis', 
                  'albums&#91;0&#93;': &#91;title: 'Foxtrot', numberOfTracks: 6&#93;, 
                  'albums&#91;1&#93;': &#91;title: 'Nursery Cryme', numberOfTracks: 7&#93;&#93;<p class="paragraph"/>def band = <span class="java&#45;keyword">new</span> Band(bindingMap)<p class="paragraph"/>assert band.name == 'Genesis'
assert band.albums.size() == 2
assert band.albums&#91;0&#93;.title == 'Foxtrot'
assert band.albums&#91;0&#93;.numberOfTracks == 6
assert band.albums&#91;1&#93;.title == 'Nursery Cryme'
assert band.albums&#91;1&#93;.numberOfTracks == 7</pre></div><p class="paragraph"/><div class="hidden-block">That code would work in the same way if <code>albums</code> were an array instead of a <code>List</code>.</div>
このコードは<code>albums</code>が<code>List</code>の代わりに配列だったとしても同様に動作します。<p class="paragraph"/><div class="hidden-block">Note that when binding to a <code>Set</code> the structure of the <code>Map</code> being bound to the <code>Set</code> is the same as that of a <code>Map</code> being bound to a <code>List</code> but since a <code>Set</code> is unordered, the indexes don't necessarily correspond to the order of elements in the <code>Set</code>.  In the code example above, if <code>albums</code> were a <code>Set</code> instead of a <code>List</code>, the <code>bindingMap</code> could look exactly the same but 'Foxtrot' might be the first album in the <code>Set</code> or it might be the second.  When updating existing elements in a <code>Set</code> the <code>Map</code> being assigned to the <code>Set</code> must have <code>id</code> elements in it which represent the element in the <code>Set</code> being updated, as in the following example:</div>
<code>Set</code>へとバインディングするとき、<code>Set</code>にバインドされた<code>Map</code>の構造は<code>List</code>にバインドされた<code>Map</code>と同じですが、<code>Set</code>は順序を保持しないため、添字は必ずしも<code>Set</code>内の要素の順序と一致しないことに注意してください。
上記のサンプルコードで<code>albums</code>が<code>List</code>の代わりに<code>Set</code>だったとしたら、<code>bindingMap</code>は一見まったく同じに見えるかもしれませんが、「Foxtrot」は<code>Set</code>内の最初のアルバムかもしれませんし、2番目であるかもしれません。
以下の例のように、<code>Set</code>内の既存の要素を更新するとき、<code>Set</code>に代入する<code>Map</code>は更新されようとしている<code>Set</code>内の要素を表す<code>id</code>要素を持っていなければなりません:<p class="paragraph"/><div class="code"><pre>/&#42;
 &#42; The value of the indexes 0 and 1 in albums&#91;0&#93; and albums&#91;1&#93; are arbitrary
 &#42; values that can be anything as <span class="java&#45;object">long</span> as they are unique within the Map.
 &#42; They <span class="java&#45;keyword">do</span> not correspond to the order of elements in albums because albums
 &#42; is a Set.
 &#42;/
def bindingMap = &#91;'albums&#91;0&#93;': &#91;id: 9, title: 'The Lamb Lies Down On Broadway'&#93;
                  'albums&#91;1&#93;': &#91;id: 4, title: 'Selling England By The Pound'&#93;&#93;<p class="paragraph"/>def band = Band.get(someBandId)<p class="paragraph"/>/&#42;
 &#42; This will find the Album in albums that has an id of 9 and will set its title
 &#42; to 'The Lamb Lies Down On Broadway' and will find the Album in albums that has
 &#42; an id of 4 and set its title to 'Selling England By The Pound'.  In both 
 &#42; cases <span class="java&#45;keyword">if</span> the Album cannot be found in albums then the album will be retrieved
 &#42; from the database by id, the Album will be added to albums and will be updated 
 &#42; with the values described above.  If a Album with the specified id cannot be
 &#42; found in the database, then a binding error will be created and associated
 &#42; with the band object.  More on binding errors later.
 &#42;/
band.properties = bindingMap</pre></div><p class="paragraph"/><div class="hidden-block">When binding to a <code>Map</code> the structure of the binding <code>Map</code> is the same as the structore of a <code>Map</code> used for binding to a <code>List</code> or a <code>Set</code> and the index inside of square brackets corresponds to the key in the <code>Map</code> being bound to.  See the following code:</div>
<code>Map</code>へとバインディングするとき、バインド元の<code>Map</code>の構造は<code>List</code>や<code>Set</code>へのバインディングに使われる<code>Map</code>と同じです。
角括弧内の添字はバインド先の<code>Map</code>内のキーとなります。
以下のコードを見てください:<p class="paragraph"/><div class="code"><pre>class Album &#123;
    <span class="java&#45;object">String</span> title
    <span class="java&#45;keyword">static</span> hasMany = &#91;players: Player&#93;
    Map players
&#125;<p class="paragraph"/>class Player &#123;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;title: 'The Lamb Lies Down On Broadway',
                  'players&#91;guitar&#93;': &#91;name: 'Steve Hacket'&#93;,
                  'players&#91;vocals&#93;': &#91;name: 'Peter Gabriel'&#93;
                  'players&#91;keyboards&#93;': &#91;name: 'Tony Banks'&#93;&#93;<p class="paragraph"/>def album = <span class="java&#45;keyword">new</span> Album(bindingMap)<p class="paragraph"/>assert album.title == 'The Lamb Lies Down On Broadway'
assert album.players.size() == 3
assert album.players.guitar == 'Steve Hacket'
assert album.players.vocals == 'Peter Gabriel'
assert album.players.keyboards == 'Tony Banks'</pre></div><p class="paragraph"/><div class="hidden-block">When updating an exisiting <code>Map</code>, if the key specified in the binding <code>Map</code> does not exist in the <code>Map</code> being bound to then a new value will be created and added to the <code>Map</code> with the specified key as in the following example:</div>
以下の例のように、既存の<code>Map</code>を更新するときに、バインド元の<code>Map</code>内で指定されたキーがバインド先の<code>Map</code>内に存在しない場合、新しい値が生成されて指定されたキーでバインド先の<code>Map</code>に追加されます:<p class="paragraph"/><div class="code"><pre>def bindingMap = &#91;title: 'The Lamb Lies Down On Broadway',
                  'players&#91;guitar&#93;': &#91;name: 'Steve Hacket'&#93;,
                  'players&#91;vocals&#93;': &#91;name: 'Peter Gabriel'&#93;
                  'players&#91;keyboards&#93;': &#91;name: 'Tony Banks'&#93;&#93;<p class="paragraph"/>def album = <span class="java&#45;keyword">new</span> Album(bindingMap)<p class="paragraph"/>assert album.title == 'The Lamb Lies Down On Broadway'
assert album.players.size() == 3
assert album.players.guitar == 'Steve Hacket'
assert album.players.vocals == 'Peter Gabriel'
assert album.players.keyboards == 'Tony Banks'<p class="paragraph"/>def updatedBindingMap = &#91;'players&#91;drums&#93;': &#91;name: 'Phil Collins'&#93;,
                         'players&#91;keyboards&#93;': &#91;name: 'Anthony George Banks'&#93;&#93;<p class="paragraph"/>album.properties = updatedBindingMap<p class="paragraph"/>assert album.title == 'The Lamb Lies Down On Broadway'
assert album.players.size() == 4
assert album.players.guitar == 'Steve Hacket'
assert album.players.vocals == 'Peter Gabriel'
assert album.players.keyboards == 'Anthony George Banks'
assert album.players.drums == 'Phil Collins'</pre></div><p class="paragraph"/><div class="hidden-block">h4. Binding Request Data to the Model</div>
<h4>モデルにリクエストデータをバインドする</h4><p class="paragraph"/><div class="hidden-block">The <a href="../ref/Controllers/params.html" class="controllers">params</a> object that is available in a controller has special behavior that helps convert dotted request parameter names into nested Maps that the data binder can work with.  For example, if a request includes request parameters named <code>person.homeAddress.country</code> and <code>person.homeAddress.city</code> with values 'USA' and 'St. Louis' respectively, <code>params</code> would include entries like these:</div>
コントローラで利用できる<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトには、ドット区切りのリクエストパラメータ名をネストされたMapに変換する
という特別なサポートがあります。
たとえば、値がそれぞれ「USA」と「St. Louis」であるような<code>person.homeAddress.country</code>と<code>person.homeAddress.city</code>という名前のリクエストパラメータを持っているリクエストの場合、<code>params</code>のエントリは以下のようになります:<p class="paragraph"/><div class="code"><pre>&#91;person: &#91;homeAddress: &#91;country: 'USA', city: 'St. Louis'&#93;&#93;&#93;</pre></div><p class="paragraph"/><div class="hidden-block">There are two ways to bind request parameters onto the properties of a domain class. The first involves using a domain classes' Map constructor:</div>
リクエストパラメータをドメインクラスのプロパティへバインドするには、2通りの方法があります。1つめはドメインクラスのマップを指定するコンストラクタを使用します。<p class="paragraph"/><div class="code"><pre>def save() &#123;
    def b = <span class="java&#45;keyword">new</span> Book(params)
    b.save()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The data binding happens within the code <code>new Book(params)</code>. By passing the <a href="../ref/Controllers/params.html" class="controllers">params</a> object to the domain class constructor Grails automatically recognizes that you are trying to bind from request parameters. So if we had an incoming request like:</div>
この例では、<code>new Book(params)</code>の部分でデータバインディングが実行されます。<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトをドメインクラスのコンストラクタに渡すことで、Grailsが自動にリクエストパラメータを認識してバインドします。例えば、以下のようなリクエストを受信したとします。<p class="paragraph"/><div class="code"><pre>/book/save?title=The%20Stand&#38;author=Stephen%20King</pre></div><p class="paragraph"/><div class="hidden-block">Then the <code>title</code> and <code>author</code> request parameters would automatically be set on the domain class. You can use the <a href="../ref/Domain Classes/properties.html" class="domainClasses">properties</a> property to perform data binding onto an existing instance:</div>
リクエストパラメータの<code>title</code>と<code>author</code>が、自動的にドメインクラスへセットされます。もう1つの方法として、既存のドメインクラスインスタンスへデータバインディングするために、<a href="../ref/Domain Classes/properties.html" class="domainClasses">properties</a>プロパティを利用することができます。<p class="paragraph"/><div class="code"><pre>def save() &#123;
    def b = Book.get(params.id)
    b.properties = params
    b.save()
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This has the same effect as using the implicit constructor.</div>
これは先ほどのコンストラクタを利用したのと同じ結果になります。<p class="paragraph"/><div class="hidden-block">When binding an empty String (a String with no characters in it, not even spaces), the data binder will convert the empty String to null.  This simplifies the most common case where the intent is to treat an empty form field as having the value null since there isn't a way to actually submit a null as a request parameter.  When this behavior is not desireable the application may assign the value directly.</div>
空文字(スペースすら含まない文字数0のString)をnullable制約を付与されたプロパティにバインディングするとき、データバインダはその空文字をnullに変換します。
これによって、リクエストパラメータとしてnullをサブミットする方法が実際には存在しないため空文字として送信せざるを得ないが、フォームの空フィールドについて値がnullであるとみなしたい、というよくあるケースを簡単に扱えるようになります。
この振る舞いが望ましくないときは、アプリケーションは値を直接代入することもできます。<p class="paragraph"/><div class="hidden-block">The mass property binding mechanism will by default automatically trim all Strings at binding time.  To disable this behavior set the <code>grails.databinding.trimStrings</code> property to false in <code>grails-app/conf/Config.groovy</code>.</div>
大量プロパティバインディング機構は、デフォルトでバインディング時にすべての文字列を自動的にトリムします。
この挙動を無効化するには、<code>grails-app/conf/Config.groovy</code>の<code>grails.databinding.trimStrings</code> プロパティにfalseをセットしてください。<p class="paragraph"/><div class="code"><pre>// the <span class="java&#45;keyword">default</span> value is <span class="java&#45;keyword">true</span>
grails.databinding.trimStrings = <span class="java&#45;keyword">false</span><p class="paragraph"/>// ...</pre></div><p class="paragraph"/><div class="hidden-block">The mass property binding mechanism will by default automatically convert all empty Strings to null at binding time.  To disable this behavior set the <code>grails.databinding.convertEmptyStringsToNull</code> property to false in <code>grials-app/conf/Config.groovy</code>.</div>
大量プロパティバインディング機構は、デフォルトでバインディング時にすべての空文字を自動的にnullに変換します。
この挙動を無効化するには、<code>grails-app/conf/Config.groovy</code>の<code>grails.databinding.convertEmptyStringsToNull</code> プロパティにfalseをセットしてください。<p class="paragraph"/><div class="code"><pre>// the <span class="java&#45;keyword">default</span> value is <span class="java&#45;keyword">true</span>
grails.databinding.convertEmptyStringsToNull = <span class="java&#45;keyword">false</span><p class="paragraph"/>// ...</pre></div><p class="paragraph"/><div class="hidden-block">The order of events is that the String trimming happens and then null conversion happens so if <code>trimStrings</code> is <code>true</code> and <code>convertEmptyStringsToNull</code> is <code>true</code>, not only will empty Strings be converted to null but also blank Strings.  A blank String is any String such that the <code>trim()</code> method returns an empty String.</div>
<code>trimStrings</code>が<code>true</code>で<code>convertEmptyStringsToNull</code>が<code>true</code>のとき、イベントの順番としては、文字列がトリムされた後にnull変換が実行されます。つまり、空文字がnullに変換されるだけでなく、空白文字列もnullに変換されることになります。
ここで、空白文字列とは<code>trim()</code>メソッドが空文字を返す文字列のことです。<p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">These forms of data binding in Grails are very convenient, but also indiscriminate. In other words, they will bind  <em class="italic">all</em>  non-transient, typed instance properties of the target object, including ones that you may not want bound. Just because the form in your UI doesn't submit all the properties, an attacker can still send malign data via a raw HTTP request. Fortunately, Grails also makes it easy to protect against such attacks - see the section titled "Data Binding and Security concerns" for more information.</div>
Grailsでのこのようなデータバインディングは大変便利ですが、同時に無差別的でもあります。
言い換えると、バインドしたくないものまで含めて、対象オブジェクトの「すべて」の非transientな型付けされたインスタンスプロパティをバインドしてしまいます。
単にUI上のフォームがすべてのプロパティをサブミットするわけではないだけであって、今もなお攻撃者は生のHTTPリクエストを使って悪意あるデータを送信することができます。
幸い、Grailsではそのような攻撃に対して防御するのも簡単です。
詳しくは、「データバインディングとセキュリティ考慮」のセクションを参照してください。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Data binding and Single-ended Associations </div>
<h4>単一終端関連のデータバインディング</h4><p class="paragraph"/><div class="hidden-block">If you have a <code>one-to-one</code> or <code>many-to-one</code> association you can use Grails' data binding capability to update these relationships too. For example if you have an incoming request such as:</div>
1対1や多対1関連の場合も、Grailsデータバインディングの機能で更新可能です。例として次のようなリクエストを受信したとします:<p class="paragraph"/><div class="code"><pre>/book/save?author.id=20</pre></div><p class="paragraph"/><div class="hidden-block">Grails will automatically detect the <code>.id</code> suffix on the request parameter and look up the <code>Author</code> instance for the given id when doing data binding such as:</div>
同じ方法で、Grailsがリクエストパラメータの<code>.id</code>接尾辞を自動認識して、与えられたidで該当する<code>Author</code>インスタンスを検索してデータバインディングを行います<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(params)</pre></div><p class="paragraph"/><div class="hidden-block">An association property can be set to <code>null</code> by passing the literal <code>String</code> "null". For example:</div>
次のように、関連のプロパティに文字列で"null"と指定することで<code>null</code>をセットすることができます<p class="paragraph"/><div class="code"><pre>/book/save?author.id=<span class="java&#45;keyword">null</span></pre></div><p class="paragraph"/><div class="hidden-block">h4. Data Binding and Many-ended Associations </div>
<h4>複数終端関連のデータバインディング</h4><p class="paragraph"/><div class="hidden-block">If you have a one-to-many or many-to-many association there are different techniques for data binding depending of the association type.</div>
1対多や多対多関連の場合、それぞれの関連タイプによって違ったデータバインディング方法があります。<p class="paragraph"/><div class="hidden-block">If you have a <code>Set</code> based association (the default for a <code>hasMany</code>) then the simplest way to populate an association is to send a list of identifiers. For example consider the usage of <code>&#60;g:select&#62;</code> below:</div>
<code>Set</code>ベースの関連(<code>hasMany</code>でのデフォルト)で、簡単に関連を設定するには、idのリストを送る方法が有ります。以下の例は<code>&#60;g:select&#62;</code>を使用した方法です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books"</span>
          from=<span class="xml&#45;quote">"$&#123;Book.list()&#125;"</span>
          size=<span class="xml&#45;quote">"5"</span> multiple=<span class="xml&#45;quote">"yes"</span> optionKey=<span class="xml&#45;quote">"id"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This produces a select box that lets you select multiple values. In this case if you submit the form Grails will automatically use the identifiers from the select box to populate the <code>books</code> association.</div>
このタグでは複数選択のセレクトボックスが生成されます。この例でフォームを送信すると、Grailsが自動的にセレクトボックスで選択されたidを使用して、<code>books</code>の関連を設定します。<p class="paragraph"/><div class="hidden-block">However, if you have a scenario where you want to update the properties of the associated objects the this technique won't work. Instead you use the subscript operator:</div>
ただしこの方法は、関連オブジェクトのプロパティを更新する場合は使用できません。代わりに添字演算子を使用します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;0&#93;.title"</span> value=<span class="xml&#45;quote">"the Stand"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;1&#93;.title"</span> value=<span class="xml&#45;quote">"the Shining"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">However, with <code>Set</code> based association it is critical that you render the mark-up in the same order that you plan to do the update in. This is because a <code>Set</code> has no concept of order, so although we're referring to <code>books0</code> and <code>books1</code> it is not guaranteed that the order of the association will be correct on the server side unless you apply some explicit sorting yourself.</div>
ただし、<code>Set</code>ベースの関連では、マークアップ(HTML)が描写された順序とは同じ順序で更新されない危険性あります。 これは<code>Set</code>には順序という概念がなく、<code>books&#91;0&#93;</code>や<code>books&#91;1&#93;</code>と指定したとしても、サーバサイドでの関連のソートを明快に指定しない限り、順序が保証されないことになるからです。<p class="paragraph"/><div class="hidden-block">This is not a problem if you use <code>List</code> based associations, since a <code>List</code> has a defined order and an index you can refer to. This is also true of <code>Map</code> based associations.</div>
<code>List</code>ベースの関連の場合は、<code>List</code>の順序とインデックスを指定することができるので問題ありません。<code>Map</code>ベースの関連も同じことがいえます。<p class="paragraph"/><div class="hidden-block">Note also that if the association you are binding to has a size of two and you refer to an element that is outside the size of association:</div>
さらに注意するポイントとして、バインドする関連が2個の物に、それより多い数の場合は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;0&#93;.title"</span> value=<span class="xml&#45;quote">"the Stand"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;1&#93;.title"</span> value=<span class="xml&#45;quote">"the Shining"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;2&#93;.title"</span> value=<span class="xml&#45;quote">"Red Madder"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then Grails will automatically create a new instance for you at the defined position. If you "skipped" a few elements in the middle:</div>
Grailsが新たにインスタンスを指定したポジションに生成します。途中のいくつかのエレメントを飛ばした数値を指定した場合は:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;0&#93;.title"</span> value=<span class="xml&#45;quote">"the Stand"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;1&#93;.title"</span> value=<span class="xml&#45;quote">"the Shining"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;g:textField name=<span class="xml&#45;quote">"books&#91;5&#93;.title"</span> value=<span class="xml&#45;quote">"Red Madder"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then Grails will automatically create instances in between. For example in the above case Grails will create 4 additional instances if the association being bound had a size of 2.</div>
Grailsが間のインスタンスも自動的に生成します。上記のケースでは関連が2個の場合は、4個のインスタンスが追加されます。<p class="paragraph"/><div class="hidden-block">You can bind existing instances of the associated type to a <code>List</code> using the same <code>.id</code> syntax as you would use with a single-ended association. For example:</div>
既存のインスタンスを<code>List</code>関連でバインドするには、単一終端関連と同じように<code>.id</code>シンタックスを使用します。例として:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;0&#93;.id"</span> from=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;0&#93;?.id&#125;"</span> /&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;1&#93;.id"</span> from=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;1&#93;?.id&#125;"</span> /&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;2&#93;.id"</span> from=<span class="xml&#45;quote">"$&#123;bookList&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;2&#93;?.id&#125;"</span> /&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Would allow individual entries in the <code>books List</code> to be selected separately.</div>
この例では、別々に選択して、<code>books List</code>の特定の場所にエントリを可能にします。<p class="paragraph"/><div class="hidden-block">Entries at particular indexes can be removed in the same way too. For example:</div>
同じ方法で、個々のインデックスからエントリの削除も可能です:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"books&#91;0&#93;.id"</span>
          from=<span class="xml&#45;quote">"$&#123;Book.list()&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;author?.books&#91;0&#93;?.id&#125;"</span>
          noSelection=<span class="xml&#45;quote">"&#91;'null': ''&#93;"</span>/&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Will render a select box that will remove the association at <code>books0</code> if the empty option is chosen.</div>
上記の例では、空のオプションを選択することで、<code>book&#91;0&#93;</code>の関連を削除します。<p class="paragraph"/><div class="hidden-block">Binding to a <code>Map</code> property works the same way except that the list index in the parameter name is replaced by the map key:</div>
リストのインデックス数値をパラメータ名称にすることで、マップのキーとして認識されるので、<code>Map</code>のプロパティも同じ方法で動作します:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:select name=<span class="xml&#45;quote">"images&#91;cover&#93;.id"</span>
          from=<span class="xml&#45;quote">"$&#123;Image.list()&#125;"</span>
          value=<span class="xml&#45;quote">"$&#123;book?.images&#91;cover&#93;?.id&#125;"</span>
          noSelection=<span class="xml&#45;quote">"&#91;'null': ''&#93;"</span>/&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">This would bind the selected image into the <code>Map</code> property <code>images</code> under a key of <code>"cover"</code>.</div>
この例では、Mapプロパティimagesのキー"cover"に対してバインドされます。<p class="paragraph"/><div class="hidden-block">When binding to Maps, Arrays and Collections the data binder will automatically grow the size of the collections as necessary.  The default limit to how large the binder will grow a collection is 256.  If the data binder encounters an entry that requires the collection be grown beyond that limit, the entry is ignored.  The limit may be configured by assigning a value to the <code>grails.databinding.autoGrowCollectionLimit</code> property in <code>Config.groovy</code>.</div>
Map・配列・コレクションにバインディングするとき、データバインダは必要に応じて自動的にコレクションのサイズを大きくします。
バインダがコレクションを大きくするときのデフォルトの上限は256です。
もしデータバインダが上限を超えてコレクションを大きくする必要のある要素に出会った場合、その要素は無視されます。
上限は<code>Config.groovy</code>の<code>grails.databinding.autoGrowCollectionLimit</code>プロパティに値を代入すれば変更できます。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/Config.groovy<p class="paragraph"/>// the <span class="java&#45;keyword">default</span> value is 256
grails.databinding.autoGrowCollectionLimit = 128<p class="paragraph"/>// ...</pre></div><p class="paragraph"/><div class="hidden-block">h4. Data binding with Multiple domain classes </div>
<h4>複数ドメインクラスでのデータバインディング</h4><p class="paragraph"/><div class="hidden-block">It is possible to bind data to multiple domain objects from the <a href="../ref/Controllers/params.html" class="controllers">params</a> object.</div>
<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトから、複数のドメインオブジェクトへのデータのバインドが可能です。<p class="paragraph"/><div class="hidden-block">For example so you have an incoming request to:</div>
例として以下のようなリクエストがあったとします:<p class="paragraph"/><div class="code"><pre>/book/save?book.title=The%20Stand&#38;author.name=Stephen%20King</pre></div><p class="paragraph"/><div class="hidden-block">You'll notice the difference with the above request is that each parameter has a prefix such as <code>author.</code> or <code>book.</code> which is used to isolate which parameters belong to which type. Grails' <code>params</code> object is like a multi-dimensional hash and you can index into it to isolate only a subset of the parameters to bind.</div>
上記のリクエストでは、それぞれのパラメータに<code>author.</code>また<code>book.</code>という接頭辞が付いていて、どちらの型(ドメインクラス)に属するかを区別しています。Grailsの<code>params</code>オブジェクトは多次元ハッシュのようになっており、それぞれバインドするためのパラメータサブセットとして区別されて索引されます。<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(params.book)</pre></div><p class="paragraph"/><div class="hidden-block">Notice how we use the prefix before the first dot of the <code>book.title</code> parameter to isolate only parameters below this level to bind. We could do the same with an <code>Author</code> domain class:</div>
上記のように接頭辞bookをparams指定することで、ドメインクラスBookに対して、<code>book.title</code>パラメータだけが区別されてバインドされます。ドメインクラス<code>Author</code>も同じように指定します。<p class="paragraph"/><div class="code"><pre>def a = <span class="java&#45;keyword">new</span> Author(params.author)</pre></div><p class="paragraph"/><div class="hidden-block">h4. Data Binding and Action Arguments </div>
<h4>データバインディングとアクション引数</h4><p class="paragraph"/><div class="hidden-block">Controller action arguments are subject to request parameter data binding.  There are 2 categories of controller action arguments.  The first category is command objects.  Complex types are treated as command objects.  See the <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> section of the user guide for details.  The other category is basic object types.  Supported types are the 8 primitives, their corresponding type wrappers and <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/String.html" class="api">java.lang.String</a>.  The default behavior is to map request parameters to action arguments by name:</div>
コントローラのアクション引数はリクエストパラメータのデータバインディング対象です。
コントローラのアクション引数は大きく2つに分類されます。
1つめはコマンドオブジェクトです。
複合型はコマンドオブジェクトとして扱われます。
詳しくはこのユーザガイドの<a href="../guide/single.html#commandObjects" class="guide">コマンドオブジェクト</a>のセクションを参照してください。
もう一つは基本オブジェクト型です。
サポートしている方は8つのプリミティブ型とそれに対応するラッパー型と<a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/String.html" class="api">java.lang.String</a>です。
デフォルトの挙動では、リクエストパラメータとアクション引数は名前に基づいて関連づけられます。<p class="paragraph"/><div class="code"><pre>class AccountingController &#123;<p class="paragraph"/>   // accountNumber will be initialized with the value of params.accountNumber
   // accountType will be initialized with params.accountType
   def displayInvoice(<span class="java&#45;object">String</span> accountNumber, <span class="java&#45;object">int</span> accountType) &#123;
       // &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">For primitive arguments and arguments which are instances of any of the primitive type wrapper classes a type conversion has to be carried out before the request parameter value can be bound to the action argument.  The type conversion happens automatically.  In a case like the example shown above, the <code>params.accountType</code> request parameter has to be converted to an <code>int</code>.  If type conversion fails for any reason, the argument will have its default value per normal Java behavior (null for type wrapper references, false for booleans and zero for numbers) and a corresponding error will be added to the <code>errors</code> property of the defining controller.</div>
プリミティブ型の引数とプリミティブ型のラッパークラスのインスタンスの引数に対しては、リクエストパラメータの値がアクション引数にバインドされる前に、型変換を実行する必要があります。
この型変換は自動的に行われます。
先に示した例のようなケースでは、<code>params.accountType</code>リクエストパラメータは<code>int</code>型に変換する必要があります。
もし型変換が何らかの理由により失敗した場合は、引数はJava標準的な挙動によるデフォルト値(ラッパー型はnull、boolean型はfalse、数値型は0)をとります。
そして、対応するエラーが対象コントローラの<code>errors</code>プロパティに追加されます。<p class="paragraph"/><div class="code"><pre>/accounting/displayInvoice?accountNumber=B59786&#38;accountType=bogusValue</pre></div><p class="paragraph"/><div class="hidden-block"></div>Since "bogusValue" cannot be converted to type int, the value of accountType will be zero, the controller's <code>errors.hasErrors()</code> will be true, the controller's <code>errors.errorCount</code> will be equal to 1 and the controller's <code>errors.getFieldError('accountType')</code> will contain the corresponding error.
"bogusValue"はint型に変換できないため、<code>accountType</code>は0になります。そして、コントローラの<code>errors.hasErrors()</code>はtrueに、<code>errors.errorCount</code>は1になり、<code>errors.getFieldError('accountType')</code>には対応するエラーが保持されます。<p class="paragraph"/><div class="hidden-block">If the argument name does not match the name of the request parameter then the <code>&#64;grails.web.RequestParameter</code> annotation may be applied to an argument to express the name of the request parameter which should be bound to that argument:</div>
引数名がリクエストパラメータの名前と一致しない場合、その引数にバインドすべきリクエストパラメータの名前を指定するために、<code>&#64;grails.web.RequestParameter</code>アノテーションを引数に付与することができます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.web.RequestParameter<p class="paragraph"/>class AccountingController &#123;<p class="paragraph"/>   // mainAccountNumber will be initialized with the value of params.accountNumber
   // accountType will be initialized with params.accountType
   def displayInvoice(@RequestParameter('accountNumber') <span class="java&#45;object">String</span> mainAccountNumber, <span class="java&#45;object">int</span> accountType) &#123;
       // &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/>
<div class="hidden-block">h4. Data binding and type conversion errors </div>
<h4>型変換エラーとデータバインディング</h4><p class="paragraph"/><div class="hidden-block">Sometimes when performing data binding it is not possible to convert a particular String into a particular target type. This results in a type conversion error. Grails will retain type conversion errors inside the <a href="../ref/Domain Classes/errors.html" class="domainClasses">errors</a> property of a Grails domain class. For example:</div>
時折データバインディングの際に、特有の文字列を特有の型に変換できない場合があります。この場合の結果は型変換エラーとなります。Grailsではドメインインスタンスの<a href="../ref/Domain Classes/errors.html" class="domainClasses">errors</a>プロパティで型変換エラーを保持します。例えば:<p class="paragraph"/>
<div class="code"><pre>class Book &#123;
    &#8230;
    URL publisherURL
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Here we have a domain class <code>Book</code> that uses the <code>java.net.URL</code> class to represent URLs. Given an incoming request such as:</div>
ドメインクラス<code>Book</code>でURLを表すプロパティに<code>java.net.URL</code>クラスを使用したとします。次のようなリクエストを受信したとします:<p class="paragraph"/><div class="code"><pre>/book/save?publisherURL=a&#45;bad&#45;url</pre></div><p class="paragraph"/><div class="hidden-block">it is not possible to bind the string <code>a-bad-url</code> to the <code>publisherURL</code> property as a type mismatch error occurs. You can check for these like this:</div>
型違いエラーが起きるため、文字列<code>a-bad-url</code>を<code>publisherURL</code>にバインドすることはできません。次のようにしてエラーを確認します:<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(params)<p class="paragraph"/><span class="java&#45;keyword">if</span> (b.hasErrors()) &#123;
    println <span class="java&#45;quote">"The value $&#123;b.errors.getFieldError('publisherURL').rejectedValue&#125;"</span> +
            <span class="java&#45;quote">" is not a valid URL!"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">Although we have not yet covered error codes (for more information see the section on <a href="../guide/single.html#validation" class="guide">Validation</a>), for type conversion errors you would want a message from the <code>grails-app/i18n/messages.properties</code> file to use for the error. You can use a generic error message handler such as:</div>
この章までは、まだエラーコードの説明していませんが(詳しくは<a href="../guide/single.html#validation" class="guide">Validation</a>を参照)、型変換エラーでは<code>grails-app/i18n/messages.properties</code>を使用してメッセージを返す事もあると思います。次のような一般的なメッセージハンドラーを使用することもできます<p class="paragraph"/><div class="code"><pre>typeMismatch.java.net.URL=The field &#123;0&#125; is not a valid URL</pre></div><p class="paragraph"/><div class="hidden-block">Or a more specific one:</div>
また、さらに対象を特定する場合は:<p class="paragraph"/><div class="code"><pre>typeMismatch.Book.publisherURL=The publisher URL you specified is not a valid URL</pre></div><p class="paragraph"/><div class="hidden-block">h4. The BindUsing Annotation</div>
<h4>BindUsingアノテーション</h4><p class="paragraph"/><div class="hidden-block">The <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a> annotation may be used to define a custom binding mechanism for a particular field in a class.  Any time data binding is being applied to the field the closure value of the annotation will be invoked with 2 arguments.  The first argument is the object that data binding is being applied to and the second argument is a <code>Map</code> which is the data source for the data binding.  The value returned from the closure will be bound to the property.  The following example would result in the upper case version of the <code>name</code> value in the source being applied to the <code>name</code> field during data binding.</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a>アノテーションはクラスの特定のフィールドに独自のバインディング方法を定義するために使います。
データバインディングがそのフィールドに適用されるときは毎回アノテーションに指定されたクロージャが2つの引数で実行されます。
最初の引数はデータバインディングを適用しようとしているオブジェクトで、2番目の引数はデータバインディングのためのデータソースとなる<code>Map</code>です。
クロージャが返す値はオブジェクトのプロパティにバインドされます。
以下の例では、データバーディングによってデータソースの<code>name</code>の値が大文字に変換されたものが<code>name</code>フィールドに設定されます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindUsing<p class="paragraph"/>class SomeClass &#123;
    @BindUsing(&#123;
        obj, source &#45;&#62; source&#91;'name'&#93;?.toUpperCase()
    &#125;)
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">
The <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a> annotation may be used to define a custom binding mechanism for all of the fields on a particular class. When the annotation is applied to a class, the value assigned to the annotation should be a class which implements the <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingHelper.html" class="api">BindingHelper</a> interface.  An instance of that class will be used any time a value is bound to a property in the class that this annotation has been applied to. 
</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindUsing.html" class="api">BindUsing</a>アノテーションは特定のクラス上のすべてのフィールドに対する独自のバインディング方法を定義するためにも使えます。
このアノテーションをクラスに指定するときは、アノテーションに指定する値は <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingHelper.html" class="api">BindingHelper</a>インターフェイスを実装したクラスにしなくてはいけません。
このクラスのインスタンスは、アノテーションが指定されたクラス内のプロパティに値がバインドされるときに毎回使われます。<p class="paragraph"/><div class="code"><pre>@BindUsing(SomeClassWhichImplementsBindingHelper)
class SomeClass &#123;
    <span class="java&#45;object">String</span> someProperty
    <span class="java&#45;object">Integer</span> someOtherProperty
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">h4. Custom Data Converters</div>
<h4>カスタムデータコンバータ</h4><p class="paragraph"/><div class="hidden-block">The binder will do a lot of type conversion automatically.  Some applications may want to define their own mechanism for converting values and a simple way to do this is to write a class which implements <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/ValueConverter.html" class="api">ValueConverter</a> and register an instance of that class as a bean in the Spring application context.</div>
バインダはたくさんの型変換を自動的に行います。
いくつかのアプリケーションでは、値を変換するための独自の機構を定義したいかもしれません。
そのための簡単な方法は<a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/ValueConverter.html" class="api">ValueConverter</a>を実装するクラスを書いて、そのクラスのインスタンスをビーンとしてSpringのアプリケーションコンテキストに登録することです。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.myapp.converters<p class="paragraph"/><span class="java&#45;keyword">import</span> org.grails.databinding.converters.ValueConverter<p class="paragraph"/>/&#42;&#42;
 &#42; A custom converter which will convert <span class="java&#45;object">String</span> of the
 &#42; form 'city:state' into an Address object.
 &#42;/
class AddressValueConverter <span class="java&#45;keyword">implements</span> ValueConverter &#123;<p class="paragraph"/>    <span class="java&#45;object">boolean</span> canConvert(value) &#123;
        value <span class="java&#45;keyword">instanceof</span> <span class="java&#45;object">String</span>
    &#125;<p class="paragraph"/>    def convert(value) &#123;
        def pieces = value.split(':')
        <span class="java&#45;keyword">new</span> com.myapp.Address(city: pieces&#91;0&#93;, state: pieces&#91;1&#93;)
    &#125;<p class="paragraph"/>    <span class="java&#45;object">Class</span>&#60;?&#62; getTargetType() &#123;
        com.myapp.Address
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">An instance of that class needs to be registered as a bean in the Spring application context.  The bean name is not important.  All beans that implemented ValueConverter will be automatically plugged in to the data binding process.</div>
クラスのインスタンスはSpringのアプリケーションコンテキストにビーンとして登録する必要があります。
ビーンの名前は重要ではありません。
<code>ValueConverter</code>を実装したすべてのビーンは、自動的にデータバインディングプロセスに組み込まれます。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy<p class="paragraph"/>beans = &#123;<p class="paragraph"/>    addressConverter com.myapp.converters.AddressValueConverter<p class="paragraph"/>    // ...<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    Address homeAddress
&#125;<p class="paragraph"/>class Address &#123;
    <span class="java&#45;object">String</span> city
    <span class="java&#45;object">String</span> state
&#125;<p class="paragraph"/>def person = <span class="java&#45;keyword">new</span> Person()
person.properties = &#91;firstName: 'Jeff', homeAddress: <span class="java&#45;quote">"O'Fallon:Missouri"</span>&#93;
assert person.firstName == 'Jeff'
assert person.homeAddress.city = <span class="java&#45;quote">"O'Fallon"</span>
assert person.homeAddress.state = 'Missouri'</pre></div><p class="paragraph"/><div class="hidden-block">h4. Date Formats For Data Binding</div>
<h4>データバインディングのためのデータフォーマット</h4><p class="paragraph"/><div class="hidden-block">A custom date format may be specified to be used when binding a String to a Date value by applying the <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a> annotation to a Date field.</div>
文字列を<code>Date</code>の値にバインドするとき、<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a>アノテーションをデータフィールドに付与することで、カスタムデータフォーマットを指定できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindingFormat<p class="paragraph"/>class Person &#123;
    @BindingFormat('MMddyyyy')
    Date birthDate
&#125;</pre></div><p class="paragraph"/>A global setting may be configured in <code>Config.groovy</code> to define date formats which will be used application wide when binding to Date.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/Config.groovy<p class="paragraph"/>grails.databinding.dateFormats = &#91;'MMddyyyy', 'yyyy&#45;MM&#45;dd HH:mm:ss.S', <span class="java&#45;quote">"yyyy&#45;MM&#45;dd'T'hh:mm:ss'Z'"</span>&#93;</pre></div><p class="paragraph"/>The formats specified in <code>grails.databinding.dateFormats</code> will be attempted in the order in which they are included in the List.  If a property is marked with &#64;BindingFormat, the &#64;BindingFormat will take precedence over the values specified in <code>grails.databinding.dateFormats</code>.<p class="paragraph"/>The default formats that are used are "yyyy-MM-dd HH:mm:ss.S" and "yyyy-MM-dd'T'hh:mm:ss'Z'".<p class="paragraph"/><div class="hidden-block">h4. Custom Formatted Converters</div>
<h4>カスタムフォーマットコンバータ</h4><p class="paragraph"/><div class="hidden-block">You may supply your own handler for the <a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a> annotation by writing a class which implements the <a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/FormattedValueConverter.html" class="api">FormattedValueConverter</a> interface and regiserting an instance of that class as a bean in the Spring application context.  Below is an example of a trivial custom String formatter that might convert the case of a String based on the value assigned to the BindingFormat annotation.</div>
<a href="http://grails.org/doc/latest/api/org/grails/databinding/converters/FormattedValueConverter.html" class="api">FormattedValueConverter</a>インターフェイスを実装したクラスを書いて、そのクラスのインスタンスをビーンとしてSpringのアプリケーションコンテキストに登録することで、<a href="http://grails.org/doc/latest/api/org/grails/databinding/BindingFormat.html" class="api">BindingFormat</a>アノテーションに対して独自のハンドラを提供できます。
以下は、<code>BindingFormat</code>アノテーションが指定された値の文字列の大文字/小文字を変換するという、ちょっとした文字列のカスタムフォーマッタの例です。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.myapp.converters<p class="paragraph"/><span class="java&#45;keyword">import</span> org.grails.databinding.converters.FormattedValueConverter<p class="paragraph"/>class FormattedStringValueConverter <span class="java&#45;keyword">implements</span> FormattedValueConverter &#123;
    def convert(value, <span class="java&#45;object">String</span> format) &#123;
        <span class="java&#45;keyword">if</span>('UPPERCASE' == format) &#123;
            value = value.toUpperCase()
        &#125; <span class="java&#45;keyword">else</span> <span class="java&#45;keyword">if</span>('LOWERCASE' == format) &#123;
            value = value.toLowerCase()
        &#125;
        value
    &#125;<p class="paragraph"/>    <span class="java&#45;object">Class</span> getTargetType() &#123;
        // specifies the type to which <span class="java&#45;keyword">this</span> converter may be applied
        <span class="java&#45;object">String</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">An instance of that class needs to be registered as a bean in the Spring application context.  The bean name is not important.  All beans that implemented FormattedValueConverter will be automatically plugged in to the data binding process.</div>
クラスのインスタンスはSpringのアプリケーションコンテキストにビーンとして登録する必要があります。
ビーンの名前は重要ではありません。
<code>FormattedValueConverter</code>を実装したすべてのビーンは、自動的にデータバインディングプロセスに組み込まれます。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/conf/spring/resources.groovy<p class="paragraph"/>beans = &#123;<p class="paragraph"/>    formattedStringConverter com.myapp.converters.FormattedStringValueConverter<p class="paragraph"/>    // ...<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><div class="hidden-block">With that in place the <code>BindingFormat</code> annotation may be applied to String fields to inform the data binder to take advantage of the custom converter.</div>
所定の場所にこれがあれば、データバインダにカスタムコンバータを利用することを伝えるために、<code>BindingFormat</code>アノテーションを文字列フィールドに適用できます。<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindingFormat<p class="paragraph"/>class Person &#123;
    @BindingFormat('UPPERCASE')
    <span class="java&#45;object">String</span> someUpperCaseString<p class="paragraph"/>    @BindingFormat('LOWERCASE')
    <span class="java&#45;object">String</span> someLowerCaseString<p class="paragraph"/>    <span class="java&#45;object">String</span> someOtherString
&#125;</pre></div><p class="paragraph"/><h4>Localized Binding Formats</h4><p class="paragraph"/>The <code>BindingFormat</code> annotation supports localized format strings by using the optional <code>code</code> attribute.  If a value is assigned to the code attribute that value will be used as the message code to retrieve the binding format string from the <code>messageSource</code> bean in the Spring application context and that lookup will be localized.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.databinding.BindingFormat<p class="paragraph"/>class Person &#123;
    @BindingFormat(code='date.formats.birthdays')
    Date birthDate
&#125;</pre></div><p class="paragraph"/>
<div class="code"><pre>&#35; grails&#45;app/conf/i18n/messages.properties
date.formats.birthdays=MMddyyyy</pre></div><p class="paragraph"/><div class="code"><pre>&#35; grails&#45;app/conf/i18n/messages_es.properties
date.formats.birthdays=ddMMyyyy</pre></div><p class="paragraph"/><h4>Using The Data Binder Directly</h4><p class="paragraph"/>There are situations where an application may want to use the data binder directly.  For example, to do binding in a Service on some arbitrary object which is not a domain class.  The following will not work because the <code>properties</code> property is read only.<p class="paragraph"/><div class="code"><pre>// src/groovy/bindingdemo/Widget.groovy
<span class="java&#45;keyword">package</span> bindingdemo<p class="paragraph"/>class Widget &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">Integer</span> size
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>// grails&#45;app/services/bindingdemo/WidgetService.groovy
<span class="java&#45;keyword">package</span> bindingdemo<p class="paragraph"/>class WidgetService &#123;<p class="paragraph"/>    def updateWidget(Widget widget, Map data) &#123;
        // <span class="java&#45;keyword">this</span> will <span class="java&#45;keyword">throw</span> an exception because
        // properties is read&#45;only
        widget.properties = data
    &#125;
&#125;</pre></div><p class="paragraph"/>An instance of the data binder is in the Spring application context with a bean name of <code>grailsWebDataBinder</code>.  That bean implements the <a href="http://grails.org/doc/latest/api/org/grails/databinding/DataBinder.html" class="api">DataBinder</a> interface.  The following code demonstrates using the data binder directly.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/services/bindingdmeo/WidgetService
<span class="java&#45;keyword">package</span> bindingdemo<p class="paragraph"/><span class="java&#45;keyword">import</span> org.grails.databinding.SimpleMapDataBindingSource<p class="paragraph"/>class WidgetService &#123;<p class="paragraph"/>    // <span class="java&#45;keyword">this</span> bean will be autowired into the service
    def grailsWebDataBinder<p class="paragraph"/>    def updateWidget(Widget widget, Map data) &#123;
        grailsWebDataBinder.bind widget, data as SimpleMapDataBindingSource
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>See the <a href="http://grails.org/doc/latest/api/org/grails/databinding/DataBinder.html" class="api">DataBinder</a> documentation for more information about overloaded versions
of the <code>bind</code> method.<p class="paragraph"/>
<div class="hidden-block">h4. Data Binding and Security concerns </div>
<h4>データバインディングとセキュリティ考慮</h4><p class="paragraph"/><div class="hidden-block">When batch updating properties from request parameters you need to be careful not to allow clients to bind malicious data to domain classes and be persisted in the database. You can limit what properties are bound to a given domain class using the subscript operator:</div>
リクエストパラメータからの一括プロパティ更新をする際は、クライアントからの悪意のあるデータをドメインクラスにバインドし、データベースに永続化してしまわないように注意が必要です。
添字演算子を使用してドメインクラスにバインドするプロパティを制限することができます:<p class="paragraph"/><div class="code"><pre>def p = Person.get(1)<p class="paragraph"/>p.properties&#91;'firstName','lastName'&#93; = params</pre></div><p class="paragraph"/><div class="hidden-block">In this case only the <code>firstName</code> and <code>lastName</code> properties will be bound.</div>
上記の例では、<code>firstName</code>と<code>lastName</code>のみバインドされます。<p class="paragraph"/><div class="hidden-block">Another way to do this is is to use <a href="../guide/single.html#commandObjects" class="guide">Command Objects</a> as the target of data binding instead of domain classes. Alternatively there is also the flexible <a href="../ref/Controllers/bindData.html" class="controllers">bindData</a> method.</div>
他には、データバインディングの対象をドメインクラスではなく<a href="../guide/single.html#commandObjects" class="guide">コマンドオブジェクト</a>を利用する方法があります。あるいは柔軟な<a href="../ref/Controllers/bindData.html" class="controllers">bindData</a>メソッドを使用します。<p class="paragraph"/><div class="hidden-block">The <code>bindData</code> method allows the same data binding capability, but to arbitrary objects:</div>
<code>bindData</code>メソッドは任意のオブジェクトに同様のデータバインディングができます:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, params)</pre></div><p class="paragraph"/><div class="hidden-block">The <code>bindData</code> method also lets you exclude certain parameters that you don't want updated:</div>
<code>bindData</code>メソッドでは、更新したくないパラメータを除外することができます:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, params, &#91;exclude: 'dateOfBirth'&#93;)</pre></div><p class="paragraph"/><div class="hidden-block">Or include only certain properties:</div>
または、指定したプロパティのみの更新も可能です:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, params, &#91;include: &#91;'firstName', 'lastName'&#93;&#93;)</pre></div><p class="paragraph"/><blockquote class="note">
<div class="hidden-block">Note that if an empty List is provided as a value for the <code>include</code> parameter then all fields will be subject to binding if they are not explicitly excluded.</div>
空のリストが<code>include</code>パラメータの値として与えられた場合、明示的に除外指定がなされていない限り、すべてのフィールドがバインディング対象となることに注意してください。
</blockquote>



<h2 id="xmlAndJSON">7.1.7 XMLとJSONのレスポンス</h2>
<h4>renderメソッドでXMLを出力する <div class="hidden-block">Using the render method to output XML </div></h4><p class="paragraph"/><div class="hidden-block">Grails supports a few different ways to produce XML and JSON responses. The first is the <a href="../ref/Controllers/render.html" class="controllers">render</a> method.</div>
GrailsにはXMLとJSONを生成する複数の方法があります。はじめに<a href="../ref/Controllers/render.html" class="controllers">render</a>メソッド。<p class="paragraph"/><div class="hidden-block">The <code>render</code> method can be passed a block of code to do mark-up building in XML:</div>
<code>render</code>メソッドに、マークアップビルダーのコードブロックを渡してXML生成:<p class="paragraph"/><div class="code"><pre>def list() &#123;<p class="paragraph"/>    def results = Book.list()<p class="paragraph"/>    render(contentType: <span class="java&#45;quote">"text/xml"</span>) &#123;
        books &#123;
            <span class="java&#45;keyword">for</span> (b in results) &#123;
                book(title: b.title)
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The result of this code would be something like:</div>
このコードの結果は以下のようになります:<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;books&#62;</span>
    <span class="xml&#45;tag">&#60;book title=<span class="xml&#45;quote">"The Stand"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;book title=<span class="xml&#45;quote">"The Shining"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/books&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Be careful to avoid naming conflicts when using mark-up building. For example this code would produce an error:</div>
マークアップビルダーを使用する際は、変数名称の衝突を回避する必要があります。例として次のコードはエラーになります:<p class="paragraph"/><div class="code"><pre>def list() &#123;<p class="paragraph"/>    def books = Book.list()  // naming conflict here<p class="paragraph"/>    render(contentType: <span class="java&#45;quote">"text/xml"</span>) &#123;
        books &#123;
            <span class="java&#45;keyword">for</span> (b in results) &#123;
                book(title: b.title)
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is because there is local variable <code>books</code> which Groovy attempts to invoke as a method.</div>
この例では、Groovyがローカル変数のbooksをメソッドとして実行してしまいます。<p class="paragraph"/><h4>renderメソッドでJSONを出力する <div class="hidden-block">Using the render method to output JSON </div></h4><p class="paragraph"/><div class="hidden-block">The <code>render</code> method can also be used to output JSON:</div>
JSONを出力する場合も<code>render</code>メソッドが使用できます:<p class="paragraph"/><div class="code"><pre>def list() &#123;<p class="paragraph"/>    def results = Book.list()<p class="paragraph"/>    render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
        books = array &#123;
            <span class="java&#45;keyword">for</span> (b in results) &#123;
                book title: b.title
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this case the result would be something along the lines of:</div>
このコードの結果は以下のようになります:<p class="paragraph"/><div class="code"><pre>&#91;
    &#123;<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;,
    &#123;<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Shining"</span>&#125;
&#93;</pre></div><p class="paragraph"/><div class="hidden-block">The same dangers with naming conflicts described above for XML also apply to JSON building.</div>
JSONビルダーもXMLと同じく、変数名称の衝突を回避する必要があります。<p class="paragraph"/><h4>自動XMLマーシャリング <div class="hidden-block">Automatic XML Marshalling </div></h4><p class="paragraph"/><div class="hidden-block">Grails also supports automatic marshalling of <a href="../guide/single.html#GORM" class="guide">domain classes</a> to XML using special converters.</div>
Grailsでは<a href="../guide/single.html#GORM" class="guide">ドメインクラス</a>から特別なコンバータを使用した自動マーシャリングをサポートしています。<p class="paragraph"/><div class="hidden-block">To start off with, import the <code>grails.converters</code> package into your controller:</div>
使用するには、<code>grails.converters</code>パッケージをインポートする必要があります:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.converters.&#42;</pre></div><p class="paragraph"/><div class="hidden-block">Now you can use the following highly readable syntax to automatically convert domain classes to XML:</div>
ドメインクラスをXMLに変換するのに、次のように見やすいシンタックスで記述できます:<p class="paragraph"/><div class="code"><pre>render Book.list() as XML</pre></div><p class="paragraph"/><div class="hidden-block">The resulting output would look something like the following::</div>
この例では次のような結果を出力します:<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"ISO&#45;8859&#45;1"</span>?&#62;
&#60;list&#62;
  &#60;book id=<span class="java&#45;quote">"1"</span>&#62;
    &#60;author&#62;Stephen King&#60;/author&#62;
    &#60;title&#62;The Stand&#60;/title&#62;
  &#60;/book&#62;
  &#60;book id=<span class="java&#45;quote">"2"</span>&#62;
    &#60;author&#62;Stephen King&#60;/author&#62;
    &#60;title&#62;The Shining&#60;/title&#62;
  &#60;/book&#62;
&#60;/list&#62;</pre></div><p class="paragraph"/><div class="hidden-block">An alternative to using the converters is to use the <a href="../guide/single.html#codecs" class="guide">codecs</a> feature of Grails. The codecs feature provides <a href="../guide/single.html#codecs" class="guide">encodeAsXML</a> and <a href="../guide/single.html#codecs" class="guide">encodeAsJSON</a> methods:</div>
またconvertersを使用する別の方法としてGrailsの<a href="../guide/single.html#codecs" class="guide">codecs</a>を使用することもできます。codecsでは、<a href="../guide/single.html#codecs" class="guide">encodeAsXML</a>と<a href="../guide/single.html#codecs" class="guide">encodeAsJSON</a>メソッドを提供しています:<p class="paragraph"/><div class="code"><pre>def xml = Book.list().encodeAsXML()
render xml</pre></div><p class="paragraph"/><div class="hidden-block">For more information on XML marshalling see the section on <a href="../guide/single.html#REST" class="guide">REST</a></div>
XMLマーシャリングの情報は<a href="../guide/single.html#REST" class="guide">REST</a>のセクションも参照してください。<p class="paragraph"/><h4>自動JSONマーシャリング <div class="hidden-block">Automatic JSON Marshalling </div></h4><p class="paragraph"/><div class="hidden-block">Grails also supports automatic marshalling to JSON using the same mechanism. Simply substitute <code>XML</code> with <code>JSON</code>:</div>
Grailsでは<code>XML</code>と同じ仕組みで、<code>JSON</code>の自動マーシャリングもサポートしています。単純に先の<code>XML</code>を<code>JSON</code>にするだけです<p class="paragraph"/><div class="code"><pre>render Book.list() as JSON</pre></div><p class="paragraph"/><div class="hidden-block">The resulting output would look something like the following:</div>
この例では次のような結果を出力します:<p class="paragraph"/><div class="code"><pre>&#91;
    &#123;<span class="java&#45;quote">"id"</span>:1,
     <span class="java&#45;quote">"class"</span>:<span class="java&#45;quote">"Book"</span>,
     <span class="java&#45;quote">"author"</span>:<span class="java&#45;quote">"Stephen King"</span>,
     <span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Stand"</span>&#125;,
    &#123;<span class="java&#45;quote">"id"</span>:2,
     <span class="java&#45;quote">"class"</span>:<span class="java&#45;quote">"Book"</span>,
     <span class="java&#45;quote">"author"</span>:<span class="java&#45;quote">"Stephen King"</span>,
     <span class="java&#45;quote">"releaseDate"</span>:<span class="java&#45;keyword">new</span> Date(1194127343161),
     <span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"The Shining"</span>&#125;
 &#93;</pre></div><p class="paragraph"/><div class="hidden-block">Again as an alternative you can use the <code>encodeAsJSON</code> to achieve the same effect.</div>
もちろん、<code>encodeAsJSON</code>も同じ結果になります。


<a name="7.1.8 More on JSONBuilder"><!-- Legacy link --></a>
<h2 id="moreOnJSONBuilder">7.1.8 JSONBuilder (JSONビルダー)</h2>
<div class="hidden-block">The previous section on on XML and JSON responses covered simplistic examples of rendering XML and JSON responses. Whilst the XML builder used by Grails is the standard <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy's+XmlSlurper" target="blank">XmlSlurper</a> found in Groovy, the JSON builder is a custom implementation specific to Grails.</div>
前のセクション「 XMLとJSONレスポンス」で単純なXMLとJSONのを描写してレスポンスする例を紹介しました。Grailsで使用してるXMLビルダーがGroovyの標準的な <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy's+XmlSlurper" target="blank">XmlSlurper</a> に対して、JSONビルダーに関してはGrails特有の実装になっています。<p class="paragraph"/><h4>JSONBuilderとGrailsのバージョン <div class="hidden-block">JSONBuilder and Grails versions </div></h4><p class="paragraph"/><div class="hidden-block">JSONBuilder behaves different depending on the version of Grails you use. For version below 1.2 the deprecated <a href="http://grails.org/doc/latest/api/grails/web/JSONBuilder.html" class="api">grails.web.JSONBuilder</a> class is used. This section covers the usage of the Grails 1.2 JSONBuilder </div>
JSONBuilderの振る舞いは使用するGrailsのバージョンに依存します。1.2以前では現在非推奨となる<a href="http://grails.org/doc/latest/api/grails/web/JSONBuilder.html" class="api">grails.web.JSONBuilder</a>が使用されます。このセクションでは、Grails 1.2のJSONBuilderの説明をします。<p class="paragraph"/><div class="hidden-block">For backwards compatibility the old <code>JSONBuilder</code> class is used with the <code>render</code> method for older applications; to use the newer/better <code>JSONBuilder</code> class set the following in <code>Config.groovy</code>:</div>
下位互換として、古いバージョンからメンテナンスしているアプリケーションのために、<code>render</code>メソッドで古い<code>JSONBuilder</code>を使用するようになっています。新しい良くなった<code>JSONBuilder</code>を使用するには<code>Config.groovy</code>に、次のような設定をします:<p class="paragraph"/><div class="code"><pre>grails.json.legacy.builder = <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><h4>単純なオブジェクトを描写 <div class="hidden-block">Rendering Simple Objects </div></h4><p class="paragraph"/><div class="hidden-block">To render a simple JSON object just set properties within the context of the Closure:</div>
単純なJSONオブジェクトを生成するには、クロージャの中にプロパティをセットするだけです:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    hello = <span class="java&#45;quote">"world"</span>
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above will produce the JSON:</div>
上記の例では、このような結果が得られます:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"hello"</span>:<span class="java&#45;quote">"world"</span>&#125;</pre></div><p class="paragraph"/><h4>JSON配列描写 <div class="hidden-block">Rendering JSON Arrays </div></h4><p class="paragraph"/><div class="hidden-block">To render a list of objects simple assign a list:</div>
オブジェクトのリストを描写するには、変数に配列を指定するだけです:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    categories = &#91;'a', 'b', 'c'&#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will produce:</div>
この例では以下を生成:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"categories"</span>:&#91;<span class="java&#45;quote">"a"</span>,<span class="java&#45;quote">"b"</span>,<span class="java&#45;quote">"c"</span>&#93;&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can also render lists of complex objects, for example:</div>
複雑なオブジェクトのリストも可能です。例として:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    categories = &#91; &#123; a = <span class="java&#45;quote">"A"</span> &#125;, &#123; b = <span class="java&#45;quote">"B"</span> &#125; &#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This will produce:</div>
この例では以下を生成:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"categories"</span>:&#91; &#123;<span class="java&#45;quote">"a"</span>:<span class="java&#45;quote">"A"</span>&#125; , &#123;<span class="java&#45;quote">"b"</span>:<span class="java&#45;quote">"B"</span>&#125;&#93; &#125;</pre></div><p class="paragraph"/><div class="hidden-block">Use the special <code>element</code> method to return a list as the root:</div>
<code>element</code>メソッドを使用することで、リストをルートとして返す事ができます:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    element 1
    element 2
    element 3
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above code produces:</div>
この例では以下を生成:<p class="paragraph"/><div class="code"><pre>&#91;1,2,3&#93;</pre></div><p class="paragraph"/><h4>複雑なオブジェクトの描写 <div class="hidden-block">Rendering Complex Objects </div></h4><p class="paragraph"/><div class="hidden-block">Rendering complex objects can be done with Closures. For example:</div>
より複雑なオブジェクトをクロージャで描写できます。例として:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    categories = &#91;'a', 'b', 'c'&#93;
    title = <span class="java&#45;quote">"Hello JSON"</span>
    information = &#123;
        pages = 10
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">The above will produce the JSON:</div>
この例では次のようなJSONを生成します:<p class="paragraph"/><div class="code"><pre>&#123;<span class="java&#45;quote">"categories"</span>:&#91;<span class="java&#45;quote">"a"</span>,<span class="java&#45;quote">"b"</span>,<span class="java&#45;quote">"c"</span>&#93;,<span class="java&#45;quote">"title"</span>:<span class="java&#45;quote">"Hello JSON"</span>,<span class="java&#45;quote">"information"</span>:&#123;<span class="java&#45;quote">"pages"</span>:10&#125;&#125;</pre></div><p class="paragraph"/><h4>複雑なオブジェクトの配列 <div class="hidden-block">Arrays of Complex Objects </div></h4><p class="paragraph"/><div class="hidden-block">As mentioned previously you can nest complex objects within arrays using Closures:</div>
前述したように、クロージャを使用してオブジェクトを配列にネストすることも可能です:<p class="paragraph"/><div class="code"><pre>render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    categories = &#91; &#123; a = <span class="java&#45;quote">"A"</span> &#125;, &#123; b = <span class="java&#45;quote">"B"</span> &#125; &#93;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">You can use the <code>array</code> method to build them up dynamically:</div>
<code>array</code>メソッドを使用して動的に生成する事もできます:<p class="paragraph"/><div class="code"><pre>def results = Book.list()
render(contentType: <span class="java&#45;quote">"application/json"</span>) &#123;
    books = array &#123;
        <span class="java&#45;keyword">for</span> (b in results) &#123;
            book title: b.title
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>JSONBuilder APIに直接アクセスする <div class="hidden-block">Direct JSONBuilder API Access </div></h4><p class="paragraph"/><div class="hidden-block">If you don't have access to the <code>render</code> method, but still want to produce JSON you can use the API directly:</div>
renderメソッドと関係の無い場所ではJSONを生成したい場合はAPIを直に使用できます:<p class="paragraph"/><div class="code"><pre>def builder = <span class="java&#45;keyword">new</span> JSONBuilder()<p class="paragraph"/>def result = builder.build &#123;
    categories = &#91;'a', 'b', 'c'&#93;
    title = <span class="java&#45;quote">"Hello JSON"</span>
    information = &#123;
        pages = 10
    &#125;
&#125;<p class="paragraph"/>// prints the JSON text
println result.toString()<p class="paragraph"/>def sw = <span class="java&#45;keyword">new</span> StringWriter()
result.render sw</pre></div>


<a name="7.1.9 Uploading Files"><!-- Legacy link --></a>
<h2 id="uploadingFiles">7.1.9 ファイルアップロード</h2>
<h4>プログラムによるファイルアップロード <div class="hidden-block">Programmatic File Uploads </div></h4><p class="paragraph"/><div class="hidden-block">Grails supports file uploads using Spring's <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartHttpServletRequest.html" class="api">MultipartHttpServletRequest</a> interface. The first step for file uploading is to create a multipart form like this:</div>
Grailsでは、Springの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartHttpServletRequest.html" class="api">MultipartHttpServletRequest</a>インターフェイスを使用してファイルアップロードをサポートしています。ファイルアップロードを実装するには、先に次のようにフォームをマルチパートフォームにします:<p class="paragraph"/><div class="code"><pre>Upload Form: <span class="xml&#45;tag">&#60;br /&#62;</span>
    <span class="xml&#45;tag">&#60;g:uploadForm action=<span class="xml&#45;quote">"upload"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"file"</span> name=<span class="xml&#45;quote">"myFile"</span> /&#62;</span>
        <span class="xml&#45;tag">&#60;input type=<span class="xml&#45;quote">"submit"</span> /&#62;</span>
    <span class="xml&#45;tag">&#60;/g:uploadForm&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">The <code>uploadForm</code> tag conveniently adds the <code>enctype="multipart/form-data"</code> attribute to the standard <code>&#60;g:form&#62;</code> tag.</div>
<code>uploadForm</code>タグは、通常の<code>&#60;g:form&#62;</code>タグに、<code>enctype="multipart/form-data"</code>の属性を追加します。<p class="paragraph"/><div class="hidden-block">There are then a number of ways to handle the file upload. One is to work with the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a> instance directly:</div>
アップロードされたファイルを処理するには複数の方法があります。そのうちの一つはSpringの<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a>インスタンスを直接操作する方法です:<p class="paragraph"/><div class="code"><pre>def upload() &#123;
    def f = request.getFile('myFile')
    <span class="java&#45;keyword">if</span> (f.empty) &#123;
        flash.message = 'file cannot be empty'
        render(view: 'uploadForm')
        <span class="java&#45;keyword">return</span>
    &#125;<p class="paragraph"/>    f.transferTo(<span class="java&#45;keyword">new</span> File('/some/local/dir/myfile.txt'))
    response.sendError(200, 'Done')
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">This is convenient for doing transfers to other destinations and manipulating the file directly as you can obtain an <code>InputStream</code> and so on with the <a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a> interface.</div>
この<a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/multipart/MultipartFile.html" class="api">MultipartFile</a>を使用すると、ファイルを別の場所に転送したり、<code>InputStream</code>を取得して直接ファイルを操作したりなど便利です。<p class="paragraph"/><h4>データバインディング経由のファイルアップロード <div class="hidden-block">File Uploads through Data Binding </div></h4><p class="paragraph"/><div class="hidden-block">File uploads can also be performed using data binding. Consider this <code>Image</code> domain class:</div>
データバインディングでファイルアップロードを処理する事ができます。<code>Image</code>というドメインクラスがあるとします:<p class="paragraph"/><div class="code"><pre>class Image &#123;
    <span class="java&#45;object">byte</span>&#91;&#93; myFile<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        // Limit upload file size to 2MB
        myFile maxSize: 1024 &#42; 1024 &#42; 2
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you create an image using the <code>params</code> object in the constructor as in the example below, Grails will automatically bind the file's contents as a <code>byte</code> to the <code>myFile</code> property:</div>
次の例のように、<code>params</code>をコンストラクタに渡してImageオブジェクトを生成すると、Grailsが自動的にファイルのコンテントを<code>myFile</code>プロパティに<code>byte&#91;&#93;</code>としてバインドします:<p class="paragraph"/><div class="code"><pre>def img = <span class="java&#45;keyword">new</span> Image(params)</pre></div><p class="paragraph"/><div class="hidden-block">It's important that you set the <a href="../ref/Constraints/size.html" class="constraints">size</a> or <a href="../ref/Constraints/maxSize.html" class="constraints">maxSize</a> constraints, otherwise your database may be created with a small column size that can't handle reasonably sized files. For example, both H2 and MySQL default to a blob size of 255 bytes for <code>byte</code> properties.</div>
この場合、データベースカラムのサイズが小さいと処理できなくなるので、<a href="../ref/Constraints/size.html" class="constraints">size</a>または<a href="../ref/Constraints/maxSize.html" class="constraints">maxSize</a>の制約を指定しましょう。例としてH2とMySQLは、<code>byte&#91;&#93;</code>プロパティで指定した場合のblobのデフォルトサイズが255バイトになります。<p class="paragraph"/><div class="hidden-block">It is also possible to set the contents of the file as a string by changing the type of the <code>myFile</code> property on the image to a String type:</div>
テキストファイルなどの場合は、<code>myFile</code>プロパティの型をString型にすることで文字列にすることも可能です:<p class="paragraph"/><div class="code"><pre>class Image &#123;
   <span class="java&#45;object">String</span> myFile
&#125;</pre></div>


<a name="7.1.10 Command Objects"><!-- Legacy link --></a>
<h2 id="commandObjects">7.1.10 コマンドオブジェクト</h2>
<div class="hidden-block">Grails controllers support the concept of command objects. A command object is a class that is used in conjunction with <a href="../guide/single.html#dataBinding" class="guide">data binding</a>, usually to allow validation of data that may not fit into an existing domain class.</div>
Grailsのコントローラは、コマンドオブジェクトの概念をサポートしています。
コマンドオブジェクトは<a href="../guide/single.html#dataBinding" class="guide">データバインディング</a>と連携して使われるクラスであり、既存のドメインクラスとは適合しないようなデータのバリデーションを可能にします。<p class="paragraph"/><blockquote class="note">
<div class="hidden-block">
Note: A class is only considered to be a command object when it is used as a parameter of an action.
</div>
注意: どんなクラスでもアクションの引数として使われれば、コマンドオブジェクトと見なされます。
</blockquote><p class="paragraph"/><div class="hidden-block">h4. Declaring Command Objects </div>
<h4>コマンドオブジェクトの宣言</h4><p class="paragraph"/><div class="hidden-block">Command object classes are defined just like any other class.</div>
コマンドオブジェクトクラスは他の通常クラスと同じように定義します:<p class="paragraph"/><div class="code"><pre>@grails.validation.Validateable
class LoginCommand &#123;
    <span class="java&#45;object">String</span> username
    <span class="java&#45;object">String</span> password<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        username(blank: <span class="java&#45;keyword">false</span>, minSize: 6)
        password(blank: <span class="java&#45;keyword">false</span>, minSize: 6)
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example, the command object is marked with the <code>Validateable</code> annotation. The <code>Validateable</code> annotation allows the definition of <a href="../guide/single.html#constraints" class="guide">constraints</a> just like in <a href="../guide/single.html#GORM" class="guide">domain classes</a>. If the command object is defined in the same source file as the controller that is using it, Grails will automatically mark it as <code>Validateable</code>. It is not required that command object classes be validateable.</div>
この例では、コマンドオブジェクトには<code>Validateable</code>アノテーションが付与されています。
<code>Validateable</code>アノテーションを使うと、<a href="../guide/single.html#GORM" class="guide">ドメインクラス</a>のように<a href="../guide/single.html#constraints" class="guide">制約</a>が定義できます。
コマンドオブジェクトがそれを利用するコントローラと同じソースファイル中に定義されている場合は、Grailsは自動的に<code>Validateable</code>を付与します。
コマンドオブジェクトクラスに<code>Validateable</code>を明示的に付与する必要はありません。<p class="paragraph"/><div class="hidden-block">h4. Using Command Objects </div>
<h4>コマンドオブジェクトを使用する</h4><p class="paragraph"/><div class="hidden-block">To use command objects, controller actions may optionally specify any number of command object parameters. The parameter types must be supplied so that Grails knows what objects to create and initialize.</div>
コマンドオブジェクトを使うには、コントローラアクションの引数にコマンドオブジェクトを指定します。
Grailsがどんなオブジェクトを生成して初期化すればよいか分かるように、引数の型を指定しなければなりません。<p class="paragraph"/><div class="hidden-block">Before the controller action is executed Grails will automatically create an instance of the command object class and populate its properties by binding the request parameters.  If the command object class is marked with <code>Validateable</code> then the command object will be validated. For example:</div>
コントローラアクションが実行される前に、Grailsは自動的にコマンドオブジェクトクラスのインスタンスを生成して、リクエストパラメータをバインドしてプロパティを設定します。
コマンドオブジェクトクラスに<code>Validateable</code>が付与されている場合は、コマンドオブジェクトはバリデートされます。
たとえば:<p class="paragraph"/><div class="code"><pre>class LoginController &#123;<p class="paragraph"/>    def login(LoginCommand cmd) &#123;
        <span class="java&#45;keyword">if</span> (cmd.hasErrors()) &#123;
            redirect(action: 'loginForm')
            <span class="java&#45;keyword">return</span>
        &#125;<p class="paragraph"/>        // work with the command object data
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If the command object's type is that of a domain class and there is an <code>id</code> request parameter then instead of invoking the domain class constructor to create a new instance a call will be made to the static <code>get</code> method on the domain class and the value of the <code>id</code> parameter will be passed as an argument.  Whatever is returned from that call to <code>get</code> is what will be passed into the controller action.  This means that if there is an <code>id</code> request parameter and no corresponding record is found in the database then the value of the command object will be <code>null</code>.</div>
もし、コマンドオブジェクトの型がドメインクラスの型と一致し、かつ、<code>id</code>リクエストパラメータが存在している場合は、新しいインスタンスを生成するためにドメインクラスのコンストラクタを実行する代わりに、ドメインクラスの<code>get</code>静的メソッドが呼ばれ、<code>id</code>パラメータがその引数として渡されます。
<code>get</code>の呼び出しから何が返されても、それはそのままコントローラアクションに渡されます。
つまり、もし<code>id</code>リクエストパラメータが存在しても、該当するレコードがデータベース上に見つからない場合は、コマンドオブジェクトは<code>null</code>になります。<p class="paragraph"/><div class="hidden-block">h4. Command Objects and Dependency Injection </div>
<h4>コマンドオブジェクトと依存注入</h4><p class="paragraph"/><div class="hidden-block">Command objects can participate in dependency injection. This is useful if your command object has some custom validation logic which uses a Grails <a href="../guide/single.html#services" class="guide">service</a>:</div>
コマンドオブジェクトでは依存注入がサポートされています。
Grailsの<a href="../guide/single.html#services" class="guide">サービス</a>を使用したカスタムバリデーションなどを使用する際に便利です:<p class="paragraph"/><div class="code"><pre>@grails.validation.Validateable
class LoginCommand &#123;<p class="paragraph"/>    def loginService<p class="paragraph"/>    <span class="java&#45;object">String</span> username
    <span class="java&#45;object">String</span> password<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        username validator: &#123; val, obj &#45;&#62;
            obj.loginService.canLogin(obj.username, obj.password)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">In this example the command object interacts with the <code>loginService</code> bean which is injected by name from the Spring <code>ApplicationContext</code>.</div>
この例では、<code>loginService</code>をSpringの<code>ApplicatinContext</code>から名前解決でコマンドオブジェクトに注入しています。<p class="paragraph"/><div class="hidden-block">h4. Binding The Request Body To Command Objects</div>
<h4>リクエストボディをコマンドオブジェクトにバインドする</h4><p class="paragraph"/><div class="hidden-block">When a request is made to a controller action which accepts a command object and the request contains a body, Grails will attempt to parse the body of the request based on the request content type and use the body to do data binding on the command object.  See the following example.</div>
コマンドオブジェクトを受け取るコントローラアクションにリクエストが届き、かつ、そのリクエストがボディを含んでいるとき、Grailsは、リクエストのコンテントタイプに基づきリクエストのボディをパースして、コマンドオブジェクトへのデータバインディングにそのボディの情報を利用しようとします。
以下の例を見てください:<p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/bindingdemo/DemoController.groovy
<span class="java&#45;keyword">package</span> bindingdemo<p class="paragraph"/>class DemoController &#123;<p class="paragraph"/>    def createWidget(Widget w) &#123;
        render <span class="java&#45;quote">"Name: &#36;&#123;w?.name&#125;, Size: &#36;&#123;w?.size&#125;"</span>
    &#125;
&#125;<p class="paragraph"/>class Widget &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">Integer</span> size
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>&#36; curl &#45;H <span class="java&#45;quote">"Content&#45;Type: application/json"</span> &#45;d '&#123;<span class="java&#45;quote">"name"</span>:<span class="java&#45;quote">"Some Widget"</span>,<span class="java&#45;quote">"size"</span>:<span class="java&#45;quote">"42"</span>&#125;' localhost:8080/myapp/demo/createWidget
 Name: Some Widget, Size: 42
~ &#36;
&#36; curl &#45;H <span class="java&#45;quote">"Content&#45;Type: application/xml"</span> &#45;d '&#60;widget&#62;&#60;name&#62;Some Other Widget&#60;/name&#62;&#60;size&#62;2112&#60;/size&#62;&#60;/widget&#62;' localhost:8080/bodybind/demo/createWidget
 Name: Some Other Widget, Size: 2112
~ &#36;</pre></div><p class="paragraph"/><div class="hidden-block">Note that the body of the request is being parsed to make that work.  Any attempt to read the body of the request after that will fail since the corresponding input stream will be empty.  The controller action can either use a command object or it can parse the body of the request on its own (either directly, or by referring to something like request.JSON), but cannot do both.</div>
この方法において、リクエストボディがパースされていることに注意してください。
対応する入力ストリームは空になるため、パース後にリクエストボディを読もうとしても失敗します。
コントローラアクションは、コマンドオブジェクトを使うか、(直接、または<code>request.JSON</code>のような何らかの方法で)リクエストボディを自力でパースするかのどちらかであれば可能ですが、両方同時にはできません。<p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/bindingdemo/DemoController.groovy
<span class="java&#45;keyword">package</span> bindingdemo<p class="paragraph"/>class DemoController &#123;<p class="paragraph"/>    def createWidget(Widget w) &#123;
        // <span class="java&#45;keyword">this</span> will fail because it requires reading the body,
        // which has already been read.
        def json = request.JSON<p class="paragraph"/>        // ...<p class="paragraph"/>    &#125;
&#125;</pre></div>


<a name="7.1.11 Handling Duplicate Form Submissions"><!-- Legacy link --></a>
<h2 id="formtokens">7.1.11 フォーム二重送信のハンドリング</h2>
<div class="hidden-block">Grails has built-in support for handling duplicate form submissions using the "Synchronizer Token Pattern". To get started you define a token on the <a href="../ref/Tags/form.html" class="tags">form</a> tag:</div>
Grailsには、"同期トークンパターン"を使用した、フォーム二重送信ハンドリングをサポートしています。使用するには、先ずは<a href="../ref/Tags/form.html" class="tags">form</a>タグにuseToken属性を指定します:<p class="paragraph"/><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;g:form useToken=<span class="xml&#45;quote">"true"</span> ...&#62;</span></pre></div><p class="paragraph"/><div class="hidden-block">Then in your controller code you can use the <a href="../ref/Controllers/withForm.html" class="controllers">withForm</a> method to handle valid and invalid requests:</div>
そして、コントローラアクションで<a href="../ref/Controllers/withForm.html" class="controllers">withForm</a>メソッドを利用して、リクエストの有効・無効それぞれのコードを記述します:<p class="paragraph"/><div class="code"><pre>withForm &#123;
   // good request
&#125;.invalidToken &#123;
   // bad request
&#125;</pre></div><p class="paragraph"/><div class="hidden-block">If you only provide the <a href="../ref/Controllers/withForm.html" class="controllers">withForm</a> method and not the chained <code>invalidToken</code> method then by default Grails will store the invalid token in a <code>flash.invalidToken</code> variable and redirect the request back to the original page. This can then be checked in the view:</div>
<a href="../ref/Controllers/withForm.html" class="controllers">withForm</a>メソッドのみを提供して<code>invalidToken</code>にチェインしなかった場合は、デフォルトでGrailsが無効トークンを<code>flash.invalidToken</code>に保持して、元のページにリクエストをリダイレクトします。これによってビューで以下のように確認できます:<p class="paragraph"/>
<div class="code"><pre><span class="xml&#45;tag">&#60;g:if test=<span class="xml&#45;quote">"$&#123;flash.invalidToken&#125;"</span>&#62;</span>
  Don't click the button twice!
<span class="xml&#45;tag">&#60;/g:if&#62;</span></pre></div><p class="paragraph"/><blockquote class="warning">
<div class="hidden-block">The <a href="../ref/Controllers/withForm.html" class="controllers">withForm</a> tag makes use of the <a href="../ref/Controllers/session.html" class="controllers">session</a> and hence requires session affinity or clustered sessions if used in a cluster.</div>
<a href="../ref/Controllers/withForm.html" class="controllers">withForm</a>メソッドはセッション(<a href="../ref/Controllers/session.html" class="controllers">session</a>)を使用するので、セッションの類似性またはクラスタで使用する場合はクラスタ化されたセッションが必要です。
</blockquote>


<a name="7.1.12 Simple Type Converters"><!-- Legacy link --></a>
<h2 id="typeConverters">7.1.12 シンプルタイプコンバータ</h2>
<h3>型変換メソッド <div class="hidden-block">Type Conversion Methods </div></h3><p class="paragraph"/><div class="hidden-block">If you prefer to avoid the overhead of <a href="../guide/single.html#dataBinding" class="guide">Data Binding</a> and simply want to convert incoming parameters (typically Strings) into another more appropriate type the <a href="../ref/Controllers/params.html" class="controllers">params</a> object has a number of convenience methods for each type:</div>
<a href="../guide/single.html#dataBinding" class="guide">データバインディング</a>でのオーバーヘッドを避けたい場合や、受信したパラメータに対して、単純な型変換行いたい場合、 <a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトには、型によって幾つかの便利なメソッドが有ります:<p class="paragraph"/><div class="code"><pre>def total = params.<span class="java&#45;object">int</span>('total')</pre></div><p class="paragraph"/><div class="hidden-block">The above example uses the <code>int</code> method, and there are also methods for <code>boolean</code>, <code>long</code>, <code>char</code>, <code>short</code> and so on. Each of these methods is null-safe and safe from any parsing errors, so you don't have to perform any additional checks on the parameters.</div>
上記の例ではintメソッドを使用しています。ほかに、<code>boolean</code>,<code>long</code>,<code>char</code>,<code>short</code>等多数のメソッドがあります。これらのメソッドはnullセーフであり、パースエラーセーフなので、パラメータに対してのチェックを追加する必要がありません。<p class="paragraph"/>
<div class="hidden-block">Each of the conversion methods allows a default value to be passed as an optional second argument.  The default value will be returned if a corresponding entry cannot be found in the map or if an error occurs during the conversion.  Example:</div>
型変換メソッドの第二引数にデフォルト値を設定することができます。一致する入力が無い場合や、型変換でエラーが起きた場合に指定したデフォルト値が返されます:<p class="paragraph"/><div class="code"><pre>def total = params.<span class="java&#45;object">int</span>('total', 42)</pre></div><p class="paragraph"/><div class="hidden-block">These same type conversion methods are also available on the <code>attrs</code> parameter of GSP tags.</div>
GSPタグの<code>attrs</code>パラメータでも、同じ仕組みの型変換機能が使用できます。<p class="paragraph"/><h3>複数の同一名称パラメータのハンドリング <div class="hidden-block">Handling Multi Parameters </div></h3><p class="paragraph"/><div class="hidden-block">A common use case is dealing with multiple request parameters of the same name. For example you could get a query string such as <code>?name=Bob&#38;name=Judy</code>.</div>
よくあるケースとして、リクエストパラメータ内の複数の同じ名称を扱う場合があります。クエリーの例として、<code>"?name=Bob&#38;name=Judy"</code>等。<p class="paragraph"/><div class="hidden-block">In this case dealing with one parameter and dealing with many has different semantics since Groovy's iteration mechanics for <code>String</code> iterate over each character. To avoid this problem the <a href="../ref/Controllers/params.html" class="controllers">params</a> object provides a <code>list</code> method that always returns a list:</div>
パラメータに1つのみしか無い場合にイテレートしてしまうと、<code>String</code>の文字列が1文字ずつ参照されてしまいます。この問題を避けるために、<a href="../ref/Controllers/params.html" class="controllers">params</a>オブジェクトの<code>list</code>メソッドを使用することで毎回リストを返すことが可能です:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">for</span> (name in params.list('name')) &#123;
    println name
&#125;</pre></div>



<h2 id="controllerExceptionHandling">7.1.13 コントローラ例外ハンドリング宣言</h2>
Grails controllers support a simple mechanism for declarative exception handling.  If a controller declares a method that accepts a single argument and the argument type is <code>java.lang.Exception</code> or some subclass of <code>java.lang.Exception</code>, that method will be invoked any time an action in that controller throws an exception of that type.  See the following example.<p class="paragraph"/><div class="code"><pre>// grails&#45;app/controllers/demo/DemoController.groovy
<span class="java&#45;keyword">package</span> demo<p class="paragraph"/>class DemoController &#123;<p class="paragraph"/>    def someAction() &#123;
        // <span class="java&#45;keyword">do</span> some work
    &#125;<p class="paragraph"/>    def handleSQLException(SQLException e) &#123;
        render 'A SQLException Was Handled'
    &#125;<p class="paragraph"/>    def handleBatchUpdateException(BatchUpdateException e) &#123;
        redirect controller: 'logging', action: 'batchProblem'
    &#125;<p class="paragraph"/>    def handleNumberFormatException(NumberFormatException nfe) &#123;
        &#91;problemDescription: 'A <span class="java&#45;object">Number</span> Was Invalid'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>
That controller will behave as if it were written something like this...<p class="paragraph"/>
<div class="code"><pre>// grails&#45;app/controllers/demo/DemoController.groovy
<span class="java&#45;keyword">package</span> demo<p class="paragraph"/>class DemoController &#123;<p class="paragraph"/>    def someAction() &#123;
        <span class="java&#45;keyword">try</span> &#123;
            // <span class="java&#45;keyword">do</span> some work
        &#125; <span class="java&#45;keyword">catch</span> (BatchUpdateException e) &#123;
            <span class="java&#45;keyword">return</span> handleBatchUpdateException(e)
        &#125; <span class="java&#45;keyword">catch</span> (SQLException e) &#123;
            <span class="java&#45;keyword">return</span> handleSQLException(e)
        &#125; <span class="java&#45;keyword">catch</span> (NumberFormatException e) &#123;
            <span class="java&#45;keyword">return</span> handleNumberFormatException(e)
        &#125;
    &#125;<p class="paragraph"/>    def handleSQLException(SQLException e) &#123;
        render 'A SQLException Was Handled'
    &#125;<p class="paragraph"/>    def handleBatchUpdateException(BatchUpdateException e) &#123;
        redirect controller: 'logging', action: 'batchProblem'
    &#125;<p class="paragraph"/>    def handleNumberFormatException(NumberFormatException nfe) &#123;
        &#91;problemDescription: 'A <span class="java&#45;object">Number</span> Was Invalid'&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>The exception handler method names can be any valid method name.  The name is not what makes the method an exception handler, the <code>Exception</code> argument type is the important part.<p class="paragraph"/>The exception handler methods can do anything that a controller action can do including invoking <code>render</code>, <code>redirect</code>, returning a model, etc.  The exception handler methods are inherited into sublcasses so an application could define the exception handlers in an abstract class that multiple controllers extend from.<p class="paragraph"/>Exception handler methods must be present at compile time.  Specifically, exception handler methods which are runtime metaprogrammed onto a controller class are not supported.



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/GORM.html">&lt;&lt; <strong>6</strong><span>O/R&#12510;&#12483;&#12500;&#12531;&#12464; (GORM)</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/webServices.html"><strong>8</strong><span>Web&#12469;&#12540;&#12499;&#12473;</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Command%20Line/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/add-proxy.html">add-proxy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/alias.html">alias</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/bootstrap.html">bootstrap</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/bug-report.html">bug-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/clean.html">clean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/clear-proxy.html">clear-proxy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/compile.html">compile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/console.html">console</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-app.html">create-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-controller.html">create-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-filters.html">create-filters</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-hibernate-cfg-xml.html">create-hibernate-cfg-xml</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-integration-test.html">create-integration-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-multi-project-build.html">create-multi-project-build</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-plugin.html">create-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-pom.html">create-pom</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-scaffold-controller.html">create-scaffold-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-script.html">create-script</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-service.html">create-service</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-tag-lib.html">create-tag-lib</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-unit-test.html">create-unit-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/dependency-report.html">dependency-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/doc.html">doc</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-all.html">generate-all</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-controller.html">generate-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-views.html">generate-views</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/help.html">help</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/init.html">init</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/install-dependency.html">install-dependency</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/install-plugin.html">install-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/install-templates.html">install-templates</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/integrate-with.html">integrate-with</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/interactive.html">interactive</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/list-plugin-updates.html">list-plugin-updates</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/list-plugins.html">list-plugins</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/migrate-docs.html">migrate-docs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/package-plugin.html">package-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/package.html">package</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/plugin-info.html">plugin-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/refresh-dependencies.html">refresh-dependencies</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/remove-proxy.html">remove-proxy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-app.html">run-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-script.html">run-script</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-war.html">run-war</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/schema-export.html">schema-export</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/set-proxy.html">set-proxy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/set-version.html">set-version</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/shell.html">shell</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/stats.html">stats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/stop-app.html">stop-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/test-app.html">test-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/uninstall-plugin.html">uninstall-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/upgrade.html">upgrade</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/war.html">war</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/wrapper.html">wrapper</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Constraints</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Constraints/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Constraints/attributes.html">attributes</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/bindable.html">bindable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/blank.html">blank</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/creditCard.html">creditCard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/email.html">email</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/inList.html">inList</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/matches.html">matches</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/max.html">max</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/maxSize.html">maxSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/min.html">min</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/minSize.html">minSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/notEqual.html">notEqual</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/nullable.html">nullable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/range.html">range</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/scale.html">scale</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/size.html">size</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/unique.html">unique</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/url.html">url</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/validator.html">validator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/widget.html">widget</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controllers</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Controllers/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Controllers/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/afterInterceptor.html">afterInterceptor</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/allowedMethods.html">allowedMethods</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/beforeInterceptor.html">beforeInterceptor</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/bindData.html">bindData</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/chain.html">chain</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/defaultAction.html">defaultAction</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/forward.html">forward</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/grailsApplication.html">grailsApplication</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/namespace.html">namespace</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/redirect.html">redirect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/respond.html">respond</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/responseFormats.html">responseFormats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/session.html">session</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/withForm.html">withForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/withFormat.html">withFormat</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Database Mapping</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/autoImport.html">autoImport</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/autoTimestamp.html">autoTimestamp</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/batchSize.html">batchSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/cache.html">cache</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/cascade.html">cascade</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/column.html">column</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/comment.html">comment</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/discriminator.html">discriminator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/dynamicInsert.html">dynamicInsert</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/dynamicUpdate.html">dynamicUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/fetch.html">fetch</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/id.html">id</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/ignoreNotFound.html">ignoreNotFound</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/indexColumn.html">indexColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/insertable.html">insertable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/joinTable.html">joinTable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/lazy.html">lazy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/order.html">order</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/sort.html">sort</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/table.html">table</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/type.html">type</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/updateable.html">updateable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/version.html">version</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/addTo.html">addTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/attach.html">attach</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/belongsTo.html">belongsTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/clearErrors.html">clearErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/constraints.html">constraints</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/count.html">count</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/countBy.html">countBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/createCriteria.html">createCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/delete.html">delete</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/discard.html">discard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/embedded.html">embedded</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/executeQuery.html">executeQuery</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/exists.html">exists</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/fetchMode.html">fetchMode</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/find.html">find</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAllBy.html">findAllBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAllWhere.html">findAllWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findBy.html">findBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrCreateBy.html">findOrCreateBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrCreateWhere.html">findOrCreateWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrSaveBy.html">findOrSaveBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrSaveWhere.html">findOrSaveWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findWhere.html">findWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/first.html">first</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/get.html">get</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getAll.html">getAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasMany.html">hasMany</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasOne.html">hasOne</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/ident.html">ident</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/instanceOf.html">instanceOf</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/isAttached.html">isAttached</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/isDirty.html">isDirty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/last.html">last</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/list.html">list</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/listOrderBy.html">listOrderBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/load.html">load</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/lock.html">lock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mapWith.html">mapWith</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mappedBy.html">mappedBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mapping.html">mapping</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/merge.html">merge</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/namedQueries.html">namedQueries</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/properties.html">properties</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/read.html">read</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/refresh.html">refresh</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/removeFrom.html">removeFrom</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/save.html">save</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/transients.html">transients</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/validate.html">validate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/where.html">where</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/whereAny.html">whereAny</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withCriteria.html">withCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withNewSession.html">withNewSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withSession.html">withSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withTransaction.html">withTransaction</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plug-ins</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Plug-ins/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/URL%20mappings.html">URL mappings</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/codecs.html">codecs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/controllers.html">controllers</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/core.html">core</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/dataSource.html">dataSource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/domainClasses.html">domainClasses</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/filters.html">filters</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/hibernate.html">hibernate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/i18n.html">i18n</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/logging.html">logging</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/scaffolding.html">scaffolding</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/services.html">services</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/servlets.html">servlets</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/web%20flow.html">web flow</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Services</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Services/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Services/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Services/transactional.html">transactional</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Servlet API</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tag Libraries</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/pageScope.html">pageScope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Tags/actionSubmit.html">actionSubmit</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/actionSubmitImage.html">actionSubmitImage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/applyLayout.html">applyLayout</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/checkBox.html">checkBox</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/collect.html">collect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/cookie.html">cookie</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/country.html">country</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/countrySelect.html">countrySelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/createLink.html">createLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/createLinkTo.html">createLinkTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/currencySelect.html">currencySelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/datePicker.html">datePicker</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/each.html">each</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/eachError.html">eachError</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/else.html">else</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/elseif.html">elseif</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/external.html">external</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/field.html">field</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/fieldValue.html">fieldValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/form.html">form</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formRemote.html">formRemote</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formatBoolean.html">formatBoolean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formatDate.html">formatDate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formatNumber.html">formatNumber</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/grep.html">grep</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/header.html">header</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/hiddenField.html">hiddenField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/if.html">if</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/img.html">img</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/include.html">include</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/isAvailable.html">isAvailable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/isNotAvailable.html">isNotAvailable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/javascript.html">javascript</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/join.html">join</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/layoutBody.html">layoutBody</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/layoutHead.html">layoutHead</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/layoutTitle.html">layoutTitle</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/link.html">link</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/localeSelect.html">localeSelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/message.html">message</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/meta.html">meta</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/pageProperty.html">pageProperty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/paginate.html">paginate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/passwordField.html">passwordField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/radio.html">radio</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/radioGroup.html">radioGroup</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/remoteField.html">remoteField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/remoteFunction.html">remoteFunction</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/remoteLink.html">remoteLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/renderErrors.html">renderErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/resource.html">resource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/select.html">select</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/set.html">set</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/setProvider.html">setProvider</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/sortableColumn.html">sortableColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/submitButton.html">submitButton</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/submitToRemote.html">submitToRemote</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/textArea.html">textArea</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/textField.html">textField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/timeZoneSelect.html">timeZoneSelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/unless.html">unless</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/uploadForm.html">uploadForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/while.html">while</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. <br/>[注意]このGrails日本語ドキュメントは、有志による翻訳というよりは意訳なドキュメントです。 Grails日本語ドキュメントに関するお問い合わせ、ドキュメントプロジェクトに参加したい等の問い合わせは。 twitter: @tyama 迄<br/>
    Sponsored by <a href="http://springsource.com">SpringSource</a>
</div>

<script type="text/javascript" src="../../js/docs.js"></script>

</body>
</html>
